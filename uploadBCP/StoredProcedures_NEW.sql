
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[CONTROL_Update_ASP_References] 

AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	update [Sys_Object] set 
	  ASP = (SELECT count( [ASP_FileID] ) FROM [CONTROL].[dbo].[ASP_FILE] f where f.[Content] like '%' + [Name] + '%' and NOT f.[Filename] = '%_X')
	, ASPx = (SELECT count( [ASP_FileID] ) FROM [CONTROL].[dbo].[ASP_FILE] f where f.[Content] like '%' + [Name] + '%' and f.[Filename] = '%_X')
END

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[CONTROL_Update_Sys_Object]
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	
	MERGE [Sys_Object] as TARGET
	USING (

		select * from (
			select [name] , 'View' as [type], type_desc as [Description], modify_date as [LastUpdate]
			from [arm_core].sys.views where NOT [Name] like '%_X'

			UNION 

			select [name] , 'Table' as [type], type_desc as [Description], modify_date as [LastUpdate]
			from [arm_core].sys.tables where NOT [Name] like 'TMP_RAW%' and NOT [Name] like '%_X'

			UNION

			select [name] , 'Procedure' as [type], type_desc as [Description], modify_date as [LastUpdate]
			from [arm_core].sys.procedures where NOT [Name] like '%_X'

			UNION

			select [name] , 'Function' as [type], type_desc as [Description], modify_date as [LastUpdate]
			from [arm_core].sys.all_objects where [Type] in ('FN','IF','AF','TF','FS') and [is_ms_shipped] = 0 and NOT [Name] like '%_X'

		) a 

	) as SOURCE
	ON (Target.[Name] = Source.[NAME] and Target.[Type] = Source.[Type])
	WHEN NOT MATCHED BY TARGET THEN
		INSERT ([Name],[Type],[Description],[LastUpdate],[Core],[Include],[New]) 
		VALUES (Source.[NAME], Source.[type], Source.[Description], Source.[LastUpdate], 1, 0, 1)
	WHEN MATCHED THEN
		UPDATE SET [LastUpdate] = Source.[LastUpdate], [Description] = Source.[Description];

		

	-- Remove redundant records from SYS_OBJECTS


	delete from [Sys_Object] where ObjectID in (
		SELECT s.ObjectID FROM [Sys_Object] s
		LEFT JOIN (
			select [name] , 'View' as [type], type_desc as [Description], modify_date as [LastUpdate]
			from [arm_core].sys.views where NOT [Name] like '%_X'

			UNION 

			select [name] , 'Table' as [type], type_desc as [Description], modify_date as [LastUpdate]
			from [arm_core].sys.tables where NOT [Name] like 'TMP_RAW%' and NOT [Name] like '%_X'

			UNION

			select [name] , 'Procedure' as [type], type_desc as [Description], modify_date as [LastUpdate]
			from [arm_core].sys.procedures where NOT [Name] like '%_X'

			UNION

			select [name] , 'Function' as [type], type_desc as [Description], modify_date as [LastUpdate]
			from [arm_core].sys.all_objects where [Type] in ('FN','IF','AF','TF','FS') and [is_ms_shipped] = 0 and NOT [Name] like '%_X'

		) i on i.[NAME] = s.[Name] 
		where i.[Name] IS NULL and s.[Type] <> 'ASP'
	)
		
	-- 
	Update [Sys_Object] set [IsReferenced] = 0
	MERGE [Sys_Object] as TARGET
	USING (

		SELECT Count(referencing_id) as refs, referenced_entity_name   , fo.[Type]
		FROM sys.sql_expression_dependencies AS sed  
		INNER JOIN sys.objects AS o ON sed.referencing_id = o.object_id  
		LEFT JOIN [SYS_OBJECT] so on so.Name = OBJECT_NAME(referencing_id)
		LEFT JOIN [SYS_OBJECT] fo on fo.Name = referenced_entity_name
		where fo.[Type] IS NOT NULL
		group by referenced_entity_name   , fo.[Type]

	) as SOURCE
	ON (Target.[Name] = Source.[referenced_entity_name] and Target.[Type] = Source.[Type])
	WHEN MATCHED THEN
		UPDATE SET [IsReferenced] = Source.[Refs];

	Update [Sys_Object] set [HasDefunctReference] = 0
	MERGE [Sys_Object] as TARGET
	USING (

		SELECT Count(referencing_id) as refs, OBJECT_NAME(referencing_id) AS referencing_entity_name, so.[Type] as [referencing_type]   , fo.[Type]
		FROM sys.sql_expression_dependencies AS sed  
		INNER JOIN sys.objects AS o ON sed.referencing_id = o.object_id  
		LEFT JOIN [SYS_OBJECT] so on so.Name = OBJECT_NAME(referencing_id)
		LEFT JOIN [SYS_OBJECT] fo on fo.Name = referenced_entity_name
		where fo.[Type] IS NULL and NOT referenced_entity_name in ('value','ASP_FILE','TriggerItem','sp_send_dbmail','sysmail_allitems','sysmail_event_log') and NOT referenced_entity_name LIKE 'xp_%'
		group by OBJECT_NAME(referencing_id) , so.[Type], fo.[Type]

	) as SOURCE
	ON (Target.[Name] = Source.[referencing_entity_name] and Target.[Type] = Source.[referencing_type])
	WHEN MATCHED THEN
		UPDATE SET [HasDefunctReference] = [Refs];


END

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE CONTROL_Show_Dependencies
@ObjectName nvarchar(255)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	-- Lists all objects on which it depends 
	SELECT OBJECT_NAME(referencing_id) AS referencing_entity_name,   so.[Type], 
		o.type_desc AS referencing_desciption,   		referenced_class_desc,  		referenced_entity_name   , fo.[Type]
	FROM [ARM_CORE].sys.sql_expression_dependencies AS sed  
	INNER JOIN [ARM_CORE].sys.objects AS o ON sed.referencing_id = o.object_id  
	LEFT JOIN [SYS_OBJECT] so on so.Name = OBJECT_NAME(referencing_id)
	LEFT JOIN [SYS_OBJECT] fo on fo.Name = referenced_entity_name
	WHERE referenced_id = OBJECT_ID(@ObjectName)


	SELECT OBJECT_NAME(referencing_id) AS referencing_entity_name,   so.[Type], 
		o.type_desc AS referencing_desciption,   		referenced_class_desc,  		referenced_entity_name   , fo.[Type]
	FROM [ARM_CORE].sys.sql_expression_dependencies AS sed  
	INNER JOIN [ARM_CORE].sys.objects AS o ON sed.referencing_id = o.object_id  
	LEFT JOIN [SYS_OBJECT] so on so.Name = OBJECT_NAME(referencing_id)
	LEFT JOIN [SYS_OBJECT] fo on fo.Name = referenced_entity_name
	WHERE referencing_id = OBJECT_ID(@ObjectName)

END

GO
-- =============================================
-- Author:             <Author,,Name>
-- Create date: <Create Date,,>
-- Description:        <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[DYN-ParentID]
        -- Add the parameters for the stored procedure here
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
        SET NOCOUNT ON;
    -- Insert statements for procedure here

             select d.[ActionREF] as [DynamicLabel], d.[ActionID] as [DynamicValue] 
             from  A_TaskAction d 
             where (IsNull(d.[ActionRef],'') <> '' )
END


GO

CREATE proc [dbo].[sp_MailerImages]( @message NVARCHAR(MAX),
                                                            @messagetextOut VARCHAR(max) OUTPUT)
AS
BEGIN

DECLARE @sigStart INT, 
             @sigEnd INT, 
             @AttachText NVARCHAR(MAX),
             @signatureMarker NVARCHAR(100)

WHILE CHARINDEX('{IMAGE',@message) > 0 
BEGIN
       SET @sigstart = CHARINDEX('{IMAGE',@message);
       SET @sigend =  CHARINDEX('}',@message, @sigstart) - CHARINDEX('{IMAGE',@message) +1;
       SET @signatureMarker = SUBSTRING(@message, @sigStart, @sigEnd)

       SELECT  @AttachText = '<img src="data:image/jpg;base64,' + CAST(N'' AS XML).value(
          'xs:base64Binary(xs:hexBinary(sql:column("Pic")))'
        , 'NVARCHAR(MAX)') 
             FROM (
                SELECT CAST(ImageData AS VARBINARY(MAX)) AS Pic  FROM a_mailerImage where ImageName = @signatureMarker
             ) AS h;

       SET @message = REPLACE(@message, @signatureMarker, CONCAT(@AttachText , '">'))
END


SET @messagetextOut = @message

end

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SYS_EVENT_ADMINTASK]
	@EVENTID int
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

-- Move items from Collection based on Day Trigger

	DECLARE @CID int;
    DECLARE @DAYTRIGGER nvarchar(100);

    DECLARE @EVENTTYPE nvarchar(250);
    DECLARE @MESSAGE nvarchar(MAX);
    DECLARE @ContactList nvarchar(250);
	DECLARE @itemtype nvarchar(100);
    DECLARE @USERID nvarchar(250);

	DECLARE @mSQL NVARCHAR(MAX);	
	DECLARE @params NVARCHAR(1000);

	DECLARE @GroupName nvarchar(255);
	DECLARE @CollectionName nvarchar(255);


	SELECT distinct TOP 1  
		 @ContactList =  e.ContactList,
		 @itemtype = c.[Type],
		 @CID = e.[CollectionID]
		, @EVENTTYPE = [EventType]
		, @DAYTRIGGER = IsNull(e.[DayTrigger],'-1')
		, @GroupName = cc.[Name]
		, @MESSAGE = e.[Message]
		, @CollectionName = c.[Name]
	FROM [ARM_CORE].[dbo].[Sys_Event] e 
	LEFT JOIN [A_Collection] c on c.CollectionID = e.CollectionID 
	LEFT JOIN [A_CollectionClass] cc on cc.CollectionClassID = c.CollectionClassID
	where [EventID] = @EVENTID


	-- All items that have hit the DayTrigger are made available in @TriggerItems
	-- TriggerItem is a User-Define Table Type that includes one field called itemID of type nvarchar(255)


	DECLARE @TriggerItems TriggerItem

	if @DAYTRIGGER = '' set @DAYTRIGGER = '-1'

	-- Capture those items that meet the Day Trigger criteria

	set @mSQL = N'select distinct i.itemID from [ARM_CORE]..[A_CollectionItem] i where i.CollectionID = ' + cast(@CID as nvarchar(20)) + ' and (DATEDIFF(day, i.TaggedOn, GETDATE()) in ( ' + @daytrigger + ') or -1 in ( ' + @daytrigger + ' )) ' 
	INSERT INTO @TriggerItems  EXEC sp_executesql @mSQL

	DECLARE @Items TABLE (
		[ItemsID] [int] IDENTITY(1,1) NOT NULL,
        [ItemID] nvarchar(255)
    );

	DECLARE @minItem int, @maxItem int
	DECLARE @SpawnItemID nvarchar(255), @SpawnAdminTaskID nvarchar(255)
	DECLARE @AdminHeader nvarchar(1000), @AdminLoad nvarchar(MAX)

	DECLARE @ActiveAdminTasksID int
	
	set @ActiveAdminTasksID = (select top 1 c.CollectionID as ActiveAdminTasksID from [A_Collection] c where c.CREF = '_ActiveAdminTasks' )


	INSERT INTO @Items 
	select itemID from @TriggerItems


	SELECT @minItem = MIN([ItemsID]),	@maxItem = MAX([ItemsID]) FROM @Items

	WHILE @minItem <= @maxItem 
	BEGIN

		select @SpawnItemID = [itemID] from @Items where [ItemsID] = @minItem

		set @AdminHeader = @GroupName + ' - ' + @CollectionName + ' - ' + @SpawnItemID
		set @AdminLoad = Replace(@MESSAGE, '{ITEMID}', @SpawnItemID)
		

		if NOT EXISTS(select * from [AdminTask] where EventID = @EventID and ItemID = @SpawnItemID)
		BEGIN

			Insert into [ARM_CORE]..[AdminTask] ([Header],[Description],[ItemID],[EventID]) Values (@AdminHeader,@AdminLoad,@SpawnItemID,@EventID)
		
			set @SpawnAdminTaskID = SCOPE_IDENTITY() 

			EXEC [ARM_CORE]..[AddToCollection] '', @SpawnAdminTaskID, @ActiveAdminTasksID, 1 
		END
		ELSE
			select @SpawnAdminTaskID = AdminTaskID from [AdminTask] where EventID = @EventID and ItemID = @SpawnItemID


		MERGE [ARM_CORE]..[A_Task] as Target using ( 
			select i.ItemID as UserID, -1 as [ActionID],  @GroupName as [Group], @SpawnAdminTaskID as ItemID, 'AdminTask' as [ItemType] from [A_Collection] c LEFT JOIN [A_CollectionItem] i on i.CollectionID = c.CollectionID where c.CREF = @ContactList
		) as Source 
		ON (target.[ItemID] = source.[ItemID] and target.[ItemType] = source.[ItemType] and target.[UserID] = source.[UserID] and target.[ActionID] = source.[ActionID]) 
		WHEN NOT MATCHED BY TARGET THEN  
		insert ([Group], [ItemID], [Itemtype], [UserID], [ActionID], [ConditionCollectionID]) Values (Source.[Group], Source.[ItemID], Source.[Itemtype], Source.[UserID], Source.[ActionID], @ActiveAdminTasksID);


		SELECT @minItem = MIN([ItemsID]) FROM @Items where [ItemsID] > @minItem

	END



END

GO

CREATE PROC sp_ping_Colleciton (@collectionID INT)
AS
	BEGIN
	DECLARE @pingResult TABLE (Line NVARCHAR(512))
	SET NOCOUNT ON

	DECLARE @cmd NVARCHAR(100),
			@minAssetID NVARCHAR(100), 
			@maxAssetID NVARCHAR(100), 
		
			@ping NVARCHAR(100), 
			@pingTime datetime




	SELECT @minAssetID =  MIN(a.AssetID), 
			@maxAssetID = MAX(a.AssetID)
	from A_CollectionItem ci
	INNER JOIN Asset a
	ON ci.ItemID = a.AssetID
	where CollectionID = @collectionID

	WHILE @minAssetID <= @maxAssetID
	BEGIN

		SET @cmd = 'ping ' + @minAssetID

		INSERT INTO @pingresult
		EXEC master.dbo.xp_cmdshell @cmd


		SELECT TOP 1   @ping = Line  FROM @pingresult

		IF  @ping  = 'Ping request could not find host ' + @minAssetID + '. Please check the name and try again.'
		BEGIN
			SET @pingTime = NULL
		END
		ELSE
		BEGIN
			SET @pingTime = GETDATE()
		END

		UPDATE Asset SET Heartbeat =  @pingtime WHERE AssetID = @minAssetID

		SELECT @minAssetID =  MIN(a.AssetID)
		FROM A_CollectionItem ci
		INNER JOIN Asset a
		ON ci.ItemID = a.AssetID
		WHERE CollectionID = @collectionID
			AND a.AssetID > @minAssetID

		DELETE FROM @pingresult
	END
END


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[CREATE_AdminTask] 
	@Header nvarchar(1000) = 'Admin Task',
	@Description nvarchar(max) = '',
	@ItemID nvarchar(255) = ''
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	insert into [ARM_CORE]..[AdminTask] ([Header],[Description],[ItemID]) Values (@Header,@Description,@ItemID); 
	
	SELECT SCOPE_IDENTITY() AS [NewAdminTask]

END

GO
 CREATE Proc [dbo].[sp_Update_Odata] ( @dataname varchar(50))
 AS
	 DECLARE @response NVARCHAR(MAX), 
			 @endpoint VARCHAR(200), 
			 @json VARCHAR(MAX), 
			 @clientID VARCHAR(200), 
			 @clientSecret VARCHAR(200), 
			 @tennantID VARCHAR(200),
			-- @dataname varchar(50), --
			 @URL VARCHAR(200), 
			 @accessToken VARCHAR(2000), 
			 @jsonData NVARCHAR(MAX), 
			 @minID BIGINT, 
			 @maxID BIGINT, 
			 @minvarID VARCHAR(50),
			 @sql NVARCHAR(MAX)

		--SET @dataname = 'licenseDetails'

		SELECT @clientID = PropertyValue
		FROM SystemGlobalProperties
		WHERE PropertyName = 'Client_ID'

		SELECT @clientSecret = PropertyValue
		FROM SystemGlobalProperties
		WHERE PropertyName = 'Client_secret'

		SELECT @tennantID = PropertyValue
		FROM SystemGlobalProperties
		WHERE PropertyName = 'tennantID'
		--getting MS auth token 
		SET @json = '
				{  "client_id": "' + @clientID +'",
				  "scope": "https://graph.microsoft.com/.default",
				  "client_secret": "' + @clientSecret + '",
				  "grant_type": "client_credentials",
				  "auth_url": "https://login.microsoftonline.com/' + @tennantID +'/oauth2/v2.0/token"
				}'
	 SET @response  =  [dbo].[Post]('https://ftp.jra-consultancy.co.uk:8081/License/GetToken',@json);

	SELECT @accessToken = [value] 
	FROM OPENJSON(@response)
	WHERE [KEY]  = 'access_token'

	--print @accesstoken
	
	SELECT @URL = [url], 
			@sql  = dataUpdateSQL
	FROM Odata_json
	WHERE dataName = @dataname

	IF CHARINDEX('{id}', @URL) > 0 
	BEGIN
		If (SELECT COUNT(*) FROM Odata_json WHERE dataName = @dataname AND jsonValue is null) = 0
		BEGIN
			UPDATE Odata_json SET jsonValue = NULL WHERE dataName = @dataname
		END
		
		SELECT @minID =  dbo.fn_removeAlpha(MIN(JSON_VALUE(a.Value, '$.id'))) , @maxID =  dbo.fn_removeAlpha(MAX(JSON_VALUE(a.Value, '$.id')))
				,  @minvarID =  MIN(JSON_VALUE(a.Value, '$.id'))
		FROM (
			SELECT x.value 
			FROM Odata_json AS c
			CROSS APPLY OPENJSON(JSON_QUERY(jsonValue, '$')) AS x 
				where dataName = 'USERS' ) a
				--print @minid
		WHILE @minID < = @maxID
		BEGIN
			print @minvarID
			SET @URL = REPLACE(@URL, '{id}', @minvarID)
			print @URL
			SET @response  =  [dbo].GETWithHeader(@URL, 'Authorization', @accessToken)
			SELECT @jsonData = [value] 
			FROM OPENJSON(@response)
			WHERE [KEY]  = 'value'
			print @jsonData
			SET @jsonData = JSON_MODIFY(@jsonData, '$.id', @minvarID) 
			print @jsondata
			 If (SELECT COUNT(*) FROM Odata_json WHERE dataName = @dataname	 AND jsonValue is null) = 0
			 BEGIN
				UPDATE Odata_json SET jsonValue = JSON_MODIFY(jsonValue, 'append $', JSON_QUERY(SUBSTRING(@jsonData, 2, LEN(@jsonData)-1))) WHERE dataName = @dataname
			 END
			 ELSE
			 BEGIN
				 UPDATE Odata_json SET jsonValue =  @jsonData WHERE dataName = @dataname
			 END
		
			
			
			
			SELECT @minvarID  = MIN(JSON_VALUE(a.Value, '$.id')), 
					 @minID=  dbo.fn_removeAlpha(MIN(JSON_VALUE(a.Value, '$.id')))
			FROM (
			SELECT x.value 
			FROM Odata_json AS c
			CROSS APPLY OPENJSON(JSON_QUERY(jsonValue, '$')) AS x 
				WHERE dataName = 'USERS' ) a
			--GROUP BY  JSON_VALUE(a.Value, '$.id')
			where   dbo.fn_removeAlpha(JSON_VALUE(a.Value, '$.id')) > @minID
			--reset url
			SELECT @URL = [url]
			FROM Odata_json
			WHERE dataName = @dataname
		END
	END 
	ELSE
	BEGIN
		SET @response  =  [dbo].GETWithHeader(@URL, 'Authorization', @accessToken)

		SELECT @jsonData = [value] 
		FROM OPENJSON(@response)
		WHERE [KEY]  = 'value'
		print @jsonData
		--SET @jsonData = JSON_MODIFY(@jsonData,'$.value[0].id',1)

	--	SET @jsonData = JSON_MODIFY(@jsonData, '$.value[0].id', JSON_QUERY(N'{"myID": 3, "name": "Three"}'))

		print @jsonData
		UPDATE Odata_json SET jsonValue = @jsonData WHERE dataName = @dataname

		IF @sql IS NOT NULL 
		BEGIN
			exec sp_executesql @sql
		END 
	END

	select * from Odata_json


GO
-- =============================================
-- Author:             <Author,,Name>
-- Create date: <Create Date,,>
-- Description:        <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[DYN-TaskActionMailingList] 
        -- Add the parameters for the stored procedure here
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
        SET NOCOUNT ON;


	select c.[Name] as [DynamicLabel], c.[CRef] as [DynamicValue] 
	from [ARM_CORE]..[A_Collection] c 
	LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc on c.CollectionClassID = cc.CollectionClassID 
	where cc.CLASSREF = '_MailingLists' and isnull(c.CREF,'') <> ''




END

GO
-- =============================================
-- Author:        John Reed - Updated Andy Bex
-- alter date:  21-11-2022
-- Description:    Generates table for History Charts
-- =============================================

CREATE PROCEDURE [dbo].[ReportData-Class-Options]
    @ClassREF nvarchar(255),  --Pass the ClassID
    @FromDate date = '1900-01-01', -- Start of Report
    @CollectionNames nvarchar(255) = '' --Pass a list of Collection Names to include

AS
BEGIN

--DECLARE @ClassREF nvarchar(255)
--DECLARE    @FromDate date
--DECLARE    @CollectionNames nvarchar(255)

--set @ClassREF = 'Tombstone'
--set @FromDate = '1900-01-01'
--set @CollectionNames = ''

    SET NOCOUNT ON;
    DECLARE @ClassPivot [ReportData]

--	select * from @ClassPivot

--Get relevant data
-- Ignore is always excluded
IF  @CollectionNames = ''   
BEGIN
    Insert into @ClassPivot 
	Select distinct r.[ReportDate], r.[ReportField],r.[ReportValue]
	from ARM_CORE..A_Collection c
    left join [ARM_CORE].[dbo].[A_ReportData] r on r.ReportField = c.[Name]
    left join ARM_CORE..A_CollectionClass cc on cc.CollectionClassID = c.CollectionClassID
    where r.[ReportName] = @ClassREF and cc.CLASSREF = @ClassREF and r.[ReportDate] >= @FromDate and c.Ignore <> 1
END
ELSE   
BEGIN
    Insert into @ClassPivot 
	Select distinct r.[ReportDate],r.[ReportField],r.[ReportValue] 
	from ARM_CORE..A_Collection c
    left join [ARM_CORE].[dbo].[A_ReportData] r on r.ReportField = c.[Name]
    left join ARM_CORE..A_CollectionClass cc on cc.CollectionClassID = c.CollectionClassID
    where r.[ReportName] = @ClassREF and cc.CLASSREF = @ClassREF and r.[ReportDate] >= @FromDate and c.Ignore <> 1 and c.[Name] in (@CollectionNames)
END

DECLARE @Columns VARCHAR(MAX)

SELECT @columns = STUFF(( SELECT  distinct TOP 100 PERCENT '],[' + cast(c.[Name] as varchar) FROM [ARM_CORE]..[A_Collection] c
LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc on cc.CollectionClassID = c.CollectionClassID where cc.CLASSREF = @ClassRef and c.Ignore <> 1
-- ORDER BY c.[Order]
FOR XML PATH('')), 1, 2, '') + ']'

DECLARE @query NVARCHAR(Max)
DECLARE @params NVARCHAR(Max)

-- select * from @ClassPivot
-- select @columns

SET @query = 'SELECT * from @ClassPivot  t PIVOT(SUM(ReportValue) FOR t.[ReportField] IN (' + @columns + ')) AS p '
    
--EXECUTE(@query)

   SET @params = N'@ClassPivot [ReportData] readonly'

    EXEC sp_executesql @query, @params, @ClassPivot = @ClassPivot
    
END


-- EXEC [ReportData-Class-Options] 'Tombstone'
GO


CREATE proc [dbo].[sp_select_json_odata] (@oid INT, @cols VARCHAR(MAX) = NUll)
AS
DECLARE @sql VARCHAR(MAX), 
		@keys  VARCHAR(MAX), 
		@valueList  VARCHAR(MAX), 
		@valueWithList  VARCHAR(MAX), 
		@keyValue VARCHAR(50), 
		@subKey VARCHAR(30),
		@subWithKey VARCHAR(30), 
		@jsonDataStart VARCHAR(20)
		


IF @jsonDataStart IS NULL
	SET @jsonDataStart = ''

SET @valueList = ''
SET @valueWithList = ''

IF @cols IS NULL
BEGIN
	SELECT @keys = keys from Odata_json where oid = @oid
END
ELSE
BEGIN
	SET @keys = @cols  
END

SELECT  @jsonDataStart = jsonDataStart from Odata_json where oid = @oid

WHILE len(@keys) > 0
BEGIN
	SET @keyValue =  LEFT(@keys, charindex(',', @keys+',')-1)
 -- print @keyvalue
	IF CHARINDEX( '.', @keyValue) > 0
	BEGIN
		SET @subKey =  TRIM(LEFT(@keyValue, CHARINDEX('.', @keyValue)-1))
		SET @subWithKey = TRIM(RIGHT(@keyValue, CHARINDEX('.', REVERSE(@keyValue))-1))
		SET @valueWithList = @valueWithList + ', ' + @subWithKey + ' nvarchar(10) ''$.' + @subWithKey + ''''
	END
	ELSE
	BEGIN
		SET @valueList = @valueList + ', JSON_VALUE(a.Value, ''$.' + TRIM(@keyValue) + ''') AS ' + @keyValue 
	END	
	SET @keys = stuff(@keys, 1, charindex(',', @keys+','), '')
END
SET @valueList = RIGHT(@valueList, LEN(@valueList) - 1) 


IF @subKey IS NULL 
BEGIN
	SET @sql = CONCAT('SELECT ' , @valueList  ,
					' FROM (
						SELECT x.value 
						FROM Odata_json AS c
						CROSS APPLY OPENJSON(JSON_QUERY(jsonValue, ''$', @jsonDataStart ,''')) AS x 
						 where oID = ' , @oid , ' ) a'
						 )
						 print @jsonDataStart
END
ELSE
BEGIN
		SET @valueWithList = RIGHT(@valueWithList, LEN(@valueWithList) - 1) 
		SET @sql = CONCAT('SELECT ' , @valueList  , ', y.*
					 FROM  Odata_json AS c
						CROSS APPLY OPENJSON(JSON_QUERY(jsonValue, ''$'')) AS a 
						CROSS APPLY OPENJSON(a.[value],''$.' , @subKey , ''')
						WITH (
						', @valueWithList ,'
						) AS y 
						 where oID = ' , @oid )
END

print @sql 

exec  sp_sqlexec @sql


GO

CREATE proc [dbo].[sp_FileUpload]( @filePath VARCHAR(255), 
							@table  VARCHAR(255),
							@recordID VARCHAR(255), 
							@authUser VARCHAR(255)
							)
as 

BEGIN
DECLARE @fileName VARCHAR(255), 
		@sql NVARCHAR(MAX), 
		@extension varchar(10)


SET @fileName = right(@filePath, CHARINDEX('\', reverse(@filePath))-1)

SET @extension  = right(@filePath, CHARINDEX('.', reverse(@filePath))-1)


SET @sql = CONCAT('INSERT INTO a_BinaryStore ([name], [mybinary], extension,  [table], recordID, author, dateadded)
		SELECT ''', @fileName , ''',  (SELECT * FROM OPENROWSET(
            BULK ''' , @filePath , ''', SINGLE_bLOB) as x ), ''' , @extension , ''',  ''' , @table  , ''', ''' , @recordID , ''',  ''' , @authuser , ''',getdate()')

exec sp_executesql @sql

end 


GO
CREATE proc [dbo].[sp_CollectionClassCreator2] (@classID int = NULL, 
												@CreatorName NVARCHAR(255), 
												@Desc NVARCHAR(255)  = '',
												@collectionID NVARCHAR(13) = NULL )
as
BEGIN

	DECLARE @insertA_CollectionClassSQL NVARCHAR(MAX),
			@insertA_CollectionSQL NVARCHAR(MAX),
			@insertSys_EventSQL NVARCHAR(MAX),
			@insertNotificationTemplateSQL NVARCHAR(MAX),
			@fullInsertSQL NVARCHAR(MAX), 
			@EventInsertSQL NVARCHAR(MAX),
			@insertbuttonSQL NVARCHAR(MAX),
			@insertA_BitConditionSQL NVARCHAR(MAX),
			@tables NVARCHAR(100),
			@tableName NVARCHAR(50),
			@tableID NVARCHAR(50),
			@colsA_CollectionClass NVARCHAR(MAX),
			@colsbutton NVARCHAR(MAX),
			@colsA_BitCondition NVARCHAR(MAX),
			@colsA_Collection NVARCHAR(MAX),
			@colsSys_EventClass NVARCHAR(MAX),
			@colsNotificationTemplate NVARCHAR(MAX),
			@params NVARCHAR(255),
			@minCollectionID INT,
			@maxCollectionID INT, 
			@minEventID INT,
			@maxEventID INT, 
			@SQLValues NVARCHAR(MAX),
			@x NVARCHAR(MAX),  
			@collectionClassID INT,
		 
			@outputSQL NVARCHAR(MAX), 
			@SQL NVARCHAR(MAX), 
			@whereSQL NVARCHAR(100), 
			@getScopeID NVARCHAR(20),
			@templateID INT, 
			@templateName NVARCHAR(50)

	SET NOCOUNT ON
	--SET @classID = 45
	SET @outputSQL = ''
	SET @fullInsertSQL = ''
	SET @outputSQL = 'DECLARE @CollectionClassID INT, @collectionID INT, @DefaultCollectionID INT, @templateID INT, @eventID INT' + CHAR(13)  + CHAR(10)

	--
	IF @collectionID IS NULL 
	BEGIN
		SET @tableName =   'A_CollectionClass'
		SET @collectionClassID = (SELECT CollectionClassID FROM A_CollectionClass WHERE CollectionClassID = @classID)
		SET @insertA_CollectionClassSQL ='INSERT INTO ' + @tablename +' (' +
									STUFF ((
									SELECT ', ' + QUOTENAME([name])
									FROM sys.columns 
									WHERE	OBJECT_NAME(object_id) =  @tableName
											AND is_identity = 0
									ORDER BY column_id
									FOR XML PATH('')), 1, 1, '') + ')' + CHAR(13);

		SET @colsA_CollectionClass	=   STUFF((SELECT ', CONCAT('''''''',REPLACE(' + QUOTENAME([name]) + ','''''''',''''''''''''),'''''','')'
								FROM sys.columns   
								WHERE	OBJECT_NAME(object_id) = @tableName
										AND is_identity = 0
								ORDER BY column_id
								FOR XML PATH('')), 1, 1, '');


		SET @SQL = CONCAT('SET @x = STUFF((select '''''''',' , @colsA_CollectionClass,  ' FROM (SELECT * FROM ' , @tableName ,@whereSQL , ') as a WHERE collectionclassID = ' , @collectionClassID , ' FOR XML PATH('''')), 1, 1, '''')')
		SET @params = '@x NVARCHAR(MAX) OUTPUT';
	
		EXEC sp_executesql @SQL, @params, @x = @x OUTPUT;
		SET @x = REPLACE(@x, ''''',','NULL,')
		SET @outputSQL = @outputSQL + @insertA_CollectionClassSQL +  ' VALUES(' + SUBSTRING(@x,1, LEN(@x)-1) + ')' + CHAR(13) + 'SET @collectionClassID = scope_identity()'	 + CHAR(13) 	
	print @outputSQL
	END

	
	DECLARE @collectionIDs TABLE(
	collectionID INT)


	-------------------------------A_Collection---------------------------------------------------------------
		--when we want just a collection without the collectionclass
	IF @collectionID IS NULL
	BEGIN
		INSERT INTO @collectionIDs
		SELECT collectionID FROM A_Collection WHERE CollectionClassID = @collectionClassID ORDER BY collectionID
	END
	ELSE
	BEGIN
		INSERT INTO @collectionIDs
		SELECT collectionID FROM A_Collection WHERE CollectionID = @collectionID ORDER BY collectionID

		SELECT @CollectionClassID = collectionClassID FROM A_Collection WHERE CollectionID = @collectionID 
	END
	SET @tableName = 'A_Collection'
	SET @whereSQL = CONCAT(' WHERE collectionClassID = ' , @collectionClassID)
	SET @insertA_CollectionSQL ='INSERT INTO ' + @tablename +' (' +
								STUFF ((
								SELECT ', ' + QUOTENAME([name])
								FROM sys.columns 
								WHERE	OBJECT_NAME(object_id) = @tableName
										AND is_identity = 0
								ORDER BY column_id
								FOR XML PATH('')), 1, 1, '') + ')' + CHAR(13);

	SET @colsA_Collection	=   STUFF((SELECT ', CONCAT('''''''',REPLACE(' + QUOTENAME([name]) + ','''''''',''''''''''''),'''''','')'
							FROM sys.columns   
							WHERE	OBJECT_NAME(object_id) = @tableName
									AND is_identity = 0
							ORDER BY column_id
							FOR XML PATH('')), 1, 1, '');



	SELECT @minCollectionID = MIN(collectionID), @maxCollectionID = MAX(collectionID) FROM @collectionIDs


	WHILE @minCollectionID <= @maxCollectionID 
	BEGIN  
		SET @SQL =  CONCAT('SET @x = STUFF((select '''''''',' ,  REPLACE(@colsA_Collection,'[CollectionClassID]','''@CollectionClassID''') , ' FROM (SELECT * FROM ' , @tableName  , ') as a WHERE collectionid = ' , @minCollectionID , ' FOR XML PATH('''')), 1, 1, '''')')
		SET @params = '@x NVARCHAR(MAX) OUTPUT'
		EXEC sp_executesql @SQL, @params, @x = @x OUTPUT
		SET @x = REPLACE(@x, '''@CollectionClassID''', '@CollectionClassID')
		SET @x = REPLACE(@x, ''''',','NULL,')
		SET @fullInsertSQL = @fullInsertSQL + @insertA_CollectionSQL +  ' VALUES(' + SUBSTRING(@x,1, LEN(@x)-1) + ')'  + CHAR(13) + 'SET @collectionID = scope_identity()'	 + CHAR(13) +
						+ 'SELECT @DefaultCollectionID = DefaultCollectionID FROM  A_CollectionClass where CollectionClassID = @collectionClassID
						IF NOT EXISTS (SELECT * from A_Collection WHERE CollectionID = @DefaultCollectionID) UPDATE A_CollectionClass SET  DefaultCollectionID = @collectionID WHERE CollectionClassID = @collectionClassID
						'
		SET @collectionID = '@collectionID'
	----------------------------------Sys_Event-------------------------------
		IF (SELECT COUNT(*) FROM Sys_Event WHERE CollectionID = @minCollectionID) > 0
		BEGIN
	
			SET @tableName = 'Sys_Event'
			SET @whereSQL = CONCAT(' WHERE collectionID = ' , @minCollectionID)
			SET @insertSys_EventSQL ='INSERT INTO ' + @tablename +' (' +
								STUFF ((
								SELECT ', ' + QUOTENAME([name])
								FROM sys.columns 
								WHERE	OBJECT_NAME(object_id) = @tableName
										AND is_identity = 0
								ORDER BY column_id
								FOR XML PATH('')), 1, 1, '') + ')' + CHAR(13);

			SET @colsSys_EventClass	=   STUFF((SELECT ', CONCAT('''''''',REPLACE(' + QUOTENAME([name]) + ','''''''',''''''''''''),'''''','')'
							FROM sys.columns   
							WHERE	OBJECT_NAME(object_id) = @tableName
									AND is_identity = 0
							ORDER BY column_id
							FOR XML PATH('')), 1, 1, '');
			DECLARE @eventIDs TABLE(
					eventID INT)

			INSERT INTO @eventIDs
			select EventID FROM Sys_Event WHERE CollectionID = @minCollectionID ORDER BY EventID

			SELECT @minEventID = MIN(EventID), @maxEventID = MAX(EventID) FROM @eventIDs
		
			WHILE (@minEventID <= @maxEventID)
			BEGIN
				--SET @colsSys_EventClass =  REPLACE(@colsSys_EventClass,'[CollectionID]','@collectionID')
				SET @SQL = CONCAT('SET @x = STUFF((select '''''''',' ,REPLACE(@colsSys_EventClass,'[CollectionID]','''@collectionID''') , ' FROM (SELECT * FROM ', @tableName  , ') as a WHERE eventID = ' , @mineventID , ' FOR XML PATH('''')), 1, 1, '''')');
			
				SET @params = '@x NVARCHAR(MAX) OUTPUT'
				EXEC sp_executesql @SQL, @params, @x = @x OUTPUT
				SET @x = REPLACE(@x, '''@collectionID''', '@collectionID')
				SET @x = REPLACE(@x, ''''',','NULL,')
				SET  @fullInsertSQL = @fullInsertSQL + @insertSys_EventSQL +  ' VALUES(' + SUBSTRING(@x,1, LEN(@x)-1) + ')'  + CHAR(13)
					+	'SELECT @eventID =  scope_identity()';
			
	------------------------------NotificationTemplate------------------------------
				IF (SELECT COUNT(*) FROM Sys_Event WHERE EventID = @minEventID and TemplateID is not null) > 0 
				BEGIN
					SET @templateID = (SELECT TemplateID FROM Sys_Event WHERE EventID = @minEventID)
					SET @tableName = 'NotificationTemplate'
					SET @templateName = (SELECT [Label] from NotificationTemplate where TemplateID = @templateID)
			
					SET @insertNotificationTemplateSQL ='INSERT INTO ' + @tablename +' (' +
								STUFF ((
								SELECT ', ' + QUOTENAME([name])
								FROM sys.columns 
								WHERE	OBJECT_NAME(object_id) = @tableName
										AND is_identity = 0
								ORDER BY column_id
								FOR XML PATH('')), 1, 1, '') + ')' + CHAR(13);

					SET @colsNotificationTemplate	=   STUFF((SELECT ', CONCAT('''''''',REPLACE(' + QUOTENAME([name]) + ','''''''',''''''''''''),'''''','')'
							FROM sys.columns   
							WHERE	OBJECT_NAME(object_id) = @tableName
									AND is_identity = 0
							ORDER BY column_id
							FOR XML PATH('')), 1, 1, '');
				
					SET @SQL = CONCAT('SET @x = STUFF((select '''''''',' , @colsNotificationTemplate , ' FROM (SELECT * FROM ' , @tableName ,' WHERE templateID = ' , @templateID , ') as a ' , ' FOR XML PATH('''')), 1, 1, '''')')
					SET @params = '@x NVARCHAR(MAX) OUTPUT'
					EXEC sp_executesql @SQL, @params, @x = @x OUTPUT
					SET @x = REPLACE(@x, ''''',','NULL,')
					SET @fullInsertSQL = @fullInsertSQL + ' IF (SELECT COUNT(*) FROM NotificationTemplate WHERE [label] = ''' +  @templateName + ''') = 0 
															BEGIN
															' + @insertNotificationTemplateSQL +  ' VALUES(' + SUBSTRING(@x,1, LEN(@x)-1) + ')'  + CHAR(13) +
															' SELECT @templateID =  scope_identity()
															 END
															 ELSE
															 BEGIN
															  SELECT @templateID = templateID  FROM NotificationTemplate WHERE [label] = ''' +  @templateName + '''
															 END
									
														IF NOT EXISTS (SELECT * from sys_event WHERE templateID = @templateID) UPDATE sys_event SET  templateID = @templateID WHERE eventID = @eventID
														'
					SET @tableName = 'Sys_Event'
				END
			
				SELECT @minEventID = MIN(eventID) FROM @eventIDs
				WHERE eventID > @minEventID 
			END
			SET @tableName = 'A_Collection'
			delete from @eventIDs
		END
	
	
	----------------------------------button-------------------------------
		IF (SELECT COUNT(*) FROM Button WHERE context = 'Collection' AND contextID = @minCollectionID) > 0
		BEGIN
			SET @tableName = 'button'
			SET @whereSQL = CONCAT(' WHERE context = ''Collection'' AND contextID = ' , @minCollectionID)
			SET @insertbuttonSQL ='INSERT INTO ' + @tablename +' (' +
								STUFF ((
								SELECT ', ' + QUOTENAME([name])
								FROM sys.columns 
								WHERE	OBJECT_NAME(object_id) = @tableName
										AND is_identity = 0
								ORDER BY column_id
								FOR XML PATH('')), 1, 1, '') + ')' + CHAR(13);

			SET @colsbutton	=   STUFF((SELECT ', CONCAT('''''''',REPLACE(' + QUOTENAME([name]) + ','''''''',''''''''''''),'''''','')'
							FROM sys.columns   
							WHERE	OBJECT_NAME(object_id) = @tableName
									AND is_identity = 0
							ORDER BY column_id
							FOR XML PATH('')), 1, 1, '');
	

			INSERT INTO @eventIDs
			select buttonID FROM button WHERE context = 'Collection' AND contextID = @minCollectionID ORDER BY ButtonID

			SELECT @minEventID = MIN(EventID), @maxEventID = MAX(EventID) FROM @eventIDs
		
			WHILE (@minEventID <= @maxEventID)
			BEGIN
		
				SET @SQL = CONCAT('SET @x = STUFF((select '''''''',' ,REPLACE(@colsbutton,'[contextID]','''@collectionID''') , ' FROM (SELECT * FROM ', @tableName  , ') as a WHERE context = ''Collection'' AND contextID =  ' , @minCollectionID , ' FOR XML PATH('''')), 1, 1, '''')');
			
				SET @params = '@x NVARCHAR(MAX) OUTPUT'
				EXEC sp_executesql @SQL, @params, @x = @x OUTPUT
				SET @x = REPLACE(@x, ''''',','NULL,')
				SET @x = REPLACE(@x, '''@collectionID''', '@collectionID')
				SET  @fullInsertSQL = @fullInsertSQL + @insertbuttonSQL +  ' VALUES(' + SUBSTRING(@x,1, LEN(@x)-1) + ')'  + CHAR(13);
		
				SELECT @minEventID = MIN(eventID) FROM @eventIDs
				WHERE eventID > @minEventID 
			END
			SET @tableName = 'A_Collection'
			delete from @eventIDs
		END






	----------------------------------A_BitCondition-------------------------------
		IF (SELECT COUNT(*) FROM A_BitCondition WHERE ConditionCID = @minCollectionID) > 0
		BEGIN
			SET @tableName = 'A_BitCondition'
			SET @whereSQL = CONCAT(' WHERE ConditionCID = ' , @minCollectionID)
			SET @insertA_BitConditionSQL ='INSERT INTO ' + @tablename +' (' +
								STUFF ((
								SELECT ', ' + QUOTENAME([name])
								FROM sys.columns 
								WHERE	OBJECT_NAME(object_id) = @tableName
										AND is_identity = 0
								ORDER BY column_id
								FOR XML PATH('')), 1, 1, '') + ')' + CHAR(13);

			SET @colsA_BitCondition	=   STUFF((SELECT ', CONCAT('''''''',REPLACE(' + QUOTENAME([name]) + ','''''''',''''''''''''),'''''','')'
							FROM sys.columns   
							WHERE	OBJECT_NAME(object_id) = @tableName
									AND is_identity = 0
							ORDER BY column_id
							FOR XML PATH('')), 1, 1, '');
	

			INSERT INTO @eventIDs
			select BitConditionID FROM A_BitCondition WHERE ConditionCID = @minCollectionID ORDER BY BitConditionID

			SELECT @minEventID = MIN(EventID), @maxEventID = MAX(EventID) FROM @eventIDs
		
			WHILE (@minEventID <= @maxEventID)
			BEGIN
	
				--SET @colsSys_EventClass =  REPLACE(@colsSys_EventClass,'[CollectionID]','@collectionID')
				SET @SQL = CONCAT('SET @x = STUFF((select '''''''',' ,REPLACE(@colsA_BitCondition,'[ConditionCID]','''@collectionID''') , ' FROM (SELECT * FROM ', @tableName  , ' WHERE conditionCID =  ' , @minCollectionID , ') as a FOR XML PATH('''')), 1, 1, '''')');

				SET @params = '@x NVARCHAR(MAX) OUTPUT'
				EXEC sp_executesql @SQL, @params, @x = @x OUTPUT
				SET @x = REPLACE(@x, '''@collectionID''', '@collectionID')
				SET @x = REPLACE(@x, ''''',','NULL,')
				SET  @fullInsertSQL = @fullInsertSQL + @insertA_BitConditionSQL +  ' VALUES(' + SUBSTRING(@x,1, LEN(@x)-1) + ')'  + CHAR(13);
		
				SELECT @minEventID = MIN(eventID) FROM @eventIDs
				WHERE eventID > @minEventID 
			END
			SET @tableName = 'A_Collection'
			delete from @eventIDs
		END



		SELECT @minCollectionID = MIN(collectionID) FROM @collectionIDs
		WHERE collectionID > @minCollectionID 		
	END
	--print  @fullInsertSQL
	SET @outputSQL = @outputSQL + @fullInsertSQL

	IF (SELECT COUNT(*) FROM [Sys_Creator] WHERE [Name] = @CreatorName) = 0
	BEGIN
		INSERT INTO [Sys_Creator]([NAME], [Description], [SQL], [Group], Active)
		VALUES(@CreatorName, @Desc, @outputSQL, 'Collection', 1)
	END
	print @outputSQL
END



GO
CREATE proc sp_CollectionClassCreator (@className VARCHAR(255),@CreatorName NVARCHAR(255), @Desc NVARCHAR(255)  = '' )
as
BEGIN
	DECLARE @insertA_CollectionClassSQL VARCHAR(MAX),
			@insertA_CollectionSQL VARCHAR(MAX),
			@insertSys_EventSQL VARCHAR(MAX),
			@insertNotificationTemplateSQL VARCHAR(MAX),
			@fullInsertSQL VARCHAR(MAX), 
			@EventInsertSQL VARCHAR(MAX),
			@insertbuttonSQL VARCHAR(MAX),
			@insertA_BitConditionSQL VARCHAR(MAX),
			@tables VARCHAR(100),
			@tableName VARCHAR(50),
			@tableID varchar(50),
			@colsA_CollectionClass VARCHAR(MAX),
			@colsbutton VARCHAR(MAX),
			@colsA_BitCondition VARCHAR(MAX),
			@colsA_Collection VARCHAR(MAX),
			@colsSys_EventClass VARCHAR(MAX),
			@colsNotificationTemplate VARCHAR(MAX),
			@params NVARCHAR(255),
			@minCollectionID INT,
			@maxCollectionID INT, 
			@minEventID INT,
			@maxEventID INT, 
			@SQLValues NVARCHAR(MAX),
			@x VARCHAR(MAX),  
			@collectionClassID INT,
			@collectionID VARCHAR(13), 
			@outputSQL NVARCHAR(MAX), 
			@SQL NVARCHAR(MAX), 
			@whereSQL NVARCHAR(100), 
			@getScopeID NVARCHAR(20),
			@templateID INT, 
			@templateName VARCHAR(50)

	SET NOCOUNT ON
	--SET @className = 'Demo Class'
	SET @outputSQL = ''
	SET @fullInsertSQL = ''
	SET @outputSQL = 'DECLARE @CollectionClassID INT, @collectionID INT' + CHAR(13)

	--
	SET @tableName =   'A_CollectionClass'
	SET @collectionClassID = (SELECT CollectionClassID FROM A_CollectionClass WHERE [Name] = @className)
	SET @insertA_CollectionClassSQL ='INSERT INTO ' + @tablename +' (' +
								STUFF ((
								SELECT ', ' + QUOTENAME([name])
								FROM sys.columns 
								WHERE	OBJECT_NAME(object_id) =  @tableName
										AND is_identity = 0
								ORDER BY column_id
								FOR XML PATH('')), 1, 1, '') + ')' + CHAR(13);

	SET @colsA_CollectionClass	=   STUFF((SELECT ', CONCAT('''''''',REPLACE(' + QUOTENAME([name]) + ','''''''',''''''''''''),'''''','')'
							FROM sys.columns   
							WHERE	OBJECT_NAME(object_id) = @tableName
									AND is_identity = 0
							ORDER BY column_id
							FOR XML PATH('')), 1, 1, '');


	SET @SQL = CONCAT('SET @x = STUFF((select '''''''',' , @colsA_CollectionClass , ' FROM (SELECT * FROM ' , @tableName ,@whereSQL , ') as a WHERE collectionclassID = ' , @collectionClassID , ' FOR XML PATH('''')), 1, 1, '''')')
	SET @params = N'@x VARCHAR(MAX) OUTPUT';
	EXEC sp_executesql @SQL, @params, @x = @x OUTPUT;
	SET @outputSQL = @outputSQL + @insertA_CollectionClassSQL +  ' VALUES(' + SUBSTRING(@x,1, LEN(@x)-1) + ')' + CHAR(13) + 'SET @collectionClassID = scope_identity()'	 + CHAR(13) 	

	-------------------------------A_Collection---------------------------------------------------------------

	SET @tableName = 'A_Collection'
	SET @whereSQL = CONCAT(' WHERE collectionClassID = ' , @collectionClassID)
	SET @insertA_CollectionSQL ='INSERT INTO ' + @tablename +' (' +
								STUFF ((
								SELECT ', ' + QUOTENAME([name])
								FROM sys.columns 
								WHERE	OBJECT_NAME(object_id) = @tableName
										AND is_identity = 0
								ORDER BY column_id
								FOR XML PATH('')), 1, 1, '') + ')' + CHAR(13);

	SET @colsA_Collection	=   STUFF((SELECT ', CONCAT('''''''',REPLACE(' + QUOTENAME([name]) + ','''''''',''''''''''''),'''''','')'
							FROM sys.columns   
							WHERE	OBJECT_NAME(object_id) = @tableName
									AND is_identity = 0
							ORDER BY column_id
							FOR XML PATH('')), 1, 1, '');

	DECLARE @collectionIDs TABLE(
	collectionID INT)

	INSERT INTO @collectionIDs
	select collectionID FROM A_Collection WHERE CollectionClassID = @collectionClassID ORDER BY collectionID

	SELECT @minCollectionID = MIN(collectionID), @maxCollectionID = MAX(collectionID) FROM @collectionIDs

	WHILE @minCollectionID <= @maxCollectionID 
	BEGIN
		SET @SQL =  CONCAT('SET @x = STUFF((select '''''''',' ,  REPLACE(@colsA_Collection,'[CollectionClassID]','''@CollectionClassID''') , ' FROM (SELECT * FROM ' , @tableName  , ') as a WHERE collectionid = ' , @minCollectionID , ' FOR XML PATH('''')), 1, 1, '''')')
		SET @params = N'@x VARCHAR(MAX) OUTPUT'
		EXEC sp_executesql @SQL, @params, @x = @x OUTPUT
		SET @x = REPLACE(@x, '''@CollectionClassID''', '@CollectionClassID')
		SET @fullInsertSQL = @fullInsertSQL + @insertA_CollectionSQL +  ' VALUES(' + SUBSTRING(@x,1, LEN(@x)-1) + ')'  + CHAR(13) + 'SET @collectionID = scope_identity()'	 + CHAR(13) 	
		SET @collectionID = '@collectionID'
	----------------------------------Sys_Event-------------------------------
		IF (SELECT COUNT(*) FROM Sys_Event WHERE CollectionID = @minCollectionID) > 0
		BEGIN
	
			SET @tableName = 'Sys_Event'
			SET @whereSQL = CONCAT(' WHERE collectionID = ' , @minCollectionID)
			SET @insertSys_EventSQL ='INSERT INTO ' + @tablename +' (' +
								STUFF ((
								SELECT ', ' + QUOTENAME([name])
								FROM sys.columns 
								WHERE	OBJECT_NAME(object_id) = @tableName
										AND is_identity = 0
								ORDER BY column_id
								FOR XML PATH('')), 1, 1, '') + ')' + CHAR(13);

			SET @colsSys_EventClass	=   STUFF((SELECT ', CONCAT('''''''',REPLACE(' + QUOTENAME([name]) + ','''''''',''''''''''''),'''''','')'
							FROM sys.columns   
							WHERE	OBJECT_NAME(object_id) = @tableName
									AND is_identity = 0
							ORDER BY column_id
							FOR XML PATH('')), 1, 1, '');
			DECLARE @eventIDs TABLE(
					eventID INT)

			INSERT INTO @eventIDs
			select EventID FROM Sys_Event WHERE CollectionID = @minCollectionID ORDER BY EventID

			SELECT @minEventID = MIN(EventID), @maxEventID = MAX(EventID) FROM @eventIDs
		
			WHILE (@minEventID <= @maxEventID)
			BEGIN
				--SET @colsSys_EventClass =  REPLACE(@colsSys_EventClass,'[CollectionID]','@collectionID')
				SET @SQL = CONCAT('SET @x = STUFF((select '''''''',' ,REPLACE(@colsSys_EventClass,'[CollectionID]','''@collectionID''') , ' FROM (SELECT * FROM ', @tableName  , ') as a WHERE eventID = ' , @mineventID , ' FOR XML PATH('''')), 1, 1, '''')');
			
				SET @params = N'@x VARCHAR(MAX) OUTPUT'
				EXEC sp_executesql @SQL, @params, @x = @x OUTPUT
				SET @x = REPLACE(@x, '''@collectionID''', '@collectionID')
				SET  @fullInsertSQL = @fullInsertSQL + @insertSys_EventSQL +  ' VALUES(' + SUBSTRING(@x,1, LEN(@x)-1) + ')'  + CHAR(13);
			
	------------------------------NotificationTemplate------------------------------
				IF (SELECT COUNT(*) FROM Sys_Event WHERE EventID = @minEventID and TemplateID is not null) > 0 
				BEGIN
					SET @templateID = (SELECT TemplateID FROM Sys_Event WHERE EventID = @minEventID)
					SET @tableName = 'NotificationTemplate'
					SET @templateName = (SELECT [Label] from NotificationTemplate where TemplateID = @templateID)
			
					SET @insertNotificationTemplateSQL ='INSERT INTO ' + @tablename +' (' +
								STUFF ((
								SELECT ', ' + QUOTENAME([name])
								FROM sys.columns 
								WHERE	OBJECT_NAME(object_id) = @tableName
										AND is_identity = 0
								ORDER BY column_id
								FOR XML PATH('')), 1, 1, '') + ')' + CHAR(13);

					SET @colsNotificationTemplate	=   STUFF((SELECT ', CONCAT('''''''',REPLACE(' + QUOTENAME([name]) + ','''''''',''''''''''''),'''''','')'
							FROM sys.columns   
							WHERE	OBJECT_NAME(object_id) = @tableName
									AND is_identity = 0
							ORDER BY column_id
							FOR XML PATH('')), 1, 1, '');
				
					SET @SQL = CONCAT('SET @x = STUFF((select '''''''',' , @colsNotificationTemplate , ' FROM (SELECT * FROM ' , @tableName ,' WHERE templateID = ' , @templateID , ') as a ' , ' FOR XML PATH('''')), 1, 1, '''')')
					SET @params = N'@x VARCHAR(MAX) OUTPUT'
					EXEC sp_executesql @SQL, @params, @x = @x OUTPUT
					SET @fullInsertSQL = @fullInsertSQL + ' IF (SELECT COUNT(*) FROM NotificationTemplate WHERE [label] = ''' +  @templateName + ''') > 0 ' + @insertNotificationTemplateSQL +  ' VALUES(' + SUBSTRING(@x,1, LEN(@x)-1) + ')'  + CHAR(13) 	
					SET @tableName = 'Sys_Event'
				END
			
				SELECT @minEventID = MIN(eventID) FROM @eventIDs
				WHERE eventID > @minEventID 
			END
			SET @tableName = 'A_Collection'
			delete from @eventIDs
		END
	
	
	----------------------------------button-------------------------------
		IF (SELECT COUNT(*) FROM Button WHERE context = 'Collection' AND contextID = @minCollectionID) > 0
		BEGIN
			SET @tableName = 'button'
			SET @whereSQL = CONCAT(' WHERE context = ''Collection'' AND contextID = ' , @minCollectionID)
			SET @insertbuttonSQL ='INSERT INTO ' + @tablename +' (' +
								STUFF ((
								SELECT ', ' + QUOTENAME([name])
								FROM sys.columns 
								WHERE	OBJECT_NAME(object_id) = @tableName
										AND is_identity = 0
								ORDER BY column_id
								FOR XML PATH('')), 1, 1, '') + ')' + CHAR(13);

			SET @colsbutton	=   STUFF((SELECT ', CONCAT('''''''',REPLACE(' + QUOTENAME([name]) + ','''''''',''''''''''''),'''''','')'
							FROM sys.columns   
							WHERE	OBJECT_NAME(object_id) = @tableName
									AND is_identity = 0
							ORDER BY column_id
							FOR XML PATH('')), 1, 1, '');
	

			INSERT INTO @eventIDs
			select buttonID FROM button WHERE context = 'Collection' AND contextID = @minCollectionID ORDER BY ButtonID

			SELECT @minEventID = MIN(EventID), @maxEventID = MAX(EventID) FROM @eventIDs
		
			WHILE (@minEventID <= @maxEventID)
			BEGIN
		
				SET @SQL = CONCAT('SET @x = STUFF((select '''''''',' ,REPLACE(@colsbutton,'[contextID]','''@collectionID''') , ' FROM (SELECT * FROM ', @tableName  , ') as a WHERE context = ''Collection'' AND contextID =  ' , @minCollectionID , ' FOR XML PATH('''')), 1, 1, '''')');
			
				SET @params = N'@x VARCHAR(MAX) OUTPUT'
				EXEC sp_executesql @SQL, @params, @x = @x OUTPUT
				SET @x = REPLACE(@x, '''@collectionID''', '@collectionID')
				SET  @fullInsertSQL = @fullInsertSQL + @insertbuttonSQL +  ' VALUES(' + SUBSTRING(@x,1, LEN(@x)-1) + ')'  + CHAR(13);
		
				SELECT @minEventID = MIN(eventID) FROM @eventIDs
				WHERE eventID > @minEventID 
			END
			SET @tableName = 'A_Collection'
			delete from @eventIDs
		END






	----------------------------------A_BitCondition-------------------------------
		IF (SELECT COUNT(*) FROM A_BitCondition WHERE ConditionCID = @minCollectionID) > 0
		BEGIN
			SET @tableName = 'A_BitCondition'
			SET @whereSQL = CONCAT(' WHERE ConditionCID = ' , @minCollectionID)
			SET @insertA_BitConditionSQL ='INSERT INTO ' + @tablename +' (' +
								STUFF ((
								SELECT ', ' + QUOTENAME([name])
								FROM sys.columns 
								WHERE	OBJECT_NAME(object_id) = @tableName
										AND is_identity = 0
								ORDER BY column_id
								FOR XML PATH('')), 1, 1, '') + ')' + CHAR(13);

			SET @colsA_BitCondition	=   STUFF((SELECT ', CONCAT('''''''',REPLACE(' + QUOTENAME([name]) + ','''''''',''''''''''''),'''''','')'
							FROM sys.columns   
							WHERE	OBJECT_NAME(object_id) = @tableName
									AND is_identity = 0
							ORDER BY column_id
							FOR XML PATH('')), 1, 1, '');
	

			INSERT INTO @eventIDs
			select BitConditionID FROM A_BitCondition WHERE ConditionCID = @minCollectionID ORDER BY BitConditionID

			SELECT @minEventID = MIN(EventID), @maxEventID = MAX(EventID) FROM @eventIDs
		
			WHILE (@minEventID <= @maxEventID)
			BEGIN
	
				--SET @colsSys_EventClass =  REPLACE(@colsSys_EventClass,'[CollectionID]','@collectionID')
				SET @SQL = CONCAT('SET @x = STUFF((select '''''''',' ,REPLACE(@colsA_BitCondition,'[ConditionCID]','''@collectionID''') , ' FROM (SELECT * FROM ', @tableName  , ' WHERE conditionCID =  ' , @minCollectionID , ') as a FOR XML PATH('''')), 1, 1, '''')');

				SET @params = N'@x VARCHAR(MAX) OUTPUT'
				EXEC sp_executesql @SQL, @params, @x = @x OUTPUT
				SET @x = REPLACE(@x, '''@collectionID''', '@collectionID')
				SET  @fullInsertSQL = @fullInsertSQL + @insertA_BitConditionSQL +  ' VALUES(' + SUBSTRING(@x,1, LEN(@x)-1) + ')'  + CHAR(13);
		
				SELECT @minEventID = MIN(eventID) FROM @eventIDs
				WHERE eventID > @minEventID 
			END
			SET @tableName = 'A_Collection'
			delete from @eventIDs
		END



		SELECT @minCollectionID = MIN(collectionID) FROM @collectionIDs
		WHERE collectionID > @minCollectionID 		
	END
	--print  @fullInsertSQL
	SET @outputSQL = @outputSQL + @fullInsertSQL

	IF (SELECT COUNT(*) FROM Sys_Creator WHERE [Name] = @CreatorName) = 0
	BEGIN
		INSERT INTO Sys_Creator([NAME], [Description], [SQL], [Group], Active)
		VALUES(@CreatorName, @Desc, @outputSQL, 'Collection', 1)
	END
END


GO
-- =============================================
-- Author:             <Author,,Name>
-- ALTER date: <ALTER Date,,>
-- Description:        <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Apps-DistributionCounters]
        @AppID as nVarchar(255),
        @Scope as nVarchar(255) = 'AsIs'
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
    SET NOCOUNT ON;

    IF @Scope= 'AsIs'
        BEGIN
 
			SELECT distinct c.[Name] as [Site],c.CollectionID, c.CollectionClassID as ClassID, IsNull(xinstalls.Installs,0) as Installs, (select count(itemID) from A_COLLECTIONITEM i where i.CollectionID = c.CollectionID) as Items 
			from [ARM_CORE]..[A_Collection] c 
			LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc on cc.CollectionCLassID=c.CollectionClassID 
			LEFT JOIN (

						select c.[Name] as Site, count(s.AssetID) AS Installs
						from [ARM_CORE]..[A_Collection] c 
						LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc on cc.CollectionCLassID=c.CollectionClassID 
						LEFT JOIN [A_CollectionItem] i on i.CollectionID = c.CollectionID
						LEFT JOIN [Asset] a on a.AssetID = i.ItemID
						LEFT JOIN [AppAstAsIs] s on s.AssetID = a.AssetID    
						where s.ApplicationID = @AppID and cc.CLASSREF = 'SITES'
						Group by c.[Name] 
			) xinstalls on xinstalls.[Site] = c.[Name]
			where cc.CLASSREF = 'SITES' and IsNull(c.EndState,0) = 0
			order by c.[Name]

        END
        ELSE
        BEGIN
 
			SELECT distinct c.[Name] as [Site],c.CollectionID, c.CollectionClassID as ClassID, IsNull(xinstalls.Installs,0) as Installs, (select count(itemID) from A_COLLECTIONITEM i where i.CollectionID = c.CollectionID) as Items 
			from [ARM_CORE]..[A_Collection] c 
			LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc on cc.CollectionCLassID=c.CollectionClassID 
			LEFT JOIN (

						select c.[Name] as Site, count(s.AssetID) AS Installs
						from [ARM_CORE]..[A_Collection] c 
						LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc on cc.CollectionCLassID=c.CollectionClassID 
						LEFT JOIN [A_CollectionItem] i on i.CollectionID = c.CollectionID
						LEFT JOIN [Asset] a on a.AssetID = i.ItemID
						LEFT JOIN [AppAstToBe] s on s.AssetID = a.AssetID    
						where s.ApplicationID = @AppID and cc.CLASSREF = 'SITES'
						Group by c.[Name] 
			) xinstalls on xinstalls.[Site] = c.[Name]
			where cc.CLASSREF = 'SITES' and IsNull(c.EndState,0) = 0
			order by c.[Name]
               
        END
END
/****** Object:  StoredProcedure [dbo].[Apps-miniUAM]    Script Date: 17/09/2018 21:39:10 ******/
SET ANSI_NULLS ON

GO
CREATE PROCEDURE [dbo].[Read_a_PDFstore]
       @id INT = 0
AS
BEGIN
SET NOCOUNT ON;
SELECT a.PDFName, cast(N'' as xml).value('xs:base64Binary(sql:column("PDFFile"))', 'varchar(max)') AS PDFFile FROM dbo.a_PDFstore a WHERE a.AlertID = @id;
END


GO
create PROCEDURE [dbo].saveComment
        @table	nvarchar(50) ,
		@type	nvarchar(50) ,
		@ID	nvarchar(200) ,
		@comment nvarchar(MAX),
		@author varchar(200)
AS
BEGIN

    SET NOCOUNT ON;

	
	

		insert into A_CommentLog([Table], [Type], RecordID,Comment,Author) 
		values (@table, @type, @id, @comment,@author)
		


END


GO
CREATE PROCEDURE [dbo].[Insert_a_BinaryStore]
       @Name nvarchar(100) = '',
	   @Extension nvarchar(10) = '',
	   @ContentType nvarchar(100) = '',
	   @Base64 varchar(max) ,
	   @Sticky bit = 1
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	declare @str varchar(max); SET @str = @Base64;
	INSERT INTO dbo.a_BinaryStore([name], myBinary, DateAdded, ContentType, Extension, Sticky) VALUES ( @Name, cast(N'' as xml).value('xs:base64Binary(sql:variable("@str"))', 'varbinary(max)'), GETDATE(),@ContentType,@Extension, @Sticky )
 
	SELECT SCOPE_IDENTITY() AS [BinaryID]

END


GO
CREATE PROCEDURE [dbo].[Insert_a_PDFstore]
       @PdfE varchar(255) = '',
	   @Base64 VARCHAR(MAX),
	   @AlertID INT = null 
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.

	-- Komang.ba 10-13-2022 add insrt to AlertID

	SET NOCOUNT ON;

	declare @str varchar(max); SET @str = @Base64;
	INSERT INTO dbo.a_PDFstore VALUES ( @PdfE, cast(N'' as xml).value('xs:base64Binary(sql:variable("@str"))', 'varbinary(max)'), GETDATE(),@AlertID )
 

END

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SYS_EVENT_ACTION]
	@EVENTID int
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

-- Get items from Collection based on Day Trigger

	DECLARE @CID int;
    DECLARE @DAYTRIGGER nvarchar(100);
	DECLARE @SQL NVARCHAR(MAX);
    DECLARE @EVENTTYPE nvarchar(250);
    DECLARE @ACTIONID int;
    DECLARE @UserSet nvarchar(250);
	DECLARE @itemtype nvarchar(100);
    DECLARE @USERID nvarchar(250);
    DECLARE @CONDITIONID int;
	DECLARE @SendMail bit;
	DECLARE @mSQL NVARCHAR(MAX);
	DECLARE @params NVARCHAR(1000);
	DECLARE @CNAME NVARCHAR(255);

	DECLARE @GroupName nvarchar(250);



	SELECT distinct TOP 1  
		 @ACTIONID = a.ActionID 
		, @UserSet =  e.SetRef
		, @itemtype = c.[Type]
		, @CID = e.[CollectionID]
		, @EVENTTYPE = [EventType]
		, @SQL = e.[SQL]
		, @DAYTRIGGER = IsNull(e.[DayTrigger],'-1')
		, @CONDITIONID = e.ConditionCollectionID
		, @GroupName = IsNull(cc.[Name],'')
		, @Sendmail = IsNull(a.SendMail,0)
		, @CNAME = IsNull(c.[Name],'')
	FROM [ARM_CORE].[dbo].[Sys_Event] e 
	LEFT JOIN [A_Collection] c on c.CollectionID = e.CollectionID 
	LEFT JOIN [A_TaskAction] a on a.[ActionRef] = e.ActionRef
	LEFT JOIN [A_CollectionClass] cc on cc.CollectionClassID = c.CollectionClassID
	where [EventID] = @EVENTID


	-- All items that have hit the DayTrigger are made available in @TriggerItems
	-- TriggerItem is a User-Define Table Type that includes one field called itemID of type nvarchar(255)


	DECLARE @TriggerItems TriggerItem

	if @DAYTRIGGER = '' set @DAYTRIGGER = '-1'

	-- Capture those items that meet the Day Trigger criteria

	set @mSQL = N'select distinct i.itemID from [ARM_CORE]..[A_CollectionItem] i where i.CollectionID = ' + cast(@CID as nvarchar(20)) + ' and (DATEDIFF(day, i.TaggedOn, GETDATE()) in ( ' + @daytrigger + ') or -1 in ( ' + @daytrigger + ' )) ' 
	INSERT INTO @TriggerItems  EXEC sp_executesql @mSQL

	DECLARE @ItemUsers TABLE (
        [ItemID] nvarchar(255),
		[UserID] nvarchar(255)
    );

	select @mSQL = [SQLStatement] FROM [ARM_CORE].[dbo].[A_templateSQLStatement] where SetRef = @UserSet
	SET @params = N'@TriggerItems TriggerItem readonly'
	INSERT INTO @ItemUsers  EXEC sp_executesql @mSQL, @params, @TriggerItems = @TriggerItems


--	e.g. SELECT DISTINCT a.AssetID, a.UserID from [Asset] where AssetID in (select distinct itemID from @TriggerItems ) 






	-- The SQL can include references to @collectionID, @daytrigger and @TriggerItems.
	-- we can extend this to include others as need be.

--	SET @params = N'@collectionID INT, @daytrigger nvarchar(100), @TriggerItems TriggerItem readonly'
--	EXEC sp_executesql @SQL, @params, @collectionID = @CID, @daytrigger = @DAYTRIGGER, @TriggerItems = @TriggerItems

-- concat('EventAction',cast(@EVENTID as nvarchar(20)))
		
	IF EXISTS (SELECT * FROM [ARM_CORE]..[A_TaskAction] WHERE ActionID = @ActionID)
	BEGIN

		if @itemtype <> '' 
		BEGIN

			MERGE [ARM_CORE]..[A_Task] as Target using ( 
 				select  @ActionID as [ActionID], @GroupName as [Group], u.[ItemID], @ItemType as [ItemType], u.[UserID], @CONDITIONID as ConditionID, @CNAME as [CName]
				from @ItemUsers u
			 ) as Source 
			 ON (target.[ItemID] = source.[ItemID] and target.[ItemType] = source.[ItemType] and target.[UserID] = source.[UserID] and target.[ActionID] = source.[ActionID] and IsNull(target.[End],'1900-01-01') = '1900-01-01') 
			 WHEN NOT MATCHED BY TARGET THEN  
 				insert ([Group], [ItemID], [Itemtype], [UserID], [ActionID], [ConditionCollectionID], [CNAME]) Values (Source.[Group], Source.[ItemID], Source.[Itemtype], Source.[UserID], Source.[ActionID], Source.ConditionID, Source.[CName]);

--			if @primeCollectionID <> 0
--				EXEC [ARM_CORE]..[AddToCollection] '', @itemID, @primeCollectionID, 1 
		END

	END


END

GO
-- =============================================
-- Author:             <Author,,Name>
-- Create date: <Create Date,,>
-- Description:        <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[DYN-EventActionRef]
        -- Add the parameters for the stored procedure here
@CID int = 0
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
        SET NOCOUNT ON;
    -- Insert statements for procedure here

		select d.[ActionREF] as [DynamicValue], d.[ActionREF] as [DynamicLabel] 
		from  A_TaskAction d 
		LEFT JOIN  A_Collection c on c.CollectionID = @CID
		where (IsNull(d.[ActionRef],'') <> '' )
END

GO
-- =============================================
-- Author:             <Author,,Name>
-- Create date: <Create Date,,>
-- Description:        <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[DYN-EventSetRef]
        -- Add the parameters for the stored procedure here
@CID int = 0
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
        SET NOCOUNT ON;
    -- Insert statements for procedure here

		select d.[SetREF] as [DynamicValue], d.[SetREF] as [DynamicLabel] 
		from  A_templateSQLStatement d 
		LEFT JOIN  A_Collection c on c.CollectionID = @CID
		where (d.[TemplateType] like 'Action%' and d.ItemType = c.[Type] )
END

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE sp_ShrinkMe
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;


-- Truncate the log by changing the database recovery model to SIMPLE.
	ALTER DATABASE ARM_CORE
	SET RECOVERY SIMPLE;

-- Shrink the truncated log file to 1 MB.
	DBCC SHRINKFILE (ARM_CORE2022_log, 1);

-- Reset the database recovery model.
	ALTER DATABASE ARM_CORE
	SET RECOVERY FULL;

END

GO


CREATE PROCEDURE [dbo].[Alert-Post]
       @UserID NVARCHAR(255) = 'Not Set',
	   @Title NVARCHAR(255) = '',
	   @Message NVARCHAR(3000) = 'New Post',
	   @URL NVARCHAR(500) = '',
	   @Sticky BIT = 0,
	   @ExpireAfter INT = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.



	SET NOCOUNT ON;
	DECLARE @AlertID INT

	INSERT INTO [Alert]  ([UserID],[Title],[Message],[Sticky],[URL],[ExpireAfter])
	VALUES (@UserID,@Title,@Message,@Sticky,@URL,@ExpireAfter)
	
END

GO

CREATE PROCEDURE [dbo].[Alert-Check]
       @UserID nvarchar(255) = ''
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	DECLARE @DateDiff datetime

	set @DateDiff = getdate()


	delete from [Alert] 
	where [Read] = 1 and ( IsNull([Sticky],0) = 0 or (datediff(hour, CreatedOn, @DateDiff) >= IsNull(ExpireAfter,0) and IsNull(ExpireAfter,0) <> 0) )


	select top 5 x.*, case 
					when xDays > 0 then concat(cast(xDays as nvarchar(12)), ' day ago')
					when xHours > 0 then concat(cast(xHours as nvarchar(12)), ' hour ago')
					when xMinutes > 0 then concat(cast(xMinutes as nvarchar(12)), ' minutes ago')	
					when xSeconds > 0 then concat(cast(xSeconds as nvarchar(12)), ' seconds ago')	
				end as [Ago]
	from (
		select [AlertID]
			  ,[UserID]
			  ,[Auth_User]
			  ,[CreatedOn]
			  ,IsNull([Read],0) as [Read]
			  ,[Title]
			  ,[Message]
			  ,[Sticky]
			  ,IsNull([URL],'') as URL
			  ,[Info]
			  ,datediff(day, CreatedOn,@DateDiff) as xDays
			  ,datediff(hour, CreatedOn,@DateDiff) as xHours
			  ,datediff(minute, CreatedOn,@DateDiff) as xMinutes
			  ,datediff(second, CreatedOn,@DateDiff) as xSeconds
			  ,(select count(*) from [Alert] c where IsNull(c.[Read],1) = 0 and c.UserID = @UserID ) as NewAlerts
			  ,(select count(*) from [Alert] c where c.UserID = @UserID ) as TotalAlerts
		  FROM [ARM_CORE].[dbo].[Alert]
		  where UserID = @UserID
	  ) x 
	  order by [Read], [CreatedOn] desc



END

GO


CREATE PROCEDURE [dbo].[sp_sendSingleEmail] (@mailID INT)
AS
BEGIN
	DECLARE @body VARCHAR(MAX),
			@subject VARCHAR(100), 
			@date DATETIME, 
			@mailTo VARCHAR(255), 
			@mailFrom VARCHAR(255),
			@attachment VARCHAR(MAX),
			@cc VARCHAR(255), 
			@bcc VARCHAR(255),
			@ReadReceipt BIT, 
			@Important VARCHAR(10),
			@sent_mailitemid INT,
			@profile_name VARCHAR(50), 
			@maxID INT


	SET NOCOUNT ON
	--check for sent emails 
	UPDATE A_MailerLog
	SET A_MailerLog.sent_date = emails.sent_date 
	FROM A_MailerLog
	INNER JOIN msdb.dbo.sysmail_allitems emails
	ON A_MailerLog.mailer_sent_id = emails.mailitem_id
	WHERE emails.sent_status = 'sent'


	--check for failed emails 
	UPDATE A_MailerLog
	SET a_mailerlog.fail_description = mlog.description
	FROM A_MailerLog
	INNER JOIN msdb.dbo.sysmail_allitems failed
	ON A_MailerLog.mailer_sent_id = failed.mailitem_id
	INNER JOIN msdb.dbo.sysmail_event_log Mlog
	ON failed.mailitem_id = Mlog.mailitem_id
	WHERE failed.sent_status = 'failed'


	SELECT @profile_name = [dbo].fnGlobalProperty('MailProfileName')


	SELECT @mailTo = mailto,
			@mailFrom = mailfrom,
			@CC = cc, 
			@bcc = bcc, 
			@ReadReceipt = ReadReceipt,
			@Important =  IIF(Important = 1, 'High', 'Normal'),
			@subject = subject,
			@body = body,
			@attachment = attachment
	FROM A_MailerLog
	WHERE mailID = @mailID

	
	EXEC msdb.dbo.sp_send_dbmail @profile_name = @profile_name,
				@recipients = @mailTo,
				--@from_address = @mailFrom,
				@copy_recipients = @CC, 
				@blind_copy_recipients = @bcc,
				@subject = @Subject,
				@body = @body,
				@body_format = 'HTML',
				@importance = @Important,
				@mailitem_id = @sent_mailitemid OUTPUT,
				@file_attachments = @attachment;
				 

	--
	UPDATE A_MailerLog 
	SET mailer_sent_id = @sent_mailitemid
	WHERE mailID = @mailID

	
END

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SYS-GetMenu]
	@RoleID as int = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	select distinct iif(IsNull(m.[ParentID],0)=0,m.[Order],(select p.[Order] from [A_Menu] p where p.MenuID = m.ParentID)) as [ParentOrder], IsNull(c.[Order],0) as OrderBy, IsNull(c.[ParentID],0) as TheParentID, m.MenuID, m.[Name] as [MenuName]
		, IsNull(m.[URL],'') as [MenuAction], isNull(m.Icon,'') as Icon,c.[Name], IsNull(c.[URL],'') as [SubAction], c.[Active]
--		, m.URL,  fa.RoleID, m.Override as mo
--		, c.URL,  cfa.RoleID, c.Override as co

		from [ARM_CORE]..[A_Menu] m 
		LEFT JOIN [ARM_CORE]..[A_MenuAccess] a on a.MenuID = m.MenuID
		LEFT JOIN [A_Menu] c on c.ParentID = m.MenuID
		LEFT JOIN [ARM_CORE]..[A_File] f on  m.URL like f.FilePath+'%' 
		LEFT JOIN [ARM_CORE].[dbo].[A_FileAccess] fa on fa.FileID = f.FileID and (fa.RoleID = @RoleID or fa.RoleID = 0)
		LEFT JOIN [ARM_CORE]..[A_File] cf on  c.URL like cf.FilePath+'%' 
		LEFT JOIN [ARM_CORE].[dbo].[A_FileAccess] cfa on cfa.FileID = cf.FileID and (cfa.RoleID = @RoleID or cfa.RoleID = 0)

		where IsNull(m.ParentID,0) = 0 and IsNull(m.Active,0) = 1 and a.RoleID = @RoleID and ((NOT cfa.RoleID IS NULL or IsNull(c.override,0) = 1 ) or (NOT fa.RoleID IS NULL or IsNull(m.override,0) = 1 ) )
			and (IsNull(c.[ParentID],0) = 0 or IsNull(c.Active,0) = 1)
		order by [ParentOrder],[OrderBy], m.[Name]
END

GO
GO
--#################################################################################################
-- Real World DBA Toolkit Version 2019-08-01 Lowell Izaguirre lowell@stormrage.com
--#################################################################################################
-- USAGE: exec sp_GetDDL GMACT
--   or   exec sp_GetDDL 'bob.example'
--   or   exec sp_GetDDL '[schemaname].[tablename]'
--   or   exec sp_GetDDL #temp
--#################################################################################################
-- copyright 2004-2018 by Lowell Izaguirre scripts*at*stormrage.com all rights reserved.
--developer utility function added by Lowell, used in SQL Server Management Studio 
-- http://www.stormrage.com/SQLStuff/sp_GetDDL_Latest.txt
--Purpose: Script Any Table, Temp Table or Object(Procedure Function Synonym View Table Trigger)
--#################################################################################################
-- see the thread here for lots of details: http://www.sqlservercentral.com/Forums/Topic751783-566-7.aspx
-- You can use this however you like...this script is not rocket science, but it took a bit of work to create.
-- the only thing that I ask
-- is that if you adapt my procedure or make it better, to simply send me a copy of it,
-- so I can learn from the things you've enhanced.The feedback you give will be what makes
-- it worthwhile to me, and will be fed back to the SQL community.
-- add this to your toolbox of helpful scripts.
--#################################################################################################

-- JRA0	SQL returned via OUTPUT parameter
-- JRA1	Adapted to ignore "Disabled" triggers



-- V300  uses String concatination and sys.tables instead of a cursor
-- V301  enhanced 07/31/2009 to include extended properties definitions
-- V302  fixes an issue where the schema is created , ie 'bob', but no user named 'bob' owns the schema, so the table is not found
-- V303  fixes an issue where all rules are appearing, instead of just the rule related to a column
-- V304  testing whether vbCrLf is better than just CHAR(13), some formatting cleanup with GO statements
--       also fixed an issue with the conversion from syscolumns to sys.columns, max-length is only field we need, not [precision]
-- V305  user feedback helped me find that the type_name function should call user_type_id instead of system_type_id
--       also fixed issue where identity definition missing from numeric/decimal definition
-- V306  fixes the computed columns definition that got broken/removed somehow in V300
--       also formatting when decimal is not an identity
-- V307  fixes bug identified by David Griffiths-491597 from SSC where the  @TABLE_ID
--       is reselected, but without it's schema  , potentially selecting the wrong table
--       also fixed is the missing size definition for varbinary, also found by David Griffith
-- V308  abstracted all SQLs to use Table Alaises
--       added logic to script a temp table.
--       added warning about possibly not being marked as system object.
-- V309  added logic based on feedback from Vincent Wylenzek @SSC to return the definition from sys.sql_modules for
--       any object like procedure/view/function/trigger, and not just a table. 
--       note previously, if you pointed sp_GetDDL at a view, it returned the view definition as a table...
--       now it will return the view definition instead.
-- V309a returns multi row recordset, one line per record 
-- V310a fixed the commented out code related to collation identified by moadh.bs @SSC
--       changed the DEFAULT definitions to not include the default name.
-- V310b Added PERSISTED to calculated columns where applicable
-- V310b fixed COLLATE statement for temp tables
-- V310c fixed NVARCHAR size misreported as doubled.
-- V311  fixed issue where indexes did not identify if the column was ASC or DESC found by nikus @ SSC
-- V311a fixed issue where indexes did not identify if the index was CLUSTERED or NONCLUSTERED found by nikus @ SSC 02/22/2013
-- V312  got rid of all upper casing, and allowing all scripts to generate the exact object names in cases of case sensitive databases.
--       now using the case sensitive name of the table passed: so of you did 'exec sp_GetDDL invoicedocs , it might return the script for InvoiceDocs, as that is how it is spelled in sys.objects.
--       added if exists(drop table/procedure/function) statement to the scripting automatically.
--       toggled the commented out code to list any default constraints by name, hopefully to be more accurate..
--       formatting of index statements to be multi line for better readability
--V314   03/30/2015
--       did i mention this scripts out temp tables too? sp_GetDDL #tmp
--       scripts any object:table,#temptable procedure, function, view or trigger
--       added ability to script synonyms
--       moved logic for REAL datatype to fix error when scripting real columns
--       added OmaCoders suggestion to script column extended properties as well.
--       added matt_slack suggestion to script schemaname as part of index portion of script.
--       minor script cleanup to use QUOTENAME insead of concatenating square brackets.
--       changed compatibility to 2008 and above only, now filtered idnexes with WHERE statmeents script correctly
--       foreign key tables and columns  in script now quotenamed to account for spaces in names; previously an error for Applciation ID instead of [Application ID]
--V315   Fixes Aliases and column names that prevented Case Sensitive collations from working.
--       Adds code if the procedure scripted is a system object
--       index scripts featuring filtered indexes is now included
--       index scripts now include filegroup name and compression settings
--       foreign key casecade delete/update settings now included as identified by Alberto aserio@SSC)
--       Fixes related to scripting extended events  as identified by Alberto aserio@SSC)
--V316   Fixes Identified 07/27/2016 by mlm( m.martinelli@SSC)
--       Added logic  resolving error when custom data type are defined using name greather than 16 char.
--       Added handling for data types: binary, datetime2, datetimeoffset, time
--       Added Set Based logic for Handling Fixed FOREIGN KEYS handling when one foreign key is define on more then one field
--       Added SPARSE column property
--V317   Fixes Identified 03/30/2017 by Lowell
--       Scripting of Foreign key column(s) are now quotenamed
--       Scripting column store indexes was broken, now fixed for column store indexes
--V318   Fixes Identified 02/14/2018 by Lowell
--       Scripting of with collation added/required for scripting SharePoint/ReportServer , or databases with non standard collations
--       Scripting enhanced to definitively handle case sensitive collations as well.
--V319   Adding logic for Temporal Tables, to grab their auto nistory tables
--       first attempt for partitioned tables, to get the columns correctly on the partition scheme
-- DROP PROCEDURE [dbo].[sp_GetDDL]
--#############################################################################
--if you are going to put this in MASTER, and want it to be able to query
--each database's sys.indexes, you MUST mark it as a system procedure:
--EXECUTE sp_ms_marksystemobject 'sp_GetDDL'
--#############################################################################
CREATE PROCEDURE [dbo].[sp_GetDDL]
  @TBL                VARCHAR(255),
  @oSQL	nvarchar(max) OUTPUT
AS
BEGIN
  SET NOCOUNT ON;
  DECLARE     @TBLNAME                VARCHAR(200),
              @SCHEMANAME             VARCHAR(255),
              @STRINGLEN              INT,
              @TABLE_ID               INT,
              @FINALSQL               VARCHAR(MAX),
              @CONSTRAINTSQLS         VARCHAR(MAX),
              @CHECKCONSTSQLS         VARCHAR(MAX),
              @RULESCONSTSQLS         VARCHAR(MAX),
              @FKSQLS                 VARCHAR(MAX),
              @TRIGGERSTATEMENT       VARCHAR(MAX),
              @EXTENDEDPROPERTIES     VARCHAR(MAX),
              @INDEXSQLS              VARCHAR(MAX),
              @MARKSYSTEMOBJECT       VARCHAR(MAX),
              @vbCrLf                 CHAR(2),
              @ISSYSTEMOBJECT         INT,
              @PROCNAME               VARCHAR(256),
              @input                  VARCHAR(MAX),
              @ObjectTypeFound        VARCHAR(255),
              @ObjectDataTypeLen      INT,
              --V3.20 additions
              @WithStatement          VARCHAR(MAX),
              @FileGroupStatement     VARCHAR(MAX),
              @PartitioningStatement  VARCHAR(MAX),
              @TemporalStatement      VARCHAR(MAX);
--##############################################################################
-- INITIALIZE
--##############################################################################
  SET @input = '';
  --new code: determine whether this proc is marked as a system proc with sp_ms_marksystemobject,
  --which flips the is_ms_shipped bit in sys.objects
    SELECT @ISSYSTEMOBJECT = ISNULL([is_ms_shipped],0),@PROCNAME = ISNULL([name],'sp_GetDDL') FROM [sys].[objects] WHERE [object_id] = @@PROCID;
  IF @ISSYSTEMOBJECT IS NULL 
    SELECT @ISSYSTEMOBJECT = ISNULL([is_ms_shipped],0),@PROCNAME = ISNULL([name],'sp_GetDDL') FROM [master].[sys].[objects] WHERE [object_id] = @@PROCID;
  IF @ISSYSTEMOBJECT IS NULL 
    SET @ISSYSTEMOBJECT = 0;  
  IF @PROCNAME IS NULL
    SET @PROCNAME = 'sp_GetDDL';
  --SET @TBL =  '[DBO].[WHATEVER1]'
  --does the tablename contain a schema?
  SET @vbCrLf =  CHAR(10);
  SELECT @SCHEMANAME = ISNULL(PARSENAME(@TBL,2),'dbo') ,
         @TBLNAME    = PARSENAME(@TBL,1);
  SELECT
    @TBLNAME    = [objz].[name],
    @TABLE_ID   = [objz].[object_id]
  FROM [sys].[objects] AS [objz]
  WHERE [objz].[type]          IN ('S','U')
    AND [objz].[name]          <>  'dtproperties'
    AND [objz].[name]           =  @TBLNAME
    AND [objz].[schema_id] =  SCHEMA_ID(@SCHEMANAME) ;
 SELECT @ObjectDataTypeLen = MAX(LEN([name])) FROM [sys].[types];
--##############################################################################
-- Check If TEMP TableName is Valid
--##############################################################################
  IF LEFT(@TBLNAME,1) = '#'  COLLATE SQL_Latin1_General_CP1_CI_AS
    BEGIN
      PRINT '--TEMP TABLE  ' + QUOTENAME(@TBLNAME) + '  FOUND';
      IF OBJECT_ID('tempdb..' + QUOTENAME(@TBLNAME)) IS NOT NULL
        BEGIN
          PRINT '--GOIN TO TEMP PROCESSING';
          GOTO TEMPPROCESS;
        END;
    END;
  ELSE
    BEGIN
      PRINT '--Non-Temp Table, ' + QUOTENAME(@TBLNAME) + ' continue Processing';
    END;
--##############################################################################
-- Check If TableName is Valid
--##############################################################################
  IF ISNULL(@TABLE_ID,0) = 0
    BEGIN
      --V309 code: see if it is an object and not a table.
      SELECT
        @TBLNAME    = [objz].[name],
        @TABLE_ID   = [objz].[object_id],
        @ObjectTypeFound = [objz].[type_desc]
      FROM [sys].[objects] AS [objz]
      --WHERE [type_desc]     IN('SQL_STORED_PROCEDURE','VIEW','SQL_TRIGGER','AGGREGATE_FUNCTION','SQL_INLINE_TABLE_VALUED_FUNCTION','SQL_TABLE_VALUED_FUNCTION','SQL_SCALAR_FUNCTION','SYNONYMN')
      WHERE [objz].[type]          IN ('P','V','TR','AF','IF','FN','TF','SN')
        AND [objz].[name]          <>  'dtproperties'
        AND [objz].[name]           =  @TBLNAME
        AND [objz].[schema_id] =  SCHEMA_ID(@SCHEMANAME) ;
      IF ISNULL(@TABLE_ID,0) <> 0  
        BEGIN
          --adding a drop statement.
          --adding a sp_ms_marksystemobject if needed
          SELECT @MARKSYSTEMOBJECT = CASE 
                                       WHEN [objz].[is_ms_shipped] = 1 
                                       THEN '
GO
--#################################################################################################
--Mark as a system object
EXECUTE sp_ms_marksystemobject  ''' + QUOTENAME(@SCHEMANAME) +'.' + QUOTENAME(@TBLNAME) + '''
--#################################################################################################
' 
                                       ELSE '
GO
' 
                                     END 
          FROM [sys].[objects] AS [objz] 
          WHERE [objz].[object_id] = @TABLE_ID;
          --adding a drop statement.
          IF @ObjectTypeFound = 'SYNONYM'  COLLATE SQL_Latin1_General_CP1_CI_AS
            BEGIN
               SELECT @FINALSQL = 
                'IF EXISTS(SELECT * FROM sys.synonyms WHERE name = ''' 
                                + [name] 
                                + ''''
                                + ' AND base_object_name <> ''' + [base_object_name] + ''')'
                                + @vbCrLf
                                + '  DROP SYNONYM ' + QUOTENAME([name]) + ''
                                + @vbCrLf
                                +'GO'
                                + @vbCrLf
                                +'IF NOT EXISTS(SELECT * FROM sys.synonyms WHERE name = ''' 
                                + [name] 
                                + ''')'
                                + @vbCrLf
                                + 'CREATE SYNONYM ' + QUOTENAME([name]) + ' FOR ' + [base_object_name] +';'
                                FROM [sys].[synonyms]
                                WHERE  [name]   =  @TBLNAME
                                AND [schema_id] =  SCHEMA_ID(@SCHEMANAME);
            END;
          ELSE
            BEGIN
          SELECT @FINALSQL = 
          'IF OBJECT_ID(''' + QUOTENAME(@SCHEMANAME) + '.' + QUOTENAME(@TBLNAME) + ''') IS NOT NULL ' + @vbCrLf
          + 'DROP ' + CASE 
                        WHEN [objz].[type] IN ('P')
                        THEN ' PROCEDURE '
                        WHEN [objz].[type] IN ('V')
                        THEN ' VIEW      '
                        WHEN [objz].[type] IN ('TR')
                        THEN ' TRIGGER   '
                        ELSE ' FUNCTION  '
                      END 
                      + QUOTENAME(@SCHEMANAME) + '.' + QUOTENAME(@TBLNAME) + ' ' + @vbCrLf + 'GO' + @vbCrLf
          + [def].[definition] + @MARKSYSTEMOBJECT
          FROM [sys].[objects] AS [objz] 
            INNER JOIN [sys].[sql_modules] AS [def]
              ON [objz].[object_id] = [def].[object_id]
          WHERE [objz].[type]          IN ('P','V','TR','AF','IF','FN','TF')
            AND [objz].[name]          <>  'dtproperties'
            AND [objz].[name]           =  @TBLNAME
            AND [objz].[schema_id] =  SCHEMA_ID(@SCHEMANAME) ;
            END;
          SET @input = @FINALSQL;  
          
--        SELECT @input AS [Item];
		SELECT @oSQL = @input;
       RETURN;
        END;
      ELSE
        BEGIN
        SET @FINALSQL = 'Object ' + QUOTENAME(@SCHEMANAME) + '.' + QUOTENAME(@TBLNAME) + ' does not exist in Database ' + QUOTENAME(DB_NAME())   + ' '  
                      + CASE 
                          WHEN @ISSYSTEMOBJECT = 0 THEN @vbCrLf + ' (also note that ' + @PROCNAME + ' is not marked as a system proc and cross db access to sys.tables will fail.)'
                          ELSE ''
                        END;
      IF LEFT(@TBLNAME,1) = '#' 
        SET @FINALSQL = @FINALSQL + ' OR in The tempdb database.';
 --     SELECT @FINALSQL AS [Item];
  SELECT @oSQL = @FINALSQL;
     RETURN 0;
        END;  
      
    END;
--##############################################################################
-- Valid Table, Continue Processing
--##############################################################################
--Is this a SYSTEM versioned TABLE?
SELECT @FINALSQL = 
     CASE 
       WHEN [tabz].[history_table_id] IS NULL 
       THEN '' 
       ELSE 'ALTER TABLE ' + QUOTENAME(OBJECT_SCHEMA_NAME([tabz].[object_id]) ) + '.' + QUOTENAME(OBJECT_NAME([tabz].[object_id])) + ' SET (SYSTEM_VERSIONING = OFF);' + @vbCrLf
            +  'IF OBJECT_ID(''' + QUOTENAME(OBJECT_SCHEMA_NAME([tabz].[history_table_id]) ) + '.' + QUOTENAME(OBJECT_NAME([tabz].[history_table_id])) + ''') IS NOT NULL ' + @vbCrLf
              + 'DROP TABLE ' + QUOTENAME(OBJECT_SCHEMA_NAME([tabz].[history_table_id])) + '.' + QUOTENAME(OBJECT_NAME([tabz].[history_table_id])) + ' ' + @vbCrLf + 'GO' + @vbCrLf
       END
    + 'IF OBJECT_ID(''' + QUOTENAME(OBJECT_SCHEMA_NAME([tabz].[object_id]) ) + '.' + QUOTENAME(OBJECT_NAME([tabz].[object_id])) + ''') IS NOT NULL ' + @vbCrLf
              + 'DROP TABLE ' + QUOTENAME(OBJECT_SCHEMA_NAME([tabz].[object_id])) + '.' + QUOTENAME(OBJECT_NAME([tabz].[object_id])) + ' ' + @vbCrLf + 'GO' + @vbCrLf
              + 'CREATE TABLE ' + QUOTENAME(OBJECT_SCHEMA_NAME([tabz].[object_id])) + '.' + QUOTENAME(OBJECT_NAME([tabz].[object_id])) + ' ( '
    FROM [sys].[tables] [tabz] WHERE [tabz].[object_id] = @TABLE_ID
    PRINT @FINALSQL
  --removed invalid code here which potentially selected wrong table--thanks David Grifiths @SSC!
  SELECT
    @STRINGLEN = MAX(LEN([colz].[name])) + 1
  FROM [sys].[objects] AS [objz]
    INNER JOIN [sys].[columns] AS [colz]
      ON  [objz].[object_id] = [colz].[object_id]
      AND [objz].[object_id] = @TABLE_ID;
--##############################################################################
--Get the columns, their definitions and defaults.
--##############################################################################
  SELECT
    @FINALSQL = @FINALSQL
    + CASE
        WHEN [colz].[is_computed] = 1
        THEN @vbCrLf
             + QUOTENAME([colz].[name])
             + ' '
             + SPACE(@STRINGLEN - LEN([colz].[name]))
             + 'AS ' + ISNULL([CALC].[definition],'')
             + CASE 
                 WHEN [CALC].[is_persisted] = 1 
                 THEN ' PERSISTED'
                 ELSE ''
               END
        ELSE @vbCrLf
             + QUOTENAME([colz].[name])
             + ' '
             + SPACE(@STRINGLEN - LEN([colz].[name]))
             + UPPER(TYPE_NAME([colz].[user_type_id]))
             + CASE
-- data types with precision and scale  IE DECIMAL(18,3), NUMERIC(10,2)
               WHEN TYPE_NAME([colz].[user_type_id]) IN ('decimal','numeric')
               THEN '('
                    + CONVERT(VARCHAR,[colz].[precision])
                    + ','
                    + CONVERT(VARCHAR,[colz].[scale])
                    + ') '
                    + SPACE(6 - LEN(CONVERT(VARCHAR,[colz].[precision])
                    + ','
                    + CONVERT(VARCHAR,[colz].[scale])))
                    + SPACE(7)
                    + SPACE(@ObjectDataTypeLen - LEN(TYPE_NAME([colz].[user_type_id])))
                    + CASE
                        WHEN COLUMNPROPERTY ( @TABLE_ID , [colz].[name] , 'IsIdentity' ) = 0
                        THEN ''
                        ELSE ' IDENTITY('
                               + CONVERT(VARCHAR,ISNULL(IDENT_SEED(@TBLNAME),1) )
                               + ','
                               + CONVERT(VARCHAR,ISNULL(IDENT_INCR(@TBLNAME),1) )
                               + ')'
                        END
                    + CASE  WHEN [colz].[is_sparse] = 1 THEN ' sparse' ELSE '       ' END
                    + CASE
                        WHEN [colz].[is_nullable] = 0
                        THEN ' NOT NULL'
                        ELSE '     NULL'
                      END
-- data types with scale  IE datetime2(7),TIME(7)
               WHEN TYPE_NAME([colz].[user_type_id]) IN ('datetime2','datetimeoffset','time')
               THEN CASE 
                      WHEN [colz].[scale] < 7 THEN
                      '('
                      + CONVERT(VARCHAR,[colz].[scale])
                      + ') '
                    ELSE 
                      '    '
                    END
                    + SPACE(4)
                    + SPACE(@ObjectDataTypeLen - LEN(TYPE_NAME([colz].[user_type_id])))
                    + '        '
                    + CASE  WHEN [colz].[is_sparse] = 1 THEN ' sparse' ELSE '       ' END
                    + CASE [colz].[generated_always_type]
                        WHEN 0 THEN ''
                        WHEN 1 THEN ' GENERATED ALWAYS AS ROW START'
                        WHEN 2 THEN ' GENERATED ALWAYS AS ROW END'
                        ELSE ''
                      END 
                    + CASE WHEN [colz].[is_hidden] = 1 THEN ' HIDDEN' ELSE '' END
                    + CASE
                        WHEN [colz].[is_nullable] = 0
                        THEN ' NOT NULL'
                        ELSE '     NULL'
                      END
--data types with no/precision/scale,IE  FLOAT
               WHEN  TYPE_NAME([colz].[user_type_id]) IN ('float') --,'real')
               THEN
               --addition: if 53, no need to specifically say (53), otherwise display it
                    CASE
                      WHEN [colz].[precision] = 53
                      THEN SPACE(11 - LEN(CONVERT(VARCHAR,[colz].[precision])))
                           + SPACE(7)
                           + SPACE(@ObjectDataTypeLen - LEN(TYPE_NAME([colz].[user_type_id])))
                           + CASE  WHEN [colz].[is_sparse] = 1 THEN ' sparse' ELSE '       ' END
                           + CASE
                               WHEN [colz].[is_nullable] = 0
                               THEN ' NOT NULL'
                               ELSE '     NULL'
                             END
                      ELSE '('
                           + CONVERT(VARCHAR,[colz].[precision])
                           + ') '
                           + SPACE(6 - LEN(CONVERT(VARCHAR,[colz].[precision])))
                           + SPACE(7) + SPACE(@ObjectDataTypeLen - LEN(TYPE_NAME([colz].[user_type_id])))
                           + CASE  WHEN [colz].[is_sparse] = 1 THEN ' sparse' ELSE '       ' END
                           + CASE
                               WHEN [colz].[is_nullable] = 0
                               THEN ' NOT NULL'
                               ELSE '     NULL'
                             END
                      END
--data type with max_length		ie CHAR (44), VARCHAR(40), BINARY(5000),
--##############################################################################
-- COLLATE STATEMENTS
-- personally i do not like collation statements,
-- but included here to make it easy on those who do
--##############################################################################
               WHEN  TYPE_NAME([colz].[user_type_id]) IN ('char','varchar','binary','varbinary')
               THEN CASE
                      WHEN  [colz].[max_length] = -1
                      THEN  '(max)'
                            + SPACE(6 - LEN(CONVERT(VARCHAR,[colz].[max_length])))
                            + SPACE(7) + SPACE(@ObjectDataTypeLen - LEN(TYPE_NAME([colz].[user_type_id])))
                            ----collate to comment out when not desired
                            --+ CASE
                            --    WHEN COLS.collation_name IS NULL
                            --    THEN ''
                            --    ELSE ' COLLATE ' + COLS.collation_name
                            --  END
                            + CASE  WHEN [colz].[is_sparse] = 1 THEN ' sparse' ELSE '       ' END
                            + CASE
                                WHEN [colz].[is_nullable] = 0
                                THEN ' NOT NULL'
                                ELSE '     NULL'
                              END
                      ELSE '('
                           + CONVERT(VARCHAR,[colz].[max_length])
                           + ') '
                           + SPACE(6 - LEN(CONVERT(VARCHAR,[colz].[max_length])))
                           + SPACE(7) + SPACE(@ObjectDataTypeLen - LEN(TYPE_NAME([colz].[user_type_id])))
                           ----collate to comment out when not desired
                           --+ CASE
                           --     WHEN COLS.collation_name IS NULL
                           --     THEN ''
                           --     ELSE ' COLLATE ' + COLS.collation_name
                           --   END
                           + CASE  WHEN [colz].[is_sparse] = 1 THEN ' sparse' ELSE '       ' END
                           + CASE
                               WHEN [colz].[is_nullable] = 0
                               THEN ' NOT NULL'
                               ELSE '     NULL'
                             END
                    END
--data type with max_length ( BUT DOUBLED) ie NCHAR(33), NVARCHAR(40)
               WHEN TYPE_NAME([colz].[user_type_id]) IN ('nchar','nvarchar')
               THEN CASE
                      WHEN  [colz].[max_length] = -1
                      THEN '(max)'
                           + SPACE(5 - LEN(CONVERT(VARCHAR,([colz].[max_length] / 2))))
                           + SPACE(7)
                           + SPACE(@ObjectDataTypeLen - LEN(TYPE_NAME([colz].[user_type_id])))
                           ----collate to comment out when not desired
                           --+ CASE
                           --     WHEN COLS.collation_name IS NULL
                           --     THEN ''
                           --     ELSE ' COLLATE ' + COLS.collation_name
                           --   END
                           + CASE  WHEN [colz].[is_sparse] = 1 THEN ' sparse' ELSE '       ' END
                           + CASE
                               WHEN [colz].[is_nullable] = 0
                               THEN  ' NOT NULL'
                               ELSE '     NULL'
                             END
                      ELSE '('
                           + CONVERT(VARCHAR,([colz].[max_length] / 2))
                           + ') '
                           + SPACE(6 - LEN(CONVERT(VARCHAR,([colz].[max_length] / 2))))
                           + SPACE(7)
                           + SPACE(@ObjectDataTypeLen - LEN(TYPE_NAME([colz].[user_type_id])))
                           ----collate to comment out when not desired
                           --+ CASE
                           --     WHEN COLS.collation_name IS NULL
                           --     THEN ''
                           --     ELSE ' COLLATE ' + COLS.collation_name
                           --   END
                           + CASE  WHEN [colz].[is_sparse] = 1 THEN ' sparse' ELSE '       ' END
                           + CASE
                               WHEN [colz].[is_nullable] = 0
                               THEN ' NOT NULL'
                               ELSE '     NULL'
                             END
                    END
               WHEN TYPE_NAME([colz].[user_type_id]) IN ('datetime','money','text','image','real')
               THEN SPACE(18 - LEN(TYPE_NAME([colz].[user_type_id])))
                    + '              '
                    + CASE  WHEN [colz].[is_sparse] = 1 THEN ' sparse' ELSE '       ' END
                    + CASE
                        WHEN [colz].[is_nullable] = 0
                        THEN ' NOT NULL'
                        ELSE '     NULL'
                      END
--  other data type 	IE INT, DATETIME, MONEY, CUSTOM DATA TYPE,...
               ELSE SPACE(@ObjectDataTypeLen - LEN(TYPE_NAME([colz].[user_type_id])))
                            + CASE
                                WHEN COLUMNPROPERTY ( @TABLE_ID , [colz].[name] , 'IsIdentity' ) = 0
                                THEN '              '
                                ELSE ' IDENTITY('
                                     + CONVERT(VARCHAR,ISNULL(IDENT_SEED(@TBLNAME),1) )
                                     + ','
                                     + CONVERT(VARCHAR,ISNULL(IDENT_INCR(@TBLNAME),1) )
                                     + ')'
                              END
                            + SPACE(2)
                            + CASE  WHEN [colz].[is_sparse] = 1 THEN ' sparse' ELSE '       ' END
                            + CASE
                                WHEN [colz].[is_nullable] = 0
                                THEN ' NOT NULL'
                                ELSE '     NULL'
                              END
               END
             + CASE
                 WHEN [colz].[default_object_id] = 0
                 THEN ''
                 --ELSE ' DEFAULT '  + ISNULL(def.[definition] ,'')
                 --optional section in case NAMED default constraints are needed:
                 ELSE '  CONSTRAINT ' + QUOTENAME([DEF].[name]) + ' DEFAULT ' + ISNULL([DEF].[definition] ,'')
                        --i thought it needed to be handled differently! NOT!
               END  --CASE cdefault
      END --iscomputed
    + ','
    FROM [sys].[columns] AS [colz]
      LEFT OUTER JOIN  [sys].[default_constraints]  AS [DEF]
        ON [colz].[default_object_id] = [DEF].[object_id]
      LEFT OUTER JOIN [sys].[computed_columns] AS [CALC]
         ON  [colz].[object_id] = [CALC].[object_id]
         AND [colz].[column_id] = [CALC].[column_id]
    WHERE [colz].[object_id]=@TABLE_ID
    ORDER BY [colz].[column_id];
--##############################################################################
--used for formatting the rest of the constraints:
--##############################################################################
  SELECT
    @STRINGLEN = MAX(LEN([objz].[name])) + 1
  FROM [sys].[objects] AS [objz];
--##############################################################################
--PK/Unique Constraints and Indexes, using the 2005/08 INCLUDE syntax
--##############################################################################
  DECLARE @Results  TABLE (
                    [SCHEMA_ID]             INT,
                    [SCHEMA_NAME]           VARCHAR(255),
                    [OBJECT_ID]             INT,
                    [OBJECT_NAME]           VARCHAR(255),
                    [index_id]              INT,
                    [index_name]            VARCHAR(255),
                    [ROWS]                  BIGINT,
                    [SizeMB]                DECIMAL(19,3),
                    [IndexDepth]            INT,
                    [TYPE]                  INT,
                    [type_desc]             VARCHAR(30),
                    [fill_factor]           INT,
                    [is_unique]             INT,
                    [is_primary_key]        INT ,
                    [is_unique_constraint]  INT,
                    [index_columns_key]     VARCHAR(MAX),
                    [index_columns_include] VARCHAR(MAX),
                    [has_filter] BIT ,
                    [filter_definition] VARCHAR(MAX),
                    [currentFilegroupName]  VARCHAR(128),
                    [CurrentCompression]    VARCHAR(128));
  INSERT INTO @Results
    SELECT
      [SCH].[schema_id], [SCH].[name] AS [SCHEMA_NAME],
      [objz].[object_id], [objz].[name] AS [OBJECT_NAME],
      [IDX].[index_id], ISNULL([IDX].[name], '---') AS [index_name],
      [partitions].[ROWS], [partitions].[SizeMB], INDEXPROPERTY([objz].[object_id], [IDX].[name], 'IndexDepth') AS [IndexDepth],
      [IDX].[type], [IDX].[type_desc], [IDX].[fill_factor],
      [IDX].[is_unique], [IDX].[is_primary_key], [IDX].[is_unique_constraint],
      ISNULL([Index_Columns].[index_columns_key], '---') AS [index_columns_key],
      ISNULL([Index_Columns].[index_columns_include], '---') AS [index_columns_include],
      [IDX].[has_filter],
      [IDX].[filter_definition],
      [filz].[name],
      ISNULL([p].[data_compression_desc],'')
    FROM [sys].[objects] AS [objz]
      INNER JOIN [sys].[schemas] AS [SCH] ON [objz].[schema_id]=[SCH].[schema_id]
      INNER JOIN [sys].[indexes] AS [IDX] ON [objz].[object_id]=[IDX].[object_id]
      INNER JOIN [sys].[filegroups] AS [filz] ON [IDX].[data_space_id] = [filz].[data_space_id]
      INNER JOIN [sys].[partitions] AS [p]     ON  [IDX].[object_id] =  [p].[object_id]  AND [IDX].[index_id] = [p].[index_id]
      INNER JOIN (
                  SELECT
                    [statz].[object_id], [statz].[index_id], SUM([statz].[row_count]) AS [ROWS],
                    CONVERT(NUMERIC(19,3), CONVERT(NUMERIC(19,3), SUM([statz].[in_row_reserved_page_count]+[statz].[lob_reserved_page_count]+[statz].[row_overflow_reserved_page_count]))/CONVERT(NUMERIC(19,3), 128)) AS [SizeMB]
                  FROM [sys].[dm_db_partition_stats] AS [statz]
                  GROUP BY [statz].[object_id], [statz].[index_id]
                 ) AS [partitions] 
        ON  [IDX].[object_id]=[partitions].[object_id] 
        AND [IDX].[index_id]=[partitions].[index_id]
    CROSS APPLY (
                 SELECT
                   LEFT([Index_Columns].[index_columns_key], LEN([Index_Columns].[index_columns_key])-1) AS [index_columns_key],
                  LEFT([Index_Columns].[index_columns_include], LEN([Index_Columns].[index_columns_include])-1) AS [index_columns_include]
                 FROM
                      (
                       SELECT
                              (
                              SELECT QUOTENAME([colz].[name]) + CASE WHEN [IXCOLS].[is_descending_key] = 0 THEN ' asc' ELSE ' desc' END + ',' + ' '
                               FROM [sys].[index_columns] AS [IXCOLS]
                                 INNER JOIN [sys].[columns] AS [colz]
                                   ON  [IXCOLS].[column_id]   = [colz].[column_id]
                                   AND [IXCOLS].[object_id] = [colz].[object_id]
                               WHERE [IXCOLS].[is_included_column] = 0
                                 AND [IDX].[object_id] = [IXCOLS].[object_id] 
                                 AND [IDX].[index_id] = [IXCOLS].[index_id]
                               ORDER BY [IXCOLS].[key_ordinal]
                               FOR XML PATH('')
                              ) AS [index_columns_key],
                             (
                             SELECT QUOTENAME([colz].[name]) + ',' + ' '
                              FROM [sys].[index_columns] AS [IXCOLS]
                                INNER JOIN [sys].[columns] AS [colz]
                                  ON  [IXCOLS].[column_id]   = [colz].[column_id]
                                  AND [IXCOLS].[object_id] = [colz].[object_id]
                              WHERE [IXCOLS].[is_included_column] = 1
                                AND [IDX].[object_id] = [IXCOLS].[object_id] 
                                AND [IDX].[index_id] = [IXCOLS].[index_id]
                              ORDER BY [IXCOLS].[index_column_id]
                              FOR XML PATH('')
                             ) AS [index_columns_include]
                      ) AS [Index_Columns]
                ) AS [Index_Columns]
    WHERE [SCH].[name]  LIKE CASE 
                                     WHEN @SCHEMANAME = ''   COLLATE SQL_Latin1_General_CP1_CI_AS
                                     THEN [SCH].[name] 
                                     ELSE @SCHEMANAME 
                                   END
    AND [objz].[name] LIKE CASE 
                                  WHEN @TBLNAME = ''   COLLATE SQL_Latin1_General_CP1_CI_AS 
                                  THEN [objz].[name] 
                                  ELSE @TBLNAME 
                                END
    ORDER BY 
      [SCH].[name], 
      [objz].[name], 
      [IDX].[name];
--@Results table has both PK,s Uniques and indexes in thme...pull them out for adding to funal results:
  SET @CONSTRAINTSQLS = '';
  SET @INDEXSQLS      = '';
  SET @TemporalStatement = '';
  SET @WithStatement = '';
--##############################################################################
  -- Temporal tables
--##############################################################################
  SELECT @TemporalStatement =  ISNULL(@vbCrLf + 'PERIOD FOR SYSTEM_TIME ('
  + MAX(CASE WHEN [colz].[generated_always_type] = 1 THEN [colz].[name] ELSE '' END)
  +','
 + MAX(CASE WHEN [colz].[generated_always_type] = 2 THEN [colz].[name] ELSE '' END)
  +'),','') ,
  @WithStatement = ISNULL(' SYSTEM_VERSIONING = ON (HISTORY_TABLE=' + QUOTENAME(OBJECT_SCHEMA_NAME([objz].[history_table_id])) + '.' + QUOTENAME(OBJECT_NAME([objz].[history_table_id])) + '),' ,'')
  FROM [sys].[tables] [objz]
  INNER JOIN [sys].[columns] [colz] 
  ON [objz].[object_id] = [colz].[object_id]
  WHERE [colz].[object_id] = @TABLE_ID 
  AND [colz].[generated_always_type] > 0
  GROUP BY [colz].[object_id],[objz].[history_table_id]
--##############################################################################
-- memory optimized
--##############################################################################
SELECT @WithStatement  = @WithStatement + ISNULL('MEMORY_OPTIMIZED=ON, DURABILITY=' + [objz].[durability_desc] + ',','') 
FROM [sys].[tables] [objz]
WHERE [objz].[is_memory_optimized] =1
AND [objz].[object_id] = @TABLE_ID 
--##############################################################################
--constraints
--column store indexes are different: the "include" columns for normal indexes as scripted above are the columnstores indexed columns
--add a CASE for that situation.
--##############################################################################
  SELECT @CONSTRAINTSQLS = @CONSTRAINTSQLS 
         + CASE
             WHEN [is_primary_key] = 1 OR [is_unique] = 1
             THEN @vbCrLf
                  + 'CONSTRAINT   '  COLLATE SQL_Latin1_General_CP1_CI_AS + QUOTENAME([index_name]) + ' '
                  + CASE  
                      WHEN [is_primary_key] = 1 
                      THEN ' PRIMARY KEY ' 
                      ELSE CASE  
                             WHEN [is_unique] = 1     
                             THEN ' UNIQUE      '      
                             ELSE '' 
                           END 
                    END
                  + [type_desc] 
                  + CASE 
                      WHEN [type_desc]='NONCLUSTERED' 
                      THEN '' 
                      ELSE '   ' 
                    END
                  + ' (' + [index_columns_key] + ')'
                  + CASE 
                      WHEN [index_columns_include] <> '---' 
                      THEN ' INCLUDE (' + [index_columns_include] + ')' 
                      ELSE '' 
                    END
                  + CASE
                      WHEN [has_filter] = 1 
                      THEN ' ' + [filter_definition]
                      ELSE ' '
                    END
                  + CASE WHEN [fill_factor] <> 0 OR [CurrentCompression] <> 'NONE'
                  THEN ' WITH (' + CASE
                                    WHEN [fill_factor] <> 0 
                                    THEN 'FILLFACTOR = ' + CONVERT(VARCHAR(30),[fill_factor]) 
                                    ELSE '' 
                                  END
                                + CASE
                                    WHEN [fill_factor] <> 0  AND [CurrentCompression] <> 'NONE' THEN ',DATA_COMPRESSION = ' + [CurrentCompression] + ' '
                                    WHEN [fill_factor] <> 0  AND [CurrentCompression]  = 'NONE' THEN ''
                                    WHEN [fill_factor]  = 0  AND [CurrentCompression] <> 'NONE' THEN 'DATA_COMPRESSION = ' + [CurrentCompression] + ' '
                                    ELSE '' 
                                  END
                                  + ')'
                  ELSE '' 
                  END 
                      
             ELSE ''
           END + ','
  FROM @Results
  WHERE [type_desc] != 'HEAP'
    AND [is_primary_key] = 1 
    OR  [is_unique] = 1
  ORDER BY 
    [is_primary_key] DESC,
    [is_unique] DESC;
    --
--##############################################################################
--indexes
--##############################################################################
  SELECT @INDEXSQLS = @INDEXSQLS 
         + CASE
             WHEN [is_primary_key] = 0 OR [is_unique] = 0
             THEN @vbCrLf
                  + 'CREATE '  COLLATE SQL_Latin1_General_CP1_CI_AS + [type_desc] + ' INDEX '  COLLATE SQL_Latin1_General_CP1_CI_AS + QUOTENAME([index_name]) + ' '
                  + @vbCrLf
                  + '   ON '   COLLATE SQL_Latin1_General_CP1_CI_AS
                  + QUOTENAME([SCHEMA_NAME]) + '.' + QUOTENAME([OBJECT_NAME])
                  + CASE 
                        WHEN [CurrentCompression] = 'COLUMNSTORE'  COLLATE SQL_Latin1_General_CP1_CI_AS
                        THEN ' (' + [index_columns_include] + ')' 
                        ELSE ' (' + [index_columns_key] + ')'
                    END
                  + CASE 
                      WHEN [CurrentCompression] = 'COLUMNSTORE'  COLLATE SQL_Latin1_General_CP1_CI_AS
                      THEN ''  COLLATE SQL_Latin1_General_CP1_CI_AS
                      ELSE
                        CASE
                     WHEN [index_columns_include] <> '---' 
                     THEN @vbCrLf + '   INCLUDE ('  COLLATE SQL_Latin1_General_CP1_CI_AS + [index_columns_include] + ')'   COLLATE SQL_Latin1_General_CP1_CI_AS
                     ELSE ''   COLLATE SQL_Latin1_General_CP1_CI_AS
                   END
                    END
                  --2008 filtered indexes syntax
                  + CASE 
                      WHEN [has_filter] = 1 
                      THEN @vbCrLf + '   WHERE '  COLLATE SQL_Latin1_General_CP1_CI_AS + [filter_definition]
                      ELSE ''
                    END
                  + CASE WHEN [fill_factor] <> 0 OR [CurrentCompression] <> 'NONE'  COLLATE SQL_Latin1_General_CP1_CI_AS
                  THEN ' WITH ('  COLLATE SQL_Latin1_General_CP1_CI_AS + CASE
                                    WHEN [fill_factor] <> 0 
                                    THEN 'FILLFACTOR = '  COLLATE SQL_Latin1_General_CP1_CI_AS + CONVERT(VARCHAR(30),[fill_factor]) 
                                    ELSE '' 
                                  END
                                + CASE
                                    WHEN [fill_factor] <> 0  AND [CurrentCompression] <> 'NONE' THEN ',DATA_COMPRESSION = ' + [CurrentCompression]+' '
                                    WHEN [fill_factor] <> 0  AND [CurrentCompression]  = 'NONE' THEN ''
                                    WHEN [fill_factor]  = 0  AND [CurrentCompression] <> 'NONE' THEN 'DATA_COMPRESSION = ' + [CurrentCompression]+' '
                                    ELSE '' 
                                  END
                                  + ')'
                  ELSE '' 
                  END 
           END
  FROM @Results
  WHERE [type_desc] != 'HEAP'
    AND [is_primary_key] = 0 
    AND [is_unique] = 0
  ORDER BY 
    [is_primary_key] DESC,
    [is_unique] DESC;
  IF @INDEXSQLS <> ''  COLLATE SQL_Latin1_General_CP1_CI_AS
    SET @INDEXSQLS = @vbCrLf + 'GO'  COLLATE SQL_Latin1_General_CP1_CI_AS + @vbCrLf + @INDEXSQLS;
--##############################################################################
--CHECK Constraints
--##############################################################################
  SET @CHECKCONSTSQLS = ''  COLLATE SQL_Latin1_General_CP1_CI_AS;
  SELECT
    @CHECKCONSTSQLS = @CHECKCONSTSQLS
    + @vbCrLf
    + ISNULL('CONSTRAINT   ' + QUOTENAME([objz].[name]) + ' '
    + SPACE(@STRINGLEN - LEN([objz].[name]))
    + ' CHECK ' + ISNULL([CHECKS].[definition],'')
    + ',','')
  FROM [sys].[objects] AS [objz]
    INNER JOIN [sys].[check_constraints] AS [CHECKS] ON [objz].[object_id] = [CHECKS].[object_id]
  WHERE [objz].[type] = 'C'
    AND [objz].[parent_object_id] = @TABLE_ID;
--##############################################################################
--FOREIGN KEYS
--##############################################################################
  SET @FKSQLS = '' ;

  if 1=2 BEGIN
  -- switched off for now!

    SELECT
    @FKSQLS=@FKSQLS
    + @vbCrLf + [MyAlias].[Command] FROM
(
SELECT
  DISTINCT
  --FK must be added AFTER the PK/unique constraints are added back.
  850 AS [ExecutionOrder],
  'CONSTRAINT ' 
  + QUOTENAME([conz].[name]) 
  + ' FOREIGN KEY (' 
  + [ChildCollection].[ChildColumns] 
  + ') REFERENCES ' 
  + QUOTENAME(SCHEMA_NAME([conz].[schema_id])) 
  + '.' 
  + QUOTENAME(OBJECT_NAME([conz].[referenced_object_id])) 
  + ' (' + [ParentCollection].[ParentColumns] 
  + ') ' 
  +  CASE [conz].[update_referential_action]
                                        WHEN 0 THEN '' --' ON UPDATE NO ACTION '
                                        WHEN 1 THEN ' ON UPDATE CASCADE '
                                        WHEN 2 THEN ' ON UPDATE SET NULL '
                                        ELSE ' ON UPDATE SET DEFAULT '
                                    END
                  + CASE [conz].[delete_referential_action]
                                        WHEN 0 THEN '' --' ON DELETE NO ACTION '
                                        WHEN 1 THEN ' ON DELETE CASCADE '
                                        WHEN 2 THEN ' ON DELETE SET NULL '
                                        ELSE ' ON DELETE SET DEFAULT '
                                    END
                  + CASE [conz].[is_not_for_replication]
                        WHEN 1 THEN ' NOT FOR REPLICATION '
                        ELSE ''
                    END
  + ',' AS [Command]
FROM   [sys].[foreign_keys] AS [conz]
       INNER JOIN [sys].[foreign_key_columns] AS [colz]
         ON [conz].[object_id] = [colz].[constraint_object_id]
      
       INNER JOIN (--gets my child tables column names   
SELECT
 [conz].[name],
 --technically, FK's can contain up to 16 columns, but real life is often a single column. coding here is for all columns
 [ChildColumns] = STUFF((SELECT 
                         ',' + QUOTENAME([REFZ].[name])
                       FROM   [sys].[foreign_key_columns] AS [fkcolz]
                              INNER JOIN [sys].[columns] AS [REFZ]
                                ON [fkcolz].[parent_object_id] = [REFZ].[object_id]
                                   AND [fkcolz].[parent_column_id] = [REFZ].[column_id]
                       WHERE [fkcolz].[parent_object_id] = [conz].[parent_object_id]
                           AND [fkcolz].[constraint_object_id] = [conz].[object_id]
                         ORDER  BY
                        [fkcolz].[constraint_column_id]
                      FOR XML PATH(''), TYPE).[value]('.','varchar(max)'),1,1,'')
FROM   [sys].[foreign_keys] AS [conz]
      INNER JOIN [sys].[foreign_key_columns] AS [colz]
        ON [conz].[object_id] = [colz].[constraint_object_id]
        WHERE [conz].[parent_object_id]= @TABLE_ID
GROUP  BY
[conz].[name],
[conz].[parent_object_id],--- without GROUP BY multiple rows are returned
 [conz].[object_id]
    ) AS [ChildCollection]
         ON [conz].[name] = [ChildCollection].[name]
       INNER JOIN (--gets the parent tables column names for the FK reference
                  SELECT
                     [conz].[name],
                     [ParentColumns] = STUFF((SELECT
                                              ',' + [REFZ].[name]
                                            FROM   [sys].[foreign_key_columns] AS [fkcolz]
                                                   INNER JOIN [sys].[columns] AS [REFZ]
                                                     ON [fkcolz].[referenced_object_id] = [REFZ].[object_id]
                                                        AND [fkcolz].[referenced_column_id] = [REFZ].[column_id]
                                            WHERE  [fkcolz].[referenced_object_id] = [conz].[referenced_object_id]
                                              AND [fkcolz].[constraint_object_id] = [conz].[object_id]
                                            ORDER BY [fkcolz].[constraint_column_id]
                                            FOR XML PATH(''), TYPE).[value]('.','varchar(max)'),1,1,'')
                   FROM   [sys].[foreign_keys] AS [conz]
                          INNER JOIN [sys].[foreign_key_columns] AS [colz]
                            ON [conz].[object_id] = [colz].[constraint_object_id]
                           -- AND colz.parent_column_id 
                   GROUP  BY
                    [conz].[name],
                    [conz].[referenced_object_id],--- without GROUP BY multiple rows are returned
                    [conz].[object_id]
                  ) AS [ParentCollection]
         ON [conz].[name] = [ParentCollection].[name]
)AS [MyAlias];

END


--##############################################################################
--RULES
--##############################################################################
  SET @RULESCONSTSQLS = '';
  SELECT
    @RULESCONSTSQLS = @RULESCONSTSQLS
    + ISNULL(
             @vbCrLf
             + 'if not exists(SELECT [name] FROM sys.objects WHERE TYPE=''R'' AND schema_id = ' COLLATE SQL_Latin1_General_CP1_CI_AS + CONVERT(VARCHAR(30),[objz].[schema_id]) + ' AND [name] = '''  COLLATE SQL_Latin1_General_CP1_CI_AS + QUOTENAME(OBJECT_NAME([colz].[rule_object_id])) + ''')'  COLLATE SQL_Latin1_General_CP1_CI_AS + @vbCrLf
             + [MODS].[definition]  + @vbCrLf + 'GO' COLLATE SQL_Latin1_General_CP1_CI_AS +  @vbCrLf
             + 'EXEC sp_binderule  ' + QUOTENAME([objz].[name]) + ', ''' + QUOTENAME(OBJECT_NAME([colz].[object_id])) + '.' + QUOTENAME([colz].[name]) + ''''  COLLATE SQL_Latin1_General_CP1_CI_AS + @vbCrLf + 'GO'  COLLATE SQL_Latin1_General_CP1_CI_AS ,'')
  FROM [sys].[columns] [colz] 
    INNER JOIN [sys].[objects] [objz]
      ON [objz].[object_id] = [colz].[object_id]
    INNER JOIN [sys].[sql_modules] AS [MODS]
      ON [colz].[rule_object_id] = [MODS].[object_id]
  WHERE [colz].[rule_object_id] <> 0
    AND [colz].[object_id] = @TABLE_ID;
--##############################################################################
--TRIGGERS
--##############################################################################
  SET @TRIGGERSTATEMENT = '';

  SELECT @TRIGGERSTATEMENT = @TRIGGERSTATEMENT +  @vbCrLf + [MODS].[definition] + @vbCrLf + 'GO'
  FROM [sys].[sql_modules] AS [MODS]
  LEFT JOIN  [sys].[objects] o on o.[object_id] = [MODS].[object_id] 
  LEFT JOIN  [sys].[triggers] t on t.[object_id] = [MODS].[object_id]
  WHERE t.[is_disabled] = 0 and [MODS].[object_id] IN (SELECT [objz].[object_id] FROM [sys].[objects] AS [objz] WHERE [objz].[type] = 'TR' AND [objz].[parent_object_id] = @TABLE_ID);

  if 1=2 BEGIN
  SELECT  @TRIGGERSTATEMENT = @TRIGGERSTATEMENT +  @vbCrLf + [MODS].[definition] + @vbCrLf + 'GO'
  FROM [sys].[sql_modules] AS [MODS]
  WHERE [MODS].[object_id] IN (
		SELECT [objz].[object_id]
        FROM [sys].[objects] AS [objz]
        WHERE [objz].[type] = 'TR' AND [objz].[parent_object_id] = @TABLE_ID
	);
  END


  IF @TRIGGERSTATEMENT <> ''  COLLATE SQL_Latin1_General_CP1_CI_AS

  SET @TRIGGERSTATEMENT = @vbCrLf + 'GO'  COLLATE SQL_Latin1_General_CP1_CI_AS + @vbCrLf + @TRIGGERSTATEMENT;


--##############################################################################
--NEW SECTION QUERY ALL EXTENDED PROPERTIES
--##############################################################################
  SET @EXTENDEDPROPERTIES = '';
  SELECT  @EXTENDEDPROPERTIES =
          @EXTENDEDPROPERTIES + @vbCrLf +
         'EXEC sys.sp_addextendedproperty
          @name = N'''  COLLATE SQL_Latin1_General_CP1_CI_AS + [name] + ''', @value = N'''  COLLATE SQL_Latin1_General_CP1_CI_AS + REPLACE(CONVERT(VARCHAR(MAX),[value]),'''','''''') + ''',
          @level0type = N''SCHEMA'', @level0name = '  COLLATE SQL_Latin1_General_CP1_CI_AS + QUOTENAME(@SCHEMANAME) + ',
          @level1type = N''TABLE'', @level1name = '  COLLATE SQL_Latin1_General_CP1_CI_AS + QUOTENAME(@TBLNAME) + ';'
 --SELECT objtype, objname, name, value
  FROM [sys].[fn_listextendedproperty] (NULL, 'schema', @SCHEMANAME, 'table', @TBLNAME, NULL, NULL);
  --OMacoder suggestion for column extended properties http://www.sqlservercentral.com/Forums/FindPost1651606.aspx
   ;WITH [obj] AS (
	SELECT [split].[a].[value]('.', 'VARCHAR(20)') AS [name]
	FROM ( 
		SELECT CAST ('<M>' + REPLACE('column,constraint,index,trigger,parameter', ',', '</M><M>') + '</M>' AS XML) AS [data] 
		) AS [A] 
		CROSS APPLY [data].[nodes] ('/M') AS [split]([a])
	)
  SELECT 
  @EXTENDEDPROPERTIES =
		 @EXTENDEDPROPERTIES + @vbCrLf + @vbCrLf +
         'EXEC sys.sp_addextendedproperty
         @name = N''' COLLATE SQL_Latin1_General_CP1_CI_AS
         + [lep].[name] 
         + ''', @value = N''' COLLATE SQL_Latin1_General_CP1_CI_AS
         + REPLACE(CONVERT(VARCHAR(MAX),[lep].[value]),'''','''''') + ''',
         @level0type = N''SCHEMA'', @level0name = ' COLLATE SQL_Latin1_General_CP1_CI_AS
         + QUOTENAME(@SCHEMANAME) 
         + ',
         @level1type = N''TABLE'', @level1name = ' COLLATE SQL_Latin1_General_CP1_CI_AS
         + QUOTENAME(@TBLNAME) 
         + ',
         @level2type = N''' COLLATE SQL_Latin1_General_CP1_CI_AS
         + UPPER([obj].[name])  
         + ''', @level2name = ' COLLATE SQL_Latin1_General_CP1_CI_AS
         + QUOTENAME([lep].[objname]) + ';' COLLATE SQL_Latin1_General_CP1_CI_AS
  --SELECT objtype, objname, name, value
  FROM [obj] 
	CROSS APPLY [sys].[fn_listextendedproperty] (NULL, 'schema', @SCHEMANAME, 'table', @TBLNAME, [obj].[name], NULL) AS [lep];  
  
  IF @EXTENDEDPROPERTIES <> '' COLLATE SQL_Latin1_General_CP1_CI_AS
    SET @EXTENDEDPROPERTIES = @vbCrLf + 'GO' COLLATE SQL_Latin1_General_CP1_CI_AS + @vbCrLf + @EXTENDEDPROPERTIES;
--##############################################################################
--FINAL CLEANUP AND PRESENTATION
--##############################################################################
--at this point, there is a trailing comma, or it blank
--WITH statment has a trailing comma

IF @WithStatement > '' 
  SET @WithStatement='WITH (' + SUBSTRING(@WithStatement,1,LEN(@WithStatement) -1)  + ')'
  SELECT
    @FINALSQL = @FINALSQL
                + @TemporalStatement
                + @CONSTRAINTSQLS
                + @CHECKCONSTSQLS
                + @FKSQLS;
--note that this trims the trailing comma from the end of the statements
  SET @FINALSQL = SUBSTRING(@FINALSQL,1,LEN(@FINALSQL) -1) ;
  SET @FINALSQL = @FINALSQL + ')' COLLATE SQL_Latin1_General_CP1_CI_AS +  @vbCrLf + @WithStatement COLLATE SQL_Latin1_General_CP1_CI_AS +  @vbCrLf ;
  SET @input = @vbCrLf
       + @FINALSQL
       + @INDEXSQLS
       + @RULESCONSTSQLS
       + @TRIGGERSTATEMENT
       + @EXTENDEDPROPERTIES;
--  SELECT @input AS [Item];
  SELECT @oSQL = @input 
  RETURN 0;     
--##############################################################################
-- END Normal Table Processing
--############################################################################## 
    
--simple, primitive version to get the results of a TEMP table from the TEMP db.  
--##############################################################################
-- NEW Temp Table Logic
--##############################################################################     
TEMPPROCESS:
  SELECT @TABLE_ID = OBJECT_ID('tempdb..' COLLATE SQL_Latin1_General_CP1_CI_AS + @TBLNAME);
--##############################################################################
-- Valid temp Table, Continue Processing
--##############################################################################
SELECT @FINALSQL = 
     CASE 
       WHEN [tabz].[history_table_id] IS NULL 
       THEN '' 
       ELSE 'ALTER TABLE ' + QUOTENAME(OBJECT_SCHEMA_NAME([tabz].[object_id]) ) + '.' + QUOTENAME(OBJECT_NAME([tabz].[object_id])) + ' SET (SYSTEM_VERSIONING = OFF);' + @vbCrLf
            +  'IF OBJECT_ID(''' + QUOTENAME(OBJECT_SCHEMA_NAME([tabz].[history_table_id]) ) + '.' + QUOTENAME(OBJECT_NAME([tabz].[history_table_id])) + ''') IS NOT NULL ' + @vbCrLf
              + 'DROP TABLE ' + QUOTENAME(OBJECT_SCHEMA_NAME([tabz].[history_table_id])) + '.' + QUOTENAME(OBJECT_NAME([tabz].[history_table_id])) + ' ' + @vbCrLf + 'GO' + @vbCrLf
       END
    + 'IF OBJECT_ID(''' + QUOTENAME(OBJECT_SCHEMA_NAME([tabz].[object_id]) ) + '.' + QUOTENAME(OBJECT_NAME([tabz].[object_id])) + ''') IS NOT NULL ' + @vbCrLf
              + 'DROP TABLE ' + QUOTENAME(OBJECT_SCHEMA_NAME([tabz].[object_id])) + '.' + QUOTENAME(OBJECT_NAME([tabz].[object_id])) + ' ' + @vbCrLf + 'GO' + @vbCrLf
              + 'CREATE TABLE ' + QUOTENAME(OBJECT_SCHEMA_NAME([tabz].[object_id])) + '.' + QUOTENAME(OBJECT_NAME([tabz].[object_id])) + ' ( '
FROM [sys].[tables] [tabz] WHERE [tabz].[object_id] = OBJECT_ID(@TABLE_ID)
  --removed invalid code here which potentially selected wrong table--thansk David Grifiths @SSC!
SELECT 
    @STRINGLEN = MAX(LEN([colz].[name])) + 1
  FROM [tempdb].[sys].[objects] AS [objz]
    INNER JOIN [tempdb].[sys].[columns] AS [colz]
      ON  [objz].[object_id] = [colz].[object_id]
      AND [objz].[object_id] = @TABLE_ID;
--##############################################################################
--Get the hash index definitions for memory optimized tables, if any.
--##############################################################################

--##############################################################################
--Get the columns, their definitions and defaults.
--##############################################################################
  SELECT
    @FINALSQL = @FINALSQL
    + CASE
        WHEN [colz].[is_computed] = 1
        THEN @vbCrLf
             + QUOTENAME([colz].[name])
             + ' '
             + SPACE(@STRINGLEN - LEN([colz].[name]))
             + 'AS ' + ISNULL([CALC].[definition],'')
              + CASE 
                 WHEN [CALC].[is_persisted] = 1 
                 THEN ' PERSISTED'
                 ELSE ''
               END
        ELSE @vbCrLf
             + QUOTENAME([colz].[name])
             + ' '
             + SPACE(@STRINGLEN - LEN([colz].[name]))
             + UPPER(TYPE_NAME([colz].[user_type_id]))
             + CASE
-- data types with precision and scale  IE DECIMAL(18,3), NUMERIC(10,2)
               WHEN TYPE_NAME([colz].[user_type_id]) IN ('decimal','numeric')
               THEN '('
                    + CONVERT(VARCHAR,[colz].[precision])
                    + ','
                    + CONVERT(VARCHAR,[colz].[scale])
                    + ') '
                    + SPACE(6 - LEN(CONVERT(VARCHAR,[colz].[precision])
                    + ','
                    + CONVERT(VARCHAR,[colz].[scale])))
                    + SPACE(7)
                    + SPACE(16 - LEN(TYPE_NAME([colz].[user_type_id])))
                    + CASE
                        WHEN [colz].[is_identity] = 1
                        THEN ' IDENTITY(1,1)'
                        ELSE ''
                        ----WHEN COLUMNPROPERTY ( @TABLE_ID , COLS.[name] , 'IsIdentity' ) = 1
                        ----THEN ' IDENTITY('
                        ----       + CONVERT(VARCHAR,ISNULL(IDENT_SEED('tempdb..' + @TBLNAME),1) )
                        ----       + ','
                        ----       + CONVERT(VARCHAR,ISNULL(IDENT_INCR('tempdb..' + @TBLNAME),1) )
                        ----       + ')'
                        ----ELSE ''
                        END
                    + CASE  WHEN [colz].[is_sparse] = 1 THEN ' sparse' ELSE '       ' END
                    + CASE
                        WHEN [colz].[is_nullable] = 0
                        THEN ' NOT NULL'
                        ELSE '     NULL'
                      END
-- data types with scale  IE datetime2(7),TIME(7)
               WHEN TYPE_NAME([colz].[user_type_id]) IN ('datetime2','datetimeoffset','time')
               THEN CASE 
                      WHEN [colz].[scale] < 7 THEN
                      '('
                      + CONVERT(VARCHAR,[colz].[scale])
                      + ') '
                    ELSE 
                      '    '
                    END
                    + SPACE(4)
                    + SPACE(@ObjectDataTypeLen - LEN(TYPE_NAME([colz].[user_type_id])))
                    + '        '
                    + CASE  WHEN [colz].[is_sparse] = 1 THEN ' sparse' ELSE '       ' END
                    + CASE [colz].[generated_always_type]
                        WHEN 0 THEN ''
                        WHEN 1 THEN ' GENERATED ALWAYS AS ROW START'
                        WHEN 2 THEN ' GENERATED ALWAYS AS ROW END'
                        ELSE ''
                      END 
                    + CASE WHEN [colz].[is_hidden] = 1 THEN ' HIDDEN' ELSE '' END
                    + CASE
                        WHEN [colz].[is_nullable] = 0
                        THEN ' NOT NULL'
                        ELSE '     NULL'
                      END
--data types with no/precision/scale,IE  FLOAT
               WHEN  TYPE_NAME([colz].[user_type_id]) IN ('float') --,'real')
               THEN
               --addition: if 53, no need to specifically say (53), otherwise display it
                    CASE
                      WHEN [colz].[precision] = 53
                      THEN SPACE(11 - LEN(CONVERT(VARCHAR,[colz].[precision])))
                           + SPACE(7)
                           + SPACE(@ObjectDataTypeLen - LEN(TYPE_NAME([colz].[user_type_id])))
                           + CASE  WHEN [colz].[is_sparse] = 1 THEN ' sparse' ELSE '       ' END
                           + CASE
                               WHEN [colz].[is_nullable] = 0
                               THEN ' NOT NULL'
                               ELSE '     NULL'
                             END
                      ELSE '('
                           + CONVERT(VARCHAR,[colz].[precision])
                           + ') '
                           + SPACE(6 - LEN(CONVERT(VARCHAR,[colz].[precision])))
                           + SPACE(7) + SPACE(@ObjectDataTypeLen - LEN(TYPE_NAME([colz].[user_type_id])))
                           + CASE  WHEN [colz].[is_sparse] = 1 THEN ' sparse' ELSE '       ' END
                           + CASE
                               WHEN [colz].[is_nullable] = 0
                               THEN ' NOT NULL'
                               ELSE '     NULL'
                             END
                      END
--ie VARCHAR(40)
--##############################################################################
-- COLLATE STATEMENTS in tempdb!
-- personally i do not like collation statements,
-- but included here to make it easy on those who do
--##############################################################################
               WHEN  TYPE_NAME([colz].[user_type_id]) IN ('char','varchar','binary','varbinary')
               THEN CASE
                      WHEN  [colz].[max_length] = -1
                      THEN  '(max)'
                            + SPACE(6 - LEN(CONVERT(VARCHAR,[colz].[max_length])))
                            + SPACE(7) + SPACE(@ObjectDataTypeLen - LEN(TYPE_NAME([colz].[user_type_id])))
                            ----collate to comment out when not desired
                            --+ CASE
                            --    WHEN COLS.collation_name IS NULL
                            --    THEN ''
                            --    ELSE ' COLLATE ' + COLS.collation_name
                            --  END
                            + CASE  WHEN [colz].[is_sparse] = 1 THEN ' sparse' ELSE '       ' END
                            + CASE
                                WHEN [colz].[is_nullable] = 0
                                THEN ' NOT NULL'
                                ELSE '     NULL'
                              END
                      ELSE '('
                           + CONVERT(VARCHAR,[colz].[max_length])
                           + ') '
                           + SPACE(6 - LEN(CONVERT(VARCHAR,[colz].[max_length])))
                           + SPACE(7) + SPACE(@ObjectDataTypeLen - LEN(TYPE_NAME([colz].[user_type_id])))
                           ----collate to comment out when not desired
                           --+ CASE
                           --     WHEN COLS.collation_name IS NULL
                           --     THEN ''
                           --     ELSE ' COLLATE ' + COLS.collation_name
                           --   END
                           + CASE  WHEN [colz].[is_sparse] = 1 THEN ' sparse' ELSE '       ' END
                           + CASE
                               WHEN [colz].[is_nullable] = 0
                               THEN ' NOT NULL'
                               ELSE '     NULL'
                             END
                    END
--data type with max_length ( BUT DOUBLED) ie NCHAR(33), NVARCHAR(40)
               WHEN TYPE_NAME([colz].[user_type_id]) IN ('nchar','nvarchar')
               THEN CASE
                      WHEN  [colz].[max_length] = -1
                      THEN '(max)'
                           + SPACE(5 - LEN(CONVERT(VARCHAR,([colz].[max_length] / 2))))
                           + SPACE(7)
                           + SPACE(@ObjectDataTypeLen - LEN(TYPE_NAME([colz].[user_type_id])))
                           -- --collate to comment out when not desired
                           --+ CASE
                           --     WHEN COLS.collation_name IS NULL
                           --     THEN ''
                           --     ELSE ' COLLATE ' + COLS.collation_name
                           --   END
                           + CASE  WHEN [colz].[is_sparse] = 1 THEN ' sparse' ELSE '       ' END
                           + CASE
                               WHEN [colz].[is_nullable] = 0
                               THEN  ' NOT NULL'
                               ELSE '     NULL'
                             END
                      ELSE '('
                           + CONVERT(VARCHAR,([colz].[max_length] / 2))
                           + ') '
                           + SPACE(6 - LEN(CONVERT(VARCHAR,([colz].[max_length] / 2))))
                           + SPACE(7)
                           + SPACE(@ObjectDataTypeLen - LEN(TYPE_NAME([colz].[user_type_id])))
                           -- --collate to comment out when not desired
                           --+ CASE
                           --     WHEN COLS.collation_name IS NULL
                           --     THEN ''
                           --     ELSE ' COLLATE ' + COLS.collation_name
                           --   END
                           + CASE  WHEN [colz].[is_sparse] = 1 THEN ' sparse' ELSE '       ' END
                           + CASE
                               WHEN [colz].[is_nullable] = 0
                               THEN ' NOT NULL'
                               ELSE '     NULL'
                             END
                    END
--  other data type 	IE INT, DATETIME, MONEY, CUSTOM DATA TYPE,...
               WHEN TYPE_NAME([colz].[user_type_id]) IN ('datetime','money','text','image','real')
               THEN SPACE(18 - LEN(TYPE_NAME([colz].[user_type_id])))
                    + '              '
                    + CASE  WHEN [colz].[is_sparse] = 1 THEN ' sparse' ELSE '       ' END
                    + CASE
                        WHEN [colz].[is_nullable] = 0
                        THEN ' NOT NULL'
                        ELSE '     NULL'
                      END
--IE INT
               ELSE SPACE(@ObjectDataTypeLen - LEN(TYPE_NAME([colz].[user_type_id])))
                            + CASE
                                WHEN [colz].[is_identity] = 1
                                THEN ' IDENTITY(1,1)'
                                ELSE '              '
                                ----WHEN COLUMNPROPERTY ( @TABLE_ID , COLS.[name] , 'IsIdentity' ) = 1
                                ----THEN ' IDENTITY('
                                ----     + CONVERT(VARCHAR,ISNULL(IDENT_SEED('tempdb..' + @TBLNAME),1) )
                                ----     + ','
                                ----     + CONVERT(VARCHAR,ISNULL(IDENT_INCR('tempdb..' + @TBLNAME),1) )
                                ----     + ')'
                                ----ELSE '              '
                              END
                            + SPACE(2)
                            + CASE  WHEN [colz].[is_sparse] = 1 THEN ' sparse' ELSE '       ' END
                            + CASE
                                WHEN [colz].[is_nullable] = 0
                                THEN ' NOT NULL'
                                ELSE '     NULL'
                              END
               END
             + CASE
                 WHEN [colz].[default_object_id] = 0
                 THEN ''
                 ELSE ' DEFAULT '  + ISNULL([DEF].[definition] ,'')
                 --optional section in case NAMED default cosntraints are needed:
                 --ELSE ' CONSTRAINT [' + DEF.name + '] DEFAULT '+ REPLACE(REPLACE(ISNULL(DEF.[definition] ,''),'((','('),'))',')')
                        --i thought it needed to be handled differently! NOT!
               END  --CASE cdefault
      END --iscomputed
    + ','
    FROM [tempdb].[sys].[columns] AS [colz]
      LEFT OUTER JOIN  [tempdb].[sys].[default_constraints]  AS [DEF]
        ON [colz].[default_object_id] = [DEF].[object_id]
      LEFT OUTER JOIN [tempdb].[sys].[computed_columns] AS [CALC]
         ON  [colz].[object_id] = [CALC].[object_id]
         AND [colz].[column_id] = [CALC].[column_id]
    WHERE [colz].[object_id]=@TABLE_ID
    ORDER BY [colz].[column_id];
--##############################################################################
--used for formatting the rest of the constraints:
--##############################################################################
  SELECT
    @STRINGLEN = MAX(LEN([objz].[name])) + 1
  FROM [tempdb].[sys].[objects] AS [objz];
--##############################################################################
--PK/Unique Constraints and Indexes, using the 2005/08 INCLUDE syntax
--##############################################################################
  DECLARE @Results2  TABLE (
                    [SCHEMA_ID]             INT,
                    [SCHEMA_NAME]           VARCHAR(255),
                    [OBJECT_ID]             INT,
                    [OBJECT_NAME]           VARCHAR(255),
                    [index_id]              INT,
                    [index_name]            VARCHAR(255),
                    [ROWS]                  BIGINT,
                    [SizeMB]                DECIMAL(19,3),
                    [IndexDepth]            INT,
                    [TYPE]                  INT,
                    [type_desc]             VARCHAR(30),
                    [fill_factor]           INT,
                    [is_unique]             INT,
                    [is_primary_key]        INT ,
                    [is_unique_constraint]  INT,
                    [index_columns_key]     VARCHAR(MAX),
                    [index_columns_include] VARCHAR(MAX),
                    [has_filter] BIT ,
                    [filter_definition] VARCHAR(MAX),
                    [currentFilegroupName]  VARCHAR(128),
                    [CurrentCompression]    VARCHAR(128));
  INSERT INTO @Results2
    SELECT
      [SCH].[schema_id], [SCH].[name] AS [SCHEMA_NAME],
      [objz].[object_id], [objz].[name] AS [OBJECT_NAME],
      [IDX].[index_id], ISNULL([IDX].[name], '---') AS [index_name],
      [partitions].[ROWS], [partitions].[SizeMB], INDEXPROPERTY([objz].[object_id], [IDX].[name], 'IndexDepth') AS [IndexDepth],
      [IDX].[type], [IDX].[type_desc], [IDX].[fill_factor],
      [IDX].[is_unique], [IDX].[is_primary_key], [IDX].[is_unique_constraint],
      ISNULL([Index_Columns].[index_columns_key], '---') AS [index_columns_key],
      ISNULL([Index_Columns].[index_columns_include], '---') AS [index_columns_include],
      [IDX].[has_filter],
      [IDX].[filter_definition],
      [filz].[name],
      ISNULL([p].[data_compression_desc],'')
    FROM [tempdb].[sys].[objects] AS [objz]
      INNER JOIN [tempdb].[sys].[schemas] AS [SCH] ON [objz].[schema_id]=[SCH].[schema_id]
      INNER JOIN [tempdb].[sys].[indexes] AS [IDX] ON [objz].[object_id]=[IDX].[object_id]
      INNER JOIN [sys].[filegroups] AS [filz] ON [IDX].[data_space_id] = [filz].[data_space_id]
      INNER JOIN [sys].[partitions] AS [p]     ON  [IDX].[object_id] =  [p].[object_id]  AND [IDX].[index_id] = [p].[index_id]
      INNER JOIN (
                  SELECT
                    [statz].[object_id], [statz].[index_id], SUM([statz].[row_count]) AS [ROWS],
                    CONVERT(NUMERIC(19,3), CONVERT(NUMERIC(19,3), SUM([statz].[in_row_reserved_page_count]+[statz].[lob_reserved_page_count]+[statz].[row_overflow_reserved_page_count]))/CONVERT(NUMERIC(19,3), 128)) AS [SizeMB]
                  FROM [tempdb].[sys].[dm_db_partition_stats] AS [statz]
                  GROUP BY [statz].[object_id], [statz].[index_id]
                 ) AS [partitions] 
        ON  [IDX].[object_id]=[partitions].[object_id] 
        AND [IDX].[index_id]=[partitions].[index_id]
    CROSS APPLY (
                 SELECT
                   LEFT([Index_Columns].[index_columns_key], LEN([Index_Columns].[index_columns_key])-1) AS [index_columns_key],
                  LEFT([Index_Columns].[index_columns_include], LEN([Index_Columns].[index_columns_include])-1) AS [index_columns_include]
                 FROM
                      (
                       SELECT
                              (
                              SELECT QUOTENAME([colz].[name]) + CASE WHEN [IXCOLS].[is_descending_key] = 0 THEN ' asc' ELSE ' desc' END + ',' + ' '
                               FROM [tempdb].[sys].[index_columns] AS [IXCOLS]
                                 INNER JOIN [tempdb].[sys].[columns] AS [colz]
                                   ON  [IXCOLS].[column_id]   = [colz].[column_id]
                                   AND [IXCOLS].[object_id] = [colz].[object_id]
                               WHERE [IXCOLS].[is_included_column] = 0
                                 AND [IDX].[object_id] = [IXCOLS].[object_id] 
                                 AND [IDX].[index_id] = [IXCOLS].[index_id]
                               ORDER BY [IXCOLS].[key_ordinal]
                               FOR XML PATH('')
                              ) AS [index_columns_key],
                             (
                             SELECT QUOTENAME([colz].[name]) + ',' + ' '
                              FROM [tempdb].[sys].[index_columns] AS [IXCOLS]
                                INNER JOIN [tempdb].[sys].[columns] AS [colz]
                                  ON  [IXCOLS].[column_id]   = [colz].[column_id]
                                  AND [IXCOLS].[object_id] = [colz].[object_id]
                              WHERE [IXCOLS].[is_included_column] = 1
                                AND [IDX].[object_id] = [IXCOLS].[object_id] 
                                AND [IDX].[index_id] = [IXCOLS].[index_id]
                              ORDER BY [IXCOLS].[index_column_id]
                              FOR XML PATH('')
                             ) AS [index_columns_include]
                      ) AS [Index_Columns]
                ) AS [Index_Columns]
    WHERE [SCH].[name]  LIKE CASE 
                                     WHEN @SCHEMANAME = '' COLLATE SQL_Latin1_General_CP1_CI_AS
                                     THEN [SCH].[name] 
                                     ELSE @SCHEMANAME 
                                   END
    AND [objz].[name] LIKE CASE 
                                  WHEN @TBLNAME = ''  COLLATE SQL_Latin1_General_CP1_CI_AS
                                  THEN [objz].[name] 
                                  ELSE @TBLNAME 
                                END
    ORDER BY 
      [SCH].[name], 
      [objz].[name], 
      [IDX].[name];
--@Results2 table has both PK,s Uniques and indexes in thme...pull them out for adding to funal results:
  SET @CONSTRAINTSQLS = '' COLLATE SQL_Latin1_General_CP1_CI_AS;
  SET @INDEXSQLS      = '' COLLATE SQL_Latin1_General_CP1_CI_AS;
--##############################################################################
--constraints
--##############################################################################
  SELECT @CONSTRAINTSQLS = @CONSTRAINTSQLS 
         + CASE
             WHEN [is_primary_key] = 1 OR [is_unique] = 1
             THEN @vbCrLf
                  + 'CONSTRAINT   '  COLLATE SQL_Latin1_General_CP1_CI_AS + QUOTENAME([index_name]) + ' '
                  + SPACE(@STRINGLEN - LEN([index_name]))
                  + CASE  
                      WHEN [is_primary_key] = 1 
                      THEN ' PRIMARY KEY '  COLLATE SQL_Latin1_General_CP1_CI_AS
                      ELSE CASE  
                             WHEN [is_unique] = 1     
                             THEN ' UNIQUE      '     COLLATE SQL_Latin1_General_CP1_CI_AS  
                             ELSE ''  COLLATE SQL_Latin1_General_CP1_CI_AS
                           END 
                    END
                  + [type_desc] 
                  + CASE 
                      WHEN [type_desc]='NONCLUSTERED' 
                      THEN ''  COLLATE SQL_Latin1_General_CP1_CI_AS
                      ELSE '   ' 
                    END
                  + ' (' + [index_columns_key] + ')'
                  + CASE 
                      WHEN [index_columns_include] <> '---' 
                      THEN ' INCLUDE (' + [index_columns_include] + ')' 
                      ELSE ''  COLLATE SQL_Latin1_General_CP1_CI_AS
                    END
                  + CASE
                      WHEN [has_filter] = 1 
                      THEN ' ' + [filter_definition]
                      ELSE ' '
                    END
                  + CASE WHEN [fill_factor] <> 0 OR [CurrentCompression] <> 'NONE'
                  THEN ' WITH (' + CASE
                                    WHEN [fill_factor] <> 0 
                                    THEN 'FILLFACTOR = ' + CONVERT(VARCHAR(30),[fill_factor]) 
                                    ELSE ''  COLLATE SQL_Latin1_General_CP1_CI_AS
                                  END
                                + CASE
                                    WHEN [fill_factor] <> 0  AND [CurrentCompression] <> 'NONE' THEN ',DATA_COMPRESSION = ' + [CurrentCompression] + ' '
                                    WHEN [fill_factor] <> 0  AND [CurrentCompression]  = 'NONE' THEN ''
                                    WHEN [fill_factor]  = 0  AND [CurrentCompression] <> 'NONE' THEN 'DATA_COMPRESSION = ' + [CurrentCompression] + ' '
                                    ELSE ''  COLLATE SQL_Latin1_General_CP1_CI_AS
                                  END
                                  + ')'
                  ELSE ''  COLLATE SQL_Latin1_General_CP1_CI_AS
                  END 
             ELSE '' COLLATE SQL_Latin1_General_CP1_CI_AS
           END + ','
  FROM @Results2
  WHERE [type_desc] != 'HEAP'
    AND [is_primary_key] = 1 
    OR  [is_unique] = 1
  ORDER BY 
    [is_primary_key] DESC,
    [is_unique] DESC;
--##############################################################################
--indexes
--##############################################################################
  SELECT @INDEXSQLS = @INDEXSQLS 
         + CASE
             WHEN [is_primary_key] = 0 OR [is_unique] = 0
             THEN @vbCrLf
                  + 'CREATE '  COLLATE SQL_Latin1_General_CP1_CI_AS + [type_desc] + ' INDEX '  COLLATE SQL_Latin1_General_CP1_CI_AS + QUOTENAME([index_name]) + ' ' COLLATE SQL_Latin1_General_CP1_CI_AS
                  + @vbCrLf
                  + '   ON '  COLLATE SQL_Latin1_General_CP1_CI_AS
                  + QUOTENAME([SCHEMA_NAME]) + '.' + QUOTENAME([OBJECT_NAME])
                  + CASE 
                        WHEN [CurrentCompression] = 'COLUMNSTORE'  COLLATE SQL_Latin1_General_CP1_CI_AS
                        THEN ' ('  COLLATE SQL_Latin1_General_CP1_CI_AS+ [index_columns_include] + ')'  COLLATE SQL_Latin1_General_CP1_CI_AS
                        ELSE ' ('  COLLATE SQL_Latin1_General_CP1_CI_AS+ [index_columns_key] + ')' COLLATE SQL_Latin1_General_CP1_CI_AS
                    END
                  + CASE 
                      WHEN [CurrentCompression] = 'COLUMNSTORE'  COLLATE SQL_Latin1_General_CP1_CI_AS
                      THEN ''  COLLATE SQL_Latin1_General_CP1_CI_AS
                      ELSE
                        CASE
                     WHEN [index_columns_include] <> '---' 
                     THEN @vbCrLf + '   INCLUDE ('  COLLATE SQL_Latin1_General_CP1_CI_AS + [index_columns_include] + ')'  COLLATE SQL_Latin1_General_CP1_CI_AS 
                     ELSE ''   COLLATE SQL_Latin1_General_CP1_CI_AS
                   END
                    END
                  --2008 filtered indexes syntax
                  + CASE 
                      WHEN [has_filter] = 1 
                      THEN @vbCrLf + '   WHERE '  COLLATE SQL_Latin1_General_CP1_CI_AS + [filter_definition]
                      ELSE ''  COLLATE SQL_Latin1_General_CP1_CI_AS
                    END
                  + CASE WHEN [fill_factor] <> 0 OR [CurrentCompression] <> 'NONE'  COLLATE SQL_Latin1_General_CP1_CI_AS
                  THEN ' WITH ('  COLLATE SQL_Latin1_General_CP1_CI_AS + CASE
                                    WHEN [fill_factor] <> 0 
                                    THEN 'FILLFACTOR = '  COLLATE SQL_Latin1_General_CP1_CI_AS + CONVERT(VARCHAR(30),[fill_factor]) 
                                    ELSE ''  COLLATE SQL_Latin1_General_CP1_CI_AS
                                  END
                                + CASE
                                    WHEN [fill_factor] <> 0  AND [CurrentCompression] <> 'NONE'  COLLATE SQL_Latin1_General_CP1_CI_AS THEN ',DATA_COMPRESSION = ' COLLATE SQL_Latin1_General_CP1_CI_AS + [CurrentCompression] + ' '
                                    WHEN [fill_factor] <> 0  AND [CurrentCompression]  = 'NONE'  COLLATE SQL_Latin1_General_CP1_CI_AS THEN ''  COLLATE SQL_Latin1_General_CP1_CI_AS
                                    WHEN [fill_factor]  = 0  AND [CurrentCompression] <> 'NONE'  COLLATE SQL_Latin1_General_CP1_CI_AS THEN 'DATA_COMPRESSION = '  COLLATE SQL_Latin1_General_CP1_CI_AS+ [CurrentCompression] + ' '
                                    ELSE ''  COLLATE SQL_Latin1_General_CP1_CI_AS
                                  END
                                  + ')' COLLATE SQL_Latin1_General_CP1_CI_AS
                  ELSE ''  COLLATE SQL_Latin1_General_CP1_CI_AS
                  END 
           END
  FROM @Results2
  WHERE [type_desc] != 'HEAP'
    AND [is_primary_key] = 0 
    AND [is_unique] = 0
  ORDER BY 
    [is_primary_key] DESC,
    [is_unique] DESC;
  IF @INDEXSQLS <> '' COLLATE SQL_Latin1_General_CP1_CI_AS
    SET @INDEXSQLS = @vbCrLf + 'GO'  COLLATE SQL_Latin1_General_CP1_CI_AS+ @vbCrLf + @INDEXSQLS;
--##############################################################################
--CHECK Constraints
--##############################################################################
  SET @CHECKCONSTSQLS = '';
  SELECT
    @CHECKCONSTSQLS = @CHECKCONSTSQLS
    + @vbCrLf
    + ISNULL('CONSTRAINT   ' + QUOTENAME([objz].[name]) + ' '
    + SPACE(@STRINGLEN - LEN([objz].[name]))
    + ' CHECK ' + ISNULL([CHECKS].[definition],'')
    + ',','')
  FROM [tempdb].[sys].[objects] AS [objz]
    INNER JOIN [tempdb].[sys].[check_constraints] AS [CHECKS] ON [objz].[object_id] = [CHECKS].[object_id]
  WHERE [objz].[type] = 'C'
    AND [objz].[parent_object_id] = @TABLE_ID;
--##############################################################################
--FOREIGN KEYS
--##############################################################################
  SET @FKSQLS = '' ;
    SELECT
    @FKSQLS=@FKSQLS
    + @vbCrLf + [MyAlias].[Command] FROM
(
SELECT
  DISTINCT
  --FK must be added AFTER the PK/unique constraints are added back.
  850 AS [ExecutionOrder],
  'CONSTRAINT ' 
  + QUOTENAME([conz].[name]) 
  + ' FOREIGN KEY (' 
  + [ChildCollection].[ChildColumns] 
  + ') REFERENCES ' 
  + QUOTENAME(SCHEMA_NAME([conz].[schema_id])) 
  + '.' 
  + QUOTENAME(OBJECT_NAME([conz].[referenced_object_id])) 
  + ' (' + [ParentCollection].[ParentColumns] 
  + ') ' 
   +  CASE [conz].[update_referential_action]
                                        WHEN 0 THEN '' --' ON UPDATE NO ACTION '
                                        WHEN 1 THEN ' ON UPDATE CASCADE '
                                        WHEN 2 THEN ' ON UPDATE SET NULL '
                                        ELSE ' ON UPDATE SET DEFAULT '
                                    END
                  + CASE [conz].[delete_referential_action]
                                        WHEN 0 THEN '' --' ON DELETE NO ACTION '
                                        WHEN 1 THEN ' ON DELETE CASCADE '
                                        WHEN 2 THEN ' ON DELETE SET NULL '
                                        ELSE ' ON DELETE SET DEFAULT '
                                    END
                  + CASE [conz].[is_not_for_replication]
                        WHEN 1 THEN ' NOT FOR REPLICATION '
                        ELSE ''
                    END
  + ',' AS [Command]
FROM   [sys].[foreign_keys] AS [conz]
       INNER JOIN [sys].[foreign_key_columns] AS [colz]
         ON [conz].[object_id] = [colz].[constraint_object_id]
      
       INNER JOIN (--gets my child tables column names   
SELECT
 [conz].[name],
 --technically, FK's can contain up to 16 columns, but real life is often a single column. coding here is for all columns
 [ChildColumns] = STUFF((SELECT 
                         ',' + QUOTENAME([REFZ].[name])
                       FROM   [sys].[foreign_key_columns] AS [fkcolz]
                              INNER JOIN [sys].[columns] AS [REFZ]
                                ON [fkcolz].[parent_object_id] = [REFZ].[object_id]
                                   AND [fkcolz].[parent_column_id] = [REFZ].[column_id]
                       WHERE [fkcolz].[parent_object_id] = [conz].[parent_object_id]
                           AND [fkcolz].[constraint_object_id] = [conz].[object_id]
                         ORDER  BY
                        [fkcolz].[constraint_column_id]
                       FOR XML PATH(''), TYPE).[value]('.','varchar(max)'),1,1,'')
FROM   [sys].[foreign_keys] AS [conz]
      INNER JOIN [sys].[foreign_key_columns] AS [colz]
        ON [conz].[object_id] = [colz].[constraint_object_id]
 WHERE [conz].[parent_object_id]= @TABLE_ID
GROUP  BY
[conz].[name],
[conz].[parent_object_id],--- without GROUP BY multiple rows are returned
 [conz].[object_id]
    ) AS [ChildCollection]
         ON [conz].[name] = [ChildCollection].[name]
       INNER JOIN (--gets the parent tables column names for the FK reference
                  SELECT
                     [conz].[name],
                     [ParentColumns] = STUFF((SELECT
                                              ',' + [REFZ].[name]
                                            FROM   [sys].[foreign_key_columns] AS [fkcolz]
                                                   INNER JOIN [sys].[columns] AS [REFZ]
                                                     ON [fkcolz].[referenced_object_id] = [REFZ].[object_id]
                                                        AND [fkcolz].[referenced_column_id] = [REFZ].[column_id]
                                            WHERE  [fkcolz].[referenced_object_id] = [conz].[referenced_object_id]
                                              AND [fkcolz].[constraint_object_id] = [conz].[object_id]
                                            ORDER BY [fkcolz].[constraint_column_id]
                                            FOR XML PATH(''), TYPE).[value]('.','varchar(max)'),1,1,'')
                   FROM   [sys].[foreign_keys] AS [conz]
                          INNER JOIN [sys].[foreign_key_columns] AS [colz]
                            ON [conz].[object_id] = [colz].[constraint_object_id]
                           -- AND colz.parent_column_id 
                   GROUP  BY
                    [conz].[name],
                    [conz].[referenced_object_id],--- without GROUP BY multiple rows are returned
                    [conz].[object_id]
                  ) AS [ParentCollection]
         ON [conz].[name] = [ParentCollection].[name]
)AS [MyAlias];
--##############################################################################
--RULES
--##############################################################################
  SET @RULESCONSTSQLS = ''  COLLATE SQL_Latin1_General_CP1_CI_AS;
  SELECT
    @RULESCONSTSQLS = @RULESCONSTSQLS
    + ISNULL(
             @vbCrLf
             + 'if not exists(SELECT [name] FROM tempdb.sys.objects WHERE TYPE=''R'' AND schema_id = '  COLLATE SQL_Latin1_General_CP1_CI_AS 
             + CONVERT(VARCHAR(30),[objz].[schema_id]) 
             + ' AND [name] = '''  COLLATE SQL_Latin1_General_CP1_CI_AS
             + QUOTENAME(OBJECT_NAME([colz].[rule_object_id])) 
             + ''')'  COLLATE SQL_Latin1_General_CP1_CI_AS
             + @vbCrLf
             + [MODS].[definition]  + @vbCrLf 
             + 'GO'  COLLATE SQL_Latin1_General_CP1_CI_AS +  @vbCrLf
             + 'EXEC sp_binderule  '  COLLATE SQL_Latin1_General_CP1_CI_AS
             + QUOTENAME([objz].[name]) 
             + ', '''  COLLATE SQL_Latin1_General_CP1_CI_AS 
             + QUOTENAME(OBJECT_NAME([colz].[object_id])) 
             + '.'  COLLATE SQL_Latin1_General_CP1_CI_AS + QUOTENAME([colz].[name]) 
             + ''''  COLLATE SQL_Latin1_General_CP1_CI_AS
             + @vbCrLf 
             + 'GO' ,''  COLLATE SQL_Latin1_General_CP1_CI_AS)
  FROM [tempdb].[sys].[columns] [colz] 
    INNER JOIN [tempdb].[sys].[objects] [objz]
      ON [objz].[object_id] = [colz].[object_id]
    INNER JOIN [tempdb].[sys].[sql_modules] AS [MODS]
      ON [colz].[rule_object_id] = [MODS].[object_id]
  WHERE [colz].[rule_object_id] <> 0
    AND [colz].[object_id] = @TABLE_ID;
--##############################################################################
--TRIGGERS
--##############################################################################
  SET @TRIGGERSTATEMENT = 'JR';
  SELECT
    @TRIGGERSTATEMENT = @TRIGGERSTATEMENT +  @vbCrLf + [MODS].[definition] + @vbCrLf + 'GO'
  FROM [tempdb].[sys].[sql_modules] AS [MODS]
  LEFT JOIN [sys].[triggers] t on t.[object_id] = [MODS].[object_id] 
  WHERE t.[is_disabled] = 0 and [MODS].[object_id] IN(SELECT
                         [objz].[object_id]
                       FROM [tempdb].[sys].[objects] AS [objz] 
                       WHERE [objz].[type] = 'TR' 
                       AND [objz].[parent_object_id] = @TABLE_ID);

  IF @TRIGGERSTATEMENT <> ''  COLLATE SQL_Latin1_General_CP1_CI_AS
    SET @TRIGGERSTATEMENT = @vbCrLf + 'GO'  COLLATE SQL_Latin1_General_CP1_CI_AS + @vbCrLf + @TRIGGERSTATEMENT;
--##############################################################################
--NEW SECTION QUERY ALL EXTENDED PROPERTIES
--##############################################################################
  SET @EXTENDEDPROPERTIES = ''  COLLATE SQL_Latin1_General_CP1_CI_AS;
  SELECT  @EXTENDEDPROPERTIES =
          @EXTENDEDPROPERTIES + @vbCrLf +
         'EXEC tempdb.sys.sp_addextendedproperty
          @name = N'''  COLLATE SQL_Latin1_General_CP1_CI_AS
          + [name] 
          + ''', @value = N'''  COLLATE SQL_Latin1_General_CP1_CI_AS
          + REPLACE(CONVERT(VARCHAR(MAX),[value]),'''','''''') + ''',
          @level0type = N''SCHEMA'', @level0name = '  COLLATE SQL_Latin1_General_CP1_CI_AS
          + QUOTENAME(@SCHEMANAME + ',
          @level1type = N''TABLE'', @level1name = ['  COLLATE SQL_Latin1_General_CP1_CI_AS
          + @TBLNAME) 
          + '];' COLLATE SQL_Latin1_General_CP1_CI_AS
 --SELECT objtype, objname, name, value
  FROM [sys].[fn_listextendedproperty] (NULL, 'schema', @SCHEMANAME, 'table', @TBLNAME, NULL, NULL);
  --OMacoder suggestion for column extended properties http://www.sqlservercentral.com/Forums/FindPost1651606.aspx
  SELECT @EXTENDEDPROPERTIES =
         @EXTENDEDPROPERTIES + @vbCrLf +
         'EXEC sys.sp_addextendedproperty
         @name = N'''  COLLATE SQL_Latin1_General_CP1_CI_AS
         + [name] 
         + ''', @value = N'''  COLLATE SQL_Latin1_General_CP1_CI_AS
         + REPLACE(CONVERT(VARCHAR(MAX),[value]),'''','''''') 
         + ''',
         @level0type = N''SCHEMA'', @level0name = '  COLLATE SQL_Latin1_General_CP1_CI_AS
         + QUOTENAME(@SCHEMANAME) + ',
         @level1type = N''TABLE'', @level1name = '  COLLATE SQL_Latin1_General_CP1_CI_AS
         + QUOTENAME(@TBLNAME) + ',
         @level2type = N''COLUMN'', @level2name = '  COLLATE SQL_Latin1_General_CP1_CI_AS
         + QUOTENAME([objname]) + ';' COLLATE SQL_Latin1_General_CP1_CI_AS
  --SELECT objtype, objname, name, value
  FROM [sys].[fn_listextendedproperty] (NULL, 'schema', @SCHEMANAME, 'table', @TBLNAME, 'column', NULL);
  IF @EXTENDEDPROPERTIES <> '' COLLATE SQL_Latin1_General_CP1_CI_AS
    SET @EXTENDEDPROPERTIES = @vbCrLf + 'GO' COLLATE SQL_Latin1_General_CP1_CI_AS + @vbCrLf + @EXTENDEDPROPERTIES;
--##############################################################################
--FINAL CLEANUP AND PRESENTATION
--##############################################################################
--at this point, there is a trailing comma, or it blank
  SELECT
    @FINALSQL = @FINALSQL
                + @CONSTRAINTSQLS
                + @CHECKCONSTSQLS
                + @FKSQLS;
--note that this trims the trailing comma from the end of the statements
  SET @FINALSQL = SUBSTRING(@FINALSQL,1,LEN(@FINALSQL) -1) ;
  SET @FINALSQL = @FINALSQL + ')'  COLLATE SQL_Latin1_General_CP1_CI_AS + @vbCrLf ;
  SET @input = @vbCrLf
       + @FINALSQL
       + @INDEXSQLS
       + @RULESCONSTSQLS
       + @TRIGGERSTATEMENT
       + @EXTENDEDPROPERTIES;

  SELECT @oSQL = @input;
--  SELECT @input AS [Item];
         
 
   
END; --PROC

GO
CREATE PROCEDURE [dbo].[SYS_WriteToFile]
                @File        NVARCHAR(2000), 
                @Text        NVARCHAR(MAX),
				@Mode		int = 0 -- Will append to file, 1 Will create / overwrite
AS  
BEGIN  
 
                DECLARE @OLE            INT  
                DECLARE @FileID         INT  
  
 
                EXECUTE sp_OACreate 'Scripting.FileSystemObject', @OLE OUT  
        
				if @Mode = 0
					EXECUTE sp_OAMethod @OLE, 'OpenTextFile', @FileID OUT, @File, 8, 1
				else
					EXECUTE sp_OAMethod @OLE, 'OpenTextFile', @FileID OUT, @File, 2, 1

                EXECUTE sp_OAMethod @FileID, 'WriteLine', Null, @Text 
  
                EXECUTE sp_OADestroy @FileID  
                EXECUTE sp_OADestroy @OLE  
  
END


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SYSTEM-GenerateRelease]
	@After Date = '1900-01-01'
AS
BEGIN

--if 1=2 
--BEGIN
-- Update Sys_object table to include any tables that might exist and not registered and remove records if table doesnt exist
	update [Sys_Object] set [New] = 0


--		SELECT i.*, s.* FROM INFORMATION_SCHEMA.TABLES i
--		LEFT JOIN [Sys_Object] s on s.[Name] = i.[TABLE_NAME]
--		where s.[Type] IS NULL and i.[Table_TYPE] = 'BASE TABLE'

	MERGE [Sys_Object] as TARGET
	USING (

		select * from (
			select [name] , 'View' as [type], type_desc as [Description], modify_date as [LastUpdate]
			from sys.views where NOT [Name] like '%_X'

			UNION 

			select [name] , 'Table' as [type], type_desc as [Description], modify_date as [LastUpdate]
			from sys.tables where NOT [Name] like 'TMP_RAW%' and NOT [Name] like '%_X'

			UNION

			select [name] , 'Procedure' as [type], type_desc as [Description], modify_date as [LastUpdate]
			from sys.procedures where NOT [Name] like '%_X'

			UNION

			select [name] , 'Function' as [type], type_desc as [Description], modify_date as [LastUpdate]
			from sys.all_objects where [Type] in ('FN','IF','AF','TF','FS') and [is_ms_shipped] = 0 and NOT [Name] like '%_X'

		) a 

	) as SOURCE
	ON (Target.[Name] = Source.[NAME] and Target.[Type] = Source.[Type])
	WHEN NOT MATCHED BY TARGET THEN
		INSERT ([Name],[Type],[Description],[LastUpdate],[Core],[Include],[New]) 
		VALUES (Source.[NAME], Source.[type], Source.[Description], Source.[LastUpdate], 1, 0, 1)
	WHEN MATCHED THEN
		UPDATE SET [LastUpdate] = Source.[LastUpdate], [Description] = Source.[Description];

		

	-- Remove redundant records from SYS_OBJECTS


	delete from [Sys_Object] where ObjectID in (
		SELECT s.ObjectID FROM [Sys_Object] s
		LEFT JOIN (
			select [name] , 'View' as [type], type_desc as [Description], modify_date as [LastUpdate]
			from sys.views where NOT [Name] like '%_X'

			UNION 

			select [name] , 'Table' as [type], type_desc as [Description], modify_date as [LastUpdate]
			from sys.tables where NOT [Name] like 'TMP_RAW%' and NOT [Name] like '%_X'

			UNION

			select [name] , 'Procedure' as [type], type_desc as [Description], modify_date as [LastUpdate]
			from sys.procedures where NOT [Name] like '%_X'

			UNION

			select [name] , 'Function' as [type], type_desc as [Description], modify_date as [LastUpdate]
			from sys.all_objects where [Type] in ('FN','IF','AF','TF','FS') and [is_ms_shipped] = 0 and NOT [Name] like '%_X'

		) i on i.[NAME] = s.[Name] 
		where i.[Name] IS NULL and s.[Type] <> 'ASP'
	)
		

--END


	DECLARE @vbCrLf	CHAR(2) =  CHAR(10);

	DECLARE @name       sysname;
	DECLARE @SQL        NVARCHAR(MAX) = N''
	DECLARE @WithData	bit
	DECLARE @GenBCP	bit

	DECLARE @mItem NVARCHAR(300) = N''
	DECLARE @mSQL NVARCHAR(MAX) 
	DECLARE @DATADUMPFILE NVARCHAR(1000) 

	DECLARE @DUMPFOLDER NVARCHAR(1000) = [DBO].[fnGlobalProperty]('RELEASEROOT') 

	DECLARE @DROPFKFILE NVARCHAR(1000) = @DUMPFOLDER + N'DropForeignKeys.sql'
	DECLARE @CREATEFKFILE NVARCHAR(1000) = @DUMPFOLDER + N'CreateForeignKeys.sql'

	DECLARE @TABLEFILENAME NVARCHAR(1000) = @DUMPFOLDER + N'Tables.sql'
	DECLARE @VIEWFILENAME NVARCHAR(1000) = @DUMPFOLDER + N'Views.sql'
	DECLARE @DATAFILENAME NVARCHAR(1000) = @DUMPFOLDER + N'Data.sql'
	DECLARE @SPFILENAME_NEW NVARCHAR(1000) = @DUMPFOLDER + N'StoredProcedures_NEW.sql'
	DECLARE @SPFILENAME_UPDATE NVARCHAR(1000) = @DUMPFOLDER + N'StoredProcedures_UPDATE.sql'
	DECLARE @FNFILENAME_NEW NVARCHAR(1000) = @DUMPFOLDER + N'Functions_NEW.sql'
	DECLARE @FNFILENAME_UPDATE NVARCHAR(1000) = @DUMPFOLDER + N'Functions_UPDATE.sql'


	DECLARE @cmd varchar(1000)
	DECLARE @cmd2 varchar(1000)

	DECLARE @DatabaseName VARCHAR(MAX) = (SELECT DB_NAME() AS DataBaseName)
	DECLARE @BCPDATA NVARCHAR(1000) = @DUMPFOLDER + 'BCP\'

	DECLARE @ExportFileName VARCHAR(MAX) 
	DECLARE @UploadBCP VARCHAR(MAX) = @DUMPFOLDER + 'uploadBCP.bat'




	SET @SQL = '
IF NOT EXISTS (SELECT * FROM sys.types WHERE is_table_type = 1 AND name = ''tempResults'')
	CREATE TYPE [dbo].[tempResults] AS TABLE(
		[colName] [varchar](100) NULL,
		[originalValue] [varchar](1000) NULL,
		[newValue] [varchar](1000) NULL
	)
GO

IF NOT EXISTS (SELECT * FROM sys.types WHERE is_table_type = 1 AND name = ''TriggerItem'')
	CREATE TYPE [dbo].[TriggerItem] AS TABLE(
		[itemID] [nvarchar](255) NULL
	)
GO
'

	exec xp_create_subdir @BCPDATA


	EXEC [SYS_WriteToFile] @TABLEFILENAME, @SQL, 1 -- 1 parameter means create new file. No param or 0 is append to file
	EXEC [SYS_WriteToFile] @UploadBCP, 'set "SERVERNAME=actualservernamegoeshere"
		', 1

	DECLARE @createInserts int = 1,
		@includeTables varchar(MAX) = N''

	EXEC [SYS_WriteToFile] @DROPFKFILE, '', 1

-- use to delete all foreign keys
	set @SQL = N''
	select @SQL = @SQL +  N'if exists (select CONSTRAINT_NAME from INFORMATION_SCHEMA.TABLE_CONSTRAINTS where CONSTRAINT_TYPE = ''FOREIGN KEY'' and CONSTRAINT_NAME= ''' + CONSTRAINT_NAME + ''') ALTER TABLE ' + TABLE_NAME + ' DROP CONSTRAINT ' + CONSTRAINT_NAME + ';' + CHAR(13)
	from INFORMATION_SCHEMA.TABLE_CONSTRAINTS
	where CONSTRAINT_TYPE = 'FOREIGN KEY'

	EXEC [SYS_WriteToFile] @DROPFKFILE, @SQL



--	DECLARE db_cursor CURSOR FOR SELECT [name], [WithData], [BCP] from [SYS_OBJECT] where  [Type] = 'Table' AND (LastUpdate > @After) AND (Core = 1) AND ([Can Be Replaced] = 1)

	DECLARE db_cursor CURSOR LOCAL STATIC FOR SELECT [name], [WithData], [BCP] from [SYS_OBJECT] where  [Type] = 'Table' AND (LastUpdate > @After) AND (Core = 1) 


	OPEN db_cursor  
	FETCH NEXT FROM db_cursor INTO @name, @WithData, @GenBCP

	WHILE @@FETCH_STATUS = 0  
    BEGIN  
		EXEC [dbo].[sp_GetDDL] @TBL=@name, @oSQL=@SQL OUTPUT
		EXEC [SYS_WriteToFile] @TABLEFILENAME, @SQL

		if @WithData = 1 
		BEGIN
			if NOT @includeTables = '' set @includeTables = @includeTables + ',' + @name
			else set @includeTables = @name
		END

		if @GenBCP = 1 
		BEGIN
			SET @cmd = 'bcp "SELECT * FROM ' + @DatabaseName + '..' + @name + ' " queryout ' + @BCPDATA + @name + '.bcp -c -t "|" -UTF8 -T -S ' + @@servername
			SET @cmd2 = 'bcp ' + @name + ' in ' + 'BCP\' + @name + '.bcp -S %SERVERNAME% -d "ARM_CORE" -U "armAdmin2" -P "armmra!" -E -t "|" -c '

			EXEC master..xp_cmdshell @cmd

			EXEC [SYS_WriteToFile] @UploadBCP, @cmd2
		END

		FETCH NEXT FROM db_cursor INTO @name, @WithData  , @GenBCP
    END 
 
    CLOSE db_cursor  
	DEALLOCATE db_cursor 



 ---insert statements for data inline into Tables SQL file


DECLARE @insertsql VARCHAR(MAX),
		@tableName varchar(500),
		@tableID varchar(500),
		@cols VARCHAR(MAX),
		@params NVARCHAR(255),
		@minID INT,
		@maxID INT, 
		@SQL2 NVARCHAR(MAX),
		@SQLValues NVARCHAR(MAX),
		@x VARCHAR(MAX)
		
IF @createInserts = 1 
BEGIN
	print @includeTables

	WHILE LEN(@includeTables) > 0
	BEGIN

		SET @tableName =   LTRIM(LEFT(@includeTables, charindex(',', @includeTables+',')-1))
		print @tableName+' data'
--		PRINT [dbo].WriteToFile(CONVERT(VARBINARY(MAX),  'SET IDENTITY_INSERT [dbo].[' + @tableName +'] ON'+ CHAR(10) +'GO' + CHAR(13)), @outputPath  + '2_insertData.sql', 1) SET IDENTITY_INSERT [dbo].[A_Action] ON 
		
		IF (OBJECTPROPERTY(OBJECT_ID(@tableName), 'TableHasIdentity') = 1) 
		BEGIN
			SET @SQL = 'SET IDENTITY_INSERT [dbo].[' + @tableName +'] ON'+ CHAR(10) +'GO' + CHAR(13)
			EXEC [SYS_WriteToFile] @TABLEFILENAME, @SQL
		END

		SET @insertsql =  'INSERT INTO ' + @tablename +' (' +
						STUFF ((
							SELECT ', ' + QUOTENAME(COLUMN_NAME)
							FROM information_schema.columns  
							WHERE table_name = @tableName
							ORDER BY ORDINAL_POSITION
							FOR XML PATH('')), 1, 1, '') + ')'

		SET @cols =    STUFF((SELECT ', CONCAT('''''''',REPLACE(' + QUOTENAME(COLUMN_NAME) + ','''''''',''''''''''''),'''''','')'
						FROM information_schema.columns  
						WHERE table_name = @tableName
						ORDER BY ORDINAL_POSITION
						FOR XML PATH('')), 1, 1, '') 

	-- For this to fetch the right name of Identity field name, identity must be primary key
		select @tableID = COLUMN_NAME FROM information_schema.KEY_COLUMN_USAGE WHERE TABLE_NAME = @tableName

		
		SET @SQL2 = N'SELECT @minID = MIN(row_), @maxID = MAX(row_) FROM (SELECT ROW_NUMBER() over(order by ' + @tableID +') as row_ FROM ' + @tableName +') as a'
		SET @params = N'@minID INT OUTPUT, @maxID INT OUTPUT'
		EXEC sp_executesql @SQL2, @params, @minID = @minID OUTPUT,@maxID = @maxID OUTPUT

		WHILE @minID <= @maxid 
		BEGIN

			SET @SQL2 = CONCAT('SET @x = STUFF((select '''''''',' , @cols , ' FROM (SELECT *,  ROW_NUMBER() over(order by ' ,  @tableID , ') as row_ FROM ' , @tableName , ') as a WHERE row_ = ' , @minID , ' FOR XML PATH('''')), 1, 1, '''')')
			SET @params = N'@x VARCHAR(MAX) OUTPUT'
			EXEC sp_executesql @SQL2, @params, @x = @x OUTPUT

			SET @SQL = @insertsql + ' VALUES(' + SUBSTRING(@x,1, LEN(@x)-1) + ')' + CHAR(10) +'GO' 
--			PRINT  [dbo].WriteToFile(CONVERT(VARBINARY(MAX),  @SQL), @outputPath  + '2_insertData.sql', 1)
			EXEC [SYS_WriteToFile] @TABLEFILENAME, @SQL

			----------------------
			SET @SQL2 = CONCAT(N'SELECT @minID = MIN(row_)  FROM (SELECT ROW_NUMBER() over(order by ' , @tableID ,') as row_ FROM ' , @tableName , ') as a WHERE row_ > ' , @minID ) 
			SET @params = N'@minID INT OUTPUT'
			EXEC sp_executesql @SQL2, @params, @minID = @minID OUTPUT
		END

		SET @includeTables = STUFF(@includeTables, 1, charindex(',', @includeTables+','), '')
--		PRINT [dbo].WriteToFile(CONVERT(VARBINARY(MAX),  'SET IDENTITY_INSERT [dbo].[' + @tableName +'] OFF'+ CHAR(10) +'GO' + CHAR(13)), @outputPath  + '2_insertData.sql', 1) SET IDENTITY_INSERT [dbo].[A_Action] ON 

		IF (OBJECTPROPERTY(OBJECT_ID(@tableName), 'TableHasIdentity') = 1) 
		BEGIN
			SET @SQL = 'SET IDENTITY_INSERT [dbo].[' + @tableName +'] OFF'+ CHAR(10) +'GO' + CHAR(13)
			EXEC [SYS_WriteToFile] @TABLEFILENAME, @SQL	
		END
	END
END


-- CREATE STORED PROCEDURES
	EXEC [SYS_WriteToFile] @SPFILENAME_NEW, '', 1
	EXEC [SYS_WriteToFile] @SPFILENAME_UPDATE, '', 1

	DECLARE @ROUTINE as nvarchar(max)
	DECLARE @SPSTATUS as nvarchar(12)

	-- iif(x.status = 'UPDATE', replace(i.definition,'CREATE ','ALTER '),i.definition)

	DECLARE db_cursor CURSOR LOCAL STATIC FOR 
		select iif(x.status = 'UPDATE', replace(i.definition,'CREATE ','ALTER '),i.definition) as [ROUTINE_DEFINITION], x.status
		from (
			select * from (
				select 'NEW' as [Status], name AS [Name], create_date as [Date], 'create_date' as [DateType], 'Stored Procedure' as [Artifact]
				from sys.procedures where create_date >= @After 

				UNION 

				select 'UPDATE' as [Status],  name AS [Name], modify_date as [Date], 'modify_date' as [DateType], 'Stored Procedure' as [Artifact]
				from sys.procedures where modify_date >= @After and NOT create_date >= @After

			) a where a.[Artifact] = 'Stored Procedure'
		) x
		LEFT JOIN sys.sql_modules i on i.object_id=OBJECT_ID(x.[Name])
		order by [Status], [Artifact], [Date] Desc


	OPEN db_cursor  
	FETCH NEXT FROM db_cursor INTO @ROUTINE, @SPSTATUS

	WHILE @@FETCH_STATUS = 0  
    BEGIN  
		IF @SPSTATUS = 'UPDATE' 
		BEGIN
			EXEC [SYS_WriteToFile] @SPFILENAME_UPDATE, @ROUTINE
			EXEC [SYS_WriteToFile] @SPFILENAME_UPDATE, 'GO'
		END
		ELSE
		BEGIN
			EXEC [SYS_WriteToFile] @SPFILENAME_NEW, @ROUTINE
			EXEC [SYS_WriteToFile] @SPFILENAME_NEW, 'GO'
		END

		FETCH NEXT FROM db_cursor INTO @ROUTINE, @SPSTATUS
    END 
 
    CLOSE db_cursor  
	DEALLOCATE db_cursor 



-- CREATE FUNCTIONS 
	EXEC [SYS_WriteToFile] @FNFILENAME_NEW, '', 1
	EXEC [SYS_WriteToFile] @FNFILENAME_UPDATE, '', 1

-- First get all user defined data types

	DECLARE db_cursor CURSOR LOCAL STATIC FOR 
		SELECT 
		 --     sch.name AS UDT_SCHEMA_NAME 
		  --   ,userDefinedTypes.name AS UDT_TYPE_NAME 

		 --   ,
			N'IF NOT EXISTS (SELECT * FROM sys.types st JOIN sys.schemas ss ON st.schema_id = ss.schema_id WHERE st.name = N''' + REPLACE(userDefinedTypes.name, '''', '''''') + N''' AND ss.name = N''' + REPLACE(sch.name, '''', '''''') + N''') '
			+ NCHAR(13) + NCHAR(10) 
			+
			CASE WHEN userDefinedTypeProperties.IsTableType = 1 
				THEN N'CREATE TYPE ' + QUOTENAME(sch.name) + '.' + QUOTENAME(userDefinedTypes.name) + ' AS TABLE ( 
			' + tAllColumns.column_definition  + N'
		); ' 
				ELSE 
					+ N'CREATE TYPE ' + QUOTENAME(sch.name) + '.' + QUOTENAME(userDefinedTypes.name) 
					+ N' FROM ' 
					+ tBaseTypeComputation.baseTypeName 
					+ CASE WHEN userDefinedTypeProperties.is_nullable = 0 THEN N' NOT NULL' ELSE N'' END 
					+ N'; ' 
			END AS SqlCreateUdt

		FROM sys.types AS userDefinedTypes 

		INNER JOIN sys.schemas AS sch 
			ON sch.schema_id = userDefinedTypes.schema_id 

		LEFT JOIN sys.table_types AS userDefinedTableTypes 
			ON userDefinedTableTypes.user_type_id = userDefinedTypes.user_type_id 

		LEFT JOIN sys.types AS systemType 
			ON systemType.system_type_id = userDefinedTypes.system_type_id 
			AND systemType.is_user_defined = 0 

		OUTER APPLY 
			(
				SELECT 
					 userDefinedTypes.is_nullable 
					,userDefinedTypes.precision AS NUMERIC_PRECISION 
					,userDefinedTypes.scale AS NUMERIC_SCALE 
					,userDefinedTypes.max_length AS CHARACTER_MAXIMUM_LENGTH
					,CASE WHEN userDefinedTableTypes.user_type_id IS NULL THEN 0 ELSE 1 END AS IsTableType 
					,CONVERT(smallint, 
							CASE -- datetime/smalldatetime  
							WHEN userDefinedTypes.system_type_id IN (40, 41, 42, 43, 58, 61) THEN ODBCSCALE(userDefinedTypes.system_type_id, userDefinedTypes.scale) 
							END
					) AS DATETIME_PRECISION 
			) AS userDefinedTypeProperties 


		OUTER APPLY 
			(
				SELECT 
					systemType.name 
					+ 
					CASE 
						WHEN systemType.name IN ('char', 'varchar', 'nchar', 'nvarchar', 'binary', 'varbinary') 
							THEN N'(' 
								+ 
								CASE WHEN userDefinedTypeProperties.CHARACTER_MAXIMUM_LENGTH = -1 THEN 'MAX'
									ELSE CONVERT
										(
											varchar(4)
											,userDefinedTypeProperties.CHARACTER_MAXIMUM_LENGTH 
										)
								END 
								+ N')' 
						WHEN systemType.name IN ('decimal', 'numeric')
							THEN N'(' + CONVERT(varchar(4), userDefinedTypeProperties.NUMERIC_PRECISION) + N', ' + CONVERT(varchar(4), userDefinedTypeProperties.NUMERIC_SCALE) + N')'
						WHEN systemType.name IN ('time', 'datetime2', 'datetimeoffset') 
							THEN N'(' + CAST(userDefinedTypeProperties.DATETIME_PRECISION AS national character varying(36)) + N')' 
						ELSE N'' 
					END AS baseTypeName  
			) AS tBaseTypeComputation 

		OUTER APPLY 
			(
				SELECT 
					(
						SELECT 
							-- ,clmns.is_nullable 
							-- ,tComputedProperties.ORDINAL_POSITION
							-- ,tComputedProperties.COLUMN_DEFAULT

							  CASE WHEN tComputedProperties.ORDINAL_POSITION = 1 THEN N' ' ELSE N',' END 
							+ QUOTENAME(clmns.name) 
							+ N' '
							+ tComputedProperties.DATA_TYPE 
							+ 
							CASE 
								WHEN tComputedProperties.DATA_TYPE IN ('char', 'varchar', 'nchar', 'nvarchar', 'binary', 'varbinary') 
									THEN N'(' 
										+ 
										CASE WHEN tComputedProperties.CHARACTER_MAXIMUM_LENGTH = -1 THEN 'MAX'
											ELSE CONVERT
												(
													varchar(4)
													,tComputedProperties.CHARACTER_MAXIMUM_LENGTH 
												)
										END 
										+ N')' 
								WHEN tComputedProperties.DATA_TYPE IN ('decimal', 'numeric')
									THEN N'(' + CONVERT(varchar(4), tComputedProperties.NUMERIC_PRECISION) + N', ' + CONVERT(varchar(4), tComputedProperties.NUMERIC_SCALE) + N')'
								WHEN tComputedProperties.DATA_TYPE IN ('time', 'datetime2', 'datetimeoffset') 
									THEN N'(' + CAST(tComputedProperties.DATETIME_PRECISION AS national character varying(36)) + N')' 
								ELSE N'' 
							END 
							+ CASE WHEN tComputedProperties.is_nullable = 0 THEN N' NOT NULL' ELSE N'' END 
							+ NCHAR(13) + NCHAR(10) 
							AS [text()]
						FROM sys.columns AS clmns 
						INNER JOIN sys.types AS t ON t.system_type_id = clmns.system_type_id 
						LEFT JOIN sys.types ut ON ut.user_type_id = clmns.user_type_id 

						OUTER APPLY 
							(
								SELECT 
									 33 As bb 
									,COLUMNPROPERTY(clmns.object_id, clmns.name, 'ordinal')  AS ORDINAL_POSITION 
									,COLUMNPROPERTY(clmns.object_id, clmns.name, 'charmaxlen') AS CHARACTER_MAXIMUM_LENGTH 
									,COLUMNPROPERTY(clmns.object_id, clmns.name, 'octetmaxlen') AS CHARACTER_OCTET_LENGTH 
									,CONVERT(nvarchar(4000), OBJECT_DEFINITION(clmns.default_object_id)) AS COLUMN_DEFAULT 

									,clmns.is_nullable 
									,t.name AS DATA_TYPE

									,CONVERT(tinyint, 
										CASE -- int/decimal/numeric/real/float/money  
											WHEN clmns.system_type_id IN (48, 52, 56, 59, 60, 62, 106, 108, 122, 127) THEN clmns.precision  
										END
									 ) AS NUMERIC_PRECISION 

									,CONVERT(int, 
										CASE -- datetime/smalldatetime  
											WHEN clmns.system_type_id IN (40, 41, 42, 43, 58, 61) THEN NULL  
											ELSE ODBCSCALE(clmns.system_type_id, clmns.scale) 
										END
									 ) AS NUMERIC_SCALE

									,CONVERT(smallint, 
										 CASE -- datetime/smalldatetime  
											WHEN clmns.system_type_id IN (40, 41, 42, 43, 58, 61) THEN ODBCSCALE(clmns.system_type_id, clmns.scale) 
										 END
									) AS DATETIME_PRECISION 
							) AS tComputedProperties  

						WHERE clmns.object_id = userDefinedTableTypes.type_table_object_id 
						ORDER BY tComputedProperties.ORDINAL_POSITION 

						FOR XML PATH(''), TYPE 
					).value('.', 'nvarchar(MAX)') AS column_definition 
			) AS tAllColumns  

		WHERE userDefinedTypes.is_user_defined = 1 


	OPEN db_cursor  
	FETCH NEXT FROM db_cursor INTO @ROUTINE

	WHILE @@FETCH_STATUS = 0  
    BEGIN  
		EXEC [SYS_WriteToFile] @FNFILENAME_NEW, @ROUTINE
		EXEC [SYS_WriteToFile] @FNFILENAME_NEW, 'GO'

		FETCH NEXT FROM db_cursor INTO @ROUTINE
    END 
 
    CLOSE db_cursor  
	DEALLOCATE db_cursor 



-- Now get all the functions

	DECLARE db_cursor CURSOR LOCAL STATIC FOR 
		select iif(x.status = 'UPDATE', replace(i.definition,'CREATE ','ALTER '),i.definition) as [ROUTINE_DEFINITION], x.status
		from (
			select * from (
				select 'NEW' as [Status], name AS [Name], create_date as [Date], 'create_date' as [DateType], 'Function' as [Artifact]
				from sys.all_objects where [Type] in ('FN','IF','AF','TF','FS') and [is_ms_shipped] = 0 and NOT [Name] like '%_X' and create_date >= @After

				UNION 

				select 'UPDATE' as [Status],  name AS [Name], modify_date as [Date], 'modify_date' as [DateType], 'Function' as [Artifact]
				from sys.all_objects where [Type] in ('FN','IF','AF','TF','FS') and [is_ms_shipped] = 0 and NOT [Name] like '%_X' and modify_date >= @After and NOT create_date >= @After

			) a where a.[Artifact] = 'Function'
		) x
		LEFT JOIN sys.sql_modules i on i.object_id=OBJECT_ID(x.[Name])
		where i.definition IS NOT NULL
		order by [Status], [Artifact], [Date] Desc


--	select [name] , 'Function' as [type], type_desc as [Description], modify_date as [LastUpdate]
--	from sys.all_objects where [Type] in ('FN','IF','AF','TF','FS') and [is_ms_shipped] = 0 and NOT [Name] like '%_X' and modify_date >= @After and NOT create_date >= @After



	OPEN db_cursor  
	FETCH NEXT FROM db_cursor INTO @ROUTINE, @SPSTATUS

	WHILE @@FETCH_STATUS = 0  
    BEGIN  
		IF @SPSTATUS = 'UPDATE' 
		BEGIN
			EXEC [SYS_WriteToFile] @FNFILENAME_UPDATE, @ROUTINE
			EXEC [SYS_WriteToFile] @FNFILENAME_UPDATE, 'GO'
		END
		ELSE
		BEGIN
			EXEC [SYS_WriteToFile] @FNFILENAME_NEW, @ROUTINE
			EXEC [SYS_WriteToFile] @FNFILENAME_NEW, 'GO'
		END

		FETCH NEXT FROM db_cursor INTO @ROUTINE, @SPSTATUS
    END 
 
    CLOSE db_cursor  
	DEALLOCATE db_cursor 

	set @SQL =N''









-- CREATE ALL FOREIGN KEYS

	EXEC [SYS_WriteToFile] @CREATEFKFILE, '', 1

    SELECT @SQL = @SQL + @vbCrLf + 'ALTER TABLE ['+ [TABLE_NAME] + '] ADD ' + [MyAlias].[Command] FROM
	(
	SELECT
		DISTINCT
		--FK must be added AFTER the PK/unique constraints are added back.
		850 AS [ExecutionOrder],
		'CONSTRAINT ' 
		+ QUOTENAME([conz].[name]) 
		+ ' FOREIGN KEY (' 
		+ [ChildCollection].[ChildColumns] 
		+ ') REFERENCES ' 
		+ QUOTENAME(SCHEMA_NAME([conz].[schema_id])) 
		+ '.' 
		+ QUOTENAME(OBJECT_NAME([conz].[referenced_object_id])) 
		+ ' (' + [ParentCollection].[ParentColumns] 
		+ ') ' 
		+  CASE [conz].[update_referential_action]
											WHEN 0 THEN '' --' ON UPDATE NO ACTION '
											WHEN 1 THEN ' ON UPDATE CASCADE '
											WHEN 2 THEN ' ON UPDATE SET NULL '
											ELSE ' ON UPDATE SET DEFAULT '
										END
						+ CASE [conz].[delete_referential_action]
											WHEN 0 THEN '' --' ON DELETE NO ACTION '
											WHEN 1 THEN ' ON DELETE CASCADE '
											WHEN 2 THEN ' ON DELETE SET NULL '
											ELSE ' ON DELETE SET DEFAULT '
										END
						+ CASE [conz].[is_not_for_replication]
							WHEN 1 THEN ' NOT FOR REPLICATION '
							ELSE ''
						END
		+ ';' + @vbCrLf AS [Command],  po.[name] as [TABLE_NAME]
	FROM   [sys].[foreign_keys] AS [conz]
	INNER JOIN [sys].[foreign_key_columns] AS [colz] ON [conz].[object_id] = [colz].[constraint_object_id]
 	LEFT JOIN  [sys].[objects] po on po.[object_id] = [conz].[parent_object_id]      
	INNER JOIN (--gets my child tables column names   
		SELECT 	[conz].[name],
		--technically, FK's can contain up to 16 columns, but real life is often a single column. coding here is for all columns
		[ChildColumns] = STUFF((SELECT 
								',' + QUOTENAME([REFZ].[name])
							FROM   [sys].[foreign_key_columns] AS [fkcolz]
									INNER JOIN [sys].[columns] AS [REFZ]
									ON [fkcolz].[parent_object_id] = [REFZ].[object_id]
										AND [fkcolz].[parent_column_id] = [REFZ].[column_id]
							WHERE [fkcolz].[parent_object_id] = [conz].[parent_object_id]
								AND [fkcolz].[constraint_object_id] = [conz].[object_id]
								ORDER  BY
							[fkcolz].[constraint_column_id]
							FOR XML PATH(''), TYPE).[value]('.','varchar(max)'),1,1,'')
		FROM   [sys].[foreign_keys] AS [conz]
		INNER JOIN [sys].[foreign_key_columns] AS [colz] ON [conz].[object_id] = [colz].[constraint_object_id]
		GROUP  BY [conz].[name], [conz].[parent_object_id],--- without GROUP BY multiple rows are returned
			[conz].[object_id]
	) AS [ChildCollection] 	ON [conz].[name] = [ChildCollection].[name]
	INNER JOIN (--gets the parent tables column names for the FK reference
				SELECT [conz].[name],
					[ParentColumns] = STUFF((SELECT
											',' + [REFZ].[name]
										FROM   [sys].[foreign_key_columns] AS [fkcolz]
										INNER JOIN [sys].[columns] AS [REFZ] ON [fkcolz].[referenced_object_id] = [REFZ].[object_id] AND [fkcolz].[referenced_column_id] = [REFZ].[column_id]
										WHERE  [fkcolz].[referenced_object_id] = [conz].[referenced_object_id] 	AND [fkcolz].[constraint_object_id] = [conz].[object_id]
										ORDER BY [fkcolz].[constraint_column_id]
										FOR XML PATH(''), TYPE).[value]('.','varchar(max)'),1,1,'')
				FROM   [sys].[foreign_keys] AS [conz]
				INNER JOIN [sys].[foreign_key_columns] AS [colz]
				ON [conz].[object_id] = [colz].[constraint_object_id]
				-- AND colz.parent_column_id 
				GROUP  BY [conz].[name], [conz].[referenced_object_id],--- without GROUP BY multiple rows are returned
					[conz].[object_id]
				) AS [ParentCollection]
		ON [conz].[name] = [ParentCollection].[name]
	) AS [MyAlias];


	EXEC [SYS_WriteToFile] @CREATEFKFILE, @SQL

	DECLARE @ReleaseDate nvarchar(255) 
	SELECT @ReleaseDate = FORMAT(GetDate(), 'yyyy-MM-dd')

	DECLARE @Command nvarchar(500)
	SET @Command = '"C:\Program Files\7-Zip\7z.exe"  -tzip -r a ' + @DUMPFOLDER + 'CV_RELEASE_' + @ReleaseDate + ' ' +  @DUMPFOLDER 

	EXEC MASTER..xp_cmdshell @Command
END




GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[DashboardGetItems]
	-- Add the parameters for the stored procedure here
@DashBoardID int = 0,
@ChartID int = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	select IsNull(db.[Name],'') as [Name], d.[DashBoardItemID], d.[DashBoardID], d.[ItemID], d.[ItemType], IsNull(d.[Level],0) as [Level] ,isNull(c.[Prerequisite],isNull(f.[Prerequisite],isNull(i.[Prerequisite],isNull(w.[Prerequisite]
	,isNull(v.[Prerequisite],''))))) as [Prerequisite] ,isNull(c.[NotSetMarkers],isNull(f.[NotSetMarkers],isNull(i.[NotSetMarkers],isNull(w.[NotSetMarkers],isNull(v.[NotSetMarkers],''))))) as [NotSetMarkers] 
	,isNull(d.[Height],0) as ItemHeight, d.[Order], isNull(d.[Units],4) as [Units], isNull(c.[ShowTotal],0) as ShowTotal ,c.ChartID, IsNull(c.ChartTitle,'') as ChartTitle, IsNull(c.[Type],'PieChart') as ChartType
	, IsNull(c.[Data],'') as [ChartData], IsNull(c.[Transpose],0) as [Transpose], IsNull(c.[EventHandler],'') as EventHandler, IsNull(c.[fieldStyles],'') as fieldStyles ,IsNull(c.[Options],'') as [ChartOptions]
	, Cast(IsNull(c.[SQL],'') as nvarchar(4000)) as [ChartSQL], IsNull(c.[URL],'') as [ChartURL], cast(IsNull(c.Description,'') as varchar(3000)) as [ChartDescription] ,t.TextID
	, IsNull(t.TextTitle,'NO TITLE') as [TextTitle], IsNull(t.[URL],'') as [TextURL], IsNull(t.NoBorder,0) as TextNoBorder, Cast(IsNull(t.[TextValue],'') as nvarchar(4000)) as [TextValue] 
	,IsNull(f.FilterTitle,'FILTER TITLE') as [FilterTitle], Cast(IsNull(f.[FilterSQL],'') as nvarchar(4000)) as [FilterSQL], IsNull(f.[Marker],'NoMarker') as [Marker], IsNull(f.[OnChangeClear],'') as [OnChangeClear] 
	,IsNull(i.[FrameURL],'') as [FrameURL], IsNull(i.FrameTitle,'FRAME TITLE') as [FrameTitle], IsNull(i.[LinkURL],'') as [LinkURL] ,IsNull(s.SectionTitle,'') as [SectionTitle]
	, [dbo].[fnColourClasstoRGB](IsNull(s.BackgroundColour,'#ffffff')) as [SectionColour], IsNull(s.HeadingColour,'#ffffff') as [HeadingColour], IsNull(s.Heading,'H3') as [Heading] ,IsNull(w.WidgetTitle,'') as [WidgetTitle], IsNull(w.Type,'') as WidgetType
	, IsNull(w.Param1,'') as WidgetParam1, IsNull(w.Param2,'') as WidgetParam2, IsNull(w.Condition,'') as WidgetCondition, IsNull(w.WidgetSQL,'') as WidgetSQL, IsNull(w.URL,'') as WidgetURL, IsNull(w.Icon,'') as WidgetIcon 
	,IsNull(v.VennTitle,'') as [VennTitle], IsNull(v.Style,'') as [VennStyle], IsNull(v.Data,'') as [VennData], IsNull(v.Width,'500') as [VennWidth], IsNull(v.Height,'276') as [VennHeight] 
	from [ARM_CORE]..[A_DashBoardItem] d LEFT JOIN [ARM_CORE]..[Chart] c on c.ChartID = ItemID and d.[ItemType] = 'Chart' 
	LEFT JOIN [ARM_CORE]..[DashboardFilter] f on f.FilterID = ItemID and d.[ItemType] = 'DashboardFilter' 
	LEFT JOIN [ARM_CORE]..[DashboardText] t on t.TextID = ItemID and d.[ItemType] = 'DashboardText' 
	LEFT JOIN [ARM_CORE]..[DashboardFrame] i on i.FrameID = ItemID and d.[ItemType] = 'DashboardFrame' 
	LEFT JOIN [ARM_CORE]..[DashboardSection] s on s.DashboardSectionID = ItemID and d.[ItemType] = 'DashboardSection' 
	LEFT JOIN [ARM_CORE]..[Venn] v on v.VennID = ItemID and d.[ItemType] = 'Venn' 
	LEFT JOIN [ARM_CORE]..[DashboardWidget] w on w.WidgetID = ItemID and d.[ItemType] = 'DashboardWidget' 
	LEFT JOIN [ARM_CORE]..[A_Dashboard] db on db.DashboardID = d.[DashBoardID] 
	where d.[DashBoardID] = @DashBoardID and IsNull(d.Active,1) = 1 and (c.ChartID = @ChartID or @ChartID = 0)
	order by d.[Order]
END

GO



CREATE PROCEDURE [dbo].[sp_Sync]
AS
BEGIN
SET NOCOUNT ON
	DECLARE @sql NVARCHAR(MAX),
			@sqlCondition NVARCHAR(MAX),
			@sql2 NVARCHAR(255),
			@condition nvarchar(255),
			@params NVARCHAR(255),
			@sqlResult INT, 
			@conditionOut VARCHAR(1),
			@mailTo Varchar(255),
			@minID INT,
			@maxID INT

	SELECT @minID = MIN(syncID),
			@maxID = MAX(syncID)
	FROM [SYS_Synchronise]
	WHERE active = 1 

	--select * from sys_AGENT

	WHILE @minID <= @maxID
	BEGIN

		SELECT @sql = syncSQL
		FROM [SYS_Synchronise] 
		WHERE syncID = @minID

		IF @sql <> '' 
		BEGIN
	
				EXEC  @sqlResult = sp_executesql @sql
				IF @sqlResult = 0 
				BEGIN
					update [SYS_Synchronise] set LastRun =GETDATE() where syncID = @minID

				END
				--ELSE
				--BEGIN
					----send mail 
					--SELECT @mailTo = propertyValue FROM SystemGlobalProperties WHERE  PropertyName = 'AutoEmail'
					--EXEC msdb.dbo.sp_send_dbmail @profile_name = '',
					-- @recipients = @mailTo,
					-- @subject = '',
					-- @body = '',
					-- @body_format = 'HTML'
				--END
			
		END 
	SELECT @minID = MIN(syncID)
	From [SYS_Synchronise]
	WHERE active = 1 and syncID > @minID 
	
	END
	 
END


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SYS_EVENT_SCRIPT]
	@EVENTID int
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

-- Move items from Collection based on Day Trigger

	DECLARE @CID int;
    DECLARE @DAYTRIGGER nvarchar(100);
	DECLARE @SQL NVARCHAR(MAX);
    DECLARE @EVENTTYPE nvarchar(250);
	
	DECLARE @mSQL NVARCHAR(MAX);
	DECLARE @params NVARCHAR(1000);


	SELECT TOP 1 
		 @CID = e.[CollectionID]
		, @EVENTTYPE = [EventType]
		, @SQL = e.[SQL]
		, @DAYTRIGGER = IsNull(e.[DayTrigger],'-1')
	FROM [ARM_CORE].[dbo].[Sys_Event] e 
	where [EventID] = @EVENTID 

	-- All items that have hit the DayTrigger are made available in @TriggerItems
	-- TriggerItem is a User-Define Table Type that includes one field called itemID of type nvarchar(255)


	DECLARE @TriggerItems TriggerItem

	if @DAYTRIGGER = '' set @DAYTRIGGER = '-1'

	-- Capture those items that meet the Day Trigger criteria

	set @mSQL = N'select distinct i.itemID from [ARM_CORE]..[A_CollectionItem] i where i.CollectionID = @collectionID and (DATEDIFF(day, i.TaggedOn, GETDATE()) in ( @daytrigger  ) or -1 in ( @daytrigger )) ' 
	SET @params = N'@collectionID INT, @daytrigger nvarchar(100)'
	INSERT INTO @TriggerItems  EXEC sp_executesql @mSQL, @params, @collectionID = @CID, @daytrigger = @DAYTRIGGER



	-- The SQL can include references to @collectionID, @daytrigger and @TriggerItems.
	-- we can extend this to include others as need be.

	SET @params = N'@collectionID INT, @daytrigger nvarchar(100), @TriggerItems TriggerItem readonly'
	EXEC sp_executesql @SQL, @params, @collectionID = @CID, @daytrigger = @DAYTRIGGER, @TriggerItems = @TriggerItems
		

END

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SYS_EVENT_MOVE]
	@EVENTID int
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

-- Move items from Collection based on Day Trigger

	DECLARE @CID int;
    DECLARE @DAYTRIGGER nvarchar(1000);
	DECLARE @SQL NVARCHAR(MAX);
	DECLARE @params NVARCHAR(1000);

	DECLARE @TargetID int;
    DECLARE @TargetClassID int;
    DECLARE @TargetDistinct bit;


	SELECT TOP 1 
		 @CID = e.[CollectionID]
		, @DAYTRIGGER = IsNull(e.[DayTrigger],'-1')
		, @TargetID = t.CollectionID
		, @TargetClassID = t.CollectionClassID 
		, @TargetDistinct =  tt.[Distinct] 
	FROM [ARM_CORE].[dbo].[Sys_Event] e 
	LEFT JOIN [A_Collection] c on c.CollectionID = e.CollectionID
	LEFT JOIN [A_Collection] t on t.CREF = e.[TargetCollectionRef] and IsNull(t.CREF,'') <> ''
	LEFT JOIN [A_CollectionClass] tt on tt.CollectionClassID = t.CollectionClassID
	where [EventID] = @EVENTID 


	DECLARE @MoveItems TABLE (
		itemID	nvarchar(255)
	);

	if @DAYTRIGGER = '' set @DAYTRIGGER = '-1'

	-- Capture those items that meet the Day Trigger criteria
	-- TaggedOn date should never be in future so @DayTrigger should always be positive
	-- If negative ignore

	set @SQL = N'select distinct i.itemID from [ARM_CORE]..[A_CollectionItem] i where i.CollectionID = @collectionID and DATEDIFF(day, i.TaggedOn, GETDATE()) in ( @daytrigger  ) and NOT DATEDIFF(day, i.TaggedOn, GETDATE()) < 0' 
	SET @params = N'@collectionID INT, @daytrigger nvarchar(100)'
	INSERT INTO @MoveItems  EXEC sp_executesql @SQL, @params, @CollectionID = @CID, @daytrigger = @DAYTRIGGER

	-- Remove those items from collection prior to move

	MERGE [ARM_CORE]..[A_CollectionItem] as TARGET
	USING ( 
		select distinct i.itemID, @CID as CollectionID from @MoveItems i
	) as SOURCE
	On (TARGET.[ItemID] = SOURCE.[Itemid] and TARGET.[CollectionID] = SOURCE.[CollectionID]) 
	WHEN MATCHED THEN
		DELETE;


-- Add the items to the destination Collection
-- as Move is always a Scheduled event we can rely on Trigger to take Distinct into account for distination class.

	insert into A_CollectionItem (ItemID, CollectionID)
	select ItemID, @TargetID from @MoveItems 		

END

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SYS_EVENT_REMOVE]
	-- Add the parameters for the stored procedure here
	@EVENTID int
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

-- Remove items from Collection based on Day Trigger

	DECLARE @CID int;
    DECLARE @DAYTRIGGER nvarchar(1000);
	DECLARE @SQL NVARCHAR(MAX);
	DECLARE @params NVARCHAR(1000);

	-- Like SYNCHRONISE EVENT only CollectionID is Target and Source is taken from SQL Field

	SELECT TOP 1 
		 @CID = e.[CollectionID]
		, @DAYTRIGGER = e.[DayTrigger]
	FROM [ARM_CORE].[dbo].[Sys_Event] e 
	LEFT JOIN [A_Collection] c on c.CollectionID = e.CollectionID
	LEFT JOIN [A_CollectionClass] cc on cc.CollectionClassID = c.CollectionClassID
	where [EventID] = @EVENTID


-- Get the hopeful contenders !

	set @SQL = N'
	MERGE [ARM_CORE]..[A_CollectionItem] as TARGET
	USING ( 
		select distinct i.itemID, i.CollectionID from [ARM_CORE]..[A_CollectionItem] i
		where i.CollectionID = @collectionID and DATEDIFF(day, i.TaggedOn, GETDATE()) in ( @daytrigger  )
	) as SOURCE
	On (TARGET.[ItemID] = SOURCE.[Itemid] and TARGET.[CollectionID] = SOURCE.[CollectionID]) 
	WHEN MATCHED THEN
		DELETE;
	'

	SET @params = N'@CollectionID INT, @daytrigger nvarchar(1000)'
	EXEC sp_executesql @SQL, @params, @collectionID = @CID, @daytrigger = @DAYTRIGGER			

END

GO
CREATE PROCEDURE [dbo].[SYS_EVENT_DISCOVER]
       -- Add the parameters for the stored procedure here
       @EVENTID int
AS
BEGIN
       -- SET NOCOUNT ON added to prevent extra result sets from
       -- interfering with SELECT statements.
       SET NOCOUNT ON;

-- Modes are as follows
       --  SYNCHRONISE                   -  Add_Move_Purge                              - 0 - MERGE & PURGE  (target collection retains exact copy of source collection only )
       --  COLLECT                       -  Add_Move                                           - 1 - MERGE NO PURGE  (add new items identified from source collection to those items already present in target collection)

       --  SIEVE PURGE                   -  Add_Purge                                   - 2 - NEW TO CLASS ONLY & PURGE   (only add to target collection if items do not appear in class collections already)
       --  SIEVE PROTECT          -  Add_Move_Protect_Purge                - 3 - DONT MOVE ITEMS IF PROTECTED (add to target collection if items do not appear in a protected collection within class already)
       --     SIEVE ADD                  -  Add                                               - 4 - NEW TO CLASS ONLY (NO PURGE)
       --  SIEVE ADD PROTECT      -  Add_Move_Protect                             - 5    - NOT IN A PROTECTED COLLECTION WITHIN CLASS (NO PURGE)

       --  SUBTRACT               -  Subtract                                          - 6 - REMOVE FROM TARGET COLLECTION


       DECLARE @CID int;
    DECLARE @SYNCHRONISETYPE nvarchar(250);
       DECLARE @TargetID int;
    DECLARE @TargetClassID int;
    DECLARE @TargetDistinct bit;
    DECLARE @SQL nvarchar(max);
       DECLARE @params nvarchar(4000)

       -- Like SYNCHRONISE EVENT only CollectionID is Target and Source is taken from SQL Field

       SELECT TOP 1 
              @CID = e.[CollectionID]
             , @SYNCHRONISETYPE = e.[SynchroniseType]
             , @TargetID = c.CollectionID
             , @TargetClassID = c.CollectionClassID 
             , @TargetDistinct =  cc.[Distinct] 
             , @SQL = e.[SQL]
       FROM [ARM_CORE].[dbo].[Sys_Event] e 
       LEFT JOIN [A_Collection] c on c.CollectionID = e.CollectionID
       LEFT JOIN [A_CollectionClass] cc on cc.CollectionClassID = c.CollectionClassID
       where [EventID] = @EVENTID


-- Get the hopeful contenders !

       DECLARE @SourceItems TABLE (
             ItemID nvarchar(255)
       );
       DECLARE @Discovered TABLE (
             ItemID nvarchar(255)
       );

       INSERT INTO @Discovered  EXEC sp_executesql @sql
       INSERT INTO @SourceItems  select * from @Discovered

       IF @SYNCHRONISETYPE = 6 
       BEGIN
             -- If "Remove" then remove items from destination collection if present.
             delete from A_CollectionItem where CollectionID = @TargetID 
                    and ItemID in (
                           select distinct ItemID from @Discovered
                    )            
       END
       ELSE
       BEGIN
       -- Remove those that dont qualify !

             IF @SYNCHRONISETYPE = 2 or @SYNCHRONISETYPE = 4
             BEGIN
             -- remove items candidates already in class (i.e. keep those that are new)

                    delete from @SourceItems where ItemID in (
                           select distinct i.ItemID from A_CollectionItem i
                           LEFT JOIN A_Collection c on c.CollectionID = i.CollectionID
                           where c.CollectionClassID = @TargetClassID 
                    )      
             END
             ELSE
             BEGIN
                    IF @SYNCHRONISETYPE = 3 or  @SYNCHRONISETYPE = 5
                    BEGIN
                    -- remove item candidates if already contained in Protected collection within class
                           delete from @SourceItems where ItemID in (
                                 select distinct i.ItemID from A_CollectionItem i
                                 LEFT JOIN A_Collection c on c.CollectionID = i.CollectionID
                                 where c.CollectionClassID = @TargetClassID and IsNull(c.Protect,0) = 1
                           )
                    END
                    ELSE
                    BEGIN
                    --Candidates are items that are new to Target Collection regardless if alreay in class
                           delete from @SourceItems where ItemID in (
                                 select distinct ItemID from A_CollectionItem 
                                 where CollectionID = @TargetID 
                           )
                    END
             END

             if @SYNCHRONISETYPE = 0 or @SYNCHRONISETYPE = 2 or @SYNCHRONISETYPE = 3
             BEGIN

                    -- Need to Purge.  Remove items in target that are not part of Discovery set

                    delete from A_CollectionItem where CollectionID = @TargetID 
                           and NOT ItemID in (
                                 select distinct ItemID from @Discovered
                           )        
             END

             -- Check if target collection is Distinct.  If so remove new items from class if not SIEVE

             if @TargetDistinct = 1
                    MERGE [ARM_CORE]..[A_CollectionItem] as TARGET
                    USING ( 
                           select distinct i.itemID, i.CollectionID from [ARM_CORE]..[A_Collection] c
                           LEFT JOIN [ARM_CORE]..[A_CollectionItem] i on i.CollectionID = c.CollectionID
                           LEFT JOIN @SourceItems y on y.ItemID = i.ItemID
                           where c.CollectionClassID = @TargetClassID and c.CollectionID <> @TargetID and y.ItemID IS NOT NULL
                    ) as SOURCE
                    On (TARGET.[ItemID] = SOURCE.[Itemid] and TARGET.[CollectionID] = SOURCE.[CollectionID]) 
                    WHEN MATCHED THEN
                           DELETE;
       

             -- Now add whats left as long as it isnt already in Collection

             MERGE [ARM_CORE]..[A_CollectionItem] as TARGET
             USING ( 
                    select ItemID, @TargetID as CollectionID from @SourceItems where ItemID IS NOT NULL
             ) as SOURCE
             On (TARGET.[ItemID] = SOURCE.[Itemid] and TARGET.[CollectionID] = SOURCE.[CollectionID]) 
             WHEN NOT MATCHED BY TARGET THEN
                    INSERT (ItemID, CollectionID) VALUES (SOURCE.ItemID, SOURCE.CollectionID);


       END

END

GO
CREATE proc [dbo].[SYS_EVENT_MAILER] (@eventID INT)
as
begin

SET NOCOUNT ON;
DECLARE @templateID INT,
		@minEventID INT, 
		@CollectionID INT, @CollectionName varchar(255), @ClassID INT, @ClassName nvarchar(255),
		@SQL NVARCHAR(MAX),
		@params NVARCHAR(255),
		@messagetext NVARCHAR(max),	@templatetext NVARCHAR(max), 
		@messagetextOut NVARCHAR(max),
		@subject NVARCHAR(max), @messagesubject NVARCHAR(max),
		@type NVARCHAR(100), @eventType  NVARCHAR(100), 
		@daytrigger NVARCHAR(1000),
		@FieldID INT, @minFieldID INT, @maxFieldID INT, @tableID INT, @assetID NVARCHAR(300),
		@dataset nvarchar(100),
		@PayLoadSQL NVARCHAR(max),@throttle nvarchar(100),  @pass INT, @ThrottleStr NVARCHAR(30),
		@payloadOutput  NVARCHAR(max),
		@payloadRecordCount INT,
		@PayloadAttachment BIT, @payloadAttachmentPath NVARCHAR(255), @payloadSupressOnEmpty BIT, 
		@signaturePath NVARCHAR(100), 
		@signatureMarker  NVARCHAR(100),
		@signatureReplacementMarker  NVARCHAR(100),
		@attachment NVARCHAR(max),@colName NVARCHAR(100),
		@mailTo NVARCHAR(255),
		@SendFrom NVARCHAR(255),
		@ReplyTo NVARCHAR(255),
		@BccTo NVARCHAR(255),
		@ReadReceipt BIT,
		@Important BIT, @userID INT, @RecipientID INT,
		@usermaxID INT,  @hour INT,
		@minMailItem int, @maxMailItem int, @MailItem nvarchar(500),
		@datasetSQL NVARCHAR(MAX)


	-- Get the key information from the event

	select @templateID = e.TemplateID 
			,@CollectionID = e.CollectionID
			,@daytrigger = IsNull(e.daytrigger, '0')
			,@eventType = e.EventType
			,@throttle = isNull(t.templateThrottle,'')
			,@templatetext = isNull(t.Template,'')
			,@subject = isNull(t.[subject],'')
			,@dataset = isNull(t.dataset,0)
			,@datasetSQL = IsNull(d.SQLStatement,'')
			,@CollectionName = c.[Name]
			,@ClassID = cc.[CollectionClassID]
			,@ClassName = cc.[Name]
			,@Important = IsNull(t.Important,0)
			,@ReadReceipt = IsNull(t.ReadReceipt,0)
			,@SendFrom = IsNull(t.SendFrom,0)
			,@BccTo = IsNull(t.BCC,0)
	FROM [Sys_Event] e
	LEFt JOIN NotificationTemplate t on t.templateID = e.TemplateID
	LEFT JOIN [A_templateSQLStatement] d on d.templateSQLStatementID = t.dataset
	LEFT JOIN [A_Collection] c on c.CollectionID = e.CollectionID 
	LEFT JOIN [A_CollectionClass] cc on cc.CollectionClassID = c.CollectionClassID
	WHERE EventID  = @EventID
	
	-- replace SNIPPETS if present within Template body

	IF CHARINDEX('{SNIP_',@templatetext) > 0 
	BEGIN
		EXEC dbo.sp_MailerSnippets @templatetext, @messagetextOut OUTPUT
		SET @templatetext = @messagetextOut
	END	
		
	--replaces images.  Images must be loaded into database
	IF CHARINDEX('{IMAGE',@templatetext) > 0 
	BEGIN	
		EXEC sp_mailerSignatures @templatetext, @messagetextOut OUTPUT
		SET @templatetext = @messagetextOut
		--SET @attachment = CONCAT(@attachment, @signaturePath)
	END	


	-- This routine is being called becuase the event is active and has already passed the "Frequenecy" test.
	--  Get items from collection (if any) that match day trigger.  These are the items that will be mailed to.

	DECLARE @MailToItem TABLE (
		[MailToItemID] [int] IDENTITY(1,1) NOT NULL,
		[itemID]	nvarchar(255),
		[TAGGEDON]	smalldatetime,
		[DaysSince]	INT
	);

	if @DAYTRIGGER = '' set @DAYTRIGGER = '0'

	-- Capture those items that meet the Day Trigger criteria
	-- if @Daytrigger is -1 then "every day"
	-- TaggedOn date should never be in future so @DayTrigger should always be positive
	-- if throttle set, get n items as specidfied by trottle- Note each item may then generate more than one email (e.g.  may be more than one tester or appowner)

	-- MAY NEED TO MODIFY SQL CALL SO THAT NOTIFICATION LOG CONSIDERED TO PREVENT SPAMMING!


	IF @Throttle <> '' and @Throttle <> '0' 
		set @ThrottleStr = N' top ' + cast(@throttle as nvarchar(20)) 
	else
		set @ThrottleStr = ''


	set @SQL = N'select distinct ' + @ThrottleStr + ' i.itemID, i.[TaggedOn], DATEDIFF(d, i.[TAGGEDON], getdate()) as DaysSince 
		FROM [ARM_CORE]..[A_CollectionItem] i 
		LEFT JOIN NotificationLog n on n.AssetID = i.itemID and DATEDIFF(d, n.WhenSent, getdate() ) = 0 and n.templateID = ' + cast(@templateID as nvarchar(20))  + ' 
		where i.CollectionID = @collectionID and NOT i.itemID IS NULL and n.NotificationLogID IS NULL and ((DATEDIFF(day, i.TaggedOn, GETDATE()) in ( @daytrigger  ) and NOT DATEDIFF(day, i.TaggedOn, GETDATE()) < 0 ) or @daytrigger= -1)' 


	SET @params = N'@collectionID INT, @daytrigger nvarchar(100)'
	INSERT INTO @MailToItem  EXEC sp_executesql @SQL, @params, @CollectionID = @CollectionID, @daytrigger = @DAYTRIGGER



	SELECT @minMailItem = MIN([MailToItemID]),	@maxMailItem = MAX([MailToItemID]) FROM @MailToItem

	WHILE @minMailItem <= @maxMailItem 
	BEGIN

		select @MailItem = itemID from @MailToItem where [MailToItemID] = @minMailItem


		SELECT @SQL = 'IF EXISTS(SELECT [name] FROM tempdb.sys.tables WHERE [name] like ''##tempdataEvent'+cast(@eventID as nvarchar(20))+''') DROP TABLE ##tempdataEvent'+cast(@eventID as nvarchar(20))
		EXEC(@SQL)

		select @SQL = 'select qx.* , ROW_NUMBER() OVER(ORDER BY qx.ItemID) as rowID_ INTO ##tempDataEvent'+cast(@eventID as nvarchar(20))+' from (' + @datasetSQL + ') qx '


	-- Capture recipients from item driven by A_templateSQLStatemnt (aka dataset SQL)
	-- table ##tempDataEvent{EventID}  is created containing ALL fields that may be used as {MARKERS} in notification
	-- Dataset SQL MUSt contain a [SendToEmail] field for recipient and a field called ItemID


		SET @params = N'@CollectionID INT,  @ItemID nvarchar(500)'
		EXEC sp_executesql @sql, @params, @CollectionID = @CollectionID, @ItemID = @MailItem



		-- Get range of field Ids and tableID of ##tempDataEvent
		-- Each dataset might have a different set of column names and types 
		-- Step through the syscolumns to find out what they are
		
		SELECT	@minFieldID = MIN(colid), @maxFieldID = MAX(colid), @tableID  = max(a.id)
		From tempdb..syscolumns a inner join tempdb..sysobjects b on a.id = b.id 	
		where b.id = object_id('tempdb..##tempDataEvent'+cast(@eventID as nvarchar(20)))
	

		SET @SQL = 'SELECT	@RecipientID = MIN([rowID_]),@usermaxID = MAX([rowID_]) From ##tempDataEvent'+cast(@eventID as nvarchar(20))
		SET @params = N'@RecipientID INT OUTPUT, @usermaxID INT OUTPUT'
		exec sp_executesql @SQL, @params, @RecipientID =  @RecipientID OUTPUT,  @usermaxID = @usermaxID OUTPUT


		WHILE @RecipientID <= @usermaxID 
		BEGIN

			-- reset notification text and subject ready for mail merge with markers.

			set @messagetext = @templatetext
			set @messagesubject = @subject
			set @FieldID = @minFieldID 

			-- step through all fields replacing {MARKERS} if found.

			WHILE @FieldID <= @maxFieldID 
			BEGIN
					
				SELECT @colName = [name] FROM  tempdb..syscolumns WHERE colID = @FieldID and id = @tableID
		
				SET @sql = N'SELECT @messagetext = REPLACE(@messagetext, ''{' + @colName + '}'',CAST(COALESCE([' + @colName + '],'''') AS VARCHAR(MAX))) FROM ##tempDataEvent'+cast(@eventID as nvarchar(20))+' WHERE rowID_ = @userID'
				SET @params = N'@messagetext nvarchar(MAX) OUTPUT, @userID INT'
				exec sp_executesql @sql, @params, @userID =  @RecipientID ,  @messagetext = @messagetext OUTPUT

				SET @sql = N'SELECT @messagesubject = REPLACE(@messagesubject, ''{' + @colName + '}'',CAST(COALESCE([' + @colName + '],'''')  AS VARCHAR(MAX))) FROM ##tempDataEvent'+cast(@eventID as nvarchar(20))+' WHERE rowID_ = @userID'
				SET @params = N'@messagesubject nvarchar(MAX) OUTPUT,   @userID INT'
				exec sp_executesql @sql, @params, @userID =  @RecipientID ,  @messagesubject = @messagesubject OUTPUT

				SELECT @FieldID = MIN(colID) From tempdb..syscolumns a WHERE id = @tableID 	AND colid > @FieldID 

			END

			SELECT @messagetext = REPLACE(@messagetext, '{COLLECTIONID}',@CollectionID) 
			SELECT @messagetext = REPLACE(@messagetext, '{COLLECTIONAME}',@CollectionName) 
			SELECT @messagetext = REPLACE(@messagetext, '{CLASSID}',@ClassID) 
			SELECT @messagetext = REPLACE(@messagetext, '{CLASSNAME}',@ClassName) 
			SELECT @messagetext = REPLACE(@messagetext, '{ITEMID}',@MailItem) 

			SELECT @messagetext = REPLACE(@messagetext, '{TAGGEDON}',[TAGGEDON]) FROM @MailToItem WHERE [MailToItemID] = @minMailItem
			SELECT @messagetext = REPLACE(@messagetext, '{DAYSSINCE}',[DAYSSINCE]) FROM @MailToItem WHERE [MailToItemID] = @minMailItem


			--Get "to" email address

			SET @sql = N'SELECT @mailTo = IsNull([SendToEmail],'''')  FROM ##tempDataEvent'+cast(@eventID as nvarchar(20))+'  WHERE rowID_ = @userID'
			SET @params = N' @userID INT, @mailTo nvarchar(255) OUTPUT'
			exec sp_executesql @sql, @params,  @userID =  @RecipientID , @mailTo = @mailTo OUTPUT
				
			INSERT INTO A_MailerLog (MailTo, MailFrom, ReadReceipt, [BCC], Important, [subject], body, attachment)
			VALUES(	@mailTo, @SendFrom, @readReceipt, @BccTo, @Important, @messagesubject, @messagetext, @attachment)

			INSERT INTO NotificationLog(name, Owner, email, AssetID, WhenSent, AutoNotificationID, TemplateUsed, Status, Type, CollectionID, TemplateID)
			VALUES('Event mailer', '',@mailTo, @MailItem,  getdate(),@eventID, '', '','auto', @CollectionID, @TemplateID )

			print @mailTo 
			print @messagesubject
			print @messagetext


			SET @SQL = 'SELECT	@RecipientID = MIN([rowID_]) From ##tempDataEvent'+cast(@eventID as nvarchar(20))+' WHERE rowID_ > @RecipientID'
			SET @params = N'@RecipientID INT OUTPUT'
			exec sp_executesql @SQL, @params, @RecipientID =  @RecipientID OUTPUT	
	
		END

		SELECT @minMailItem = MIN([MailToItemID]) FROM @MailToItem where [MailToItemID] > @minMailItem

	END
	
	SELECT @SQL = 'IF EXISTS(SELECT [name] FROM tempdb.sys.tables WHERE [name] like ''##tempdataEvent'+cast(@eventID as nvarchar(20))+''') DROP TABLE ##tempdataEvent'+cast(@eventID as nvarchar(20))
	
	EXEC(@SQL)

END

GO

CREATE proc [dbo].[sp_EventMail]
as
begin

SET NOCOUNT ON;
DECLARE @templateID INT,
		@EventID INT,
		@minEventID INT, 
		@collectioID INT,
		@frequency VARCHAR(30),
		@SQL NVARCHAR(MAX),
		@params NVARCHAR(255),
		@messagetext VARCHAR(max),
		@messagetextOut VARCHAR(max),
		@subject VARCHAR(max), 
		@type VARCHAR(100), @eventType  VARCHAR(100), 
		@daytrigger VARCHAR(100),
		@ID INT, @maxID INT, @tableID INT, @assetID VARCHAR(30),
		@dataset varchar(100),
		@PayLoadSQL VARCHAR(max),@throttle INT,  @pass INT,
		@payloadOutput  VARCHAR(max),
		@payloadRecordCount INT,
		@PayloadAttachment BIT, @payloadAttachmentPath VARCHAR(255),
		@payloadSupressOnEmpty BIT, 
		@signaturePath VARCHAR(100), 
		@signatureMarker  VARCHAR(100),
		@signatureReplacementMarker  VARCHAR(100),
		@attachment VARCHAR(max),@colName VARCHAR(100),
		@mailTo VARCHAR(255),
		@SendFrom VARCHAR(255),
		@ReplyTo VARCHAR(255),
		@BccTo VARCHAR(255),
		@ReadReceipt BIT,
		@Important BIT, @userID INT, 
		@usermaxID INT,  @hour INT

IF EXISTS(SELECT [name] FROM tempdb.sys.tables WHERE [name] like '##tempdata') DROP TABLE ##tempdata

set @hour = datePart(hour,getdate())


SELECT @EventID = MIN(eventID),
				@minEventID = MAX(eventID)
FROM [Sys_Event]
WHERE Active = 1 
	AND Eventtype like '% Mailer'



WHILE @EventID <= @minEventID 
BEGIN
	select @templateID = TemplateID, 
			@collectioID = CollectionID, 
			@frequency = Frequency,
			@daytrigger = daytrigger, 
			@eventType = EventType
	FROM [Sys_Event]
	WHERE EventID  = @EventID
	
	IF LEN(@frequency) = 0 SET @frequency = '1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23'

	SET @sql = 'select  @pass = datePart(hour,getdate()) where  datePart(hour,getdate()) in (' + @frequency + ')'
	EXEC sp_executesql @sql, N'@pass INT OUTPUT', @pass = @pass OUTPUT
	IF @pass > 0
	BEGIN

		SELECT @messagetext = Template , @subject = [subject], @dataset = itemtype, @throttle = templateThrottle
		FROM NotificationTemplate WHERE templateid = @templateID

		
		SELECT  @SQL = sqlstatement  FROM A_templateSQLStatement  WHERE itemtype  = @dataset AND templateType  = 'Event'

		IF @Throttle > 0 SET @SQL = REPLACE(@SQL, 'SELECT', CONCAT('SELECT TOP ', @Throttle))
		SET @SQL = REPLACE(@SQL, '@Offset', @daytrigger)
		SET @params = N'@ChannelID INT, @daytrigger nvarchar(30), @templateID INT'
		EXEC sp_executesql @sql, @params, @ChannelID = @collectioID, @daytrigger = @daytrigger, @templateID = @TemplateID

		SELECT	@ID = MIN(colid),
				@maxID = MAX(colid),
				@tableID  = max(a.id)
		From tempdb..syscolumns a
		inner join tempdb..sysobjects b
		on a.id = b.id 
		where b.id = object_id('tempdb..##tempData')

		IF CHARINDEX('{SNIP_',@messagetext) > 0 
		BEGIN
			EXEC dbo.sp_MailerSnippets @messagetext, @messagetextOut OUTPUT
			SET @messagetext = @messagetextOut
		END	


		--payloads
		IF CHARINDEX('{PAYLOAD}',@messagetext) > 0 AND @PayLoadSQL <> ''
		BEGIN
			EXEC dbo.sp_payload @PayLoadSQL,0, @payloadOutput OUTPUT,@payloadRecordCount OUTPUT, @payloadAttachmentPath OUTPUT
			SET @messagetext = REPLACE(@messagetext, '{PAYLOAD}',@payloadOutput)
		END	

		--signature image
		IF CHARINDEX('{IMAGE',@messagetext) > 0 
		BEGIN	
			EXEC sp_mailerSignatures @messagetext, @messagetextOut OUTPUT
			SET @messagetext = @messagetextOut
			--SET @attachment = CONCAT(@attachment, @signaturePath)
		END	

		SELECT	@userID = MIN(row_),@usermaxID = MAX(row_) From ##tempData

	

		SET @messagetextOut= @messagetext 
		--replacements 
		
			WHILE @userID <= @usermaxID 
			BEGIN

				WHILE @ID <= @maxid 
				BEGIN
		
					
					SELECT @colName = [name] FROM  tempdb..syscolumns WHERE colID = @id and id = @tableID
		
					SET @sql = N'SELECT @messagetext = REPLACE(@messagetext, ''{' + @colName + '}'',CAST(COALESCE([' + @colName + '],'''') AS VARCHAR(MAX))) FROM ##tempData WHERE row_ = @userID'
					SET @params = N'@messagetext nvarchar(MAX) OUTPUT, @userID INT'
					exec sp_executesql @sql, @params, @userID =  @userID ,  @messagetext = @messagetext OUTPUT

					SET @sql = N'SELECT @subject = REPLACE(@subject, ''{' + @colName + '}'',CAST(COALESCE([' + @colName + '],'''')  AS VARCHAR(MAX))) FROM ##tempData WHERE row_ = @userID'
					SET @params = N'@subject nvarchar(MAX) OUTPUT,   @userID INT'
					exec sp_executesql @sql, @params, @userID =  @userID ,  @subject = @subject OUTPUT

					--Get to email address
					IF @colName = 'useremail'
					BEGIN
						SET @sql = N'SELECT @mailTo = [' + @colName + ']  FROM ##tempData  WHERE row_ = @userID'
						SET @params = N' @userID INT, @mailTo nvarchar(255) OUTPUT'
						exec sp_executesql @sql, @params,  @userID =  @userID , @mailTo = @mailTo OUTPUT
					END

					SELECT @id = MIN(colID)
					From tempdb..syscolumns a
					WHERE id = @tableID
						AND colid > @id 

	
	

				END

		
					INSERT INTO A_MailerLog (MailTo, MailFrom, ReadReceipt, Important, subject, body, attachment)
					VALUES(	@mailTo, @SendFrom, @readReceipt, @Important, @subject, @messagetext, @attachment)

				--	INSERT INTO NotificationLog(name, Owner, email, AssetID, WhenSent, AutoNotificationID, TemplateUsed, Status, Type, CollectionID, TemplateID)
				  --  VALUES(@autoName, '',@mailTo, @assetID,  getdate(),@autoNotificationID, '', '','auto', @AudiencePropertyID, @TemplateID )

		
				SELECT	@userID = MIN(row_)
				From ##tempData
				WHERE row_ > @userID
		
				--reset the message
				SET @id = 1
				SET @messagetext = @messagetextOut
	
			END
		
			

		SELECT @EventID = MIN(eventID)				
		FROM [Sys_Event]
		WHERE Active = 1 
			AND Eventtype like '% Mailer'
			AND EventID > @EventID


	END		
	IF EXISTS(SELECT [name] FROM tempdb.sys.tables WHERE [name] like '##tempdata') DROP TABLE ##tempdata;

END
end
GO
CREATE PROCEDURE [dbo].[SYS_EVENT_SYNCHRONISE]
       -- Add the parameters for the stored procedure here
       @EVENTID int
AS
BEGIN
       -- SET NOCOUNT ON added to prevent extra result sets from
       -- interfering with SELECT statements.
       SET NOCOUNT ON;

-- Modes are as follows
       --  SYNCHRONISE                   -  Add_Move_Purge                              - 0 - MERGE & PURGE  (target collection retains exact copy of source collection only )
       --  COLLECT                       -  Add_Move                                           - 1 - MERGE NO PURGE  (add new items identified from source collection to those items already present in target collection)

       --  SIEVE PURGE                   -  Add_Purge                                   - 2 - NEW TO CLASS ONLY & PURGE   (only add to target collection if items do not appear in class collections already)
       --  SIEVE PROTECT          -  Add_Move_Protect_Purge                - 3 - DONT MOVE ITEMS IF PROTECTED (add to target collection if items do not appear in a protected collection within class already)
       --     SIEVE ADD                  -  Add                                               - 4 - NEW TO CLASS ONLY (NO PURGE)
       --  SIEVE ADD PROTECT      -  Add_Move_Protect                             - 5    - NOT IN A PROTECTED COLLECTION WITHIN CLASS (NO PURGE)

       --  SUBTRACT               -  Subtract                                          - 6 - REMOVE FROM TARGET COLLECTION

       DECLARE @CID int;
    DECLARE @SYNCHRONISETYPE nvarchar(250);
       DECLARE @TargetID int;
    DECLARE @TargetClassID int;
    DECLARE @TargetDistinct bit;


       SELECT TOP 1 
              @CID = e.[CollectionID]
             , @SYNCHRONISETYPE = e.[SynchroniseType]
             , @TargetID = t.CollectionID
             , @TargetClassID = t.CollectionClassID 
             , @TargetDistinct =  tt.[Distinct] 
       FROM [ARM_CORE].[dbo].[Sys_Event] e 
       LEFT JOIN [A_Collection] c on c.CollectionID = e.CollectionID
       LEFT JOIN [A_CollectionClass] cc on cc.CollectionClassID = c.CollectionClassID
       LEFT JOIN [A_Collection] t on t.CREF = e.[TargetCollectionRef] and IsNull(t.CREF,'') <> ''
       LEFT JOIN [A_CollectionClass] tt on tt.CollectionClassID = t.CollectionClassID
       where [EventID] = @EVENTID


-- Get the hopeful contenders !
       DECLARE @SourceItems TABLE (
             ItemID nvarchar(255),
        TargetCollectionID int,
             TargetClassID int
       );

       insert into @SourceItems
       SELECT i.ItemID, @TargetID as TargetCollectionID, @TargetClassID as TargetClassID
       FROM A_CollectionItem i where i.CollectionID = @CID

       IF @SYNCHRONISETYPE = 6 
       BEGIN
             -- If "Remove" then remove items from destination collection if present.
             delete from A_CollectionItem where CollectionID = @TargetID 
                    and ItemID in (
                           select distinct ItemID from @SourceItems
                    )            
       END
       ELSE
       BEGIN
       -- Remove those that dont qualify !

             IF @SYNCHRONISETYPE = 2 or @SYNCHRONISETYPE = 4
             BEGIN
             -- remove items candidates already in class (i.e. keep those that are new)

                    delete from @SourceItems where ItemID in (
                           select distinct i.ItemID from A_CollectionItem i
                           LEFT JOIN A_Collection c on c.CollectionID = i.CollectionID
                           where c.CollectionClassID = @TargetClassID 
                    )
                    
             END
             ELSE
             BEGIN
                    IF @SYNCHRONISETYPE = 3 or  @SYNCHRONISETYPE = 5
                    BEGIN
                    -- remove item candidates if already contained in EndState collection within class
                           delete from @SourceItems where ItemID in (
                                 select distinct i.ItemID from A_CollectionItem i
                                 LEFT JOIN A_Collection c on c.CollectionID = i.CollectionID
                                 where c.CollectionClassID = @TargetClassID and IsNull(c.Protect,0) = 1
                           )
                    END
                    ELSE
                    BEGIN
                    --Candidates are items that are new to Target Collection regardless if alreay in class
                           delete from @SourceItems where ItemID in (
                                 select distinct ItemID from A_CollectionItem 
                                 where CollectionID = @TargetID 
                           )
                    END
             END

             if @SYNCHRONISETYPE = 0 or @SYNCHRONISETYPE = 2 or @SYNCHRONISETYPE = 3
             BEGIN

                    -- Need to Purge.  Remove items in target that are not part of source set

                    delete from A_CollectionItem where CollectionID = @TargetID 
                           and NOT ItemID in (
                                 select distinct ItemID from A_CollectionItem where collectionID = @CID
                           )        
             END

             -- Check if target collection is Distinct.  If so remove new items from class if not SIEVE

             if @TargetDistinct = 1
                    MERGE [ARM_CORE]..[A_CollectionItem] as TARGET
                    USING ( 
                           select distinct i.itemID, i.CollectionID from [ARM_CORE]..[A_Collection] c
                           LEFT JOIN [ARM_CORE]..[A_CollectionItem] i on i.CollectionID = c.CollectionID
                           LEFT JOIN @SourceItems y on y.ItemID = i.ItemID
                           where c.CollectionClassID = @TargetClassID and c.CollectionID <> y.TargetCollectionID and y.ItemID IS NOT NULL
                    ) as SOURCE
                    On (TARGET.[ItemID] = SOURCE.[Itemid] and TARGET.[CollectionID] = SOURCE.[CollectionID]) 
                    WHEN MATCHED THEN
                           DELETE;
       

             -- Now add whats left

             MERGE [ARM_CORE]..[A_CollectionItem] as TARGET
             USING ( 
                    select ItemID, @TargetID as CollectionID from @SourceItems where ItemID IS NOT NULL
             ) as SOURCE
             On (TARGET.[ItemID] = SOURCE.[Itemid] and TARGET.[CollectionID] = SOURCE.[CollectionID]) 
             WHEN NOT MATCHED BY TARGET THEN
                    INSERT (ItemID, CollectionID) VALUES (SOURCE.ItemID, SOURCE.CollectionID);

--           insert into A_CollectionItem (ItemID, CollectionID)
--           select ItemID, @TargetID from @SourceItems 
       END
END



GO
CREATE PROCEDURE [dbo].[SYSTEM-Events]
@AgentID as int =0
AS
BEGIN

-- Modes are as follows
--  0 - MERGE & PURGE  (keep only those items that are listed by qualifying SQL)
--  1 - MERGE NO PURGE  (add new items identified but retain items already captured)
--  2 - NEW TO CLASS ONLY & PURGE

-- IS Typically Called Twice for two pass model

--------------------------------------------------
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;


	DECLARE @query VARCHAR(MAX)
	Declare @TheHour as int;
	DECLARE @nRows INT;

    DECLARE @CID int,
		@server VARCHAR(100),
		@tableHTMLErrors NVARCHAR(MAX), 
		@HaveError smallint
	
	set @TheHour = datePart(hour,getdate())
	SELECT @server = REPLACE([dbo].fnGlobalProperty('domain'), '\','') 

	DECLARE @SysEvents TABLE (
        CollectionID int,
		[EventID] int,
		[EventType] [nvarchar](250),
		[SynchroniseType] [nvarchar](250) ,
		[ActionRef] [nvarchar](250) ,
		[SQL] [nvarchar](max) ,
		[TargetCollectionRef] [nvarchar](250) ,
		[TemplateID] [int] ,
		[Order] [int],
		[Distinct] [bit] ,
		[CollectionClassID] [int] ,
		[TargetID] [int] ,
		[TargetClassID] [int] ,
		[TargetDistinct] [bit] 
    );

	DECLARE @SourceItems TABLE (
		ItemID	nvarchar(255),
        TargetCollectionID int,
		TargetClassID int
	);

	INSERT INTO @SysEvents
	SELECT distinct e.[CollectionID]
      ,e.[EventID]
	  ,e.[EventType]
      ,e.[SynchroniseType]
      ,e.[ActionRef]
      ,e.[SQL]
      ,e.[TargetCollectionRef]
      ,e.[TemplateID]
	  ,e.[Order]
	  ,cc.[Distinct]
	  ,cc.[CollectionClassID]
	  ,t.CollectionID as [TargetID]
	  ,t.CollectionClassID as [TargetClassID]
	  ,tt.[Distinct] AS [TargetDistinct]
	FROM [ARM_CORE].[dbo].[Sys_Event] e 
	LEFT JOIN [A_Collection] c on c.CollectionID = e.CollectionID
	LEFT JOIN [A_CollectionClass] cc on cc.CollectionClassID = c.CollectionClassID
	LEFT JOIN [A_Collection] t on t.CREF = e.[TargetCollectionRef] and IsNull(t.CREF,'') <> ''
	LEFT JOIN [A_CollectionClass] tt on tt.CollectionClassID = t.CollectionClassID
	where e.Active = 1 and e.EventType like 'sched%' and (
			@TheHour in (
				select x.[value] from (Select Seq  = Row_Number() over (Order By (Select null)) ,Value = v.value('(./text())[1]', 'varchar(max)')
				From  (values (convert(xml,'<x>' + replace(IsNull([Frequency],0),',','</x><x>')+'</x>'))) x(n) Cross Apply n.nodes('x') node(v) ) x
			) or IsNull(Frequency,'') = ''
		)

	DECLARE @errors TABLE (
		id INT IDENTITY(1,1) NOT NULL,
		servername VARCHAR(100),
        EventID INT, 
		EventType nVARCHAR(255),
		[Class] nVARCHAR(255),
		[Collection] nVARCHAR(255),
        CID INT, 
		Errormessage nVARCHAR(255),
		RunTime datetime
    );


	SET @HaveError = -1

	DECLARE @EVENTID int;
    DECLARE @EVENTTYPE nvarchar(250);
    DECLARE @SYNCHRONISETYPE nvarchar(250);
    DECLARE @ACTIONREF nvarchar(250);
    DECLARE @SQL nvarchar(max);
    DECLARE @TARGETREF nvarchar(250);
    DECLARE @TEMPLATEID int;
    DECLARE @Distinct bit;
    DECLARE @CollectionClassID int
	,@CollectionName nVARCHAR(255)
	,@ClassName nVARCHAR(255)
	
	
	DECLARE @TargetID int;
    DECLARE @TargetClassID int;
    DECLARE @TargetDistinct bit;

    SELECT @nRows = COUNT(*) FROM @SysEvents;

	WHILE @nRows > 0
	BEGIN

		SELECT TOP 1 @CID = e.[CollectionID], @EVENTID = e.[EventID], @EVENTTYPE = e.[EventType], @SYNCHRONISETYPE = e.[SynchroniseType]
			, @Distinct = e.[Distinct],  @CollectionClassID = e.[CollectionClassID]
			, @TargetID = e.[TargetID],  @TargetDistinct = e.[TargetDistinct],  @TargetClassID = e.[TargetClassID]
			, @ACTIONREF = e.[ActionRef], @TARGETREF = e.[TargetCollectionRef], @TEMPLATEID = e.[TemplateID], @SQL = e.[SQL]
			, @CollectionName = c.[Name], @ClassName = cc.[Name]
		FROM @SysEvents e LEFT JOIN [A_COLLECTION] c on c.CollectionID = e.CollectionID LEFT JOIN A_CollectionClass cc on cc.CollectionClassID = c.CollectionClassID order by e.[Order] ;

		BEGIN TRY
			if @EVENTTYPE = 'Scheduled Synchronise'
			BEGIN
				EXEC [SYS_EVENT_SYNCHRONISE] @EVENTID
			END

			if @EVENTTYPE = 'Scheduled Mailer'
			BEGIN
				EXEC [SYS_EVENT_MAILER] @EVENTID
			END

			if @EVENTTYPE = 'Scheduled Discover'
			BEGIN
				EXEC [SYS_EVENT_DISCOVER] @EVENTID
			END

			if @EVENTTYPE = 'Scheduled Remove'
			BEGIN
				EXEC [SYS_EVENT_REMOVE] @EVENTID
			END

			if @EVENTTYPE = 'Scheduled Move'
			BEGIN
				EXEC [SYS_EVENT_MOVE] @EVENTID
			END

			if @EVENTTYPE = 'Scheduled Script'
			BEGIN
				EXEC [SYS_EVENT_SCRIPT] @EVENTID
			END
			
			if @EVENTTYPE = 'Scheduled Action'
			BEGIN
				EXEC [SYS_EVENT_ACTION] @EVENTID
			END

			if @EVENTTYPE = 'Scheduled Admin Task'
			BEGIN
				EXEC [SYS_EVENT_ADMINTASK] @EVENTID
			END

		END TRY
		BEGIN CATCH
			SET @HaveError = 1
			update [Sys_Event] set [Error] = 'Failed to Run : '+ERROR_MESSAGE()+' : ' + cast(GETDATE() as nvarchar(30))  where [EventID] = @EVENTID
			INSERT INTO @errors(servername, EventID, EventType, [Class], [Collection], [CID], Errormessage, RunTime)
			VALUES(@server, @EVENTID, @EVENTTYPE, @ClassName, @CollectionName, @CID, ERROR_MESSAGE(), getdate())
		END CATCH

		DELETE FROM @SysEvents 
		WHERE [CollectionID] = @CID and [EventID] = @EVENTID

		SELECT @nRows = COUNT(*) FROM @SysEvents;
	END

	IF @HaveError = 1 and NOT @AgentID = 0
	BEGIN
		SET @tableHTMLErrors = '<table class="table"><tr><th>Event ID</th><th>Event Type</th><th>Class</th><th>Collection</th><th>CID</th><th>RunTime</th><th>Error Message</th></tr>'


		SELECT  @tableHTMLErrors = CONCAT(@tableHTMLErrors,'<tr><td>'
											, EventID, '</td><td>'
											, EventType, '</td><td>'
											, [Class], '</td><td>'
											, [Collection], '</td><td>'
											, [CID], '</td><td>'
											, [RunTime], '</td><td>'
											, Errormessage, '</td></tr>')
		FROM @errors order by ID

		set @tableHTMLErrors = @tableHTMLErrors + '</table>'

		update Sys_Agent set [Error] = @tableHTMLErrors where [AgentID] = @AgentID
		
		print @tableHTMLErrors
	END
END

GO
-- =============================================
-- Author:             <Author,,Name>
-- Create date: <Create Date,,>
-- Description:        <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[DYN-EventTemplate]
        -- Add the parameters for the stored procedure here
@CID int = 0
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
        SET NOCOUNT ON;
    -- Insert statements for procedure here

		select n.[TemplateID] as [DynamicValue], n.[Label] as [DynamicLabel] 
		from  [NotificationTemplate] n 
		LEFT JOIN  A_templateSQLStatement d on d.TemplateSQLStatementID = n.DataSet
		LEFT JOIN  A_Collection c on c.CollectionID = @CID
		where (d.[TemplateType] like 'Event%' and d.ItemType like c.[Type] + '%') or (IsNull(n.dataset,0) = 0 and n.ItemType = c.[Type] )


END

GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SYS-TableStructure2]
@tbl nvarchar(500) = '',
@db nvarchar(500) = '',
@set nvarchar(500) = ''
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.

	SET NOCOUNT ON 

	if @db = '' set @db = DB_NAME()


	if @db <> '' and @tbl <> ''
	BEGIN
		IF @Set = '' 
			SELECT IsNull(e.[Label],s.[name]) AS [FieldLabel], s.[name] AS [Column], IsNull(l.[Lookup],'no_lookup_values') as [Lookup], l.[Label] as OptionText, l.[Order], t.name as [Type],   
			columnproperty(s.id, s.[name] ,'IsIdentity') as IsIdentity,	s.[colorder], IsNull(e.[Order],s.[colorder]) as AdjustedOrder, e.[HelpText],  
			IsNull(e.[Property],0) as [Property], IsNull(e.[Exclude],0) as [Exclude], IsNull(e.[InitialValue],'') as InitialValue,   
			IsNull(e.[Group],'') as [Group], IsNull(e.[Height], 1) as Height, IsNull(e.[Width],'') as Width, IsNull(e.[TextEditor],0) as [TextEditor], s.prec as MaxLength, e.ClosedList  
			FROM [syscolumns] s 
			LEFT JOIN sys.[Tables] x on x.object_id =s.id
			LEFT JOIN [ARM_CORE]..[A_Lookup] l on l.[Column] = s.[name] and l.[Table] = x.name   
			LEFT JOIN [ARM_CORE]..[A_TableEdit] e on e.[Column] = s.[name] and e.[Table] = x.name   
			LEFT JOIN sys.[types] t on t.system_type_id = s.xtype   
			WHERE s.id = object_id('[' + @db + ']..[' + @tbl + ']') and IsNull(e.[Exclude],0) = 0 and IsNull(t.[name],'') <> 'sysname' 
			Order by IsNull(e.[Group],'') ,IsNull(e.[Order],s.[colorder]), s.[colorder], s.[name], l.[Order], l.[Label]
		ELSE
			SELECT IsNull(e.[Label],s.[name]) AS [FieldLabel], s.[name] AS [Column], IsNull(l.[Lookup],'no_lookup_values') as [Lookup], l.[Label] as OptionText, l.[Order], t.name as [Type],   
			columnproperty(s.id, s.[name] ,'IsIdentity') as IsIdentity,	s.[colorder], IsNull(e.[Order],s.[colorder]) as AdjustedOrder, e.[HelpText],  
			IsNull(e.[Property],0) as [Property], IsNull(e.[Exclude],0) as [Exclude], IsNull(e.[InitialValue],'') as InitialValue,   
			IsNull(e.[Group],'') as [Group], IsNull(e.[Height], 1) as Height, IsNull(e.[Width],'') as Width, IsNull(e.[TextEditor],0) as [TextEditor], s.prec as MaxLength, e.ClosedList  
			FROM [syscolumns] s 
			LEFT JOIN sys.[Tables] x on x.object_id =s.id
			LEFT JOIN [ARM_CORE]..[A_Lookup] l on l.[Column] = s.[name] and l.[Table] = x.name   
			LEFT JOIN [ARM_CORE]..[A_TableEdit] e on e.[Column] = s.[name] and e.[Table] = x.name   
			LEFT JOIN sys.[types] t on t.system_type_id = s.xtype   
			LEFT JOIN [A_TableEditSet] g on g.[SetName] = @set and g.[SetFieldName] = s.[name]
			WHERE s.id = object_id('[' + @db + ']..[' + @tbl + ']') and IsNull(e.[Exclude],0) = 0 and IsNull(t.[name],'') <> 'sysname' and NOT g.TableEditSetID IS NULL
			Order by IsNull(e.[Group],'') ,IsNull(e.[Order],s.[colorder]), s.[colorder], s.[name], l.[Order], l.[Label]
	END
END


GO
-- =============================================
-- Author:             <Author,,Name>
-- Create date: <Create Date,,>
-- Description:        <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[DYN-DefaultCollection]
	@CCID int = 0
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.

        SET NOCOUNT ON;


 --      select distinct '{1st Collection}' as [DynamicLabel], 0 as [DynamicValue] 
 --      union
       select distinct [Name] as [DynamicLabel], [CollectionID] as [DynamicValue], [Order] from A_Collection where CollectionClassID = @CCID order by [Order]


END

GO
-- =============================================
-- Author:             <Author,,Name>
-- Create date: <Create Date,,>
-- Description:        <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[DYN-StockSite]
        -- Add the parameters for the stored procedure here
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
        SET NOCOUNT ON;
    -- Insert statements for procedure here

       select distinct [site] as [DynamicLabel], [site] as [DynamicValue] from arm_core..stock
       union
       select distinct [site] as [DynamicLabel], [site] as [DynamicValue] from arm_core..stock_order
       union
       select distinct [site] as [DynamicLabel], [site] as [DynamicValue] from arm_core..stock_peripheral



END

GO
CREATE PROCEDURE [dbo].[sp_CreaterSingle] (@CreatorID INT)
AS
BEGIN
	DECLARE @sql NVARCHAR(MAX),
			@sql2 NVARCHAR(255),
			@params NVARCHAR(255),
			@sqlResult INT, 

			@mailTo Varchar(255)


	--select * from sys_AGENT


		SELECT @sql = Isnull([sql],'')
		FROM Sys_Creator 
		WHERE CreatorID = @CreatorID

		IF @sql <> '' 
		BEGIN
				EXEC  @sqlResult = sp_executesql @sql
				--IF @sqlResult > 0 
				--BEGIN
					--send mail 
					--SELECT @mailTo = propertyValue FROM SystemGlobalProperties WHERE  PropertyName = 'AutoEmail'
					--EXEC msdb.dbo.sp_send_dbmail @profile_name = '',
					-- @recipients = @mailTo,
					-- @subject = '',
					-- @body = '',
					-- @body_format = 'HTML'
			--	END
		END 

END

GO
CREATE PROCEDURE [dbo].[sp_creater]
AS
BEGIN
SET NOCOUNT ON
	DECLARE @sql NVARCHAR(MAX),
			@sqlCondition NVARCHAR(MAX),
			@sql2 NVARCHAR(255),
			@params NVARCHAR(255),
			@sqlResult INT, 
			@conditionOut VARCHAR(1),
			@mailTo Varchar(255),
			@minID INT,
			@maxID INT

	SELECT @minID = MIN(CreatorID),
			@maxID = MAX(CreatorID)
	FROM Sys_Creator
	WHERE active = 1 


	WHILE @minID <= @maxID
	BEGIN

		SELECT @sql = [sql] 
		FROM Sys_Creator 
		WHERE CreatorID = @minID

		IF @sql <> '' 
		BEGIN
			EXEC  @sqlResult = sp_executesql @sql
			IF @sqlResult = 0 
			BEGIN
				update Sys_Creator set LastRun =GETDATE() where CreatorID = @minID
			END
			--ELSE
			--BEGIN
				----send mail 
				--SELECT @mailTo = propertyValue FROM SystemGlobalProperties WHERE  PropertyName = 'AutoEmail'
				--EXEC msdb.dbo.sp_send_dbmail @profile_name = '',
				-- @recipients = @mailTo,
				-- @subject = '',
				-- @body = '',
				-- @body_format = 'HTML'
			--END
		END 
	SELECT @minID = MIN(CreatorID)
	From Sys_Creator
	WHERE active = 1 and CreatorID > @minID 
	
	END 
END


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_StockTab_1] 
@ID NVARCHAR(255) = ''
AS
BEGIN

select SerialNumber from [ARM_CORE]..[Stock] where SerialNumber = @ID
END;

GO
-- =============================================
-- Author:          <Author,,Name>
-- alter date: <alter Date,,>
-- Description:     <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[STOCK-delivery-Pivot]


		@site nvarchar(255) = '%'

AS
BEGIN
       -- SET NOCOUNT ON added to prevent extra result sets from
       -- interfering with SELECT statements.
       SET NOCOUNT ON;


       SELECT  s.deliverydate, s.quantity, s.item 
       INTO #tempPivotTable
       from arm_core..stock_order s
	   where s.[site] like @site and IsNull(GoodsReceived,'') = ''
	   order by s.deliverydate

       DECLARE @Columns VARCHAR(MAX)

       SELECT @columns = STUFF(( SELECT DISTINCT TOP 100 PERCENT
                                                            '],[' + cast([Item] as nvarchar)
                                               FROM    #tempPivotTable AS t2
                                               ORDER BY '],[' + cast([Item] as nvarchar)
                                               FOR XML PATH('')
                                          ), 1, 2, '') + ']'

       DECLARE @query VARCHAR(8000)

       SET @query = '
       SELECT *
       FROM #tempPivotTable
       PIVOT
       (
       SUM(Quantity)
       FOR [Item]
       IN (' + @columns + ')
       )
       AS p '


       EXECUTE(@query)


       DROP TABLE #tempPivotTable
END



GO
-- =============================================
-- Author:             <Author,,Name>
-- Create date: <Create Date,,>
-- Description:        <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[DYN-CollectionType]
        -- Add the parameters for the stored procedure here
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
        SET NOCOUNT ON;
    -- Insert statements for procedure here

	select x.[Value] as [DynamicValue], x.[Value] as [DynamicLabel] from (
	  select value from dbo.[fn_split_string]('ASSET,Application,USER,ApplicationRequest,AppGroup,Licence,Other,AppPackageRequest',',')
	  UNION
	  select distinct [Type] from [ARM_CORE]..[A_Collection] 
	) x  where NOT Left(x.[Value],2) in ('A_','SY')
	Order by x.[Value]

END

GO
-- =============================================
-- Author:             <Author,,Name>
-- Create date: <Create Date,,>
-- Description:        <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[DYN-AppGroup-members]
        -- Add the parameters for the stored procedure here
        @TableGrpID as int = 0
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
        SET NOCOUNT ON;
    -- Insert statements for procedure here
		select '_WIP-101' AS DynamicValue, '_WIP-101' AS DynamicLabel, 10000 as [IC]
		UNION 
		(
        select a.ApplicationID AS DynamicValue, a.ApplicationID AS DynamicLabel, count(s.AssetID) AS IC
        from [ARM_CORE]..[Application] a
        LEFT JOIN [ARM_CORE]..[AppAstToBe] s on s.ApplicationID = a.ApplicationID
        where a.AppGroupID =  @TableGrpID
        Group By a.ApplicationID 
		) 

END

GO
CREATE PROCEDURE [dbo].[NewDashboard]
    @DashName nvarchar(255) = 'New Dashboard'
AS
BEGIN
-- SET NOCOUNT ON added to prevent extra result sets from
-- interfering with SELECT statements.
    SET NOCOUNT ON;
	DECLARE @DID INT;
	DECLARE @CID INT;

	insert into [ARM_CORE]..[A_Dashboard] ([Name],[Reference],[Display],[Order],[AnonHome],[AdminHome],[AclProtected],[Roles]) values (@DashName,'',0,1000,0,0,0,'6') 
	Set @DID = SCOPE_IDENTITY();
 
 	insert into [ARM_CORE]..[DashboardFilter] ([FilterTitle]) values (NULL)
	Set @CID = SCOPE_IDENTITY();
	insert into [ARM_CORE]..[A_DashboardItem] (DashBoardID,ItemType,ItemID,[Order],Active,Units,Height,[Level]) values (@DID,'DashboardFilter',@CID,10,1,4,0,0)

	insert into [ARM_CORE]..[DashboardSection] ([SectionTitle]) values (NULL)
	Set @CID = SCOPE_IDENTITY();
	insert into [ARM_CORE]..[A_DashboardItem] (DashBoardID,ItemType,ItemID,[Order],Active,Units,Height,[Level]) values (@DID,'DASHBOARDSECTION',@CID,20,1,4,0,0)

	insert into [ARM_CORE]..[Chart] ([Order], [Active]) values (0, 0)
	Set @CID = SCOPE_IDENTITY();
	insert into [ARM_CORE]..[A_DashboardItem] (DashBoardID,ItemType,ItemID,[Order],Active,Units,Height,[Level]) values (@DID,'Chart',@CID,30,1,4,0,0)



	--Return the result set of the table variable.
	SELECT @DID AS [NewDashboardID]
END


GO
-- =============================================
-- Author:             <Author,,Name>
-- ALTER date: <ALTER Date,,>
-- Description:        <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[DeleteDashBoard]
        @ID int = 0
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.	
        SET NOCOUNT ON;


		MERGE [ARM_CORE]..[Chart] AS Target 
		USING (SELECT ItemID from [ARM_CORE]..[A_DashboardItem] where [DashboardID] = @ID and [ItemType] = 'Chart') As Source 
		ON (Target.ChartID = Source.ItemID )
		WHEN MATCHED THEN 
			DELETE ; 

		MERGE [ARM_CORE]..[DashboardFilter] AS Target 
		USING (SELECT ItemID from [ARM_CORE]..[A_DashboardItem] where [DashboardID] = @ID and [ItemType] = 'DashboardFilter') As Source 
		ON (Target.FilterID = Source.ItemID )
		WHEN MATCHED THEN 
			DELETE ; 

		MERGE [ARM_CORE]..[DashboardFrame] AS Target 
		USING (SELECT ItemID from [ARM_CORE]..[A_DashboardItem] where [DashboardID] = @ID and [ItemType] = 'DashboardFrame') As Source 
		ON (Target.FrameID = Source.ItemID )
		WHEN MATCHED THEN 
			DELETE ; 

		MERGE [ARM_CORE]..[DashboardGroup] AS Target 
		USING (SELECT ItemID from [ARM_CORE]..[A_DashboardItem] where [DashboardID] = @ID and [ItemType] = 'DashboardGroup') As Source 
		ON (Target.DashboardGroupID = Source.ItemID )
		WHEN MATCHED THEN 
			DELETE ; 

		MERGE [ARM_CORE]..[DASHBOARDSECTION] AS Target 
		USING (SELECT ItemID from [ARM_CORE]..[A_DashboardItem] where [DashboardID] = @ID and [ItemType] = 'DASHBOARDSECTION') As Source 
		ON (Target.[DashboardSectionID] = Source.ItemID )
		WHEN MATCHED THEN 
			DELETE ; 

		MERGE [ARM_CORE]..[DashboardText] AS Target 
		USING (SELECT ItemID from [ARM_CORE]..[A_DashboardItem] where [DashboardID] = @ID and [ItemType] = 'DashboardText') As Source 
		ON (Target.TextID = Source.ItemID )
		WHEN MATCHED THEN 
			DELETE ; 

		MERGE [ARM_CORE]..[DashboardWidget] AS Target 
		USING (SELECT ItemID from [ARM_CORE]..[A_DashboardItem] where [DashboardID] = @ID and [ItemType] = 'DashboardWidget') As Source 
		ON (Target.WidgetID = Source.ItemID )
		WHEN MATCHED THEN 
			DELETE ; 

		delete from [ARM_CORE]..[A_DashboardItem] where [DashboardID] = @ID
		delete from [ARM_CORE]..[A_Dashboard] where [DashboardID] = @ID


END
 
 
/****** Object:  StoredProcedure [dbo].[Apps-Collections]    Script Date: 17/09/2018 21:38:07 ******/
SET ANSI_NULLS ON

GO
-- =============================================
-- Author:                           <Author,,Name>
-- Create date: <Create Date,,>
-- Description:    <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Collection-AddItem-FromClipBoard]
               @CollectionID int = 0,
               @ClipBoardID int = 0,
			   @Mode int = 0

AS
BEGIN
               -- SET NOCOUNT ON added to prevent extra result sets from
               -- interfering with SELECT statements.
    SET NOCOUNT ON;

	DECLARE @query nvarchar(max)
	DECLARE @CClass int
	DECLARE @Distinct bit 

	select @Distinct = IsNull(cc.[Distinct],0), @CClass = IsNull(cc.CollectionClassID,0)  from [ARM_CORE]..[A_Collection] c LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc on cc.CollectionClassID = c.CollectionClassID where c.CollectionID = @CollectionID


	if @Mode = 0 
	BEGIN
	-- Merges ASSET clipboard (B) to collection (A). Combines the two collections in to (A)

		if @Distinct = 1 
        BEGIN
			delete from [ARM_CORE]..[A_CollectionItem]  where ItemID in  (select i.ItemID from [ARM_CORE]..[A_CollectionItem] i where collectionID = @ClipBoardID)
				and CollectionID in (select CollectionID from [ARM_CORE]..[A_Collection] c where c.CollectionClassID = @CClass and CollectionID <> @CollectionID)
		END

		MERGE [ARM_CORE]..[A_CollectionItem] AS Target 
		USING (SELECT ItemID, @CollectionID as CollectionID from [ARM_CORE]..[A_CollectionItem] where collectionID = @ClipBoardID) As Source 
		ON (Target.ItemID = Source.ItemID and Target.CollectionID = Source.CollectionID)  
		WHEN NOT MATCHED BY TARGET THEN 
			INSERT ([ItemID], [CollectionID]) 
			VALUES (Source.[ItemID], Source.[CollectionID]); 	
	END

	if @Mode = 1 
	BEGIN
	-- Removes any item from  (A) that is held on the ASSET clipboard (B). 'Cookie Cutter'

		MERGE [ARM_CORE]..[A_CollectionItem] AS Target 
		USING (SELECT ItemID, @CollectionID as CollectionID from [ARM_CORE]..[A_CollectionItem] where collectionID = @ClipBoardID) As Source 
		ON (Target.ItemID = Source.ItemID and Target.CollectionID = Source.CollectionID)
		WHEN MATCHED THEN 
			DELETE ; 
	END


	if @Mode = 2 
	BEGIN
	-- Retains only those items in (A) that are also held on the ASSET clipboard (B). 

		MERGE [ARM_CORE]..[A_CollectionItem] AS Target 
		USING (  
			SELECT t.ItemID, t.CollectionID as CollectionID from [ARM_CORE]..[A_CollectionItem] t LEFT JOIN [ARM_CORE]..[A_CollectionItem] c on c.ItemID = t.ItemID and c.CollectionID = @ClipBoardID
			where t.collectionID = @CollectionID and c.ItemID IS NULL ) As Source 
		ON (Target.ItemID = Source.ItemID and Target.CollectionID = Source.CollectionID) 
		WHEN MATCHED THEN 
			DELETE ; 
	END

	if @Mode = 3 
	BEGIN
	-- Replace A with contents of (B) where B not previously in A. 3 steps; take a from b, then clear a and put b into a

		MERGE [ARM_CORE]..[A_CollectionItem] AS Target 
		USING (
			SELECT ItemID, @ClipBoardID as CollectionID from [ARM_CORE]..[A_CollectionItem] where collectionID = @CollectionID
		) As Source 
		ON (Target.ItemID = Source.ItemID and Target.CollectionID = Source.CollectionID) 
		WHEN MATCHED THEN 
			DELETE ;

		
		Delete from  [ARM_CORE]..[A_CollectionItem] where CollectionID = @CollectionID


		if @Distinct = 1 
        BEGIN
			delete from [ARM_CORE]..[A_CollectionItem]  where ItemID in  (select i.ItemID from [ARM_CORE]..[A_CollectionItem] i where collectionID = @ClipBoardID)
				and CollectionID in (select CollectionID from [ARM_CORE]..[A_Collection] c where c.CollectionClassID = @CClass and CollectionID <> @CollectionID)
		END		

		MERGE [ARM_CORE]..[A_CollectionItem] AS Target 
		USING (SELECT ItemID, @CollectionID as CollectionID from [ARM_CORE]..[A_CollectionItem] where collectionID = @ClipBoardID) As Source 
		ON (Target.ItemID = Source.ItemID and Target.CollectionID = Source.CollectionID) 
		WHEN NOT MATCHED BY TARGET THEN 
			INSERT ([ItemID], [CollectionID]) 
			VALUES (Source.[ItemID], Source.[CollectionID]); 
	END
	

	if @Mode = 4 
	BEGIN
	-- removes all items from (A) 
		Delete from  [ARM_CORE]..[A_CollectionItem] where CollectionID =  @CollectionID
					
	END
			
	SELECT  Count(ItemID) as onBoard from [ARM_CORE].[dbo].[A_CollectionItem] i LEFT JOIN [ARM_CORE].[dbo].[A_Collection] c on c.CollectionID = i.CollectionID where c.CollectionID = @CollectionID

 
			

END




GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[JRR-RERUN-APP-CODE]
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;



--Drop Table and Recreate
-- ########## import to TMP_App - NOT REQUIRED ###########
IF object_id('[TMP_App]','U') is not null Drop Table [TMP_App]

CREATE TABLE [TMP_App](
[UNID] [bigint] IDENTITY(1,1) NOT NULL,
[ApplicationID] [nvarchar](500) NULL,
[AssetID] [nvarchar](500) NULL,
[Vendor] [nvarchar](500) NULL,
[ProductName] [nvarchar](500) NULL,
[ProductVersion] [nvarchar](500) NULL,
[Heartbeat] [date] NULL,
CONSTRAINT [PK_TMP_App] PRIMARY KEY CLUSTERED 
 (
  [UNID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]



DECLARE @SOURCE_RAW nvarchar(100)
set @SOURCE_RAW = '[ARM_CORE]..[TMP_RAW_ARM_ASOSC_CB]'



IF object_id(@SOURCE_RAW,'U') is not null
Begin
    EXEC('insert into [TMP_App] (ApplicationID, AssetID, Vendor, ProductName, ProductVersion, Heartbeat)
    SELECT distinct a.ProductName + ''-'' + isNull(a.ProductVersion,''''), a.[Netbios_Name0] as AssetID, a.companyname, a.[ProductName], a.[ProductVersion], isnull(z.heartbeat,''1990-1-1'') as Heartbeat from ' + @SOURCE_RAW + ' a
       left join ARM_CORE..Asset z on z.AssetID = a.[Netbios_Name0]
       --where right(a.[Netbios_Name0],1) in (''0'')
	  ')
	  --Temp to Reduce the load
End
-- There may be several imports going into this list, for example Lansweeper so.....
--Remove DUPES from TMP_App keeping NEWEST Heartbeat (or just top 1)
Delete from [TMP_App]
where UNID in ( select DUPE.UNID from (select a.unid, row_number() OVER ( PARTITION BY a.applicationid,a.AssetID  ORDER BY a.heartbeat DESC ) AS nr
from [TMP_App] as a ) as DUPE where nr > 1)


--############# History ###############
--Transform History - Maintain data that drops out of data source, i.e. Asset dropped from SCCM, but keep the applications.
--Insert any additional apps in TMP_App_Last into App_Transform_History
MERGE INTO ARM_CORE..App_Transform_History Target
Using (select l.ApplicationID, l.AssetID,l.Vendor, l.ProductName, l.ProductVersion, l.Heartbeat from ARM_CORE..App_Transform_Last l
left join [TMP_App] a WITH(NOLOCK) on a.ApplicationID = l.applicationID and a.AssetID = l.assetID
where a.ApplicationID is null) as Source
on target.ApplicationID=source.ApplicationID and target.assetID=source.assetID
WHEN Not MATCHED THEN 
  insert(ApplicationID, AssetID,Vendor, ProductName, ProductVersion, Heartbeat)
  Values (source.ApplicationID, source.AssetID, source.Vendor, source.ProductName, source.ProductVersion, source.Heartbeat);
  
  
--Remove any references LIVE assets in App_Transform_History, i.e. as it is live, it will have a current feed, this will remove any Un-installed software
delete h
from ARM_CORE..App_Transform_History h
left join ARM_CORE..Asset a on a.AssetID = h.assetid
where a.live = 1

--Add History back into TMP_Apps
insert into [TMP_App](ApplicationID, AssetID, Vendor, ProductName, ProductVersion,Heartbeat)
select h.ApplicationID, h.assetID, h.Vendor, h.ProductName, h.ProductVersion,h.heartbeat from ARM_CORE..App_Transform_History h WITH(NOLOCK) 

--Remove all records from App_Transform_Last and reset them
IF object_id('[ARM_CORE]..App_Transform_Last','U') is not null DELETE FROM [ARM_CORE]..App_Transform_Last
insert into ARM_CORE..App_Transform_Last (ApplicationID, AssetID, Vendor, ProductName, ProductVersion,Heartbeat)
select a.ApplicationID, a.AssetID, a.Vendor, a.ProductName, a.ProductVersion, a.Heartbeat from [TMP_App] a WITH(NOLOCK) 


--########### AppAstPreStop ###########

-- Update AppAstPreStop (All apps/asset - including not live and unused)
IF object_id('[ARM_CORE]..AppAstPreStop','U') is not null DELETE FROM [ARM_CORE]..AppAstPreStop
INSERT INTO [ARM_CORE]..AppAstPreStop (ApplicationID, AssetID, Heartbeat)
  SELECT distinct LEFT(a.ApplicationID,255), a.AssetID, a.heartbeat FROM [TMP_App] a WITH(NOLOCK) 

--########### AppAstAsIS ###########
-- Insert AppAstAsIs (Live Used Apps) - First Phase Insert Only where asset is Live

    IF object_id('[ARM_CORE]..AppAstAsIs','U') is not null 
    BEGIN
                    IF EXISTS (SELECT 1 FROM sys.indexes WHERE name = 'I_AppAstAsIs_APPID' AND object_id = object_id('[ARM_CORE]..AppAstAsIs','U')) DROP INDEX [AppAstAsIs].[I_AppAstAsIs_APPID]
                    IF EXISTS (SELECT 1 FROM sys.indexes WHERE name = 'I_AppAstAsIs_ASSETID' AND object_id = object_id('[ARM_CORE]..AppAstAsIs','U')) DROP INDEX [AppAstAsIs].[I_AppAstAsIs_ASSETID]
                    Delete from [ARM_CORE]..[AppAstAsIs]
    END


       INSERT INTO [ARM_CORE]..[AppAstAsIs] (ApplicationID, AssetID)
         SELECT distinct  p.ApplicationID, p.AssetID FROM [ARM_CORE]..AppAstPreStop p
         left join ARM_CORE..Asset a on a.AssetID = p.AssetID
         WHERE NOT p.ApplicationID IS NULL -- and a.live = 1
-- Update AppAstAsIS - Second Phase - Remove any Explicit STOP
       delete i
       from [ARM_CORE]..[AppAstAsIs] I
       LEFT JOIN [ARM_CORE]..TransformAppStop s on s.ApplicationID = I.ApplicationID
       WHERE s.ApplicationID is not null
-- Update AppAstAsIs  - Third Phase - Remove any Like STOP
       delete i
       from [ARM_CORE]..[AppAstAsIs] I
       left JOIN [ARM_CORE]..TransformAppStop s on I.ApplicationID like s.ApplicationID  
       WHERE s.ApplicationID is not null


--     ALTER TABLE [ARM_CORE]..[AppAstAsIs]
--     ADD CONSTRAINT PK_AppAstAsIs_ASSETID PRIMARY KEY (AssetID);

       CREATE CLUSTERED INDEX I_AppAstAsIs_APPID on [ARM_CORE]..[AppAstAsIs](ApplicationID Asc);
       CREATE INDEX I_AppAstAsIs_ASSETID on [ARM_CORE]..[AppAstAsIs](AssetID);

-- This is required to remove dupes for ApplicationID/Vendor 
IF object_id('[RAW_APP_VENDOR]','U') is not null Drop Table [RAW_APP_VENDOR]
select c.*, Row_Number() OVER(PARTITION BY c.[ApplicationID] order by c.Vendor desc) as nr 
INTO [RAW_APP_VENDOR] from (
       SELECT distinct [ApplicationID], Vendor, [ProductName], [ProductVersion] from [TMP_APP] 
) c

--########### AppAsIs ##############
delete from [ARM_CORE]..[AppAsIs]

insert into [ARM_CORE]..[AppAsIs] (ApplicationID, AppName, AppVersion, Vendor)
select ApplicationID, [ProductName], [ProductVersion], Vendor from [RAW_APP_VENDOR]
where nr = 1

--Check AppAsIs is registered

MERGE [ARM_CORE]..Application as Target
       using [ARM_CORE]..AppAsIs as Source on (target.ApplicationID = source.ApplicationID ) 
       WHEN NOT MATCHED THEN
              insert ([ApplicationID],[Name],[Version],AppGroupID)
              Values (source.applicationID,source.AppName,source.AppVersion,0); 

--########### AppAstUnUsed ###########
-- Insert AppAstUnUsed (Not Live Used Apps) - First Phase Insert Only where asset is Not Live
IF object_id('[ARM_CORE]..AppAstUnUsed','U') is not null Delete from [ARM_CORE]..AppAstUnUsed
INSERT INTO [ARM_CORE]..AppAstUnUsed (ApplicationID, AssetID)
  SELECT distinct  p.ApplicationID, p.AssetID FROM [ARM_CORE]..AppAstPreStop p
  left join ARM_CORE..Asset a on a.AssetID = p.AssetID
  WHERE a.live = 0
  
-- Update AppAstUnUsed - Second Phase - Remove any Explicit STOP
delete i
from [ARM_CORE]..AppAstUnUsed I
LEFT JOIN [ARM_CORE]..TransformAppStop s on s.ApplicationID = I.ApplicationID
WHERE s.ApplicationID is not null

-- Update AppAstUnUsed  - Third Phase - Remove any Like STOP
delete i
from [ARM_CORE]..AppAstUnUsed I
left JOIN [ARM_CORE]..TransformAppStop s on I.ApplicationID like s.ApplicationID  
WHERE s.ApplicationID is not null

--Check Group Mappings and Apply to Any Orphans

Exec [ARM_CORE]..[TransformTransactions] 'AppAstAsIs'

EXEC [ARM_CORE]..SYS_AppGroupAutoMap 

Exec [ARM_CORE]..[TransformTransactions] 'AppAstToBe'

exec [ARM_CORE]..[CalculateBitValues] 'Application'


DECLARE @OrphanSmall int
DECLARE @OrphanMedium int
DECLARE @OrphanLarge int
DECLARE @OrphanVendor int
DECLARE @OrphanCount int

select @OrphanSmall = AppgroupID FROM [ARM_CORE].[dbo].[AppGroup] WHERE AppGroupName = '_Orphans-Small'
select @OrphanMedium = AppgroupID FROM [ARM_CORE].[dbo].[AppGroup] WHERE AppGroupName = '_Orphans-Medium'
select @OrphanLarge = AppgroupID FROM [ARM_CORE].[dbo].[AppGroup] WHERE AppGroupName = '_Orphans-Large'
select @OrphanVendor = AppgroupID FROM [ARM_CORE].[dbo].[AppGroup] WHERE AppGroupName = '_Orphans-Top10-Vendors-by-Installs'
select @OrphanCount = AppgroupID FROM [ARM_CORE].[dbo].[AppGroup] WHERE AppGroupName = '_Orphans-Top10-Vendors-by-Count'

select @OrphanSmall as [Orphan-Small-ID], @OrphanMedium as [Orphan-Medium-ID], @OrphanLarge as [Orphan-Large-ID], @OrphanVendor as [Orphan-Vendor-ID], @OrphanCount as [Orphan-Top-10-ID]


-- Add all into _Orphan-Small
update app
set app.AppGroupID = @OrphanSmall
from arm_core..Application app
right join (
Select i.ApplicationID from ARM_CORE..AppAsIs i
left join arm_core..Application a on a.ApplicationID = i.ApplicationID
left join ARM_CORE..AppGroup g on g.AppGroupID = a.AppGroupID
LEFT JOIN ARM_CORE..[A_AppGroupType] gt on gt.AppGroupType = g.AppGroupType
left join arm_core..s_ApplicationASISInstallCount c on c.ApplicationID = i.ApplicationID
where isnull(a.AppGroupID,0) = 0 or gt.AutoMapProcess = 0) x on x.ApplicationID = app.ApplicationID

-- Add into _Orphan-Medium
update app
set app.AppGroupID = @OrphanMedium
from arm_core..Application app
right join (
Select i.ApplicationID from ARM_CORE..AppAsIs i
left join arm_core..Application a on a.ApplicationID = i.ApplicationID
left join ARM_CORE..AppGroup g on g.AppGroupID = a.AppGroupID
LEFT JOIN ARM_CORE..[A_AppGroupType] gt on gt.AppGroupType = g.AppGroupType
left join arm_core..s_ApplicationASISInstallCount c on c.ApplicationID = i.ApplicationID
where (isnull(a.AppGroupID,0) = 0 or gt.AutoMapProcess = 0) and c.Count >=10 ) x on x.ApplicationID = app.ApplicationID

-- Add all Items into _Orphan-Large
update app
set app.AppGroupID = @OrphanLarge
from arm_core..Application app
right join (
Select i.ApplicationID from ARM_CORE..AppAsIs i
left join arm_core..Application a on a.ApplicationID = i.ApplicationID
left join ARM_CORE..AppGroup g on g.AppGroupID = a.AppGroupID
LEFT JOIN ARM_CORE..[A_AppGroupType] gt on gt.AppGroupType = g.AppGroupType
left join arm_core..s_ApplicationASISInstallCount c on c.ApplicationID = i.ApplicationID
where (isnull(a.AppGroupID,0) = 0 or gt.AutoMapProcess = 0) and c.Count >50 )x on x.ApplicationID = app.ApplicationID

-- Add all Items into _Orphan-Vendor
update app
set app.AppGroupID = @OrphanVendor
from arm_core..Application app
right join (
Select i.ApplicationID, i.Vendor from ARM_CORE..AppAsIs i
left join arm_core..Application a on a.ApplicationID = i.ApplicationID
left join ARM_CORE..AppGroup g on g.AppGroupID = a.AppGroupID
LEFT JOIN ARM_CORE..[A_AppGroupType] gt on gt.AppGroupType = g.AppGroupType
left join arm_core..s_ApplicationASISInstallCount c on c.ApplicationID = i.ApplicationID
right join (Select top 10 i.Vendor, sum(c.Count) as Total from ARM_CORE..AppAsIs i
              left join arm_core..Application a on a.ApplicationID = i.ApplicationID
              left join ARM_CORE..AppGroup g on g.AppGroupID = a.AppGroupID
              LEFT JOIN ARM_CORE..[A_AppGroupType] gt on gt.AppGroupType = g.AppGroupType
              left join arm_core..s_ApplicationASISInstallCount c on c.ApplicationID = i.ApplicationID
              where isnull(a.AppGroupID,0) = 0 or gt.AutoMapProcess = 0
              group by i.vendor
              order by Total DESC) z on z.Vendor = i.Vendor
where isnull(a.AppGroupID,0) = 0 or gt.AutoMapProcess = 0)  x on x.ApplicationID = app.ApplicationID

-- Add all Items into _Orphan-Count
update app
set app.AppGroupID = @OrphanCount
from arm_core..Application app
right join (
Select i.ApplicationID, i.Vendor from ARM_CORE..AppAsIs i
left join arm_core..Application a on a.ApplicationID = i.ApplicationID
left join ARM_CORE..AppGroup g on g.AppGroupID = a.AppGroupID
LEFT JOIN ARM_CORE..[A_AppGroupType] gt on gt.AppGroupType = g.AppGroupType
left join arm_core..s_ApplicationASISInstallCount c on c.ApplicationID = i.ApplicationID
right join (Select top 10 i.Vendor, count(c.Count) as Total from ARM_CORE..AppAsIs i
              left join arm_core..Application a on a.ApplicationID = i.ApplicationID
              left join ARM_CORE..AppGroup g on g.AppGroupID = a.AppGroupID
              LEFT JOIN ARM_CORE..[A_AppGroupType] gt on gt.AppGroupType = g.AppGroupType
              left join arm_core..s_ApplicationASISInstallCount c on c.ApplicationID = i.ApplicationID
              where isnull(a.AppGroupID,0) = 0 or gt.AutoMapProcess = 0
              group by i.vendor
              order by Total DESC) z on z.Vendor = i.Vendor
where isnull(a.AppGroupID,0) = 0 or gt.AutoMapProcess = 0)  x on x.ApplicationID = app.ApplicationID



       IF object_id('[ARM_CORE]..[s_ApplicationASISInstallCount]','U') is not null Delete from [ARM_CORE]..[s_ApplicationASISInstallCount]
       INSERT INTO [ARM_CORE]..[s_ApplicationASISInstallCount] ([ApplicationID], [Count])
              SELECT   ApplicationID, COUNT(DISTINCT AssetID) AS Count
              FROM     dbo.AppAstAsIs 
              GROUP BY ApplicationID

       IF object_id('[ARM_CORE]..[s_ApplicationToBeInstallCount]','U') is not null Delete from [ARM_CORE]..[s_ApplicationToBeInstallCount]
       INSERT INTO [ARM_CORE]..[s_ApplicationToBeInstallCount] ([ApplicationID], [Count])
              SELECT   ApplicationID, COUNT(DISTINCT AssetID) AS Count
              FROM     dbo.AppAstToBe
              GROUP BY ApplicationID

END
GO

CREATE proc [dbo].[sp_merge]( @tablename VARCHAR(100), 
						@columnNames VARCHAR(1000),
						@importTableName VARCHAR(100)
				)
AS
BEGIN
DECLARE 	@sql NVARCHAR(MAX), 
			@tempcolumnNames VARCHAR(1000),
			@pk varchar(100),
			@dataType varchar(100), 
			@oneColName varchar(100),
			@sourceValuescolumnNames VARCHAR(1000) = '',
			@insertValuescolumnNames VARCHAR(1000) = '',
			@updateTargetcolumnNames VARCHAR(1000) = ''

SET @tempcolumnNames  = @columnNames

EXEC [dbo].[SYS-Get_Primary_Key]  @tablename, @pk = @pk output 


IF NOT EXISTS(select * from INFORMATION_SCHEMA.COLUMNS where TABLE_NAME = @importTableName and COLUMN_NAME = @pk) 
BEGIN
	SET @sql = CONCAT(N'ALTER TABLE ' , @importTableName , ' ADD ' , @pk , ' INT')
 EXEC sp_executesql @sql
END 



WHILE LEN(@tempcolumnNames) > 0 
BEGIN
	SET @oneColName = left(@tempcolumnNames, charindex(',', @tempcolumnNames+',')-1)


	

	SELECT @dataType =  DATA_TYPE from INFORMATION_SCHEMA.COLUMNS where TABLE_NAME = @tableName  
		AND COLUMN_NAME = REPLACE(REPLACE(@oneColName, '[',''),']','')
	

		IF @dataType in ( 'date', 'datetime') 
		BEGIN 
			SET @insertValuescolumnNames = @insertValuescolumnNames + @oneColName + ' ,'
			SET @sourceValuescolumnNames =  @sourceValuescolumnNames +   CONCAT('parse(','source.', @oneColName, ' AS ', @dataType, ' using ''en-GB''), ')
			SET @updateTargetcolumnNames = @updateTargetcolumnNames +  'target.' + @oneColName + '=' + CONCAT('parse(','source.' + @oneColName , ' AS ', @dataType, ' using ''en-GB''), ')

		END
		ELSE
		BEGIN

		SET @insertValuescolumnNames = @insertValuescolumnNames + @oneColName + ' ,'
		SET @sourceValuescolumnNames = @sourceValuescolumnNames +  'source.' + @oneColName + ' ,'
			--if column is pk dont add to update 
			IF REPLACE(REPLACE(@oneColName, '[',''),']','') <> @pk
			BEGIN
				SET @updateTargetcolumnNames = @updateTargetcolumnNames +  'target.' + @oneColName + '=' + 'source.' + @oneColName + ' ,'
			END
		END
	--END


	set @tempcolumnNames = stuff(@tempcolumnNames, 1, charindex(',', @tempcolumnNames +','), '')
END

SET @insertValuescolumnNames = left(@insertValuescolumnNames,LEN(@insertValuescolumnNames) -1) 
SET @sourceValuescolumnNames = left(@sourceValuescolumnNames,LEN(@sourceValuescolumnNames) -1) 
SET @updateTargetcolumnNames = left(@updateTargetcolumnNames,LEN(@updateTargetcolumnNames) -1) 
SET @tempcolumnNames = @columnNames



  SET @sql = 'MERGE ' + @tableName + ' AS Target
		USING ' + @importTableName + '	AS Source
		ON Source.' + @pk + ' = ' + 'Target.' + @pk +
		' WHEN NOT MATCHED BY Target THEN
			INSERT (' + @insertValuescolumnNames  + ') 
			VALUES (' +@sourceValuescolumnNames +')
		WHEN MATCHED THEN UPDATE SET ' + @updateTargetcolumnNames + ';'
		
    		

			--print @sql
	EXEC sp_sqlexec @sql
END



GO
CREATE proc [dbo].[sp_testQueue]

as 
begin
declare @id int = 2
IF  NOT EXISTS (SELECT * FROM sys.objects 
WHERE object_id = OBJECT_ID(N'[dbo].[TMP_RAW]') AND type in (N'U'))

BEGIN
CREATE TABLE [dbo].TMP_RAW(
   id INT
) 

insert into TMP_RAW
values(@id)
END



end

GO
CREATE proc spInsertInto (@tablename VARCHAR(100), 
						@columnNames VARCHAR(1000),
						@importTableName VARCHAR(100))
AS
BEGIN
DECLARE 	@sql VARCHAR(MAX)


	SET @sql = 'INSERT INTO ' + @tableName + '(' + @columnNames +') SELECT ' + @columnNames + ' FROM ' +@importTableName
	EXEC sp_sqlexec @sql

END
GO
CREATE proc [dbo].[spDataUploadFindChanges] (@tablename VARCHAR(100), 
		@username VARCHAR(100), 
		@IDName VARCHAR(100))
AS
BEGIN

declare @sql NVARCHAR(max),
		@id INT, 
		@maxID INT,
		@tableID INT,
		@colName VARCHAR(100)


IF EXISTS(SELECT [name] FROM tempdb.sys.tables WHERE [name] like '##tempResults') DROP TABLE ##tempResults

CREATE TABLE ##tempResults  (
		ID INT,
		[Column Name] varchar(100),
		[Original Value] varchar(1000),
		[New Value] varchar(1000)
		)


	SELECT	@ID = MIN(a.column_id),
			@maxID = MAX(a.column_id)
	From sys.columns a
	inner join sys.tables b
	on a.object_id = b.object_id 
	where b.name  = @tablename

	WHILE @ID <= @maxid 
	BEGIN
		SELECT @colName = a.[name] FROM  sys.columns a inner join sys.tables b on a.object_id = b.object_id 
		WHERE b.name  = @tablename AND a.column_id  = @id

		SET @sql = N'INSERT INTO ##tempResults 
					SELECT a.' + @IDName + ', ''' + @colName + ''', a.['  + @colName + '], b.['  + @colName + ']
					FROM [' + @tablename + '-' + @username + '] b 
					INNER JOIN [' + @tablename +  '] a
					ON a.' + @IDName + ' =  b.' + @IDName +'
					WHERE a.['  + @colName + '] <> b.['  + @colName + ']'
					--print @sql
		EXEC sp_executesql @sql


		SELECT	@ID = MIN(a.column_id)
		From sys.columns a
		inner join sys.tables b
		on a.object_id = b.object_id 
		where b.name  = @tablename
			AND a.column_id > @id

	END

	--Output differences
	select * from ##tempResults
END

GO


--SELECT * FROM AutoNotification
--update  AutoNotification set PayLoadSQL = 'select top 10  assetid, assettag, serialnumber from asset  where assetid = ''ABDH01271''', Throttle = 10, TemplateID = 49  where AutoNotificationID = 3

--select * from NotificationTemplate
CREATE proc sp_runAutoNotifications (@ANID INT = 0)
AS
	BEGIN
	SET NOCOUNT ON 

	DECLARE @autoID INT, 
			@maxAutoID INT, 
			@autoWhere VARCHAR(30), 
			@audienceFrom VARCHAR(30), 
			@assetID VARCHAR(30),
			@autoName VARCHAR(100), 
			@autoNotificationID INT,
			@AudiencePropertyID INT,
			@PayLoadSQL VARCHAR(max),
			@payloadOutput  VARCHAR(max),
			@payloadRecordCount INT,
			@PayloadAttachment BIT, 
			@payloadAttachmentPath VARCHAR(255),
			@payloadSupressOnEmpty BIT, 
			@LastRun DATETIME, 
			@messagetext VARCHAR(max),
			@messagetextOut VARCHAR(max),
			@subject VARCHAR(max),
			@signaturePath VARCHAR(100), 
			@signatureMarker  VARCHAR(100),
			@signatureReplacementMarker  VARCHAR(100),
			@attachment VARCHAR(max),
			@mailTo VARCHAR(255),
			@SendFrom VARCHAR(255),
			@ReplyTo VARCHAR(255),
			@BccTo VARCHAR(255),
			@ReadReceipt BIT,
			@Important BIT, 
			@DayCountTrigger INT,
			@DayCountTriggers VARCHAR(255),
			@TemplateID INT,
			@Throttle INT,
			@SuppressOnEmpty BIT, 
			@Offset NVARCHAR(20),
			@SQL NVARCHAR(MAX),
			@params NVARCHAR(255),
			@colName VARCHAR(100), 
			@ID INT, 
			@maxID INT, 
			@tableID INT,
			@userID INT, 
			@usermaxID INT

	IF EXISTS(SELECT [name] FROM tempdb.sys.tables WHERE [name] like '##tempdata') DROP TABLE ##tempdata
	

	IF @ANID <> 0 
	BEGIN
		SELECT @autoID = MIN(AutoNotificationID),
				@maxAutoID = MAX(AutoNotificationID)
		FROM AutoNotification
		WHERE Active = 1 
			AND AutoNotificationID =  @ANID
	END
	ELSE
	BEGIN
		SELECT @autoID = MIN(AutoNotificationID),
				@maxAutoID = MAX(AutoNotificationID)
		FROM AutoNotification
		WHERE Active = 1 
	END
				

	WHILE @autoID <= @maxAutoID 
	BEGIN
	
			SELECT @audienceFrom = audienceFrom,
					@autoName = [Name],
					@Offset = DayCountTriggers,
					@autoNotificationID  = AutoNotificationID,
					@AudiencePropertyID =  AudiencePropertyID, 
					@PayLoadSQL = PayLoadSQL,
					@PayloadAttachment  =PayloadAttachment, 
					@payloadSupressOnEmpty = SuppressOnEmpty,
					@PayloadAttachment = PayloadAttachment,
					@LastRun = LastRun, 
					@SendFrom = SendFrom,
					@ReplyTo = ReplyTo,
					@BccTo = BccTo,
					@ReadReceipt = ReadReceipt,
					@Important = Important, 
					@DayCountTrigger = DayCountTrigger,
					@DayCountTriggers = DayCountTriggers,
					@TemplateID = TemplateID,
					@Throttle = Throttle,
					@SuppressOnEmpty = SuppressOnEmpty
			FROM AutoNotification
			WHERE AutoNotificationID = @autoID

			--@audienceFrom becomes the collection type if its a collection
		IF @audienceFrom = 'Collection' SELECT @audienceFrom  = CONCAT('COLLECTION-', UPPER(IsNull([Type],'ASSET'))) FROM A_Collection WHERE CollectionID = @AudiencePropertyID
	
	

		--Get message details 
		SELECT @messagetext = Template , @subject = [subject]
		FROM NotificationTemplate WHERE templateid = @templateID


		--get data for use in template and insert into temp table
		SELECT @SQL = sqlstatement FROM A_templateSQLStatement  WHERE templateType  = @audienceFrom
		IF @Throttle > 0 
			SET @SQL = REPLACE(@SQL, 'SELECT', CONCAT('SELECT TOP ', @Throttle))
		SET @SQL = REPLACE(@SQL, '@Offset', @Offset)
		SET @params = N'@ChannelID INT, @Offset nvarchar(30), @templateID INT'
		EXEC sp_executesql @sql, @params, @ChannelID = @AudiencePropertyID, @Offset = @Offset, @templateID = @TemplateID
	
		--Find number of columns in temp table
		SELECT	@ID = MIN(colid),
				@maxID = MAX(colid),
				@tableID  = max(a.id)
		From tempdb..syscolumns a
		inner join tempdb..sysobjects b
		on a.id = b.id 
		where b.id = object_id('tempdb..##tempData')


		--Snipets
		IF CHARINDEX('{SNIP_',@messagetext) > 0 
		BEGIN
			EXEC dbo.sp_MailerSnippets @messagetext, @messagetextOut OUTPUT
			SET @messagetext = @messagetextOut
		END	


		--payloads
		IF CHARINDEX('{PAYLOAD}',@messagetext) > 0 AND @PayLoadSQL <> ''
		BEGIN
			EXEC dbo.sp_payload @PayLoadSQL, @payloadOutput OUTPUT,@payloadRecordCount OUTPUT
			SET @messagetext = REPLACE(@messagetext, '{PAYLOAD}',@payloadOutput)
		END	

		--signature image
		IF CHARINDEX('{IMAGE',@messagetext) > 0 
		BEGIN
			EXEC sp_mailerSignatures @messagetext, @signatureMarker OUTPUT,  @signaturePath OUTPUT, @signatureReplacementMarker OUTPUT
			SET @messagetext = REPLACE(@messagetext,@signatureMarker, @signatureReplacementMarker)
			SET @attachment = CONCAT(@attachment, @signaturePath)
		END	

		SELECT	@userID = MIN(row_),@usermaxID = MAX(row_) From ##tempData

	

		SET @messagetextOut= @messagetext 
		--replacements 
		IF (@PayLoadSQL = '') OR (@payloadRecordCount > 0 and @payloadSupressOnEmpty = 0)
		BEGIN
			WHILE @userID <= @usermaxID 
			BEGIN

				WHILE @ID <= @maxid 
				BEGIN
		
					SET @assetID = (select Assetid from ##tempData where row_ = @userID)
		

					SELECT @colName = [name] FROM  tempdb..syscolumns WHERE colID = @id and id = @tableID
		
					SET @sql = N'SELECT @messagetext = REPLACE(@messagetext, ''{' + @colName + '}'',CAST(COALESCE([' + @colName + '],'''') AS VARCHAR(MAX))) FROM ##tempData WHERE row_ = @userID'
					SET @params = N'@messagetext nvarchar(MAX) OUTPUT, @userID INT'
					exec sp_executesql @sql, @params, @userID =  @userID ,  @messagetext = @messagetext OUTPUT

					SET @sql = N'SELECT @subject = REPLACE(@subject, ''{' + @colName + '}'',CAST(COALESCE([' + @colName + '],'''')  AS VARCHAR(MAX))) FROM ##tempData WHERE row_ = @userID'
					SET @params = N'@subject nvarchar(MAX) OUTPUT,   @userID INT'
					exec sp_executesql @sql, @params, @userID =  @userID ,  @subject = @subject OUTPUT

					--Get to email address
					IF @colName = 'useremail'
					BEGIN
						SET @sql = N'SELECT @mailTo = [' + @colName + ']  FROM ##tempData  WHERE row_ = @userID'
						SET @params = N' @userID INT, @mailTo nvarchar(255) OUTPUT'
						exec sp_executesql @sql, @params,  @userID =  @userID , @mailTo = @mailTo OUTPUT
					END

					SELECT @id = MIN(colID)
					From tempdb..syscolumns a
					WHERE id = @tableID
						AND colid > @id 

	
	

				END

		
					INSERT INTO A_MailerLog (MailTo, MailFrom, ReadReceipt, Important, subject, body, attachment)
					VALUES(	@mailTo, @SendFrom, @readReceipt, @Important, @subject, @messagetext, @attachment)

					INSERT INTO NotificationLog(name, Owner, email, AssetID, WhenSent, AutoNotificationID, TemplateUsed, Status, Type, CollectionID, TemplateID)
					VALUES(@autoName, '',@mailTo, @assetID,  getdate(),@autoNotificationID, '', '','auto', @AudiencePropertyID, @TemplateID )

		
				SELECT	@userID = MIN(row_)
				From ##tempData
				WHERE row_ > @userID
		
				--reset the message
				SET @id = 1
				SET @messagetext = @messagetextOut
	
			END
		END
			

	IF @ANID <> 0 
	BEGIN
		SELECT  @autoID =   MIN(AutoNotificationID)
		FROM AutoNotification
		WHERE Active  = 1
		AND AutoNotificationID > @autoID
		AND AutoNotificationID  = @ANID
	END
	ELSE
	BEGIN
		SELECT  @autoID =   MIN(AutoNotificationID)
		FROM AutoNotification
		WHERE Active  = 1
		AND AutoNotificationID > @autoID
	END
			
	IF EXISTS(SELECT [name] FROM tempdb.sys.tables WHERE [name] like '##tempdata') DROP TABLE ##tempdata;

	END
END


GO

CREATE proc [dbo].[sp_mailerSignatures]( @message NVARCHAR(MAX),
									@messagetextOut VARCHAR(max) OUTPUT)
AS
BEGIN



DECLARE @sigStart INT, 
		@sigEnd INT, 
		@AttachText NVARCHAR(MAX),
		@signatureMarker NVARCHAR(100)



WHILE CHARINDEX('{IMAGE',@message) > 0 
BEGIN
	SET @sigstart = CHARINDEX('{IMAGE',@message);
	SET @sigend =  CHARINDEX('}',@message, @sigstart) - CHARINDEX('{IMAGE',@message) +1;
	SET @signatureMarker = SUBSTRING(@message, @sigStart, @sigEnd)

	SELECT  @AttachText = '<img src="data:image/jpg;base64,' + CAST(N'' AS XML).value(
          'xs:base64Binary(xs:hexBinary(sql:column("Pic")))'
        , 'NVARCHAR(MAX)') 
		FROM (
		   SELECT CAST(ImageData AS VARBINARY(MAX)) AS Pic  FROM a_mailerImage where ImageName = @signatureMarker
		) AS h;

	SET @message = REPLACE(@message, @signatureMarker, CONCAT(@AttachText , '">'))
END

--SELECT @signaturePath = CONCAT(propertyValue, 'Notifications\Images\', @signatureFileName) from systemglobalproperties where propertyname = 'DataRoot'


--SET @sigReplacementMarker =  CONCAT('<img src="cid:', REVERSE(LEFT(REVERSE(@signaturePath),CHARINDEX('\',reverse(@signaturePath))-1)), '"  alt=""/>')


SET @messagetextOut = @message

end

--go



--declare @pic varchar(max)
--SELECT  @pic = '<img src="data:image/jpg;base64,' + CAST(N'' AS XML).value(
--          'xs:base64Binary(xs:hexBinary(sql:column("Pic")))'
--        , 'VARCHAR(MAX)'
--    ) 
--FROM (
--   SELECT CAST(ImageData AS VARBINARY(MAX)) AS Pic  FROM a_mailerImage where ImageID = 1
--) AS h;

--set @pic = @pic + '" style="height: 100px; width: 100px;" />' 
--print @pic
GO
CREATE PROCEDURE [dbo].[sys_RunAgent] (@agentID INT, @runNow bit = 0, @AUTHUSERID nvarchar(255)='')
AS
BEGIN
       declare @token uniqueidentifier

       BEGIN TRY
             exec usp_AsyncExecInvoke @procedureName = N'sp_agentSingle'
             , @p1 = @agentID, @n1 = N'@agentID'
			 , @p2 = @AUTHUSERID, @n2 = N'@AUTHUSERID'
             , @token = @token output;

             update Sys_Agent set [token] = @token where [AgentID] = @agentID
--           update Sys_Agent set [lastRun] = (select [submit_time] from AsyncExecResults where token = @token) where [AgentID] = @agentID
       END TRY
       BEGIN CATCH
             update Sys_Agent set [Error] = 'Failure : '+ERROR_MESSAGE()+' : ' + cast(GETDATE() as nvarchar(30))  where [AgentID] = @AgentID
       END CATCH


       select @token as [token]
END

GO

create procedure usp_withParam
 @id numeric(4,1)
 , @name varchar(150)
 , @date datetime = NULL
 , @value int = 0
 , @bytes varbinary(max) = NULL
as
begin
    insert into [withParam] (
        id
        , name
        , date
        , value
        , bytes)
     select @id as [id]
      , @name as [name]
      , @date as [date]
      , @value as [value]
      , @bytes as [bytes]
end

GO
-- Dynamic SQL helper procedure
-- Extracts the parameters from the message body
-- Creates the invocation Transact-SQL batch
-- Invokes the dynamic SQL batch
CREATE procedure [dbo].[usp_procedureInvokeHelper] (@x xml)
as
begin
    set nocount on;

    declare @stmt nvarchar(max)
        , @stmtDeclarations nvarchar(max)
        , @stmtValues nvarchar(max)
        , @i int
        , @countParams int
        , @namedParams nvarchar(max)
        , @paramName sysname
        , @paramType sysname
        , @paramPrecision int
        , @paramScale int
        , @paramLength int
        , @paramTypeFull nvarchar(300)
        , @comma nchar(1)

    select @i = 0
        , @stmtDeclarations = N''
        , @stmtValues = N''
        , @namedParams = N''
        , @comma = N''

    declare crsParam cursor forward_only static read_only for
        select x.value(N'@Name', N'sysname')
            , x.value(N'@BaseType', N'sysname')
            , x.value(N'@Precision', N'int')
            , x.value(N'@Scale', N'int')
            , x.value(N'@MaxLength', N'int')
        from @x.nodes(N'//procedure/parameters/parameter') t(x);
    open crsParam;

    fetch next from crsParam into @paramName
        , @paramType
        , @paramPrecision
        , @paramScale
        , @paramLength;
    while (@@fetch_status = 0)
    begin
        select @i = @i + 1;

        select @paramTypeFull = @paramType +
            case
            when @paramType in (N'varchar'
                , N'nvarchar'
                , N'varbinary'
                , N'char'
                , N'nchar'
                , N'binary') then
                N'(' + cast(@paramLength as nvarchar(5)) + N')'
            when @paramType in (N'numeric') then
                N'(' + cast(@paramPrecision as nvarchar(10)) + N',' +
                cast(@paramScale as nvarchar(10))+ N')'
            else N''
            end;

        -- Some basic sanity check on the input XML
        if (@paramName is NULL
            or @paramType is NULL
            or @paramTypeFull is NULL
            or charindex(N'''', @paramName) > 0
            or charindex(N'''', @paramTypeFull) > 0)
            raiserror(N'Incorrect parameter attributes %i: %s:%s %i:%i:%i'
                , 16, 10, @i, @paramName, @paramType
                , @paramPrecision, @paramScale, @paramLength);

        select @stmtDeclarations = @stmtDeclarations + N'
declare @pt' + cast(@i as varchar(3)) + N' ' + @paramTypeFull
            , @stmtValues = @stmtValues + N'
select @pt' + cast(@i as varchar(3)) + N'=@x.value(
    N''(//procedure/parameters/parameter)[' + cast(@i as varchar(3)) 
                + N']'', N''' + @paramTypeFull + ''');'
            , @namedParams = @namedParams + @comma + @paramName
                + N'=@pt' + cast(@i as varchar(3));

        select @comma = N',';

        fetch next from crsParam into @paramName
            , @paramType
            , @paramPrecision
            , @paramScale
            , @paramLength;
    end

    close crsParam;
    deallocate crsParam;        

    select @stmt = @stmtDeclarations + @stmtValues + N'
exec ' + quotename(@x.value(N'(//procedure/name)[1]', N'sysname'));

    if (@namedParams != N'')
        select @stmt = @stmt + N' ' + @namedParams;

    exec sp_executesql @stmt, N'@x xml', @x;
end

GO
CREATE procedure [dbo].[sys_AsyncExecInvoke2]
    @procedureName sysname
    , @token uniqueidentifier output
as
begin
    declare @h uniqueidentifier
	    , @xmlBody xml
        , @trancount int;
    set nocount on;

	set @trancount = @@trancount;
    if @trancount = 0
        begin transaction
    else
        save transaction sys_AsyncExecInvoke;
    begin try
        begin dialog conversation @h
            from service [AsyncExecService]
            to service N'AsyncExecService', 'current database'
            with encryption = off;
        select @token = [conversation_id]
            from sys.conversation_endpoints
            where [conversation_handle] = @h;
        select @xmlBody = (
            select @procedureName as [name]
            for xml path('procedure'), type);
        send on conversation @h (@xmlBody);
        insert into [sys_AsyncExecResults]
            ([token], [submit_time])
            values
            (@token, getutcdate());
    if @trancount = 0
        commit;
    end try
    begin catch
        declare @error int
            , @message nvarchar(2048)
            , @xactState smallint;
        select @error = ERROR_NUMBER()
            , @message = ERROR_MESSAGE()
            , @xactState = XACT_STATE();
        if @xactState = -1
            rollback;
        if @xactState = 1 and @trancount = 0
            rollback
        if @xactState = 1 and @trancount > 0
            rollback transaction sys_my_procedure_name;

        raiserror(N'Error: %i, %s', 16, 1, @error, @message);
    end catch
end

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_CollectionTab_1] 
@CID as INT
AS
BEGIN
	select CollectionID from [ARM_CORE]..[A_Collection] where CollectionID = @CID
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_CollectionEvents_2] 
@CID INT = -1
AS
BEGIN
	SELECT c.*
	from [ARM_CORE]..[A_Collection] c
	WHERE ISNULL(c.CollectionID, 0) = @CID

END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_CollectionEvents_1] 
@CID INT = -1
AS
BEGIN
SELECT c.[Type],
       a.CollectionAgentID,
       a.Label,
       ISNULL(a.Mode, 0) AS Mode,
       l.Label AS ModeLabel,
       a.CollectionID,
	   iif(exists (select collectionID from [ARM_CORE]..[A_Collection] where collectionID = a.CollectionID),1,0) as CollectionExists,
       cc.Name AS [ClassName],
       c.Name,
       a.[Order],
       a.Frequency,
	   f.Label as FrequencyLabel,
       a.Active,
       a.Pass,
       a.qualifySQL,
       CASE
           WHEN (DATEPART(HOUR, GETDATE()) IN
                 (
                     SELECT value
                     FROM [ARM_CORE]..fn_split_string(ISNULL([Frequency], ''), ',')
                 )
                )
                AND Active = 1 THEN
               1
           ELSE
               0
       END AS [Current],
       ISNULL(a.Info, '') AS [Info]
FROM [ARM_CORE]..[A_CollectionAgent] a
    LEFT JOIN [ARM_CORE]..[A_Collection] c
        ON c.CollectionID = a.CollectionID
    LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc
        ON cc.CollectionClassID = c.CollectionClassID
    LEFT JOIN [ARM_CORE]..[A_LookUp] l
        ON l.[Lookup] = ISNULL(a.Mode, 0)
           AND l.[Column] = 'Mode'
           AND l.[Table] = 'A_CollectionAgent'
    LEFT JOIN [ARM_CORE]..[A_LookUp] f
        ON f.[Lookup] = ISNULL(a.Frequency, '')
           AND f.[Column] = 'Frequency'
           AND f.[Table] = 'A_CollectionAgent'
WHERE ISNULL(a.CollectionID, 0) = @CID
ORDER BY a.[Pass], a.[Order]

END;


GO

-- Invocation wrapper. Accepts arbitrary
-- named parameetrs to be passed to the
-- background procedure
CREATE procedure [dbo].[usp_AsyncExecInvoke]
    @procedureName sysname
    , @p1 sql_variant = NULL, @n1 sysname = NULL
    , @p2 sql_variant = NULL, @n2 sysname = NULL
    , @p3 sql_variant = NULL, @n3 sysname = NULL
    , @p4 sql_variant = NULL, @n4 sysname = NULL
    , @p5 sql_variant = NULL, @n5 sysname = NULL
    , @token uniqueidentifier output
as
begin
    declare @h uniqueidentifier
     , @xmlBody xml
        , @trancount int;
    set nocount on;

 set @trancount = @@trancount;
    if @trancount = 0
        begin transaction
    else
        save transaction usp_AsyncExecInvoke;
    begin try
        begin dialog conversation @h
            from service [AsyncExecService]
            to service N'AsyncExecService', 'current database'
            with encryption = off;
        select @token = [conversation_id]
            from sys.conversation_endpoints
            where [conversation_handle] = @h;

        select @xmlBody = (
            select @procedureName as [name]
            , (select * from (
                select [dbo].[fn_DescribeSqlVariant] (@p1, @n1) AS [*] 
                    WHERE @p1 IS NOT NULL
                union all select [dbo].[fn_DescribeSqlVariant] (@p2, @n2) AS [*] 
                    WHERE @p2 IS NOT NULL
                union all select [dbo].[fn_DescribeSqlVariant] (@p3, @n3) AS [*] 
                    WHERE @p3 IS NOT NULL
                union all select [dbo].[fn_DescribeSqlVariant] (@p4, @n4) AS [*] 
                    WHERE @p4 IS NOT NULL
                union all select [dbo].[fn_DescribeSqlVariant] (@p5, @n5) AS [*] 
                    WHERE @p5 IS NOT NULL
                ) as p for xml path(''), type
            ) as [parameters]
            for xml path('procedure'), type);
        send on conversation @h (@xmlBody);


        insert into [AsyncExecResults]
            ([token], [submit_time])
            values
            (@token, getdate());

		if @trancount = 0
			commit;
    end try
    begin catch
        declare @error int
            , @message nvarchar(2048)
            , @xactState smallint;
        select @error = ERROR_NUMBER()
            , @message = ERROR_MESSAGE()
            , @xactState = XACT_STATE();
        if @xactState = -1
            rollback;
        if @xactState = 1 and @trancount = 0
            rollback
        if @xactState = 1 and @trancount > 0
            rollback transaction usp_my_procedure_name;

        raiserror(N'Error: %i, %s', 16, 1, @error, @message);
    end catch
end


GO
CREATE procedure [dbo].[usp_AsyncExecActivated]
as
begin
    set nocount on;
    declare @h uniqueidentifier
        , @messageTypeName sysname
        , @messageBody varbinary(max)
        , @xmlBody xml
        , @startTime datetime
        , @finishTime datetime
        , @execErrorNumber int
        , @execErrorMessage nvarchar(2048)
        , @xactState smallint
        , @token uniqueidentifier;

    begin transaction;
    begin try;
        receive top(1)
            @h = [conversation_handle]
            , @messageTypeName = [message_type_name]
            , @messageBody = [message_body]
            from [AsyncExecQueue];
        if (@h is not null)
        begin
            if (@messageTypeName = N'DEFAULT')
            begin
                -- The DEFAULT message type is a procedure invocation.
                --
                select @xmlBody = CAST(@messageBody as xml);

                save transaction usp_AsyncExec_procedure;
                select @startTime = GETDATE();
                begin try
                    exec [usp_procedureInvokeHelper] @xmlBody;
                end try
                begin catch
                -- This catch block tries to deal with failures of the procedure execution
                -- If possible it rolls back to the savepoint created earlier, allowing
                -- the activated procedure to continue. If the executed procedure
                -- raises an error with severity 16 or higher, it will doom the transaction
                -- and thus rollback the RECEIVE. Such case will be a poison message,
                -- resulting in the queue disabling.
                --
                select @execErrorNumber = ERROR_NUMBER(),
                    @execErrorMessage = ERROR_MESSAGE(),
                    @xactState = XACT_STATE();
                if (@xactState = -1)
                begin
                    rollback;
                    raiserror(N'Unrecoverable error in procedure: %i: %s', 16, 10,
                        @execErrorNumber, @execErrorMessage);
                end
                else if (@xactState = 1)
                begin
                    rollback transaction usp_AsyncExec_procedure;
                end
                end catch

                select @finishTime = GETDATE();
                select @token = [conversation_id]
                    from sys.conversation_endpoints
                    where [conversation_handle] = @h;
                if (@token is null)
                begin
                    raiserror(N'Internal consistency error: conversation not found', 16, 20);
                end
                update [AsyncExecResults] set
                    [start_time] = @starttime
                    , [finish_time] = @finishTime
                    , [error_number] = @execErrorNumber
                    , [error_message] = @execErrorMessage
                    where [token] = @token;
                if (0 = @@ROWCOUNT)
                begin
                    raiserror(N'Internal consistency error: token not found', 16, 30);
                end
                end conversation @h;
            end
            else if (@messageTypeName = N'http://schemas.microsoft.com/SQL/ServiceBroker/EndDialog')
            begin
                end conversation @h;
            end
            else if (@messageTypeName = N'http://schemas.microsoft.com/SQL/ServiceBroker/Error')
            begin
                declare @errorNumber int
                    , @errorMessage nvarchar(4000);
                select @xmlBody = CAST(@messageBody as xml);
                with xmlnamespaces (DEFAULT N'http://schemas.microsoft.com/SQL/ServiceBroker/Error')
                select @errorNumber = @xmlBody.value ('(/Error/Code)[1]', 'INT'),
                    @errorMessage = @xmlBody.value ('(/Error/Description)[1]', 'NVARCHAR(4000)');
                -- Update the request with the received error
                select @token = [conversation_id] 
                    from sys.conversation_endpoints 
                    where [conversation_handle] = @h;
                update [AsyncExecResults] set
                    [error_number] = @errorNumber
                    , [error_message] = @errorMessage
                    where [token] = @token;
                end conversation @h;
             end
           else
           begin
                raiserror(N'Received unexpected message type: %s', 16, 50, @messageTypeName);
           end
        end
        commit;
    end try
    begin catch
        declare @error int
         , @message nvarchar(2048);
        select @error = ERROR_NUMBER()
            , @message = ERROR_MESSAGE()
            , @xactState = XACT_STATE();
        if (@xactState <> 0)
        begin
         rollback;
        end;
        raiserror(N'Error: %i, %s', 1, 60,  @error, @message) with log;
    end catch
end

GO

CREATE proc [dbo].[sp_MailerSnippets] (@messagetext NVARCHAR(MAX), @messagetextOut NVARCHAR(MAX) OUTPUT) 
AS
BEGIN	
	DECLARE @id INT, 
			@totalSnips INT, 
			@start INT, 
			@end INT, 
			@snippetname NVARCHAR(255), 
			@snippet NVARCHAR(MAX)
	
	
	SET @ID = 1


	set @start = 1

	WHILE CHARINDEX('{SNIP_',@messagetext) > 0 and @id < 21
	BEGIN
			SET @start = charindex('{SNIP', @messagetext, @start+1)
			SET @end =   charindex('}', @messagetext, @start) - charindex('{SNIP', @messagetext, @start)+1

			SET @snippetname =  substring(@messagetext, @start,@end )
			SELECT @snippet = Snippet FROM a_snippet WHERE marker = replace(replace(@snippetname,'{',''),'}','')
			SET @messagetext = REPLACE(@messagetext, @snippetname, @snippet)

		SET @id = @id + 1
	END
	SET  @messagetextOut = @messagetext
END
GO
create procedure [usp_testProcedure]
as
begin
    set nocount on;
    
    insert into Page (PageTitle) values ('test');
end

GO

create procedure [usp_MyFaultyProcedure]
as
begin
    set nocount on;
    declare @t table (id int primary key);
    insert into @t (id) values (1);
    insert into @t (id) values (1);
end

GO
create procedure [usp_MyLongRunningProcedure]
as
begin
    waitfor delay '00:00:05';
end

GO
create procedure [sys_AsyncExecInvoke]
    @procedureName sysname
    , @token uniqueidentifier output
as
begin
    declare @h uniqueidentifier
	    , @xmlBody xml
        , @trancount int;
    set nocount on;

	set @trancount = @@trancount;
    if @trancount = 0
        begin transaction
    else
        save transaction sys_AsyncExecInvoke;
    begin try
        begin dialog conversation @h
            from service [AsyncExecService]
            to service N'AsyncExecService', 'current database'
            with encryption = off;
        select @token = [conversation_id]
            from sys.conversation_endpoints
            where [conversation_handle] = @h;
        select @xmlBody = (
            select @procedureName as [name]
            for xml path('procedure'), type);
        send on conversation @h (@xmlBody);
        insert into [sys_AsyncExecResults]
            ([token], [submit_time])
            values
            (@token, getutcdate());
    if @trancount = 0
        commit;
    end try
    begin catch
        declare @error int
            , @message nvarchar(2048)
            , @xactState smallint;
        select @error = ERROR_NUMBER()
            , @message = ERROR_MESSAGE()
            , @xactState = XACT_STATE();
        if @xactState = -1
            rollback;
        if @xactState = 1 and @trancount = 0
            rollback
        if @xactState = 1 and @trancount > 0
            rollback transaction sys_my_procedure_name;

        raiserror(N'Error: %i, %s', 16, 1, @error, @message);
    end catch
end

GO
CREATE procedure sys_AsyncExecActivated
as
begin
    set nocount on;
    declare @h uniqueidentifier
        , @messageTypeName sysname
        , @messageBody varbinary(max)
        , @xmlBody xml
        , @procedureName sysname
        , @startTime datetime
        , @finishTime datetime
        , @execErrorNumber int
        , @execErrorMessage nvarchar(2048)
        , @xactState smallint
        , @token uniqueidentifier;

    begin transaction;
    begin try;
        receive top(1) 
            @h = [conversation_handle]
            , @messageTypeName = [message_type_name]
            , @messageBody = [message_body]
            from [AsyncExecQueue];



        if (@h is not null)
        begin
            if (@messageTypeName = N'DEFAULT')
            begin
                -- The DEFAULT message type is a procedure invocation.
                -- Extract the name of the procedure from the message body.
                --
                select @xmlBody = CAST(@messageBody as xml);
                select @procedureName = @xmlBody.value(
                    '(//procedure/name)[1]'
                    , 'sysname');

                save transaction sys_AsyncExec_procedure;
                select @startTime = GETUTCDATE();
                begin try
                    exec @procedureName;
                end try
                begin catch
                -- This catch block tries to deal with failures of the procedure execution
                -- If possible it rolls back to the savepoint created earlier, allowing
                -- the activated procedure to continue. If the executed procedure 
                -- raises an error with severity 16 or higher, it will doom the transaction
                -- and thus rollback the RECEIVE. Such case will be a poison message,
                -- resulting in the queue disabling.
                --
                select @execErrorNumber = ERROR_NUMBER(),
                    @execErrorMessage = ERROR_MESSAGE(),
                    @xactState = XACT_STATE();
                if (@xactState = -1)
                begin
                    rollback;
                    raiserror(N'Unrecoverable error in procedure %s: %i: %s', 16, 10,
                        @procedureName, @execErrorNumber, @execErrorMessage);
                end
                else if (@xactState = 1)
                begin
                    rollback transaction sys_AsyncExec_procedure;
                end
                end catch

			insert into Page (PageTitle,PageHeader) values ('sys_AsyncExecActivated',@procedureName);

                select @finishTime = GETUTCDATE();
                select @token = [conversation_id] 
                    from sys.conversation_endpoints 
                    where [conversation_handle] = @h;
                if (@token is null)
                begin
                    raiserror(N'Internal consistency error: conversation not found', 16, 20);
                end
                update [AsyncExecResults] set
                    [start_time] = @starttime
                    , [finish_time] = @finishTime
                    , [error_number] = @execErrorNumber
                    , [error_message] = @execErrorMessage
					, [JRR] = 1
                    where [token] = @token;
                if (0 = @@ROWCOUNT)
                begin
                    raiserror(N'Internal consistency error: token not found', 16, 30);
                end
                end conversation @h;
            end 
            else if (@messageTypeName = N'http://schemas.microsoft.com/SQL/ServiceBroker/EndDialog')
            begin
                end conversation @h;
            end
            else if (@messageTypeName = N'http://schemas.microsoft.com/SQL/ServiceBroker/Error')
            begin
                declare @errorNumber int
                    , @errorMessage nvarchar(4000);
                select @xmlBody = CAST(@messageBody as xml);
                with xmlnamespaces (DEFAULT N'http://schemas.microsoft.com/SQL/ServiceBroker/Error')
                select @errorNumber = @xmlBody.value ('(/Error/Code)[1]', 'INT'),
                    @errorMessage = @xmlBody.value ('(/Error/Description)[1]', 'NVARCHAR(4000)');
                -- Update the request with the received error
                select @token = [conversation_id] 
                    from sys.conversation_endpoints 
                    where [conversation_handle] = @h;
                update [sys_AsyncExecResults] set
                    [error_number] = @errorNumber
                    , [error_message] = @errorMessage
                    where [token] = @token;
                end conversation @h;
             end
           else
           begin
                raiserror(N'Received unexpected message type: %s', 16, 50, @messageTypeName);
           end
        end
        commit;
    end try
    begin catch
        declare @error int
            , @message nvarchar(2048);
        select @error = ERROR_NUMBER()
            , @message = ERROR_MESSAGE()
            , @xactState = XACT_STATE();
        if (@xactState <> 0)
        begin
            rollback;
        end;
        raiserror(N'Error: %i, %s', 1, 60,  @error, @message) with log;
    end catch
end

GO
CREATE PROC [dbo].[spUploadMergeColumns] (
				@table varchar(100)
				)
AS

BEGIN

SELECT [column] AS [name], (select count(*) from  A_TableEdit WHERE UploadCriteria = 1 AND [Table] = @table)  as recordCount 
FROM A_TableEdit WHERE UploadCriteria = 1 AND [Table] = @table
GROUP BY [column], [Order]
ORDER BY [Order]
--DECLARE @list varchar(255) = (select mergeon from A_TablePermit where [table] = @table)

--SELECT c.name, c.column_id 
--FROM sys.columns c 
--inner join sys.tables t
--on  c.object_id = t.object_id
--inner join A_TablePermit tp 
--on t.name = tp.[Table]
--where tp.[Table] = @table
--and c.column_id in (SELECT
--					trim(ltrim(x.f.value( '.', 'varchar(2)' ))) AS list
--				FROM ( 
--					SELECT CAST ( '<v><i>' + REPLACE ( @list, ',', '</i><i>' ) + '</i></v>' AS xml ) AS x 
--				) AS d
--				CROSS APPLY x.nodes( '//v/i' ) x( f ))

END


GO

CREATE PROCEDURE [dbo].[SYS_AppGroupAutoMap]
AS
BEGIN
	SET NOCOUNT ON;

	-- Clears all mappings and app associations to groups ... NOTE: May need to protect some groups?
	-- Drive from AppGroups.  Get all app groups

	--  Type				Value	Auto	Order	Map		Grab
	----------------------------------------------------------
	--	Primary				0-9		Y		1		Y		All
	--	Primary - Exclude	2		Y		2		N		All	
	--	Primary - Stop		10-19	Y		3		N		All	
	--	Secondary - Stop	20-29	Y		4		N		Un-Grouped
	--	Orphan				30+		0		5		N		n/a
	----------------------------------------------------------

	-- s_ApplicationAsIsInstallCount is a prerequisite for this procedure
	-- s_ApplicationToBeInstallCount ican be calculated after Orphan Code is run.


	DECLARE @APPGRPID int;
	DECLARE @APPGRPNAME nvarchar(300);
	DECLARE @APPGRPTYPE smallint;
	DECLARE @MAP bit;


	DECLARE app_group CURSOR 
	LOCAL STATIC
	FOR 
		SELECT  g.[AppGroupName], g.[AppGroupID], g.[AppGroupType], gt.[Map] FROM [ARM_CORE].[dbo].[Appgroup] g
		LEFT JOIN [ARM_CORE]..[A_AppGroupType] gt on gt.AppGroupType = g.[AppGroupType]
		where IsNull(gt.AutoMapProcess,0) = 1 and IsNull(g.AppGroupName,'') not in ( '_WIP', '', ' ', '_', '-') 
		order by g.[AppGroupType] , g.AppGroupName

	OPEN app_group  
    FETCH NEXT FROM app_group INTO @APPGRPNAME, @APPGRPID, @APPGRPTYPE, @MAP

	-- UPDATE 	[ARM_CORE]..[TransformAppMap] set [AutoMapCount] = 0 

	DELETE FROM [ARM_CORE]..[TransformAppMap];

	UPDATE [ARM_CORE]..[Application] set AppGroupID = 0 ;

    WHILE @@FETCH_STATUS = 0  
    BEGIN 
	-- Run Criteria for each Appgroup and silent commit
	-- This sets  [CurrentApplication] for the Appgroup

		EXEC [ARM_CORE]..[AppGroupAutoMap] @APPGRPID , 2

		if @MAP = 1
		BEGIN
			MERGE [ARM_CORE]..[TransformAppMap] as [Target] using (
				select s.[ApplicationID], g.[CurrentApplication] as [To Be] from [ARM_CORE]..[Application] s LEFT JOIN [ARM_CORE]..[AppGroup] g on g.AppGroupID = s.AppGroupID where s.AppgroupID = @APPGRPID
			) as [SOURCE] 
			on (Target.[As Is] = Source.[ApplicationID])
			WHEN NOT MATCHED BY TARGET THEN
				insert ([As Is],[To Be], [Status], [AutoMapCount], [Hits], [LatestAppGroupID])
				values (Source.[ApplicationID], Source.[To Be], 'AppAutoMap', 1, cast(@APPGRPID as nvarchar(20)),cast(@APPGRPID as nvarchar(20)))
			WHEN MATCHED THEN
				update set [To Be] = Source.[To Be], [Status] = 'AppAutoMap', [AutoMapCount] = [AutoMapCount] + 1, [Hits] = IsNull([Hits],'') + ',' + cast(@APPGRPID as nvarchar(20)), [LatestAppGroupID]= cast(@APPGRPID as nvarchar(20));
		END


		FETCH NEXT FROM app_group INTO @APPGRPNAME, @APPGRPID, @APPGRPTYPE, @MAP
	END

	
	CLOSE app_group  
	DEALLOCATE app_group 


	-- Clear out the ToBe Apps and reproduce using the AppGroup Mappings just defined or the app itself if non yet specified
	-- Can we run Orphan Code here or is AppAstToBe entry expected for Orphan code to run??


	IF object_id('[ARM_CORE]..[AppAstToBe]','U') is not null Delete from [ARM_CORE]..[AppAstToBe]

	INSERT INTO [ARM_CORE]..[AppAstToBe] (AssetID, ApplicationID )
	SELECT distinct r.* from (
		SELECT a.AssetID, IsNull(m.[To Be],a.[ApplicationID]) AS ApplicationID from [ARM_CORE]..[AppAstAsIs] a 
		LEFT JOIN [ARM_CORE]..[Asset] t on t.AssetID = a.AssetID
		LEFT JOIN [ARM_CORE]..[TransformAppMap] m on  m.[As Is] = a.ApplicationID 
		LEFT JOIN [ARM_CORE]..[Application] ap on ap.ApplicationID = a.ApplicationID
		LEFT JOIN [ARM_CORE]..[AppGroup] g on g.AppGroupID = ap.AppGroupID
		LEFT JOIN [ARM_CORE]..[A_AppGroupType] gt on gt.AppGroupType = g.[AppGroupType]
		where (IsNull(g.AppGroupID,0) = 0 or gt.Map = 1) and IsNull(gt.[Stop],0) = 0
	) r




	-- Makes sure we have an application in Application Table that appears on ToBe
	-- Note applications must exist for Orphan Code to run correctly

	MERGE [ARM_CORE]..[Application] as [Target] 
	using ( 
			select distinct b.ApplicationID, 0 as AppGroupID, s.AppName as [name], s.AppVersion as [version]  from AppAstToBe b with(nolock) LEFT JOIN Application a on a.ApplicationID = b.ApplicationID LEFT JOIN [ARM_CORE]..[AppAsIs] s on s.ApplicationID = b.ApplicationID where a.ApplicationID IS NULL
	) as [SOURCE] 
	on (Target.ApplicationID = Source.ApplicationID)
	WHEN NOT MATCHED BY TARGET THEN
			insert ([ApplicationID],[AppGroupID],[Name],[Version])
			values (Source.[ApplicationID], Source.[AppgroupID], Source.[Name], Source.[Version]);




	--IF object_id('[ARM_CORE]..[s_ApplicationToBeInstallCount]','U') is not null Delete from [ARM_CORE]..[s_ApplicationToBeInstallCount]

	--INSERT INTO [ARM_CORE]..[s_ApplicationToBeInstallCount] (ApplicationID, [Count])
	--SELECT   b.ApplicationID, COUNT(DISTINCT b.AssetID) AS Count
	--FROM     dbo.AppAstToBe b
	--GROUP BY b.ApplicationID



END



GO

CREATE PROCEDURE [dbo].[AppGroupPrimeCriteria]
AS
BEGIN
	SET NOCOUNT ON;
	
	DECLARE @SQL nvarchar(MAX);
	DECLARE @APPGRPID nvarchar(250);
	DECLARE @APPGRPNAME nvarchar(250);
	DECLARE @WORD nvarchar(250);

	DECLARE app_criteria CURSOR FOR 
		SELECT [AppgroupName], [AppGroupID] FROM [ARM_CORE].[dbo].[Appgroup] where IsNull(AppGroupName,'') not in ( '_WIP', '', ' ')

	OPEN app_criteria  
    FETCH NEXT FROM app_criteria INTO @APPGRPNAME, @APPGRPID

    WHILE @@FETCH_STATUS = 0  
    BEGIN 

		DECLARE app_criteria_component CURSOR FOR 
			select value from STRING_SPLIT(@APPGRPNAME,' ')

		OPEN app_criteria_component   
		FETCH NEXT FROM app_criteria_component INTO @WORD

		MERGE [ARM_CORE]..[A_AppGroupNominations]  as TARGET using (select @APPGRPID as AppGroupID ) as SOURCE
		ON (Target.[AppGroupID] = Source.[AppGroupID])
		WHEN NOT MATCHED BY TARGET THEN
			insert([AppGroupID],[FixedNomination],[PackagedNomination],[CommonNomination])
			values (Source.AppgroupID, '', '', '');

		WHILE @@FETCH_STATUS = 0  
		BEGIN 
			if @WORD <> '-' and @WORD <> ' ' and @WORD <> '_' and @WORD <> '%' and @WORD <> '+'
			BEGIN
				MERGE [ARM_CORE]..[A_AppCriteria] as TARGET using (select @APPGRPID as AppGroupID 
					, 'like ''%{X}%''  ' as AppCriteriaType 
					, Replace(@WORD,'''','''''') as AppCriteriaTerm 
					, 0 as [AltLogicGroup], '' as Nominate) as SOURCE 
				ON (Target.AppGroupID = Source.AppGroupID and Target.AppCriteriaType = Source.AppCriteriaType 
					and Target.AppCriteriaTerm = Source.AppCriteriaTerm and Target.AltLogicGroup = Source.AltLogicGroup 
					and Target.Nominate = Source.Nominate)
				WHEN NOT MATCHED BY TARGET THEN 
				insert ([AppGroupID], [AppCriteriaType],[AppCriteriaTerm],[AltLogicGroup],[Nominate]) 
				values (Source.AppGroupID, Source.AppCriteriaType, Source.AppCriteriaTerm, Source.AltLogicGroup, Source.Nominate); 
			END

			FETCH NEXT FROM app_criteria_component INTO @WORD
		END
		
		CLOSE app_criteria_component  
		DEALLOCATE app_criteria_component 

		FETCH NEXT FROM app_criteria INTO @APPGRPNAME, @APPGRPID
	END

	CLOSE app_criteria  
	DEALLOCATE app_criteria 
END



GO
CREATE PROCEDURE [dbo].[AppGroupAutoMap]
	@AppGroupID as int,
	@commit int = 0
AS
BEGIN
	SET NOCOUNT ON;

-- This procedure is called from [SYS_AppGroupAutoMap] which passes the AppGroupID

-- if @commit > 0 then automappings and currentApplication are also generated / updated (comitted)
-- if @commit = 2 then when commit is carried do not list the nomination candidates (i.e. silent).  i.e. part of SYS_AppGroupAutoMap execution thread.

	DECLARE @AppGroupType smallint;
	DECLARE @Map bit;

	SET @AppGroupType = 0

	select @AppGroupType = IsNull(g.AppGroupType,0), @Map = gt.[Map] from [ARM_CORE]..[AppGroup] g LEFT JOIN [ARM_CORE]..[A_AppGroupType] gt on gt.AppGroupType = g.AppGroupType where AppGroupID = @AppGroupID


	DECLARE @SQL nvarchar(MAX);
	DECLARE @BIGSQL nvarchar(MAX);

	DECLARE @WHERE nvarchar(3000);
	DECLARE @WHERE_PACKAGE nvarchar(3000);
	DECLARE @WHERE_COMMON nvarchar(3000);

	DECLARE @FIXED_NOMINATION nvarchar(300);
	DECLARE @PACKAGE_NOMINATION nvarchar(300);
	DECLARE @COMMON_NOMINATION nvarchar(300);
	
	DECLARE @CURRENT_APPLICATION nvarchar(300);



	-- When combined with the respective "Where" clauses and "Order by" we will get the app with the most installs

	SET @SQL ='	select top 1 s.[ApplicationID] from [ARM_CORE]..[s_ApplicationASISInstallCount] s with(nolock) 
				 LEFT JOIN [ARM_CORE]..Application a on a.ApplicationID = s.[ApplicationID] 
				 LEFT JOIN [ARM_CORE]..[AppGroup] g on g.AppGroupID = a.AppGroupID
				 LEFT JOIN [ARM_CORE]..[A_AppGroupType] gt on gt.AppGroupType = g.[AppGroupType] '

	-- "Where" clauses constructed from AppCriteria for each 
	set @WHERE = dbo.[AppGroupAutoMapWhereClause](@AppGroupID,'')
	set @WHERE_PACKAGE = dbo.[AppGroupAutoMapWhereClause](@AppGroupID,'Package')
	set @WHERE_COMMON = dbo.[AppGroupAutoMapWhereClause](@AppGroupID,'Common')

	if @WHERE <> '' 
	BEGIN
		set @BIGSQL = 
			'MERGE [ARM_CORE]..[A_AppGroupNominations] as [TARGET] using (select ' + cast(@AppGroupID as nvarchar(20)) + ' as [AppgroupID]
				, IsNull((' + @SQL + @WHERE + @WHERE_PACKAGE + ' and IsNull(a.PackageID,'''') <> '''' order by s.[Count] desc, s.[ApplicationID] desc),'''') as [PackagedNomination]
				, IsNull((' + @SQL + @WHERE + @WHERE_COMMON + ' order by s.[Count] desc, s.[ApplicationID] desc ),'''') as [CommonNomination] 
			) as [SOURCE] 
			 ON (Target.AppGroupID = Source.AppGroupID) 
			 WHEN NOT MATCHED BY TARGET THEN 
				insert ([AppGroupID],[FixedNomination],[PackagedNomination],[CommonNomination]) 
				values (Source.AppGroupID, '''', Source.PackagedNomination, Source.CommonNomination)
			 WHEN MATCHED THEN 
				update set [PackagedNomination]=Source.PackagedNomination,[CommonNomination]=Source.CommonNomination; 
			'

		EXEC( @BIGSQL)

		select @FIXED_NOMINATION = IsNull([FixedNomination],''), @PACKAGE_NOMINATION = IsNull([PackagedNomination],''), @COMMON_NOMINATION = IsNull([CommonNomination],'') from [ARM_CORE]..[A_AppGroupNominations] where AppGroupID = @AppGroupID

		set @CURRENT_APPLICATION = (
			case 
				when @FIXED_NOMINATION <> '' then @FIXED_NOMINATION
				when @PACKAGE_NOMINATION <> '' then @PACKAGE_NOMINATION			
				when @COMMON_NOMINATION <> '' then @COMMON_NOMINATION	
				else ''
			end)

		if @commit <> 0
		BEGIN
			UPDATE [ARM_CORE]..[Application] set AppgroupID = 0 where AppGroupID = @AppGroupID

			if 	@MAP = 1 
				UPDATE [ARM_CORE]..[AppGroup] SET [CurrentApplication] = @CURRENT_APPLICATION where AppGroupID = @AppGroupID
			else
				UPDATE [ARM_CORE]..[AppGroup] SET [CurrentApplication] = '' where AppGroupID = @AppGroupID

			set @BIGSQL = 
				'MERGE [ARM_CORE]..[Application] as [Target] 
					using ( 
						select distinct  s.[ApplicationID], ' + cast(@AppGroupID as nvarchar(20)) + ' as [AppGroupID], s.AppName as [name], s.AppVersion as [version]
						from [ARM_CORE]..[AppAsIs] s 
						LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = s.[ApplicationID] 
						LEFT JOIN [ARM_CORE]..[AppGroup] g on g.AppGroupID = a.AppGroupID 
						LEFT JOIN [ARM_CORE]..[A_AppGroupType] gt on gt.AppGroupType = g.AppGroupType ' + @WHERE + '
					) as [SOURCE] 
					on (Target.ApplicationID = Source.ApplicationID)
					WHEN NOT MATCHED BY TARGET THEN
						insert ([ApplicationID],[AppGroupID],[Name],[Version])
						values (Source.[ApplicationID], Source.[AppgroupID], Source.[Name], Source.[Version])
					WHEN MATCHED THEN
						update set AppGroupID = Source.[AppgroupID], Name = Source.[Name], Version = Source.[Version];
				'

			exec( @BIGSQL)

			delete from [ARM_CORE]..[TransformAppMap] where [LatestAppgroupID] = cast(@AppGroupID as nvarchar(20))


			if @Map = 1
			BEGIN
				MERGE [ARM_CORE]..[TransformAppMap] as [Target] using (
					select s.[ApplicationID], (select [CurrentApplication] from [ARM_CORE]..[AppGroup] where AppGroupID = @AppgroupID) as [To Be] from [ARM_CORE]..[Application] s where AppgroupID = @AppGroupID
				) as [SOURCE] 
				on (Target.[As Is] = Source.[ApplicationID])
				WHEN NOT MATCHED BY TARGET THEN
					insert ([As Is],[To Be],[LatestAppGroupID])
					values (Source.[ApplicationID], Source.[To Be], cast(@AppGroupID as nvarchar(20)))
				WHEN MATCHED THEN
					update set [To Be] = Source.[To Be], [LatestAppGroupID] = cast(@AppGroupID as nvarchar(20));
			END

		END

		if @Commit <> 2
		BEGIN
			select [AppGroupID], @CURRENT_APPLICATION as [CurrentApplication], [FixedNomination], [PackagedNomination], [CommonNomination] from [ARM_CORE]..[A_AppGroupNominations] g  where g.AppGroupID = @AppGroupID
		END
	END

END
GO
CREATE proc [dbo].[spCollectSPLog]
AS
INSERT INTO spLog (spName, executionTime, runTime)
SELECT o.name, 
       ps.last_execution_time, 
	   ps.last_elapsed_time
FROM   sys.dm_exec_procedure_stats ps 
INNER JOIN 
       sys.objects o 
       ON ps.object_id = o.object_id 
left OUTER JOIN spLog l
	   ON o.name = l.spname
	   AND ps.last_execution_time = l.executionTime
WHERE  DB_NAME(ps.database_id) = 'arm_core' 
		AND l.executionTime IS NULL
		AND o.name <> 'spCollectSPLog'

GO

CREATE PROCEDURE [dbo].[AppgroupAutoMapSelect]
	@AppGroupID as int,
	@mode int = 0,
	@topC int = -1,
	@nominateType nvarchar(10) = ''
AS
BEGIN
-- Mode 0 : use criteria and return matching results
-- Mode 1 : Return only items with a package against criteria ordered by most common then alphabetic
-- Mode 2 : Return most common then alphabetic


	SET NOCOUNT ON;
	
	DECLARE @AppGroupType smallint;
	DECLARE @GrabAll bit;

	SET @AppGroupType = 0

	select @AppGroupType = IsNull(g.AppGroupType,0), @GrabAll = gt.[GrabAll] from [ARM_CORE]..[AppGroup] g LEFT JOIN [ARM_CORE]..[A_AppGroupType] gt on gt.AppGroupType = g.AppGroupType where AppGroupID = @AppGroupID

	DECLARE @SQL nvarchar(MAX);
	DECLARE @WHERE nvarchar(2000);
	DECLARE @ORDER nvarchar(2000);

	DECLARE @TOP nvarchar(20);

	SET @TOP = ''

	if @topC > 0  SET @TOP = ' top ' + cast(@topC as nvarchar(15)) + ' '

	SET @SQL ='
	select distinct ' + @TOP + ' s.[ApplicationID], IsNull((select count([As Is]) from [ARM_CORE]..[TransformAppMap] where [To Be] = s.ApplicationID and [As Is] <> s.ApplicationID),0) as MappedTo
		, IsNull(g.AppGroupName,'''') AS AppGroupName, IsNull(g.CurrentApplication,'''') as CurrentApplication, IsNull(a.PackageID,'''') as PackageID, a.AppGroupID, IsNull(m.[To Be],'''') AS Mapping
		, a.LocalID, a2.LocalID as LocalID2, IsNull(s.[Vendor],'''') as [vendor]
		, IsNull(a.Exclude,0) as ExcludeA, IsNull(a2.Exclude,0) as ExcludeB, IsNull(a.Ready,0) as ReadyA, IsNull(a2.Ready,0) as ReadyB
		, 0 AS Stop, a.DeployType, c.[Count] as InstallCount
		 from [ARM_CORE]..[AppAsIs] s 
		 LEFT JOIN [ARM_CORE]..[s_ApplicationASISInstallCount] c on c.ApplicationID = s.ApplicationID
		 LEFT JOIN [ARM_CORE]..Application a on a.ApplicationID = s.[ApplicationID]
		 LEFT JOIN [ARM_CORE]..AppGroup g on g.AppGroupID = a.AppGroupID 
		 LEFT JOIN [ARM_CORE]..[A_AppGroupType] gt on gt.AppGroupType = g.[AppGroupType] 
		 LEFT JOIN [ARM_CORE]..[TransformAppMap] m on m.[As Is] = s.[ApplicationID] 
		 LEFT JOIN [ARM_CORE]..Application a2 on a2.ApplicationID = m.[To Be] '



    DECLARE @AppCriteriaID int
    DECLARE @AppCriteriaType nvarchar(50)
    DECLARE @AppCriteriaScope nvarchar(500)
    DECLARE @AppCriteriaTerm nvarchar(1000)
    DECLARE @Label nvarchar(1000)
    DECLARE @Criteria nvarchar(1000)
    DECLARE @AltLogicGroup int
    DECLARE @currentGroup int

	DECLARE app_criteria CURSOR FOR 
		SELECT [AppCriteriaID] , [AppCriteriaType],[AppCriteriaTerm] ,[Label], [AltLogicGroup], [AppCriteriaScope]
		FROM [ARM_CORE]..[A_AppCriteria] c LEFT JOIN [ARM_CORE]..[A_Lookup] l on l.[Lookup] = c.AppCriteriaType
		where c.AppGroupID = @AppGroupID and (IsNull(c.[nominate],'') = '' or IsNull(c.[nominate],'') = @nominateType) and l.[Table] = 'A_Appcriteria' and l.[Column] = 'AppCriteriaType' order by [AltLogicGroup], [AppCriteriaID]

	
	OPEN app_criteria  
    FETCH NEXT FROM app_criteria INTO @AppCriteriaID, @AppCriteriaType, @AppCriteriaTerm, @Label, @AltLogicGroup, @AppCriteriaScope

	set @currentGroup = -1
	set @WHERE = ''

    WHILE @@FETCH_STATUS = 0  
    BEGIN 
		set @Criteria = Replace(@AppCriteriaType,'{X}',Replace(@AppCriteriaTerm,'''',''''''))

		if CHARINDEX('like',@AppCriteriaType) > 0 
		BEGIN
			set @Criteria = @Criteria + ' ESCAPE ''\'' '
		END

		if @currentGroup <> @AltLogicGroup 
		BEGIN
			if @currentGroup = -1
				set @WHERE = @WHERE + ' where ( ( 1=1 ' 
			else
				set @WHERE = @WHERE + ' ) or ( 1=1 '

			set @currentGroup = @AltLogicGroup
		END

		if @AppCriteriaScope = 'Vendor' 
			set @WHERE = @WHERE + ' and s.[Vendor] ' + @Criteria + ' '
		else
			set @WHERE = @WHERE + ' and s.[ApplicationID] ' + @Criteria + ' '

		FETCH NEXT FROM app_criteria INTO @AppCriteriaID, @AppCriteriaType, @AppCriteriaTerm, @Label, @AltLogicGroup, @AppCriteriaScope

	END

	if @currentGroup <> -1 set @WHERE = @WHERE + ' ) ) '



	CLOSE app_criteria  
	DEALLOCATE app_criteria 

--	if @AppGroupType >=20 and @AppGroupType < 30 set @WHERE = @WHERE + ' and (IsNull(a.AppGroupID,0) = ' + cast(@AppGroupID as nvarchar(20)) + ' or IsNull(a.AppGroupID,0) = 0 or IsNull(g.[AppGroupType],0) >= 30) '

	if @GrabAll = 0 set @WHERE = @WHERE + ' and (IsNull(a.AppGroupID,0) = ' + cast(@AppGroupID as nvarchar(20)) + ' or IsNull(a.AppGroupID,0) = 0 or IsNull(gt.[AutoMapProcess],0) =0) '


	if @mode = 1
	BEGIN
		SET @SQL ='
			select distinct ' + @TOP + ' s.[ApplicationID], IsNull(a.Exclude,0) as Exclude, c.[Count] as InstallCount
				 from [ARM_CORE]..[AppAsIs] s with(nolock) 
				 LEFT JOIN [ARM_CORE]..[s_ApplicationASISInstallCount] c on c.ApplicationID = s.ApplicationID
				 LEFT JOIN [ARM_CORE]..Application a on a.ApplicationID = s.[ApplicationID] '

		SET @WHERE = @WHERE + ' and IsNull(a.PackageID,'''') <> '''' '
		SET @ORDER = ' order by c.[Count] desc, s.[ApplicationID] desc '

		set @SQL = @SQL + @WHERE + @ORDER
	END
	else if @mode = 2
	BEGIN
		SET @SQL ='
			select distinct ' + @TOP + ' s.[ApplicationID], IsNull(a.Exclude,0) as Exclude, c.[Count] as InstallCount
				 from [ARM_CORE]..[AppAsIs] s with(nolock)
				 LEFT JOIN [ARM_CORE]..[s_ApplicationASISInstallCount] c on c.ApplicationID = s.ApplicationID
				 LEFT JOIN [ARM_CORE]..Application a on a.ApplicationID = s.[ApplicationID] '

		SET @ORDER = ' order by c.[Count] desc, s.[ApplicationID] desc '

		set @SQL = @SQL + @WHERE + @ORDER
	END
	else 
	BEGIN
		SET @ORDER = ' order by s.[ApplicationID] desc'

		set @SQL = @SQL + @WHERE + @ORDER
	END


	if 1 =2 
	BEGIN
		MERGE [ARM_CORE]..[A_Collection] AS Target  
			USING (SELECT 'APPLICATION_CLIPBOARD' as Name,'TESTME' as Auth_User, IsNull((select CollectionClassID from [ARM_CORE]..[A_CollectionClass] where name = '_SYSTEM'),-1) as ClassID) As Source 
			ON (Target.Name = Source.Name and Target.Auth_User = Source.Auth_User) 
			WHEN NOT MATCHED BY TARGET THEN 
			INSERT ([Name], [Auth_User], [Order], [Visible], [Type], collectionClassID) 
			VALUES (Source.[Name], Source.[Auth_User], 0, 0, 'APPLICATION',Source.[ClassID]); 
		
	END


	EXEC(@SQL)
END



GO
CREATE PROCEDURE [dbo].[sp_agentSingle] (@agentID INT,@AUTHUSERID NVARCHAR(255))
AS
BEGIN
       DECLARE @sql NVARCHAR(MAX),
                    @sql2 NVARCHAR(255),
                    @params NVARCHAR(255),
                    @sqlResult INT, 
                    @FinishDate datetime,
                    @mailTo Varchar(255),
                    @Started datetime,
                    @errormsg nvarchar(4000)


       --select * from sys_AGENT


             SELECT @sql = Replace(Trim(Isnull([sql],'')),'{AGENTID}',AgentID), @Started = Isnull([Started],'')
             FROM sys_AGENT 
             WHERE AgentID = @AgentID

             
             IF @sql <> '' 
             BEGIN
                    if @Started = ''
					BEGIN
                           BEGIN TRY
                                 print 'Running ' + cast(@AgentID as nvarchar(20))
                                 update Sys_Agent set [Started] =GETDATE(), [ExecutionTime] = NULL, [Error] = '' where [AgentID] = @AgentID

                                 EXEC  @sqlResult = sp_executesql @sql

                                 set @FinishDate = GETDATE()

                                 update Sys_Agent set LastRun = @FinishDate, [ExecutionTime] = DATEDIFF(SECOND, [Started] , @FinishDate)   where [AgentID] = @AgentID
                                 update Sys_Agent set [Started] = NULL where [AgentID] = @AgentID

                           END TRY
                           BEGIN CATCH
                                 SET @errormsg = ERROR_MESSAGE();

                                 UPDATE Sys_Agent SET [Error] = 'Agent Failed to Run : '+@errormsg+' : ' +cast(GETDATE() as nvarchar(30)) where [AgentID] = @AgentID
                                 update Sys_Agent set [Started] = NULL where [AgentID] = @AgentID

                           END CATCH

						   EXEC [Alert-Post] @UserID = @AUTHUSERID, @Title='Agent Run Now has now run', @Message= 'Run Now for Agent has now run!', @URL= '', @Sticky = 0


                           --EXEC  @sqlResult = sp_executesql @sql
                           --IF @sqlResult > 0 
                           --BEGIN
                                 --send mail 
                                 --SELECT @mailTo = propertyValue FROM SystemGlobalProperties WHERE  PropertyName = 'AutoEmail'
                                 --EXEC msdb.dbo.sp_send_dbmail @profile_name = '',
                                 -- @recipients = @mailTo,
                                 -- @subject = '',
                                 -- @body = '',
                                 -- @body_format = 'HTML'
                    --     END
                    END
                    --       UPDATE Sys_Agent SET [Error] = 'Attempt made to run when Agent is already Running. Attempt made at  '+ cast(getdate() as nvarchar(50)) where [AgentID] = @AgentID


             END 

END
GO

CREATE PROCEDURE [dbo].[X_ApplicationAutoMapList_1]
	@AppGroupID as int
AS
BEGIN
	SET NOCOUNT ON;
	
	DECLARE @SQL nvarchar(MAX);
	DECLARE @SUBSQL nvarchar(MAX);

	SET @SQL ='
	select distinct  s.[ApplicationID], IsNull((select count([As Is]) from [ARM_CORE]..[TransformAppMap] where [To Be] = s.ApplicationID and [As Is] <> s.ApplicationID),0) as MappedTo, IsNull(g.AppGroupName,'''') AS AppGroupName, IsNull(g.CurrentApplication,'''') as CurrentApplication, IsNull(a.PackageID,'''') as PackageID, a.AppGroupID, IsNull(m.[To Be],'''') AS Mapping, a.LocalID, a2.LocalID as LocalID2,
		 IsNull(a.Exclude,0) as ExcludeA, IsNull(a2.Exclude,0) as ExcludeB, IsNull(a.Ready,0) as ReadyA, IsNull(a2.Ready,0) as ReadyB,
		 0 AS Stop, a.DeployType, IsNull(a.[Status],''Unclassified'') as Status, c.[Count] as InstallCount
		 from [ARM_CORE]..[AppAstAsIs] s 
		 LEFT JOIN [ARM_CORE]..[s_ApplicationASISInstallCount] c on c.ApplicationID = s.ApplicationID
		 LEFT JOIN [ARM_CORE]..Asset t on t.AssetID = s.[AssetID] 
		 LEFT JOIN [ARM_CORE]..Application a on a.ApplicationID = s.[ApplicationID]
		 LEFT JOIN [ARM_CORE]..AppGroup g on g.AppGroupID = a.AppGroupID 
		 LEFT JOIN [ARM_CORE]..[TransformAppMap] m on m.[As Is] = s.[ApplicationID] 
		 LEFT JOIN [ARM_CORE]..Application a2 on a2.ApplicationID = m.[To Be] '



    DECLARE @AppCriteriaID int
    DECLARE @AppCriteriaType nvarchar(50)
    DECLARE @AppCriteriaTerm nvarchar(1000)
    DECLARE @Label nvarchar(1000)
    DECLARE @Criteria nvarchar(1000)
    DECLARE @AltLogicGroup int
    DECLARE @currentGroup int

	DECLARE app_criteria CURSOR FOR 
		SELECT [AppCriteriaID] , [AppCriteriaType],[AppCriteriaTerm] ,[Label], [AltLogicGroup]
		FROM [ARM_CORE]..[A_AppCriteria] c LEFT JOIN [ARM_CORE]..[A_Lookup] l on l.[Lookup] = c.AppCriteriaType
		where c.AppGroupID = @AppGroupID and l.[Table] = 'A_Appcriteria' and l.[Column] = 'AppCriteriaType' order by [AltLogicGroup], [AppCriteriaID]

	
	OPEN app_criteria  
    FETCH NEXT FROM app_criteria INTO @AppCriteriaID, @AppCriteriaType, @AppCriteriaTerm, @Label, @AltLogicGroup

	set @currentGroup = -1

    WHILE @@FETCH_STATUS = 0  
    BEGIN 
		set @Criteria = Replace(@AppCriteriaType,'{X}',Replace(@AppCriteriaTerm,'''',''''''))

		if @currentGroup <> @AltLogicGroup 
		BEGIN
			if @currentGroup = -1
				set @SQL = @SQL + ' where ( 1=1 ' 
			else
				set @SQL = @SQL + ' ) or ( 1=1 '

			set @currentGroup = @AltLogicGroup
		END

		set @SQL = @SQL + ' and s.[ApplicationID] ' + @Criteria + ' '

		FETCH NEXT FROM app_criteria INTO @AppCriteriaID, @AppCriteriaType, @AppCriteriaTerm, @Label, @AltLogicGroup
	END

	if @currentGroup <> -1 set @SQL = @SQL + ' )'

	CLOSE app_criteria  
	DEALLOCATE app_criteria 


	EXEC(@SQL)	
END



GO
CREATE PROCEDURE [dbo].[NewQuickLink]
        @Title	nvarchar(500) = 'Page',
		@Page	nvarchar(1000) = '#',
		@Who	nvarchar(1000) = '',
		@method nvarchar(10) = 'get',
		@Threshold int = 100
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
    SET NOCOUNT ON;

	DECLARE @BookmarkID INT;
	DECLARE @When datetime;

	DECLARE @LastPage nvarchar(500);
	DECLARE @LastID INT;

	set @When = getdate()

		insert into [ARM_CORE]..[Bookmarks]([Title], [Page], [AUTH_USER],[When],[Method],[Sys]) values (@Title, @Page, @Who, @When, @method,0)
		Set @BookmarkID = SCOPE_IDENTITY();



		DECLARE @X int
		SELECT @X=COUNT(*) FROM [ARM_CORE]..[Bookmarks] where [AUTH_USER] = @Who 


		if @X > @Threshold 
		BEGIN
			SET @X = @X - @Threshold

			DELETE [ARM_CORE]..[A_RequestCapture]
			WHERE BookmarkID IN (SELECT TOP(@x) BookmarkID 
					FROM [ARM_CORE]..[Bookmarks] where [AUTH_USER] = @Who ORDER BY [When] ASC
				) 
			DELETE [ARM_CORE]..[Bookmarks] 
			WHERE BookmarkID IN (SELECT TOP(@x) BookmarkID 
					FROM [ARM_CORE]..[Bookmarks] where [AUTH_USER] = @Who ORDER BY [When] ASC
				) 
		END

	
		SELECT @BookmarkID AS [NewBookmarkID]

END

GO

CREATE PROCEDURE [dbo].[X_ApplicationStoppedBY_3]
	@SearchTerm as Varchar(2000),
	@XSearchTerm as Varchar(2000)
AS
BEGIN
	SET NOCOUNT ON;
	
	SELECT distinct top 500  s.TransformAppStopID, p.[ApplicationID], s.[ApplicationID] as [Like], s.[NotLike] as [NotLike],s.[Status], s.[Author], s.[Timestamp], s.[Reason] 
	FROM [ARM_CORE].[dbo].[AppAstPreStop] p  
	LEFT JOIN [ARM_CORE].[dbo].[TransformAppStop] s on s.[ApplicationID] = @SearchTerm  and s.[NotLike] = @XSearchTerm 
	WHERE p.[ApplicationID] like @SearchTerm  and NOT p.[ApplicationID] like @XSearchTerm 
	order by p.[ApplicationID]
	


	
END



GO
CREATE PROCEDURE [dbo].[sp_agent]
AS
BEGIN
SET NOCOUNT ON
       DECLARE @sql NVARCHAR(MAX),
                    @sqlCondition NVARCHAR(MAX),
                    @sql2 NVARCHAR(255),
                    @condition nvarchar(255),
                    @params NVARCHAR(255),
                    @sqlResult INT, 
                    @conditionOut bit,
                    @mailTo Varchar(255),
                    @minID INT,
                    @maxID INT,
                    @HaveError smallint,
                    @errormsg VARCHAR(100),
                    @server VARCHAR(100),
                    @AgentID INT, 
                    @agentname VARCHAR(255), 
                    @tableHTMLErrors NVARCHAR(MAX), 
                    @FinishDate datetime,
                    @Started datetime,
                    @totalErrors INT

       SELECT @server = REPLACE([dbo].fnGlobalProperty('domain'), '\','') 


       --select * from sys_AGENT

       DECLARE @Agents TABLE (
             [RunOrder] [int] IDENTITY(1,1) NOT NULL,
        AgentID int
    );

       DECLARE @errors TABLE (
             id INT IDENTITY(1,1) NOT NULL,
             servername VARCHAR(100),
        AgentID INT, 
             agentName VARCHAR(255),
             Errormessage VARCHAR(255)
    );

       INSERT INTO @Agents SELECT AgentID from sys_AGENT WITH(NOLOCK) where active = 1  Order by [Order], AgentID ;

       SELECT @minID = MIN([RunOrder]), @maxID = MAX([RunOrder]) FROM @Agents

--     select * from @Agents

       WHILE @minID <= @maxID
       BEGIN

             SELECT @AgentID = r.AgentID, @sql = Replace(Trim(Isnull(a.[sql],'')),'{AGENTID}',r.AgentID), @sqlCondition = a.[condition], @agentname = a.[Name], @Started = IsNull(a.[Started],'')
             FROM @Agents r LEFT JOIN sys_AGENT a on a.AgentID = r.AgentID
             WHERE r.[RunOrder] = @minID 

             print 'Reviewing ' + cast(@AgentID as nvarchar(20))

             IF @sql <> '' 
             BEGIN
                    if @Started = ''
                    BEGIN
                           SET @conditionOut = 0
                           SET @sqlResult = 0
                           SET @HaveError = -1
                           SET @errormsg = ''

                           update Sys_Agent set [Error] = '' where [AgentID] = @AgentID

                           IF  @sqlCondition <> ''
                           BEGIN
                                 BEGIN TRY
                                        SET @sqlCondition = 'IF (' + @sqlCondition + ') BEGIN SET @conditionOut = 1 end else begin set @conditionOut = 0 END'

                                        SET @params = N'@conditionOut bit OUTPUT'
                                        EXEC sp_executesql @sqlCondition, @params, @conditionOut = @conditionOut OUTPUT
                                 END TRY
                                 BEGIN CATCH
                                        SET @HaveError = 1
                                        update Sys_Agent set [Error] = 'Condition Failure : '+ERROR_MESSAGE()+' : ' + cast(GETDATE() as nvarchar(30))  where [AgentID] = @AgentID
                                 END CATCH

                                 IF @conditionOut = 1 
                                 BEGIN
                                        BEGIN TRY
                                               print 'Running ' + cast(@AgentID as nvarchar(20))
                                               update Sys_Agent set [Started] =GETDATE(), [ExecutionTime] = NULL where [AgentID] = @AgentID

                                               EXEC  @sqlResult = sp_executesql @sql

                                               set @FinishDate = GETDATE()

                                               update Sys_Agent set LastRun = @FinishDate, [ExecutionTime] = DATEDIFF(SECOND, [Started] , @FinishDate)   where [AgentID] = @AgentID
                                               update Sys_Agent set [Started] = NULL where [AgentID] = @AgentID
                                        END TRY
                                        BEGIN CATCH
                                               SET @HaveError = 1

                                               update Sys_Agent set [Error] = 'Agent Failed to Run : '+ERROR_MESSAGE()+' : ' + cast(GETDATE() as nvarchar(30))  where [AgentID] = @AgentID
                                               update Sys_Agent set [Started] = NULL where [AgentID] = @AgentID

                                               INSERT INTO @errors(servername, AgentID, agentName, Errormessage)
                                               VALUES(@server, @AgentID, @agentname, ERROR_MESSAGE())
                                        END CATCH
                                 END
                           END
                           ELSE
                           BEGIN
                                 BEGIN TRY
                                        print 'Running ' + cast(@AgentID as nvarchar(20))
                                        update Sys_Agent set [Started] =GETDATE(), [ExecutionTime] = NULL where [AgentID] = @AgentID
                                        EXEC  @sqlResult = sp_executesql @sql
                                        set @FinishDate = GETDATE()
                                        update Sys_Agent set LastRun = @FinishDate, [ExecutionTime] = DATEDIFF(SECOND, [Started] , @FinishDate)   where [AgentID] = @AgentID
                                        update Sys_Agent set [Started] = NULL where [AgentID] = @AgentID

                                 END TRY
                                 BEGIN CATCH
                                        SET @HaveError = 1
                                        SET @errormsg = ERROR_MESSAGE();

                                        UPDATE Sys_Agent SET [Error] = 'Agent Failed to Run : '+@errormsg+' : ' +cast(GETDATE() as nvarchar(30)) where [AgentID] = @AgentID
                                        update Sys_Agent set [Started] = NULL where [AgentID] = @AgentID

                                        INSERT INTO @errors(servername, AgentID, agentName, Errormessage)
                                        VALUES(@server, @AgentID, @agentname, ERROR_MESSAGE())
                                 END CATCH
                           END

                           --IF  @HaveError = 0 
                           --BEGIN
                           --     UPDATE Sys_Agent SET LastRun =GETDATE() WHERE [AgentID] = @AgentID
                           --END
                    END
					ELSE
						UPDATE Sys_Agent SET [Error] = 'Attempt made to run when Agent is already Running. Attempt made at  '+ cast(getdate() as nvarchar(50)) where [AgentID] = @AgentID
             END

             SELECT @minID = MIN([RunOrder]) FROM @Agents where [RunOrder] > @minID
       
       END 
       --send errors
       IF (SELECT COUNT(*) FROM @errors) > 0
       BEGIN
             SET @tableHTMLErrors = '<style>table, th, td {  border: 1px solid black;border-collapse: collapse}
                                                     </style><table border = 1><tr><th>Server Name</th><th>Agent ID</th><th>Agent Name</th><th>Error Message</th></tr>'
             SELECT @minID = MIN(id), @maxID = MAX(id) FROM @errors
             WHILE @minID <= @maxID
             BEGIN
                    SELECT  @tableHTMLErrors = CONCAT(@tableHTMLErrors,'<TH>'
                                                                                , servername, '</th><th>' 
                                                                                , AgentID, '</th><th>'
                                                                                , agentName, '</th><th>'
                                                                                , Errormessage, '</th></tr></table>')
                    FROM @errors
                    WHERE id  = @minID 

                    SELECT @minID = MIN(id)  FROM @errors WHERE id > @minID
             END
             INSERT INTO A_MailerLog(MailTo, MailFrom, Important, [subject], body, CC)
                    VALUES(
                           [dbo].[fnGlobalProperty]('WhenThingsGoWrong')
                           ,[dbo].[fnGlobalProperty]('WhenThingsGoWrong')
                           ,1
                           ,@server + ': Agent Failed'
                           ,@tableHTMLErrors , 
                           'paul.marshall@jra-consultancy.co.uk'
                           )
             --print @tableHTMLErrors
       END
END

GO
 CREATE PROCEDURE dbo.sp_ADUsers @User nvarchar(255), @pass nvarchar(255), @LDAP varchar(255)
 AS
BEGIN
	DECLARE	@openQuery nvarchar(max)

	IF (select count(1) from sys.servers where name = 'ADSI') = 0 
	BEGIN
		--set up linked server for AD
		EXEC master.dbo.sp_addlinkedserver @server = N'ADSI', @srvproduct=N'Active Directory Service Interfaces', @provider=N'ADSDSOObject', @datasrc=N'adsdatasource'

		EXEC master.dbo.sp_addlinkedsrvlogin @rmtsrvname=N'ADSI',@useself=N'False',@locallogin=NULL,@rmtuser=  @User,@rmtpassword= @pass
 
		EXEC master.dbo.sp_serveroption @server=N'ADSI', @optname=N'collation compatible',  @optvalue=N'false'
 
		EXEC master.dbo.sp_serveroption @server=N'ADSI', @optname=N'data access', @optvalue=N'true'
 
		EXEC master.dbo.sp_serveroption @server=N'ADSI', @optname=N'dist', @optvalue=N'false'
 
		EXEC master.dbo.sp_serveroption @server=N'ADSI', @optname=N'pub', @optvalue=N'false'
 
		EXEC master.dbo.sp_serveroption @server=N'ADSI', @optname=N'rpc', @optvalue=N'false'
 
		EXEC master.dbo.sp_serveroption @server=N'ADSI', @optname=N'rpc out', @optvalue=N'false'
 
		EXEC master.dbo.sp_serveroption @server=N'ADSI', @optname=N'sub', @optvalue=N'false'
 
		EXEC master.dbo.sp_serveroption @server=N'ADSI', @optname=N'connect timeout', @optvalue=N'0'
 
		EXEC master.dbo.sp_serveroption @server=N'ADSI', @optname=N'collation name', @optvalue=null
 
		EXEC master.dbo.sp_serveroption @server=N'ADSI', @optname=N'lazy schema validation',  @optvalue=N'false'
 
		EXEC master.dbo.sp_serveroption @server=N'ADSI', @optname=N'query timeout', @optvalue=N'0'
 
		EXEC master.dbo.sp_serveroption @server=N'ADSI', @optname=N'use remote collation',  @optvalue=N'true'
 
		EXEC master.dbo.sp_serveroption @server=N'ADSI', @optname=N'remote proc transaction promotion', @optvalue=N'true'

	END


	SET @openQuery = 'SELECT * FROM OpenQuery ( 
					  ADSI,  
					  ''SELECT company, title, displayName, telephoneNumber, sAMAccountName, 
						mail, mobile, facsimileTelephoneNumber, department, physicalDeliveryOfficeName, givenname
					  FROM  ''''' + @LDAP + ''''' 
					  WHERE objectClass =  ''''User'''' 
					  '''') AS tblADSI
					  ORDER BY displayname'


	EXEC sp_executesql  @openquery;

END
GO


CREATE PROCEDURE [dbo].[sp_sendEmails] 
AS
BEGIN
	DECLARE @body VARCHAR(MAX),
			@subject VARCHAR(100), 
			@date DATETIME, 
			@mailTo VARCHAR(255), 
			@mailFrom VARCHAR(255),
			@attachment VARCHAR(MAX),
			@cc VARCHAR(255), 
			@bcc VARCHAR(255),
			@ReadReceipt BIT, 
			@Important VARCHAR(10),
			@sent_mailitemid INT,
			@profile_name VARCHAR(50), 
			@mailID INT,
			@maxID INT




		--	select * from A_MailerLog
	
	SET NOCOUNT ON
	
	BEGIN TRANSACTION
		--check for sent emails 
		UPDATE A_MailerLog
		SET A_MailerLog.sent_date = emails.sent_date ,
			A_MailerLog.attempts = A_MailerLog.attempts +1
		FROM A_MailerLog
		INNER JOIN msdb.dbo.sysmail_allitems emails
		ON A_MailerLog.mailer_sent_id = emails.mailitem_id
		WHERE emails.sent_status = 'sent'
		
		--check for failed emails 
		UPDATE A_MailerLog
		SET a_mailerlog.fail_description = mlog.description,
			A_MailerLog.attempts = A_MailerLog.attempts +1
		FROM A_MailerLog
		INNER JOIN msdb.dbo.sysmail_allitems failed
		ON A_MailerLog.mailer_sent_id = failed.mailitem_id
		INNER JOIN msdb.dbo.sysmail_event_log Mlog
		ON failed.mailitem_id = Mlog.mailitem_id
		WHERE failed.sent_status = 'failed'

	COMMIT

	SELECT @mailID = MIN(mailID),
			@maxID = MAX(mailID)
	FROM A_MailerLog
	WHERE A_MailerLog.sent_date  IS NULL
		--	AND A_MailerLog.fail_description IS NULL
			AND attempts < 3

	SELECT @profile_name = [dbo].fnGlobalProperty('MailProfileName')

	WHILE @mailid <= @maxid 
	BEGIN
	
		SELECT @mailTo = mailto,
				@mailFrom = mailfrom,
				@CC = cc, 
				@bcc = bcc, 
				@ReadReceipt = ReadReceipt,
				@Important = IIF(Important = 1, 'High', 'Normal'),
				@subject = subject,
				@body = body,
				@attachment = attachment

		FROM A_MailerLog
		WHERE mailID = @mailID

	
		EXEC msdb.dbo.sp_send_dbmail @profile_name = @profile_name,
				 @recipients = @mailTo,
			--	 @from_address = @mailFrom,
				 @copy_recipients = @CC, 
				 @blind_copy_recipients = @bcc,
				 @subject = @Subject,
				 @body = @body,
				 @body_format = 'HTML',
				 @importance = @Important,
				 @mailitem_id = @sent_mailitemid OUTPUT,
				 @file_attachments = @attachment;
				 

		--
		UPDATE A_MailerLog 
		SET mailer_sent_id = @sent_mailitemid
		WHERE mailID = @mailID

	
		SELECT @mailID = MIN(mailID)
		FROM A_MailerLog
		WHERE A_MailerLog.sent_date  IS NULL
		--	AND fail_description IS NULL
			AND attempts < 3
			AND mailID > @mailID

	END
END

GO
CREATE procedure [dbo].[sp_newMail](
							@itemID VARCHAR(100),
							@type VARCHAR(100), 
							@templateID INT,
							@payload NVARCHAR(MAX) = NULL,
							@attachment VARCHAR(MAX) = NULL,
							@extraCols VARCHAR(MAX) = NULL
							)
 AS 
BEGIN

	DECLARE 
			@subject VARCHAR(MAX),
			@messagetext VARCHAR(MAX),
			@messagetextOut VARCHAR(MAX),
			@mailTo VARCHAR(255), 
			@mailFrom VARCHAR(255),
			@CC varchar(255), 
			@BCC VARCHAR(255), 
			@readReceipt BIT, 
			@Important BIT,
			@maxID INT, 
			@tableID INT,
			@colName VARCHAR(100), 
			@SQL NVARCHAR(MAX),
			@params NVARCHAR(255),
			@payloadOutput NVARCHAR(MAX),
			@payloadAttachmentPath  NVARCHAR(MAX),
			@payloadRecordCount INT,
			@signaturePath VARCHAR(100), 
			@signatureMarker  VARCHAR(100),
			@signatureReplacementMarker  VARCHAR(100),
			@rootFolder VARCHAR(100),
			@id INT


	
	SET NOCOUNT ON
	--SET @itemID = 'CGDH24292'
	--SET @type = 'asset'
	--SET @templateID = 10
	--SET @payload = 'select ApplicationID, AppGroupID, Name,Version,LifeCycle from [Application] where AppGroupid = 7640'

	IF EXISTS(SELECT [name] FROM tempdb.sys.tables WHERE [name] like '##tempdata') 
	BEGIN
	   DROP TABLE ##tempdata ;
	END;

	--get data for use in template and insert into temp table
	SELECT @SQL = sqlstatement FROM A_templateSQLStatement  WHERE templateType  = @type
	SET @params = N'@itemID varchar(MAX)'
	EXEC sp_executesql @sql, @params, @itemID = @itemID
	--select * from ##tempdata
	
	WHILE len(@extraCols) > 0
	BEGIN
		SET @SQL = 'UPDATE ##tempdata SET [' + left(@extraCols, charindex('|', @extraCols+',')-1) +']'
		SET @extraCols = stuff(@extraCols, 1, charindex('|', @extraCols+'|'), '')
		SET @SQL = @SQL + ' = ''' + left(@extraCols, charindex('|', @extraCols+'|')-1) + ''''
		
		EXEC sp_executesql @sql
		SET @extraCols = stuff(@extraCols, 1, charindex('|', @extraCols+'|'), '')
		
	END

	--Find number of columns in temp table
	SELECT	@ID = MIN(colid),
			@maxID = MAX(colid),
			@tableID  = max(a.id)
	From tempdb..syscolumns a
	inner join tempdb..sysobjects b
	on a.id = b.id 
	where b.id = object_id('tempdb..##tempData')

	
	--Get message details 
	SELECT @messagetext = Template , @subject = [subject], @mailFrom = SendFrom ,@CC = CC,  @BCC = BCC, @readReceipt = ReadReceipt, @Important = Important
	FROM NotificationTemplate WHERE templateid = @templateID


	--Snipets
	IF CHARINDEX('{SNIP_',@messagetext) > 0 
	BEGIN
		EXEC dbo.sp_MailerSnippets @messagetext, @messagetextOut OUTPUT
		SET @messagetext = @messagetextOut
	END	


	--payloads
	IF CHARINDEX('{PAYLOAD}',@messagetext) > 0 AND @payload <> ''
	BEGIN
		EXEC dbo.sp_payload @payload,0, @payloadOutput OUTPUT,@payloadRecordCount OUTPUT, @payloadAttachmentPath OUTPUT
		SET @messagetext = REPLACE(@messagetext, '{PAYLOAD}',@payloadOutput)
	END	

	--signature image
	IF CHARINDEX('{IMAGE',@messagetext) > 0 
	BEGIN	
		EXEC sp_mailerSignatures @messagetext, @messagetextOut OUTPUT
		SET @messagetext = @messagetextOut
		--SET @attachment = CONCAT(@attachment, @signaturePath)
	END	


	
	--replacements
	WHILE @ID <= @maxid 
	BEGIN

			SELECT @colName = [name] FROM  tempdb..syscolumns WHERE colID = @id and id = @tableID
		
			SET @sql = N'SELECT @messagetext = REPLACE(@messagetext, ''{' + @colName + '}'',COALESCE([' + @colName + '],'''')) FROM ##tempData'
			SET @params = N'@messagetext nvarchar(MAX) OUTPUT'
			exec sp_executesql @sql, @params, @messagetext = @messagetext OUTPUT

			SET @sql = N'SELECT @subject = REPLACE(@subject, ''{' + @colName + '}'',COALESCE([' + @colName + '],'''')) FROM ##tempData'
			SET @params = N'@subject nvarchar(MAX) OUTPUT'
			exec sp_executesql @sql, @params, @subject = @subject OUTPUT

			--Get to email address
			IF @colName = 'SendToEmail'
			BEGIN
				SET @sql = N'SELECT @mailTo = [' + @colName + ']  FROM ##tempData'
				SET @params = N'@mailTo nvarchar(255) OUTPUT'
				exec sp_executesql @sql, @params, @mailTo = @mailTo OUTPUT
			END

			SELECT @id = MIN(colID)
			From tempdb..syscolumns a
			WHERE id = @tableID
				AND colid > @id 
		--END
	end 

	INSERT INTO A_MailerLog (MailTo, MailFrom,cc,  bcc, ReadReceipt, Important, subject, body, attachment)
	VALUES(	@mailTo, @mailFrom,@CC,  @BCC, @readReceipt, @Important, @subject, @messagetext, @attachment)

	SELECT @rootFolder  = PropertyValue FROM SystemGlobalProperties WHERE Propertyname = 'root'
	--output the message with the correct sig path
	SELECT @subject as [subject], @messagetext as [message] --REPLACE(@messagetext,@signatureReplacementMarker, CONCAT('<img src="',@signaturePath, '" />'))  as [message] 


END


GO

CREATE PROCEDURE X_TableView_4
AS
BEGIN
	select BArea from [ARM_CORE]..[BArea] Order By Internal desc, BArea
END

GO

CREATE PROCEDURE X_TableView_3(@AssetList nvarchar(255), @BAreaSelect nvarchar(255))
AS
BEGIN
	DECLARE @SQL nvarchar(max)
	SET @SQL = '
		update [ARM_CORE]..[Asset] set BArea = replace('+@BAreaSelect+',"''","''''") where AssetID  in ('+@AssetList+') 
	'
	EXEC (@SQL)
END

GO

CREATE PROCEDURE X_TableView_2(@AssetList nvarchar(255))
AS
BEGIN
	DECLARE @SQL nvarchar(max)
	SET @SQL = '
		update [ARM_CORE]..[Asset] set target = 0 where AssetID  in ('+@AssetList+')
	'
	EXEC (@SQL)
END

GO
CREATE PROCEDURE X_TableView_1(@AssetList nvarchar(255))
AS
BEGIN
	DECLARE @SQL nvarchar(max)
	SET @SQL = '
		update [ARM_CORE]..[Asset] set target = 1 where AssetID  in ('+@AssetList+')
	'
	EXEC (@SQL)
END

GO

	CREATE PROCEDURE X_Edit_5(@DATABASE_REF nvarchar(255),@TABLEREF nvarchar(255),@TheIdentity NVARCHAR(50), @RecordID nvarchar(50))
	AS
	BEGIN
	DECLARE @sql nvarchar(max);
	
	SET @sql =' SELECT top 1 *, '''' as [_DUMMY] FROM ['+@DATABASE_REF+']..['+@TABLEREF+'] z where ['+@TheIdentity+'] = '''+ @RecordID +''''

	--print(@sql)
	EXEC (@sql)
	END

GO

	CREATE PROCEDURE X_Edit_4(@DATABASE_REF nvarchar(255),@TABLEREF nvarchar(255),@Identity NVARCHAR(255), @RecordID NVARCHAR(50))
	AS
	BEGIN
	DECLARE @sql nvarchar(max);
	
	SET @sql =' SELECT top 1 * FROM ['+@DATABASE_REF+']..['+@TABLEREF+'] z where ['+@Identity+'] = '''+@RecordID+''''
	--print(@sql)
	EXEC (@sql)
	END

GO

CREATE PROCEDURE X_Edit_3(@DATABASE_REF nvarchar(255),@TABLEREF nvarchar(255))
	AS
	BEGIN

	declare @sql nvarchar(max);

		set @sql ='USE ['+@DATABASE_REF+ '] 
		select top 1 s.name from ['+@DATABASE_REF+']..[syscolumns] s where s.id = object_id(''['+@DATABASE_REF+']..['+@TABLEREF+']'') and columnproperty(s.id, s.[name] ,''IsIdentity'') = 1'
		
		--print(@sql)
		EXEC (@sql)
		
	END

GO

	CREATE PROCEDURE X_Edit_2(@DATABASE_REF nvarchar(MAX),@TABLEREF nvarchar(MAX), @Default_Width nvarchar(50) = '60',@Default_Height nvarchar(50) = '1')
	AS
	BEGIN

	declare @sql nvarchar(max);
		
		set @sql ='USE ['+@DATABASE_REF+ '] 
		SELECT IsNull(e.[Label],s.[name]) AS [FieldLabel], s.[name] AS [Column], IsNull(l.[Lookup],''no_lookup_values'') as [Lookup], l.[Label] as OptionText, l.[Order], t.name as [Type],
		columnproperty(s.id, s.[name] ,''IsIdentity'') as IsIdentity,	s.[colorder], IsNull(e.[Order],s.[colorder]) as AdjustedOrder, e.[HelpText], 
		IsNull(e.[Property],0) as [Property], IsNull(e.[Exclude],0) as [Exclude], IsNull(e.[InitialValue],'''') as InitialValue,  
		IsNull(e.[Width],'+@Default_Width+') as Width, IsNull(e.[Height],'+@Default_Height+') as Height, s.prec as MaxLength 
		FROM [syscolumns] s
		LEFT JOIN sys.[Tables] x on x.object_id =s.id
		LEFT JOIN [ARM_CORE]..[A_Lookup] l on l.[Column] = s.[name] and l.[Table] = x.name
		LEFT JOIN [ARM_CORE]..[A_TableEdit] e on e.[Column] = s.[name] and e.[Table] = x.name
		LEFT JOIN [ARM_CORE].sys.[types] t on t.system_type_id = s.xtype
		WHERE s.id = object_id(''['+@DATABASE_REF+']..['+@TABLEREF+']'') and IsNull(e.[Exclude],0) = 0 and IsNull(t.[name],'''') <> ''sysname'' 
		Order by IsNull(e.[Order],s.[colorder]), s.[colorder], s.[name], l.[Order], l.[Label] '

		--print(@sql)
		EXEC (@sql)
		
	END

GO
CREATE PROCEDURE X_Edit_1(@DATABASE_REF nvarchar(255), @TABLEREF nvarchar(255))
	AS
	BEGIN
		select IsNull([CommentOn],0) as CommentON from [ARM_CORE]..[A_TablePermit] where [Schema] = @DATABASE_REF  and [Table] = @TABLEREF 
	END

GO
CREATE PROCEDURE X_default_1(@ButtonID INT)
AS
BEGIN
	select [UUID],  IsNull(Label,'Press Me') as [xLabel], IsNull(Colour,'3A68A1') as [xColour], IsNull(Style,'') as [xStyle], IsNull(Params,'') as [xParams], IsNull(SQLAction,'') as [xSQLAction] , IsNull(redirect,'') as [xRedirect], IsNull(HTMLmessage,'') as [xMessage], '1' as dummy 
	from [ARM_CORE]..[NotificationTemplateButton] 
	where [ButtonID] = @ButtonID
END

GO
CREATE PROCEDURE X_decode_1(@ButtonID int)
AS
BEGIN
	select [UUID],  IsNull(Label,'Press Me') as [xLabel], IsNull(Colour,'3A68A1') as [xColour], IsNull(Style,'') as [xStyle], IsNull(Params,'') as [xParams], IsNull(SQLAction,'') as [xSQLAction] , IsNull(redirect,'') as [xRedirect], IsNull(HTMLmessage,'') as [xMessage], '1' as dummy from [ARM_CORE]..[NotificationTemplateButton] where [ButtonID] = @ButtonID
END

GO
CREATE PROCEDURE X_AssetId_2(@CID INT)
AS
BEGIN
	select distinct c.ItemID  from [ARM_CORE]..[A_CollectionItem] c 
	where c.CollectionID = @CID order by ItemID
END

GO
CREATE PROCEDURE X_AssetId_1(@WID INT)
AS
BEGIN
	select distinct i.ItemID from [ARM_CORE]..[Workstream] w 
	LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionClassID = w.KeyStatusID
	LEFT JOIN [ARM_CORE]..[A_CollectionItem] i on i.CollectionID =c.CollectionID
	where w.workstreamID = @WID order by ItemID
END

GO

CREATE PROCEDURE [dbo].[X_ApplicationMappedFrom_3](@SearchTerm nvarchar(255))
AS
BEGIN


		SELECT distinct s.TransformAppStopID, p.[ApplicationID], s.[ApplicationID] as [Pattern], s.[Status], s.[Author], s.[Timestamp], s.[Reason]
	    FROM [ARM_CORE].[dbo].[AppAstPreStop] p 
		LEFT JOIN [ARM_CORE].[dbo].[TransformAppStop] s on p.[ApplicationID] like s.ApplicationID
		where p.ApplicationID like  Replace( @SearchTerm,'''','''''')
		and NOT s.TransformAppStopID IS NULL 

END

GO


CREATE PROCEDURE [dbo].[X_ApplicationStoppedBY_2]
AS
BEGIN
	SELECT [Table],[Column],IsNull([Label],[Lookup]) as [Label], [Lookup] from [ARM_CORE]..[A_Lookup]
	where [Table] = 'TransformAppStop' and [Column] = 'Reason' order by [Column],[Order],[Lookup] 
END

GO

CREATE PROCEDURE [dbo].[X_ApplicationStoppedBY_1](@StopID INT)
AS
BEGIN
	select s.ApplicationID, s.[NotLike] from [ARM_CORE].[dbo].[TransformAppStop] s where TransformAppStopID = @StopID
END

GO

CREATE PROCEDURE X_ApplicationList_5
AS
BEGIN
	select distinct cc.CollectionClassID as [ID], cc.[Name] as ClassName from [ARM_CORE]..[A_CollectionClass] cc LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionClassID = cc.CollectionClassID where (c.[Type] = 'Application' or c.[Type] = 'xAppGroup') and cc.[Distinct] = 1 order by cc.[Name] 
END

GO

CREATE PROCEDURE X_ApplicationList_4
AS
BEGIN
	select [Lookup], Label from [ARM_CORE]..[A_Lookup] where [Table] = 'Internal' and [Column] = 'OsFilter' Order By [Order] 
END

GO

CREATE PROCEDURE X_ApplicationList_3
AS
BEGIN
	SELECT [Lookup],[Label] FROM [ARM_CORE].[dbo].[A_LookUp] where [Table] = 'Application' and [Column]='Deploytype' 
END

GO

CREATE PROCEDURE X_ApplicationList_2
AS
BEGIN
	select BArea from [ARM_CORE]..[BArea] Order By Internal, BArea 
END

GO
CREATE PROCEDURE X_ApplicationList_1(@Filter nvarchar(255))
AS
BEGIN

	DECLARE @SQL NVARCHAR(MAX)
	SET @SQL = '
		select distinct c.CollectionID, cc.[Name] as ClassName, c.[Name] 
		from [ARM_CORE]..[A_CollectionClass] cc 
		LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionClassID = cc.CollectionClassID 
		where c.[CollectionID] = '+@Filter+'
	'

	EXEC (@SQL)
END

GO

CREATE PROCEDURE X_Application_13
AS
BEGIN
	SELECT [AppGroupId], [AppGroupName] from [ARM_CORE]..[AppGroup] order by AppGroupName
END

GO
CREATE PROCEDURE X_Application_12(@AppGroupKey INT)
AS
BEGIN
	select s.AppGroupName, s.Vendor, s.vendorURL, s.Notes, s.Description AS MyDesc from [ARM_CORE]..[AppGroup] s  where s.[AppGroupID] = @AppGroupKey
END



GO

CREATE PROCEDURE X_Application_11
AS
BEGIN
	SELECT [Table],[Column],IsNull([Label],[Lookup]) as [Label], [Lookup], isNull([Description],'') as Description from [ARM_CORE]..[A_Lookup]
	where [Table] = 'Application' and [Column] = 'Ready' order by [Column],[Order],[Lookup]
END

GO

CREATE PROCEDURE X_Application_10(@AppKey nvarchar(255))
AS
BEGIN
select a.CollectionID as FlagID, a.Name, a.[Order] as FlagOrder, IsNull(t.CollectionID,0) as FlagSet 
from [ARM_CORE]..[A_Collection] a
LEFT join [ARM_CORE]..[A_CollectionItem] t on t.CollectionID = a.CollectionID and t.ItemID = @AppKey
order by a.[Order], a.Name 
END

GO

CREATE PROCEDURE X_Application_9
AS
BEGIN
	select l.[Column], l.Label, a.Label as [Value], a.[Order] from [ARM_CORE]..[A_Lookup] l
		LEFT JOIN [ARM_CORE]..[A_Lookup] a on a.[Column] = l.[Column] and a.[Table] = 'ApptestResults'
		where l.[Table] = 'AppTestLabel' 
		group by l.[Column],l.[Label],a.[Order],a.[Label]
END

GO
CREATE PROCEDURE X_Application_8
AS
BEGIN
	SELECT [Table],[Column],IsNull([Label],[Lookup]) as [Label], [Lookup]  from [ARM_CORE]..[A_Lookup]
 where [Table] = 'Application' and [Column] = 'Status' order by [Column],[Order],[Lookup]
END

GO

CREATE PROCEDURE X_Application_7
AS
BEGIN
	SELECT [Table],[Column],IsNull([Label],[Lookup]) as [Label], [Lookup] from [ARM_CORE]..[A_Lookup]
	Where [Table] = 'Application' and [Column] = 'DeployType' order by [Column],[Order],[Lookup]
END

GO
CREATE PROCEDURE X_Application_6(@AppId nvarchar(255))
AS
BEGIN
	select a.LocalID, a.DeployType, a.ready, a.PackageID, IsNull(h.ApplicationID,'') as onHitList,
			IsNull(t.Test1,'') as Test1 , IsNull(t.Test2,'') as Test2 , IsNull(t.Test3,'') as Test3 , IsNull(t.Test4,'') as Test4, IsNull(t.Test5,'') as Test5, IsNull(t.[Readiness],'') as Readiness 
			from [ARM_CORE]..[Application] a
			LEFT JOIN [ARM_CORE]..[AppNotes] r on r.ApplicationID = a.ApplicationID 
			LEFT JOIN [ARM_CORE]..[AppTestResults] t on t.ApplicationID = a.ApplicationID
			LEFT JOIN [ARM_CORE]..[AppHitList] h on h.ApplicationID = a.ApplicationID
			where a.[ApplicationID] = @AppID
END



GO
CREATE PROCEDURE X_Application_5(@AppId nvarchar(255))
AS
BEGIN
	select a.LocalID, a.DeployType, a.ready, a.PackageID,
			IsNull(t.Test1,'') as Test1 , IsNull(t.Test2,'') as Test2 , IsNull(t.Test3,'') as Test3 , IsNull(t.Test4,'') as Test4, IsNull(t.Test5,'') as Test5, IsNull(t.[Readiness],'') as Readiness
			from [ARM_CORE]..[Application] a 
			LEFT JOIN [ARM_CORE]..[AppNotes] r on r.ApplicationID = a.ApplicationID 
			LEFT JOIN [ARM_CORE]..[AppTestResults] t on t.ApplicationID = a.ApplicationID
			where a.[ApplicationID] = @AppID
END



GO
CREATE PROCEDURE X_Application_4(@AppId nvarchar(255))
AS
BEGIN
select distinct a.ApplicationID as [KEY], IsNull(a.DeployType,'-') as DType, a.ready, IsNull(lu.[Label],'*') AS [RAG]
		from [ARM_CORE]..[Application] a LEFT JOIN [ARM_CORE]..[A_Lookup] lu ON lu.[Table] = 'Internal'
		where a.ApplicationID = @AppID
END



GO


CREATE PROCEDURE X_Application_3(@AppId nvarchar(255))
AS
BEGIN
	DECLARE @SQL nvarchar(max)
	select  a.AppGroupID, g.AppGroupName 
	from [ARM_CORE]..[Application] a 
	LEFT JOIN [ARM_CORE]..[AppGroup] g on g.AppGroupID = a.AppGroupID 
	where a.ApplicationID = @AppID
END

GO


CREATE PROCEDURE X_Application_2(@NewAppGroupID int, @AppId nvarchar(255))
AS
BEGIN
	DECLARE @SQL nvarchar(max)
	UPDATE [ARM_CORE]..[Application] set AppGroupID =@NewAppGroupID where ApplicationID =@AppId
END

GO
CREATE PROCEDURE X_Application_1(@NewGroupName Nvarchar(255))
AS
BEGIN
	DECLARE @SQL nvarchar(max)
	set @SQL = '
		MERGE [ARM_CORE]..[AppGroup] as Target using (select replace('+@NewGroupName+',"''","''''")  AS AppGroupName) as Source
			ON (target.AppGroupName  = source.AppGroupName)
			WHEN NOT MATCHED BY TARGET THEN " & _
			insert (AppGroupName) Values (Source.AppGroupName);
	'

	EXEC(@SQL)
END

GO
CREATE PROCEDURE X_ApplicationClassify_1
AS
BEGIN
	SELECT [Table],[Column],IsNull([Label],[Lookup]) as [Label], [Lookup], isNull([Description],'') as Description from [ARM_CORE]..[A_Lookup] where [Table] = 'Application' order by [Column],[Order],[Lookup]
END

GO


CREATE PROCEDURE X_ApplicationCollections_2(@AssetId NVARCHAR(255))
AS
BEGIN
	select a.CollectionID as FlagID, a.[Name], a.[Order], IsNull(t.CollectionID,0) as FlagSet, IsNull(c.[Name],'Collections') as CollectionClassName, IsNull(a.[Colour],'check-default') as Colour, convert(nvarchar(3000), isNull(c.[Description],'')) as Description
	from [ARM_CORE]..[A_Collection] a LEFT join [ARM_CORE]..[A_CollectionItem] t on t.collectionID = a.collectionID and t.itemID = @AssetID
	LEFT JOIN [ARM_CORE]..[A_CollectionClass] c on c.CollectionClassID = a.CollectionClassID
	where IsNull(a.[Type],'Asset') = 'Application' order by IsNull(c.[Name],'Collections'), a.[Order], a.[Name]
END

GO
CREATE PROCEDURE X_ApplicationCollections_1(@AppKey NVARCHAR(255))
AS
BEGIN
	select  a.AppGroupID, g.AppGroupName from [ARM_CORE]..[Application] a 
    LEFT JOIN [ARM_CORE]..[AppGroup] g on g.AppGroupID = a.AppGroupID 
	where a.ApplicationID = @AppKey
END

GO

CREATE PROCEDURE X_ApplicationGrpMembers_4(@AppGroupKey INT)
	AS
	BEGIN
		
		select p.ApplicationID AS [KEY], c.[Count] AS IC, IsNull(p.[LocalID],'') AS LocalID, g.[CurrentApplication]
		, IsNull(m.[To Be],'') AS Mapping, IsNull(p2.[LocalID],'') AS LocalID2
		from [ARM_CORE]..[AppGroup] g   
		LEFT JOIN [ARM_CORE]..[Application] p on g.AppGroupID = p.AppGroupID
		LEFT JOIN [ARM_CORE]..[TransformAppMap] m on m.[As Is] = p.[ApplicationID]
		LEFT JOIN [ARM_CORE]..[Application] p2 on p2.ApplicationID = m.[To Be]
		LEFT JOIN [ARM_CORE]..[s_ApplicationPreInstallCount] c on c.ApplicationID = p.ApplicationID
		where g.AppGroupID = @AppGroupKey
		Order by c.[Count] desc 

	END

GO

--EXEC X_ApplicationGrpMembers_2 'A_Action',1

CREATE PROCEDURE X_ApplicationGrpMembers_3(@AppGroupKey INT)
	AS
	BEGIN
		
		select s.ApplicationID AS [KEY], count(s.AssetID) AS IC, IsNull(p.[LocalID],'') AS LocalID, g.[CurrentApplication] , IsNull(m.[To Be],'') AS Mapping, IsNull(p2.[LocalID],'') AS LocalID2
		from [ARM_CORE]..AppAstAsIs s 
		LEFT JOIN [ARM_CORE]..[Asset] a on a.AssetID = s.AssetID
		LEFT JOIN [ARM_CORE]..[Application] p on p.ApplicationID = s.ApplicationID
		LEFT JOIN [ARM_CORE]..[AppGroup] g on g.AppGroupID = p.AppGroupID
		LEFT JOIN [ARM_CORE]..[TransformAppMap] m on m.[As Is] = s.[ApplicationID]
		LEFT JOIN [ARM_CORE]..[Application] p2 on p2.ApplicationID = m.[To Be]
		where g.AppGroupID = @AppGroupKey 
		Group By s.ApplicationID, IsNull(p.[LocalID],''), g.[CurrentApplication] , m.[To Be], p2.[LocalID]
		Order by s.ApplicationID	

	END

GO

CREATE PROCEDURE X_ApplicationGrpMembers_2(@scope nvarchar(255),@AppGroupKey INT)
	AS
	BEGIN
		DECLARE @SQL nvarchar(max);
		SET @SQL = '
		select s.ApplicationID AS [KEY], count(s.AssetID) AS IC, IsNull(p.[LocalID],'''') AS LocalID, g.[CurrentApplication] 
		from [ARM_CORE]..'+@scope+' s
		LEFT JOIN [ARM_CORE]..[Asset] a on a.AssetID = s.AssetID 
		LEFT JOIN [ARM_CORE]..[Application] p on p.ApplicationID = s.ApplicationID 
		LEFT JOIN [ARM_CORE]..[AppGroup] g on g.AppGroupID = p.AppGroupID  
		LEFT JOIN [ARM_CORE]..[BArea] b on b.BArea = IsNull(a.BArea,'''') 
		where g.AppGroupID =  '+CAST(@AppGroupKey AS nvarchar(50))+'
		Group By s.ApplicationID, IsNull(p.[LocalID],''''), g.[CurrentApplication] 
		'
		EXEC (@SQL)
	END

GO
CREATE PROCEDURE X_ApplicationGrpMembers_1(@AppGroupKey INT)
	AS
	BEGIN
		
		select top 1 g.AppGroupName from ARM_CORE..[AppGroup] g where g.AppGroupID = @AppGroupKey

	END

GO
CREATE PROCEDURE [dbo].[X_ApplicationGroupTab_1](@ID NVARCHAR(500), @ISAPP bit = 0)
	AS
	BEGIN

		if @ISAPP = 0
		BEGIN
			select g.AppGroupID, g.AppGroupName, IsNull(g.AppGroupType,0) as [AppGroupType], IsNull(gt.AppGroupTypeName, 'Orphan') as [AppGroupLabel]
				, IsNull(gt.[Map],0) as [Map]
				, IsNull(gt.[Stop],0) as [Stop]
				, IsNull(gt.[AutoMapProcess],0) as [AutoMapProcess]
				, IsNull(gt.[Style],'') as [Style]
				, IsNull(gt.[AppGroupTypeDesc],'Not specified. Defaults to Orphan') as [AppGroupDesc] 
			from [ARM_CORE]..[APPGROUP] g 
			LEFT JOIN [A_AppGroupType] gt on gt.AppGroupType = g.AppgroupType
			where g.AppGroupID = cast(@ID as int)
		END
		ELSE
		BEGIN
			select g.AppGroupID, g.AppGroupName, IsNull(g.AppGroupType,0) as [AppGroupType], IsNull(gt.AppGroupTypeName, 'Orphan') as [AppGroupLabel]
				, IsNull(gt.[Map],0) as [Map]
				, IsNull(gt.[Stop],0) as [Stop]
				, IsNull(gt.[AutoMapProcess],0) as [AutoMapProcess]
				, IsNull(gt.[Style],'') as [Style]
				, IsNull(gt.[AppGroupTypeDesc],'Not specified. Defaults to Orphan') as [AppGroupDesc] 
			from [ARM_CORE]..[Application] a 
			LEFT JOIN [ARM_CORE]..[APPGROUP] g on g.AppgroupID = a.AppgroupID
			LEFT JOIN [A_AppGroupType] gt on gt.AppGroupType = g.AppgroupType
			where a.ApplicationID = @ID
		END

	END

GO

CREATE PROCEDURE X_ApplicationNew_3
AS
BEGIN
	SELECT [Table],[Column],IsNull([Label],[Lookup]) as [Label], [Lookup], isNull([Description],'') as [Description] 
	from [ARM_CORE]..[A_Lookup]
	where [Table] = 'Application' and [Column] = 'DeployType' 
	order by [Column],[Order],[Lookup] 
END

GO


CREATE PROCEDURE X_ApplicationNew_2
AS
BEGIN
	SELECT [Table],[Column],IsNull([Label],[Lookup]) as [Label], [Lookup], isNull([Description],'') as [Description] 
	from [ARM_CORE]..[A_Lookup]
	where [Table] = 'Application' and [Column] = 'Status' 
	order by [Column],[Order],[Lookup]
END

GO
CREATE PROCEDURE X_ApplicationNew_1
AS
BEGIN
	SELECT [AppGroupId], [AppGroupName] from [ARM_CORE]..[AppGroup] order by AppGroupName  
END

GO
CREATE PROCEDURE X_ApplicationRequestTab_1(@AppRqID int)
AS
BEGIN
	select ApplicationRequestID from [ARM_CORE]..[ApplicationRequest] where ApplicationRequestID = @AppRqID 
END

GO

CREATE PROCEDURE [dbo].[X_ApplicationStop_2](@SearchTerm nvarchar(255),@PageSize int,@XSearchTerm nvarchar(2000))
AS
BEGIN

	DECLARE @SQL NVARCHAR(MAX)
	SET @SQL = '
		SELECT TOP '+cast(@PageSize as nvarchar(20))+' [ApplicationID], [TransformAppStopID], [NotLike], [Status],[Notes],[Author],[Timestamp],[Reason] 
		FROM [ARM_CORE]..[TransformAppStop] 
		where ApplicationID like Replace( ''' + @SearchTerm + ''','''''''','''''''''''') and NOT ApplicationID like Replace( ''' + @XSearchTerm + ''','''''''','''''''''''')
	'
	EXEC (@SQL)
END

GO

CREATE PROCEDURE X_ApplicationStop_1
AS
BEGIN
	SELECT [Table],[Column],IsNull([Label],[Lookup]) as [Label], [Lookup] from [ARM_CORE]..[A_Lookup]
	where [Table] = 'TransformAppStop' and [Column] = 'Reason' 
	order by [Column],[Order],[Lookup] 

END

GO

CREATE PROCEDURE [dbo].[X_ApplicationMappedFrom_1](@SearchTerm nvarchar(255))
AS
BEGIN


		SELECT [As Is],[To Be],[Status] FROM [ARM_CORE].[dbo].[TransformAppMap] where [To Be] like  Replace( @SearchTerm,'''','''''')

END

GO

CREATE PROCEDURE [dbo].[X_ApplicationMapList_1]
	@StatusSearch as nVarchar(2000),
	@SearchTerm as Varchar(2000),
	@XSearchTerm as Varchar(2000)
AS
BEGIN
	SET NOCOUNT ON;
	
	DECLARE @SQL nvarchar(MAX);

	SET @SQL ='
	select distinct  s.[ApplicationID], IsNull((select count([As Is]) from [ARM_CORE]..[TransformAppMap] where [To Be] = s.ApplicationID and [As Is] <> s.ApplicationID),0) as MappedTo, IsNull(g.AppGroupName,'''') AS AppGroupName, IsNull(g.CurrentApplication,'''') as CurrentApplication, IsNull(a.PackageID,'''') as PackageID, a.AppGroupID, IsNull(m.[To Be],'''') AS Mapping, a.LocalID, a2.LocalID as LocalID2,
		 IsNull(a.Exclude,0) as ExcludeA, IsNull(a2.Exclude,0) as ExcludeB, IsNull(a.Ready,0) as ReadyA, IsNull(a2.Ready,0) as ReadyB,
		 0 AS Stop, a.DeployType,  c.[Count] as InstallCount
		 from [ARM_CORE]..[AppAstAsIs] s 
		 LEFT JOIN [ARM_CORE]..[s_ApplicationASISInstallCount] c on c.ApplicationID = s.ApplicationID
		 LEFT JOIN [ARM_CORE]..Asset t on t.AssetID = s.[AssetID] 
		 LEFT JOIN [ARM_CORE]..Application a on a.ApplicationID = s.[ApplicationID]
		 LEFT JOIN [ARM_CORE]..AppGroup g on g.AppGroupID = a.AppGroupID 
		 LEFT JOIN [ARM_CORE]..[TransformAppMap] m on m.[As Is] = s.[ApplicationID] 
		 LEFT JOIN [ARM_CORE]..Application a2 on a2.ApplicationID = m.[To Be]
		 WHERE ' + @StatusSearch + ' s.[ApplicationID] like ''' + @SearchTerm + ''' and NOT s.[ApplicationID] like ''' + @XSearchTerm + '''
		 order by [ApplicationID]
	'
	EXEC(@SQL)	
	
END



GO

	CREATE PROCEDURE X_ApplicationMap_6
	AS
	BEGIN
		
		SELECT [Table],[Column],IsNull([Label],[Lookup]) as [Label], [Lookup] from [ARM_CORE]..[A_Lookup]
		where [Table] = 'TransformAppStop' and [Column] = 'Reason' order by [Column],[Order],[Lookup] 

	END

GO

	CREATE PROCEDURE X_ApplicationMap_5
	AS
	BEGIN
		SELECT [AppGroupId], [AppGroupName] from [ARM_CORE]..[AppGroup] order by AppGroupName 

	END

GO

CREATE PROCEDURE X_ApplicationMap_4
	AS
	BEGIN
		
		SELECT [Table],[Column],IsNull([Label],[Lookup]) as [Label], [Lookup] from [ARM_CORE]..[A_Lookup] 
		where [Table] = 'Application' and [Column] = 'DeployType' order by [Column],[Order],[Lookup] 

	END

GO


CREATE PROCEDURE X_ApplicationMap_3
	AS
	BEGIN
		
		SELECT [Table],[Column],IsNull([Label],[Lookup]) as [Label], [Lookup], isNull([Description],'') as Description from [ARM_CORE]..[A_Lookup] 
		where [Table] = 'Application' and [Column] = 'Lifecycle' order by [Column],[Order],[Lookup]

	END

GO


	CREATE PROCEDURE X_ApplicationMap_2
	AS
	BEGIN
		
		SELECT [Table],[Column],IsNull([Label],[Lookup]) as [Label], [Lookup], isNull([Description],'') as Description from [ARM_CORE]..[A_Lookup] 
		where [Table] = 'Application' and [Column] = 'Status' order by [Column],[Order],[Lookup] 

	END

GO
CREATE PROCEDURE X_ApplicationMap_1
	AS
	BEGIN
		SELECT [Table],[Column],IsNull([Label],[Lookup]) as [Label], [Lookup] from [ARM_CORE]..[A_Lookup]
		where [Table] = 'Application' and [Column] = 'Status' order by [Column],[Order],[Lookup] 
	END

GO

CREATE PROCEDURE X_ApplicationBits_2(@ApplicationID nvarchar(255))
	AS
	BEGIN
		
		SELECT GroupName, Attribute, BitPosition, case when a.[BitSTatus] & Power(CONVERT(bigint,2),BitPosition-1) > 0 then 1 else 0 end as [BitSet]
		,(select count(*) from [ARM_CORE]..[A_BitCondition] x where x.GroupName = b.GroupName and x.[Table] = 'Application' ) as [ac]
		FROM [ARM_CORE]..[A_BitCondition] b 
		LEFT JOIN (select 1 as j, BitStatus from [ARM_CORE]..[Application] where ApplicationID = @ApplicationID ) as a on a.j = 1 where b.[Table] = 'Application' order by [GroupName], [Order], Attribute 

	END

GO
CREATE PROCEDURE X_ApplicationBits_1
	AS
	BEGIN
		
		select [RGB] from [ARM_CORE]..[A_ColourPalette] order by IsNull([Order],50+ColourPaletteID) 

	END

GO

CREATE PROCEDURE X_ApplicationInstances_4(@Scope nvarchar(255),@AppGroupKey nvarchar(255),@Live nvarchar(255),@Internal nvarchar(255),@OsFilter nvarchar(255))
AS
BEGIN
	DECLARE @SQL nvarchar(MAX)
	SET @SQL = '
		select s.ApplicationID AS [KEY], count(s.AssetID) AS IC, IsNull(p.[LocalID],'''') AS LocalID
		from [ARM_CORE]..'+@Scope+' s
		LEFT JOIN [ARM_CORE]..[Asset] a on a.AssetID = s.AssetID
		LEFT JOIN [ARM_CORE]..[Application] p on p.ApplicationID = s.ApplicationID
		LEFT JOIN [ARM_CORE]..[AppGroup] g on g.AppGroupID = p.AppGroupID
		LEFT JOIN [ARM_CORE]..[BArea] b on b.BArea = IsNull(a.BArea,'''')
		where g.AppGroupID =  '+@AppGroupKey+'  and a.Live = '+ @Live +' and IsNull(b.Internal,0) = '+@Internal+' '+@OsFilter+'
		Group By s.ApplicationID, IsNull(p.[LocalID],'''')
	'
	EXEC(@SQL)
END

GO


CREATE PROCEDURE X_ApplicationInstances_3
AS
BEGIN
	select Lookup, Label from [ARM_CORE]..[A_Lookup] where [Table] = 'Internal' and [Column] = 'OsFilter' Order By [Order] 
END

GO

CREATE PROCEDURE X_ApplicationInstances_2(@Scope nvarchar(255),@AppGroupKey nvarchar(255),@Live nvarchar(255),@Internal nvarchar(255))
AS
BEGIN
	DECLARE @SQL nvarchar(MAX)
	SET @SQL = '
		select top 1 s.ApplicationID AS [KEY], count(s.AssetID) AS IC, IsNull(p.[LocalID],'''') AS LocalID, g.AppGroupName
		from [ARM_CORE]..'+@Scope+' s
		LEFT JOIN ARM_CORE..Asset a on a.AssetID = s.AssetID
		LEFT JOIN ARM_CORE..Application p on p.ApplicationID = s.ApplicationID
		LEFT JOIN ARM_CORE..AppGroup g on g.AppGroupID = p.AppGroupID
		LEFT JOIN [ARM_CORE]..[BArea] b on b.BArea = IsNull(a.BArea,'''')
		where g.AppGroupID =  '+@AppGroupKey+'
		and a.Live = '+@Live+' and IsNull(b.Internal,0) = '+@Internal+'
		Group By s.ApplicationID, IsNull(p.[LocalID],''''), g.AppGroupName
	'
END

GO
CREATE PROCEDURE X_ApplicationInstances_1(@AppKey nvarchar(255))
AS
BEGIN
	select  a.AppGroupID, g.AppGroupName from ARM_CORE..[Application] a 
	LEFT JOIN ARM_CORE..[AppGroup] g on g.AppGroupID = a.AppGroupID 
	where a.ApplicationID = @AppKey
END

GO


CREATE PROCEDURE X_ApplicationGrpDependency_2
AS
BEGIN
	select distinct t.ApplicationID from ARM_CORE..AppAstToBe t order by ApplicationID 
END

GO
CREATE PROCEDURE X_ApplicationGrpDependency_1(@AppKey nvarchar(255))
AS
BEGIN
	select  a.AppGroupID, g.AppGroupName from [ARM_CORE]..[Application] a
    LEFT JOIN [ARM_CORE]..[AppGroup] g on g.AppGroupID = a.AppGroupID 
	where a.ApplicationID = @AppKey
END

GO
CREATE PROCEDURE X_ApplicationTab_1(@ID nvarchar(255))
AS
BEGIN

		select ApplicationID, IsNull(AppGroupID,'') as AppGroupID from [ARM_CORE]..[Application] where ApplicationID = @ID

END

GO
CREATE proc [dbo].[sp_payload](@payload NVARCHAR(MAX),@PayloadAttachment BIT, @tableHTML NVARCHAR(MAX) OUTPUT, @payloadRecordCount INT OUTPUT, @payloadAttachmentPath VARCHAR(MAX) OUTPUT)
AS

DECLARE @sql NVARCHAR(MAX),
		@colName VARCHAR(100), 
		@payloadFields NVARCHAR(MAX),
		@payloadFrom NVARCHAR(MAX), 
		@payloadTableName VARCHAR(50),
		@SQLCMD VARCHAR(8000), 
		@XML XML,
		@XLMoutput XML,
		@id INT, 
		@maxID INT, 
		@tableID INT
		
SET NOCOUNT ON

--SET @payload = 'select top 1 * from [Application] where AppGroupid = 7640'

SET @payloadFields =  REPLACE(LEFT(@payload, CHARINDEX('from', @payload)-1),'select','')

SET @payloadFrom = LTRIM(SUBSTRING(@payload, CHARINDEX(' from', @payload),LEN(@payload)))
SET @payloadTableName =  LTRIM(SUBSTRING(@payloadFrom,charindex(' ',@payloadFrom), CHARINDEX(' ',ltrim(SUBSTRING(@payloadFrom,charindex(' ',@payloadFrom),LEN(@payloadFrom)-charindex(' ',@payloadFrom)))) ))

SET @sql = CONCAT('SELECT ',  @payloadfields ,  'INTO ##tempPayload ', @payloadFrom)



IF Exists(SELECT * FROM tempdb..sysobjects WHERE id = object_id('tempdb..##tempPayload')) DROP TABLE ##tempPayload

EXEC sp_executesql @sql


SELECT @ID = MIN(colid),
		@maxID = MAX(colid),
		@tableID  = max(a.id)
From tempdb..syscolumns a
inner join tempdb..sysobjects b
on a.id = b.id 
where b.id = object_id('tempdb..##tempPayload')

SET @sql = 'SET @xml = CAST((SELECT '
SET @tableHTML = '<table border = 1><tr><th>'

WHILE @ID <= @maxid 
BEGIN
	SELECT @colName = name from  tempdb..syscolumns where colID = @id and id = @tableID 
	SET @tableHTML = CONCAT(@tableHTML, @colName, '</th> <th>')
	SET  @sql = CONCAT(@sql,'COALESCE([', @colName,'],'''') as ''td'','''', ')
	
	SELECT @id = MIN(colID)
	From tempdb..syscolumns a
	WHERE id = @tableID
		AND colid > @id 
END

SET @sql = CONCAT(LEFT(@sql,LEN(@sql)-1), ' FROM ##tempPayload FOR XML PATH(''tr''), ELEMENTS) AS NVARCHAR(MAX)) ')


EXEC sp_executesql @sql,N'@xml XML OUTPUT', @xml = @XLMoutput OUTPUT

--export to csv
IF @PayloadAttachment = 1
BEGIN
	SET @payloadAttachmentPath = (select PropertyValue from SystemGlobalProperties where Propertyname = 'Notifications') +'attachments\'+ @payloadTableName + Format(GetDate(), N'yyyyMMddHHmm') + '.csv"'
	SET @SQLCMD =  'SQLCMD  -S  ' + @@servername + ' -d ARM_CORE -U ArmAdmin2 -P armmra! -Q "set nocount on; select * from ##tempPayload" -W -w 999 -h-1 -s"," -o "' + @payloadAttachmentPath --+  '"'
	EXEC xp_cmdshell @SQLCMD 
END

SET @tableHTML = CONCAT(LEFT(@tableHTML,LEN(@tableHTML)-4),  CAST(@XLMoutput AS VARCHAR(MAX)),'</table>')

SET @payloadRecordCount = (select count(*) as payloadRecordCount from ##tempPayload) 

--SELECT  @tableHTML


GO

CREATE PROCEDURE X_ApplicationAssets_7
AS
BEGIN
	select BArea from [ARM_CORE]..[BArea] Order By Internal desc, BArea 
END

GO
CREATE PROCEDURE X_ApplicationAssets_6
AS
BEGIN
	select BArea from [ARM_CORE]..[BArea] Order By Internal, BArea
END

GO


CREATE PROCEDURE X_ApplicationAssets_5
AS
BEGIN
	select Lookup, Label from [ARM_CORE]..[A_Lookup] where [Table] = 'Internal' and [Column] = 'OsFilter' Order By [Order] 
END

GO

CREATE PROCEDURE X_ApplicationAssets_4(@Appscope nvarchar(255), @WhereClause nvarchar(255),@unlisted Nvarchar(255),@Location_Slice nvarchar(255),@InternalSQL nvarchar(255),@Live_SQL nvarchar(255),@Notification_Slice nvarchar(255),@orderBy nvarchar(255))
AS
BEGIN
	DECLARE @SQL nvarchar(max)
	SET @SQL = '
		select distinct a.[AssetID], IsNull(a.[Owner],'''') AS Owner, IsNull(a.[Email],'''') AS Email, IsNull(a.Deferred,0) as Def,
				isNull(a.[Target],0) AS Target, a.[Location], a.[BArea], a.[TYPE], a.[Model], a.[AssetTag], a.[Status], a.[heartbeat], a.[Confirmed], s.[EngDeployed], a.[64Bit],
				(select Count(f.[ApplicationID]) from [ARM_CORE]..[AppAstAsIs] f LEFT JOIN [ARM_CORE]..[Application] g ON g.[ApplicationID] = f.[ApplicationID] where f.AssetID = a.AssetID ) As PreApps,
				(select Count(f.[ApplicationID]) from [ARM_CORE]..[AppAstToBe] f LEFT JOIN [ARM_CORE]..[Application] g ON g.[ApplicationID] = f.[ApplicationID] LEFT JOIN [ARM_CORE]..[A_Lookup] lu ON lu.[Lookup] = g.[Status] and lu.[Table] = ''Internal''  where f.AssetID = a.AssetID and IsNull(g.DeployType,''-'') <> ''B'' and IsNull(lu.[Label],''*'') <> ''R'' and IsNull(lu.[Label],''*'') <> ''B'' and IsNull(lu.[Label],''*'') <> ''X''  ) As Apps,
				(select Count(f.[ApplicationID]) from [ARM_CORE]..[AppAstToBe] f LEFT JOIN [ARM_CORE]..[Application] g ON g.[ApplicationID] = f.[ApplicationID] LEFT JOIN [ARM_CORE]..[A_Lookup] lu ON lu.[Lookup] = g.[Status] and lu.[Table] = ''Internal''  where f.AssetID = a.AssetID and IsNull(g.DeployType,''-'') <> ''B'' and IsNull(lu.[Label],''*'') <> ''R'' and IsNull(lu.[Label],''*'') <> ''B'' and IsNull(lu.[Label],''*'') <> ''X''  and g.[Ready] = 1) As ReadyApps,
				IsNull((select TOP 1 h.[Label] from  [ARM_CORE]..[ScheduleDeployRun] h LEFT JOIN [ARM_CORE]..[ScheduleDeployRunAsset] r on h.RunID = r.RunID where r.AssetID = a.[AssetID] and h.RunDate >= convert(date,getDate()) order by h.Rundate Asc ),'''') AS [myLabelAsc],
				IsNull((select TOP 1 h.[Label] from  [ARM_CORE]..[ScheduleDeployRun] h LEFT JOIN [ARM_CORE]..[ScheduleDeployRunAsset] r on h.RunID = r.RunID where r.AssetID = a.[AssetID] and h.RunDate <= convert(date,getDate()) order by h.Rundate Desc ),'''') AS [myLabelDesc]
				from [ARM_CORE]..[Asset] a
				left JOIN [ARM_CORE]..[AssetStatus] s on s.AssetID = a.AssetID
				left JOIN [ARM_CORE]..'+@AppScope+' e on e.AssetID = a.AssetID 
				LEFT JOIN [ARM_CORE]..[ScheduleDeployRunAsset] r on r.AssetID = a.AssetID
				LEFT JOIN [ARM_CORE]..[ScheduleDeployRun] d ON d.RunID = r.RunID 
				LEFT JOIN [ARM_CORE]..[BArea] b ON b.BArea = a.BArea
				LEFT JOIN [ARM_CORE]..[NotificationLog] n ON n.[AssetID] = a.AssetID
				'+@WhereClause+' '+@UNLISTED+' '+@LOCATION_SLICE+' '+@InternalSQL+' '+@Live_SQL+' '+@Notification_Slice+' '+@orderBy+'
	'
	EXEC (@SQL)
END

GO

CREATE PROCEDURE X_ApplicationAssets_3(@AssetList nvarchar(255), @BAreaSelect nvarchar(255))
AS
BEGIN
	DECLARE @SQL nvarchar(max)
	SET @SQL = '
		update [ARM_CORE]..[Asset] set BArea = replace('+@BAreaSelect+',"''","''''") where AssetID  in ('+@AssetList+') 
	'
	EXEC (@SQL)
END

GO

CREATE PROCEDURE X_ApplicationAssets_2(@AssetList nvarchar(255))
AS
BEGIN
	DECLARE @SQL nvarchar(max)
	SET @SQL = '
		update [ARM_CORE]..[Asset] set target = 0 where AssetID  in ('+@AssetList+')
	'
	EXEC (@SQL)
END

GO
CREATE PROCEDURE X_ApplicationAssets_1(@AssetList nvarchar(255))
AS
BEGIN
	DECLARE @SQL nvarchar(max)
	SET @SQL = '
		update [ARM_CORE]..[Asset] set target = 1 where AssetID  in ('+@AssetList+')
	'
	EXEC (@SQL)
END

GO

CREATE PROCEDURE X_Collection2_7
 @CollectionType NVARCHAR(50),
 @ContextID INT
AS
BEGIN
 SELECT 
  [ButtonID],
  ISNULL([ButtonTitle], '') AS [ButtonTitle],
  ISNULL([Icon], '') AS [Icon], 
  ISNULL([Batch], 0) AS [Batch],
  ISNULL([Label], '') AS [Label],
  ISNULL([minRoleID], 3) AS [minRoleID], 
  ISNULL([ContextID], 0) AS [ContextID], 
  ISNULL([Context], 'Run') AS [Context],
  ISNULL([URL], '') AS [url],
  ISNULL([Class], 'btn-primary') AS [Class], 
  ISNULL([Order], 0) AS [Order],
  ISNULL([Active], 0) AS [Active] 
 FROM [ARM_CORE]..[Button]
 WHERE ISNULL([Active], 0) = 1
 AND (ISNULL([Context], 'Run') = 'Collection' OR (ISNULL([Context],'Run') = 'ClassCollection'
 AND ISNULL(ContextID,0) = @ContextID) ) and [Type] = @CollectionType
 ORDER BY [Order]
END

GO

CREATE PROCEDURE X_Collection2_6
 @CollectionType NVARCHAR(50),
 @ContextID INT
AS
BEGIN
 SELECT 
  [ButtonID],
  ISNULL([ButtonTitle], '') AS [ButtonTitle],
  ISNULL([Icon], '') AS [Icon], 
  ISNULL([Batch], 0) AS [Batch],
  ISNULL([Label], '') AS [Label],
  ISNULL([minRoleID], 3) AS [minRoleID],
  ISNULL([URL], '') AS [url],
  ISNULL([Class], 'btn-primary') AS [Class],
  ISNULL([WorkstreamID], 0) AS [WorkstreamID],
  ISNULL([ContextID], 0) AS [ContextID],
  ISNULL([Order], 0) AS [Order],
  ISNULL([Active],0) AS [Active]
 FROM [ARM_CORE]..[Button] 
 WHERE 
  ISNULL([Active], 0) = 1 
 AND ISNULL([Context],'Run') = 'CollectionClass' 
 AND [Type] in (@CollectionType, 'Collection')
 AND (ISNULL(ContextID, 0) = 0 or ISNULL(contextID, 0) = @ContextID) 
 ORDER BY [Order]
END

GO

CREATE PROCEDURE X_Collection2_5
 @CollectionClassID INT
AS
BEGIN
 
 SELECT 
  a.CollectionID,
  ISNULL(c.[Name], '') AS CollectionClassName,
  c.[Distinct], 
  c.[WorkstreamID], 
  a.CollectionClassID, 
  ISNULL(a.[Type], '') AS [Type], 
  a.[Name], 
  a.[Order], 
  a.[Marker], 
  a.[Colour], 
  a.[CriteriaState],
  ISNULL((SELECT TOP 1 [CollectionAgentID] FROM [ARM_CORE].[dbo].[A_CollectionAgent] t WHERE t.CollectionID = a.CollectionID), 0) AS AgentID,
  (SELECT COUNT(f.ItemID) FROM [ARM_CORE]..[A_CollectionItem] f WHERE f.CollectionID = a.CollectionID) AS FC,
  (SELECT COUNT(g.itemID) FROM [ARM_CORE]..[A_CollectionItem] g LEFT JOIN [ARM_CORE]..[A_Collection] gc on gc.CollectionID = g.CollectionID WHERE gc.CollectionClassID = c.CollectionClassID ) AS TC,
  ISNULL((SELECT TOP 1 ViewID FROM [ARM_CORE]..[Views] v WHERE v.ViewRef = a.[Type] + 'Collection'), 0) AS ViewID,
  ISNULL((select top 1 ViewID FROM [ARM_CORE]..[Views] v WHERE v.ViewRef = a.[Type] + 'Class'), 0) AS ClassViewID,
  c.CriteriaState AS ClassCriteriaState  
 FROM [ARM_CORE]..[A_CollectionClass] c 
 LEFT JOIN [ARM_CORE]..[A_Collection] a ON a.CollectionClassID = c.CollectionClassID     
 WHERE c.[CollectionClassID] =  @CollectionClassID 
 ORDER BY 
  c.[Name], a.[Order], [Name]
END

GO

CREATE PROCEDURE X_Collection2_4
 @CollectionClassID INT
AS
BEGIN
 SELECT
  c.[Name],
  COUNT(ci.ItemID) AS [Count],
  ISNULL(p.[RGB], c.[Colour]) AS [_Colour],
  cc.UseCollectionColours
 FROM [ARM_CORE]..[A_Collection] c
 LEFT JOIN [ARM_CORE]..[A_CollectionItem] ci ON c.CollectionID = ci.CollectionID
 LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc ON cc.CollectionClassID = c.CollectionClassID
 LEFT JOIN [ARM_CORE]..[A_ColourPalette] p ON p.[Class] = c.Colour
 WHERE
  c.CollectionClassID = @CollectionClassID
 GROUP BY
  c.[Name],
  c.[Order],
  ISNULL(p.[RGB], c.[Colour]),
  cc.UseCollectionColours
 ORDER BY
  c.[Order]
END

GO

CREATE PROCEDURE X_Collection2_3
 @CollectionClassID INT
AS
BEGIN
 SELECT
  c.[Name],
  COUNT(i.ItemID)
 FROM [ARM_CORE]..[A_Collection] c
 LEFT JOIN [ARM_CORE]..[A_CollectionItem] i ON c.CollectionID = i.CollectionID
 WHERE
  c.CollectionClassID = @CollectionClassID
 GROUP BY c.[Name],
  c.[Order]
 ORDER BY c.[Order]
END

GO

CREATE PROCEDURE X_Collection2_2
 @CollectionClassID INT
AS
BEGIN
 SELECT
  ISNULL(w.[Name], c.[Name]) AS [Name],
  ISNULL(c.WorkstreamID, 0) AS [WorkstreamID],
  ISNULL(c.[Distinct], 1) AS [DistinctClass]
 FROM [ARM_CORE]..[A_CollectionClass] c
 LEFT JOIN [ARM_CORE]..[Workstream] w ON c.WorkstreamID = c.WorkstreamID
 WHERE
  c.CollectionClassID = @CollectionClassID
END

GO

CREATE PROCEDURE X_Collection2_1
 @WorkstreamID INT
AS
BEGIN
 SELECT
  w.[Name],
  ISNULL(w.KeyStatusID, 0) AS CollectionClassID
 FROM [ARM_CORE]..[Workstream] w
 WHERE
  w.WorkstreamID = @WorkstreamID
END

GO

CREATE PROCEDURE X_Collection_7
 @CollectionType NVARCHAR(50),
 @ContextID INT
AS
BEGIN
 SELECT 
  [ButtonID],
  ISNULL([ButtonTitle], '') AS [ButtonTitle],
  ISNULL([Icon], '') AS [Icon], 
  ISNULL([Batch], 0) AS [Batch],
  ISNULL([Label], '') AS [Label],
  ISNULL([minRoleID], 3) AS [minRoleID], 
  ISNULL([ContextID], 0) AS [ContextID], 
  ISNULL([Context], 'Run') AS [Context],
  ISNULL([URL], '') AS [url],
  ISNULL([Class], 'btn-primary') AS [Class], 
  ISNULL([Order], 0) AS [Order],
  ISNULL([Active], 0) AS [Active] 
 FROM [ARM_CORE]..[Button]
 WHERE ISNULL([Active], 0) = 1
 AND (ISNULL([Context], 'Run') = 'Collection' OR (ISNULL([Context],'Run') = 'ClassCollection'
 AND ISNULL(ContextID,0) = @ContextID) ) and [Type] = @CollectionType
 ORDER BY [Order]
END

GO

CREATE PROCEDURE X_Collection_6
 @CollectionType NVARCHAR(50),
 @ContextID INT
AS
BEGIN
 SELECT 
  [ButtonID],
  ISNULL([ButtonTitle], '') AS [ButtonTitle],
  ISNULL([Icon], '') AS [Icon], 
  ISNULL([Batch], 0) AS [Batch],
  ISNULL([Label], '') AS [Label],
  ISNULL([minRoleID], 3) AS [minRoleID],
  ISNULL([URL], '') AS [url],
  ISNULL([Class], 'btn-primary') AS [Class],
  ISNULL([WorkstreamID], 0) AS [WorkstreamID],
  ISNULL([ContextID], 0) AS [ContextID],
  ISNULL([Order], 0) AS [Order],
  ISNULL([Active],0) AS [Active]
 FROM [ARM_CORE]..[Button] 
 WHERE 
  ISNULL([Active], 0) = 1 
 AND ISNULL([Context],'Run') = 'CollectionClass' 
 AND [Type] in (@CollectionType, 'Collection')
 AND (ISNULL(ContextID, 0) = 0 or ISNULL(contextID, 0) = @ContextID) 
 ORDER BY [Order]
END

GO
CREATE PROCEDURE [dbo].[X_Collection_5]
@CollectionClassID INT
AS
BEGIN

 SELECT 
  a.CollectionID,
  ISNULL(c.[Name], '') AS CollectionClassName,
  IsNull(c.[Distinct],1) as [Distinct], 
  c.[WorkstreamID], 
  c.CollectionClassID, 
  ISNULL(a.[Type], '') AS [Type], 
  a.[Name], 
  a.[Order], 
  a.[Marker], 
  a.[Colour], 
  a.[CriteriaState],
  a.[EndState],
  a.[Protect],
  ISNULL([Ignore], 0) AS [Ignore] ,
  ISNULL((SELECT TOP 1 [EventID] FROM [ARM_CORE].[dbo].[SYS_EVENT] t WHERE t.CollectionID = a.CollectionID and EventType='Scheduled Discover'), 0) AS HasDiscovery,

  (SELECT COUNT(f.ItemID) FROM [ARM_CORE]..[A_CollectionItem] f WHERE f.CollectionID = a.CollectionID) AS FC,
  (SELECT COUNT(g.itemID) FROM [ARM_CORE]..[A_CollectionItem] g LEFT JOIN [ARM_CORE]..[A_Collection] gc on gc.CollectionID = g.CollectionID WHERE gc.CollectionClassID = c.CollectionClassID ) AS TC,

  ISNULL((SELECT TOP 1 ViewRef FROM [ARM_CORE]..[Views] v WHERE v.ViewRef = a.[Type] + 'Collection'), 'DefaultCollection') AS ViewRef,
  ISNULL((select top 1 ViewRef FROM [ARM_CORE]..[Views] v WHERE v.ViewRef = a.[Type] + 'Class'), 'DefaultClass') AS ClassViewRef,
  c.CriteriaState AS ClassCriteriaState,  

  IIF(EXISTS (SELECT [EventID] FROM [SYS_EVENT] WHERE [CollectionID] =  a.CollectionID and EventType like '%Mailer%') , 1 , 0) as HasMailer,

  IIF(EXISTS (SELECT [EventID] FROM [SYS_EVENT] WHERE [CollectionID] =  a.CollectionID and EventType like 'Immediate%') , 1 , 0) as HasImmediateEvent,
  IIF(EXISTS (SELECT [EventID] FROM [SYS_EVENT] WHERE [CollectionID] =  a.CollectionID and EventType like 'Scheduled%') , 1 , 0) as HasScheduledEvent
FROM [ARM_CORE]..[A_CollectionClass] c 
 LEFT JOIN [ARM_CORE]..[A_Collection] a ON a.CollectionClassID = c.CollectionClassID     
 WHERE c.[CollectionClassID] =  @CollectionClassID 
 ORDER BY 
  c.[Name], a.[Order], [Name]
END


GO

CREATE PROCEDURE [dbo].[X_Collection_4]
@CollectionClassID INT
AS
BEGIN


 SELECT c.[Group],  COUNT(i.ItemID) AS [Count],  ISNULL(p.[RGB], c.[Colour]) AS [_Colour] 
 from [ARM_CORE]..[A_CollectionItem] i  
 LEFT JOIN ARM_CORE..A_Collection c on c.CollectionID = i.CollectionID  
 LEFT JOIN [ARM_CORE]..[A_ColourPalette] p ON p.[Class] = c.Colour  
 WHERE c.CollectionClassID = @CollectionClassID and  IsNull(c.Ignore,0) = 0  
 GROUP BY  c.[Group],  ISNULL(p.[RGB], c.[Colour])


END
GO

CREATE PROCEDURE X_Collection_3
 @CollectionClassID INT
AS
BEGIN
 SELECT
  c.[Name],
  COUNT(i.ItemID)
 FROM [ARM_CORE]..[A_Collection] c
 LEFT JOIN [ARM_CORE]..[A_CollectionItem] i ON c.CollectionID = i.CollectionID
 WHERE
  c.CollectionClassID = @CollectionClassID
 GROUP BY c.[Name],
  c.[Order]
 ORDER BY c.[Order]
END

GO

CREATE PROCEDURE [dbo].[X_Collection_2]
 @CollectionClassID INT
AS
BEGIN
	 SELECT
		  c.[Name] AS [Name]
		  ,ISNULL(c.WorkstreamID, 0) AS [WorkstreamID]
		  ,ISNULL(c.[Distinct], 1) AS [DistinctClass]
		  ,ISNULL(c.[DefaultCollectionID],0) AS [DefaultCollectionID]
	 FROM [ARM_CORE]..[A_CollectionClass] c
	 LEFT JOIN [ARM_CORE]..[Workstream] w ON w.KeyStatusID = c.CollectionClassID
	 WHERE
		c.CollectionClassID = @CollectionClassID
END

GO

CREATE PROCEDURE X_Collection_1
 @WorkstreamID INT
AS
BEGIN
 SELECT
  w.[Name],
  ISNULL(w.KeyStatusID, 0) AS CollectionClassID
 FROM [ARM_CORE]..[Workstream] w
 WHERE
  w.WorkstreamID = @WorkstreamID
END

GO

CREATE PROCEDURE X_Collection_Copy_4
AS
BEGIN
 SELECT 
  w.[Name],
  w.WorkstreamID,
  COUNT(g.ItemID) AS [TC]
 FROM [ARM_CORE]..[Workstream] w
 LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc ON cc.CollectionClassID = w.KeyStatusID
 LEFT JOIN [ARM_CORE]..[A_Collection] c ON c.CollectionClassID = cc.CollectionClassID
 LEFT JOIN [ARM_CORE]..[A_CollectionItem] g ON g.CollectionID = c.CollectionID
 GROUP BY
  w.WorkstreamID,
  w.[Name]
 ORDER BY
  w.[Name]
END

GO
CREATE PROCEDURE X_Collection_Copy_3
 @CollectionType NVARCHAR(100),
 @AuthUser NVARCHAR(255)
AS
BEGIN
  SELECT 
  a.CollectionID,
  c.WorkstreamID,
  ISNULL(c.[Name], '') AS [CollectionClassname],
  c.WorkstreamID,
  a.CollectionClassID,
  ISNULL(a.[Type], '') AS [Type],
  a.[Name],
  a.Auth_User AS [Auth_User],
  a.[Order],
  c.[Status],
  (SELECT COUNT(f.ItemID)
   FROM [ARM_CORE]..[A_CollectionItem] f
   WHERE f.CollectionID = a.CollectionID) AS [FC],
  (SELECT COUNT(g.ItemID)
   FROM [ARM_CORE]..[A_CollectionItem] g
   LEFT JOIN [ARM_CORE]..[A_Collection] gc ON gc.CollectionID = g.CollectionID
   WHERE gc.CollectionClassID = c.CollectionClassID) AS [TC],
  ISNULL((SELECT TOP 1 ViewID FROM [ARM_CORE]..[Views] v WHERE v.ViewRef = @CollectionType), 'Collection') AS [ViewID]
  FROM [ARM_CORE]..[A_Collection] a
  LEFT JOIN [ARM_CORE]..[A_CollectionClass] c ON c.CollectionClassID = a.CollectionClassID
  WHERE
  a.[Type] = @CollectionType
 AND ISNULL([Status], 0) = 0
 AND ISNULL(a.CollectionClassID, 0) = 0
 AND (NOT a.[Name] LIKE '%_CLIPBOARD' OR (a.[Name] LIKE '%_CLIPBOARD' AND a.[Auth_User] = @AuthUser))
 ORDER BY
  a.[Name]
END



GO

CREATE PROCEDURE X_Collection_Copy_2
 @CollectionType NVARCHAR(100)
AS
BEGIN
 SELECT
  DISTINCT
  cc.CollectionClassID,
  ISNULL(cc.[Name], '') AS [Name]
 FROM [ARM_CORE]..[A_CollectionClass] cc
 LEFT JOIN [ARM_CORE]..[A_Collection] c ON cc.CollectionClassID = c.CollectionClassID
 WHERE
  ISNULL(c.[Type], '') = @CollectionType
 OR c.CollectionID IS NULL
END

GO

CREATE PROCEDURE X_Collection_Copy_1
AS
BEGIN
 SELECT
  DISTINCT
  ISNULL([Type], '') AS [Type]
 FROM [ARM_CORE]..[A_Collection]
END

GO

CREATE PROCEDURE X_ClearNotificationLog_1
 @AutoNotificationID INT
AS
BEGIN
 SELECT 
  a.[Name]
 FROM [ARM_CORE]..[AutoNotification] a 
 WHERE AutoNotificationID = @AutoNotificationID
END

GO

CREATE PROCEDURE X_Chartme_1
AS
BEGIN
 SELECT
  DISTINCT
  a.[Model],
  COUNT(a.AssetID) AS [Count]
 FROM [ARM_CORE]..[Asset] a
 GROUP BY a.[Model]
 ORDER BY a.[Model]
END




GO

CREATE PROCEDURE X_Chart_1
AS
BEGIN
 SELECT
  ChartID,
  ISNULL(ChartTitle, '') AS [ChartTitle],
  ISNULL(c.Units, 4) AS [Units],
  ISNULL([Type], 'PieChart') AS [Type],
  ISNULL([Data], '') AS [Data],
  ISNULL([Options], '') AS [Options],
  ISNULL([SQL], '') AS [SQL],
  ISNULL([URL], '') AS [URL],
  CAST(ISNULL([Description], '') AS VARCHAR(3000)) AS [Description]
 FROM [ARM_CORE]..[Chart] c
 WHERE
  ISNULL(c.Active, 1) = 1
 ORDER BY
  c.[Order],
  c.[ChartTitle]
END

GO

CREATE PROCEDURE X_ChannelUpdate_1
 @ChannelID INT,
 @Name NVARCHAR(50),
 @ShortName NVARCHAR(50),
 @BgColour NVARCHAR(10),
 @AssetType NVARCHAR(50),
 @Bookable BIT
AS
BEGIN
 UPDATE [ARM_CORE]..[ScheduleChannel]
 SET
  [Name] = @Name,
  ShortName = @ShortName,
  BgColour = @BgColour,
  AssetType = @AssetType,
  Bookable = @Bookable
 WHERE
  ChannelID = @ChannelID
END

GO

CREATE PROCEDURE X_ChannelScheduleUpdate_5
 @BID INT
AS
BEGIN
 SELECT
  TID
 FROM [ARM_CORE]..[ScheduleTimeSlot]
 WHERE BID = @BID
END

GO

CREATE PROCEDURE X_ChannelScheduleUpdate_6
 @Active BIT,
 @MaxBooking SMALLINT,
 @TID INT
AS
BEGIN
 UPDATE [ARM_CORE]..[ScheduleTimeSlot]
 SET 
  Active = @Active,
  MaxBooking = @MaxBooking
 WHERE
  TID = @TID
END

GO

CREATE PROCEDURE X_ChannelScheduleUpdate_4
 @CloseBuffer SMALLINT,
 @BID INT
AS
BEGIN
 UPDATE [ARM_CORE]..[ScheduleBookDay]
 SET CloseBuffer = @CloseBuffer
 WHERE BID = @BID
END

GO

CREATE PROCEDURE X_ChannelScheduleUpdate_3
 @BID INT
AS
BEGIN
 DELETE FROM [ARM_CORE]..[ScheduleBookDay] WHERE BID = @BID
 DELETE FROM [ARM_CORE]..[ScheduleDeployRun] WHERE BID = @BID
END

GO

CREATE PROCEDURE X_ChannelScheduleUpdate_2
 @BID INT
AS
BEGIN
 SELECT COUNT(TID) AS [Slots] FROM [ARM_CORE]..[ScheduleTimeSlot] t WHERE t.BID = @BID
END

GO

CREATE PROCEDURE X_ChannelScheduleUpdate_1
 @BID INT
AS
BEGIN
 DELETE FROM [ARM_CORE]..[ScheduleTimeSlot] 
 WHERE 
  BID = @BID 
 AND TID NOT IN (
  SELECT
   DISTINCT x.TID 
  FROM [ARM_CORE]..[ScheduleTimeSlot] x 
  INNER JOIN [ARM_CORE]..[ScheduleBooking] b ON b.TID = x.TID 
  WHERE x.BID = @BID
 )
END

GO

CREATE PROCEDURE X_ChannelScheduleCreate_3
 @BID INT,
 @Label NVARCHAR(50),
 @Active BIT,
 @MaxBooking SMALLINT,
 @Duration SMALLINT
AS
BEGIN
 INSERT INTO [ARM_CORE]..[ScheduleTimeSlot] (BID, Label, Active, MaxBooking, Duration) VALUES(@BID, @Label, @Active, @MaxBooking, @Duration)
END

GO

CREATE PROCEDURE X_ChannelScheduleCreate_2
 @TemplateID INT
AS
BEGIN
 SELECT
  TimeTemplateSlotID,
  [Label],
  Duration
 FROM [ARM_CORE]..[ScheduleTimeTemplateSlot]
 WHERE TemplateID = @TemplateID
END

GO

CREATE PROCEDURE X_ChannelScheduleCreate_1
 @CloseBuffer SMALLINT,
 @BID INT
AS
BEGIN
 UPDATE [ARM_CORE]..[ScheduleBookDay] SET CloseBuffer = @CloseBuffer WHERE BID = @BID
END

GO

CREATE PROCEDURE [dbo].[X_ChannelSchedule_11]
 @TID INT
AS
BEGIN
 SELECT
  (SELECT COUNT(x.TimeTemplateSlotID) FROM [ARM_CORE]..[ScheduleTimeTemplateSlot] x WHERE x.TemplateID = t.TemplateID) AS [Total],
  '' AS [DREF],
  (SELECT 0) AS [Bookings],
  ISNULL(s.CloseBuffer, 2) AS [CloseBuffer],
  t.TimeTemplateSlotID,
  t.[Label],
  t.Active,
  t.MaxBookings AS [MaxBooking],
  t.Duration
 FROM [ARM_CORE]..[ScheduleTimeTemplateSlot] t
 LEFT JOIN [ARM_CORE]..[ScheduleTimeTemplate] s ON s.TemplateID = t.TemplateID
 WHERE
  t.TemplateID = @TID
 ORDER BY t.[Label]
END

GO

CREATE PROCEDURE [dbo].[X_ChannelSchedule_10]
 @BID INT
AS
BEGIN
 SELECT 
  (SELECT COUNT(x.TID) FROM [ARM_CORE]..[ScheduleTimeSlot] x WHERE x.BID = b.BID) AS [Total],
  (SELECT COUNT(y.AssetID) FROM [ARM_CORE]..[ScheduleBooking] y WHERE y.TID = t.TID) AS [Bookings],
  t.TID,
  b.BID,
  t.[Label],
  t.Active,
  t.MaxBooking,
  t.Duration,
  b.TheDate,
  b.CloseBuffer,
  ISNULL(s.[Label], '') AS [DREF]
 FROM [ARM_CORE]..[ScheduleTimeSlot] t
 LEFT JOIN [ARM_CORE]..[ScheduleBookDay] b ON b.BID = t.BID
 LEFT JOIN [ARM_CORE]..[ScheduleDeployRun] s ON s.BID = b.BID
 WHERE
  b.BID = @BID
 ORDER BY t.[Label]
END

GO

CREATE PROCEDURE [dbo].[X_ChannelSchedule_9]
AS
BEGIN
 SELECT
  TemplateID,
  [Name],
  [Note]
 FROM [ARM_CORE]..[ScheduleTimeTemplate]
END

GO

CREATE PROCEDURE X_ChannelSchedule_8
 @DID INT,
 @BID INT,
 @CID INT,
 @MonthID INT
AS
BEGIN
 IF ISNULL(@DID, 0) = 0
 BEGIN
  SELECT
   (SELECT COUNT(x.TID) FROM [ARM_CORE]..[ScheduleTimeSlot] x WHERE x.BID = b.BID) AS [Total],
   t.TID,
   t.BID,
   t.[Label],
   t.Active,
   t.MaxBooking,
   t.Duration,
   b.TheDate
  FROM [ARM_CORE]..[ScheduleTimeSlot] t
  LEFT JOIN [ARM_CORE]..[ScheduleBookDay] b ON t.BID = b.BID
  WHERE
   b.BID = @BID
 END
 ELSE
 BEGIN
  SELECT
   (SELECT COUNT(x.TID) FROM [ARM_CORE]..[ScheduleTimeSlot] x WHERE x.BID = b.BID) AS [Total],
   t.TID,
   t.BID,
   t.[Label],
   t.Active,
   t.MaxBooking,
   t.Duration,
   b.TheDate
  FROM [ARM_CORE]..[ScheduleTimeSlot] t
  LEFT JOIN [ARM_CORE]..[ScheduleBookDay] b ON t.BID = b.BID
  WHERE
   b.ChannelID = @CID
  AND b.TheDate = CAST(@MonthID AS NVARCHAR) + '-' + CAST(@DID AS NVARCHAR)
 END
END

GO

CREATE PROCEDURE X_ChannelSchedule_7
 @WorkstreamID INT
AS
BEGIN
 SELECT
  ChannelID,
  [Name],
  Bookable,
  AssetType
 FROM [ARM_CORE]..[ScheduleChannel]
 WHERE Bookable = 1
 AND WorkstreamID = @WorkstreamID
END

GO

CREATE PROCEDURE X_ChannelSchedule_6
 @ChannelID INT
AS
BEGIN
 SELECT DISTINCT
  MONTH(b.TheDate) AS [TheMonth],
  YEAR(b.TheDate) AS [TheYear]
 FROM [ARM_CORE]..[ScheduleBookDay] b
 WHERE
  b.ChannelID = @ChannelID
 AND b.Active = 1
 ORDER BY [TheYear], [TheMonth]
END

GO

CREATE PROCEDURE X_ChannelSchedule_5
 @ChannelID INT,
 @BID INT
AS
BEGIN
 SELECT DISTINCT
  b.TheDate,
  b.BID,
  (SELECT SUM(x.MaxBooking) FROM [ARM_CORE]..[ScheduleTimeSlot] x WHERE x.BID = b.BID) AS [MaxTotal],
  (SELECT COUNT(y.AssetID) FROM [ARM_CORE]..[ScheduleBooking] y LEFT JOIN [ARM_CORE]..[ScheduleTimeSlot] x ON x.TID = y.TID WHERE x.BID = b.BID) AS [Bookings]
 FROM [ARM_CORE]..[ScheduleBookDay] b
 WHERE
  b.ChannelID = @ChannelID
 AND Active = 1
 AND MONTH(b.TheDate) = (SELECT MONTH(x.TheDate) FROM [ARM_CORE]..[ScheduleBookDay] x WHERE x.BID = @BID)
 AND YEAR(b.TheDate) = (SELECT YEAR(x.TheDate) FROM [ARM_CORE]..[ScheduleBookDay] x WHERE x.BID = @BID)
 ORDER BY b.TheDate
END

GO

CREATE PROCEDURE X_ChannelSchedule_4
 @ChannelID INT,
 @Month INT,
 @Year INT
AS
BEGIN
 SELECT 
  TOP 1
  b.TheDate,
  b.BID,
  ISNULL(b.CloseBuffer, 0) AS [CloseBuffer],
  c.[Name]
 FROM [ARM_CORE]..[ScheduleBookDay] b
 LEFT JOIN [ARM_CORE]..[ScheduleChannel] c ON b.ChannelID = c.ChannelID
 WHERE
  b.ChannelID = @ChannelID
 AND MONTH(b.TheDate) = @Month
 AND YEAR(b.TheDate) = @Year
 AND b.Active = 1
 ORDER BY
  b.TheDate
END

GO

CREATE PROCEDURE X_ChannelSchedule_3
 @ChannelID INT
AS
BEGIN
 SELECT 
  c.[Name],
  c.WorkstreamID
 FROM [ARM_CORE]..[ScheduleChannel] c
 WHERE 
  c.ChannelID = @ChannelID
END

GO

CREATE PROCEDURE X_ChannelSchedule_2
AS
BEGIN
 SELECT 
  ChannelID
 FROM [ARM_CORE]..[ScheduleChannel] c
 WHERE c.Bookable = 1
 ORDER BY c.[Name]
END

GO

CREATE PROCEDURE X_ChannelSchedule_1
 @BID INT
AS
BEGIN
 SELECT 
  b.ChannelID,
  b.TheDate,
  b.Active,
  ISNULL(b.CloseBuffer, 0) AS [CloseBuffer],
  ISNULL(c.WorkstreamID, 0) AS [WorkstreamID]
 FROM [ARM_CORE]..[ScheduleBookDay] b
 LEFT JOIN [ARM_CORE]..[ScheduleChannel] c ON b.ChannelID = c.ChannelID
 WHERE
  b.BID = @BID
END

GO

CREATE PROCEDURE X_ChannelEditor_old_3
AS
BEGIN
 SELECT 
  c.ChannelID, 
  c.[Name], 
  c.ShortName, 
  c.BgColour, 
  c.Bookable, 
  c.AssetType 
 FROM [ARM_CORE]..[ScheduleChannel] c 
 WHERE c.Bookable = 0 
 ORDER BY c.[Name]
END

GO

CREATE PROCEDURE X_ChannelEditor_old_2
AS
BEGIN
 SELECT 
  c.ChannelID, 
  (SELECT COUNT(b.AssetID) 
   FROM [ARM_CORE]..[ScheduleBooking] b 
   LEFT JOIN [ARM_CORE]..[ScheduleTimeSlot] t ON t.TID = b.TID 
   LEFT JOIN [ARM_CORE]..[ScheduleBookDay] d ON d.BID = t.BID 
   WHERE 
    d.ChannelID = c.ChannelID 
   AND d.[TheDate] >= GETDATE() - 1) AS [FBookCount],
  (SELECT COUNT(b.AssetID) 
   FROM [ARM_CORE]..[ScheduleBooking] b 
   LEFT JOIN [ARM_CORE]..[ScheduleTimeSlot] t ON t.TID = b.TID 
   LEFT JOIN [ARM_CORE]..[ScheduleBookDay] d ON d.BID = t.BID 
   WHERE 
    d.ChannelID = c.ChannelID 
   AND d.[TheDate] < GETDATE() - 1) AS [HBookCount],
  (SELECT SUM(t.MaxBooking) 
   FROM [ARM_CORE]..[ScheduleTimeSlot] t 
   LEFT JOIN [ARM_CORE]..[ScheduleBookDay] b ON b.BID = t.BID 
   WHERE 
    b.ChannelID = c.ChannelID
   AND t.Active = 1 
   AND b.Active = 1 
   AND b.[TheDate] >= GETDATE() - 1) AS [CBookCount],
   c.[Name], 
   c.ShortName, 
   c.BgColour, 
   c.Bookable, 
   c.AssetType, 
   ISNULL(i.InstrID, 0) AS InstrID, 
   ISNULL(i.Active, 0) AS Active  
 FROM [ARM_CORE]..[ScheduleChannel] c 
 LEFT JOIN [ARM_CORE]..[ScheduleInstruction] i on i.ChannelID = c.ChannelID 
 WHERE
  c.Bookable = 1
 ORDER BY c.Name
END

GO

CREATE PROCEDURE X_ChannelEditor_old_1
AS
BEGIN
 SELECT
  DISTINCT
  ISNULL(b.BookType, l.[Lookup]) AS [Lookup],
  ISNULL(b.BookType, l.[Label]) AS [Label]
 FROM [ARM_CORE]..[A_LookUp] l
 LEFT JOIN [ARM_CORE]..[BookType] b ON b.AssetType = l.[Label]
 WHERE
  l.[Table] = 'Asset'
 AND l.[Column] = 'Type'
 ORDER BY
  [Label]
END

GO

CREATE PROCEDURE X_ChannelEditor_5
 @WorkstreamID INT,
 @Mode NVARCHAR(250)
AS
BEGIN
 SELECT
  c.ChannelID,
  c.[Name],
  c.ShortName,
  c.Mode,
  c.BgColour,
  c.Bookable,
  c.AssetType,
  ISNULL(c.[Active], 0) AS [Active],
  ISNULL(i.[Active], 0) AS [InstrActive]
 FROM [ARM_CORE]..[ScheduleChannel] c
 LEFT JOIN [ARM_CORE]..[ScheduleInstruction] i ON i.ChannelID = c.ChannelID
 WHERE
  c.Mode = @Mode
 AND ISNULL(c.WorkstreamID, 0) = @WorkstreamID
 ORDER BY c.[Name]
END

GO

CREATE PROCEDURE X_ChannelEditor_4
 @WorkstreamID INT
AS
BEGIN
 SELECT 
  c.ChannelID,
  (SELECT
   COUNT(b.AssetID)
  FROM [ARM_CORE]..[ScheduleBooking] b
  LEFT JOIN [ARM_CORE]..[ScheduleTimeSlot] t ON t.TID = b.TID
  LEFT JOIN [ARM_CORE]..[ScheduleBookDay] d ON d.BID = t.BID
  WHERE
   d.ChannelID = c.ChannelID
  AND d.TheDate >= GETDATE() - 1) AS [FBookCount],
  (SELECT
   COUNT(b.AssetID)
  FROM [ARM_CORE]..[ScheduleBooking] b
  LEFT JOIN [ARM_CORE]..[ScheduleTimeSlot] t ON t.TID = b.TID
  LEFT JOIN [ARM_CORE]..[ScheduleBookDay] d ON d.BID = t.BID
  WHERE
   d.ChannelID = c.ChannelID
  AND d.TheDate < GETDATE() - 1) AS [HBookCount],
  (SELECT SUM(t.MaxBooking)
  FROM [ARM_CORE]..[ScheduleTimeSlot] t
  LEFT JOIN [ARM_CORE]..[ScheduleBookDay] b ON b.BID = t.BID
  WHERE
   b.ChannelID = c.ChannelID
  AND t.Active = 1
  AND b.TheDate >= GETDATE() - 1) AS [CBookCount],
  c.[Name],
  c.[ShortName],
  c.BgColour,
  c.Bookable,
  c.AssetType,
  c.[Mode],
  ISNULL(c.Active, 0) AS [Active],
  ISNULL(i.InstrID, 0) AS [InstrID],
  ISNULL(i.Active, 0) AS [InstrActive]
 FROM [ARM_CORE]..[ScheduleChannel] c
 LEFT JOIN [ARM_CORE]..[ScheduleInstruction] i ON i.ChannelID = c.ChannelID
 WHERE
  c.Mode = 'BOOKABLE'
 AND ISNULL(c.WorkstreamID, 0) = @WorkstreamID
 ORDER BY
  c.[Name]


END

GO

CREATE PROCEDURE X_ChannelEditor_3
 @WorkstreamID INT
AS
BEGIN
 SELECT
  w.WorkstreamID,
  (SELECT COUNT(ChannelID) FROM ScheduleChannel c WHERE c.WorkstreamID = w.WorkstreamID AND [Mode] = 'REGISTRATION') AS [RC],
  (SELECT COUNT(ChannelID) FROM ScheduleChannel c WHERE c.WorkstreamID = w.WorkstreamID AND [Mode] = 'BOOKABLE') AS [BC],
  (SELECT COUNT(ChannelID) FROM ScheduleChannel c WHERE c.WorkstreamID = w.WorkstreamID AND [Mode] = 'MANUAL') AS [MC]
 FROM [Workstream] w
 WHERE
  w.WorkstreamID = @WorkstreamID
END

GO

CREATE PROCEDURE X_ChannelEditor_2
 @Table NVARCHAR(150),
 @Column NVARCHAR(150)
AS
BEGIN
 SELECT
  DISTINCT
  CASE
   WHEN @Table = 'ScheduleChannel' AND @Column = 'Mode' THEN l.[Lookup]
   WHEN @Table = 'Asset' AND @Column = 'Type' THEN ISNULL(b.BookType, l.[Lookup])
  END AS [Lookup],
  CASE
   WHEN @Table = 'ScheduleChannel' AND @Column = 'Mode' THEN l.[Lookup]
   WHEN @Table = 'Asset' AND @Column = 'Type' THEN ISNULL(b.BookType, l.[Label])
  END AS [Label],
  l.[Order]
 FROM [ARM_CORE]..[A_LookUp] l
 LEFT JOIN [ARM_CORE]..[BookType] b ON b.AssetType = l.[Label]
 WHERE
  l.[Table] = @Table
 AND l.[Column] = @Column
 ORDER BY
  l.[Order],
  [Label]
END

GO

CREATE PROCEDURE X_ChannelEditor_1
AS
BEGIN
 SELECT
  DISTINCT
  WorkstreamID,
  [Name]
 FROM [ARM_CORE]..[Workstream]
 ORDER BY [Name]
END

GO

CREATE PROCEDURE X_ChannelDelete_1
 @ChannelID INT
AS
BEGIN
 DELETE FROM [ARM_CORE]..[ScheduleChannel] WHERE ChannelID = @ChannelID
END

GO

CREATE PROCEDURE X_ChannelBookingInfo_str_7
AS
BEGIN
 SELECT
  DISTINCT
  ISNULL([Type], '') AS [Type]
 FROM [ARM_CORE]..[NotificationTemplate]
 ORDER BY [Type]
END

GO

CREATE PROCEDURE X_ChannelBookingInfo_str_6
 @TemplateType NVARCHAR(255)
AS
BEGIN
 SELECT
  TemplateID,
  [Label]
 FROM [ARM_CORE]..[NotificationTemplate]
 WHERE
  ISNULL([Type], '') = @TemplateType
 ORDER BY [Label]
END

GO

CREATE PROCEDURE X_ChannelBookingInfo_str_5
 @ChannelID INT
AS
BEGIN
 SELECT
  TheText
 FROM [ARM_CORE]..[ScheduleInstruction]
 WHERE ChannelID = @ChannelID
END

GO

CREATE PROCEDURE X_ChannelBookingInfo_str_4
 @ChannelID INT
AS
BEGIN
 SELECT
  InstrID,
  ChannelID,
  ImageURL,
  HTML,
  Active
 FROM [ARM_CORE]..[ScheduleInstruction]
 WHERE ChannelID = @ChannelID
END

GO

CREATE PROCEDURE X_ChannelBookingInfo_str_3
 @ChannelID INT,
 @HTML BIT,
 @Active BIT,
 @TheText TEXT,

 @ConfirmationTemplate NVARCHAR(250),
 @CancellationTemplate NVARCHAR(250),
 @From NVARCHAR(250),
 @ReplyTo NVARCHAR(250),
 @CC NVARCHAR(250),
 @BCC NVARCHAR(250),
 @NothingAvailableText NVARCHAR(MAX)
AS
BEGIN
 MERGE [ARM_CORE]..[ScheduleInstruction] AS TARGET
 USING(
  SELECT DISTINCT
   c.ChannelID
  FROM [ARM_CORE]..[ScheduleChannel] c
  WHERE c.ChannelID = @ChannelID
 ) AS SOURCE
 ON TARGET.ChannelID = SOURCE.ChannelID
 WHEN NOT MATCHED BY TARGET
 THEN INSERT(ChannelID, HTML, Active, TheText) VALUES(@ChannelID, @HTML, @Active, @TheText)
 WHEN MATCHED
 THEN UPDATE SET TARGET.HTML = @HTML, Active = @Active, TheText = @TheText;

 UPDATE [ARM_CORE]..[ScheduleChannel]
 SET ConfirmationTemplate = @ConfirmationTemplate,
  CancellationTemplate = @CancellationTemplate,
  [From] = @From,
  ReplyTo = @ReplyTo,
  CC = @CC,
  BCC = @BCC,
  NothingAvailableText = @NothingAvailableText
 WHERE ChannelID = @ChannelID
END

GO

CREATE PROCEDURE X_ChannelBookingInfo_str_2
 @ChannelID INT
AS
BEGIN
 DELETE FROM ScheduleInstruction WHERE ChannelID = @ChannelID
END

GO

CREATE PROCEDURE X_ChannelBookingInfo_str_1
 @ChannelID INT
AS
BEGIN
 SELECT 
  c.[Name],
  c.ConfirmationTemplate, 
  c.CancellationTemplate, 
  c.Mode,
  ISNULL(c.[From], '') AS [FROM],
  ISNULL(c.ReplyTo, '') AS [ReplyTo],
  ISNULL(c.CC, '') AS [CC],
  ISNULL(c.BCC, '') AS [BCC],
  c.NothingAvailableText
 FROM [ARM_CORE]..[ScheduleChannel] c
 WHERE
  c.ChannelID = @ChannelID
END

GO

CREATE PROCEDURE X_ChannelBookingInfo_5
 @ChannelID INT
AS
BEGIN
 SELECT
  InstrID,
  TheText
 FROM [ARM_CORE]..[ScheduleInstruction]
 WHERE
  ChannelID = @ChannelID
END

GO

CREATE PROCEDURE X_ChannelBookingInfo_4
 @ChannelID INT
AS
BEGIN
 SELECT
  InstrID,
  ChannelID,
  ImageURL,
  HTML,
  Active
 FROM [ARM_CORE]..[ScheduleInstruction]
 WHERE
  ChannelID = @ChannelID
END

GO

CREATE PROCEDURE X_ChannelBookingInfo_3
 @ChannelID INT,
 @TheText TEXT,
 @ConfirmationTemplateID INT,
 @CancellationTemplateID INT,
 @From NVARCHAR(250),
 @ReplyTo NVARCHAR(250),
 @CC NVARCHAR(250),
 @BCC NVARCHAR(250),
 @NothingAvailableText NVARCHAR(MAX)
AS
BEGIN
 MERGE [ARM_CORE]..[ScheduleInstruction] AS TARGET
 USING(
  SELECT DISTINCT
   c.ChannelID
  FROM [ARM_CORE]..[ScheduleChannel] c
  WHERE c.ChannelID = @ChannelID
 ) AS SOURCE
 ON TARGET.ChannelID = SOURCE.ChannelID
 WHEN NOT MATCHED BY TARGET
 THEN INSERT(ChannelID, TheText) VALUES(@ChannelID, @TheText)
 WHEN MATCHED
 THEN UPDATE SET TheText = @TheText;

 UPDATE [ARM_CORE]..[ScheduleChannel]
 SET ConfirmationTemplateID = @ConfirmationTemplateID,
  CancellationTemplateID = @CancellationTemplateID,
  [From] = @From,
  ReplyTo = @ReplyTo,
  CC = @CC,
  BCC = @BCC,
  NothingAvailableText = @NothingAvailableText
 WHERE ChannelID = @ChannelID
END

GO

CREATE PROCEDURE X_ChannelBookingInfo_2
 @ChannelID INT
AS
BEGIN
 DELETE FROM [ARM_CORE]..[ScheduleInstruction] WHERE ChannelID = @ChannelID
END

GO

CREATE PROCEDURE X_ChannelBookingInfo_1
 @ChannelID INT
AS
BEGIN
 SELECT 
  c.[Name],
  ISNULL(c.ConfirmationTemplateID, 0) AS [ConfirmationTemplateID],
  ISNULL(c.CancellationTemplateID, 0) AS [CancellationTemplateID],
  ISNULL(t.[Type], '') AS [ConfirmType],
  ISNULL(x.[Type], '') AS [CancelType],
  c.Mode,
  ISNULL(c.[From], '') AS [FROM],
  ISNULL(c.ReplyTo, '') AS [ReplyTo],
  ISNULL(c.CC, '') AS [CC],
  ISNULL(c.BCC, '') AS [BCC],
  c.NothingAvailableText
 FROM [ARM_CORE]..[ScheduleChannel] c
 LEFT JOIN [ARM_CORE]..[NotificationTemplate] t ON t.TemplateID = c.ConfirmationTemplateID
 LEFT JOIN [ARM_CORE]..[NotificationTemplate] x ON x.TemplateID = c.CancellationTemplateID
 WHERE
  c.ChannelID = @ChannelID
END

GO

CREATE PROCEDURE X_ChannelAdd_1
 @Name NVARCHAR(50),
 @ShortName NVARCHAR(50),
 @BgColour NVARCHAR(10),
 @AssetType NVARCHAR(50),
 @Mode NVARCHAR(250),
 @Bookable BIT,
 @WorkstreamID INT
AS
BEGIN
 INSERT INTO [ARM_CORE]..[ScheduleChannel](
  [Name],
  ShortName,
  BgColour,
  AssetType,
  Mode,
  Bookable,
  WorkstreamID
 )
 VALUES(
  @Name,
  @ShortName,
  @BgColour,
  @AssetType,
  @Mode,
  @Bookable,
  @WorkstreamID
 )
END

GO

CREATE PROCEDURE X_CancellationSelect_2
AS
BEGIN
 SELECT
  DISTINCT
  ISNULL([Type], '') AS [Type]
 FROM [ARM_CORE]..[NotificationTemplate]
 ORDER BY [Type]
END

GO

CREATE PROCEDURE X_CancellationSelect_1
 @NewCanTemplateType NVARCHAR(255)
AS
BEGIN
 SELECT
  TemplateID,
  [Label]
 FROM [ARM_CORE]..[NotificationTemplate] n
 WHERE ISNULL(n.[Type], '') = @NewCanTemplateType
 ORDER BY [Label]
END


GO

CREATE PROCEDURE X_Bookmark_2
 @When NVARCHAR(255),
 @Type NVARCHAR(255),
 @Name NVARCHAR(255),
 @Value NVARCHAR(4000)
AS
BEGIN
 INSERT INTO [ARM_CORE]..[A_RequestCapture]([When], [Type], [Name], [Value])
 VALUES(@When, @Type, @Name, @Value)
END

GO

CREATE PROCEDURE X_Bookmark_1
 @ViewID INT
AS
BEGIN
 SELECT
  ISNULL(ItemIDRef, 'AssetID') AS ItemIDRef,
  ISNULL([SQL], '') AS [SQL]
 FROM [ARM_CORE]..[Views]
 WHERE
  ViewID = @ViewID
END

GO

CREATE PROCEDURE X_BAreaUpdate_1
 @BAreaID INT,
 @NewBAreaName NVARCHAR(255),
 @OldBAreaName NVARCHAR(255),
 @Internal BIT
AS
BEGIN
 IF ISNULL(@NewBAreaName, '') <> ISNULL(@OldBAreaName, '')
 BEGIN
  UPDATE [ARM_CORE]..[BArea]
  SET 
   BArea = @NewBAreaName,
   Internal = @Internal
  WHERE BAreaID = @BAreaID

  UPDATE [ARM_CORE]..[AssetCache]
  SET 
   BARea = @NewBAreaName
  WHERE
   BArea = @OldBAreaName

  UPDATE [ARM_CORE]..[Asset]
  SET
   BArea = @NewBAreaName
  WHERE
   BArea = @OldBAreaName
 END

 UPDATE [ARM_CORE]..[BArea]
 SET Internal = @Internal
 WHERE BAreaID = @BAreaID
END


GO

CREATE PROCEDURE X_BAreaGetComments_1
 @BArea NVARCHAR(255),
 @AssetType NVARCHAR(50),
 @BLocation NVARCHAR(255)
AS
BEGIN
 SELECT
  com.CommentID,
  com.AssetID,
  ass.[Owner],
  com.[When],
  com.[Who],
  com.Comment
 FROM [ARM_CORE]..Comment com
 LEFT JOIN [ARM_CORE]..[Asset] ass ON ass.AssetID = com.AssetID
 WHERE
  com.AssetID IN(
   SELECT DISTINCT c.AssetID
   FROM ARM_CORE..Asset c
   LEFT JOIN ARM_CORE..BArea b ON c.BArea = b.BArea
   LEFT JOIN ARM_CORE..AssetCache a ON a.AssetID = c.AssetID
   WHERE 
    CASE WHEN @BArea = 'all' THEN '' ELSE ISNULL(c.BArea, '') END LIKE CASE WHEN @BArea = 'all' THEN '' ELSE '%' + @BArea + '%' END
   AND CASE WHEN @BArea = 'inscope' THEN b.Internal ELSE 0 END = 0
   AND CASE WHEN @BLocation <> '' THEN ISNULL(a.[Location], c.[Location]) ELSE '' END = CASE WHEN @BLocation <> '' THEN @BLocation ELSE '' END
   AND c.[Type] LIKE '%' + @AssetType + '%'
  )
END

GO

CREATE PROCEDURE X_BAreaEditor_2
AS
BEGIN
 SELECT
  b.BAreaID,
  b.BArea,
  b.Internal,
  (SELECT COUNT(d.AssetID) FROM [ARM_CORE]..[Asset] d WHERE d.[BArea] = b.BArea) AS [TBC]
 FROM [ARM_CORE]..[BArea] b
 WHERE
  ISNULL(b.Internal, 0) = 0
 ORDER BY b.BArea
END

GO

CREATE PROCEDURE X_BAreaEditor_1
AS
BEGIN
SELECT
 'Not Listed' AS [BArea],
 (SELECT COUNT(d.AssetID)
 FROM [ARM_CORE]..[Asset] d
 WHERE d.[BArea] NOT IN(
  SELECT b.BArea
  FROM [ARM_CORE]..[BArea] b
 )) AS [TBC]
END

GO

CREATE PROCEDURE X_BAreaDelete_1
 @BAreaID INT
AS
BEGIN
 DELETE FROM [ARM_CORE]..[BArea] WHERE BAreaID = @BAreaID
END

GO

CREATE PROCEDURE X_BAreaAdd_1
 @BArea NVARCHAR(255),
 @Internal BIT
AS
BEGIN
 INSERT INTO [ARM_CORE]..[BArea](BArea, Internal) VALUES(@BArea, @Internal)
END

GO

CREATE PROCEDURE X_AutoNotificationsRunNow2_1
 @AutoNotificationID INT
AS
BEGIN
 UPDATE [ARM_CORE]..[AutoNotification]
 SET InProgress = 1
 WHERE AutoNotificationID = @AutoNotificationID
END

GO

CREATE PROCEDURE X_AutoNotificationsRunNow_1
 @AutoNotificationID INT
AS
BEGIN
 UPDATE [ARM_CORE]..[AutoNotification]
 SET InProgress = 1
 WHERE AutoNotificationID = @AutoNotificationID
END

GO

CREATE PROCEDURE X_AutoNotifications2_3
AS
BEGIN
 SELECT
  DISTINCT
  ISNULL(TaskGroup, '') AS [TaskGroup]
 FROM [ARM_CORE]..[AutoNotification]
 ORDER BY [TaskGroup]
END

GO

CREATE PROCEDURE X_AutoNotifications2_2
 @Active BIT,
 @AutoNotificationID INT
AS
BEGIN
 UPDATE [ARM_CORE]..[AutoNotification]
 SET
  Active = @Active
 WHERE
  AutoNotificationID = @AutoNotificationID
END

GO

CREATE PROCEDURE [dbo].[X_AutoNotifications2_1]
 @TaskGroup NVARCHAR(255)
AS
BEGIN
 SELECT 
  AutoNotificationID, 
  t.[Name], 
  t.LastRun, 
  t.Active, 
  ISNULL(t.InProgress,0) as Inprogress, 
  t.Weekly, 
  AudienceFrom, 
  Throttle, 
  ISNULL(t.quietmode,0) as quietmode, 
  ISNULL(t.important,0) as important, 
  ISNULL(t.readReceipt,0) as readreceipt, 
  AudiencePropertyID, 
  DateProperty, 
  m.templateID, 
  m.Label as NotificationTemplate, 
  t.[DayCountTriggers],
  m.[Type] as [TemplateType],
  ISNULL(ff.[WorkstreamID],'') as WorkstreamID, 
  ISNULL(ff.[CollectionClassID],'') as CollectionClassID, 
  ISNULL(f.[CollectionID],'') as CollectionID, 
  ISNULL(f.[Type],'') as CollectionType,
  TraceLog, f.Name as CollectionName, 
  ISNULL(ff.Name,'') as CollectionClassName, 
  c.Name as ChannelName , 
  ISNULL(PayloadSQL, '') AS PayLoadSQL, 
  ISNULL(Query, '') AS Query 
 FROM [ARM_CORE]..[AutoNotification] t  
 LEFT JOIN [ARM_CORE]..[NotificationTemplate] m on m.TemplateID = t.TemplateID  
 LEFT JOIN [ARM_CORE]..[ScheduleChannel] c on c.ChannelID = t.AudiencePropertyID  
 LEFT JOIN [ARM_CORE]..[A_Collection] f on f.CollectionID = t.AudiencePropertyID  
 LEFT JOIN [ARM_CORE]..[A_CollectionClass] ff on ff.CollectionClassID = f.CollectionClassID   
 WHERE ISNULL(t.[Taskgroup],'') = @TaskGroup  
 ORDER BY 
  t.[ORDER], 
  t.[Name]
END

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_ScriptDashItemFn_1] 
@DATABASE_REF NVARCHAR(255),
@TABLEREF NVARCHAR(255)--,
--@Where NVARCHAR(MAX)
AS
BEGIN

DECLARE @sqlStr NVARCHAR(max) = '
   
         Use '+@DATABASE_REF+'; SELECT s.[name] AS [Column], t.name as [Type],   
		 	columnproperty(s.id, s.[name] ,''IsIdentity'') as IsIdentity,	s.[colorder]   
		 FROM [syscolumns] s 
		 LEFT JOIN sys.[Tables] x on x.object_id =s.id
		 LEFT JOIN sys.[types] t on t.system_type_id = s.xtype   
		 WHERE s.id = object_id(''['+@TABLEREF+']'') and IsNull(t.[name],'''') <> ''sysname'' 
		 Order by s.[colorder], s.[name]

   ';
   EXEC(@sqlStr);
END;
  


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_ScriptDashItemFn_2] 
@DATABASE_REF NVARCHAR(255),
@TABLEREF NVARCHAR(255),
@Where NVARCHAR(MAX)
AS
BEGIN

DECLARE @sqlStr NVARCHAR(max) = '
   
     select x.* from ['+@DATABASE_REF+']..['+@TABLEREF+'] x '+@Where+'
   ';
   EXEC(@sqlStr);
END;




GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_ScriptDashItemFn_3] 
@DashBoardID INT,
@ItemID INT,
@ItemType NVARCHAR(50)
AS
BEGIN
select * from [ARM_CORE]..[A_DashboardItem] 
WHERE DashBoardID = @DashBoardID and ItemID = @ItemID and ItemType = @ItemType
END;




GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_ScriptFn_1] 
@DATABASE_REF NVARCHAR(255),
@TABLEREF NVARCHAR(255)
AS
BEGIN

DECLARE @sqlStr NVARCHAR(max) = '
   
SELECT s.[name] AS [Column], t.name as [Type],   
	columnproperty(s.id, s.[name] ,''IsIdentity'') as IsIdentity,	s.[colorder]   
FROM [syscolumns] s 
LEFT JOIN sys.[Tables] x on x.object_id =s.id
LEFT JOIN sys.[types] t on t.system_type_id = s.xtype   
WHERE s.id = object_id(''['+@TABLEREF+']'') and IsNull(t.[name],'''') <> ''sysname'' 
Order by s.[colorder], s.[name] 

   ';
   EXEC(@sqlStr);
END;
  

         
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_ScriptFn_2] 
@DATABASE_REF NVARCHAR(255),
@TABLEREF NVARCHAR(255),
@WHERE NVARCHAR(max)
AS
BEGIN

DECLARE @sqlStr NVARCHAR(max) = '
   
 select x.* from ['+@DATABASE_REF+']..['+@TABLEREF+'] x '+@WHERE+'    

   ';
   EXEC(@sqlStr);
END;
  


GO
CREATE PROCEDURE X_SearchAdvanced_1
AS
BEGIN
	select distinct ApplicationID as [KEY] from [ARM_CORE]..[AppAstToBe]  order by [ApplicationID] ASC
END

GO

CREATE PROCEDURE X_SearchByApplication_3
AS
BEGIN
	select Lookup, Label from [ARM_CORE]..[A_Lookup] where [Table] = 'Internal' and [Column] = 'OsFilter' Order By [Order] 
END

GO

CREATE PROCEDURE X_SearchByApplication_2(@scope nvarchar(255),@AppSearchTerm nvarchar(max),@inScopeJoin nvarchar(max),@liveSql nvarchar(max),@inScopeSQL nvarchar(max),@os nvarchar(max))
AS
BEGIN
	DECLARE @SQL varchar(MAX)
	SET @SQL = '
		select distinct RTRIM(s.[ApplicationID]) AS [KEY],IsNull(g.AppGroupName,s.[ApplicationID]) AS [Friendly], i.LocalID,
				(select count(distinct a.AssetID) from [ARM_CORE]..Asset a LEFT JOIN [ARM_CORE]..'+@scope+' z  on z.AssetID = a.AssetID '+@inScopeJoin+' where z.[ApplicationID] = s.[ApplicationID] '+@liveSql+' '+@inScopeSQL+' and a.[OS] like '''+@os+'%'' ) AS IC
				from [ARM_CORE]..'+@scope+' s
				LEFT JOIN [ARM_CORE]..Application i on i.[ApplicationID] = s.[ApplicationID]
				LEFT JOIN [ARM_CORE]..AppGroup g on g.AppGroupID = i.AppGroupID
				where s.[ApplicationID] like '''+@AppSearchTerm+'%''
				order by [KEY] ASC 
	'
	exec (@sql)
END

GO
CREATE PROCEDURE X_SearchByApplication_1(@scope nvarchar(255),@AppSearchTerm nvarchar(max))
AS
BEGIN
	DECLARE @SQL varchar(MAX)
	SET @SQL = '
		select  Count(*) AS RC from [ARM_CORE]..'+@scope+' s where s.[ApplicationID] like ''%'+@AppSearchTerm+'%''  
	'
	exec (@sql)
END

GO

CREATE PROCEDURE X_SearchByName_2(@SearchTerm nvarchar(255))
AS
BEGIN

		DECLARE @SQL nvarchar(max);
		SET @SQL='
			SELECT   [UserID],[UserName],[Email],[Department],[JobTitle]   FROM [ARM_CORE]..[User] u  where IsNull(u.[UserName],'') like ''%'+@SearchTerm+'%'' or IsNull(u.[Email],'') like ''%'+@SearchTerm+'%'' order by userName 
		'
		EXEC(@SQL)
		
END

GO
CREATE PROCEDURE X_SearchByName_1(@SearchTerm nvarchar(255),@sType nvarchar(255),@dType nvarchar(255))
AS
BEGIN

		DECLARE @SQL nvarchar(max);
		SET @SQL='
			SELECT c.[AssetID] AS AssetID,
			IsNull(a.[Owner], c.[Owner]) as Owner,
			IsNull(a.[Email],c.[Email]) as Email,
			IsNull(a.[Location],c.[Location]) As Location,
			IsNull(a.[Association],c.[Association]) As Association,
			c.UserID,
			IsNull(a.[BArea],c.[BArea]) As BArea,
 			c.[Status], c.[Type], IsNull(a.[AssetID],'''') AS Confirmed,
			IsNull(s.[EngDeployed],0) AS EngDeployed, s.[W7], v.Email as VEmail, v.AssetId as VID
			,(select TOP 1 h.[Label] from  [ARM_CORE]..[ScheduleDeployRun] h LEFT JOIN [ARM_CORE]..[ScheduleDeployRunAsset] r on h.RunID = r.RunID where r.AssetID = c.[AssetID] and CAST(h.RunDate as NVARCHAR(255)) >= '+CAST(GETDATE() AS NVARCHAR(255))+' order by h.Rundate Asc ) AS [myLabelAsc] 
			,(select TOP 1 h.[Label] from  [ARM_CORE]..[ScheduleDeployRun] h LEFT JOIN [ARM_CORE]..[ScheduleDeployRunAsset] r on h.RunID = r.RunID where r.AssetID = c.[AssetID] and CAST(h.RunDate as NVARCHAR(255)) <= '+CAST(GETDATE() AS NVARCHAR(255))+' order by h.Rundate Desc ) AS [myLabelDesc]
			FROM [ARM_CORE]..[Asset] c 
			LEFT JOIN [ARM_CORE]..[AssetCache] a on a.AssetID = c.AssetID
			LEFT JOIN [ARM_CORE]..[AssetStatus] s ON s.AssetID = c.AssetID
			LEFT JOIN [ARM_CORE]..[VIP] v ON v.AssetID = c.[AssetID]
			where (IsNull(a.[Owner],c.[Owner]) like ''%'+@SearchTerm+'%''  or IsNull(a.[Email],c.[Email]) like ''%'+@SearchTerm+'%''  ) and c.[TYPE] like ''%'+@sType+'%''
			and  IsNull(s.[EngDeployed],0) <> '+@dType+'
			Order by AssetID  	
		'
		EXEC(@SQL)
		
END

GO
CREATE PROCEDURE X_SimpleInstallList_1(@Context nvarchar(500) ='',@AppID nvarchar(255),@AreaFilter nvarchar(500) = '')
AS
BEGIN

		DECLARE @SQL nvarchar(max);
		SET @SQL='
			select top 10  a.[AssetID], IsNull(a.[Owner],'''') AS Owner, IsNull(a.[Email],'''') AS Email, a.[Location], a.[TYPE], a.[Model], a.[AssetTag], a.[heartbeat],
		(Select COUNT(f.AssetID) from [ARM_CORE]..['+@Context+'] f LEFT JOIN [ARM_CORE]..[Asset] t  on t.AssetID = f.AssetID where f.[ApplicationID] = '+@AppID+' and t.Live = 1 '+@AreaFilter+') as TotalCount
		from [ARM_CORE]..['+@Context+']  e LEFT JOIN [ARM_CORE]..[Asset] a  on a.AssetID = e.AssetID
		where e.[ApplicationID] = '+@AppID+' '+@AreaFilter+' and a.Live = 1 Order by a.[Owner] 
		'
		EXEC(@SQL)
		
END

GO

CREATE PROCEDURE X_SliceNav_3
AS
BEGIN
	select distinct TemplateUsed from [ARM_CORE]..[NotificationLog] order by TemplateUsed 
END

GO

CREATE PROCEDURE X_SliceNav_2(@Slice nvarchar(255),@SearchTerm nvarchar(500) = '')
AS
BEGIN
DECLARE @SQL nvarchar(max)
SET @SQL ='
	select distinct a.Location from [ARM_CORE]..[Asset] a where a.'+@Slice+' = '+@SearchTerm+'
'
	EXEC(@SQL)
END

GO
CREATE PROCEDURE X_SliceNav_1
AS
BEGIN
	select a.FlagID, a.Name, a.FlagOrder from AssetFlag a order by a.FlagOrder, a.Name
END

GO

CREATE PROCEDURE X_SlotAdd_4
AS
BEGIN
	select [ChannelID], [Name] from [ARM_CORE]..[ScheduleChannel] where bookable = 0 order by [Name]
END

GO

CREATE PROCEDURE X_SlotAdd_3(@ChannelID INT)
AS
BEGIN
	select [Name], [ShortName] from [ARM_CORE]..[ScheduleChannel] where [ChannelID]=@ChannelID
END

GO

CREATE PROCEDURE X_SlotAdd_2
AS
BEGIN
	select [ChannelID], [Name], [ShortName] from [ARM_CORE]..[ScheduleChannel] where bookable = 0 order by [Name]
END

GO
CREATE PROCEDURE X_SlotAdd_1(@DepDate Date)
AS
BEGIN
	select r.RunID, r.ChannelID, c.Shortname, c.WorkstreamID, (Select Count (AssetID) from [ARM_CORE]..[ScheduleDeployRunAsset] z where z.RunID = r.RunID) As AC, r.SlotID, r.Status, r.RunDate, r.Label  from [ARM_CORE]..[ScheduleDeployRun] r LEFT JOIN [ARM_CORE]..[ScheduleChannel] c ON c.ChannelID = r.ChannelID where RunDate =  @DepDate   order by Label 		
END

GO
CREATE PROCEDURE X_SlotAddAsset_1(@Label nvarchar(255))
AS
BEGIN

	select r.RunID, (Select Count (AssetID) from [ARM_CORE]..[ScheduleDeployRunAsset] z where z.RunID = r.RunID) As AC, r.SlotID, r.Status, r.RunDate, r.Label  from [ARM_CORE]..[ScheduleDeployRun] r where Label =  @Label
		
END

GO

CREATE PROCEDURE X_SlotMove_3
AS
BEGIN
	select [ChannelID], [Name] from [ARM_CORE]..[ScheduleChannel] where Bookable = 0 order by [Name]

END

GO

CREATE PROCEDURE X_SlotMove_2
AS
BEGIN
	select [DayTxt], [SlotID], CONVERT (date, [Date]) AS TheDate  from [ARM_CORE]..[ScheduleSlot] order by [Date] ASC

END

GO
CREATE PROCEDURE X_SlotMove_1(@DepRef nvarchar(255))
AS
BEGIN
	select r.RunID, r.FixedPoint, r.ChannelID, (Select Count (AssetID) from [ARM_CORE]..[ScheduleDeployRunAsset] z where z.RunID = r.RunID) As AC, r.SlotID, r.Status, r.RunDate, r.Label  from [ARM_CORE]..[ScheduleDeployRun] r where r.Label =  @DepRef   order by Label 

END

GO
CREATE PROCEDURE X_SlotPinToggle_1(@f int=0,@slotID nvarchar(255))
AS
BEGIN
	update [ARM_CORE]..[ScheduleSlot] set FixedPoint = @f where SlotID =@slotID	
END

GO

CREATE PROCEDURE X_Slots_20(@WorkStreamID INT)
AS
BEGIN
	select ws.[SlotStatusID], ws.[Label], ws.[MapToCollectionID] , c.[Name] as [CollectionName], IsNull(ws.[Deployed],0) as Deployed, IsNull(ws.[Failed],0) as Failed,
	IsNull(ws.[RemoveFromSlot],0) as [RemoveFromSlot], ws.[SQLTrigger] , ws.[WorkstreamID]  , ws.[Order] 
	from [ARM_CORE]..[A_SlotStatusDefinition] ws 
	LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionID = ws.[MapToCollectionID]
	where ws.WorkstreamID = @WorkStreamID
	order by ws.[Order]
END

GO

CREATE PROCEDURE X_Slots_19(@WorkStreamID INT,@Auth_Role_Id INT)
AS
BEGIN
	SELECT [ButtonID],IsNull([ButtonTitle],'') as [ButtonTitle],IsNull([Icon],'fa-file-code-o') as [Icon], IsNull([Label],'') as Label, IsNull([Batch],0) as [Batch],
		 IsNull([URL],'#') as [url],IsNull([Class],'btn-primary') as [Class], IsNull([WorkstreamID],0) as [WorkstreamID], IsNull([Context],'Run') as [Context],
		 IsNull([Order],0) as [Order], IsNull([Active],0) as [Active],IsNull([info],'') as Info, IsNull(MinRoleID,0) as MinRoleID
		 FROM [ARM_CORE]..[Button] where IsNull([Active],0) = 1 and (IsNull([WorkstreamID],0) = 0 or IsNull([WorkstreamID],0) = @WorkStreamID) and IsNull(MinRoleID,0) <= @Auth_Role_Id and (IsNull([Context],'Run') like 'Field#%' or IsNull([Context],'Run') like 'File#%') and [Type] = 'Slot'
		 Order by [Order]
END

GO

CREATE PROCEDURE X_Slots_18(@WorkStreamID INT,@Auth_Role_Id INT)
AS
BEGIN
	SELECT [ButtonID],IsNull([ButtonTitle],'') as [ButtonTitle],IsNull([Icon],'fa-file-code-o') as [Icon], IsNull([Label],'') as Label, IsNull([Batch],0) as [Batch],
		 IsNull([URL],'#') as [url],IsNull([Class],'btn-primary') as [Class], IsNull([WorkstreamID],0) as [WorkstreamID], IsNull([Context],'Run') as [Context], 
		 IsNull([Order],0) as [Order], IsNull([Active],0) as [Active],IsNull([info],'') as Info, IsNull(MinRoleID,0) as MinRoleID, IsNull(Modal,'') as Modal 
		 FROM [ARM_CORE]..[Button] where IsNull([Active],0) = 1 and (IsNull([WorkstreamID],0) = 0 or IsNull([WorkstreamID],0) = @WorkStreamID) and IsNull(MinRoleID,0) <= @Auth_Role_Id and IsNull([Context],'Run') = 'Run' and [Type] = 'Slot' 
		 Order by [Order]
END

GO

CREATE PROCEDURE X_Slots_17(@DepRef nvarchar(255))
AS
BEGIN
	select distinct r.RunID, IsNull(r.Status,'') as SlotStatus, IsNull(d.BID,0) as BID, d.Label, d.ChannelID, IsNull(sc.[Mode],'') as Mode, IsNull(sc.[WorkstreamID],0) as WorkstreamID,  r.OrderRef, IsNull(c.[Type],'Desktop') AS AssetType,
			 IsNull(r.[ReplaceWith],'') AS ReplaceWith,
			 IsNull ( (select AssetID from [ARM_CORE]..[Asset] where AssetID = r.[ReplaceWith]),'No' ) as ReplaceExists,
			 IsNull ( (select Model from [ARM_CORE]..[Asset] where AssetID = r.[ReplaceWith]),IsNull(m.ToBeModel,'') ) as NewModel,
			 IsNull(r.Comment,'') as Comment,  0 as EngDeployed,
			 c.*,
			 d.RunDate, t.Label as  TimeLabel, t.MaxBooking, t.Duration, t.Active
			 ,ssd.SlotStatusID, ssd.[Deployed] as [IsDeployed], ssd.[Failed] as [IsFailed]
			 ,IsNull(m.ToBeModel,'') as ToBeModel
			 ,IsNull(STUFF(( select '^' + CASE when IsNull(g.[CollectionID],0) = 0 then '' else g.[Name]+':'+g.[Colour] end from [ARM_CORE]..[A_Collection] g 
			 		LEFT JOIN [ARM_CORE]..[A_CollectionItem] f ON f.[CollectionID] = g.[CollectionID] where IsNull(g.[Marker],0) = 1 and f.ItemID = r.AssetID 
			 		FOR XML PATH('')  
			 			), 1, 1, '') + '','') as Markers
			 ,IsNull(STUFF(( select '^' + CASE when IsNull(g.[CollectionID],0) = 0 then '' else g.[Name]+':'+g.[Colour] end from [ARM_CORE]..[A_Collection] g 
			 		LEFT JOIN [ARM_CORE]..[A_CollectionItem] f ON f.[CollectionID] = g.[CollectionID] where IsNull(g.[Marker],0) = 1 and f.ItemID = c.UserID 
			 		FOR XML PATH('')   
			 			), 1, 1, '') + '','') as UserMarkers 
			 from [ARM_CORE]..[ScheduleDeployRunAsset] r  LEFT JOIN [ARM_CORE]..[Asset] c ON  c.AssetID = r.AssetID  
			 LEFT JOIN [ARM_CORE]..[ScheduleDeployRun] d ON r.RunID = d.RunID  
			 LEFT JOIN [ARM_CORE]..[ScheduleChannel] sc ON sc.ChannelID = d.ChannelID 
			 LEFT JOIN [ARM_CORE]..[A_SlotStatusDefinition] ssd on ssd.[Label] = IsNull(r.Status,'') and ssd.WorkstreamID = sc.[WorkstreamID]
			 LEFT JOIN [ARM_CORE]..ModelToBe m ON m.AssetID = r.AssetID 
			 LEFT JOIN [ARM_CORE]..[ScheduleBookDay] bd on bd.RunID = d.RunID 
			 LEFT JOIN [ARM_CORE]..[ScheduleBooking] b on b.RunID = d.RunID and b.AssetID = r.AssetID 
			 LEFT Join [ARM_CORE]..[ScheduleTimeSlot] t on t.TID = b.TID 
			 where d.Label = @DepRef
			 Order by TimeLabel, c.[Owner], c.AssetID
END

GO

CREATE PROCEDURE X_Slots_16(@DepRef nvarchar(255))
AS
BEGIN
	select IsNull(sc.Mode,'') as Mode from [ARM_CORE]..[ScheduleDeployRun] d LEFT JOIN [ARM_CORE]..[ScheduleChannel] sc ON sc.ChannelID = d.ChannelID where d.Label = @DepRef
END

GO

CREATE PROCEDURE X_Slots_15
AS
BEGIN
	SELECT [Table],[Column],IsNull([Label],[Lookup]) as [Label], [Lookup] from [ARM_CORE]..[A_Lookup] where [Table] = 'ScheduleDeployRunAsset' and [Column] = 'Status'   order by [Order]
END

GO

CREATE PROCEDURE X_Slots_14(@Run_ID INT)
AS
BEGIN
	select 
				(select count(r.AssetID) from [ARM_CORE]..[ScheduleDeployRunAsset] r 
					LEFT JOIN [ARM_CORE]..[ScheduleDeployRun] d on d.RunID = r.[RunID]
					LEFT JOIN [ARM_CORE]..[ScheduleChannel] c on c.[ChannelID] = d.[ChannelID]
					LEFT JOIN [ARM_CORE]..[A_SlotStatusDefinition] ssd on ssd.[Label] = IsNull(r.Status,'') and ssd.WorkstreamID = c.WorkstreamID where r.RunID = @Run_ID and IsNull(ssd.[Failed],0) = 1
				) AS NF, 
				(select count(r.AssetID) from [ARM_CORE]..[ScheduleDeployRunAsset] r
					LEFT JOIN [ARM_CORE]..[ScheduleDeployRun] d on d.RunID = r.[RunID]
					LEFT JOIN [ARM_CORE]..[ScheduleChannel] c on c.[ChannelID] = d.[ChannelID]
					LEFT JOIN [ARM_CORE]..[A_SlotStatusDefinition] ssd on ssd.[Label] = IsNull(r.Status,'') and ssd.WorkstreamID = c.WorkstreamID where r.RunID = @Run_ID and IsNull(ssd.[Deployed],0) = 1
				) AS DC,  
				(select count(r.AssetID) from [ARM_CORE]..[ScheduleDeployRunAsset] r where r.RunID = @Run_ID and IsNull(r.[replaceWith],'') <> '' 
				) AS RC
END

GO

CREATE PROCEDURE X_Slots_13(@Run_ID INT)
AS
BEGIN
	select (select count(r.AssetID) from [ARM_CORE]..[ScheduleDeployRunAsset] r LEFT JOIN [ARM_CORE]..[A_SlotStatusDefinition] ssd on ssd.[Label] = IsNull(r.Status,'') where r.RunID = @Run_ID and IsNull(ssd.[Failed],0) = 1) AS NF,
	(select count(r.AssetID) from [ARM_CORE]..[ScheduleDeployRunAsset] r LEFT JOIN [ARM_CORE]..[A_SlotStatusDefinition] ssd on ssd.[Label] = IsNull(r.Status,'') where r.RunID = @Run_ID and IsNull(ssd.[Deployed],0) = 1) AS DC, 
	(select count(r.AssetID) from [ARM_CORE]..[AssetStatus] a left join [ARM_CORE]..[ScheduleDeployRunAsset] r on r.AssetID = a.AssetID  where r.RunID = @Run_ID and IsNull(a.[replaceWith],'') <> '') AS RC  
END

GO

CREATE PROCEDURE X_Slots_12(@AUTH_ROLE_ID INT)
AS
BEGIN
	SELECT [ButtonID],IsNull([ButtonTitle],'') as [ButtonTitle],IsNull([Icon],'fa-file-code-o') as [Icon],
		 IsNull([URL],'') as [url],IsNull([Class],'btn-primary') as [Class], IsNull([WorkstreamID],0) as [WorkstreamID],
		 IsNull([Order],0) as [Order], IsNull([Active],0) as [Active], IsNull([MinRoleID],0) as  MinRoleID
		 FROM [ARM_CORE]..[Button] where IsNull([Active],0) = 1 and IsNull([WorkstreamID],0) = 0 and IsNull([Context],'Run') = 'Day' and IsNull([MinRoleID],0) <= @AUTH_ROLE_ID
		 Order by [Order] 
END

GO
CREATE PROCEDURE X_Slots_11(@DepDate Date)
AS
BEGIN
	select s.SlotID, s.[DayTxt], s.[FixedPoint], s.[Date] from [ARM_CORE]..[ScheduleSlot] s where s.Date = convert(date,getdate(),112)
END

GO

CREATE PROCEDURE X_Slots_10(@DepDate Date)
AS
BEGIN
	select s.SlotID, s.[DayTxt], s.[FixedPoint] from [ARM_CORE]..[ScheduleSlot] s where s.Date = @DepDate
END

GO

CREATE PROCEDURE X_Slots_9(@DepDate Date)
AS
BEGIN
	select r.RunID, IsNull(b.BID,0) AS BID, r.FixedPoint, r.channelID, cid.Mode, cid.ShortName, cid.BgColour, IsNull(cid.workstreamID,0) as workstreamID,
			 (Select Count (AssetID) from [ARM_CORE]..[ScheduleDeployRunAsset] z where z.RunID = r.RunID) As AC, r.SlotID, IsNull(r.Status,'WAIT') as Status, r.RunDate, r.Label
			 from [ARM_CORE]..[ScheduleDeployRun] r LEFT JOIN [ARM_CORE]..[ScheduleBookDay] b on b.RunID = r.RunID LEFT JOIN [ARM_CORE]..[ScheduleChannel] cid ON cid.ChannelID = r.channelID
			 where r.[RunDate] = @DepDate order by cid.Shortname, Label
END

GO
CREATE PROCEDURE X_Slots_8(@DepRef nvarchar(255))
AS
BEGIN
	select RunDate, RunID from [ARM_CORE]..[ScheduleDeployRun] where [Label] = @DepRef
END

GO

CREATE PROCEDURE X_Slots_7(@DepDate Date)
AS
BEGIN
	select r.RunID, IsNull(b.BID,0) AS BID, r.FixedPoint, r.channelID, cid.Mode, cid.ShortName, cid.BgColour, IsNull(cid.workstreamID,0) as workstreamID, (Select Count (AssetID) from [ARM_CORE]..[ScheduleDeployRunAsset] z where z.RunID = r.RunID) As AC, r.SlotID, IsNull(r.Status,'WAIT') as Status, r.RunDate, r.Label  from [ARM_CORE]..[ScheduleDeployRun] r LEFT JOIN [ARM_CORE]..[ScheduleBookDay] b on b.RunID = r.RunID LEFT JOIN [ARM_CORE]..[ScheduleChannel] cid ON cid.ChannelID = r.channelID where r.[RunDate] =  @DepDate   order by cid.Shortname, Label
END

GO

CREATE PROCEDURE X_Slots_6
AS
BEGIN
	select r.RunID, IsNull(b.BID,0) AS BID, r.FixedPoint, r.channelID, cid.Mode, cid.ShortName, cid.BgColour, IsNull(cid.workstreamID,0) as workstreamID, (Select Count (AssetID) from [ARM_CORE]..[ScheduleDeployRunAsset] z where z.RunID = r.RunID) As AC, r.SlotID, IsNull(r.Status,'WAIT') as Status, r.RunDate, r.Label  from [ARM_CORE]..[ScheduleDeployRun] r LEFT JOIN [ARM_CORE]..[ScheduleBookDay] b on b.RunID = r.RunID LEFT JOIN [ARM_CORE]..[ScheduleChannel] cid ON cid.ChannelID = r.channelID where r.[RunDate] =   CONVERT (date, GETDATE())  order by cid.Shortname, Label
END

GO

CREATE PROCEDURE X_Slots_5(@DepDate Date)
AS
BEGIN
	select r.RunID, IsNull(b.BID,0) AS BID, r.FixedPoint, r.channelID, cid.Mode, cid.ShortName, cid.BgColour, IsNull(cid.workstreamID,0) as workstreamID, (Select Count (AssetID) from [ARM_CORE]..[ScheduleDeployRunAsset] z where z.RunID = r.RunID) As AC, r.SlotID, IsNull(r.Status,'WAIT') as Status, r.RunDate, r.Label  from [ARM_CORE]..[ScheduleDeployRun] r LEFT JOIN [ARM_CORE]..[ScheduleBookDay] b on b.RunID = r.RunID LEFT JOIN [ARM_CORE]..[ScheduleChannel] cid ON cid.ChannelID = r.channelID where r.[RunDate] = @DepDate order by cid.Shortname,Label
END

GO

CREATE PROCEDURE X_Slots_4(@DepDate Date)
AS
BEGIN
	select TOP 1 RunDate from [ARM_CORE]..[ScheduleDeployRun] where RunDate > @DepDate  ORDER BY RunDate ASC 
END

GO

CREATE PROCEDURE X_Slots_3(@DepDate Date)
AS
BEGIN
	select r.RunID, IsNull(b.BID,0) AS BID, r.FixedPoint, r.channelID, cid.Mode, cid.Shortname, cid.BgColour, IsNull(cid.workstreamID,0) as workstreamID, (Select Count (AssetID) from [ARM_CORE]..[ScheduleDeployRunAsset] z where z.RunID = r.RunID) As AC, r.SlotID, IsNull(r.Status,'WAIT') as Status, r.RunDate, r.Label from [ARM_CORE]..[ScheduleDeployRun] r LEFT JOIN [ARM_CORE]..[ScheduleBookDay] b on b.RunID = r.RunID LEFT JOIN [ARM_CORE]..[ScheduleChannel] cid ON cid.ChannelID = r.channelID where r.[RunDate] = @DepDate order by cid.Shortname, Label
END

GO


CREATE PROCEDURE X_Slots_2(@DepDate Date)
AS
BEGIN
	select TOP 1 RunDate from [ARM_CORE]..[ScheduleDeployRun] where RunDate < @DepDate  ORDER BY RunDate DESC
END

GO
CREATE PROCEDURE X_Slots_1
AS
BEGIN
	select CONVERT (date, GETDATE()) AS TheDate 
END

GO

CREATE PROCEDURE X_Slots2_21(@WorkStreamID INT)
AS
BEGIN
	select ws.[SlotStatusID], ws.[Label], ws.[MapToCollectionID] , c.[Name] as [CollectionName], IsNull(ws.[Deployed],0) as Deployed, IsNull(ws.[Failed],0) as Failed,
		IsNull(ws.[RemoveFromSlot],0) as [RemoveFromSlot], ws.[SQLTrigger] , ws.[WorkstreamID]  , ws.[Order]
		from [ARM_CORE]..[A_SlotStatusDefinition] ws  
		LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionID = ws.[MapToCollectionID] 
		where ws.WorkstreamID = @WorkStreamID
		order by ws.[Order]
END

GO

CREATE PROCEDURE X_Slots2_20(@WorkStreamID INT,@Auth_Role_Id INT)
AS
BEGIN
	SELECT [ButtonID],IsNull([ButtonTitle],'') as [ButtonTitle],IsNull([Icon],'fa-file-code-o') as [Icon], IsNull([Batch],0) as [Batch],
		IsNull([URL],'#') as [url],IsNull([Class],'btn-primary') as [Class], IsNull([WorkstreamID],0) as [WorkstreamID], IsNull([Context],'Run') as [Context],
		IsNull([Order],0) as [Order], IsNull([Active],0) as [Active],IsNull([info],'') as Info, IsNull(MinRoleID,0) as MinRoleID
		FROM [ARM_CORE]..[Button] where IsNull([Active],0) = 1 and (IsNull([WorkstreamID],0) = 0 or IsNull([WorkstreamID],0) = @WorkStreamID) and IsNull(MinRoleID,0) <= @Auth_Role_Id and (IsNull([Context],'Run') like 'Field#%' or IsNull([Context],'Run') like 'File#%') and [Type] = 'Slot'
		Order by [Order]
END

GO

CREATE PROCEDURE X_Slots2_19(@WorkStreamID INT,@Auth_Role_Id INT)
AS
BEGIN
	SELECT [ButtonID],IsNull([ButtonTitle],'') as [ButtonTitle],IsNull([Icon],'fa-file-code-o') as [Icon], IsNull([Batch],0) as [Batch],
		IsNull([URL],'#') as [url],IsNull([Class],'btn-primary') as [Class], IsNull([WorkstreamID],0) as [WorkstreamID], IsNull([Context],'Run') as [Context],
		IsNull([Order],0) as [Order], IsNull([Active],0) as [Active],IsNull([info],'') as Info, IsNull(MinRoleID,0) as MinRoleID, IsNull(Modal,'') as Modal
		FROM [ARM_CORE]..[Button] where IsNull([Active],0) = 1 and (IsNull([WorkstreamID],0) = 0 or IsNull([WorkstreamID],0) = @WorkStreamID) and IsNull(MinRoleID,0) <= @Auth_Role_Id and IsNull([Context],'Run') = 'Run' and [Type] = 'Slot'
		Order by [Order]
END

GO

CREATE PROCEDURE X_Slots2_18(@DepRef nvarchar(255))
AS
BEGIN
	select distinct r.RunID, IsNull(r.Status,'') as SlotStatus, IsNull(d.BID,0) as BID, d.Label, d.ChannelID, sc.[Mode], sc.[WorkstreamID],  r.OrderRef, IsNull(c.[Type],'Desktop') AS AssetType,
			 IsNull(r.[ReplaceWith],'') AS ReplaceWith,   
			 IsNull ( (select AssetID from [ARM_CORE]..[Asset] where AssetID = r.[ReplaceWith]),'No' ) as ReplaceExists,
			 IsNull ( (select Model from [ARM_CORE]..[Asset] where AssetID = r.[ReplaceWith]),'' ) as NewModel,
			 IsNull(r.Comment,'') as Comment,  0 as EngDeployed, 
			 c.*,
			 d.RunDate, t.Label as  TimeLabel, t.MaxBooking, t.Duration, t.Active,
			 ssd.SlotStatusID, ssd.[Deployed] as [IsDeployed], ssd.[Failed] as [IsFailed],
			 m.ToBeModel 
			 ,IsNull(STUFF(( select '^' + CASE when IsNull(g.[CollectionID],0) = 0 then '' else g.[Name]+':'+g.[Colour] end from [ARM_CORE]..[A_Collection] g  
			 		LEFT JOIN [ARM_CORE]..[A_CollectionItem] f ON f.[CollectionID] = g.[CollectionID] where IsNull(g.[Marker],0) = 1 and f.ItemID = r.AssetID 
			 		FOR XML PATH('')  
			 			), 1, 1, '') + '','') as Markers 
			 ,IsNull(STUFF(( select '^' + CASE when IsNull(g.[CollectionID],0) = 0 then '' else g.[Name]+':'+g.[Colour] end from [ARM_CORE]..[A_Collection] g 
			 		LEFT JOIN [ARM_CORE]..[A_CollectionItem] f ON f.[CollectionID] = g.[CollectionID] where IsNull(g.[Marker],0) = 1 and f.ItemID = c.UserID   
			 		FOR XML PATH('')  
			 			), 1, 1, '') + '','') as UserMarkers 
			 from [ARM_CORE]..[ScheduleDeployRunAsset] r  LEFT JOIN [ARM_CORE]..[Asset] c ON  c.AssetID = r.AssetID 
			 LEFT JOIN [ARM_CORE]..[ScheduleDeployRun] d ON r.RunID = d.RunID 
			 LEFT JOIN [ARM_CORE]..[ScheduleChannel] sc ON sc.ChannelID = d.ChannelID 
			 LEFT JOIN [ARM_CORE]..[A_SlotStatusDefinition] ssd on ssd.[Label] = IsNull(r.Status,'') and ssd.WorkstreamID = sc.[WorkstreamID]
			 LEFT JOIN [ARM_CORE]..ModelToBe m ON m.AssetID = r.AssetID  
			 LEFT JOIN [ARM_CORE]..[ScheduleBookDay] bd on bd.RunID = d.RunID 
			 LEFT JOIN [ARM_CORE]..[ScheduleBooking] b on b.RunID = d.RunID and b.AssetID = r.AssetID 
			 LEFT Join [ARM_CORE]..[ScheduleTimeSlot] t on t.TID = b.TID 
			 where d.Label = @DepRef
			 Order by TimeLabel, c.[Owner], c.AssetID
END

GO
CREATE PROCEDURE X_Slots2_17(@DepRef nvarchar(255))
AS
BEGIN
	select distinct r.RunID, IsNull(r.Status,'') as SlotStatus, IsNull(d.BID,0) as BID, d.Label, d.ChannelID, sc.[Mode], sc.[WorkstreamID], r.AssetID,  r.OrderRef, IsNull(c.[Type],'Desktop') AS AssetType, 
			 c.[Model] as Model, IsNull(r.[ReplaceWith],'') AS ReplaceWith, 
			 IsNull ( (select AssetID from [ARM_CORE]..[Asset] where AssetID = r.[ReplaceWith]),'No' ) as ReplaceExists,
			 IsNull ( (select Model from [ARM_CORE]..[Asset] where AssetID = r.[ReplaceWith]),'' ) as NewModel,
			 IsNull(r.Comment,'') as Comment, 
			 c.[UserID], c.[BArea], c.[Owner],  0 as EngDeployed, 
			 c.[Custom01], c.[Custom02], c.[Custom03], c.[Custom04], c.[Custom05],
			 d.RunDate, t.Label as  TimeLabel, t.MaxBooking, t.Duration, t.Active,
			 ssd.SlotStatusID, ssd.[Deployed] as [IsDeployed], ssd.[Failed] as [IsFailed],
			 m.ToBeModel
			 ,IsNull(STUFF(( select '^' + CASE when IsNull(g.[CollectionID],0) = 0 then '' else g.[Name]+':'+g.[Colour] end from [ARM_CORE]..[A_Collection] g 
						LEFT JOIN [ARM_CORE]..[A_CollectionItem] f ON f.[CollectionID] = g.[CollectionID] where IsNull(g.[Marker],0) = 1 and f.ItemID = r.AssetID
						FOR XML PATH('') 
						  ), 1, 1, '') + '','') as Markers
			 ,IsNull(STUFF(( select '^' + CASE when IsNull(g.[CollectionID],0) = 0 then '' else g.[Name]+':'+g.[Colour] end from [ARM_CORE]..[A_Collection] g 
						LEFT JOIN [ARM_CORE]..[A_CollectionItem] f ON f.[CollectionID] = g.[CollectionID] where IsNull(g.[Marker],0) = 1 and f.ItemID = c.UserID
						FOR XML PATH('')
						  ), 1, 1, '') + '','') as UserMarkers 
			 from [ARM_CORE]..[ScheduleDeployRunAsset] r  LEFT JOIN [ARM_CORE]..[Asset] c ON  c.AssetID = r.AssetID 
			 LEFT JOIN [ARM_CORE]..[ScheduleDeployRun] d ON r.RunID = d.RunID 
			 LEFT JOIN [ARM_CORE]..[ScheduleChannel] sc ON sc.ChannelID = d.ChannelID
			 LEFT JOIN [ARM_CORE]..[A_SlotStatusDefinition] ssd on ssd.[Label] = IsNull(r.Status,'') and ssd.WorkstreamID = sc.[WorkstreamID]
			 LEFT JOIN [ARM_CORE]..ModelToBe m ON m.AssetID = r.AssetID 
			 LEFT JOIN [ARM_CORE]..[VIP] v ON v.Email = c.[Email]
			 LEFT JOIN [ARM_CORE]..[ScheduleBookDay] bd on bd.RunID = d.RunID
			 LEFT JOIN [ARM_CORE]..[ScheduleBooking] b on b.RunID = d.RunID and b.AssetID = r.AssetID
			 LEFT Join [ARM_CORE]..[ScheduleTimeSlot] t on t.TID = b.TID
			 where d.Label = @DepRef
			 Order by TimeLabel, c.[Owner], r.AssetID 
END


GO

CREATE PROCEDURE X_Slots2_16(@DepRef nvarchar(255))
AS
BEGIN
	select IsNull(sc.Mode,'') as Mode from [ARM_CORE]..[ScheduleDeployRun] d LEFT JOIN [ARM_CORE]..[ScheduleChannel] sc ON sc.ChannelID = d.ChannelID where d.Label = @DepRef
END

GO

CREATE PROCEDURE X_Slots2_15
AS
BEGIN
	SELECT [Table],[Column],IsNull([Label],[Lookup]) as [Label], [Lookup] from [ARM_CORE]..[A_Lookup] where [Table] = 'ScheduleDeployRunAsset' and [Column] = 'Status'   order by [Order]
END

GO

CREATE PROCEDURE X_Slots2_14(@Run_Id INT)
AS
BEGIN
	select 
				(select count(r.AssetID) from [ARM_CORE]..[ScheduleDeployRunAsset] r 
				LEFT JOIN [ARM_CORE]..[ScheduleDeployRun] d on d.RunID = r.[RunID] 
				LEFT JOIN [ARM_CORE]..[ScheduleChannel] c on c.[ChannelID] = d.[ChannelID]
				LEFT JOIN [ARM_CORE]..[A_SlotStatusDefinition] ssd on ssd.[Label] = IsNull(r.Status,'') and ssd.WorkstreamID = c.WorkstreamID where r.RunID = @Run_Id and IsNull(ssd.[Failed],0) = 1 
				) AS NF, 
				(select count(r.AssetID) from [ARM_CORE]..[ScheduleDeployRunAsset] r 
				LEFT JOIN [ARM_CORE]..[ScheduleDeployRun] d on d.RunID = r.[RunID]
				LEFT JOIN [ARM_CORE]..[ScheduleChannel] c on c.[ChannelID] = d.[ChannelID]	
				LEFT JOIN [ARM_CORE]..[A_SlotStatusDefinition] ssd on ssd.[Label] = IsNull(r.Status,'') and ssd.WorkstreamID = c.WorkstreamID where r.RunID = @Run_Id and IsNull(ssd.[Deployed],0) = 1
				) AS DC,
				(select count(r.AssetID) from [ARM_CORE]..[ScheduleDeployRunAsset] r where r.RunID = @Run_Id and IsNull(r.[replaceWith],'') <> ''
				) AS RC
END

GO

CREATE PROCEDURE X_Slots2_13(@Run_Id INT)
AS
BEGIN
	select (select count(r.AssetID) from [ARM_CORE]..[ScheduleDeployRunAsset] r LEFT JOIN [ARM_CORE]..[A_SlotStatusDefinition] ssd on ssd.[Label] = IsNull(r.Status,'') where r.RunID = @Run_Id and IsNull(ssd.[Failed],0) = 1) AS NF,
			 (select count(r.AssetID) from [ARM_CORE]..[ScheduleDeployRunAsset] r LEFT JOIN [ARM_CORE]..[A_SlotStatusDefinition] ssd on ssd.[Label] = IsNull(r.Status,'') where r.RunID = @Run_Id and IsNull(ssd.[Deployed],0) = 1) AS DC,
			 (select count(r.AssetID) from [ARM_CORE]..[AssetStatus] a left join [ARM_CORE]..[ScheduleDeployRunAsset] r on r.AssetID = a.AssetID  where r.RunID = @Run_Id and IsNull(a.[replaceWith],'') <> '') AS RC
END

GO

CREATE PROCEDURE X_Slots2_12(@Auth_Role_Id INT)
AS
BEGIN
	SELECT [ButtonID],IsNull([ButtonTitle],'') as [ButtonTitle],IsNull([Icon],'fa-file-code-o') as [Icon],
		IsNull([URL],'') as [url],IsNull([Class],'btn-primary') as [Class], IsNull([WorkstreamID],0) as [WorkstreamID],
		IsNull([Order],0) as [Order], IsNull([Active],0) as [Active], IsNull([MinRoleID],0) as  MinRoleID
		FROM [ARM_CORE]..[Button] where IsNull([Active],0) = 1 and IsNull([WorkstreamID],0) = 0 and IsNull([Context],'Run') = 'Day' and IsNull([MinRoleID],0) <= @Auth_Role_Id
		Order by [Order]
END

GO

CREATE PROCEDURE X_Slots2_11
AS
BEGIN
	select s.SlotID, s.[DayTxt], s.[FixedPoint], s.[Date] from [ARM_CORE]..[ScheduleSlot] s where s.Date = convert(date,getdate(),112)
END

GO
CREATE PROCEDURE X_Slots2_10(@DepDate Date)
AS
BEGIN
	select s.SlotID, s.[DayTxt], s.[FixedPoint] from [ARM_CORE]..[ScheduleSlot] s where s.Date = @DepDate
END

GO

CREATE PROCEDURE X_Slots2_9(@DepDate Date)
AS
BEGIN
	select r.RunID, IsNull(b.BID,0) AS BID, r.FixedPoint, r.channelID, cid.Mode, cid.ShortName, cid.BgColour, IsNull(cid.workstreamID,0) as workstreamID,
			  (Select Count (AssetID) from [ARM_CORE]..[ScheduleDeployRunAsset] z where z.RunID = r.RunID) As AC, r.SlotID, IsNull(r.Status,'WAIT') as Status, r.RunDate, r.Label
			  from [ARM_CORE]..[ScheduleDeployRun] r LEFT JOIN [ARM_CORE]..[ScheduleBookDay] b on b.RunID = r.RunID LEFT JOIN [ARM_CORE]..[ScheduleChannel] cid ON cid.ChannelID = r.channelID
			  where r.[RunDate] = @DepDate order by cid.Shortname, Label
END

GO
CREATE PROCEDURE X_Slots2_8(@DepRef nvarchar(255))
AS
BEGIN
	select RunDate, RunID from [ARM_CORE]..[ScheduleDeployRun] where [Label] = @DepRef
END

GO

CREATE PROCEDURE X_Slots2_7(@DepDate Date)
AS
BEGIN
	select r.RunID, IsNull(b.BID,0) AS BID, r.FixedPoint, r.channelID, cid.Mode, cid.ShortName, cid.BgColour, IsNull(cid.workstreamID,0) as workstreamID, (Select Count (AssetID) from [ARM_CORE]..[ScheduleDeployRunAsset] z where z.RunID = r.RunID) As AC, r.SlotID, IsNull(r.Status,'WAIT') as Status, r.RunDate, r.Label  from [ARM_CORE]..[ScheduleDeployRun] r LEFT JOIN [ARM_CORE]..[ScheduleBookDay] b on b.RunID = r.RunID LEFT JOIN [ARM_CORE]..[ScheduleChannel] cid ON cid.ChannelID = r.channelID where r.[RunDate] =  @DepDate   order by cid.Shortname, Label
END

GO

CREATE PROCEDURE X_Slots2_6
AS
BEGIN
	select r.RunID, IsNull(b.BID,0) AS BID, r.FixedPoint, r.channelID, cid.Mode, cid.ShortName, cid.BgColour, IsNull(cid.workstreamID,0) as workstreamID, (Select Count (AssetID) from [ARM_CORE]..[ScheduleDeployRunAsset] z where z.RunID = r.RunID) As AC, r.SlotID, IsNull(r.Status,'WAIT') as Status, r.RunDate, r.Label  from [ARM_CORE]..[ScheduleDeployRun] r LEFT JOIN [ARM_CORE]..[ScheduleBookDay] b on b.RunID = r.RunID LEFT JOIN [ARM_CORE]..[ScheduleChannel] cid ON cid.ChannelID = r.channelID where r.[RunDate] =   CONVERT (date, GETDATE())  order by cid.Shortname, Label
END

GO

CREATE PROCEDURE X_Slots2_5(@DepDate Date)
AS
BEGIN
	select r.RunID, IsNull(b.BID,0) AS BID, r.FixedPoint, r.channelID, cid.Mode, cid.ShortName, cid.BgColour, IsNull(cid.workstreamID,0) as workstreamID, (Select Count (AssetID) from [ARM_CORE]..[ScheduleDeployRunAsset] z where z.RunID = r.RunID) As AC, r.SlotID, IsNull(r.Status,'WAIT') as Status, r.RunDate, r.Label  from [ARM_CORE]..[ScheduleDeployRun] r LEFT JOIN [ARM_CORE]..[ScheduleBookDay] b on b.RunID = r.RunID LEFT JOIN [ARM_CORE]..[ScheduleChannel] cid ON cid.ChannelID = r.channelID where r.[RunDate] = @DepDate order by cid.Shortname,Label
END

GO

CREATE PROCEDURE X_Slots2_4(@DepDate Date)
AS
BEGIN
	select TOP 1 RunDate from [ARM_CORE]..[ScheduleDeployRun] where RunDate > @DepDate  ORDER BY RunDate ASC
END

GO

CREATE PROCEDURE X_Slots2_3(@DepDate Date)
AS
BEGIN
	select r.RunID, IsNull(b.BID,0) AS BID, r.FixedPoint, r.channelID, cid.Mode, cid.Shortname, cid.BgColour, IsNull(cid.workstreamID,0) as workstreamID, (Select Count (AssetID) from [ARM_CORE]..[ScheduleDeployRunAsset] z where z.RunID = r.RunID) As AC, r.SlotID, IsNull(r.Status,'WAIT') as Status, r.RunDate, r.Label from [ARM_CORE]..[ScheduleDeployRun] r LEFT JOIN [ARM_CORE]..[ScheduleBookDay] b on b.RunID = r.RunID LEFT JOIN [ARM_CORE]..[ScheduleChannel] cid ON cid.ChannelID = r.channelID where r.[RunDate] = @DepDate order by cid.Shortname, Label
END

GO
CREATE PROCEDURE X_Slots2_2(@DepDate Date)
AS
BEGIN
	select TOP 1 RunDate from [ARM_CORE]..[ScheduleDeployRun] where RunDate < @DepDate  ORDER BY RunDate DESC
END

GO
CREATE PROCEDURE X_Slots2_1
AS
BEGIN
	select CONVERT (date, GETDATE()) AS TheDate 
END

GO
CREATE PROCEDURE X_SlotToggle_1(@Status nvarchar(255),@DepRef nvarchar(255))
AS
BEGIN
update [ARM_CORE]..[ScheduleDeployRun] set status = @Status where Label = @DepRef
		
END

GO
CREATE PROCEDURE X_SubFormTab_1(@FormRef nvarchar(255))
AS
BEGIN
select s.* from [ARM_CORE]..[A_SubForm] s where s.FormName = @FormRef order by SubFormOrder, SubFormName
		
END

GO

CREATE PROCEDURE X_SurveyAddQuestion_7(@QID INT,@TextRows INT,@TextCols INT)
AS
BEGIN
	Update [ARM_CORE]..[SurveyEText] set Rows = @TextRows,Cols = @TextCols where QID = @QID
END

GO
CREATE PROCEDURE X_SurveyAddQuestion_6(@QID INT,@Option1 nvarchar(500),@Option2 nvarchar(500),@Option3 nvarchar(500),@Option4 nvarchar(500),@Option5 nvarchar(500),@OptionOther bit)
AS
BEGIN
	Update [ARM_CORE]..[SurveyEOption] set OptionA = @Option1,OptionB = @Option2,OptionC = @Option3,OptionD = @Option4,OptionE = @Option5,Other = @OptionOther where QID = @QID
END

GO

CREATE PROCEDURE X_SurveyAddQuestion_5(@QID INT,@ScalarLeftLabel nvarchar(255),@ScalarRightLabel nvarchar(255),@ScalarRange int,@ScalarNA int)
AS
BEGIN
	Update [ARM_CORE]..[SurveyEScalar] set LeftLabel = @ScalarLeftLabel,RightLabel = @ScalarRightLabel,Range = @ScalarRange,NA = @ScalarNA where QID = @QID
END

GO

CREATE PROCEDURE X_SurveyAddQuestion_4(@Question nvarchar(255),@QID INT)
AS
BEGIN
	Update [ARM_CORE]..[SurveyEQuestion] set Question = @Question where QID =@QID
END

GO

CREATE PROCEDURE X_SurveyAddQuestion_3(@QID INT,@TextRows INT,@TextCols INT,@Auth_User nvarchar(255))
AS
BEGIN
	insert into [ARM_CORE]..[SurveyEText] (QID,Rows,Cols,Auth_User) values (@QID,@TextRows,@TextCols,@Auth_User )
END

GO

CREATE PROCEDURE X_SurveyAddQuestion_2(@QID INT,@Option1 nvarchar(500),@Option2 nvarchar(500),@Option3 nvarchar(500),@Option4 nvarchar(500),@Option5 nvarchar(500),@OptionOther bit,@Auth_User nvarchar(255))
AS
BEGIN
	insert into [ARM_CORE]..[SurveyEOption] (QID,OptionA,OptionB,OptionC,OptionD,OptionE,Other,Auth_User) values (@QID,@Option1,@Option2,@Option3,@Option4,@Option5,@OptionOther,@Auth_User )
END

GO
CREATE PROCEDURE X_SurveyAddQuestion_1(@QID INT,@ScalarLeftLabel nvarchar(255),@ScalarRightLabel nvarchar(255),@ScalarRange int,@ScalarNA int,@Auth_User nvarchar(255))
AS
BEGIN
	insert into [ARM_CORE]..[SurveyEScalar] (QID,LeftLabel,RightLabel,Range,NA,Auth_User) values (@QID,@ScalarLeftLabel,@ScalarRightLabel,@ScalarRange,@ScalarNA,@Auth_User )
END

GO

CREATE PROCEDURE X_SurveyCreator_3(@Auth_User NVARCHAR(255))
AS
BEGIN
	SELECT q.QID, q.Question, q.Qorder, q.Type  from [ARM_CORE]..[SurveyEQuestion] q where Auth_User = @Auth_User order By  q.Qorder
END

GO

CREATE PROCEDURE X_SurveyCreator_2(@QType nvarchar(255),@QID INT)
AS
BEGIN
	DECLARE @SQL nvarchar(max);
	SET @SQL = '
		select * from [ARM_CORE]..[SurveyE'+@QType+'] where QID = '+@QID+'
	'

	EXEC(@SQL)
END

GO
CREATE PROCEDURE X_SurveyCreator_1(@QID INT)
AS
BEGIN
	select * from [ARM_CORE]..[SurveyEQuestion] where QID = @QID
END

GO

CREATE PROCEDURE X_SurveyDelete_2(@SID INT,@TableName nvarchar(255))
AS
BEGIN
	DECLARE @SQL NVARCHAR(MAX)
	SET @SQL ='
		delete from [ARM_CORE]..['+@TableName+'] where SID = '+@SID+'
	'
	EXEC(@SQL)
END

GO
CREATE PROCEDURE X_SurveyDelete_1(@SID INT,@TableName nvarchar(255))
AS
BEGIN
	DECLARE @SQL NVARCHAR(MAX)
	SET @SQL ='
		delete from [ARM_CORE]..['+@TableName+'] where QID in (select QID from [ARM_CORE]..[SurveyPQuestion] where SID = '+@SID+')
	'
	EXEC(@SQL)
END

GO


CREATE PROCEDURE X_SurveyPreview_2(@QType nvarchar(255),@QID INT)
AS
BEGIN
	DECLARE @SQL nvarchar(max);
	SET @SQL = '
		select * from [ARM_CORE]..[SurveyE'+@QType+'] where QID = '+@QID+'
	'

	EXEC(@SQL)
END

GO
CREATE PROCEDURE X_SurveyPreview_1(@Auth_User nvarchar(255))
AS
BEGIN
	SELECT q.QID, q.Question, q.Qorder, q.Type  from [ARM_CORE]..[SurveyEQuestion] q where Auth_User = @Auth_User order By  q.Qorder
END

GO
CREATE PROCEDURE X_SurveyQuestionDelete_1(@TableName nvarchar(255),@QID INT)
AS
BEGIN
	DECLARE @SQL nvarchar(max);
	SET @SQL = '
		delete from [ARM_CORE]..['+@TableName+'] where QID = '+@QID+'
	'

	EXEC(@SQL)
END

GO

CREATE PROCEDURE X_SurveyResults_6(@QID INT)
AS
BEGIN
	SELECT [Value] AS keys, count([Value]) as VC FROM [ARM_CORE]..[SurveyResponseAnswers] where QID = @QID GROUP by [Value]
END

GO

CREATE PROCEDURE X_SurveyResults_5(@QID INT,@SID INT)
AS
BEGIN
	SELECT ra.[Value] AS keys, count(ra.[Value]) as VC FROM [ARM_CORE]..[SurveyResponseAnswers] ra LEFT JOIN [ARM_CORE]..[SurveyResponse] r on ra.RID = r.RID where ra.QID = @QID and r.SID = @SID GROUP by [Value]
END

GO

CREATE PROCEDURE X_SurveyResults_4(@Key nvarchar(255),@QID INT)
AS
BEGIN
	select IsNull(ra.QID,0) AS QID, SUM(convert(Integer,ra.[VALUE]) * p.Weight) As Weighted, SUM(p.Weight) AS Weight
							 from [ARM_CORE]..[Survey] s
							 LEFT JOIN [ARM_CORE]..[SurveyResponse] r on r.SID = s.SID
							 LEFT JOIN [ARM_CORE]..[SurveyResponseAnswers] ra on ra.RID = r.RID
							 LEFT JOIN [ARM_CORE]..[SurveyPGrid] p on p.QID = ra.QID 
							 where s.[KEY] = @Key and convert(nvarchar(255),p.QID) = @QID Group By ra.QID
END

GO

CREATE PROCEDURE X_SurveyResults_3(@QType nvarchar(255),@QID INT)
AS
BEGIN
	DECLARE @SQL nvarchar(max);
	SET @SQL = '
		select * from [ARM_CORE]..[SurveyP'+@QType+'] where QID = '+@QID+'
	'

	EXEC(@SQL)
END

GO

CREATE PROCEDURE X_SurveyResults_2(@SID INT)
AS
BEGIN
	SELECT q.QID, q.Question, q.Qorder, q.Type  from [ARM_CORE]..[SurveyPQuestion] q where q.SID = @SID order By  q.Qorder
END

GO
CREATE PROCEDURE X_SurveyResults_1(@Key nvarchar(255))
AS
BEGIN
	SELECT s.SID,s.Title,s.Published,s.PublishedOn,s.Active,s.[KEY],(select count(r.RID) from [ARM_CORE]..[SurveyResponse] r where r.SID = s.SID) AS [RC] from [ARM_CORE]..[Survey] s where s.[KEY] = @Key
END

GO


CREATE PROCEDURE X_SurveySwapQuestions_2(@Order int,@AltQID int)
AS
BEGIN
	update [ARM_CORE]..[SurveyEQuestion] set Qorder = @Order where QID =@AltQID
END

GO
CREATE PROCEDURE X_SurveySwapQuestions_1(@AltOrder int,@QID int)
AS
BEGIN
	update [ARM_CORE]..[SurveyEQuestion] set Qorder = @AltOrder where QID = @QID
END

GO

CREATE PROCEDURE X_TaskAction_7(@ItemType nvarchar(255),@ItemID nvarchar(255),@Auth_User nvarchar(255),@Comment nvarchar(MAX))
AS
BEGIN
	insert into [ARM_CORE]..[A_CommentLog] ([Table], [Type], [RecordID], [Author], [TimeStamp], [Internal], [Comment])
	values (@ItemType,'',@ItemID,@Auth_User,getdate(),0,@Comment)
END

GO

CREATE PROCEDURE X_TaskAction_6(@OptionID int,@TaskValue2 NVARCHAR(255),@comment2 nvarchar(255),@TaskId int)
AS
BEGIN
	 MERGE [ARM_CORE]..[A_TaskResponse] as Target using (
			 select  [TaskID], [UserID],  [ActionID], [ItemID], [ItemType], @OptionID as [ActionOptionID], @TaskValue2 as [Value], @Comment2 as [AdditionalInfo]  from [ARM_CORE]..[A_Task] where TaskID = @TaskId
			 ) as Source
			 ON (target.taskID  = source.taskID)
			 WHEN NOT MATCHED BY TARGET THEN 
			 	insert ([TaskID],[UserID],[ActionID],[ActionOptionID], [ItemID], [ItemType],[Value],[AdditionalInfo]) Values (Source.[TaskID], Source.[UserID], Source.[ActionID], Source.[ActionOptionID], Source.[ItemID], Source.[ItemType], Source.[Value], Source.[AdditionalInfo]);
END

GO

CREATE PROCEDURE X_TaskAction_5(@NewActionID int,@TaskID int)
AS
BEGIN
	 MERGE [ARM_CORE]..[A_Task] as Target using (
			 	select @NewActionID as [ActionID], [Group], [ItemID], [ItemType], [UserID] from [ARM_CORE]..[A_Task] where TaskID = @TaskID
			 ) as Source 
			 ON (target.[ItemID] = source.[ItemID] and target.[ItemType] = source.[ItemType] and target.[UserID] = source.[UserID] and target.[ActionID] = source.[ActionID] and IsNull(target.[End],'1900-01-01') = '1900-01-01')
			 WHEN NOT MATCHED BY TARGET THEN
			 	insert ([Group], [ItemID], [Itemtype], [UserID], [ActionID]) Values (Source.[Group], Source.[ItemID], Source.[Itemtype], Source.[UserID], Source.[ActionID]);
END

GO

CREATE PROCEDURE X_TaskAction_4(@ItemType nvarchar(255),@ItemID nvarchar(255),@Auth_User nvarchar(255),@Comment nvarchar(MAX))
AS
BEGIN
	insert into [ARM_CORE]..[A_CommentLog] ([Table], [Type], [RecordID], [Author], [TimeStamp], [Internal], [Comment])
	values (@ItemType,'',@ItemID,@Auth_User,getdate(),0,@Comment) 
END

GO

CREATE PROCEDURE X_TaskAction_3(@TaskID int)
AS
BEGIN
	update [ARM_CORE]..[A_Task] set [END] = getdate() where taskID = @TaskID
END

GO

CREATE PROCEDURE X_TaskAction_2(@TaskID int)
AS
BEGIN
	 MERGE [ARM_CORE]..[A_TaskResponse] as Target using (
			 select  [TaskID], [UserID],  [ActionID], [ItemID], [ItemType], -1 as [ActionOptionID], 'SYS_CANCELLED' as [Value], 'Collection condition no longer met' as [AdditionalInfo]  from [ARM_CORE]..[A_Task] where TaskID = @TaskID
			 ) as Source
			 ON (target.taskID  = source.taskID)
			 WHEN NOT MATCHED BY TARGET THEN
			 	insert ([TaskID],[UserID],[ActionID],[ActionOptionID], [ItemID], [ItemType], [Value],[AdditionalInfo]) Values (Source.[TaskID], Source.[UserID], Source.[ActionID], Source.[ActionOptionID], Source.[ItemID], Source.[ItemType], Source.[Value], Source.[AdditionalInfo]);
END

GO
CREATE PROCEDURE X_TaskAction_1(@OptionID int,@TaskID int)
AS
BEGIN
	 select t.*, IsNull(o.newActionID,0) as [TasknewActionID],  t.[ItemID], t.[ItemType], IsNull(o.newCollectionID,0) as [TasknewCollectionID], IsNull(t.[End],'1900-01-01 00:00:00') as [TaskEnd], a.Question, IsNull(a.ConditionCollectionIDs,'') as ConditionCollectionIDs, (select count(i.CollectionID) from [ARM_CORE]..[A_CollectionItem] i where i.itemid = t.ItemID and i.CollectionID in (select value from string_split( IsNull(a.ConditionCollectionIDs,''), ',')) ) as CheckID,
		o.*, u.UserName, u.Email from [ARM_CORE]..[A_ActionOption] o 
		LEFT JOIN [ARM_CORE]..[A_Action] a on a.ActionID = o.ActionID
		LEFT JOIN [ARM_CORE]..[A_Task] t on t.ActionID = o.ActionID 
		LEFT JOIN [ARM_CORE]..[User] u on u.UserID = t.userID 
		where o.ActionOptionID = @OptionID and t.TaskID = @TaskID
END

GO

CREATE PROCEDURE X_Tasks_5(@ItemID nvarchar(255)='')
AS
BEGIN
	select x.*, m.mx from ( 
		select IsNull(t.[Group],'Your Tasks') as GroupTitle, t.*, a.Question, a.ActionType, r.[Value], r.[ActionOptionID]  
			, row_number() OVER (PARTITION BY IsNull(t.[Group],'Your Tasks') ORDER BY IsNull(t.[Group],'Your Tasks'), t.[End] DESC) AS gx, IsNull(a.Info,'') as [actionInfo], r.[AdditionalInfo]
		 from [ARM_CORE]..[A_Task] t   
		 LEFT JOIN [ARM_CORE]..[A_Action] a on a.ActionID = t.ActionID  
		 LEFT JOIN [ARM_CORE]..[A_TaskResponse] r on r.TaskID = t.TaskID  
		 where (t.ItemID = @ItemID or t.userID = @ItemID) and NOT isnull(t.[End],'') = ''  
	) x  
	LEFT JOIN ( 
		select y.[Group], max(y.[gx]) as mx from (
			select IsNull(t.[Group],'Your Tasks') as [Group], row_number() OVER (PARTITION BY IsNull(t.[Group],'Your Tasks') ORDER BY IsNull(t.[Group],'Your Tasks'), t.[End] DESC) AS gx 
			from [ARM_CORE]..[A_Task] t where (t.ItemID = @ItemID or t.userID = @ItemID) and NOT isnull(t.[End],'') = '' 
		) y group by y.[Group] 
	) m on m.[Group] = x.[GroupTitle] where gx < 6
	order by x.[GroupTitle], x.[End] desc 
END

GO


CREATE PROCEDURE X_Tasks_4(@ItemID nvarchar(255)='',@Auth_User nvarchar(255)='')
AS
BEGIN
	select IsNull(t.[Group],'Your Tasks') as GroupTitle, IsNull(t.ItemID,'') as [_ItemID], IsNull(a.Question,'') as Question, a.ActionType
	, dateDiff(day, getdate(), IsNull(t.DueDate,[Start]+IsNull(a.DaysToComplete,14))) as DaysRemaining , u.UserName
	, case when datediff(s,t.[Start],getdate()) < 60 then 1 else 0 end as newTasks
	, (select top 1 case when datediff(s,v.[Start],getdate()) < 60 then 1 else 0 end as newTasks from [ARM_CORE]..[A_Task] v where v.UserID = @Auth_User and isnull(v.[End],'') = '' order by v.[Start] desc ) as AnyNewTasks
	, IsNull(a.Info,'') as [actionInfo], t.*, IsNull(t.Info,'') as [taskInfo]
	from [ARM_CORE]..[A_Task] t    
	LEFT JOIN [ARM_CORE]..[A_Action] a on a.ActionID = t.ActionID  
	LEFT JOIN [ARM_CORE]..[User] u on u.UserID = t.UserID   
	where (t.ItemID = @ItemID ) and isnull(t.[End],'') = ''   
	order by IsNull(t.[Group],'Your Tasks'), IsNull(t.DueDate,[Start]+IsNull(a.DaysToComplete,14)) 
END

GO

CREATE PROCEDURE X_Tasks_3(@t_ActionID int)
AS
BEGIN
	select  * from [ARM_CORE]..[A_ActionOption] where ActionID =  @t_ActionID
END

GO

CREATE PROCEDURE X_Tasks_2(@ItemID nvarchar(255)='')
AS
BEGIN
	select IsNull(t.[Group],'Your Tasks') as GroupTitle, IsNull(t.ItemID,'') as [_ItemID]
	 , dateDiff(day, getdate(), IsNull(t.DueDate,[Start]+IsNull(a.DaysToComplete,14))) as DaysRemaining , u.UserName 
	 , case when datediff(s,t.[Start],getdate()) < 60 then 1 else 0 end as newTasks 
	 , (select top 1 case when datediff(s,v.[Start],getdate()) < 60 then 1 else 0 end as newTasks from [ARM_CORE]..[A_Task] v where v.UserID = '" & ItemID & "' and isnull(v.[End],'') = '' order by v.[Start] desc ) as AnyNewTasks
	 , IsNull(a.Question,'') as Question, t.*, a.ActionType, IsNull(t.Info,'') as [taskInfo], IsNull(a.Info,'') as [actionInfo]
	 from [ARM_CORE]..[A_Task] t
	 LEFT JOIN [ARM_CORE]..[A_Action] a on a.ActionID = t.ActionID
	 LEFT JOIN [ARM_CORE]..[User] u on u.UserID = t.UserID 
	 where (t.UserID = @ItemID ) and isnull(t.[End],'') = ''
	 order by IsNull(t.[Group],'Your Tasks'), IsNull(t.DueDate,[Start]+IsNull(a.DaysToComplete,14))
END

GO
CREATE PROCEDURE X_Tasks_1(@ItemID nvarchar(255)='')
AS
BEGIN
	 select j.Label, Count(j.TaskID) as [Count]  from ( select
		 case  
		 when i.DaysRemaining < 1 then 'Overdue'
		 when i.DaysRemaining < 8 then 'Due within 7 days'
		 when i.DaysRemaining < 15 then 'Due within 14 days'
		 else 'Due later'
		 end as [Label], i.taskID
		 from ( 
		    select t.*, a.Question, a.Info as [actionInfo], dateDiff(day, getdate(), IsNull(t.DueDate,[Start]+IsNull(a.DaysToComplete,14))) as DaysRemaining 
		    from [ARM_CORE]..[A_Task] t
		    LEFT JOIN [ARM_CORE]..[A_Action] a on a.ActionID = t.ActionID
		    where (t.ItemID = @ItemID ) and isnull(t.[End],'') = ''
		 ) i ) j group by j.[Label]
END

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_Timeline_1] 
 --@AssetID NVARCHAR(250) 
 --@myLocked NVARCHAR(5) 

AS
BEGIN
SELECT [TimelineID],
       [Date],
       [MarkerTitle],
       [MarkerColour],
       [TextColour],
       ISNULL([Icon], '') AS [Icon],
       ISNULL([Link], '') AS MarkerLink,
       [ButtonColour],
       [Order],
       DATENAME(mm, [Date]) AS MonthName,
       DATENAME(dd, [Date]) AS DayDate,
       DATENAME(yyyy, [Date]) AS YearDate,
       DATENAME(WEEKDAY, [Date]) AS Weekday,
       ISNULL(MarkerText, '') AS [MarkerText]
FROM [ARM_CORE]..[Timeline]
ORDER BY [Date],
         [Order],
         [MarkerTitle];
END



GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_TimeTemplateCreate_1] 
 @NewID INT,
 @slotID NVARCHAR(10),
 @MaxSlot SMALLINT,
 @Active BIT,
 @Duration INT
 --@myLocked NVARCHAR(5) 

AS
BEGIN
INSERT INTO [ARM_CORE]..[ScheduleTimeTemplateSlot]
(
    TemplateID,
    Label,
    MaxBookings,
    Active,
    Duration
)
VALUES
(@NewID, @slotID, @MaxSlot, @Active, @Duration);
END



GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_TimeTemplateDelete_1] 
 @NewID INT

AS
BEGIN
Delete from [ARM_CORE]..[ScheduleTimeTemplate] where TemplateID = @NewID
END



GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_TimeTemplates_1] 
 --@NewID INT

AS
BEGIN
select * from [ARM_CORE]..[ScheduleTimeTemplate] order by Name
END



GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UAM_1] 
 --@NewID INT

AS
BEGIN
select distinct b.BArea AS Location from [ARM_CORE]..[BArea] b where b.Internal = 0 order by b.BArea
END



GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UAM_2] 
 --@NewID INT

AS
BEGIN
SELECT c.Name AS Location,
       CollectionID,
       ISNULL(cc.Name, '') AS ClassName,
       ISNULL(w.Name, '') AS WorkstreamName
FROM [ARM_CORE]..[A_Collection] c
    LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc
        ON cc.CollectionClassID = c.CollectionClassID
    LEFT JOIN [ARM_CORE]..[Workstream] w
        ON w.WorkstreamID = cc.WorkstreamID
WHERE Type = 'Asset'
ORDER BY WorkstreamName,
         Location;
END



GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UAM_3] @CollectionClassID INT
AS
BEGIN
    SELECT c.Name AS Location,
           CollectionID,
           ISNULL(cc.Name, '') AS ClassName,
           '' AS WorkstreamName
    FROM [ARM_CORE]..[A_Collection] c
        LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc
            ON cc.CollectionClassID = c.CollectionClassID
    WHERE cc.CollectionClassID = @CollectionClassID
          AND c.Type = 'Asset'
          AND ISNULL(c.EndState, 0) = 0
    ORDER BY c.Name;
END;



GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UAM_4] -- @CollectionClassID INT
AS
BEGIN

SELECT v.viewID, v.ViewTitle from [ARM_CORE]..[Views] v where IsNull(ItemIDRef,'') = 'AssetID' and IsNull(ItemType,'') = 'Asset' 

END;



GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UAM_5] -- @CollectionClassID INT
AS
BEGIN

select distinct isNull(c.Location,'') as Location from [ARM_CORE]..[Asset] c  order by isNull(c.Location, '')

END;



GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UAM_6] 
@AppKey1 NVARCHAR(255),
@AppKey2 NVARCHAR(255),
@AppKey3 NVARCHAR(255),
@AppKey4 NVARCHAR(255),
@AppKey5 NVARCHAR(255)
AS
BEGIN

 SELECT IsNull((select g.[Description] from [ARM_CORE]..[Application] a LEFT JOIN [ARM_CORE]..[AppGroup] g on g.AppGroupID = a.AppGroupID where a.ApplicationID = @AppKey1),'') AS App1Desc, 
 IsNull((select g.[Description] from [ARM_CORE]..[Application] a LEFT JOIN [ARM_CORE]..[AppGroup] g on g.AppGroupID = a.AppGroupID where a.ApplicationID = @AppKey2 ),'') AS App2Desc, 
 IsNull((select g.[Description] from [ARM_CORE]..[Application] a LEFT JOIN [ARM_CORE]..[AppGroup] g on g.AppGroupID = a.AppGroupID where a.ApplicationID = @AppKey3 ),'') AS App3Desc, 
 IsNull((select g.[Description] from [ARM_CORE]..[Application] a LEFT JOIN [ARM_CORE]..[AppGroup] g on g.AppGroupID = a.AppGroupID where a.ApplicationID = @AppKey4 ),'') AS App4Desc, 
 IsNull((select g.[Description] from [ARM_CORE]..[Application] a LEFT JOIN [ARM_CORE]..[AppGroup] g on g.AppGroupID = a.AppGroupID where a.ApplicationID = @AppKey5 ),'') AS App5Desc

END;



GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UAM_7] 
@scope  NVARCHAR(max),
@BArea NVARCHAR(255)
AS
BEGIN
if @BArea <> ''
	SET @BArea = 'where c.[BArea] = ' + @BArea

DECLARE @sqlStr NVARCHAR(max) = '
SELECT distinct e.ApplicationID as [KEY] 
 from [ARM_CORE]..'+ @scope +' e   
 LEFT JOIN [ARM_CORE]..[Asset] c On c.AssetID = e.[AssetId]   
 LEFT JOIN [ARM_CORE]..[Application] w on w.ApplicationID = e.ApplicationID  
 '+ @BArea +'  order by [KEY]
   ';
 --  print @sqlstr
   EXEC(@sqlStr);

END;



GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UAM_8] 
@scope  NVARCHAR(max),
@SliceTerm INT
AS
BEGIN

DECLARE @sqlStr NVARCHAR(max) = '
     select distinct e.ApplicationID as [KEY] 
		 from [ARM_CORE]..[A_CollectionItem] f 
		 LEFT JOIN [ARM_CORE]..'+ @scope +' e on e.[AssetID] = f.ItemID    
		 where f.CollectionID = '+ @SliceTerm +' and IsNull(e.ApplicationID,'''') <> '''' order by [KEY] 
   ';
   EXEC(@sqlStr);

END;



GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UAM_9] 
@viewID INT
AS
BEGIN

SELECT  SQL  from [ARM_CORE]..[Views] where viewID = @viewID

END;



GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UAM_10] 
@viewSQL  NVARCHAR(max),
@scope  NVARCHAR(max)
AS
BEGIN

DECLARE @sqlStr NVARCHAR(max) = '
         select distinct e.ApplicationID as [KEY]  
		 from ( '+ @viewSQL +' ) a 
		 LEFT JOIN [ARM_CORE]..'+ @scope +' e on e.[AssetID] = a.AssetID    
		 where IsNull(e.ApplicationID,'''') <> '''' order by [KEY] 	
   ';
   EXEC(@sqlStr);

END;



GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UAM_11] 
@scope  NVARCHAR(max),
@Extent  NVARCHAR(max)
AS
BEGIN

DECLARE @sqlStr NVARCHAR(max) = '
         select distinct e.ApplicationID as [KEY]  
		 from [ARM_CORE]..'+ @scope +' e     
		 LEFT JOIN [ARM_CORE]..[Asset] c On c.AssetID = e.[AssetId]    
		 LEFT JOIN [ARM_CORE]..[Application] w on w.ApplicationID = e.ApplicationID   
		 '+@Extent+' order by [KEY] 
   ';
   EXEC(@sqlStr);

END;

	


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UpdateStatus_1] 
@ReplaceWith  NVARCHAR(50),
@RunID  BIGINT,
@AssetID  NVARCHAR(50)
AS
BEGIN

Update [ARM_CORE]..[ScheduleDeployRunAsset] set [ReplaceWith] = @ReplaceWith
WHERE RunID = @RunID and AssetID = @AssetID

END;

	


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UpdateStatus_2] @SlotActionID BIGINT
AS
BEGIN

    SELECT MapToCollectionID,
           [Label],
           ISNULL(WorkstreamID, 0) AS WorkstreamID,
           ISNULL(LifeCycle, '') AS [LifeCycle2],
           ISNULL(ChangeStatus, 1) AS [ChangeStatus],
           CONVERT(BIT, ISNULL(Deployed, 0)) AS Deployed,
           CONVERT(BIT, ISNULL(Failed, 0)) AS Failed,
           CONVERT(BIT, ISNULL(RemoveFromSlot, 0)) AS RemovefromSlot,
           CONVERT(BIT, ISNULL([Logged], 0)) AS [Logged],
           ISNULL([SQLTrigger], '') AS SQLTrigger,
           ISNULL([URLTrigger], '') AS URLTrigger
    FROM [ARM_CORE]..[A_SlotStatusDefinition] ssd
    WHERE ssd.[SlotStatusID] = @SlotActionID;
END;




GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UpdateStatus_3] 
@Label NVARCHAR(50),
@RunID NVARCHAR(50),
@AssetID NVARCHAR(MAX)
AS
BEGIN

DECLARE @sqlStr NVARCHAR(max) = '
   update [ARM_CORE]..[ScheduleDeployRunAsset] set [Status] = '+ @Label +' where RunID = '+@RunID+' and AssetID in ('+@AssetID+')   
   ';
   EXEC(@sqlStr);


END;




GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UpdateStatus_4] 
@LifeCycle NVARCHAR(250),
@AssetID NVARCHAR(MAX)
AS
BEGIN

DECLARE @sqlStr NVARCHAR(max) = '
   update [ARM_CORE]..[Asset] set [LifeCycle] = '+ @LifeCycle +' where AssetID in ('+@AssetID+')  
   ';
   EXEC(@sqlStr);
END;




GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UpdateStatus_5] 
@WorkstreamID NVARCHAR(255),
@itemID NVARCHAR(MAX)
AS
BEGIN

DECLARE @sqlStr NVARCHAR(max) = '
    delete from [ARM_CORE]..[A_CollectionItem] where CollectionID in ( select collectionID from  [ARM_CORE]..[A_Collection] 
    where CollectionClassID = (select KeyStatusID from [ARM_CORE]..[Workstream] where WorkstreamID = '+@WorkstreamID+' )) and itemID in ('+@itemID+') 
   ';
   EXEC(@sqlStr);
END;




GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UpdateStatus_6] 
@RunID NVARCHAR(255),
@AssetID NVARCHAR(MAX)
AS
BEGIN

DECLARE @sqlStr NVARCHAR(max) = '
   delete from  [ARM_CORE]..[ScheduleDeployRunAsset] where RunID = '+@RunID+' and AssetID in ('+@AssetID+')  
   ';
   EXEC(@sqlStr);
END;




GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UpdateStatus_7] 
@RunID NVARCHAR(255),
@AssetID NVARCHAR(MAX)
AS
BEGIN

DECLARE @sqlStr NVARCHAR(max) = '
   delete from [ARM_CORE]..[ScheduleBooking] where RunID = '+@RunID+' and AssetID in ('+@AssetID+')  
   ';
   EXEC(@sqlStr);
END;
  

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UpdateStatus_8] 
@AssetID NVARCHAR(255)
AS
BEGIN

select IsNull(a.[Email],'') as Email, IsNull(a.[UserID],'') as UserID, IsNull(a.[Owner],'') as Owner from [ARM_CORE]..[Asset] a  
WHERE a.AssetID = @AssetID
END;
  

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UpdateStatus_9]
    @WorkStreamID INT,
    @Label NVARCHAR(255),
    @SlotActionID INT,
    @DeployedBit BIT,
    @FailedBit BIT,
    @AssetID NVARCHAR(255),
    @AUSERID NVARCHAR(255),
    @AOWNER NVARCHAR(255),
    @AEMAIL NVARCHAR(255),
    @DepDate DATE,
    @RunID INT,
    @RAssetID NVARCHAR(255),
    @RUserID NVARCHAR(255),
    @ROwner NVARCHAR(255),
    @REmail NVARCHAR(255),
    @AUTH_User NVARCHAR(255)
AS
BEGIN
    INSERT INTO [ARM_CORE]..[A_DeploymentLog]
    (
        [WorkStreamID],
        [Event],
        [EventID],
        [Deployed],
        [Failed],
        [AssetID],
        [UserID],
        [Owner],
        [Email],
        [RunDate],
        [RunID],
        [ReplaceAssetID],
        [ReplaceUserID],
        [ReplaceOwner],
        [ReplaceEmail],
        [AuthUser],
        [AuthDate]
    )
    VALUES
    (@WorkStreamID, @Label, @SlotActionID, @DeployedBit, @FailedBit, @AssetID, @AUSERID, @AOWNER, @AEMAIL, @DepDate,
     @RunID, @RAssetID, @RUserID, @ROwner, @REmail, @AUTH_User, GETDATE());
END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UpdateStatus_10]
    @AssetID NVARCHAR(255),
    @Label NVARCHAR(MAX),
    @DepRef NVARCHAR(MAX),
    @AUTH_USER NVARCHAR(255)
AS
BEGIN
    INSERT INTO [ARM_CORE]..[A_CommentLog]
    (
        [Table],
        [Type],
        [RecordID],
        [Comment],
        [Author]
    )
    VALUES
    ('Asset', 'Manual', @AssetID, 'Slot Status changed to [' + @Label + '] in [' + @DepRef + ']', @AUTH_USER);
END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UpdateStatus2_1] 
@ReplaceWith  NVARCHAR(50),
@RunID  BIGINT,
@AssetID  NVARCHAR(50)
AS
BEGIN

Update [ARM_CORE]..[ScheduleDeployRunAsset] set [ReplaceWith] = @ReplaceWith
WHERE RunID = @RunID and AssetID = @AssetID

END;

	

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UpdateStatus2_2] @SlotActionID BIGINT
AS
BEGIN


    SELECT MapToCollectionID,
           [Label],
           ISNULL(WorkstreamID, 0) AS WorkstreamID,
           ISNULL(LifeCycle, '') AS [LifeCycle2],
           CONVERT(BIT, ISNULL(Deployed, 0)) AS Deployed,
           CONVERT(BIT, ISNULL(Failed, 0)) AS Failed,
           CONVERT(BIT, ISNULL(RemoveFromSlot, 0)) AS RemovefromSlot,
           CONVERT(BIT, ISNULL([Logged], 0)) AS [Logged],
           ISNULL([SQLTrigger], '') AS SQLTrigger
    FROM [ARM_CORE]..[A_SlotStatusDefinition] ssd
    WHERE ssd.[SlotStatusID] = @SlotActionID;

END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UpdateStatus2_3] 
@Label NVARCHAR(50),
@RunID NVARCHAR(50),
@AssetID NVARCHAR(MAX)
AS
BEGIN

DECLARE @sqlStr NVARCHAR(max) = '
   update [ARM_CORE]..[ScheduleDeployRunAsset] set [Status] = '+ @Label +' where RunID = '+@RunID+' and AssetID in ('+@AssetID+')   
   ';
   EXEC(@sqlStr);


END;




GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UpdateStatus2_4] 
@LifeCycle NVARCHAR(250),
@AssetID NVARCHAR(MAX)
AS
BEGIN

DECLARE @sqlStr NVARCHAR(max) = '
   update [ARM_CORE]..[Asset] set [LifeCycle] = '+ @LifeCycle +' where AssetID in ('+@AssetID+')  
   ';
   EXEC(@sqlStr);
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UpdateStatus2_5] 
@WorkstreamID NVARCHAR(255),
@itemID NVARCHAR(MAX)
AS
BEGIN

DECLARE @sqlStr NVARCHAR(max) = '
    delete from [ARM_CORE]..[A_CollectionItem] where CollectionID in ( select collectionID from  [ARM_CORE]..[A_Collection] 
    where CollectionClassID = (select KeyStatusID from [ARM_CORE]..[Workstream] where WorkstreamID = '+@WorkstreamID+' )) and itemID in ('+@itemID+') 
   ';
   EXEC(@sqlStr);
END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UpdateStatus2_6] 
@RunID NVARCHAR(255),
@AssetID NVARCHAR(MAX)
AS
BEGIN

DECLARE @sqlStr NVARCHAR(max) = '
   delete from  [ARM_CORE]..[ScheduleDeployRunAsset] where RunID = '+@RunID+' and AssetID in ('+@AssetID+')  
   ';
   EXEC(@sqlStr);
END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UpdateStatus2_7] 
@RunID NVARCHAR(255),
@AssetID NVARCHAR(MAX)
AS
BEGIN

DECLARE @sqlStr NVARCHAR(max) = '
   delete from [ARM_CORE]..[ScheduleBooking] where RunID = '+@RunID+' and AssetID in ('+@AssetID+')  
   ';
   EXEC(@sqlStr);
END;
  
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UpdateStatus2_8] 
@AssetID NVARCHAR(255)
AS
BEGIN

select a.[Email], a.[UserID], a.[Owner] from [ARM_CORE]..[Asset] a 
WHERE a.AssetID = @AssetID
END;
 
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UpdateStatus2_9]
    @WorkStreamID INT,
    @Label NVARCHAR(255),
    @SlotActionID INT,
    @DeployedBit BIT,
    @FailedBit BIT,
    @AssetID NVARCHAR(255),
    @AUSERID NVARCHAR(255),
    @AOWNER NVARCHAR(255),
    @AEMAIL NVARCHAR(255),
    @DepDate DATE,
    @RunID INT,
    @RAssetID NVARCHAR(255),
    @RUserID NVARCHAR(255),
    @ROwner NVARCHAR(255),
    @REmail NVARCHAR(255),
    @AUTH_User NVARCHAR(255)
AS
BEGIN
    INSERT INTO [ARM_CORE]..[A_DeploymentLog]
    (
        [WorkStreamID],
        [Event],
        [EventID],
        [Deployed],
        [Failed],
        [AssetID],
        [UserID],
        [Owner],
        [Email],
        [RunDate],
        [RunID],
        [ReplaceAssetID],
        [ReplaceUserID],
        [ReplaceOwner],
        [ReplaceEmail],
        [AuthUser],
        [AuthDate]
    )
    VALUES
    (@WorkStreamID, @Label, @SlotActionID, @DeployedBit, @FailedBit, @AssetID, @AUSERID, @AOWNER, @AEMAIL, @DepDate,
     @RunID, @RAssetID, @RUserID, @ROwner, @REmail, @AUTH_User, GETDATE());
END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UpdateStatusBookings_1]
    @ReplaceWith NVARCHAR(50),
    @RunID BIGINT,
    @AssetID NVARCHAR(50)
AS
BEGIN

    UPDATE [ARM_CORE]..[ScheduleDeployRunAsset]
    SET [ReplaceWith] = @ReplaceWith
    WHERE RunID = @RunID
          AND AssetID = @AssetID;

END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UpdateStatusBookings_2]
    @SlotStatusID BIGINT
AS
BEGIN

select MaptoCollectionID, [Label], IsNull(WorkstreamID,0) as WorkstreamID, IsNull(Lifecycle,'') as [LifeCycle2], IsNull(ChangeStatus,1) as [ChangeStatus], 
 Convert(bit,IsNull(Deployed,0)) as Deployed, Convert(bit,IsNull(Failed,0)) as Failed, Convert(bit,IsNull(RemoveFromSlot,0)) as RemovefromSlot, Convert(bit,IsNull([Logged],0)) as [Logged], 
 IsNull([SQLTrigger],'') as SQLTrigger, IsNull([URLTrigger],'') as URLTrigger from [ARM_CORE]..[A_SlotStatusDefinition] ssd where ssd.[SlotStatusID] = @SlotStatusID

END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UpdateStatusBookings_3]
@Label NVARCHAR(255),
@RunID NVARCHAR(255),
@AssetID NVARCHAR(MAX)
AS
BEGIN

DECLARE @sqlStr NVARCHAR(max) = '
   update [ARM_CORE]..[ScheduleDeployRunAsset] set [Status] = '+@Label+' where RunID = '+@RunID+' and AssetID in ('+@AssetID+')  
   ';
   EXEC(@sqlStr);
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UpdateStatusBookings_4]
@Label NVARCHAR(255),
@LifeCycle NVARCHAR(255),
@AssetID NVARCHAR(MAX)
AS
BEGIN

DECLARE @sqlStr NVARCHAR(max) = '
  update [ARM_CORE]..[Asset] set [LifeCycle] = '+@LifeCycle+' where AssetID in ('+@AssetID+')  
   ';
   EXEC(@sqlStr);
END;



GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UpdateStatusBookings_5]
@WorkstreamID NVARCHAR(255),
@itemID NVARCHAR(MAX)
AS
BEGIN

DECLARE @sqlStr NVARCHAR(max) = '
    delete from [ARM_CORE]..[A_CollectionItem] where CollectionID in ( select collectionID from  [ARM_CORE]..[A_Collection] 
    where CollectionClassID = (select KeyStatusID from [ARM_CORE]..[Workstream] where WorkstreamID = '+@WorkstreamID+' )) and itemID in ('+@itemID+') 
   ';
   EXEC(@sqlStr);
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UpdateStatusBookings_6] 
@RunID NVARCHAR(255),
@AssetID NVARCHAR(MAX)
AS
BEGIN

DECLARE @sqlStr NVARCHAR(max) = '
   delete from  [ARM_CORE]..[ScheduleDeployRunAsset] where RunID = '+@RunID+' and AssetID in ('+@AssetID+')  
   ';
   EXEC(@sqlStr);
END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UpdateStatusBookings_7] 
@RunID NVARCHAR(255),
@AssetID NVARCHAR(MAX)
AS
BEGIN

DECLARE @sqlStr NVARCHAR(max) = '
   delete from [ARM_CORE]..[ScheduleBooking] where RunID = '+@RunID+' and AssetID in ('+@AssetID+')  
   ';
   EXEC(@sqlStr);
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UpdateStatusBookings_8] @AssetID NVARCHAR(255)
AS
BEGIN
    SELECT ISNULL(a.[Email], '') AS Email,
           ISNULL(a.[UserID], '') AS UserID,
           ISNULL(a.[Owner], '') AS Owner
    FROM [ARM_CORE]..[Asset] a
    WHERE a.AssetID = @AssetID;
END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UpdateStatusBookings_9]
    @WorkStreamID INT,
    @Label NVARCHAR(255),
    @SlotActionID INT,
    @DeployedBit BIT,
    @FailedBit BIT,
    @AssetID NVARCHAR(255),
    @AUSERID NVARCHAR(255),
    @AOWNER NVARCHAR(255),
    @AEMAIL NVARCHAR(255),
    @DepDate DATE,
    @RunID INT,
    @RAssetID NVARCHAR(255),
    @RUserID NVARCHAR(255),
    @ROwner NVARCHAR(255),
    @REmail NVARCHAR(255),
    @AUTH_User NVARCHAR(255)
AS
BEGIN
    INSERT INTO [ARM_CORE]..[A_DeploymentLog]
    (
        [WorkStreamID],
        [Event],
        [EventID],
        [Deployed],
        [Failed],
        [AssetID],
        [UserID],
        [Owner],
        [Email],
        [RunDate],
        [RunID],
        [ReplaceAssetID],
        [ReplaceUserID],
        [ReplaceOwner],
        [ReplaceEmail],
        [AuthUser],
        [AuthDate]
    )
    VALUES
    (@WorkStreamID, @Label, @SlotActionID, @DeployedBit, @FailedBit, @AssetID, @AUSERID, @AOWNER, @AEMAIL, @DepDate,
     @RunID, @RAssetID, @RUserID, @ROwner, @REmail, @AUTH_User, GETDATE());
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UserAccess_1]
    @Auth_User NVARCHAR(255)
AS
BEGIN
SELECT * FROM [ARM_CORE]..[A_User] where [Auth_User] = @Auth_User
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UserAccessDelete_1]
    @Auth_User NVARCHAR(255)
AS
BEGIN
delete from [ARM_CORE]..[A_User] where Auth_User = @Auth_User
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UserAccessEditor_1]
    @Auth_User INT
AS
BEGIN
SELECT UserID, [Auth_User], [Name], BArea, IsNull(Email,'') As Email, Requested, Granted, InternalUse, IssueEditor, SlotViewer, SlotEditor, NotificationEditor, Survey, AppEditor, BookingEditor, ResourceEditor, UserAdmin, SysAdmin, Note FROM [ARM_CORE]..[A_User] where UserID = @Auth_User
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UserAccessPending_1]
   -- @Auth_User INT
AS
BEGIN
SELECT au.UserID, au.[Auth_User], IsNull(u.UserName,'') AS Name, au.Requested, IsNull(u.Email,'') AS Email, au.Granted, au.LastAccess, Note FROM [ARM_CORE]..[A_User] au
 LEFT JOIN [ARM_CORE]..[User] u on u.UserID = replace(au.Auth_User,'ASTELLAS\','') where Granted = 0 order by LastAccess desc, Requested desc, Auth_user 

END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UserAccessUpdate_1]
   @Auth_User NVARCHAR(255)
AS
BEGIN
select Auth_User from [ARM_CORE]..[A_User] where Auth_User = @Auth_User
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UserAccessUpdate_2]
   @Auth_User NVARCHAR(255),
   @Name NVARCHAR(255),
   @Email NVARCHAR(255),
   @Note NVARCHAR(max)
AS
BEGIN
insert [ARM_CORE]..[A_User] (Auth_User,Name,BArea,Email,Granted,[Note]) values (@Auth_User,@Name,'%',@Email,1,@Note)
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UserAccessUpdate_3]
   @Name NVARCHAR(255),
   @Note NVARCHAR(max),
   @BArea NVARCHAR(255),
   @Email NVARCHAR(255),
   @Auth_User NVARCHAR(255)
AS
BEGIN
update [ARM_CORE]..[A_User] set [Name] = @Name ,[Note] = @Note, [BArea] = @BArea, [Email] = @Email where [Auth_user] = @Auth_User
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UserAccessUpdate_4]
    @Granted BIT,
    @HUD BIT,
    @SlotE BIT,
    @SlotV BIT,
    @Issue BIT,
    @Survey BIT,
    @Book BIT,
    @Resource BIT,
    @Notification BIT,
    @Admin BIT,
    @SysAdmin BIT,
    @App BIT,
    @Auth_User NVARCHAR(255)
AS
BEGIN
    UPDATE [ARM_CORE]..[A_User]
    SET Granted = @Granted,
        InternalUse = @HUD,
        SlotEditor = @SlotE,
        SlotViewer = @SlotV,
        IssueEditor = @Issue,
        Survey = @Survey,
        BookingEditor = @Book,
        ResourceEditor = @Resource,
        NotificationEditor = @Notification,
        UserAdmin = @Admin,
        SysAdmin = @SysAdmin,
        AppEditor = @App
    WHERE [Auth_User] = @Auth_User;
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UserAppOwnership_1] @UserID NVARCHAR(255)
AS
BEGIN
    SELECT DISTINCT
           u.[UserID],
           u.[UserName],
           u.[Department],
           u.[BusinessUnit],
           u.[Location],
           u.[JobTitle],
           u.[VIP],
           u.[Telephone],
           u.[Email],
           u.[DirectManager] AS LineDirectManager
    FROM [ARM_CORE]..[User] d
        LEFT JOIN [ARM_CORE]..[User] u
            ON u.UserID = d.DirectManager
    WHERE ISNULL(d.[DirectManager], '') <> ''
          AND d.UserID = @UserID;
END;

GO
CREATE PROCEDURE [dbo].[X_UserAppOwnership_2] @UserID NVARCHAR(255)
AS
BEGIN
   SELECT ISNULL(a.LocalID, '') AS [Local ID],
       c.ApplicationID,
       c.Count,
       ISNULL(a.DeployType, 'TBC') AS [Deploy Type],
       g.AppGroupName,
       g.Criticality
	FROM ARM_CORE..[s_ApplicationToBeInstallCount] c
    LEFT JOIN ARM_CORE..[Application] a  ON a.ApplicationID = c.ApplicationID
    LEFT JOIN ARM_CORE..[AppGroup] g ON g.AppGroupID = a.AppGroupID
    LEFT JOIN ARM_CORE..[User] u ON u.UserID = @UserID
	ORDER BY g.AppGroupName, ApplicationID;


END;
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UserAppOwnership_3] --@UserID NVARCHAR(255)
AS
BEGIN
select FieldName, FieldPattern, IsNull(FieldCondition,'') as FieldCondition from [ARM_CORE]..[A_FieldPattern] where ISNULL(Style,'STD') in ('AppOwnership','STD') order by Style,FieldName
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UserApps_1] @AssetID NVARCHAR(255)
AS
BEGIN
select * from [ARM_CORE]..[ApplicationTransaction] t where t.AssetID = @AssetID order by [When] Desc
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UserBits_1] -- @AssetID NVARCHAR(255)
AS
BEGIN
select [RGB] from [ARM_CORE]..[A_ColourPalette] order by IsNull([Order],50+ColourPaletteID) 
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UserBits_2] @UserID NVARCHAR(255)
AS
BEGIN
    SELECT GroupName,
           Attribute,
           BitPosition,
           CASE
               WHEN a.[BitStatus] & POWER(CONVERT(BIGINT, 2), BitPosition - 1) > 0 THEN
                   1
               ELSE
                   0
           END AS [BitSet],
           (
               SELECT COUNT(*)
               FROM [ARM_CORE]..[A_BitCondition] x
               WHERE x.GroupName = b.GroupName
                     AND x.[Table] = 'User'
           ) AS [ac]
    FROM [ARM_CORE]..[A_BitCondition] b
        LEFT JOIN
        (
            SELECT 1 AS j,
                   BitStatus
            FROM [ARM_CORE]..[User]
            WHERE UserID = @UserID
        ) AS a
            ON a.j = 1
    WHERE b.[Table] = 'User'
    ORDER BY [GroupName],
             [Order],
             Attribute;
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UserManager_1] @UserID NVARCHAR(255)
AS
BEGIN
    SELECT DISTINCT
           u.[UserID],
           u.[UserName],
           u.[Department],
           u.[BusinessUnit],
           u.[Location],
           u.[JobTitle],
           u.[VIP],
           u.[Telephone],
           u.[Email],
           u.[DirectManager] AS LineDirectManager
    FROM [ARM_CORE]..[User] d
        LEFT JOIN [ARM_CORE]..[User] u
            ON u.UserID = d.DirectManager
    WHERE ISNULL(d.[DirectManager], '') <> ''
          AND d.UserID = @UserID;
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UserManager_2] @UserID NVARCHAR(255)
AS
BEGIN
    SELECT DISTINCT
           u.[UserID],
           u.[UserName],
           u.[Email],
           u.[Department],
           u.[BusinessUnit],
           u.[Location],
           u.[JobTitle],
           u.[VIP],
           u.[Telephone],
           u.[Mobile]
    FROM [ARM_CORE]..[User] u
    WHERE ISNULL(u.[Email], '') <> ''
          AND ISNULL(u.[DirectManager], '') = @UserID
    ORDER BY u.[UserName];
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UserSystemAccess_1] @UserID NVARCHAR(255)
AS
BEGIN
   SELECT u.UserName, u.Email, IsNull(u.Domain,'') as Domain FROM [ARM_CORE]..[User] u where u.[UserID] = @UserID
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UserSystemAccess_2] @UserID NVARCHAR(255)
AS
BEGIN
   SELECT s.*, IsNull(r.[Name],'') as [RoleName] FROM [ARM_CORE]..[A_User] s LEFT JOIN [ARM_CORE]..[A_Role] r on r.RoleID = s.RoleID where s.[Auth_User] = @UserID and IsNull(Granted,0) = 1 
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_UserTab_1] @UserID NVARCHAR(255)
AS
BEGIN
   select IsNull(UserID,'') as UserID from [ARM_CORE]..[User] where UserID = @UserID
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_zipMe_1] 
@FileID NVARCHAR(max)
AS
BEGIN

DECLARE @sqlStr NVARCHAR(max) = '
   
select f.* from [ARM_CORE]..[A_File] f where f.FileID in ('+@FileID+') 

   ';
   EXEC(@sqlStr);
END;
  
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AutoNotifications_1] @Active BIT, @AutoNotificationID INT
AS
BEGIN

update [ARM_CORE]..[AutoNotification] set Active = @Active  where AutoNotificationID = @AutoNotificationID

END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AutoNotifications_2] 
AS
BEGIN
        SELECT AutoNotificationID,
       t.Name,
       t.LastRun,
       t.Active,
       ISNULL(t.InProgress, 0) AS Inprogress,
       t.Weekly,
       AudienceFrom,
       AudiencePropertyID,
       DateProperty,
       NotificationTemplate,
       TraceLog,
       f.Name AS CollectionName,
       c.Name AS ChannelName,
       ISNULL(PayLoadSQL, '') AS PayLoadSQL,
       ISNULL(Query, '') AS Query
FROM [ARM_CORE]..[AutoNotification] t
    LEFT JOIN [ARM_CORE]..[ScheduleChannel] c
        ON c.ChannelID = t.AudiencePropertyID
    LEFT JOIN [ARM_CORE]..[A_Collection] f
        ON f.CollectionID = t.AudiencePropertyID
ORDER BY t.[Order],
         t.Name
END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_FilePermissions_1] 
@Name NVARCHAR(50)
AS
BEGIN
delete from [ARM_CORE]..[A_FileAccess] where RoleID = (select top 1 IsNull(RoleID,-1) as RoleID from [ARM_CORE]..[A_Role] where [Name] = @Name )
END;
  
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_FilePermissions_2] 
@Name NVARCHAR(255),
@FileID NVARCHAR(MAX)
AS
BEGIN

DECLARE @sqlStr NVARCHAR(max) = '
   
   MERGE [ARM_CORE]..[A_FileAccess] as TARGET  
   using (select (select top 1 IsNull(RoleID,-1) as RoleID from [ARM_CORE]..[A_Role] where [Name] =  '+@Name+' ) as RoleID, FileID from [ARM_CORE]..[A_File] where FileID in ('+@FileID+')) as SOURCE  
   ON (Target.FileID = Source.FileID and Target.RoleID = Source.RoleID)  
   WHEN NOT MATCHED BY TARGET THEN  
	INSERT (FileID, RoleID)  
	VALUES (Source.FileID, Source.RoleID); 

   ';
   EXEC(@sqlStr);
END;
  

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_FilePermissions_3] 
AS
BEGIN
delete from [ARM_CORE]..[A_FileAccess] where RoleID = 0 
END;
  

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_FilePermissions_4] 
AS
BEGIN
MERGE [ARM_CORE]..[A_FileAccess] AS TARGET
USING
(
    SELECT f.FileID,
           0 AS RoleID
    FROM [ARM_CORE]..[A_File] f
        LEFT JOIN [ARM_CORE]..[A_FileAccess] a
            ON a.FileID = f.FileID
    WHERE a.RoleID IS NULL
          AND ISNULL(f.Ignore, 0) = 0
) AS SOURCE
ON TARGET.FileID = SOURCE.FileID
   AND TARGET.RoleID = SOURCE.RoleID
WHEN NOT MATCHED BY TARGET THEN
    INSERT
    (
        FileID,
        RoleID
    )
    VALUES
    (SOURCE.FileID, SOURCE.RoleID);
END;
  

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_GenerateGlobalFn_1]
AS
BEGIN
    SELECT [PropertyID],
           [PropertyName],
           [PropertyValue],
           [PropertyType],
           [PropertyGroup],
           [PropertyNote]
    FROM [ARM_CORE].[dbo].[SystemGlobalProperties]
    ORDER BY PropertyGroup,
             PropertyName;
END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_GenerateMenuFn2_1]
AS
BEGIN

    SELECT ISNULL(m.[Order], 0) AS OrderBy,
           ISNULL(m.[ParentID], 0) AS TheParentID,
           ISNULL(m.[URL], '') AS Action,
           ISNULL(m.Icon, '') AS Icon,
           (
               SELECT COUNT(Name)FROM [ARM_CORE]..[A_Menu] WHERE ParentID = m.MenuID
           ) AS Children,
           m.*
    FROM [ARM_CORE]..[A_Menu] m
    WHERE ISNULL(m.ParentID, 0) = 0
          AND ISNULL(m.Active, 0) = 1
    ORDER BY [OrderBy],
             [Name];

END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_GenerateMenuFn2_2]
@menuID INT
AS
BEGIN

         SELECT distinct IsNull(r.Name, '') as RoleName  
		 FROM [ARM_CORE]..[A_Menu] m   
		 LEFT JOIN [ARM_CORE]..[A_MenuAccess] a on a.MenuID = m.MenuID   
		 LEFT JOIN [ARM_CORE]..[A_Role] r on r.RoleID = a.RoleID   
		 where m.menuID =@menuID and  IsNull(m.Active,0) = 1 

END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_GenerateMenuFn2_3]
@menuID INT
AS
BEGIN

SELECT m.menuID as ChildMenuID, m.Name, IsNull(m.[Order],0) as OrderBy, IsNull(m.[URL],'') as Action, IsNull(m.[icon],'') as icon2  
from [ARM_CORE]..[A_Menu] m LEFT JOIN [ARM_CORE]..[A_File] f on  m.URL like f.FilePath+'%'   
where IsNull(m.ParentID,0) = @menuID and IsNull(m.Active,0) = 1  
and (NOT f.FileID IS NULL or IsNull(m.override,0) = 1 )  
order by [OrderBy], [Name] 

END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_GenerateMenuFn2_4]
@menuID INT
AS
BEGIN

SELECT distinct IsNull(r.Name, '') as RoleName  
FROM [ARM_CORE]..[A_Menu] m   
LEFT JOIN [ARM_CORE]..[A_File] f on  m.URL like f.FilePath+'%' 
LEFT JOIN [ARM_CORE]..[A_FileAccess] a on a.FileID = f.FileID   
LEFT JOIN [ARM_CORE]..[A_Role] r on r.RoleID = a.RoleID   
where NOT ISNull(m.URL,'') = '' and m.menuID = @menuID and  IsNull(m.Active,0) = 1  
 and (NOT f.FileID IS NULL or IsNull(m.override,0) = 1 ) 

END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_Loadtemplates_1]
@item_Name NVARCHAR(max),
@MessageText NVARCHAR(MAX)
AS
BEGIN

MERGE [ARM_CORE]..[NotificationTemplate]  AS Target USING ( 
	select  @item_Name as [Label], @MessageText as Template ) AS Source 
   ON (Target.[Label] = Source.[Label]) 
   WHEN NOT MATCHED BY TARGET THEN 
     insert (Label, [Template] ) Values (Source.[Label], Source.[Template] ); 

END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_MenuPermissions_1] @Name NVARCHAR(50)
AS
BEGIN
    DELETE FROM [ARM_CORE]..[A_MenuAccess]
    WHERE RoleID =
    (
        SELECT TOP 1
               ISNULL(RoleID, -1) AS RoleID
        FROM [ARM_CORE]..[A_Role]
        WHERE [Name] = @Name
    );
END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_MenuPermissions_2] 
@Name NVARCHAR(255),
@menuID NVARCHAR(MAX)
AS
BEGIN

DECLARE @sqlStr NVARCHAR(max) = '
   
 MERGE [ARM_CORE]..[A_MenuAccess] as TARGET  
 using (select (select top 1 IsNull(RoleID,-1) as RoleID from [ARM_CORE]..[A_Role] where [Name] = '+@Name+' ) as RoleID, MenuID from [ARM_CORE]..[A_Menu] where menuID in ('+@menuID+')) as SOURCE  
 ON (Target.MenuID = Source.MenuID and Target.RoleID = Source.RoleID)  
 WHEN NOT MATCHED BY TARGET THEN  
 	INSERT (MenuID, RoleID)  
	VALUES (Source.MenuID, Source.RoleID); 

   ';
   EXEC(@sqlStr);
END;
  


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_MergePDF_1] 
@CollectionID INT
AS
BEGIN
Select i.ItemID as AssetID  from [ARM_CORE]..[A_CollectionItem] i where i.CollectionID = @CollectionID
END;
  

GO

CREATE PROCEDURE X_Notification_12(@DepRef nvarchar(255))
AS
BEGIN
	select distinct a.[AssetID], IsNull(a.[Email],'') AS Email, IsNull(a.[Owner], '') AS Owner, IsNull(a.[Location],'') AS Location, r.[RunID],
			d.[RunDate], d.[Rundate] as [BDATE], s.[SlotID], s.[DayTxt], s.[Month]
			from [ARM_CORE]..[ScheduleDeployRunAsset] r LEFT JOIN [ARM_CORE]..[Asset] a  ON a.AssetID = r.AssetID
			LEFT JOIN [ARM_CORE]..[ScheduleDeployRun] d ON d.RunID = r.RunID
			LEFT JOIN [ARM_CORE]..[ScheduleSlot] s ON s.SlotID = d.SlotID where d.[Label] = @DepRef AND IsNULL(a.[Email],'[UNSPECIFIED]') <> '[UNSPECIFIED]'

END

GO

CREATE PROCEDURE X_Notification_11(@ItemList nvarchar(255))
AS
BEGIN
	DECLARE @SQL nvarchar(MAX);
	SET @SQL = '
		select distinct c.assetID, c.Email from [ARM_CORE]..[Asset] c 
		where c.AssetID  in ('+@ItemList+') AND IsNull(c.[Email],''[UNSPECIFIED]'') <> ''[UNSPECIFIED]''  
	'
	EXEC(@SQL)

END

GO

CREATE PROCEDURE X_Notification_10(@ItemList nvarchar(255))
AS
BEGIN
	DECLARE @SQL nvarchar(MAX);
	SET @SQL = '
		SELECT [UserID], [UserName], [Department], [BusinessUnit], [Location]
		,[JobTitle], [VIP], [Telephone], [Mobile], Email as [UserEmail], [Email], [Live], [Heartbeat]
	    ,[Notes], [Custom01], [Custom02], [Custom03], [Custom04], [Custom05], [FirstName], [Domain], [DirectManager]
		FROM [ARM_CORE]..[User] where UserID in ('+@ItemList+') AND IsNull([Email],''[UNSPECIFIED]'') <> ''[UNSPECIFIED]''  
	'
	EXEC(@SQL)

END

GO

CREATE PROCEDURE X_Notification_9(@TheItems nvarchar(255))
AS
BEGIN
	DECLARE @SQL nvarchar(MAX);
	SET @SQL = '
		select g.AppGroupName, g.ApplicationOwnerEmail as Email
		from ARM_CORE..AppGroup g where g.AppGroupID in ('+@TheItems+') AND IsNull(g.[ApplicationOwnerEmail],''[UNSPECIFIED]'') <> ''[UNSPECIFIED]''  
	'
	EXEC(@SQL)

END

GO

CREATE PROCEDURE X_Notification_8(@ItemList nvarchar(255))
AS
BEGIN
	DECLARE @SQL nvarchar(MAX);
	SET @SQL = '
		select a.ApplicationID, g.ApplicationOwnerEmail as Email
			from ARM_CORE..[Application] a
			LEFT JOIN ARM_CORE..AppGroup g on g.AppGroupID =  a.AppGroupID
			where a.ApplicationID in ('+@ItemList+') AND IsNull(g.[ApplicationOwnerEmail],''[UNSPECIFIED]'') <> ''[UNSPECIFIED]'' 
	'
	EXEC(@SQL)

END

GO


CREATE PROCEDURE X_Notification_7(@mTemplateType nvarchar(255))
AS
BEGIN
	select TemplateID, Label from [ARM_CORE].[dbo].[NotificationTemplate] n where IsNull(type,'')  = @mTemplateType order by Label
END

GO


CREATE PROCEDURE X_Notification_6
AS
BEGIN
	select distinct IsNull(Type,'') as Type from [ARM_CORE].[dbo].[NotificationTemplate] n order by Type	
END

GO
CREATE PROCEDURE [dbo].[X_Notification_5](@ItemIDRef nvarchar(255))
AS
BEGIN
	IF(@ItemIDRef = 'APPLICATIONID')
		BEGIN 
			select top 1 'APPLICATION' as [NOTIFICATIONTYPE], a.ApplicationID as APPLICATIONID, a.NAME as [APPNAME], a.VERSION,
			a.LOCALID, a.DEPLOYTYPE, a.READY, a.PACKAGEID, a.APPGROUPID, g.APPGROUPNAME--, (select top 1 u.FirstName from [ARM_CORE]..[User] u where u.Email = g.ApplicationOwnerEmail) AS FirstName
			from ARM_CORE..[Application] a
			LEFT JOIN ARM_CORE..AppGroup g on g.AppGroupID =  a.AppGroupID
		END
	ELSE IF(@ItemIDRef = 'APPGROUPID')
		BEGIN
			select top 1 'APPGROUP' as [NOTIFICATIONTYPE], a.ApplicationID as APPLICATIONID, a.NAME as APPGROUPNAME, a.VERSION, a.LOCALID, a.DEPLOYTYPE, a.READY, a.PACKAGEID, a.APPGROUPID, g.APPGROUPNAME
			from ARM_CORE..AppGroup g
			LEFT JOIN ARM_CORE..[Application] a on a.ApplicationID = g.CurrentApplication 
		END
	ELSE IF(@ItemIDRef = 'USERID')
		BEGIN
			SELECT top 1 [UserID],[UserName],[Department],[BusinessUnit],[Location]
			,[JobTitle],[VIP],[Telephone],[Mobile],[Email],[Live],[Heartbeat]  
			,[Notes],[Custom01],[Custom02],[Custom03],[Custom04],[Custom05],[FirstName],[Domain],[DirectManager]
			FROM [ARM_CORE]..[User]
		END
	ELSE IF(@ItemIDRef = 'ASSETID')
		BEGIN
			select top 1 'ASSET' as [NOTIFICATIONTYPE], 'APPS' as [APPLICATIONS], m.[AssetID] AS AssetID, IsNull(m.[Email],'') AS Email, m.BArea, IsNull(m.[Owner],'') AS [Owner], IsNull(m.[Email],'') AS OwnerEmail, IsNull(u.[FirstName],'') AS FirstName,
			IsNull(m.[Location],'') AS Location, m.[TYPE], m.[OS], m.[MODEL],
			IsNull(t.ToBeModel,'') as ToBeModel, 
			IsNull(m.Custom01,'') as Custom01, IsNull(m.Custom02,'') as Custom02, IsNull(m.Custom03,'') as Custom03, IsNull(m.Custom04,'') as Custom04, IsNull(m.Custom05,'') as Custom05
			from [ARM_CORE]..[Asset] m 
			LEFT JOIN [ARM_CORE]..[User] u on u.[Email] = m.[Email]
			LEFT JOIN [ARM_CORE]..[ModelToBe] t ON t.AssetID = m.AssetID
   
		END
END




GO

CREATE PROCEDURE X_Notification_4
AS
BEGIN
	select top 1 'DEPLOYMENT' as [NOTIFICATIONTYPE], a.[AssetID], IsNull(a.[Email],'') AS Email, a.BArea, IsNull(a.[Owner],'') AS [Owner], IsNull(u.[FirstName],'') AS FirstName, IsNull(a.[Location],'') AS Location, r.[RunID], d.[RunDate], d.[RunDate] as [BDATE], a.[TYPE],
		b.BID,IsNull(t.TID,'0') AS TID,IsNull(t.Label,'UNSPECIFIED') as BTime, a.[OS], a.[MODEL],
		IsNull ( (select top 1 k.Model from [ARM_CORE]..[Asset] k where k.AssetID = j.[ReplaceWith]),'' ) as NewModel, IsNull(m.ToBeModel,'') as ToBeModel, IsNull(j.[ReplaceWith],'') as [ReplaceWith],
		IsNull(altO.AltTargetOS,(select top 1 om.[TargetOS] from OSMappings om where om.[InitialOS] like a.[OS]+'%' )) AS NewOS,
		IsNull(a.Custom01,'') as Custom01, IsNull(a.Custom02,'') as Custom02, IsNull(a.Custom03,'') as Custom03, IsNull(a.Custom04,'') as Custom04, IsNull(a.Custom05,'') as Custom05,
		d.[ChannelID] as CID, c.[Name] AS Channel, s.[SlotID], s.[DayTxt], s.[Month], IsNull(i.TheText,'') AS [BINSTRUCTIONS]
		from [ARM_CORE]..[ScheduleDeployRunAsset] r
		LEFT JOIN [ARM_CORE]..[Asset] a  ON a.AssetID = r.AssetID
		LEFT JOIN [ARM_CORE]..[User] u on u.[Email] = a.[Email]
		LEFT JOIN [ARM_CORE]..[ScheduleDeployRun] d ON d.RunID = r.RunID
		LEFT JOIN [ARM_CORE]..[ScheduleChannel] c ON c.ChannelID = d.ChannelID
		LEFT JOIN [ARM_CORE]..[ScheduleSlot] s ON s.SlotID = d.SlotID
		LEFT JOIN [ARM_CORE]..[ScheduleBookDay] b ON b.ChannelID = d.[ChannelID] and b.TheDate = d.[RunDate]
		LEFT JOIN [ARM_CORE]..[ScheduleBooking] z ON z.AssetID = r.AssetID
		LEFT JOIN [ARM_CORE]..[ScheduleTimeSlot] t on t.BID = b.BID and t.TID = z.TID
		LEFT JOIN [ARM_CORE]..[ScheduleInstruction] i ON i.ChannelID = d.[ChannelID]
		LEFT JOIN [ARM_CORE]..[AssetStatus] j on j.AssetID = r.AssetID
		LEFT JOIN [ARM_CORE]..[ModelToBe] m ON m.AssetID = r.AssetID
		LEFT JOIN [ARM_CORE]..[AltModelType] altM on altM.[AssetID]=a.AssetID
		LEFT JOIN [ARM_CORE]..[AltTargetOS] altO on altO.[AssetID]=a.AssetID 
		
END

GO
CREATE PROCEDURE X_Notification_3
AS
BEGIN
	select top 1 'APPLICATION' as [NOTIFICATIONTYPE], a.ApplicationID as APPLICATIONID, a.NAME as [APPNAME], a.VERSION, a.LOCALID, a.DEPLOYTYPE, a.READY, a.PACKAGEID, a.APPGROUPID, g.APPGROUPNAME
			from ARM_CORE..[Application] a
			LEFT JOIN ARM_CORE..AppGroup g on g.AppGroupID =  a.AppGroupID 
		
END



GO

CREATE PROCEDURE X_Notification_2(@workStreamID INT)
AS
BEGIN
	select IsNull(SentFrom,'') as SentFrom,  IsNull(ReplyTo,'') as ReplyTo from [ARM_CORE]..[Workstream] where WorkstreamID = @workStreamID 
		
END

GO
CREATE PROCEDURE X_Notification_1(@mTempleteID INT)
AS
BEGIN
	select [TemplateID],IsNull([Subject],'') as Subject, IsNull([SendFrom],'') as SendFrom, IsNull([ReplyTo], '') as [ReplyTo], IsNull([CC],'') as [CC], IsNull([BCC],'') as [BCC]
			,IsNull([Type],'') as [Type], IsNull([Label],'') as [Label], IsNull([Important],0) as [Important], IsNull([ReadReceipt],0) as [ReadReceipt], [Template] from [ARM_CORE].[dbo].[NotificationTemplate] n where n.templateID =  @mTempleteID
		
END

GO
CREATE PROCEDURE X_NotificationEditor_7(@mTempleteType nvarchar(255))
AS
BEGIN
	select TemplateID, Label from [ARM_CORE].[dbo].[NotificationTemplate] n where IsNull(type,'')  = @mTempleteType order by Label 
		
END
GO
CREATE PROCEDURE X_NotificationEditor_6
AS
BEGIN
	select distinct * from (select '' as Type union all select distinct IsNull(Type,'') as Type from [ARM_CORE].[dbo].[NotificationTemplate] n ) t order by Type
		
END

GO


CREATE PROCEDURE [dbo].[X_NotificationEditor_5](@dTempleteID INT)
AS
BEGIN
	select [TemplateID],IsNull([Subject],'') as Subject, IsNull([SendFrom],'') as SendFrom, IsNull([ReplyTo], '') as [ReplyTo], IsNull([CC],'') as [CC], IsNull([BCC],'') as [BCC], IsNull(ReadOnly,0) as ReadOnly
			,IsNull([Type],'') as [Type], IsNull([Label],'') as [Label], IsNull(n.[Important],0) as [Important], IsNull(n.[ReadReceipt],0) as [ReadReceipt], [Template], IsNull(n.[DataSet],0) as [DataSet]
			from [ARM_CORE].[dbo].[NotificationTemplate] n where n.templateID =  @dTempleteID
		
END

GO
CREATE PROCEDURE [dbo].[X_NotificationEditor_4](
@mSubject nvarchar(255),
@mSendFrom nvarchar(255),
@mReplyTO nvarchar(255),
@mcc nvarchar(1000),
@mBcc nvarchar(1000),
@mTemplateType nvarchar(255),
@readreceipt bit,
@important bit,
@mDataSet int,
@mTemplate nvarchar(MAX),
@mTemplateId int)
AS
BEGIN

	update [ARM_CORE]..[NotificationTemplate] 
		set [Subject] = @mSubject, [SendFrom] = @mSendFrom, [ReplyTo] = @mReplyTO, [CC] = @mcc, [BCC] = @mBcc
		,[DataSet] = @mDataSet , [Type] = @mTemplateType ,  [readreceipt] = @readreceipt, [important] = @important, [Template]= @mTemplate  
	where templateID = @mTemplateId

END

GO
CREATE PROCEDURE X_NotificationEditor_3(@newLabel nvarchar(255))
AS
BEGIN
	select * from [ARM_CORE]..[NotificationTemplate] where [Label] = @newLabel
END


GO

CREATE PROCEDURE [dbo].[X_NotificationEditor_2](
@mSubject nvarchar(255),
@mSendFrom nvarchar(255),
@mReplyTO nvarchar(255),
@mcc nvarchar(1000),
@mBcc nvarchar(1000),
@mTemplateType nvarchar(255),
@mLabel nvarchar(255),
@readreceipt bit,
@important bit,
@mDataSet int,
@mTemplate nvarchar(MAX),
@mTemplateId int)
AS
BEGIN

	update [ARM_CORE]..[NotificationTemplate] 
		set [Subject] = @mSubject, [SendFrom] = @mSendFrom, [ReplyTo] = @mReplyTO, [CC] = @mcc, [BCC] = @mBcc
		,[Type] = @mTemplateType , [Label]= @mLabel , [readreceipt] = @readreceipt, [important] = @important
		,[DataSet] = @mDataSet, [Template]= @mTemplate  
	where templateID = @mTemplateId

END

GO
CREATE PROCEDURE X_NotificationEditor_1(@dTempleteID INT)
AS
BEGIN
	delete from [ARM_CORE]..[NotificationTemplate] where templateID =  @dTempleteID
END

GO

CREATE PROCEDURE X_NotificationsByAssets_4(@DepRef nvarchar(255))
AS
BEGIN
	select distinct a.[AssetID], IsNull(a.[Email],'') AS Email, IsNull(a.[Owner], '') AS Owner, IsNull(a.[Location],'') AS Location, r.[RunID],
			 d.[RunDate], s.[SlotID], s.[DayTxt], s.[Month]
			 from [ARM_CORE]..[ScheduleDeployRunAsset] r LEFT JOIN [ARM_CORE]..[Asset] a  ON a.AssetID = r.AssetID
			 LEFT JOIN [ARM_CORE]..[ScheduleDeployRun] d ON d.RunID = r.RunID 
			 LEFT JOIN [ARM_CORE]..[ScheduleSlot] s ON s.SlotID = d.SlotID where d.[Label] = @DepRef AND IsNULL(a.[Email],'[UNSPECIFIED]') <> '[UNSPECIFIED]' 

END

GO

CREATE PROCEDURE X_NotificationsByAssets_3(@ItemList nvarchar(255))
AS
BEGIN
	DECLARE @SQL nvarchar(MAX);
	SET @SQL = '
		select distinct c.assetID, c.Email from [ARM_CORE]..[Asset] c
		where c.AssetID  in ('+@ItemList+') AND IsNull(c.[Email],''[UNSPECIFIED]'') <> ''[UNSPECIFIED]''
	'
	EXEC(@SQL)

END

GO

CREATE PROCEDURE X_NotificationsByAssets_2(@DepRef nvarchar(255))
AS
BEGIN
	select r.RunID, (Select Count (AssetID) from RunAssets$ z where z.RunID = r.RunID) As AC, r.SlotID, r.Status, r.RunDate, r.Label  from DeployRun$ r where r.Label =  @DepRef   order by Label 
		
END

GO
CREATE PROCEDURE X_NotificationsByAssets_1(@workStreamID INT)
AS
BEGIN
	select IsNull(SentFrom,'') as SentFrom,  IsNull(ReplyTo,'') as ReplyTo from [ARM_CORE]..[Workstream] where WorkstreamID = @workStreamID 
		
END

GO

CREATE PROCEDURE X_NotificationSend_13(@NOTIFICATIONTYPE nvarchar(255),@ItemID nvarchar(255),@Auth_User nvarchar(255),@TempSel nvarchar(255),@EMAIL nvarchar(255),@TheStatus nvarchar(255),@vbCrLf nvarchar(255),@SubjectMatter nvarchar(255))
AS
BEGIN
	DECLARE @SQL nvarchar(MAX)
	SET @SQL='
		insert into [ARM_CORE]..[A_CommentLog] ([Table], [Type], [RecordID], [Author], [TimeStamp], [Internal], [Comment])
		values ('+@NOTIFICATIONTYPE+','''','+@ItemID+','+@Auth_User+','+CAST(getdate() AS nvarchar(255))+',0,''Sent "'+@TempSel+'" Notification to "  replace('+@EMAIL+',"''","''''")  ('+@TheStatus+')  '+@vbCrLf+' "Subject: '+@SubjectMatter+''')
	'
	EXEC(@SQL)
END

GO

CREATE PROCEDURE X_NotificationSend_12(@NoteName nvarchar(255),@ConcatName nvarchar(255),@Email nvarchar(255),@ItemID nvarchar(255),@TempSel nvarchar(255),@TheStatus nvarchar(255))
AS
BEGIN
	DECLARE @SQL nvarchar(MAX)
	SET @SQL='
		insert [ARM_CORE]..[NotificationLOG] (Name, Owner, Email, AssetID, AutoNotificationID, TemplateUsed, Status, [Type])
		values ('+@NoteName+',replace('+@ConcatName+',"''","''''") ,replace('+@Email+',"''","''''"),'+@ItemID+',0,'+@TempSel+','+@TheStatus+',''Manual from Console'' ) 
	'
	EXEC(@SQL)
END

GO

CREATE PROCEDURE X_NotificationSend_11(@lanGuage nvarchar(255))
AS
BEGIN
	DECLARE @SQL nvarchar(MAX)
	SET @SQL='
		select IsNull((SELECT [Pack] FROM [ARM_CORE].[dbo].[A_LanguageCode] where Active = 1 and Code = '+@lanGuage+'),IsNull((SELECT [Pack] FROM [ARM_CORE].[dbo].[A_LanguageCode] where Active = 1 and Code = '+LEFT(@lanGuage,2)+'),''en.xml'')) as [Pack]
					, IsNull((SELECT [Language] FROM [ARM_CORE].[dbo].[A_LanguageCode] where Active = 1 and Code = '+@lanGuage+'),IsNull((SELECT [Language] FROM [ARM_CORE].[dbo].[A_LanguageCode] where Active = 1 and Code = '+LEFT(@lanGuage,2)+'),''English'')) as [Language]
					, IsNull((SELECT [Icon] FROM [ARM_CORE].[dbo].[A_LanguageCode] where Active = 1 and Code = '+@lanGuage+'),IsNull((SELECT [Icon] FROM [ARM_CORE].[dbo].[A_LanguageCode] where Active = 1 and Code = '+LEFT(@lanGuage,2)+'),''gb'')) as [Icon]
	'
	EXEC(@SQL)
END

GO

CREATE PROCEDURE X_NotificationSend_10(@userID nvarchar(255))
AS
BEGIN
	select IsNull(LANGUAGE,'') as LANGUAGE from [ARM_CORE]..[User] where UserID = @userID
END

GO

CREATE PROCEDURE X_NotificationSend_9(@bUUID nvarchar(255))
AS
BEGIN
	select [ButtonID],  IsNull(Label,'Press Me') as [xLabel], IsNull(Colour,'3A68A1') as [xColour], IsNull(Style,'') as [xStyle], IsNull(Params,'') as [xParams], '1' as dummy from [ARM_CORE]..[NotificationTemplateButton] where CAST([UUID] AS nvarchar(255)) = @bUUID
END

GO

CREATE PROCEDURE X_NotificationSend_8(@SlotID nvarchar(255))
AS
BEGIN
	select TOP 1 Date from [ARM_CORE]..[ScheduleSlot] where Date <= (select top 1 Date from [ARM_CORE]..[ScheduleSlot] where SlotID = @SlotID order by Date Desc) and SlotID like '%-2-%' order by Date Desc
END

GO

CREATE PROCEDURE X_NotificationSend_7(@ItemList nvarchar(255))
AS
BEGIN
	DECLARE @SQL nvarchar(MAX);
	SET @SQL = '
		select ''ASSET'' as [NOTIFICATIONTYPE], m.[AssetID] AS ASSETID, IsNull(m.[Email],'''') AS EMAIL, m.BAREA, IsNull(m.[Owner],'''') AS [OWNER], IsNull(m.[Email],'''') AS OWNEREMAIL, IsNull(u.[FirstName],'''') AS FIRSTNAME,
					IsNull(m.[Location],'''') AS LOCATION, m.[TYPE], m.[OS], m.[MODEL],
					IsNull ( (select top 1 k.Model from [ARM_CORE]..[Asset] k where k.AssetID = j.[ReplaceWith] ),'''' ) as NEWMODEL, IsNull(t.ToBeModel,'''') as TOBEMODEL, j.[REPLACEWITH],
					IsNull(m.Custom01,'''') as CUSTOM01, IsNull(m.Custom02,'''') as CUSTOM02, IsNull(m.Custom03,'''') as CUSTOM03, IsNull(m.Custom04,'''') as CUSTOM04, IsNull(m.Custom05,'''') as CUSTOM05,
					IsNull(altO.AltTargetOS,(select top 1 om.[TargetOS] from OSMappings om where om.[InitialOS] like m.[OS]+''%'' )) AS NEWOS
					from [ARM_CORE]..[Asset] m
					LEFT JOIN [ARM_CORE]..[User] u on u.[Email] = m.[Email]
					LEFT JOIN [ARM_CORE]..[AssetStatus] j on j.AssetID = m.AssetID
					LEFT JOIN [ARM_CORE]..[ModelToBe] t ON t.AssetID = m.AssetID
					LEFT JOIN [ARM_CORE]..[AltModelType] altM on altM.[AssetID]=m.AssetID
					LEFT JOIN [ARM_CORE]..[AltTargetOS] altO on altO.[AssetID]=m.AssetID
					where m.AssetID in ('+@ItemList+') AND IsNULL(m.[Email],'''') <> ''''
	'
	EXEC(@SQL)

END

GO

CREATE PROCEDURE X_NotificationSend_6(@ItemList nvarchar(255))
AS
BEGIN
	DECLARE @SQL nvarchar(MAX);
	SET @SQL = '
		SELECT [USERID], [USERNAME], [DEPARTMENT], [BUSINESSUNIT], [LOCATION]
					,[JOBTITLE], [VIP], [TELEPHONE], [MOBILE], EMAIL as [USEREMAIL], [EMAIL], [LIVE], [HEARTBEAT]
					,[NOTES], [CUSTOM01], [CUSTOM02], [CUSTOM03], [CUSTOM04], [CUSTOM05], [FIRSTNAME], [DOMAIN], [DIRECTMANAGER]
					FROM [ARM_CORE]..[User] where UserID in ('+@ItemList+') AND IsNull([Email],''[UNSPECIFIED]'') <> ''[UNSPECIFIED]''
	'
	EXEC(@SQL)

END

GO

CREATE PROCEDURE X_NotificationSend_5(@TheItems nvarchar(255))
AS
BEGIN
	DECLARE @SQL nvarchar(MAX);
	SET @SQL = '
		select ''APPGROUP'' as [NOTIFICATIONTYPE], a.ApplicationID as APPLICATIONID, g.ApplicationOwnerEmail as EMAIL, a.NAME as [APPNAME], a.VERSION, g.[ApplicationOwner] as APPOWNER, g.ApplicationOwnerEmail as APPOWNEREMAIL,
		a.LOCALID, a.DEPLOYTYPE, a.READY, a.PACKAGEID, g.ISOWNER, g.ISOWNEREMAIL, a.APPGROUPID, g.APPGROUPNAME, (select top 1 u.FirstName from [ARM_CORE]..[User] u where u.Email = g.ApplicationOwnerEmail) AS FirstName
		from ARM_CORE..AppGroup g 
		LEFT JOIN ARM_CORE..[Application] a on a.ApplicationID = g.CurrentApplication
		where g.AppGroupID in ('+@TheItems+') AND IsNull(g.[ApplicationOwnerEmail],''[UNSPECIFIED]'') <> ''[UNSPECIFIED]'' 
	'
	EXEC(@SQL)

END

GO


CREATE PROCEDURE X_NotificationSend_4(@ItemList nvarchar(255))
AS
BEGIN
	DECLARE @SQL nvarchar(MAX);
	SET @SQL = '
		select ''APPLICATION'' as [NOTIFICATIONTYPE], a.ApplicationID as APPLICATIONID, g.ApplicationOwnerEmail as EMAIL, a.NAME as [APPNAME], a.VERSION, g.[ApplicationOwner] as APPOWNER, g.ApplicationOwnerEmail as APPOWNEREMAIL,
					a.LOCALID, a.DEPLOYTYPE, a.READY, a.PACKAGEID, g.ISOWNER, g.ISOWNEREMAIL, a.APPGROUPID, g.APPGROUPNAME, (select top 1 u.FirstName from [ARM_CORE]..[User] u where u.Email = g.ApplicationOwnerEmail) AS FirstName
					from ARM_CORE..[Application] a
					LEFT JOIN ARM_CORE..AppGroup g on g.AppGroupID =  a.AppGroupID
					where a.ApplicationID in ('+@ItemList+') AND IsNull(g.[ApplicationOwnerEmail],''[UNSPECIFIED]'') <> ''[UNSPECIFIED]''
	'
	EXEC(@SQL)

END

GO

CREATE PROCEDURE X_NotificationSend_3(@TheRunRef nvarchar(255),@ItemList nvarchar(255))
AS
BEGIN
	DECLARE @SQL nvarchar(max);

	SET @SQL = '
		select  ''ASSET'' as [NOTIFICATIONTYPE], a.[AssetID], IsNull(a.[AssetTag],''No Asset Tag'') AS [AssetTag], IsNull(a.[Email],'''') AS Email, a.BArea, IsNull(a.[Owner],'''') AS [Owner], IsNull(u.[FirstName],'''') AS FirstName, IsNull(a.[Location],'''') AS Location, r.[RunID], d.[RunDate], d.[RunDate] as [BDATE], a.[TYPE],
				b.BID,IsNull(t.TID,''0'') AS TID,IsNull(t.Label,''UNSPECIFIED'') as BTime, a.[OS], a.[MODEL], IsNull(c.[WorkstreamID],0) as WorkstreamID,
				IsNull ( (select top 1 k.Model from [ARM_CORE]..[Asset] k where k.AssetID = j.[ReplaceWith]),'''' ) as NewModel, IsNull(m.ToBeModel,'''') as ToBeModel, IsNull(j.[ReplaceWith],'''') as [ReplaceWith],
				IsNull(altO.AltTargetOS,(select top 1 om.[TargetOS] from OSMappings om where om.[InitialOS] like a.[OS]+''%'' )) AS NewOS,
				IsNull(a.Custom01,'''') as Custom01, IsNull(a.Custom02,'''') as Custom02, IsNull(a.Custom03,'''') as Custom03, IsNull(a.Custom04,'''') as Custom04, IsNull(a.Custom05,'''') as Custom05,
				d.[ChannelID] as CID, c.[Name] AS Channel, d.[SlotID], i.InstrID, IsNull(i.TheText,'''') AS [BINSTRUCTIONS]
				from [ARM_CORE]..[ScheduleDeployRunAsset] r
				LEFT JOIN [ARM_CORE]..[Asset] a  ON a.AssetID = r.AssetID
				LEFT JOIN [ARM_CORE]..[User] u on u.[Email] = a.[Email] 
				LEFT JOIN [ARM_CORE]..[ScheduleDeployRun] d ON d.RunID = r.RunID
				LEFT JOIN [ARM_CORE]..[ScheduleChannel] c ON c.ChannelID = d.ChannelID
				LEFT JOIN [ARM_CORE]..[ScheduleBookDay] b ON b.ChannelID = d.[ChannelID] and b.TheDate = d.[RunDate]
				LEFT JOIN [ARM_CORE]..[ScheduleBooking] z ON z.AssetID = r.AssetID and z.RunID = r.RunID
				LEFT JOIN [ARM_CORE]..[ScheduleTimeSlot] t on t.BID = b.BID and t.TID = z.TID
				LEFT JOIN [ARM_CORE]..[ScheduleInstruction] i ON i.ChannelID = d.[ChannelID]
				LEFT JOIN [ARM_CORE]..[AssetStatus] j on j.AssetID = r.AssetID
				LEFT JOIN [ARM_CORE]..[ModelToBe] m ON m.AssetID = r.AssetID
				LEFT JOIN [ARM_CORE]..[AltModelType] altM on altM.[AssetID]=a.AssetID
				LEFT JOIN [ARM_CORE]..[AltTargetOS] altO on altO.[AssetID]=a.AssetID
				where d.[Label] = '+@TheRunRef+' AND IsNULL(a.[Email],'''') <> '''' and a.AssetID in ('+@ItemList+')
	'
	EXEC (@SQL)
END

GO
CREATE PROCEDURE X_NotificationSend_2(@ApplicationKey nvarchar(255))
AS
BEGIN
	select 'APPLICATION' as [NOTIFICATIONTYPE], a.ApplicationID as APPLICATIONID, a.NAME as [APPNAME], a.VERSION, a.LOCALID, a.DEPLOYTYPE, a.READY, a.PACKAGEID, a.APPGROUPID, g.APPGROUPNAME
				from ARM_CORE..[Application] a
				LEFT JOIN ARM_CORE..AppGroup g on g.AppGroupID =  a.AppGroupID
				where a.ApplicationID = @ApplicationKey
END



GO
CREATE PROCEDURE X_NotificationSend_1
AS
BEGIN
	select Isnull(s.Marker,'') as Marker, IsNull(s.Snippet,'') as Snippet from [ARM_CORE]..[A_Snippet] s order by s.Marker		
END

GO
CREATE PROCEDURE X_PrintSlotPDF_1(@RunID BigINT)
AS
BEGIN
	Select c.Name as [Booking Channel], r.AssetID, d.RunDate as [Date], a.Owner, a.Email, a.[Model] 
   from [ARM_CORE]..[ScheduleDeployRun] d 
   LEFT Join [ARM_CORE]..[ScheduleDeployRunAsset] r on r.RunID = d.RunID
   LEFT Join [ARM_CORE]..[Asset] a on a.AssetID = r.AssetID  
   LEFT Join [ARM_CORE]..[ScheduleChannel] c on c.ChannelID = d.ChannelID
   Where d.RunID = @RUNID and NOT r.AssetID IS NULL
   Order by RunDate, AssetID, Owner, Email 
END

GO
CREATE PROCEDURE X_PublishedSurveys_1
AS
BEGIN
	SELECT s.SID,s.Title,s.Published,s.PublishedOn,s.Active,s.[KEY],s.[Auth_User],(select count(r.RID) from [ARM_CORE]..[SurveyResponse] r where r.SID = s.SID) AS [RC] from [ARM_CORE]..[Survey] s order By  Title, PublishedOn
END

GO

CREATE PROCEDURE [dbo].[X_QuickSearch_6](@AppSearchTerm nvarchar(max))
AS
BEGIN
	DECLARE @SQL nvarchar(max);

	SET @SQL ='
		select distinct RTRIM(s.[ApplicationID]) AS [KEY],IsNull(g.AppGroupName,s.[ApplicationID]) AS [Friendly], i.LocalID,
			(select count(distinct a.AssetID) from [ARM_CORE]..[Asset] a LEFT JOIN [ARM_CORE]..[BArea] b on b.BArea = a.BArea LEFT JOIN [ARM_CORE]..[AppAstAsIs] z  on z.AssetID = a.AssetID where z.[ApplicationID] = s.[ApplicationID] and a.Live = 1 and IsNull(b.Internal,1) = 0) AS IC
			from [ARM_CORE]..[AppAstToBe] s
			LEFT JOIN [ARM_CORE]..[Application] i on i.[ApplicationID] = s.[ApplicationID]
			LEFT JOIN [ARM_CORE]..[AppGroup] g on g.[AppGroupID] = i.[AppGroupID]
			where   (s.[ApplicationID] like ''%'+@AppSearchTerm+'%'' or i.[LocalID] = '''+@AppSearchTerm+''' )
			order by [KEY] ASC 
	'
	EXEC(@SQL)
END

GO

CREATE PROCEDURE [dbo].[X_QuickSearch_5](@AppSearchTerm nvarchar(max))
AS
BEGIN
	DECLARE @SQL nvarchar(max);

	SET @SQL ='
		select  Count(distinct s.ApplicationID) AS RC
			from [ARM_CORE]..[Application] i
			LEFT JOIN [ARM_CORE]..[AppAstToBe] s on i.[ApplicationID] = s.[ApplicationID] 
			where s.[ApplicationID] like ''%'+@AppSearchTerm+'%'' or i.[LocalID] = '''+@AppSearchTerm+'''
	'
	EXEC(@SQL)
END

GO
CREATE PROCEDURE [dbo].[X_QuickSearch_4](@top INT,@searchClause nvarchar(max))
AS
BEGIN
	DECLARE @SQL nvarchar(max);

	SET @SQL ='
		select top '+cast(@top as nvarchar(20))+' a.AssetID, a.[Type], IsNull(a.[Model],'''') as [Model], a.[Heartbeat], IsNull(a.[SerialNumber],'''') as SerialNumber,
		a.[OS], IsNull(a.Live,0) as Live,
		a.[UserID], IsNull(IsNull(a.[Owner],u.[UserName]),'''') as Owner, a.[Location], IsNull(IsNull(a.[Email],u.[Email]),'''') AS Email,
		IsNull(a.[AssetTAG],'''') AS AssetTag,  a.[Location],
		 a.[BArea], a.[Warrantydate]
		from [ARM_CORE]..[Asset] a
		LEFT JOIN [ARM_CORE]..[User] u on u.UserID = a.AssetID
		'+@searchClause+' order by a.[Heartbeat] desc 
	'
	EXEC(@SQL)
END

GO

CREATE PROCEDURE [dbo].[X_QuickSearch_3](@top INT,@searchClause nvarchar(max))
AS
BEGIN
	DECLARE @SQL nvarchar(max);

	SET @SQL ='
		select top '+cast(@top as nvarchar(20))+' x.UserID, IsNull(x.Live,0) as Live, IsNull(x.[UserName],'''') as UserName, IsNull(x.[Email],'''') AS Email,
		IsNull(x.[BusinessUnit],'''') AS BArea, IsNull(x.[JobTitle],'''') as JobTitle
		from [ARM_CORE]..[User] x  '+@searchClause+' order by x.Live Desc, x.[UserID] 
	'
	EXEC(@SQL)
END

GO

CREATE PROCEDURE X_QuickSearch_2(@searchClause nvarchar(max))
AS
BEGIN
	DECLARE @SQL nvarchar(max);

	SET @SQL ='
		select a.AssetID, (select count(AssetID) from [ARM_CORE]..[Asset] a '+@searchClause+') AS Total
		from [ARM_CORE]..[Asset] a '+@searchClause+'
	'
	EXEC(@SQL)
END

GO
CREATE PROCEDURE X_QuickSearch_1(@searchClause nvarchar(max))
AS
BEGIN
	DECLARE @SQL nvarchar(max);

	SET @SQL ='
		select x.UserID, (select count(x.userID) from [ARM_CORE]..[User] x '+@searchClause+') AS Total
		from [ARM_CORE]..[User] x '+@searchClause+'
	'
	EXEC(@SQL)
END

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_RegisterFiles_1] 
@url NVARCHAR(max),
@item_Name NVARCHAR(max),
@item_size NVARCHAR(max),
@folder_name NVARCHAR(max),
@Label NVARCHAR(max),
@item_DateLastModified NVARCHAR(50),
@SyncDate NVARCHAR(50),
@updateFields NVARCHAR(max)
AS
BEGIN

DECLARE @sqlStr NVARCHAR(max) = '
   
  MERGE [ARM_CORE]..[A_File]  AS Target USING (
  select '+@url+' as FilePath, '+@item_Name+' as [Name], '+@item_size+' as Size, '+@folder_name+' as GroupName, '+@Label+' as Folder, Convert(datetime,'+@item_DateLastModified+',103) as LastModified, Convert(datetime,'+@SyncDate+',103) as SyncDateTime ) AS Source
  ON (Target.FilePath = Source.[FilePath])
  WHEN MATCHED THEN '+@updateFields+'
  WHEN NOT MATCHED BY TARGET THEN
    insert (FilePath, [GroupName], [Name], [Size], [Folder], [LastModified], [LastSync] ) Values (Source.[FilePath], Source.[GroupName], Source.[Name], Source.[Size], Source.[Folder], Source.[LastModified], Source.[SyncDateTime] ); 

   ';
   EXEC(@sqlStr);
END;
  


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_RegisterFiles_2] 
AS
BEGIN

MERGE [ARM_CORE]..[A_FileAccess] AS Target USING (	SELECT f.FileID from [ARM_CORE]..[A_File] f LEFT JOIN [ARM_CORE].[dbo].[A_FileAccess] fa on fa.FileID = f.FileID where fa.FileID IS NULL and IsNull(f.Ignore,0) = 0  ) AS SOURCE  
	ON (Target.FileID = Source.FileID) 
	WHEN NOT MATCHED BY TARGET THEN 
	INSERT (FileID, RoleID) Values (Source.FileID,0); 
END;
  


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_RegisterFiles_3] 
AS
BEGIN
select * from [ARM_CORE]..[A_File]
END;
  


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_RegisterFiles_4] 
@FileID INT
AS
BEGIN
delete from [ARM_CORE]..[A_FileAccess] where FileID = @FileID
END;
  


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_RegisterFiles_5] 
@FileID INT
AS
BEGIN
delete from [ARM_CORE]..[A_File] where FileID = @FileID
END;
  


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_RoleSwitch_1] 
@RoleID INT,
@Auth_User NVARCHAR(255)
AS
BEGIN
update [ARM_CORE]..[A_User] set RoleID = @RoleID where AUTH_USER = @Auth_User
END;
  


GO

CREATE PROCEDURE X_ScheduleShiftRange_2(@newLabel nvarchar(255),@NextDate date,@nextSlot nvarchar(255),@runID bigint)
AS
BEGIN
	update [ARM_CORE]..[ScheduleDeployRun] set Label = @newLabel, RunDate = @NextDate, slotID = @nextSlot where RunID = @runID

END

GO
CREATE PROCEDURE X_ScheduleShiftRange_1(@newLabel nvarchar(255))
AS
BEGIN
	select Count(runID) AS RefCount from [ARM_CORE]..[ScheduleDeployRun] where Label = @newLabel

END

GO
CREATE PROCEDURE X_ScheduleSummary_1(@channelID INT)
AS
BEGIN
	select [ChannelID], [Name] from [ARM_CORE]..[ScheduleChannel] where channelID = @channelID
END

GO

CREATE PROCEDURE X_ScheduleView_2
AS
BEGIN
	Select w.WorkstreamID, w.Name from [ARM_CORE]..[Workstream] w where w.Active = 1 order by Name		
END

GO
CREATE PROCEDURE X_ScheduleView_1(@BackDays INT = 1)
AS
BEGIN
	Select c.ChannelID, c.name, c.Bookable, c.AssetType,
		(select count(b.AssetID) from [ARM_CORE]..[ScheduleBooking] b
				LEFT JOIN [ARM_CORE]..[ScheduleTimeSlot] t on t.TID = b.TID
				LEFT JOIN [ARM_CORE]..[ScheduleBookDay] d on d.BID = t.BID 
		 where d.ChannelID = c.ChannelID and d.[TheDate] >= DATEADD(D,@BackDays * -1 , GETDATE())) AS BCount,
		(select IsNull(sum(t.MaxBooking),0)  from [ARM_CORE]..[ScheduleTimeSlot] t left join [ARM_CORE]..[ScheduleBookday] b on b.BID = t.BID
		 where b.ChannelID = c.ChannelID  and b.[TheDate] >= getDate()-7) AS CBookCount
		from [ARM_CORE]..[ScheduleChannel] c where c.Bookable = 1 order by c.Name
		
	
		
END

GO

CREATE PROCEDURE X_ScheduleView_Old_3(@BackDays INT = 1,@CID_Clause nvarchar(255))
AS
BEGIN

		DECLARE @SQL nvarchar(max);
		SET @SQL='
			Select a.AssetID, s.RunDate as TheDate, Month(s.RunDate) As TheMonth, Year(s.RunDate) As TheYear, IsNull(t.Label,''Manually Scheduled'') as Label, IsNull(t.MaxBooking,0) as MaxBooking,
			t.Duration, IsNull(t.Active,1) as Active, a.Owner, a.Email, a.[Type], a.[Model], c.[Name], a.[BArea]
		from [ARM_CORE]..[ScheduleDeployRun] s
		LEFT Join [ARM_CORE]..[ScheduleDeployRunAsset] r on r.RunID = s.RunID
		LEFT Join [ARM_CORE]..[Asset] a on a.AssetID = r.AssetID
		LEFT Join [ARM_CORE]..[ScheduleBooking] b on b.RunID = s.RunID and b.AssetID = r.AssetID
		LEFT Join [ARM_CORE]..[ScheduleTimeSlot] t on t.TID = b.TID 
		LEFT Join [ARM_CORE]..[ScheduleChannel] c on c.ChannelID = s.ChannelID
		Where  '+@CID_Clause+' s.RunDate >= DATEADD(D,'+@BackDays+' * '+CAST(-1 AS NVARCHAR(255))+' , GETDATE())  and NOT a.AssetID IS NULL
		Order By TheDate, c.Name, Label, Owner 	
		'
		EXEC(@SQL)
		
END

GO

CREATE PROCEDURE X_ScheduleView_Old_2(@BackDays INT = 1)
AS
BEGIN
	Select c.ChannelID, c.name, c.Bookable, c.AssetType, 
		 (select count(b.AssetID) from [ARM_CORE]..[ScheduleBooking] b
		 		LEFT JOIN [ARM_CORE]..[ScheduleTimeSlot] t on t.TID = b.TID
		 		LEFT JOIN [ARM_CORE]..[ScheduleBookDay] d on d.BID = t.BID 
		  where d.ChannelID = c.ChannelID and d.[TheDate] >= DATEADD(D,@BackDays * -1 , GETDATE())) AS BCount,
		 (select IsNull(sum(t.MaxBooking),0)  from [ARM_CORE]..[ScheduleTimeSlot] t left join [ARM_CORE]..[ScheduleBookday] b on b.BID = t.BID
		  where b.ChannelID = c.ChannelID  and b.[TheDate] >= DATEADD(D,-7 , GETDATE())) AS CBookCount
		 from [ARM_CORE]..[ScheduleChannel] c where c.Bookable = 1 order by c.Name	
		
END

GO
CREATE PROCEDURE X_ScheduleView_Old_1(@CID INT)
AS
BEGIN
	Select c.Name from [ARM_CORE]..[ScheduleChannel] c where c.ChannelID = @CID 
END

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_Script_1] 
@DATABASE_REF NVARCHAR(255),
@TABLEREF NVARCHAR(255)
AS
BEGIN

DECLARE @sqlStr NVARCHAR(max) = '
   
         USE '+@DATABASE_REF+'; SELECT s.[name] AS [Column], t.name as [Type],   
		 	columnproperty(s.id, s.[name] ,''IsIdentity'') as IsIdentity,	s.[colorder]   
		 FROM [syscolumns] s 
		 LEFT JOIN sys.[Tables] x on x.object_id =s.id
		 LEFT JOIN sys.[types] t on t.system_type_id = s.xtype   
		 WHERE s.id = object_id('+@TABLEREF+') and IsNull(t.[name],'''') <> ''sysname'' 
		 Order by s.[colorder], s.[name] 

   ';
   EXEC(@sqlStr);
END;
  

         
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_Script_2] 
@DATABASE_REF NVARCHAR(255),
@TABLEREF NVARCHAR(255),
@Where NVARCHAR(MAX)
AS
BEGIN

DECLARE @sqlStr NVARCHAR(max) = '
   
          select * from ['+@DATABASE_REF+']..['+@TABLEREF+'] '+@Where+'

   ';
   EXEC(@sqlStr);
END;
  

  
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AutoNotificationEdit2_9] 
@ColWhere NVARCHAR(Max) = ''
AS
BEGIN

   DECLARE @sqlStr NVARCHAR(max) = '
     SELECT c.collectionID as FlagID, c.Name, IsNull(cc.Name,'''') as ClassName from [ARM_CORE]..[A_Collection] c 
     LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc on cc.CollectionClassID = c.CollectionClassID '+@ColWhere+' order by IsNull(cc.Name,''''), c.[Order] 
   ';
   EXEC(@sqlStr);
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AutoNotificationEdit2_10] 
@ColWhere NVARCHAR(Max) = ''
AS
BEGIN

   DECLARE @sqlStr NVARCHAR(max) = '
   SELECT c.collectionID as FlagID, c.Name, IsNull(cc.Name,'''') as ClassName from [ARM_CORE]..[A_Collection] c 
   LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc on cc.CollectionClassID = c.CollectionClassID '+@ColWhere+' order by IsNull(cc.Name,''''), c.[Order] 
   ';
   EXEC(@sqlStr);
END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AutoNotificationEdit2_11]
AS
BEGIN
SELECT distinct UPPER(c.Type) as CType  from [ARM_CORE]..[A_Collection] c order by UPPER(c.Type) 
END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AutoNotificationEdit2_12]
AS
BEGIN
SELECT [Table],[Column],IsNull([Label],[Lookup]) as [Label], [Lookup] from [ARM_CORE]..[A_Lookup] where [Table] = 'AutoNotification' and [Column] = 'InActionAction'  order by [Order]
END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AutoNotificationEdit2_13] 
@ColWhere NVARCHAR(Max) = ''
AS
BEGIN

   DECLARE @sqlStr NVARCHAR(max) = '
   SELECT c.collectionID as FlagID, c.Name, IsNull(cc.Name,'''') as ClassName from [ARM_CORE]..[A_Collection] c 
   LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc on cc.CollectionClassID = c.CollectionClassID '+@ColWhere+' order by IsNull(cc.Name,''''), c.[Order] 
   ';
   EXEC(@sqlStr);
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AutoNotificationEdit2_14]
AS
BEGIN
SELECT [Table],[Column],IsNull([Label],[Lookup]) as [Label], [Lookup] from [ARM_CORE]..[A_Lookup] where [Table] = 'AutoNotification' and [Column] = 'InActionAction'  order by [Order]

END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AutoNotificationEdit2_15] 
@ColWhere NVARCHAR(Max) = ''
AS
BEGIN

   DECLARE @sqlStr NVARCHAR(max) = '
    SELECT c.collectionID as FlagID, c.Name, IsNull(cc.Name,'''') as ClassName from [ARM_CORE]..[A_Collection] c 
    LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc on cc.CollectionClassID = c.CollectionClassID '+@ColWhere+' ORDER by IsNull(cc.Name,''''), c.[Order]
   ';
   EXEC(@sqlStr);
END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetIssueUpdate_1] 
 @AssetID NVARCHAR(255)		= ''
--@Auth_User NVARCHAR(255)	= '',
--@Comment NVARCHAR(MAX)		= ''
AS
BEGIN
select AssetID, Deployed from [ARM_CORE]..[AssetIssues] where AssetID = @AssetID
END

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetIssueUpdate_2] 
 @AssetID NVARCHAR(50) ,
 @HasIssues NVARCHAR(50) ,
 @IssueComment NVARCHAR(max) ,
 @Now NVARCHAR(50) ,
 @Auth_User NVARCHAR(50) ,
 @IsReady NVARCHAR(50) ,
 @IsDeployed NVARCHAR(50) 

AS
BEGIN
insert into [ARM_CORE]..[AssetIssues] (AssetID, HasIssues, IssueComment, LastUpdated, LOGON_USER, Ready, Deployed) values (@AssetID,@HasIssues,@IssueComment,@Now,@Auth_User,@IsReady,@IsDeployed);
END


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetIssueUpdate_3] 
 @AssetID NVARCHAR(50) ,
 @HasIssues NVARCHAR(50) ,
 @IssueComment NVARCHAR(max) ,
 @Now NVARCHAR(50) ,
 @Auth_User NVARCHAR(50) ,
 @IsReady NVARCHAR(50) ,
 @IsDeployed NVARCHAR(50) 

AS
BEGIN
update [ARM_CORE]..[AssetIssues] set LastUpdated = @Now  , LOGON_USER =   @Auth_User  , HasIssues =   @HasIssues  , IssueComment =   @IssueComment  , Ready =   @IsReady  , Deployed =   @IsDeployed    where AssetID =   @AssetID  
END

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetIssueUpdate_4] 
 @AssetID NVARCHAR(250) ,
 @myLocked NVARCHAR(5) 

AS
BEGIN
update [ARM_CORE]..[AssetCache] set myLocked = @myLocked where assetID = @AssetID
END

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetIssueUpdate_5] 
 @AssetID NVARCHAR(250) 
 --@myLocked NVARCHAR(5) 

AS
BEGIN
select AssetID from [ARM_CORE]..[AssetStatus] where AssetID = @AssetID
END

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetIssueUpdate_6] 
 @AssetID NVARCHAR(250) 
 --@myLocked NVARCHAR(5) 

AS
BEGIN
insert into [ARM_CORE]..[AssetStatus] (AssetID,EngDeployed,EngDeployedDate) values (@AssetID,1,GETDATE())
END

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetIssueUpdate_7] 
 @AssetID NVARCHAR(250) 
 --@myLocked NVARCHAR(5) 

AS
BEGIN
update [ARM_CORE]..[AssetStatus] set EngDeployed=1, EngDeployedDate=GETDATE() where AssetID = @AssetID
END

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetIssueUpdate_8] 
 @AssetID NVARCHAR(250) 
 --@myLocked NVARCHAR(5) 

AS
BEGIN
update [ARM_CORE]..[AssetStatus] set EngDeployed=0, EngDeployedDate=NULL where AssetID = @AssetID
END

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetIssueUpdate_10] 
 @AssetID NVARCHAR(250) 
 --@myLocked NVARCHAR(5) 

AS
BEGIN
delete from [ARM_CORE]..[ScheduleDeployRunAsset] where AssetID = @AssetID
END



GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetIssueUpdate_12] 
 @AssetID NVARCHAR(250) 
 --@myLocked NVARCHAR(5) 

AS
BEGIN
delete from [ARM_CORE]..[A_CollectionItem] where itemID = @AssetID and CollectionID IN (select CollectionID from [ARM_CORE]..[A_Collection] where [TYPE] = 'Asset') 
END



GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetReplacement_1] 
 @AssetID NVARCHAR(250), 
  @replaceWith NVARCHAR(250) 

AS
BEGIN
        MERGE [ARM_CORE]..[AssetStatus] AS Target USING (select @AssetID AS AssetID) AS Source ON (Target.AssetID = Source.AssetID) 
		WHEN NOT MATCHED BY TARGET THEN 
		INSERT (AssetID, ReplaceWith) 
		VALUES (Source.[AssetID],@replaceWith) 
		WHEN MATCHED THEN 
		UPDATE set Target.[ReplaceWith] = @replaceWith; 
END



GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetReplacement_2] 
 @AssetID NVARCHAR(250), 
  @ChangeModel NVARCHAR(250) 

AS
BEGIN
        MERGE [ARM_CORE]..[ModelToBe] AS Target USING (select @AssetID AS AssetID) AS Source ON (Target.AssetID = Source.AssetID) 
		WHEN NOT MATCHED BY TARGET THEN 
		INSERT (AssetID, ToBeModel) 
		VALUES (Source.[AssetID],@ChangeModel) 
		WHEN MATCHED THEN 
		UPDATE set Target.[ToBeModel] = @ChangeModel; 
END



GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_assets2screen_1] 
@MyCondition NVARCHAR(1000) = ''--,
--@Internal NVARCHAR(255),
--@AppGroupKey NVARCHAR(255)
AS
BEGIN

   DECLARE @sqlStr NVARCHAR(4000) = '
     select distinct r.AssetID, IsNull(s.ReplaceWith,'''') AS ReplaceWith, isNull(c.AssetTag,'''') AS AssetTag, c.[TYPE] 
	  from [ARMS]..[RunAssets$] r 
	  Left Join [CORE]..[Asset] c on c.AssetID = r.AssetID 
	  Left Join DeployRun$ d on d.RunID = r.RunID 
	  Left Join AssetCache$ a on a.AssetID = r.AssetID 
	  Left Join AssetStatus$ s on s.AssetID = r.AssetID 
	  LEFT JOIN DNA$ p on p.Asset = r.AssetID 
	  where r.RunID  '+ @MyCondition +' Order By  r.AssetID
   ';
   EXEC(@sqlStr);
END;

GO
CREATE PROCEDURE [dbo].[X_assets2screen_2] 
 --@AssetID NVARCHAR(250), 
 -- @ChangeModel NVARCHAR(250) 
AS
BEGIN
    Select  a.AssetID, a.AssetID as Station,'P-REPLACE-7TO7' as Scenario, 'NMUK' as [ZTP site],'NMUK' as OU, '3' as Computer, 'ACE'as Class,  
	 'STANDARD' as Subclass, IIf(a.[Type]='Workstation' or a.[Type]='MobileCad','NEACE3D','NEACE') as Perimeter, 'NoADT' as Subperimeter,'' as Type, '' as Category,  
	 a.UserID as [User ID], ''as [Booking Channel], 'Chained' as [Backup Mode], 'YES' as [Confirmation], 'YES' as Appointment, '' as [Place],'' as [Time],'' as Newstation,  
	 'PROD' as environment, '0809:00000809' as Keyboard, 'En-US' as language, 'en-GB' as [format], '' as reference 
	  from [Asset] a Where  a.WarrantyDate > '2017-4-1'
	  Order by a.assetid
END


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetsByAppBySlice_1] 
@AssetList NVARCHAR(1000) = ''--,
--@Internal NVARCHAR(255),
--@AppGroupKey NVARCHAR(255)
AS
BEGIN

   DECLARE @sqlStr NVARCHAR(4000) = '
    update [ARM_CORE]..[Asset] set target = 1 where AssetID  in ('+ @AssetList +') 
   ';
   EXEC(@sqlStr);
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetsByAppBySlice_2] 
@AssetList NVARCHAR(1000) = ''--,
--@Internal NVARCHAR(255),
--@AppGroupKey NVARCHAR(255)
AS
BEGIN

   DECLARE @sqlStr NVARCHAR(4000) = '
    update [ARM_CORE]..[Asset] set target = 0 where AssetID  in ('+ @AssetList +') 
   ';
   EXEC(@sqlStr);
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetsByAppBySlice_3] 
@BArea NVARCHAR(255),
@AssetList NVARCHAR(1000) = ''--

--@AppGroupKey NVARCHAR(255)
AS
BEGIN

   DECLARE @sqlStr NVARCHAR(4000) = '
    update [ARM_CORE]..[Asset] set BArea = '+ @BArea +' where AssetID  in ('+ @AssetList +') 
   ';
   EXEC(@sqlStr);
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetsByAppBySlice_4] 
@AppScope NVARCHAR(1000),
@q1 NVARCHAR(1000) = '',
@q2 NVARCHAR(1000) = ''

--@AppGroupKey NVARCHAR(255)
AS
BEGIN

   DECLARE @sqlStr NVARCHAR(max) = '
              SELECT ass.* from ( 
				 select distinct a.[AssetID], IsNull(a.[Owner],'''') AS Owner, IsNull(a.[Email],'''') AS Email, IsNull(a.Deferred,0) as Def, isNull(a.[Live],0) as Live, 
				 isNull(a.[Target],0) AS Target, a.[Location], a.[BArea], a.[TYPE], a.[Model], a.[AssetTag], a.[Status], a.[heartbeat], a.[Confirmed], s.[EngDeployed], a.[64Bit],   
				 (select Count(f.[ApplicationID]) from [ARM_CORE]..[AppAstAsIs] f LEFT JOIN [ARM_CORE]..[Application] g ON g.[ApplicationID] = f.[ApplicationID] where f.AssetID = a.AssetID ) As PreApps,    
				 (select Count(f.[ApplicationID]) from [ARM_CORE]..[AppAstToBe] f LEFT JOIN [ARM_CORE]..[Application] g ON g.[ApplicationID] = f.[ApplicationID] LEFT JOIN [ARM_CORE]..[A_Lookup] lu ON lu.[Lookup] = g.[Status] and lu.[Table] = ''Internal''  where f.AssetID = a.AssetID and IsNull(g.DeployType,''-'') <> ''B'' and IsNull(lu.[Label],''*'') <> ''R'' and IsNull(lu.[Label],''*'') <> ''B'' and IsNull(lu.[Label],''*'') <> ''X''  ) As Apps,    
				 (select Count(f.[ApplicationID]) from [ARM_CORE]..[AppAstToBe] f LEFT JOIN [ARM_CORE]..[Application] g ON g.[ApplicationID] = f.[ApplicationID] LEFT JOIN [ARM_CORE]..[A_Lookup] lu ON lu.[Lookup] = g.[Status] and lu.[Table] = ''Internal''  where f.AssetID = a.AssetID and IsNull(g.DeployType,''-'') <> ''B'' and IsNull(lu.[Label],''*'') <> ''R'' and IsNull(lu.[Label],''*'') <> ''B'' and IsNull(lu.[Label],''*'') <> ''X''  and g.[Ready] = 1) As ReadyApps,    
				 IsNull((select TOP 1 h.[Label] from  [ScheduleDeployRun] h LEFT JOIN [ScheduleDeployRunAsset] r on h.RunID = r.RunID where r.AssetID = a.[AssetID] and h.RunDate >= convert(date,getDate()) order by h.Rundate Asc ),'''') AS [myLabelAsc],    
				 IsNull((select TOP 1 h.[Label] from  [ScheduleDeployRun] h LEFT JOIN [ScheduleDeployRunAsset] r on h.RunID = r.RunID where r.AssetID = a.[AssetID] and h.RunDate <= convert(date,getDate()) order by h.Rundate Desc ),'''') AS [myLabelDesc]    
				 from [ARM_CORE]..[Asset] a   
				 left JOIN [ARM_CORE]..[AssetStatus] s on s.AssetID = a.AssetID   
				 left JOIN [ARM_CORE].. '+ @AppScope +' e on e.AssetID = a.AssetID   
				 LEFT JOIN [ARM_CORE]..[ScheduleDeployRunAsset] r on r.AssetID = a.AssetID    
				 LEFT JOIN [ARM_CORE]..[ScheduleDeployRun] d ON d.RunID = r.RunID     
				 LEFT JOIN [ARM_CORE]..[BArea] b ON b.BArea = a.BArea   
				 LEFT JOIN [ARM_CORE]..[NotificationLog] n ON n.[AssetID] = a.AssetID   
				 '+ @q1 +'
			     ) as ass    '+ @q2 +'
			
   ';
   EXEC(@sqlStr);
END;
       
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetsByAppBySlice_5] 


--@AppGroupKey NVARCHAR(255)
AS
BEGIN
select BArea from [ARM_CORE]..[BArea] Order By Internal, BArea 
END;
       
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetsByAppBySlice_6] 


--@AppGroupKey NVARCHAR(255)
AS
BEGIN
select Lookup, Label from [ARM_CORE]..[A_Lookup] where [Table] = 'Internal' and [Column] = 'OsFilter' Order By [Order] 
END;
       
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetsByAppBySlice_7] 


--@AppGroupKey NVARCHAR(255)
AS
BEGIN
select Lookup, Label from [ARM_CORE]..[A_Lookup] where [Table] = 'Internal' and [Column] = 'OsFilter' Order By [Order] 
END;
       
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetsByAppBySlice_8] 


--@AppGroupKey NVARCHAR(255)
AS
BEGIN
select distinct [Model] from [ARM_CORE]..[Asset] order by [Model]  
END;
       
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetsByAppBySlice_9] 


--@AppGroupKey NVARCHAR(255)
AS
BEGIN
select distinct TemplateUsed from [ARM_CORE]..[NotificationLog] order by TemplateUsed 
END;
       
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetsByAppBySlice_10] 


--@AppGroupKey NVARCHAR(255)
AS
BEGIN
SELECT Lookup, Label from [ARM_CORE]..[A_Lookup] where [Table] = 'Asset' and [Column] = 'Status' Order By [Order] 
END;
       

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetsByAppBySlice_11] 


--@AppGroupKey NVARCHAR(255)
AS
BEGIN
select BArea from [ARM_CORE]..[BArea] Order By Internal desc, BArea 
END;
       

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetTab_1] 
@AssetID NVARCHAR(255) = ''--,
--@Internal NVARCHAR(255),
--@AppGroupKey NVARCHAR(255)
AS
BEGIN

select AssetID, IsNull(UserID,'') as UserID from [ARM_CORE]..[Asset] where AssetID = @AssetID
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetTrackingPanel_1] 
@AssetID NVARCHAR(255) = ''--,
--@Internal NVARCHAR(255),
--@AppGroupKey NVARCHAR(255)
AS
BEGIN

select a.confirmed,a.LOGON_USER as ConfirmedBy from [ARM_CORE]..[AssetCache] a where a.AssetID = @AssetID
END;

GO
CREATE PROCEDURE [dbo].[X_AssetTrackingPanel_2] 
@AssetID NVARCHAR(255) = ''--,
--@Internal NVARCHAR(255),
--@AppGroupKey NVARCHAR(255)
AS
BEGIN

        select IsNull(s.EngDeployed,0) as Deployed, IsNull(s.replaceWith,'') as ReplaceWith, 
		 IsNull ( (select Model from [ARM_CORE]..[Asset] where AssetID = s.[ReplaceWith]),'' ) as NewModel, m.ToBeModel, IsNull(s.replacementFor,'') as replacementFor,  
		 i.IssueComment, IsNull(i.HasIssues,'N') as HasIssues, IsNull(i.Ready,'N') as Ready  
		 from [ARM_CORE]..[Asset] a LEFT JOIN [ARM_CORE]..[AssetStatus] s on s.AssetID = a.AssetID LEFT JOIN [ARM_CORE]..[AssetIssues] i on i.AssetID = a.AssetID LEFT JOIN [ARM_CORE]..[ModelToBe] m ON m.AssetID = a.AssetID where a.AssetID = @AssetID


END


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetTrackingPanel_3] 
@AssetID NVARCHAR(255) = ''--,
--@Internal NVARCHAR(255),
--@AppGroupKey NVARCHAR(255)
AS
BEGIN
select heartbeat from [ARM_CORE]..[Asset] where AssetID = @AssetID

END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetTrackingPanel_4] 
@AssetID NVARCHAR(255) = ''--,
--@Internal NVARCHAR(255),
--@AppGroupKey NVARCHAR(255)
AS
BEGIN
select a.CollectionID as FlagID, a.[Name], a.[Order], IsNull(t.CollectionID,0) as FlagSet from [ARM_CORE]..[A_Collection] a 
LEFT join [ARM_CORE]..[A_CollectionItem] t on t.collectionID = a.collectionID and t.itemID = @AssetID where IsNull(a.[Type],'Asset') = 'Asset' order by a.[Order], a.[Name]


END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetTrackingPanel_5] 
@AssetID NVARCHAR(255) = ''--,
--@Internal NVARCHAR(255),
--@AppGroupKey NVARCHAR(255)
AS
BEGIN
select distinct [Lookup],[Label] AS NewModel,[Order] from [ARM_CORE]..[A_Lookup] where [Table] = 'ModelToBe' and [Column] = 'ToBeModel' order by [Order]

END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetTrackingPanel_6] 
@AssetID NVARCHAR(255) = ''--,
--@Internal NVARCHAR(255),
--@AppGroupKey NVARCHAR(255)
AS
BEGIN
select distinct InitialOS from OSMappings m where m.InitialAsTarget = 1 order by InitialOS

END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetTrackingPanel_7] 
@AssetID NVARCHAR(255) = ''--,
--@Internal NVARCHAR(255),
--@AppGroupKey NVARCHAR(255)
AS
BEGIN
select * from [ARM_CORE]..[ApplicationTransaction] t where t.AssetID = @AssetID order by [Rewind] Desc, [When] Desc

END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetUpdateDo_1] 
@AssetID NVARCHAR(255) = ''--,
--@Internal NVARCHAR(255),
--@AppGroupKey NVARCHAR(255)
AS
BEGIN

select Location, Owner, Email from [ARM_CORE]..[AssetCache] where AssetID = @AssetID

END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetUpdateDo_2] 
@AssetID NVARCHAR(255) = ''--,
--@Internal NVARCHAR(255),
--@AppGroupKey NVARCHAR(255)
AS
BEGIN

update [ARM_CORE]..[AssetCache] set LastModifiedDate = getDate() where AssetID = @AssetID
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetUpdateDo_3] 
@AssetID NVARCHAR(255) = ''--,
--@Internal NVARCHAR(255),
--@AppGroupKey NVARCHAR(255)
AS
BEGIN
select AssetID, Comment from [ARM_CORE]..[AssetCache] where AssetID = @AssetID
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetUpdateDo_4] 
@AssetID NVARCHAR(255),
@Owner NVARCHAR(255),
@Email NVARCHAR(255),
@Location NVARCHAR(255),
@Association NVARCHAR(255),
@BArea  NVARCHAR(255),
@Now NVARCHAR(255),
@Comment NVARCHAR(255),
@Auth_User NVARCHAR(255)
  
AS
BEGIN
insert into [ARM_CORE]..[AssetCache] (AssetID,Owner,Email,Location,Association,BArea,LastUpdated,Comment,confirmed,LOGON_USER) 
VALUES ( @AssetID , @Owner , @Email , @Location , @Association , @BArea , @Now , @Comment , @Now , @Auth_User )
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetUpdateDo_5] 
@Owner NVARCHAR(255),
@Email NVARCHAR(255),
@Location NVARCHAR(255),
@Association NVARCHAR(255),
@BArea  NVARCHAR(255),
@AssetID NVARCHAR(255)
  
AS
BEGIN
UPDATE [ARM_CORE]..[AssetCache]
SET Owner = @Owner,
    Email = @Email,
    Location = @Location,
    Association = @Association,
    BArea = @BArea
WHERE AssetID = @AssetID;
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetUpdateDo_6] 
@Now NVARCHAR(255),
@Auth_User NVARCHAR(255),
@AssetID NVARCHAR(255)

  
AS
BEGIN
UPDATE [ARM_CORE]..[AssetCache]
SET LastUpdated = @Now,
    confirmed = @Now,
    LOGON_USER = @Auth_User
WHERE AssetID = @AssetID;
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- ALTER date: <ALTER Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetUpdateDo_7] 
@Live bit,
@Owner NVARCHAR(255),
@Email NVARCHAR(255),
@Location NVARCHAR(255),
@OS NVARCHAR(255),
@AssetTag NVARCHAR(255),
@BArea NVARCHAR(255),
@userID NVARCHAR(255),
@OU NVARCHAR(500),
@AssetType NVARCHAR(255),
@AssetModel NVARCHAR(255),
@AssetMake NVARCHAR(255),
@SerialNumber NVARCHAR(255),
@WarrantyDate NVARCHAR(255),
@Heartbeat NVARCHAR(255),
@Custom01 NVARCHAR(255),
@Custom02 NVARCHAR(255),
@Custom03 NVARCHAR(255),
@Custom04 NVARCHAR(255),
@Custom05 NVARCHAR(255),
@AssetID NVARCHAR(255)

  
AS
BEGIN
    SET DATEFORMAT dmy; 
	UPDATE [ARM_CORE]..[Asset]
SET Live = @Live,
    Owner = @Owner,
    Email = @Email,
    Location = @Location,
    [OS] = @OS,
    AssetTag = @AssetTag,
    BArea = @BArea,
    UserID = @userID,
    [OU] = @OU,
    [Type] = @AssetType,
    [Model] = @AssetModel,
    [Make] = @AssetMake,
    SerialNumber = @SerialNumber,
    WarrantyDate = CONVERT(DATE, @WarrantyDate, 103),
    [Heartbeat] = CONVERT(DATE, @Heartbeat, 103),
    [Custom01] = @Custom01,
    [Custom02] = @Custom02,
    [Custom03] = @Custom03,
    [Custom04] = @Custom04,
    [Custom05] = @Custom05
WHERE AssetID = @AssetID;
END


GO
-- =============================================
-- Author:		<Author,,Name>
-- ALTER date: <ALTER Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetUpdateDo_8] 
	@AssetID NVARCHAR(255)
AS
BEGIN
       SELECT ISNULL(AssetTag, '') AS AssetTag,
       ISNULL(SerialNumber, '') AS SerialNumber,
       ISNULL(Custom01, '') AS Custom01,
       ISNULL(Custom02, '') AS Custom02,
       ISNULL(Custom03, '') AS Custom03,
       ISNULL(Custom04, '') AS Custom04,
       ISNULL(Custom05, '') AS Custom05,
       ISNULL([Model], '') AS [Model],
       ISNULL([OS], '') AS [OS],
       ISNULL([Make], '') AS [Make],
       ISNULL([Type], '') AS [Type],
       ISNULL([UserID], '') AS [UserID],
       ISNULL([WarrantyDate], '') AS [WarrantyDate],
       ISNULL([AssetTag], '') AS AssetTag,
       ISNULL([Location], '') AS Location,
       ISNULL([BArea], '') AS BArea,
       ISNULL([Owner], '') AS Owner,
       ISNULL([Email], '') AS Email,
       ISNULL([OU], '') AS OU
FROM [ARM_CORE]..[Asset]
WHERE AssetID = @AssetID;
END


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetUserAccessLog_1] 
@UserID NVARCHAR(255) = ''--,
--@Internal NVARCHAR(255),
--@AppGroupKey NVARCHAR(255)
AS
BEGIN
SELECT a.AssetAccessLogID,
       ISNULL(a.AssetID, '') AS AssetID,
       ISNULL(a.UserID, '') AS UserID,
       ISNULL(a.LastDate, '') AS LastDate,
       ISNULL(Counter, 1) AS Counter
FROM [ARM_CORE]..[AssetAccessLog] a
WHERE a.UserID = @UserID
ORDER BY LastDate DESC
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetUserAccessLog_2] 
@MultiResultsLimit NVARCHAR(1000) = '',
@SearchOn NVARCHAR(1000)
AS
BEGIN

   DECLARE @sqlStr NVARCHAR(max) = '
         SELECT top '+ @MultiResultsLimit +' a.AssetID, a.[Type], IsNull(a.[Model],'''') as [Model], a.[Heartbeat], IsNull(a.[SerialNumber],'''') as SerialNumber, 
		 a.[OS], IsNull(a.Live,0) as Live, 
		 a.[UserID], IsNull(IsNull(a.[Owner],u.[UserName]),'''') as Owner, a.[Location], IsNull(IsNull(a.[Email],u.[Email]),'''') AS Email,
		 IsNull(a.[AssetTAG],'''') AS AssetTag,  a.[Location], 
		 a.[BArea], a.[Warrantydate] 
		 from [ARM_CORE]..[Asset] a 
		 LEFT JOIN [ARM_CORE]..[User] u on u.UserID = a.UserID  
		 '+ @SearchOn +' order by a.[Heartbeat] desc 
   ';
   EXEC(@sqlStr);
END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_Audit_1] 
@SlotsSQL NVARCHAR(max) = '',
@WSSQL NVARCHAR(max)
AS
BEGIN

   DECLARE @sqlStr NVARCHAR(max) = '
      Select slot.assetid from ( '+ @SlotsSQL +' ) as slot 
      left join ( '+ @WSSQL +' ) as WS on slot.AssetID = ws.AssetID 
      where ws.AssetID is null order by AssetID 
   ';
   EXEC(@sqlStr);
END;
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_Audit_2] 
@SlotsSQL NVARCHAR(max) = '',
@WSSQL NVARCHAR(max)
AS
BEGIN

   DECLARE @sqlStr NVARCHAR(max) = '
             Select ws.assetid from ( '+ @SlotsSQL +' ) as slot 
			 right join ( '+ @WSSQL +'  ) as WS on  slot.AssetID = ws.AssetID 
			 where slot.AssetID is null order by AssetID 
   ';
   EXEC(@sqlStr);
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AutoBitCollections_1] 
--@UserID NVARCHAR(255) = ''--,
--@Internal NVARCHAR(255),
--@AppGroupKey NVARCHAR(255)
AS
BEGIN
select [RGB] from [ARM_CORE]..[A_ColourPalette] order by IsNull([Order],50+ColourPaletteID) 
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AutoBitCollections_Copy_1] 
--@UserID NVARCHAR(255) = ''--,
--@Internal NVARCHAR(255),
--@AppGroupKey NVARCHAR(255)
AS
BEGIN
select [RGB] from [ARM_CORE]..[A_ColourPalette] order by IsNull([Order],50+ColourPaletteID) 
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AutoBitTable_1] 
@Pass INT = 0--,
--@Internal NVARCHAR(255),
--@AppGroupKey NVARCHAR(255)
AS
BEGIN
SELECT b.BitConditionID,
       b.[Table],
       x.rowspan,
       b.GroupName,
       b.Attribute,
       b.BitPosition,
       ISNULL(b.ConditionClassID, 0) AS ConditionClassID,
	   iif(exists (select collectionClassID from [ARM_CORE]..[A_CollectionClass] where collectionClassID = b.ConditionClassID),1,0) as ClassExists,
       ISNULL(b.ConditionCID, 0) AS ConditionCID,
	   iif(exists (select collectionID from [ARM_CORE]..[A_Collection] where collectionID = b.ConditionCID),1,0) as CollectionExists,
       b.[Active],
       b.[Order]
FROM [ARM_CORE]..[A_BitCondition] b
    LEFT JOIN
    (
        SELECT bb.[Table],
               COUNT(*) AS rowspan
        FROM [ARM_CORE]..[A_BitCondition] bb
        WHERE ISNULL(bb.Pass, 0) = @Pass
              AND bb.[Field] = 'BitStatus'
        GROUP BY bb.[Table]
    ) x
        ON x.[Table] = b.[Table]
WHERE ISNULL(Pass, 0) = @Pass
      AND b.[Field] = 'BitStatus'
ORDER BY b.[Table],
         b.[Order];

END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AutoBitTable_Copy_1] 
@Pass INT = 0--,
--@Internal NVARCHAR(255),
--@AppGroupKey NVARCHAR(255)
AS
BEGIN
SELECT a.CollectionAgentID,
       a.Label,
       ISNULL(a.Mode, 0) AS Mode,
       a.CollectionID,
       cc.Name AS [ClassName],
       c.Name,
       a.[Order],
       a.Frequency,
       a.Active,
       a.Pass,
       a.qualifySQL,
       CASE
           WHEN (DATEPART(HOUR, GETDATE()) IN
                 (
                     SELECT value
                     FROM [ARM_CORE]..fn_split_string(ISNULL([Frequency], ''), ',')
                 )
                )
                AND Active = 1 THEN
               1
           ELSE
               0
       END AS [Current]
FROM [ARM_CORE]..[A_CollectionAgent] a
    LEFT JOIN [ARM_CORE]..[A_Collection] c
        ON c.CollectionID = a.CollectionID
    LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc
        ON cc.CollectionClassID = c.CollectionClassID
WHERE ISNULL(a.Pass, 0) = @Pass
ORDER BY a.[Order]
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AutoCollectionTable_1] 
@Pass INT = 0--,
--@Internal NVARCHAR(255),
--@AppGroupKey NVARCHAR(255)
AS
BEGIN
SELECT c.[Type],
       a.CollectionAgentID,
       a.Label,
       ISNULL(a.Mode, 0) AS Mode,
       l.Label AS ModeLabel,
       a.CollectionID,
	   iif(exists (select collectionID from [ARM_CORE]..[A_Collection] where collectionID = a.CollectionID),1,0) as CollectionExists,
       cc.Name AS [ClassName],
       c.Name,
       a.[Order],
       a.Frequency,
       a.Active,
       a.Pass,
       a.qualifySQL,
       CASE
           WHEN (DATEPART(HOUR, GETDATE()) IN
                 (
                     SELECT value
                     FROM [ARM_CORE]..fn_split_string(ISNULL([Frequency], ''), ',')
                 )
                )
                AND Active = 1 THEN
               1
           ELSE
               0
       END AS [Current],
       ISNULL(a.Info, '') AS [Info]
FROM [ARM_CORE]..[A_CollectionAgent] a
    LEFT JOIN [ARM_CORE]..[A_Collection] c
        ON c.CollectionID = a.CollectionID
    LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc
        ON cc.CollectionClassID = c.CollectionClassID
    LEFT JOIN [ARM_CORE]..[A_LookUp] l
        ON l.[Lookup] = ISNULL(a.Mode, 0)
           AND l.[Column] = 'Mode'
           AND l.[Table] = 'A_CollectionAgent'
WHERE ISNULL(a.Pass, 0) = @Pass
ORDER BY a.[Order]

END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AutoCollectionTable_Copy_1] 
@Pass INT = 0--,
--@Internal NVARCHAR(255),
--@AppGroupKey NVARCHAR(255)
AS
BEGIN
SELECT a.CollectionAgentID,
       a.Label,
       ISNULL(a.Mode, 0) AS Mode,
       a.CollectionID,
       cc.Name AS [ClassName],
       c.Name,
       a.[Order],
       a.Frequency,
       a.Active,
       a.Pass,
       a.qualifySQL,
       CASE
           WHEN (DATEPART(HOUR, GETDATE()) IN
                 (
                     SELECT value
                     FROM [ARM_CORE]..fn_split_string(ISNULL([Frequency], ''), ',')
                 )
                )
                AND Active = 1 THEN
               1
           ELSE
               0
       END AS [Current]
FROM [ARM_CORE]..[A_CollectionAgent] a
    LEFT JOIN [ARM_CORE]..[A_Collection] c
        ON c.CollectionID = a.CollectionID
    LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc
        ON cc.CollectionClassID = c.CollectionClassID
WHERE ISNULL(a.Pass, 0) = @Pass
ORDER BY a.[Order]

END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AutoNotificationDelete_1] 
@AutoNotificationID INT = 0--,
--@Internal NVARCHAR(255),
--@AppGroupKey NVARCHAR(255)
AS
BEGIN
SELECT a.Name from [ARM_CORE]..[AutoNotification] a where AutoNotificationID = @AutoNotificationID

END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AutoNotificationDeleteDo_1] 
@AutoNotificationID INT = 0--,
--@Internal NVARCHAR(255),
--@AppGroupKey NVARCHAR(255)
AS
BEGIN
delete from [ARM_CORE]..[AutoNotification]  where AutoNotificationID = @AutoNotificationID

END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AutoNotificationEdit_1] 
@Name NVARCHAR(255),
@AudienceFrom NVARCHAR(255),
@AudiencePropertyID int,
@DateProperty NVARCHAR(255),
@NotificationTemplate NVARCHAR(255),
@AOrder INT,
@ParamSQL NVARCHAR(max),
@PayLoadSQL NVARCHAR(max),
@InActionSQL NVARCHAR(max),
@PostActionSQL NVARCHAR(max),
@Query NVARCHAR(max),
@SendFrom NVARCHAR(255),
@ReplyTo NVARCHAR(255),
@BccTo NVARCHAR(255),
@Weekly bit,
@PayLoadAttachment bit
--@Internal NVARCHAR(255),
--@AppGroupKey NVARCHAR(255)
AS
BEGIN
INSERT INTO [ARM_CORE]..[AutoNotification]
(
    Name,
    Active,
    AudienceFrom,
    AudiencePropertyID,
    DateProperty,
    NotificationTemplate,
    TraceLog,
    [Order],
    ParamSQL,
    PayLoadSQL,
    InAction,
    PostAction,
    Query,
    SendFrom,
    ReplyTo,
    BccTo,
    Weekly,
    PayloadAttachment
)
VALUES
(@Name, 1, @AudienceFrom, @AudiencePropertyID, @DateProperty, @NotificationTemplate, 1, @AOrder, @ParamSQL,
 @PayLoadSQL, @InActionSQL, @PostActionSQL, @Query, @SendFrom, @ReplyTo, @BccTo, @Weekly, @PayLoadAttachment)

END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AutoNotificationEdit_2] 
@Name NVARCHAR(255),
@AudienceFrom NVARCHAR(255),
@AudiencePropertyID int,
@DateProperty NVARCHAR(255),
@NotificationTemplate NVARCHAR(255),
@AOrder INT,
@ParamSQL NVARCHAR(max),
@PayLoadSQL NVARCHAR(max),
@InActionSQL NVARCHAR(max),
@PostActionSQL NVARCHAR(max),
@Query NVARCHAR(max),
@SendFrom NVARCHAR(255),
@ReplyTo NVARCHAR(255),
@BccTo NVARCHAR(255),
@Weekly bit,
@PayLoadAttachment BIT,
@AutoNotificationID int

AS
BEGIN
UPDATE [ARM_CORE]..[AutoNotification]
SET Name = @Name,
    AudienceFrom = @AudienceFrom,
    AudiencePropertyID = @AudiencePropertyID,
    DateProperty = @DateProperty,
    NotificationTemplate = @NotificationTemplate,
    [Order] = @AOrder,
    ParamSQL = @ParamSQL,
    PayLoadSQL = @PayLoadSQL,
    InAction = @InActionSQL,
    PostAction = @PostActionSQL,
    Query = @Query,
    SendFrom = @SendFrom,
    ReplyTo = @ReplyTo,
    BccTo = @BccTo,
    Weekly = @Weekly,
    PayloadAttachment = @PayLoadAttachment
WHERE AutoNotificationID = @AutoNotificationID;


END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AutoNotificationEdit_3] 
@AutoNotificationID int

AS
BEGIN
SELECT AutoNotificationID,
       t.Name,
       t.LastRun,
       Active,
       ISNULL([Order], 1000) AS [AOrder],
       AudienceFrom,
       ISNULL(AudiencePropertyID, '') AS AudiencePropertyID,
       ISNULL(DateProperty, '') AS DateProperty,
       NotificationTemplate,
       TraceLog,
       ISNULL(ParamSQL, '') AS ParamSQL,
       ISNULL(PayLoadSQL, '') AS PayLoadSQL,
       ISNULL(InAction, '') AS InActionSQL,
       ISNULL(PostAction, '') AS PostAction,
       ISNULL(Query, '') AS Query,
       SendFrom,
       ReplyTo,
       BccTo,
       Weekly,
       PayloadAttachment
FROM [ARM_CORE]..[AutoNotification] t
WHERE AutoNotificationID = @AutoNotificationID;


END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AutoNotificationEdit_4] 

AS
BEGIN
SELECT [Table],
       [Column],
       ISNULL([Label], [Lookup]) AS [Label],
       [Lookup]
FROM [ARM_CORE]..[A_LookUp]
WHERE [Table] = 'AutoNotification'
      AND [Column] = 'AudienceFrom'
ORDER BY [Order]

END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AutoNotificationEdit_5] 

AS
BEGIN
SELECT ChannelID, Name, Bookable from [ARM_CORE]..[ScheduleChannel] order by Bookable, Name

END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AutoNotificationEdit_6] 

AS
BEGIN
SELECT collectionID as FlagID, Name from [ARM_CORE]..[A_Collection] 
END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AutoNotificationEdit2_1] 
@Name NVARCHAR(255),
@AudienceFrom NVARCHAR(255),
@AudiencePropertyID int,
@DateProperty NVARCHAR(255),
@AOrder INT,
@TaskGroup NVARCHAR(255),
@quietmode BIT,
@suppressOnEmpty BIT,
@important BIT,
@readreceipt BIT,
--@ParamSQL NVARCHAR(max),
@PayLoadSQL NVARCHAR(max),
@InActionSQL NVARCHAR(max),
@PostActionSQL NVARCHAR(max),
@Query NVARCHAR(max),
@SendFrom NVARCHAR(255),
@ReplyTo NVARCHAR(255),
@BccTo NVARCHAR(255),
@Weekly bit,
@mTemplateID INT,
@DayCountTrigger NVARCHAR(50),
@Throttle INT,
@itemCondition NVARCHAR(1000),
@InActionAction NVARCHAR(255),
@InActionCollectionID INT,
@PayLoadAttachment bit
--@Internal NVARCHAR(255),
--@AppGroupKey NVARCHAR(255)
AS
BEGIN

INSERT INTO [ARM_CORE]..[AutoNotification]
(
    Name,
    Active,
    AudienceFrom,
    AudiencePropertyID,
    DateProperty,
    TraceLog,
    [Order],
    TaskGroup,
    [QuietMode],
    [SuppressOnEmpty],
    [Important],
    [ReadReceipt],
    PayLoadSQL,
    InAction,
    PostAction,
    Query,
    SendFrom,
    ReplyTo,
    BccTo,
    Weekly,
    TemplateID,
    DayCountTriggers,
    Throttle,
    itemCondition,
    InActionAction,
    InActionCollectionID,
    PayloadAttachment
)
VALUES
(@Name, 0, @AudienceFrom, @AudiencePropertyID, @DateProperty, 1, @AOrder, @TaskGroup, @quietmode, @suppressOnEmpty,
 @important, @readreceipt, @PayLoadSQL, @InActionSQL, @PostActionSQL, @Query, @SendFrom, @ReplyTo, @BccTo, @Weekly,
 @mTemplateID, @DayCountTrigger, @Throttle, @itemCondition, @InActionAction, @InActionCollectionID, @PayLoadAttachment);

END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AutoNotificationEdit2_2]
    @Name NVARCHAR(255),
    @AudienceFrom NVARCHAR(255),
    @AudiencePropertyID INT,
    @DateProperty NVARCHAR(255),
    @AOrder INT,
    @TaskGroup NVARCHAR(255),
    @important BIT,
    @quietmode BIT,
    @suppressOnEmpty BIT,
    @readreceipt BIT,
    @PayLoadSQL NVARCHAR(MAX),
    @InActionSQL NVARCHAR(MAX),
    @PostActionSQL NVARCHAR(MAX),
    @Query NVARCHAR(MAX),
    @SendFrom NVARCHAR(255),
    @ReplyTo NVARCHAR(255),
    @BccTo NVARCHAR(255),
    @Weekly BIT,
    @mTemplateID INT,
    @DayCountTrigger NVARCHAR(50),
    @itemCondition NVARCHAR(1000),
    @Throttle INT,
    @InActionAction NVARCHAR(255),
    @InActionCollectionID INT,
    @PayLoadAttachment BIT,
    @AutoNotificationID INT
AS
BEGIN

    UPDATE [ARM_CORE]..[AutoNotification]
    SET Name = @Name,
        AudienceFrom = @AudienceFrom,
        AudiencePropertyID = @AudiencePropertyID,
        DateProperty = @DateProperty,
        [Order] = @AOrder,
        TaskGroup = @TaskGroup,
        Important = @important,
        QuietMode = @quietmode,
        SuppressOnEmpty = @suppressOnEmpty,
        ReadReceipt = @readreceipt,
        PayLoadSQL = @PayLoadSQL,
        InAction = @InActionSQL,
        PostAction = @PostActionSQL,
        Query = @Query,
        SendFrom = @SendFrom,
        ReplyTo = @ReplyTo,
        BccTo = @BccTo,
        Weekly = @Weekly,
        TemplateID = @mTemplateID,
        DayCountTriggers = @DayCountTrigger,
        itemCondition = @itemCondition,
        Throttle = @Throttle,
        InActionAction = @InActionAction,
        InActionCollectionID = @InActionCollectionID,
        PayloadAttachment = @PayLoadAttachment
    WHERE AutoNotificationID = @AutoNotificationID;

END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AutoNotificationEdit2_3] @AutoNotificationID INT
AS
BEGIN

    SELECT AutoNotificationID,
           t.Name,
           t.LastRun,
           Active,
           ISNULL(t.[Order], 1000) AS [AOrder],
           t.AudienceFrom,
           ISNULL(t.AudiencePropertyID, '') AS AudiencePropertyID,
           ISNULL(t.DateProperty, '') AS DateProperty,
           t.DayCountTriggers,
           t.Throttle,
           t.itemCondition,
           t.InActionAction,
           t.InActionCollectionID,
           t.TaskGroup,
           ISNULL(t.SendFrom, '') AS SendFrom,
           ISNULL(t.ReplyTo, '') AS ReplyTo,
           ISNULL(t.BccTo, '') AS BccTo,
           t.Weekly,
           t.TemplateID,
           m.SendFrom AS mSendFrom,
           m.ReplyTo AS mReplyTo,
           m.BCC AS mBccTo,
           ISNULL(m.Type, '" & mTemplateType & "') AS templateType,
           m.Label AS NotificationTemplate,
           t.PayloadAttachment,
           t.TraceLog,
           ISNULL(t.QuietMode, 0) AS quietmode,
           ISNULL(t.SuppressOnEmpty, 0) AS suppressOnEmpty,
           ISNULL(t.ReadReceipt, 0) AS readReceipt,
           ISNULL(t.Important, 0) AS important,
           ISNULL(t.PayLoadSQL, '') AS PayLoadSQL,
           ISNULL(t.InAction, '') AS InActionSQL,
           ISNULL(t.PostAction, '') AS PostAction,
           ISNULL(t.Query, '') AS Query
    FROM [ARM_CORE]..[AutoNotification] t
        LEFT JOIN [ARM_CORE]..[NotificationTemplate] m
            ON m.TemplateID = t.TemplateID
    WHERE AutoNotificationID = @AutoNotificationID;

END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AutoNotificationEdit2_4] @mTemplateType NVARCHAR(255)
AS
BEGIN

    SELECT TemplateID,
           Label
    FROM [ARM_CORE].[dbo].[NotificationTemplate] n
    WHERE ISNULL(Type, '') = @mTemplateType
    ORDER BY Label;

END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AutoNotificationEdit2_5]
AS
BEGIN

select distinct IsNull(Type,'') as Type from [ARM_CORE].[dbo].[NotificationTemplate] n order by Type 

END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AutoNotificationEdit2_6]
AS
BEGIN

SELECT [Table],[Column],IsNull([Label],[Lookup]) as [Label], [Lookup] from [ARM_CORE]..[A_Lookup] where [Table] = 'AutoNotification' and [Column] = 'AudienceFrom'  order by [Order]
END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AutoNotificationEdit2_7]
AS
BEGIN

SELECT ChannelID, Name, Bookable from [ARM_CORE]..[ScheduleChannel] order by Bookable, Name

END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AutoNotificationEdit2_8]
AS
BEGIN

SELECT [Table],[Column],IsNull([Label],[Lookup]) as [Label], [Lookup] from [ARM_CORE]..[A_Lookup] where [Table] = 'AutoNotification' and [Column] = 'InActionAction'  order by [Order]
END;


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetBits_2] 
@AssetID NVARCHAR(255)		= ''
--@Auth_User NVARCHAR(255)	= '',
--@Comment NVARCHAR(MAX)		= ''
AS
BEGIN
    SELECT GroupName, Attribute, BitPosition, case when a.[BitSTatus] & Power(CONVERT(bigint,2),BitPosition-1) > 0 then 1 else 0 end as [BitSet]  
	 , (select count(*) from [ARM_CORE]..[A_BitCondition] x where x.GroupName = b.GroupName and x.[Table] = 'Asset' ) as [ac] 
	 FROM [ARM_CORE]..[A_BitCondition] b LEFT JOIN (select 1 as j, BitStatus from [ARM_CORE]..[Asset] where AssetID = @AssetID  ) as a on a.j = 1 where b.[Table] = 'Asset' order by [GroupName], [Order], Attribute 
END
GO



-- =============================================
-- Author:		<Author,,Name>
-- ALTER date: <ALTER Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetEditor_1] 
@AssetID NVARCHAR(255)		= ''
--@Auth_User NVARCHAR(255)	= '',
--@Comment NVARCHAR(MAX)		= ''
AS
BEGIN
     select cmdb.[Type], cmdb.[Model], cmdb.[Make], cmdb.[Owner], cmdb.[AssetTAG] As MachineID, cmdb.[UserID], cmdb.[serialNumber], cmdb.[OS],  
	   cmdb.[Location], cmdb.Live, cmdb.OU,
	   Custom01, Custom02, Custom03, Custom04, Custom05, convert(varchar(10),WarrantyDate,103) as WarrantyDate, convert(varchar(10),Heartbeat,103) as HeartBeat, 
	   cmdb.[Email], cmdb.[BArea], cmdb.[Owner]
	   from [ARM_CORE]..[Asset] cmdb 
	   where cmdb.AssetID = @AssetID
END


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetEditor_2] 
@AssetID NVARCHAR(255)		= ''
--@Auth_User NVARCHAR(255)	= '',
--@Comment NVARCHAR(MAX)		= ''
AS
BEGIN
insert into [ARM_CORE]..[Asset] (AssetID, [Type], [BArea] ) values (@AssetID,'Laptop','{UNSPECIFED}' ) 
END

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetEditor_3] 
@AssetID NVARCHAR(255)		= ''
--@Auth_User NVARCHAR(255)	= '',
--@Comment NVARCHAR(MAX)		= ''
AS
BEGIN
insert into [ARM_CORE]..[AssetStatus] (AssetID) values (@AssetID ) 
END

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetEditor_4] 
--@AssetID NVARCHAR(255)		= ''
--@Auth_User NVARCHAR(255)	= '',
--@Comment NVARCHAR(MAX)		= ''
AS
BEGIN
select BArea from [ARM_CORE]..[BArea] Order By BArea 
END

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetEditor_5] 
--@AssetID NVARCHAR(255)		= ''
--@Auth_User NVARCHAR(255)	= '',
--@Comment NVARCHAR(MAX)		= ''
AS
BEGIN
SELECT [Table],[Column],IsNull([Label],[Lookup]) as [Label], [Lookup] from [ARM_CORE]..[A_Lookup] where [Table] = 'Asset' and [Column] = 'Association'  order by [Order]
END

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetEditor_6] 
--@AssetID NVARCHAR(255)		= ''
--@Auth_User NVARCHAR(255)	= '',
--@Comment NVARCHAR(MAX)		= ''
AS
BEGIN
SELECT [Table],[Column],IsNull([Label],[Lookup]) as [Label], [Lookup] from [ARM_CORE]..[A_Lookup] where [Table] = 'Asset' and [Column] = 'Type'   order by [Order]
END

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetEditor_7] 
-- @AssetID NVARCHAR(255)		= ''
--@Auth_User NVARCHAR(255)	= '',
--@Comment NVARCHAR(MAX)		= ''
AS
BEGIN
SELECT [Table],[Column],IsNull([Label],[Lookup]) as [Label], [Lookup] from [ARM_CORE]..[A_Lookup] where [Table] = 'Asset' and [Column] = 'Status'   order by [Order]
END

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetEditor_8] 
-- @AssetID NVARCHAR(255)		= ''
--@Auth_User NVARCHAR(255)	= '',
--@Comment NVARCHAR(MAX)		= ''
AS
BEGIN
SELECT [Table],[Column],IsNull([Label],[Lookup]) as [Label], [Lookup] from [ARM_CORE]..[A_Lookup] where [Table] = 'Asset' and [Column] = 'LifeCycle'   order by [Order]
END

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetAsis_3] 
@AssetID NVARCHAR(255) = ''
AS
BEGIN
         SELECT u.AssetID, u.ApplicationID as AppID, IsNull(m.[To Be],u.ApplicationID) AS Mapping, 0 as Stop, IsNull(d.[DeployType],'Z') as DType,  
		 d.AppGroupID AS AsIsParentID, (select t.AppGroupID from [ARM_CORE]..[Application] t where t.[ApplicationID] = IsNull(m.[To Be],u.[ApplicationID])) AS ToBeParentID 
		 from [ARM_CORE]..[AppAstAsIs] u  
		 LEFT JOIN [ARM_CORE]..[TransformAppMap] m on m.[As Is] = u.ApplicationID  
		 LEFT JOIN [ARM_CORE]..[Application] d on d.ApplicationID = u.ApplicationID  
		 LEFT JOIN [ARM_CORE]..[AppGroup] a on a.AppGroupID = d.AppGroupID 
		 where u.[AssetID] = @AssetID and NOT u.ApplicationID IS NULL order by DType, u.ApplicationID 
END


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetBatch_1] 
--@AssetID NVARCHAR(255) = ''
AS
BEGIN
SELECT distinct BArea, IsNull(Internal,0) as Internal from [ARM_CORE]..[BArea] order by Internal Desc, BArea
END


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetBatch_2] 
--@AssetID NVARCHAR(255) = ''
AS
BEGIN
SELECT distinct Location from [ARM_CORE]..[Asset]  order by Location  
END


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetBatch_3] 
@Name NVARCHAR(1000) = ''
AS
BEGIN
   DECLARE @sqlStr NVARCHAR(1000) = '
         SELECT s.[name] AS [Column], IsNull(l.[Lookup],''no_lookup_values'') as [Lookup], l.[Label], l.[Order], t.name as [Type] FROM [ARM_CORE]..[syscolumns] s 
		 LEFT JOIN [ARM_CORE]..[A_Lookup] l on l.[Column] = s.[name] and l.[Table] = ''Asset'' 
		 LEFT JOIN [ARM_CORE].sys.[types] t on t.system_type_id = s.xtype 
		 WHERE s.id = object_id(''[ARM_CORE]..[Asset]'') and NOT s.[name] in ('+ @Name +') and IsNull(t.[name],'''') <> ''sysname'' 
		 Order by s.[name], l.[Order], l.[Label] 
   ';
   EXEC(@sqlStr);
         
END


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetBatchDo_1] 
@strSQLsub NVARCHAR(1000) = '',
@Assets NVARCHAR(1000) = ''
AS
BEGIN
   DECLARE @sqlStr NVARCHAR(3000) = '
       update [ARM_CORE]..[Asset] set '+ @strSQLsub +' where AssetID in ('+ @Assets +')
';
   EXEC(@sqlStr);
END


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetBatchDo_2] 
@strSQLsub NVARCHAR(1000) = '',
@Assets NVARCHAR(1000) = ''
AS
BEGIN
   DECLARE @sqlStr NVARCHAR(3000) = '
       update [ARM_CORE]..[AssetCache] set '+ @strSQLsub +' where AssetID in ('+ @Assets +')
';
   EXEC(@sqlStr);
END


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetBatchDo_3] 
@name NVARCHAR(1000) = ''
AS
BEGIN
   DECLARE @sqlStr NVARCHAR(3000) = '
         SELECT distinct s.[name] AS [Column], s.xtype, t.[name] as [Type] FROM [syscolumns] s 
		 LEFT JOIN sys.[types] t on t.system_type_id = s.xtype 
		 LEFT JOIN [ARM_CORE]..[A_Lookup] l on l.[Column] = s.[name] and l.[Table] = ''Asset'' 
		 WHERE s.id = object_id(''[ARM_CORE]..[Asset]'') and NOT s.[name] in ('+ @name +') and IsNull(t.[name],'''') <> ''sysname''
		 Order by s.[name] 
';
   EXEC(@sqlStr);
END

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetBatchDo_4] 
@strSQLsub NVARCHAR(1000) = '',
@Assets NVARCHAR(1000) = ''
AS
BEGIN
   DECLARE @sqlStr NVARCHAR(3000) = '
       SET DATEFORMAT dmy;
	   Update [ARM_CORE]..[Asset] '+ @strSQLsub +' where AssetID in ('+ @Assets +');
';
   EXEC(@sqlStr);
END


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetBatchDo_5] 
@strSQLsub NVARCHAR(1000) = '',
@Assets NVARCHAR(1000) = ''
AS
BEGIN
   DECLARE @sqlStr NVARCHAR(3000) = '
       SET DATEFORMAT dmy;
	   Update [ARM_CORE]..[AssetCache] '+ @strSQLsub +' where AssetID in ('+ @Assets +');
';
   EXEC(@sqlStr);
END


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetBatchDo_6] 
@strSQLsub NVARCHAR(1000) = '',
@Assets NVARCHAR(1000) = ''
AS
BEGIN
   DECLARE @sqlStr NVARCHAR(3000) = '
       SET DATEFORMAT dmy;
	   Update [ARM_CORE]..[Asset] '+ @strSQLsub +' where AssetID in ('+ @Assets +');
';
   EXEC(@sqlStr);
END

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetBatchDo_7] 
@strSQLsub NVARCHAR(1000) = '',
@Assets NVARCHAR(1000) = ''
AS
BEGIN
   DECLARE @sqlStr NVARCHAR(3000) = '
       SET DATEFORMAT dmy;
	   Update [ARM_CORE]..[AssetCache] '+ @strSQLsub +' where AssetID in ('+ @Assets +');
';
   EXEC(@sqlStr);
END


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetBatchDo_8] 
@Assets NVARCHAR(1000) = ''
AS
BEGIN
   DECLARE @sqlStr NVARCHAR(3000) = '
       select AssetID from [ARM_CORE]..[Asset] where AssetID in ('+@Assets +') 
';
   EXEC(@sqlStr);
END


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetBatchDo_9] 
@AssetID NVARCHAR(1000)		= '',
@Auth_User NVARCHAR(255)	= '',
@Comment NVARCHAR(MAX)		= ''
AS
BEGIN
   DECLARE @sqlStr NVARCHAR(3000) = '
        INSERT into [ARM_CORE]..[A_CommentLog] ([Table], [Type], [RecordID], [Author], [TimeStamp], [Internal], [Comment])
		values (''Asset'','''','''+ @AssetID +''','''+ @Auth_User + ''',getdate(),0,''' + @Comment + ''') 
';
   EXEC(@sqlStr);
END
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetBatchDo_10] 
@name NVARCHAR(1000) = ''
AS
BEGIN
   DECLARE @sqlStr NVARCHAR(3000) = '
           SELECT distinct s.[name] AS [Column], s.xtype, t.[name] as [Type] FROM sys.[syscolumns] s 
				 LEFT JOIN sys.[types] t on t.system_type_id = s.xtype 
				 LEFT JOIN [ARM_CORE]..[A_Lookup] l on l.[Column] = s.[name] and l.[Table] = ''Asset'' 
				 WHERE s.id = object_id(''[ARM_CORE]..[Asset]'') and NOT s.[name] in ('+ @name +') and IsNull(t.[name],'''') <> ''sysname'' 
				 Order by s.[name] 
';
   EXEC(@sqlStr);
END

             
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetBatchDo_11] 
@name NVARCHAR(1000) = ''
AS
BEGIN
   DECLARE @sqlStr NVARCHAR(3000) = '
				 select Count(AssetID) as AssetCount from [ARM_CORE]..[Asset] where AssetID in ('+ @name +')
';
   EXEC(@sqlStr);
END


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetBatchDo_12] 
@Assets NVARCHAR(1000) = ''
AS
BEGIN
   DECLARE @sqlStr NVARCHAR(3000) = '
				                 select n.AssetID from [ARM_CORE]..[Asset] y 
				 RIGHT JOIN ( 
				 	select AssetID From (VALUES ' + @Assets +')  n(AssetID) 
				 ) n on y.AssetID = n.AssetID 
				 where y.AssetID IS NULL 
';
   EXEC(@sqlStr);
END

  

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetBits_1] 
--@AssetID NVARCHAR(1000)		= '',
--@Auth_User NVARCHAR(255)	= '',
--@Comment NVARCHAR(MAX)		= ''
AS
BEGIN
  select [RGB] from [ARM_CORE]..[A_ColourPalette] order by IsNull([Order],50+ColourPaletteID) 
END
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetAccessLog_4] 
@scope NVARCHAR(500) = ''
AS
BEGIN

   DECLARE @sqlStr NVARCHAR(4000) = '
		select  top 12 a.AssetID, a.[Type], IsNull(a.[Model],'''') as [Model], a.[Heartbeat], IsNull(a.[SerialNumber],'''') as SerialNumber, 
		a.[OS], IsNull(a.Live,0) as Live, 
		IsNull(a.[UserID],'''') as UserID, IsNull(IsNull(a.[Owner],u.[UserName]),'''') as Owner, a.[Location], IsNull(IsNull(a.[Email],u.[Email]),'''') AS Email,
		IsNull(a.[AssetTAG],'''') AS AssetTag,  a.[Location], 
		a.[BArea], a.[Warrantydate] 
		from [ARM_CORE]..[Asset] a 
		LEFT JOIN [ARM_CORE]..[User] u on u.UserID = a.UserID  
		'+@scope+'  order by a.[Heartbeat] desc 
   ';
   EXEC(@sqlStr);

END

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetAccessLog_6] 
@AssetID NVARCHAR(255) = ''
AS
BEGIN
 select a.AssetAccessLogID, Isnull(a.AssetID,'') as AssetID, IsNull(a.UserID, '') as UserID, IsNull(a.LastDate,'') as LastDate, IsNull(Counter,1) as Counter from [ARM_CORE]..[AssetAccessLog] a where a.AssetID = @AssetID Order by LastDate Desc 
END


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetApplications_1] 
@AssetID NVARCHAR(255) = ''
AS
BEGIN
 select AssetID, IsNull(UserID,'') as UserID from [ARM_CORE]..[Asset] where AssetID = @AssetID
END


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AD_1] 
-- @ApplicationID NVARCHAR(255) = ''
AS
BEGIN
        select a.AssetID, a.BArea, a.UserID, u.BusinessUnit, ad.[sAMAccountName], ad.[distinguishedName], ad.company, ad.department from [ARM_CORE]..[Asset] a 
		 LEFT JOIN [ARM_CORE]..[User] u on u.UserID = a.UserID 
		 LEFT JOIN [ARM_CORE]..[TMP_RAW_AD_USERS] ad on ad.[sAMAccountName] = a.UserID 
		 where [distinguishedName] LIKE '%OU=%' 
		 and a.Live = 1 

END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_ApplicationUsers_1] 
@ApplicationID NVARCHAR(255) = ''
AS
BEGIN

    --SET NOCOUNT ON;

    SELECT a.AppGroupID,
           g.AppGroupName
    FROM ARM_CORE..[Application] a
        LEFT JOIN ARM_CORE..[AppGroup] g
            ON g.AppGroupID = a.AppGroupID
    WHERE a.ApplicationID = @ApplicationID;

END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_ApplicationUsers_2] 
@scope NVARCHAR(255) = '',
@Internal NVARCHAR(255),
@AppGroupKey NVARCHAR(255)
AS
BEGIN

   DECLARE @sqlStr NVARCHAR(1000) = '
   select top 1 s.ApplicationID AS [KEY], count(s.AssetID) AS IC, IsNull(p.[LocalID],'''') AS LocalID 
		 from [ARM_CORE]..'+@scope+' s 
		 LEFT JOIN ARM_CORE..Asset a on a.AssetID = s.AssetID 
		 LEFT JOIN ARM_CORE..Application p on p.ApplicationID = s.ApplicationID  
		 LEFT JOIN ARM_CORE..AppGroup g on g.AppGroupID = p.AppGroupID  
		 LEFT JOIN [ARM_CORE]..[BArea] b on b.BArea = IsNull(a.BArea,'''')   
		 where g.AppGroupID =  '+@AppGroupKey+' and b.Internal =  '+@Internal+' 
		 Group By s.ApplicationID, IsNull(p.[LocalID],''''); 
   ';
   EXEC(@sqlStr);
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AppPackTabViewEdit_1] 
@AssetID NVARCHAR(255) = ''
AS
BEGIN
  select a.UserID from [ARM_CORE]..[Asset] a where a.AssetID = @AssetID
END;

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AppsSummaryBySlice_1] 
@ApplicationID NVARCHAR(255) = ''
AS
BEGIN
 select  a.AppGroupID, g.AppGroupName from [ARM_CORE]..[Application] a 
 LEFT JOIN [ARM_CORE]..[AppGroup] g on g.AppGroupID = a.AppGroupID where a.ApplicationID = @ApplicationID
END


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AppsSummaryBySlice_2]
AS
BEGIN
select Lookup, Label from [ARM_CORE]..[A_Lookup] where [Table] = 'Internal' and [Column] = 'OsFilter' Order By [Order] 
END


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetAccessLog_1] 
@ApplicationID NVARCHAR(255) = ''
AS
BEGIN
 select  a.AppGroupID, g.AppGroupName from [ARM_CORE]..[Application] a 
LEFT JOIN [ARM_CORE]..[AppGroup] g on g.AppGroupID = a.AppGroupID where a.ApplicationID = @ApplicationID
END


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetAccessLog_2] 
@AssetID NVARCHAR(255) = ''
AS
BEGIN
 select * from [ARM_CORE]..[AssetSlotEntries] where AssetID = @AssetID order by [RunDate] Desc
END


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[X_AssetAccessLog_3] 
@AssetID NVARCHAR(255) = ''
AS
BEGIN
 select a.AssetID, a.AssetTag, a.Model, a.SerialNumber, a.Heartbeat, a.BArea, IsNull(a.userID,'') as UserID, a.Owner, a.Email, a.Live 
 FROM [ARM_CORE]..[Asset] a where a.SerialNumber = (select x.SerialNumber from  [ARM_CORE]..[Asset] x where x.AssetID = @AssetID) Order by [Heartbeat] Desc  
END


GO
CREATE PROCEDURE X_A_UserTab_1(@UserID nvarchar(255))
AS
BEGIN
	select IsNull(UserID,'') as UserID from [ARM_CORE]..[User] where UserID = @UserID
END

GO
CREATE PROCEDURE X_AddAssetToSlot_1(@Label nvarchar(255))
AS
BEGIN
	select r.RunID, (Select Count (AssetID) from RunAssets$ z where z.RunID = r.RunID) As AC, r.SlotID, r.Status, r.RunDate, r.Label  from DeployRun$ r where Label =  @Label
END

GO

CREATE PROCEDURE X_AppDependencies_2(@Appkey nvarchar(255))
AS
BEGIN
select  d.ParentAppID as AppID, a.DeployType, a.LocalID 
from [ARM_CORE]..[AppDependency] d Left Join [ARM_CORE]..[Application] a on a.ApplicationID = d.ChildAppID 
where d.ChildAppID = @Appkey
order by d.ParentAppID
END

GO
CREATE PROCEDURE X_AppDependencies_1(@Appkey nvarchar(255))
AS
BEGIN
	select  d.ChildAppID as AppID, a.DeployType, a.LocalID 
	from [ARM_CORE]..[AppDependency] d Left Join [ARM_CORE]..[Application] a on a.ApplicationID = d.ParentAppID 
	where d.ParentAppID = @Appkey
	order by d.ChildAppID
END

GO

	CREATE PROCEDURE dbo.sp_dropdiagram
	(
		@diagramname 	sysname,
		@owner_id	int	= null
	)
	WITH EXECUTE AS 'dbo'
	AS
	BEGIN
		set nocount on
		declare @theId 			int
		declare @IsDbo 			int
		
		declare @UIDFound 		int
		declare @DiagId			int
	
		if(@diagramname is null)
		begin
			RAISERROR ('Invalid value', 16, 1);
			return -1
		end
	
		EXECUTE AS CALLER;
		select @theId = DATABASE_PRINCIPAL_ID();
		select @IsDbo = IS_MEMBER(N'db_owner'); 
		if(@owner_id is null)
			select @owner_id = @theId;
		REVERT; 
		
		select @DiagId = diagram_id, @UIDFound = principal_id from dbo.sysdiagrams where principal_id = @owner_id and name = @diagramname 
		if(@DiagId IS NULL or (@IsDbo = 0 and @UIDFound <> @theId))
		begin
			RAISERROR ('Diagram does not exist or you do not have permission.', 16, 1)
			return -3
		end
	
		delete from dbo.sysdiagrams where diagram_id = @DiagId;
	
		return 0;
	END
	
GO

	CREATE PROCEDURE dbo.sp_alterdiagram
	(
		@diagramname 	sysname,
		@owner_id	int	= null,
		@version 	int,
		@definition 	varbinary(max)
	)
	WITH EXECUTE AS 'dbo'
	AS
	BEGIN
		set nocount on
	
		declare @theId 			int
		declare @retval 		int
		declare @IsDbo 			int
		
		declare @UIDFound 		int
		declare @DiagId			int
		declare @ShouldChangeUID	int
	
		if(@diagramname is null)
		begin
			RAISERROR ('Invalid ARG', 16, 1)
			return -1
		end
	
		execute as caller;
		select @theId = DATABASE_PRINCIPAL_ID();	 
		select @IsDbo = IS_MEMBER(N'db_owner'); 
		if(@owner_id is null)
			select @owner_id = @theId;
		revert;
	
		select @ShouldChangeUID = 0
		select @DiagId = diagram_id, @UIDFound = principal_id from dbo.sysdiagrams where principal_id = @owner_id and name = @diagramname 
		
		if(@DiagId IS NULL or (@IsDbo = 0 and @theId <> @UIDFound))
		begin
			RAISERROR ('Diagram does not exist or you do not have permission.', 16, 1);
			return -3
		end
	
		if(@IsDbo <> 0)
		begin
			if(@UIDFound is null or USER_NAME(@UIDFound) is null) -- invalid principal_id
			begin
				select @ShouldChangeUID = 1 ;
			end
		end

		-- update dds data			
		update dbo.sysdiagrams set definition = @definition where diagram_id = @DiagId ;

		-- change owner
		if(@ShouldChangeUID = 1)
			update dbo.sysdiagrams set principal_id = @theId where diagram_id = @DiagId ;

		-- update dds version
		if(@version is not null)
			update dbo.sysdiagrams set version = @version where diagram_id = @DiagId ;

		return 0
	END
	
GO

	CREATE PROCEDURE dbo.sp_renamediagram
	(
		@diagramname 		sysname,
		@owner_id		int	= null,
		@new_diagramname	sysname
	
	)
	WITH EXECUTE AS 'dbo'
	AS
	BEGIN
		set nocount on
		declare @theId 			int
		declare @IsDbo 			int
		
		declare @UIDFound 		int
		declare @DiagId			int
		declare @DiagIdTarg		int
		declare @u_name			sysname
		if((@diagramname is null) or (@new_diagramname is null))
		begin
			RAISERROR ('Invalid value', 16, 1);
			return -1
		end
	
		EXECUTE AS CALLER;
		select @theId = DATABASE_PRINCIPAL_ID();
		select @IsDbo = IS_MEMBER(N'db_owner'); 
		if(@owner_id is null)
			select @owner_id = @theId;
		REVERT;
	
		select @u_name = USER_NAME(@owner_id)
	
		select @DiagId = diagram_id, @UIDFound = principal_id from dbo.sysdiagrams where principal_id = @owner_id and name = @diagramname 
		if(@DiagId IS NULL or (@IsDbo = 0 and @UIDFound <> @theId))
		begin
			RAISERROR ('Diagram does not exist or you do not have permission.', 16, 1)
			return -3
		end
	
		-- if((@u_name is not null) and (@new_diagramname = @diagramname))	-- nothing will change
		--	return 0;
	
		if(@u_name is null)
			select @DiagIdTarg = diagram_id from dbo.sysdiagrams where principal_id = @theId and name = @new_diagramname
		else
			select @DiagIdTarg = diagram_id from dbo.sysdiagrams where principal_id = @owner_id and name = @new_diagramname
	
		if((@DiagIdTarg is not null) and  @DiagId <> @DiagIdTarg)
		begin
			RAISERROR ('The name is already used.', 16, 1);
			return -2
		end		
	
		if(@u_name is null)
			update dbo.sysdiagrams set [name] = @new_diagramname, principal_id = @theId where diagram_id = @DiagId
		else
			update dbo.sysdiagrams set [name] = @new_diagramname where diagram_id = @DiagId
		return 0
	END
	
GO

	CREATE PROCEDURE dbo.sp_creatediagram
	(
		@diagramname 	sysname,
		@owner_id		int	= null, 	
		@version 		int,
		@definition 	varbinary(max)
	)
	WITH EXECUTE AS 'dbo'
	AS
	BEGIN
		set nocount on
	
		declare @theId int
		declare @retval int
		declare @IsDbo	int
		declare @userName sysname
		if(@version is null or @diagramname is null)
		begin
			RAISERROR (N'E_INVALIDARG', 16, 1);
			return -1
		end
	
		execute as caller;
		select @theId = DATABASE_PRINCIPAL_ID(); 
		select @IsDbo = IS_MEMBER(N'db_owner');
		revert; 
		
		if @owner_id is null
		begin
			select @owner_id = @theId;
		end
		else
		begin
			if @theId <> @owner_id
			begin
				if @IsDbo = 0
				begin
					RAISERROR (N'E_INVALIDARG', 16, 1);
					return -1
				end
				select @theId = @owner_id
			end
		end
		-- next 2 line only for test, will be removed after define name unique
		if EXISTS(select diagram_id from dbo.sysdiagrams where principal_id = @theId and name = @diagramname)
		begin
			RAISERROR ('The name is already used.', 16, 1);
			return -2
		end
	
		insert into dbo.sysdiagrams(name, principal_id , version, definition)
				VALUES(@diagramname, @theId, @version, @definition) ;
		
		select @retval = @@IDENTITY 
		return @retval
	END
	
GO

	CREATE PROCEDURE dbo.sp_helpdiagramdefinition
	(
		@diagramname 	sysname,
		@owner_id	int	= null 		
	)
	WITH EXECUTE AS N'dbo'
	AS
	BEGIN
		set nocount on

		declare @theId 		int
		declare @IsDbo 		int
		declare @DiagId		int
		declare @UIDFound	int
	
		if(@diagramname is null)
		begin
			RAISERROR (N'E_INVALIDARG', 16, 1);
			return -1
		end
	
		execute as caller;
		select @theId = DATABASE_PRINCIPAL_ID();
		select @IsDbo = IS_MEMBER(N'db_owner');
		if(@owner_id is null)
			select @owner_id = @theId;
		revert; 
	
		select @DiagId = diagram_id, @UIDFound = principal_id from dbo.sysdiagrams where principal_id = @owner_id and name = @diagramname;
		if(@DiagId IS NULL or (@IsDbo = 0 and @UIDFound <> @theId ))
		begin
			RAISERROR ('Diagram does not exist or you do not have permission.', 16, 1);
			return -3
		end

		select version, definition FROM dbo.sysdiagrams where diagram_id = @DiagId ; 
		return 0
	END
	
GO

	CREATE PROCEDURE dbo.sp_helpdiagrams
	(
		@diagramname sysname = NULL,
		@owner_id int = NULL
	)
	WITH EXECUTE AS N'dbo'
	AS
	BEGIN
		DECLARE @user sysname
		DECLARE @dboLogin bit
		EXECUTE AS CALLER;
			SET @user = USER_NAME();
			SET @dboLogin = CONVERT(bit,IS_MEMBER('db_owner'));
		REVERT;
		SELECT
			[Database] = DB_NAME(),
			[Name] = name,
			[ID] = diagram_id,
			[Owner] = USER_NAME(principal_id),
			[OwnerID] = principal_id
		FROM
			sysdiagrams
		WHERE
			(@dboLogin = 1 OR USER_NAME(principal_id) = @user) AND
			(@diagramname IS NULL OR name = @diagramname) AND
			(@owner_id IS NULL OR principal_id = @owner_id)
		ORDER BY
			4, 5, 1
	END
	
GO

	CREATE PROCEDURE dbo.sp_upgraddiagrams
	AS
	BEGIN
		IF OBJECT_ID(N'dbo.sysdiagrams') IS NOT NULL
			return 0;
	
		CREATE TABLE dbo.sysdiagrams
		(
			name sysname NOT NULL,
			principal_id int NOT NULL,	-- we may change it to varbinary(85)
			diagram_id int PRIMARY KEY IDENTITY,
			version int,
	
			definition varbinary(max)
			CONSTRAINT UK_principal_name UNIQUE
			(
				principal_id,
				name
			)
		);


		/* Add this if we need to have some form of extended properties for diagrams */
		/*
		IF OBJECT_ID(N'dbo.sysdiagram_properties') IS NULL
		BEGIN
			CREATE TABLE dbo.sysdiagram_properties
			(
				diagram_id int,
				name sysname,
				value varbinary(max) NOT NULL
			)
		END
		*/

		IF OBJECT_ID(N'dbo.dtproperties') IS NOT NULL
		begin
			insert into dbo.sysdiagrams
			(
				[name],
				[principal_id],
				[version],
				[definition]
			)
			select	 
				convert(sysname, dgnm.[uvalue]),
				DATABASE_PRINCIPAL_ID(N'dbo'),			-- will change to the sid of sa
				0,							-- zero for old format, dgdef.[version],
				dgdef.[lvalue]
			from dbo.[dtproperties] dgnm
				inner join dbo.[dtproperties] dggd on dggd.[property] = 'DtgSchemaGUID' and dggd.[objectid] = dgnm.[objectid]	
				inner join dbo.[dtproperties] dgdef on dgdef.[property] = 'DtgSchemaDATA' and dgdef.[objectid] = dgnm.[objectid]
				
			where dgnm.[property] = 'DtgSchemaNAME' and dggd.[uvalue] like N'_EA3E6268-D998-11CE-9454-00AA00A3F36E_' 
			return 2;
		end
		return 1;
	END
	
GO
CREATE PROCEDURE  [dbo].[SYS_PrimeTableEdits]
AS
BEGIN
	
	MERGE [ARM_CORE]..[A_TableEdit] AS Target 
	USING (
		SELECT distinct t.[Table], s.[name] AS [Column], s.[colorder] FROM [ARM_CORE]..[A_TableEdit] t LEFT JOIN [ARM_CORE]..[A_TablePermit] p on p.[Table] = t.[Table] LEFT JOIN [ARM_CORE]..[syscolumns] s on s.id = object_id('[ARM_CORE]..[' + t.[Table] + ']') where p.[Schema] in ('ARM_CORE')
	) AS Source 
	ON (Target.[Table] = Source.[Table] and Target.[Column] = Source.[Column] ) 
	WHEN NOT MATCHED BY TARGET THEN 
		INSERT ([Table],[Column],[Order]) 
		VALUES (Source.[Table],Source.[Column],Source.[colorder]);


	delete from [ARM_CORE]..[A_TableEdit] where [TableEditID] in (
		SELECT t.[TableEditID] FROM [ARM_CORE]..[A_TableEdit]  t LEFT JOIN [ARM_CORE]..[A_TablePermit] p on p.[Table] = t.[Table] LEFT JOIN [ARM_CORE]..[syscolumns] s on s.id = object_id('[ARM_CORE]..[' + t.[Table] + ']') where s.[name] IS NULL and p.[Schema] in ('ARM_CORE')
	)

END

GO
CREATE PROCEDURE [dbo].[X_AssetAsis_2] 
@AssetID NVARCHAR(255) = ''
AS
BEGIN
        select distinct s.[ApplicationID] as AppID, IsNull(m.[To Be],s.[ApplicationID]) AS Mapping, 
		  IsNull(t.Action,'') as Action, 
		 isNull((select  Top 1 t.[Reason]  from [ARM_CORE]..[TransformAppStop] t LEFT JOIN [ARM_CORE]..[A_lookUp] l on l.[Lookup] = t.reason where s.ApplicationID like t.ApplicationID order by l.[Order] ),'') AS Stop 
		 from [ARM_CORE]..[AppAstPreStop] s  
		 LEFT JOIN [ARM_CORE]..[Application] a on a.[ApplicationID] = s.[ApplicationID]  
		 LEFT JOIN [ARM_CORE]..[AppGroup] g on g.AppGroupID = a.AppGroupID
		 LEFT JOIN [ARM_CORE]..[ApplicationTransaction] t on t.[ApplicationID] = s.[ApplicationID]  and Rewind = 1  
		 LEFT JOIN [ARM_CORE]..[TransformAppMap] m on m.[As Is] = s.[ApplicationID]  
		 LEFT JOIN [ARM_CORE]..[A_AppGroupType] gt on gt.AppGroupType = g.AppGroupType
		 LEFT JOIN [ARM_CORE]..[Application] a2 on a2.[ApplicationID] = IsNull(m.[To Be],s.[ApplicationID])  
		 LEFT JOIN [ARM_CORE]..[A_Lookup] lu2 ON lu2.[Table] = 'Internal' 
		 where s.[AssetID] =  @AssetID and NOT s.ApplicationID IS NULL order by s.[ApplicationID], Stop 
END


GO
-- =============================================
-- Author:		Andy Bex
-- Create date: 8/3/22
-- Description:	Creates Survey tables - enables these to be removed.
-- =============================================
CREATE PROCEDURE [dbo].[CREATE_CheckList]
	-- Add the parameters for the stored procedure here
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

/****** Object:  Table [dbo].[CheckList]    Script Date: 3/10/2022 10:46:55 AM ******/
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON

CREATE TABLE [dbo].[CheckList](
	[CheckListID] [int] IDENTITY(1,1) NOT NULL,
	[CheckListName] [nvarchar](250) NOT NULL,
	[Title] [nvarchar](250) NULL,
	[Navigator] [bit] NULL,
	[Progress] [bit] NULL,
	[IsBArea] [bit] NULL,
	[ControlledList] [bit] NULL,
	[Active] [bit] NULL,
	[LowThreshold] [int] NULL,
	[HighThreshold] [int] NULL,
	[BRAG] [bit] NULL,
	[Project] [nvarchar](250) NULL,
	[ShowOVR] [bit] NULL,
	[WeeklySnapShot] [bit] NULL
) ON [PRIMARY]

ALTER TABLE [dbo].[CheckList] ADD  CONSTRAINT [DF_CheckList_CheckListName]  DEFAULT ('') FOR [CheckListName]
ALTER TABLE [dbo].[CheckList] ADD  CONSTRAINT [DF_CheckList_Navigator]  DEFAULT ((1)) FOR [Navigator]
ALTER TABLE [dbo].[CheckList] ADD  CONSTRAINT [DF_CheckList_Progress]  DEFAULT ((1)) FOR [Progress]
ALTER TABLE [dbo].[CheckList] ADD  CONSTRAINT [DF_CheckList_IsBArea]  DEFAULT ((0)) FOR [IsBArea]
ALTER TABLE [dbo].[CheckList] ADD  CONSTRAINT [DF_CheckList_ControlledList]  DEFAULT ((0)) FOR [ControlledList]
ALTER TABLE [dbo].[CheckList] ADD  CONSTRAINT [DF_CheckList_Active]  DEFAULT ((1)) FOR [Active]
ALTER TABLE [dbo].[CheckList] ADD  CONSTRAINT [DF_CheckList_LowThreshold]  DEFAULT ((25)) FOR [LowThreshold]
ALTER TABLE [dbo].[CheckList] ADD  CONSTRAINT [DF_CheckList_HighThreshold]  DEFAULT ((75)) FOR [HighThreshold]
ALTER TABLE [dbo].[CheckList] ADD  CONSTRAINT [DF_CheckList_BRAG]  DEFAULT ((1)) FOR [BRAG]
ALTER TABLE [dbo].[CheckList] ADD  CONSTRAINT [DF_CheckList_ShowOVR]  DEFAULT ((1)) FOR [ShowOVR]
ALTER TABLE [dbo].[CheckList] ADD  CONSTRAINT [DF_CheckList_WeeklySnapShot]  DEFAULT ((0)) FOR [WeeklySnapShot]

/****** Object:  Table [dbo].[CheckListAuditLog]    Script Date: 3/10/2022 10:47:05 AM ******/
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON

CREATE TABLE [dbo].[CheckListAuditLog](
	[CheckListAuditLog] [int] IDENTITY(1,1) NOT NULL,
	[Action] [nchar](50) NULL,
	[CheckListresponseID] [int] NULL,
	[ItemID] [int] NULL,
	[Value] [nvarchar](50) NULL,
	[Area] [nchar](255) NULL,
	[AuthUser] [nchar](255) NULL,
	[TimeStamp] [datetime] NULL,
	[ChecklistID] [int] NULL
) ON [PRIMARY]

/****** Object:  Table [dbo].[CheckListControlList]    Script Date: 3/10/2022 10:47:13 AM ******/
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON

CREATE TABLE [dbo].[CheckListControlList](
	[CheckListControlListID] [int] IDENTITY(1,1) NOT NULL,
	[CheckListID] [int] NULL,
	[Area] [nvarchar](255) NULL,
	[Active] [bit] NULL
) ON [PRIMARY]

ALTER TABLE [dbo].[CheckListControlList] ADD  CONSTRAINT [DF_CheckListControlList_Active]  DEFAULT ((1)) FOR [Active]

/****** Object:  Table [dbo].[CheckListGroup]    Script Date: 3/10/2022 10:47:20 AM ******/
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON

CREATE TABLE [dbo].[CheckListGroup](
	[CheckListGroupID] [int] IDENTITY(1,1) NOT NULL,
	[Name] [nvarchar](250) NULL,
	[Order] [int] NULL,
	[CheckListID] [int] NULL,
	[Comment] [nvarchar](max) NULL,
	[Stage] [nvarchar](250) NULL,
	[Active] [bit] NOT NULL,
	[StageOrder] [int] NULL,
	[CheckListStageID] [int] NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

ALTER TABLE [dbo].[CheckListGroup] ADD  CONSTRAINT [DF_RCheckListGroup_Order]  DEFAULT ((100)) FOR [Order]
ALTER TABLE [dbo].[CheckListGroup] ADD  CONSTRAINT [DF_CheckListGroup_Active]  DEFAULT ((1)) FOR [Active]
ALTER TABLE [dbo].[CheckListGroup] ADD  CONSTRAINT [DF_CheckListGroup_StageOrder]  DEFAULT ((100)) FOR [StageOrder]

/****** Object:  Table [dbo].[CheckListItem]    Script Date: 3/10/2022 10:47:27 AM ******/
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON

CREATE TABLE [dbo].[CheckListItem](
	[CheckListItemID] [int] IDENTITY(1,1) NOT NULL,
	[CheckListGroupID] [int] NOT NULL,
	[Item] [nvarchar](500) NULL,
	[SubOrder] [int] NULL,
	[Weight] [int] NULL,
	[Description] [nvarchar](max) NULL,
	[Active] [bit] NOT NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

ALTER TABLE [dbo].[CheckListItem] ADD  CONSTRAINT [DF_CheckListItem_CheckListGroupID]  DEFAULT ((0)) FOR [CheckListGroupID]
ALTER TABLE [dbo].[CheckListItem] ADD  CONSTRAINT [DF_CheckListItem_Item]  DEFAULT ('') FOR [Item]
ALTER TABLE [dbo].[CheckListItem] ADD  CONSTRAINT [DF_CheckListItem_SubOrder]  DEFAULT ((100)) FOR [SubOrder]
ALTER TABLE [dbo].[CheckListItem] ADD  CONSTRAINT [DF_CheckListItem_Weight]  DEFAULT ((1)) FOR [Weight]
ALTER TABLE [dbo].[CheckListItem] ADD  CONSTRAINT [DF_CheckListItem_Active]  DEFAULT ((0)) FOR [Active]

/****** Object:  Table [dbo].[CheckListOption]    Script Date: 3/10/2022 10:47:35 AM ******/
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON

CREATE TABLE [dbo].[CheckListOption](
	[CheckListOptionID] [int] IDENTITY(1,1) NOT NULL,
	[Label] [nvarchar](50) NULL,
	[Value] [int] NULL,
	[Colour] [nvarchar](50) NULL,
	[CheckListID] [int] NULL,
	[Order] [int] NULL,
	[Slider] [bit] NULL
) ON [PRIMARY]

ALTER TABLE [dbo].[CheckListOption] ADD  CONSTRAINT [DF_CheckListOption_CheckListID]  DEFAULT ((0)) FOR [CheckListID]
ALTER TABLE [dbo].[CheckListOption] ADD  CONSTRAINT [DF_CheckListOption_Order]  DEFAULT ((0)) FOR [Order]
	
/****** Object:  Table [dbo].[CheckListResponse]    Script Date: 3/10/2022 10:47:41 AM ******/
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON

CREATE TABLE [dbo].[CheckListResponse](
	[CheckListResponseID] [int] IDENTITY(1,1) NOT NULL,
	[ItemID] [int] NULL,
	[Value] [nvarchar](50) NULL,
	[Area] [nvarchar](255) NULL,
	[AuthUser] [nvarchar](255) NULL,
	[TimeStamp] [datetime] NULL,
	[CheckListID] [int] NULL
) ON [PRIMARY]

ALTER TABLE [dbo].[CheckListResponse] ADD  CONSTRAINT [DF_CheckListResponse_TimeStamp]  DEFAULT (getdate()) FOR [TimeStamp]


/****** Object:  Table [dbo].[CheckListResponseNote]    Script Date: 3/10/2022 10:47:48 AM ******/
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON

CREATE TABLE [dbo].[CheckListResponseNote](
	[CheckListresponseNoteID] [int] IDENTITY(1,1) NOT NULL,
	[CheckListGroupID] [int] NULL,
	[Area] [nvarchar](255) NULL,
	[Note] [nvarchar](max) NULL,
	[Author] [nvarchar](255) NULL,
	[TimeStamp] [datetime] NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

ALTER TABLE [dbo].[CheckListResponseNote] ADD  CONSTRAINT [DF_CheckListResponseNote_CheckListGroupID]  DEFAULT ((0)) FOR [CheckListGroupID]
ALTER TABLE [dbo].[CheckListResponseNote] ADD  CONSTRAINT [DF_CheckListResponseNote_Area]  DEFAULT ('') FOR [Area]
ALTER TABLE [dbo].[CheckListResponseNote] ADD  CONSTRAINT [DF_CheckListResponseNote_Note]  DEFAULT ('') FOR [Note]
ALTER TABLE [dbo].[CheckListResponseNote] ADD  CONSTRAINT [DF_CheckListResponseNote_TimeStamp]  DEFAULT (getdate()) FOR [TimeStamp]

/****** Object:  Table [dbo].[CheckListSnapShot]    Script Date: 3/10/2022 10:47:56 AM ******/
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON

CREATE TABLE [dbo].[CheckListSnapShot](
	[CheckListSnapShotID] [int] IDENTITY(1,1) NOT NULL,
	[ItemID] [int] NULL,
	[Value] [nvarchar](50) NULL,
	[Area] [nvarchar](255) NULL,
	[AuthUser] [nvarchar](255) NULL,
	[TimeStamp] [datetime] NULL,
	[CheckListID] [int] NULL
) ON [PRIMARY]
ALTER TABLE [dbo].[CheckListSnapShot] ADD  CONSTRAINT [DF_CheckListSnapShot_TimeStamp]  DEFAULT (getdate()) FOR [TimeStamp]

/****** Object:  Table [dbo].[CheckListStage]    Script Date: 3/10/2022 10:48:04 AM ******/
SET ANSI_NULLS ON

SET QUOTED_IDENTIFIER ON

CREATE TABLE [dbo].[CheckListStage](
	[CheckListStageID] [int] IDENTITY(1,1) NOT NULL,
	[ChecklistID] [int] NULL,
	[Stage] [nvarchar](255) NULL,
	[StageOrder] [int] NOT NULL,
	[Active] [bit] NOT NULL
) ON [PRIMARY]
ALTER TABLE [dbo].[CheckListStage] ADD  CONSTRAINT [DF_CheckListStage_StageOrder]  DEFAULT ((100)) FOR [StageOrder]
ALTER TABLE [dbo].[CheckListStage] ADD  CONSTRAINT [DF_CheckListStage_Active]  DEFAULT ((1)) FOR [Active]

END

GO
CREATE PROCEDURE [dbo].[CREATE_CollectionUserGroups]
As
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
        SET NOCOUNT ON;
DECLARE @CCID INT;
--DECLARE @CID_1 INT;  --Require if setting an A_CollectionAgent
 
-- ALTER Collection Class for System supported Workstream Status.
insert into [ARM_CORE]..[A_CollectionClass] ([Name],[Description],[Distinct],[Status],[UseCollectionColours],[Tracker]) values ('User Groups','List of User Groups enabling emails.',0,1,1,0)
Set @CCID = SCOPE_IDENTITY();
 
-- ALTER System supported Workstream Status.
insert into [ARM_CORE]..[A_Collection] ([Name],[Group],[Order],[Type],[Marker],[CollectionClassID],[Colour]) values ('SPOC','SPOC',10,'User',0,@CCID,'green')
insert into [ARM_CORE]..[A_Collection] ([Name],[Group],[Order],[Type],[Marker],[CollectionClassID],[Colour]) values ('Steerco','Steerco',20,'Other',0,@CCID,'blue')
--set @CID_1 = SCOPE_IDENTITY(); --Require if setting an A_CollectionAgent

-- Add A_CollectionAgent (Sample) - Requires the corresponding @CID_ set froom Collections above
--insert into [ARM_CORE]..[A_CollectionAgent] ([Label],[qualifySQL],[Mode],[CollectionID],[Frequency],[Active],[Order],[Pass],[Info])
--values ('Not Live','Select asssetid from arm_core..asset where live = 0',0,@CID_1,'5,6,7,8,9,10,11,12,13,14,15,16,17,23',1,100,0,'')


end



GO
CREATE PROCEDURE [dbo].[CREATE_CollectionPackages]
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
        SET NOCOUNT ON;
DECLARE @CCID INT;
 
-- ALTER Collection Class for System supported Workstream Status.
insert into [ARM_CORE]..[A_CollectionClass] ([Name],[Description],[Distinct],[Status],[UseCollectionColours],[Tracker]) values ('Packages','List of Packages Available to Assign to Applications',1,1,1,1)
Set @CCID = SCOPE_IDENTITY();
 
-- ALTER System supported Workstream Status.
insert into [ARM_CORE]..[A_Collection] ([Name],[Group],[Order],[Type],[Marker],[CollectionClassID],[Colour]) values ('Discovery','Discovery',10,'Other',0,@CCID,'green')
insert into [ARM_CORE]..[A_Collection] ([Name],[Group],[Order],[Type],[Marker],[CollectionClassID],[Colour],[EndState]) values ('Exclude','Exclude',20,'Other',0,@CCID,'purple',1)
END


GO
CREATE PROCEDURE [dbo].[CREATE_Workstream]
        @WSname nvarchar(255) = 'Workstream ',
		@WSprogram nvarchar(255) = ''
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
        SET NOCOUNT ON;
DECLARE @CCID INT;
DECLARE @WSID INT;
DECLARE @DISCOVERY_ID INT;
DECLARE @READY_ID INT;
DECLARE @ENGAGED_ID INT;
DECLARE @NORESPONSE_ID INT;
DECLARE @SCHED_ID INT;
DECLARE @DEPLOYED_ID INT;
DECLARE @DEF_ID INT;
DECLARE @NOTLIVE_ID INT;

DECLARE @BOOKING_ID INT;
 
-- ALTER Collection Class for System supported Workstream Status.
insert into [ARM_CORE]..[A_CollectionClass] ([Name],[Description],[Distinct],[Status],[UseCollectionColours]) values (@WSname,'',1,1,1)
Set @CCID = SCOPE_IDENTITY();
 
-- ALTER System supported Workstream Status.
insert into [ARM_CORE]..[A_Collection] ([Name],[Group],[Order],[Type],[Marker],[CollectionClassID],[Colour]) values ('Discovery','Discovery',10,'Asset',0,@CCID,'yellow')
Set @DISCOVERY_ID = SCOPE_IDENTITY();
insert into [ARM_CORE]..[A_Collection] ([Name],[Group],[Order],[Type],[Marker],[CollectionClassID],[Colour]) values ('Ready to Deploy','Ready to Deploy',20,'Asset',0,@CCID,'light-green')
Set @READY_ID = SCOPE_IDENTITY();
insert into [ARM_CORE]..[A_Collection] ([Name],[Group],[Order],[Type],[Marker],[CollectionClassID],[Colour]) values ('Engaged','Engaged',30,'Asset',0,@CCID,'green')
Set @ENGAGED_ID = SCOPE_IDENTITY();
insert into [ARM_CORE]..[A_Collection] ([Name],[Group],[Order],[Type],[Marker],[CollectionClassID],[Colour]) values ('No Response','No Response',40,'Asset',0,@CCID,'orange')
Set @NORESPONSE_ID = SCOPE_IDENTITY();
insert into [ARM_CORE]..[A_Collection] ([Name],[Group],[Order],[Type],[Marker],[CollectionClassID],[Colour]) values ('Scheduled','Scheduled',50,'Asset',0,@CCID,'dark-green')
Set @SCHED_ID = SCOPE_IDENTITY();
insert into [ARM_CORE]..[A_Collection] ([Name],[Group],[Order],[Type],[Marker],[CollectionClassID],[Colour],[Deployed], [EndState]) values ('Deployed','Deployed',60,'Asset',0,@CCID,'blue',1,1)
Set @DEPLOYED_ID = SCOPE_IDENTITY();
insert into [ARM_CORE]..[A_Collection] ([Name],[Group],[Order],[Type],[Marker],[CollectionClassID],[Colour]) values ('Deferred','Deferred',70,'Asset',0,@CCID,'light-purple')
Set @DEF_ID = SCOPE_IDENTITY();
insert into [ARM_CORE]..[A_Collection] ([Name],[Group],[Order],[Type],[Marker],[CollectionClassID],[Colour],[EndState]) values ('Out of Scope','Out of Scope',80,'Asset',0,@CCID,'purple',1)
Set @NOTLIVE_ID = SCOPE_IDENTITY();
insert into [ARM_CORE]..[A_Collection] ([Name],[Group],[Order],[Type],[Marker],[CollectionClassID],[Colour],[EndState]) values ('Not Live','Not Live',90,'Asset',0,@CCID,'dark-purple',1)
--Set @NOTLIVE_ID = SCOPE_IDENTITY();

-- ALTER new Workstream .
insert into [ARM_CORE]..[Workstream] ([Name],[Purpose],[KeyStatusID],[Active],[TargettedID],[ConfirmedID],[NoResponseID],[ScheduledID],[DeployedID],[DeferredID],[NotLiveID],[ClosedList],[ACLProtected], [Program]) values (@WSname,'',@CCID,0, @DISCOVERY_ID, @ENGAGED_ID, @NORESPONSE_ID, @SCHED_ID, @DEPLOYED_ID, @DEF_ID, @NOTLIVE_ID, 1, 1, @WSprogram)
Set @WSID = SCOPE_IDENTITY();
update [ARM_CORE]..[A_CollectionClass] set [WorkstreamID] = @WSID where [CollectionClassID] = @CCID

insert [ARM_CORE]..[A_SlotStatusDefinition] ( [Label] ,[MapToCollectionID] ,[Deployed] ,[Failed] ,[RemoveFromSlot] ,[SQLTrigger] ,[WorkstreamID] ,[Order], [Logged] ) values ( 'Deployed' , @DEPLOYED_ID , 1 , 0 , 0 , NULL , @WSID , 300, 1)
insert [ARM_CORE]..[A_SlotStatusDefinition] ( [Label] ,[MapToCollectionID] ,[Deployed] ,[Failed] ,[RemoveFromSlot] ,[SQLTrigger] ,[WorkstreamID] ,[Order], [Logged] ) values ( 'No Show (Reschedule)' , @ENGAGED_ID , 0 , 1 , 0 , NULL , @WSID , 400, 1)
insert [ARM_CORE]..[A_SlotStatusDefinition] ( [Label] ,[MapToCollectionID] ,[Deployed] ,[Failed] ,[RemoveFromSlot] ,[SQLTrigger] ,[WorkstreamID] ,[Order], [Logged] ) values ( 'No Deploy (Reschedule)' , @ENGAGED_ID , 0 , 1 , 0 , NULL , @WSID , 500, 0)
insert [ARM_CORE]..[A_SlotStatusDefinition] ( [Label] ,[MapToCollectionID] ,[Deployed] ,[Failed] ,[RemoveFromSlot] ,[SQLTrigger] ,[WorkstreamID] ,[Order], [Logged] ) values ( 'No Deploy (No Reschedule)' , @DISCOVERY_ID , 0 , 1 , 0 , NULL , @WSID , 550, 0)insert [ARM_CORE]..[A_SlotStatusDefinition] ( [Label] ,[MapToCollectionID] ,[Deployed] ,[Failed] ,[RemoveFromSlot] ,[SQLTrigger] ,[WorkstreamID] ,[Order], [Logged] ) values ( 'Failed' , 0 , 0 , 1 , 0 , NULL , @WSID , 600, 0)
--insert [ARM_CORE]..[A_SlotStatusDefinition] ( [Label] ,[MapToCollectionID] ,[Deployed] ,[Failed] ,[RemoveFromSlot] ,[SQLTrigger] ,[WorkstreamID] ,[Order], [Logged] ) values ( 'Delete and Set to Targeted' , @DISCOVERY_ID , 0 , 0 , 1 , NULL , @WSID , 700, 0)
--insert [ARM_CORE]..[A_SlotStatusDefinition] ( [Label] ,[MapToCollectionID] ,[Deployed] ,[Failed] ,[RemoveFromSlot] ,[SQLTrigger] ,[WorkstreamID] ,[Order], [Logged] ) values ( 'Delete and Set to Engaged' , @ENGAGED_ID , 0 , 0 , 1 , NULL , @WSID , 800, 0)
--insert [ARM_CORE]..[A_SlotStatusDefinition] ( [Label] ,[MapToCollectionID] ,[Deployed] ,[Failed] ,[RemoveFromSlot] ,[SQLTrigger] ,[WorkstreamID] ,[Order], [Logged] ) values ( 'Received' , 0 , 0 , 0 , 0 , NULL , @WSID , 100, 0)
--insert [ARM_CORE]..[A_SlotStatusDefinition] ( [Label] ,[MapToCollectionID] ,[Deployed] ,[Failed] ,[RemoveFromSlot] ,[SQLTrigger] ,[WorkstreamID] ,[Order], [Logged] ) values ( 'Delete and Remove from Workstream' , -1 , 0 , 0 , 1 , NULL , @WSID , 900, 0)

-- Create a Booking (no schedule) and Manual Channel

INSERT [ARM_CORE].[dbo].[ScheduleChannel] ([Name],[ShortName],[BgColour],[Bookable],[AssetType],[Mode],[Active],[WorkstreamID])
VALUES(	@WSname+' Laptops',UPPER(LEFT(@WSname,2)),'#777777',1,'Laptop','BOOKABLE',0,@WSID) 
Set @BOOKING_ID = SCOPE_IDENTITY();

INSERT [ARM_CORE].[dbo].[ScheduleChannel] ([Name],[ShortName],[BgColour],[Bookable],[AssetType],[Mode],[Active],[WorkstreamID])
VALUES(@WSname+' - Manual',UPPER(LEFT(@WSname,1))+'M','#997777',0,'ALL','MANUAL',1,@WSID) 

-- Set up supporting Autonotifications (NEED TO SPECIFY TEMPLATE IDS)

INSERT [ARM_CORE].[dbo].[AutoNotification] ( [Name],[Active],[AudienceFrom],[AudiencePropertyID],[DateProperty],[TraceLog],[Order],[TemplateID],[Throttle],[InActionAction]
      ,[InActionCollectionID],[Taskgroup],[ReadReceipt],[Important],[DayCountTriggers] )
VALUES(@WSname+' Booking Request',0,'Collection',@ENGAGED_ID,'Days After',1,1000,0,200,'',0,'PC Refresh',0,0,'0,3,7')
  
INSERT [ARM_CORE].[dbo].[AutoNotification] ( [Name],[Active],[AudienceFrom],[AudiencePropertyID],[DateProperty],[TraceLog],[Order],[TemplateID],[Throttle],[InActionAction]
      ,[InActionCollectionID],[Taskgroup],[ReadReceipt],[Important],[DayCountTriggers] )
VALUES(@WSname+' Booking Request MOVE',0,'Collection',@ENGAGED_ID,'Days After',1,1000,0,200,'Add to Collection',@NORESPONSE_ID,'PC Refresh',0,0,'10')

INSERT [ARM_CORE].[dbo].[AutoNotification] ( [Name],[Active],[AudienceFrom],[AudiencePropertyID],[DateProperty],[TraceLog],[Order],[TemplateID],[Throttle],[InActionAction]
      ,[InActionCollectionID],[Taskgroup],[ReadReceipt],[Important],[DayCountTriggers] )
VALUES(@WSname+' Reminder',0,'Schedule',@BOOKING_ID,'1',1,1000,0,-1,'',0,'PC Refresh',0,0,'0')

INSERT [ARM_CORE].[dbo].[AutoNotification] ( [Name],[Active],[AudienceFrom],[AudiencePropertyID],[DateProperty],[TraceLog],[Order],[TemplateID],[Throttle],[InActionAction]
      ,[InActionCollectionID],[Taskgroup],[ReadReceipt],[Important],[DayCountTriggers] )
VALUES(@WSname+' Support',0,'Collection',@DEPLOYED_ID,'Days After',1,1000,0,-1,'',0,'PC Refresh',0,0,'0')

--Return the result set of the table variable.
SELECT @WSID AS [NewWorkstreamID]
END


GO
-- =============================================
-- Author:		Andy Bex
-- Create date: 8/3/22
-- Description:	Creates Survey tables - enables these to be removed.
-- =============================================
CREATE PROCEDURE CREATE_Survey
	-- Add the parameters for the stored procedure here
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;


/****** Object:  Table [dbo].[Survey]    Script Date: 3/8/2022 4:22:15 PM ******/
SET ANSI_NULLS ON

SET QUOTED_IDENTIFIER ON

CREATE TABLE [dbo].[Survey](
	[SID] [int] IDENTITY(1,1) NOT NULL,
	[Title] [nvarchar](150) NULL,
	[Published] [bit] NOT NULL,
	[PublishedOn] [datetime] NULL,
	[Active] [bit] NOT NULL,
	[Key] [nvarchar](50) NULL,
	[Auth_User] [nvarchar](255) NULL
) ON [PRIMARY]
ALTER TABLE [dbo].[Survey] ADD  CONSTRAINT [DF_Survey_Published]  DEFAULT ((0)) FOR [Published]
ALTER TABLE [dbo].[Survey] ADD  CONSTRAINT [DF_Survey_PublishedOn]  DEFAULT (getdate()) FOR [PublishedOn]
ALTER TABLE [dbo].[Survey] ADD  CONSTRAINT [DF_Survey_Active]  DEFAULT ((0)) FOR [Active]
ALTER TABLE [dbo].[Survey] ADD  CONSTRAINT [DF_Survey_Key]  DEFAULT (newid()) FOR [Key]

/****** Object:  Table [dbo].[SurveyEGrid]    Script Date: 3/8/2022 4:23:06 PM ******/
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON

CREATE TABLE [dbo].[SurveyEGrid](
	[AID] [int] IDENTITY(1,1) NOT NULL,
	[QID] [int] NULL,
	[KPI] [nvarchar](125) NULL,
	[Description] [nvarchar](1024) NULL,
	[HowMeasured] [nvarchar](1024) NULL,
	[Weight] [smallint] NULL,
	[Auth_User] [nvarchar](255) NULL,
	[1Guide] [nvarchar](1024) NULL,
	[2Guide] [nvarchar](1024) NULL,
	[3Guide] [nvarchar](1024) NULL,
	[4Guide] [nvarchar](1024) NULL,
	[5Guide] [nvarchar](1024) NULL,
	[SID] [int] NULL
) ON [PRIMARY]
/****** Object:  Table [dbo].[SurveyEOption]    Script Date: 3/8/2022 4:22:38 PM ******/
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON

CREATE TABLE [dbo].[SurveyEOption](
	[AID] [int] IDENTITY(1,1) NOT NULL,
	[QID] [int] NOT NULL,
	[OptionA] [nvarchar](500) NULL,
	[OptionB] [nvarchar](500) NULL,
	[OptionC] [nvarchar](500) NULL,
	[OptionD] [nvarchar](500) NULL,
	[OptionE] [nvarchar](500) NULL,
	[Other] [bit] NOT NULL,
	[Auth_User] [nvarchar](255) NULL,
	[SID] [int] NULL
) ON [PRIMARY]
/****** Object:  Table [dbo].[SurveyEQuestion]    Script Date: 3/8/2022 4:23:41 PM ******/
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON

CREATE TABLE [dbo].[SurveyEQuestion](
	[QID] [int] IDENTITY(1,1) NOT NULL,
	[QRef] [nvarchar](255) NULL,
	[Question] [nvarchar](255) NULL,
	[Qorder] [int] NULL,
	[Active] [bit] NOT NULL,
	[Type] [nvarchar](50) NULL,
	[QLabel] [nvarchar](255) NULL,
	[SID] [int] NULL,
	[Auth_User] [nvarchar](255) NULL
) ON [PRIMARY]
ALTER TABLE [dbo].[SurveyEQuestion] ADD  CONSTRAINT [DF_SurveyEQuestion_Active]  DEFAULT ((1)) FOR [Active]
/****** Object:  Table [dbo].[SurveyEScalar]    Script Date: 3/8/2022 4:24:04 PM ******/
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON

CREATE TABLE [dbo].[SurveyEScalar](
	[AID] [int] IDENTITY(1,1) NOT NULL,
	[QID] [int] NULL,
	[LeftLabel] [nvarchar](50) NULL,
	[RightLabel] [nvarchar](50) NULL,
	[Range] [smallint] NULL,
	[NA] [bit] NOT NULL,
	[Auth_User] [nvarchar](255) NULL,
	[SID] [int] NULL
) ON [PRIMARY]
ALTER TABLE [dbo].[SurveyEScalar] ADD  CONSTRAINT [DF_SurveyEScalar_NA]  DEFAULT ((0)) FOR [NA]

/****** Object:  Table [dbo].[SurveyEText]    Script Date: 3/8/2022 4:24:32 PM ******/
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON

CREATE TABLE [dbo].[SurveyEText](
	[AID] [int] IDENTITY(1,1) NOT NULL,
	[QID] [int] NULL,
	[Rows] [smallint] NULL,
	[Cols] [smallint] NULL,
	[Auth_User] [nvarchar](255) NULL,
	[SID] [int] NULL
) ON [PRIMARY]
/****** Object:  Table [dbo].[SurveyPGrid]    Script Date: 3/8/2022 4:24:58 PM ******/
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON

CREATE TABLE [dbo].[SurveyPGrid](
	[AID] [int] IDENTITY(1,1) NOT NULL,
	[QID] [int] NULL,
	[KPI] [nvarchar](125) NULL,
	[Description] [nvarchar](1024) NULL,
	[HowMeasured] [nvarchar](1024) NULL,
	[Weight] [smallint] NULL,
	[1Guide] [nvarchar](1024) NULL,
	[2Guide] [nvarchar](1024) NULL,
	[3Guide] [nvarchar](1024) NULL,
	[4Guide] [nvarchar](1024) NULL,
	[5Guide] [nvarchar](1024) NULL,
	[SID] [int] NULL,
	[PlaceHolderText] [nvarchar](1024) NULL,
	[Readonly] [bit] NULL
) ON [PRIMARY]
ALTER TABLE [dbo].[SurveyPGrid] ADD  CONSTRAINT [DF_SurveyPGrid_Readonly]  DEFAULT ((0)) FOR [Readonly]
/****** Object:  Table [dbo].[SurveyPOption]    Script Date: 3/8/2022 4:25:21 PM ******/
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON

CREATE TABLE [dbo].[SurveyPOption](
	[AID] [int] NOT NULL,
	[QID] [int] NOT NULL,
	[OptionA] [nvarchar](500) NULL,
	[OptionB] [nvarchar](500) NULL,
	[OptionC] [nvarchar](500) NULL,
	[OptionD] [nvarchar](500) NULL,
	[OptionE] [nvarchar](500) NULL,
	[Other] [bit] NOT NULL,
	[SID] [int] NULL
) ON [PRIMARY]
/****** Object:  Table [dbo].[SurveyPQuestion]    Script Date: 3/8/2022 4:25:43 PM ******/
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON

CREATE TABLE [dbo].[SurveyPQuestion](
	[QID] [int] NOT NULL,
	[QRef] [nvarchar](255) NULL,
	[Question] [nvarchar](255) NULL,
	[Qorder] [int] NULL,
	[Active] [bit] NOT NULL,
	[Type] [nvarchar](50) NULL,
	[QLabel] [nvarchar](255) NULL,
	[SID] [int] NULL
) ON [PRIMARY]
/****** Object:  Table [dbo].[SurveyPScalar]    Script Date: 3/8/2022 4:26:10 PM ******/
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON

CREATE TABLE [dbo].[SurveyPScalar](
	[AID] [int] NOT NULL,
	[QID] [int] NULL,
	[LeftLabel] [nvarchar](50) NULL,
	[RightLabel] [nvarchar](50) NULL,
	[Range] [smallint] NULL,
	[NA] [bit] NOT NULL,
	[SID] [int] NULL
) ON [PRIMARY]
/****** Object:  Table [dbo].[SurveyPText]    Script Date: 3/8/2022 4:26:49 PM ******/
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON

CREATE TABLE [dbo].[SurveyPText](
	[AID] [int] NOT NULL,
	[QID] [int] NULL,
	[Rows] [smallint] NULL,
	[Cols] [smallint] NULL,
	[SID] [int] NULL
) ON [PRIMARY]
/****** Object:  Table [dbo].[SurveyResponse]    Script Date: 3/8/2022 4:27:07 PM ******/
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON

CREATE TABLE [dbo].[SurveyResponse](
	[RID] [int] IDENTITY(1,1) NOT NULL,
	[USER_AUTH] [nvarchar](255) NULL,
	[Date] [date] NOT NULL,
	[DateTime] [datetime] NOT NULL,
	[AssetID] [nvarchar](255) NULL,
	[BArea] [nvarchar](255) NULL,
	[ChannelID] [int] NULL,
	[SID] [int] NULL
) ON [PRIMARY]
ALTER TABLE [dbo].[SurveyResponse] ADD  CONSTRAINT [DF_SurveyResponse_Date]  DEFAULT (getdate()) FOR [Date]
ALTER TABLE [dbo].[SurveyResponse] ADD  CONSTRAINT [DF_SurveyResponse_DateTime]  DEFAULT (getdate()) FOR [DateTime]
/****** Object:  Table [dbo].[SurveyResponseAnswers]    Script Date: 3/8/2022 4:27:23 PM ******/
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
CREATE TABLE [dbo].[SurveyResponseAnswers](
	[RAID] [int] IDENTITY(1,1) NOT NULL,
	[RID] [int] NOT NULL,
	[QID] [int] NULL,
	[Value] [nvarchar](3000) NULL,
	[Other] [nvarchar](500) NULL
) ON [PRIMARY]

END

GO

 

CREATE PROCEDURE [dbo].[Apps-AutoAppsGroupMapping]

-- Add the parameters for the stored procedure here

AS

BEGIN

-- SET NOCOUNT ON added to prevent extra result sets from

-- interfering with SELECT statements.

SET NOCOUNT ON;

 

--Insert into AppAutoGroupMapping to track what records have been auto-mapped

 

MERGE INTO [ARM_CORE]..[appAutoGroupMapping] Target

USING (

       select  x.ApplicationID, g.AutoMappingPattern, g.CurrentApplication,g.AppGroupID,g.AppGroupName

       from ARM_CORE..AppGroup g

       left join (

             select distinct i.ApplicationID, a.AppGroupID

             from ARM_CORE..AppAstAsIs i

             left join ARM_CORE..[application] a on a.ApplicationID = i.ApplicationID

             where a.AppGroupID is null

       ) x on x.ApplicationID like g.AutoMappingPattern

       where x.ApplicationID is not null

) Source ON Target.ApplicationID = Source.ApplicationID

WHEN NOT MATCHED THEN

       Insert (ApplicationID, AutoMappingPattern,CurrentApplication, AppGroupID, AppGroupName,CreateDate)

       Values (source.ApplicationID, source.AutoMappingPattern, source.CurrentApplication,source.AppGroupID,source.AppGroupName, getdate() );

 

--#####################################

--Insert into TransformAppMap so that the correct AppMap will be created.

 

MERGE INTO [ARM_CORE]..[TransformAppMap] Target

USING (

       select DUPE.* from (

             select  x.ApplicationID, g.CurrentApplication, 'Automatic' as heartbeat, row_number() OVER ( PARTITION BY x.applicationid ORDER BY g.CurrentApplication DESC ) AS nr 

             from ARM_CORE..AppGroup g

             left join (

                    select distinct i.ApplicationID,a.AppGroupID

                    from ARM_CORE..AppAstAsIs i

                    left join ARM_CORE..[application] a on a.ApplicationID = i.ApplicationID

                    where a.AppGroupID is null

             ) x on x.ApplicationID like g.AutoMappingPattern

             where x.ApplicationID is not null and ISNULL(g.CurrentApplication,'') <> ''

       ) as DUPE where nr = 1

) Source ON target.[As Is] = Source.Applicationid

WHEN Not MATCHED THEN

  insert ([As Is],[To Be],[Status])

  Values (source.ApplicationID, source.CurrentApplication, source.heartbeat);

 

--Insert Application Record

 

MERGE INTO ARM_CORE..[Application] Target

USING (

       select DUPE.* from (

             select  distinct x.ApplicationID, g.AppGroupID,

                    left(t.AppName,249) as [Name],

                    left(t.AppVersion,49) as [Version],

                    'M' as [DeployType],0 as [Ready],0 as [Publish],

                    row_number() OVER ( PARTITION BY x.applicationid ORDER BY g.AppGroupID DESC ) AS nr

             from ARM_CORE..AppGroup g

             left join (

                    select distinct i.ApplicationID, a.AppGroupID

                    from ARM_CORE..AppAstAsIs i

                    left join ARM_CORE..[application] a on a.ApplicationID = i.ApplicationID

                    where a.AppGroupID is null

             ) x on x.ApplicationID like g.AutoMappingPattern

             LEFT JOIN ARM_CORE..AppAsIs t on t.ApplicationID = x.ApplicationID

             where x.ApplicationID is not null

       ) as DUPE where nr = 1

) Source ON target.ApplicationID = Source.Applicationid

WHEN Not MATCHED THEN

  insert ([ApplicationID],[AppGroupID],[Name],[Version],[DeployType],[Ready],[Publish])

  Values (source.[ApplicationID], source.AppGroupID, source.[Name],source.[Version], source.[DeployType] ,source.[Ready],source.[Publish]);

 

 

--Look for any Applications that are not currently mapped to a verion, but where the version is listed in the AppGroup

Insert into ARM_CORE..TransformAppMap([As Is],[To Be],[Status])

select a.ApplicationID, g.CurrentApplication, 'Automatic'

from ARM_CORE..[Application] a

left join ARM_CORE..TransformAppMap m on m.[As Is]= a.ApplicationID

left join ARM_CORE..AppGroup g on g.AppGroupID = a.AppGroupID

where isnull(m.[As Is],'')='' and  isnull(g.CurrentApplication,'') <> ''

 

END
GO

-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[WS-KeyStatus]
	@WID int = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;



	
--	f.FileID, f.[Folder], f.[Name] as FileName, f.FilePath, (select top 1 IsNull(m.MenuID,0) from [ARM_CORE]..[A_Menu] m where m.URL like f.FilePath+'%') as MenuID, r.Name, 1 as Permit



	Select distinct w.[Name] as WorkstreamName, i.ItemID, c.[name] INTO #tempPivotWCTable
	from  [ARM_CORE]..[Workstream] w left JOIN [ARM_CORE]..[A_Collection] c on c.[CollectionClassID] = w.[KeyStatusID]
	LEFT JOIN [ARM_CORE]..[A_CollectionItem] i on c.[CollectionID] = i.[CollectionID]
	where w.WorkstreamID = @WID


	DECLARE @Columns VARCHAR(MAX)

	SELECT @columns = STUFF(( SELECT TOP 100 PERCENT
									'],[' + cast(c.Name as varchar)
							FROM [ARM_CORE]..[Workstream] w left JOIN [ARM_CORE]..[A_Collection] c on c.[CollectionClassID] = w.[KeyStatusID] 	where w.WorkstreamID = @WID order by c.[Order] 
							,'],[' + cast(c.Name as varchar)
							FOR XML PATH('')
						  ), 1, 2, '') + ']'


	DECLARE @query VARCHAR(8000)

	SET @query = '
	SELECT *
	FROM #tempPivotWCTable
	PIVOT
	(
	Count(ItemID)
	FOR [Name]
	IN (' + @columns + ')
	)
	AS p '


	EXECUTE(@query)


	DROP TABLE #tempPivotWCTable
END




GO
-- =============================================
-- Author:             <Author,,Name>
-- Create date: <Create Date,,>
-- Description:        <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Venn-GetSetData2]
@VennID int = 0
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
    SET NOCOUNT ON;

	Declare @cnt int
	Declare @Sets nvarchar(1000) = '[';

	DECLARE @VennRingID_1 int
	DECLARE @VennRingID_2 int

	DECLARE @VennRingID_1_label nvarchar(500)
	DECLARE @VennRingID_2_label nvarchar(500)

	Declare @AID int
	Declare @BID int
	Declare @CID int

	DECLARE @SQL_A nvarchar(max)
	DECLARE @SQL_B nvarchar(max)
	DECLARE @SQL_C nvarchar(max)

	Declare @JoinValue int


	Declare @X int = 0
	Declare @Y int = 0
	Declare @RingCount int = 0

	select @RingCount = Count(r.VennRingID) from [ARM_CORE]..[VennRing] r where r.VennID = @VennID 
	 
	DECLARE VennRings SCROLL CURSOR FOR 
		select r.VennRingID, IsNull(r.CollectionID,0) as CollectionID, 
			case when IsNull(r.Label,'') = '' then (select IsNull(c.Name,'') from [ARM_CORE]..[A_Collection] c where c.CollectionID = r.CollectionID)
				else r.Label 
			end as Label,
			IsNull(r.vSQL,'') as [vSQL]
		from [ARM_CORE]..[VennRing] r where r.VennID = @VennID order by VennRingID

	OPEN VennRings 
    
	FETCH NEXT FROM VennRings INTO @VennRingID_1, @AID, @VennRingID_1_Label, @SQL_A


	set @X = 0
	WHILE @@FETCH_STATUS = 0  
	BEGIN 
		
			set @Sets = @Sets + ''

			DECLARE VennRingIter CURSOR FOR 
				select r.VennRingID, IsNull(r.CollectionID,0) as CollectionID, 
					case when IsNull(r.Label,'') = '' then (select IsNull(c.Name,'') from [ARM_CORE]..[A_Collection] c where c.CollectionID = r.CollectionID)
						else r.Label 
					end as Label,
					IsNull(r.vSQL,'') as [vSQL]
				from [ARM_CORE]..[VennRing] r where r.VennID = @VennID and r.VennRingID >= @VennRingID_1 order by VennRingID

			OPEN VennRingIter  
   
    
			FETCH NEXT FROM VennRingIter INTO @VennRingID_2, @BID, @VennRingID_2_Label, @SQL_B

			set @Y = @X
			WHILE @@FETCH_STATUS = 0  
			BEGIN 
				if @VennRingID_1 = @VennRingID_2 
				BEGIN

					IF @AID <> 0  set @SQL_A = 'select distinct ItemID from [ARM_CORE]..[A_CollectionItem] where CollectionID = ' + convert(nvarchar(16),@AID)

					EXEC [Venn-GetCount]  @JoinValue output, @SQL_A

--					select @JoinValue = Count(ItemID) from [ARM_CORE]..[A_CollectionItem] where CollectionID = @AID

					set @Sets = @Sets + '{sets:[' + cast(@X as nvarchar(20)) + '], label: "' + @VennRingID_1_Label + '", size: ' + cast(@JoinValue as nvarchar(20)) + '},'
				END
				ELSE
				BEGIN
--					select @JoinValue = Count(distinct A.ItemID) from ARM_CORE..A_CollectionItem A 
--					INNER JOIN ARM_CORE..A_CollectionItem B on A.ItemID = B.ItemID 
--					where A.CollectionID = @AID and B.CollectionID = @BID 

					IF @BID <> 0  set @SQL_B = 'select distinct ItemID from [ARM_CORE]..[A_CollectionItem] where CollectionID = ' + convert(nvarchar(16),@BID)

					EXEC [Venn-GetCount]  @JoinValue output, @SQL_A, @SQL_B

					set @Sets = @Sets + '{sets:[' + cast(@X as nvarchar(20)) + ',' + cast(@Y as nvarchar(20)) + '], size: ' + cast(@JoinValue as nvarchar(20)) + '},'
				END
				
				if @X = 0 and @Y = 1 
				BEGIN
					set @CID = @BID
					set @SQL_C = @SQL_B
				END

				if (@X = 0 and @Y = 2)
				BEGIN
--					select @JoinValue = Count(distinct C.ItemID) from ARM_CORE..A_CollectionItem C 
--					INNER JOIN (
--						SELECT distinct A.ItemID from ARM_CORE..A_CollectionItem A 
--						INNER JOIN ARM_CORE..A_CollectionItem B on A.ItemID = B.ItemID 
--						where A.CollectionID = @AID and B.CollectionID = @BID 
--					) Z on C.ItemID = Z.ItemID where C.CollectionID = @CID

					EXEC [Venn-GetCount]  @JoinValue output, @SQL_A, @SQL_C, @SQL_B

					set @Sets = @Sets + '{sets:[' + cast(@X as nvarchar(20)) + ',1,' + cast(@Y as nvarchar(20)) + '], size: ' + cast(@JoinValue as nvarchar(20)) + '},'

				END


				FETCH NEXT FROM VennRingIter INTO @VennRingID_2, @BID, @VennRingID_2_Label, @SQL_B
				set @Y = @Y + 1


			END

			CLOSE VennRingIter  
			DEALLOCATE VennRingIter 

			FETCH NEXT FROM VennRings INTO @VennRingID_1, @AID, @VennRingID_1_Label, @SQL_A
			set @X = @X + 1
		
	END 



	set @Sets = @Sets + ']'

	CLOSE VennRings  
	DEALLOCATE VennRings 

		

	select @RingCount as [Rings], @Sets as [Data]
END

GO
-- =============================================
-- Author:             <Author,,Name>
-- Create date: <Create Date,,>
-- Description:        <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Venn-GetSetData]
@VennID int = 0
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
    SET NOCOUNT ON;

	Declare @cnt int
	Declare @Sets nvarchar(1000) = '[';

	DECLARE @VennRingID_1 int
	DECLARE @VennRingID_2 int

	DECLARE @VennRingID_1_label nvarchar(500)
	DECLARE @VennRingID_2_label nvarchar(500)

	Declare @AID int
	Declare @BID int
	Declare @CID int

	DECLARE @SQL_A nvarchar(max)
	DECLARE @SQL_B nvarchar(max)
	DECLARE @SQL_C nvarchar(max)

	Declare @JoinValue int


	Declare @X int = 0
	Declare @Y int = 0
	Declare @RingCount int = 0

	select @RingCount = Count(r.VennRingID) from [ARM_CORE]..[VennRing] r where r.VennID = @VennID 
	 
	DECLARE VennRings SCROLL CURSOR FOR 
		select r.VennRingID, IsNull(r.CollectionID,0) as CollectionID, 
			IsNull(case when IsNull(r.Label,'') = '' then (select IsNull(c.Name,'') from [ARM_CORE]..[A_Collection] c where c.CollectionID = r.CollectionID)
				else IsNull(r.Label,'')
			end,'') as Label,
			IsNull(r.vSQL,'') as [vSQL]
		from [ARM_CORE]..[VennRing] r where r.VennID = @VennID and r.Active = 1 order by VennRingID

	OPEN VennRings 
    
	FETCH NEXT FROM VennRings INTO @VennRingID_1, @AID, @VennRingID_1_Label, @SQL_A


	set @X = 0
	WHILE @@FETCH_STATUS = 0  
	BEGIN 
		
			set @Sets = @Sets + ''

			DECLARE VennRingIter CURSOR FOR 
				select r.VennRingID, IsNull(r.CollectionID,0) as CollectionID, 
					IsNull(case when IsNull(r.Label,'') = '' then (select IsNull(c.Name,'') from [ARM_CORE]..[A_Collection] c where c.CollectionID = r.CollectionID)
						else IsNull(r.Label,'')
					end,'') as Label,
					IsNull(r.vSQL,'') as [vSQL]
				from [ARM_CORE]..[VennRing] r where r.VennID = @VennID and r.Active = 1 and r.VennRingID >= @VennRingID_1 order by VennRingID

			OPEN VennRingIter  
   
    
			FETCH NEXT FROM VennRingIter INTO @VennRingID_2, @BID, @VennRingID_2_Label, @SQL_B

			set @Y = @X
			WHILE @@FETCH_STATUS = 0  
			BEGIN 
				if @VennRingID_1 = @VennRingID_2 
				BEGIN

					IF @AID <> 0  set @SQL_A = 'select distinct ItemID from [ARM_CORE]..[A_CollectionItem] where CollectionID = ' + convert(nvarchar(16),@AID)

					EXEC [Venn-GetCount]  @JoinValue output, @SQL_A

--					select @JoinValue = Count(ItemID) from [ARM_CORE]..[A_CollectionItem] where CollectionID = @AID

					set @Sets = @Sets + '{sets:[' + cast(@X as nvarchar(20)) + '], label: "' + @VennRingID_1_Label + '", size: ' + cast(@JoinValue as nvarchar(20)) + '},'
				END
				ELSE
				BEGIN
--					select @JoinValue = Count(distinct A.ItemID) from ARM_CORE..A_CollectionItem A 
--					INNER JOIN ARM_CORE..A_CollectionItem B on A.ItemID = B.ItemID 
--					where A.CollectionID = @AID and B.CollectionID = @BID 

					IF @BID <> 0  set @SQL_B = 'select distinct ItemID from [ARM_CORE]..[A_CollectionItem] where CollectionID = ' + convert(nvarchar(16),@BID)

					EXEC [Venn-GetCount]  @JoinValue output, @SQL_A, @SQL_B

					set @Sets = @Sets + '{sets:[' + cast(@X as nvarchar(20)) + ',' + cast(@Y as nvarchar(20)) + '], size: ' + cast(@JoinValue as nvarchar(20)) + '},'
				END
				
				if @X = 0 and @Y = 1 
				BEGIN
					set @CID = @BID
					set @SQL_C = @SQL_B
				END

				if (@X = 0 and @Y = 2)
				BEGIN
--					select @JoinValue = Count(distinct C.ItemID) from ARM_CORE..A_CollectionItem C 
--					INNER JOIN (
--						SELECT distinct A.ItemID from ARM_CORE..A_CollectionItem A 
--						INNER JOIN ARM_CORE..A_CollectionItem B on A.ItemID = B.ItemID 
--						where A.CollectionID = @AID and B.CollectionID = @BID 
--					) Z on C.ItemID = Z.ItemID where C.CollectionID = @CID

					EXEC [Venn-GetCount]  @JoinValue output, @SQL_A, @SQL_C, @SQL_B

					set @Sets = @Sets + '{sets:[' + cast(@X as nvarchar(20)) + ',1,' + cast(@Y as nvarchar(20)) + '], size: ' + cast(@JoinValue as nvarchar(20)) + '},'

				END


				FETCH NEXT FROM VennRingIter INTO @VennRingID_2, @BID, @VennRingID_2_Label, @SQL_B
				set @Y = @Y + 1


			END

			CLOSE VennRingIter  
			DEALLOCATE VennRingIter 

			FETCH NEXT FROM VennRings INTO @VennRingID_1, @AID, @VennRingID_1_Label, @SQL_A
			set @X = @X + 1
		
	END 



	set @Sets = @Sets + ']'

	CLOSE VennRings  
	DEALLOCATE VennRings 

		

	select @RingCount as [Rings], @Sets as [Data]
END

GO
-- =============================================
-- Author:             <Author,,Name>
-- Create date: <Create Date,,>
-- Description:        <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Venn-GetCount]
@VennCount int = 0 output,
@SQL1 nvarchar(max) = '',
@SQL2 nvarchar(max) = '',
@SQL3 nvarchar(max) = ''
AS
BEGIN

	DECLARE @query nvarchar(max)

	IF @SQL1 = '' set @query = 'select @VennCount = 0';

	IF @SQL1 <> '' and @SQL2 = '' set @query = 'select @VennCount = Count(A.ItemID) from ( ' + @SQL1 + ') A';

	IF @SQL1 <> '' and @SQL2 <> '' and @SQL3 = '' 
		set @query = 'select @VennCount = Count(Z.ItemID) 
		from (
			select  A.ItemID from (
				' + @SQL1 + '
			) A
			INNER JOIN (
				' + @SQL2 + '
			) B on A.ItemID = B.ItemID
		) Z '

	IF @SQL1 <> '' and @SQL2 <> '' and @SQL3 <> '' 
		set @query = 'select @VennCount = Count(X.ItemID) 
		from ( 	
			select distinct Z.ItemID from (
				select  A.ItemID from (
					' + @SQL1 + '
				) A
				INNER JOIN (
					' + @SQL2 + '
				) B on A.ItemID = B.ItemID
			) Z 
			INNER JOIN (
				' + @SQL3 + '
			) C on Z.ItemID = C.ItemID
		) X '

	EXEC sp_executesql
		@query,
		N'@VennCount int output',
		@VennCount output
END

GO
create procedure [dbo].[usp_find_string](@string as varchar(1000))
as
begin
declare @mincounter as int
declare @maxcounter as int
declare @stmtquery as varchar(1000)
set @stmtquery=''
create table #tmp(tablename varchar(128),columnname varchar(128),rowid int identity)
create table #tablelist(tablename varchar(128),columnname varchar(128))
declare @tmp table(name varchar(128))
declare @tablename as varchar(128)
declare @columnname as varchar(128)
insert into #tmp(tablename,columnname)
select a.name,b.name as columnname from sysobjects a
inner join syscolumns b on a.name=object_name(b.id)
where a.type='u'
and b.xtype in(select xtype from systypes
where name='text' or name='ntext' or name='varchar' or name='nvarchar' or name='char' or name='nchar')
order by a.name
select @maxcounter=max(rowid),@mincounter=min(rowid) from #tmp
while(@mincounter <= @maxcounter )
begin
select @tablename=tablename, @columnname=columnname from #tmp where rowid=@mincounter
set @stmtquery ='select top 1 ' + '[' +@columnname+']' + ' from ' + '['+@tablename+']' + ' where ' + '['+@columnname+']' + ' like ' + '''%' + @string + '%'''
insert into @tmp(name) exec(@stmtquery)
if @@rowcount >0
insert into #tablelist values(@tablename,@columnname)
set @mincounter=@mincounter +1
end
select * from #tablelist
end

GO
-- =============================================
-- Author:		<Andy Bex>
-- alter date: <17/2/16>
-- Description:	<Transform for the User table>
-- =============================================
CREATE PROCEDURE [dbo].[UserTransform] 

AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;


-- PreReqs for this procedure are
--		TMP_RAW_User

-- Steps
--		1. Empty User table
--		2. Insert data from RAW
--		3. Set Live if Less than 30 days
--		4. Merge data from FixedRecord
--		5. Apply Updates
--		6. Apply Overrides

--		1. Empty User table

		delete from [User];

--		2. Insert data from RAW
	
		SET DATEFORMAT DMY
		INSERT INTO [User] (UserID, UserName,Department,BusinessUnit, Location,Telephone,Email,Mobile)
		SELECT R.UserID, R.UserName, R.Department,r.Custom01, r.Location, R.Telephone, R.email, r.Mobile
		FROM TMP_RAW_User R

--		3. Set Live
		UPDATE [User] SET [user].Live = 1 WHERE [user].Heartbeat > getdate() -30
	
----		3. Merge data from FixedRecord
		MERGE [User] as Target
		using (select TransformFixedRecord.[Table], TransformFixedRecord.RecordID from TransformFixedRecord where TransformFixedRecord.[Table] = 'User') as Source
		on (target.userid = source.RecordID)
		WHEN NOT MATCHED BY TARGET THEN
		insert (UserID)
		Values (Source.RecordID);

----		4. Apply Updates
		DECLARE @tSOURCE nvarchar(max);
		DECLARE @tTARGET nvarchar(max);
		DECLARE @tASIS nvarchar(max);
		DECLARE @tTOBE nvarchar(max);

		DECLARE Update_Cursor CURSOR FOR
		SELECT TransformUpdate.SourceColumn, TransformUpdate.TargetColumn, TransformUpdate.AsIs, TransformUpdate.ToBe FROM TransformUpdate 
		WHERE TransformUpdate.[Table] = 'User';

		OPEN Update_Cursor;

		FETCH NEXT FROM Update_Cursor INTO @tSOURCE, @tTARGET, @tASIS, @tTOBE;

		WHILE @@FETCH_STATUS = 0
			BEGIN
				EXECUTE ('UPDATE [User] SET [' + @tTARGET + '] = ''' + @tTOBE + ''' WHERE [' + @tSOURCE + '] = ''' + @tASIS + '''');
				FETCH NEXT FROM Update_Cursor INTO @tSOURCE, @tTARGET, @tASIS, @tTOBE;
			END;
		CLOSE Update_Cursor;
		DEALLOCATE Update_Cursor;

----		5. Apply Overrides

		DECLARE @tRecordID nvarchar(max);
		DECLARE @tColumn nvarchar(max);
		DECLARE @tValue nvarchar(max);
		
		DECLARE Override_Cursor CURSOR FOR
		SELECT TransformOverride.RecordID,TransformOverride.[Column], TransformOverride.Value from TransformOverride
		WHERE TransformOverride.[Table] = 'User';

		OPEN Override_Cursor;

		FETCH NEXT FROM Override_Cursor INTO @tRecordID, @tColumn, @tValue;

		WHILE @@FETCH_STATUS = 0
			BEGIN
				EXECUTE ('UPDATE [User] SET [' + @tColumn + '] = ''' + @tValue + ''' WHERE UserID = ''' + @tRecordID + '''');
				FETCH NEXT FROM Override_Cursor INTO @tRecordID, @tColumn, @tValue;
			END;
		CLOSE Override_Cursor;
		DEALLOCATE Override_Cursor;
END








GO
CREATE PROCEDURE [dbo].[User-Pivot]
@OrderBy as nvarchar(255) = 'LastAccess] Desc, [UserID'
AS
BEGIN
       -- SET NOCOUNT ON added to prevent extra result sets from
       -- interfering with SELECT statements.
       SET NOCOUNT ON;


       SELECT distinct r.Name, u.Name as [User Name], u.UserID, u.Auth_User as [USER ID], u.LastAccessDT as LastAccess, u.Email, cast(1 as int) as Permit 
       INTO #tempPivotTable
       from [ARM_CORE]..[A_User] u
       LEFT JOIN [ARM_CORE]..[A_Role] r on r.RoleID = u.RoleID 
       where IsNull(u.Granted,0) = 1



       DECLARE @Columns VARCHAR(MAX)

       SELECT @columns = STUFF(( SELECT TOP 100 PERCENT
                                                            '],[' + cast(Name as varchar)
                                               FROM    [ARM_CORE]..[A_Role] AS t2
                                               ORDER BY Rank,'],[' + cast(Name as varchar)
                                               FOR XML PATH('')
                                          ), 1, 2, '') + ']'


       DECLARE @query VARCHAR(8000)

       SET @query = '
       SELECT *
       FROM #tempPivotTable
       PIVOT
       (
       Count(Permit)
       FOR [Name]
       IN (' + @columns + ')
       )
       AS p order by [' + @OrderBy + ']'


       EXECUTE(@query)


       DROP TABLE #tempPivotTable
END


GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[UserID-Apps-PIVOT-ByRun]
@runID int = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;


	select distinct c.userID, s.ApplicationID, Count(r.AssetID) as Installs
	into #tempPivotTable2
		from [ARM_CORE]..[ScheduleDeployRunAsset] r 
		Left Join [ARM_CORE]..[AppAstToBe] s on s.AssetID = r.AssetID  
		Left Join [ARM_CORE]..[Application] w on w.[ApplicationID] = s.ApplicationID 
		Left Join [ARM_CORE]..[Asset] c on c.AssetID = r.AssetID 
		where r.RunID = @runID and (w.[DeployType] like 'P%' ) group By c.userID, s.ApplicationID



	DECLARE @Columns VARCHAR(MAX)

	SELECT @columns = STUFF(( SELECT DISTINCT TOP 100 PERCENT
									'],[' + cast(ApplicationID as nvarchar(255))
							FROM    #tempPivotTable2 AS t2
							ORDER BY '],[' + cast(ApplicationID as nvarchar(255))
							FOR XML PATH('')
						  ), 1, 2, '') + ']'

	DECLARE @query VARCHAR(8000)

	SET @query = '
	SELECT *
	FROM #tempPivotTable2
	PIVOT
	(
	SUM(Installs)
	FOR [ApplicationID]
	IN (' + @columns + ')
	)
	AS p '


	EXECUTE(@query)



	DROP TABLE #tempPivotTable2

END




GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[UserID-Apps-PIVOT]
@slotID nvarchar(255) = ''
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;



	select distinct c.userID, s.ApplicationID, Count(r.AssetID) as Installs
	INTO #tempPivotTable
	 from [ARM_CORE]..[ScheduleDeployRunAsset] r 
	 Left Join [ARM_CORE]..[AppAstToBe] s on s.AssetID = r.AssetID  
	 Left Join [ARM_CORE]..[Application] w on w.[ApplicationID] = s.ApplicationID 
	 Left Join [ARM_CORE]..[Asset] c on c.AssetID = r.AssetID 
	 where r.RunID in (select g.RunID from [ARM_CORE]..[ScheduleDeployRun] g where g.SlotID in (@slotID)) and (w.[DeployType] like 'P%' ) group By c.userID, s.ApplicationID



	DECLARE @Columns VARCHAR(MAX)

	SELECT @columns = STUFF(( SELECT DISTINCT TOP 100 PERCENT
									'],[' + cast(ApplicationID as varchar)
							FROM    #tempPivotTable AS t2
							ORDER BY '],[' + cast(ApplicationID as varchar)
							FOR XML PATH('')
						  ), 1, 2, '') + ']'

	DECLARE @query VARCHAR(8000)

	SET @query = '
	SELECT *
	FROM #tempPivotTable
	PIVOT
	(
	SUM(Installs)
	FOR [ApplicationID]
	IN (' + @columns + ')
	)
	AS p '


	EXECUTE(@query)



	DROP TABLE #tempPivotTable

END




GO

CREATE PROCEDURE [dbo].[TRIGGER-new-Workstream]
	@WorkstreamID int = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

DECLARE @CCID INT;

DECLARE @TARGET_ID INT;
DECLARE @CONFIRM_ID INT;
DECLARE @SCHED_ID INT;
DECLARE @DEPLOYED_ID INT;
DECLARE @DEF_ID INT;


-- Create Collection Class for System supported Workstream Status.


DECLARE @CCName nvarchar(1000);


select @CCName = IsNull([name],'Status for Workstream') from [ARM_CORE]..[Workstream] where WorkstreamID = @WorkstreamID

insert into [ARM_CORE]..[A_CollectionClass] ([Name],[Description],[Distinct],[Status],[WorkstreamID]) values (@CCName,'',1,1,@WorkstreamID)
Set @CCID = SCOPE_IDENTITY();


-- Create System supported Workstream Status.

insert into [ARM_CORE]..[A_Collection] ([Name],[Order],[Type],[Marker],[CollectionClassID],[Locked]) values ('Targetted',5,'Asset',0,@CCID,1)
Set @TARGET_ID = SCOPE_IDENTITY();
insert into [ARM_CORE]..[A_Collection] ([Name],[Order],[Type],[Marker],[CollectionClassID],[Locked]) values ('Confirmed',10,'Asset',0,@CCID,1)
Set @CONFIRM_ID = SCOPE_IDENTITY();
insert into [ARM_CORE]..[A_Collection] ([Name],[Order],[Type],[Marker],[CollectionClassID],[Locked]) values ('Scheduled',20,'Asset',0,@CCID,1)
Set @SCHED_ID = SCOPE_IDENTITY();
insert into [ARM_CORE]..[A_Collection] ([Name],[Order],[Type],[Marker],[CollectionClassID],[Locked]) values ('Deployed',30,'Asset',0,@CCID,1)
Set @DEPLOYED_ID = SCOPE_IDENTITY();
insert into [ARM_CORE]..[A_Collection] ([Name],[Order],[Type],[Marker],[CollectionClassID],[Locked]) values ('Deferred',50,'Asset',0,@CCID,1)
Set @DEF_ID = SCOPE_IDENTITY();

-- Update Workstream .

insert [ARM_CORE]..[A_SlotStatusDefinition] ( [Label] ,[MapToCollectionID] ,[Deployed] ,[Failed] ,[RemoveFromSlot] ,[SQLTrigger] ,[WorkstreamID] ,[Order] ) values ( 'Delete - No Change' , 0 , 0 , 0 , 1 , NULL , @WorkstreamID , 700)
insert [ARM_CORE]..[A_SlotStatusDefinition] ( [Label] ,[MapToCollectionID] ,[Deployed] ,[Failed] ,[RemoveFromSlot] ,[SQLTrigger] ,[WorkstreamID] ,[Order] ) values ( 'Delete - Move to Confirmed' , @CONFIRM_ID , 0 , 0 , 1 , NULL , @WorkstreamID , 800)
insert [ARM_CORE]..[A_SlotStatusDefinition] ( [Label] ,[MapToCollectionID] ,[Deployed] ,[Failed] ,[RemoveFromSlot] ,[SQLTrigger] ,[WorkstreamID] ,[Order] ) values ( 'Deployed' , @DEPLOYED_ID , 1 , 0 , 0 , NULL , @WorkstreamID , 300)
insert [ARM_CORE]..[A_SlotStatusDefinition] ( [Label] ,[MapToCollectionID] ,[Deployed] ,[Failed] ,[RemoveFromSlot] ,[SQLTrigger] ,[WorkstreamID] ,[Order] ) values ( 'No Show' , @CONFIRM_ID , 0 , 1 , 0 , NULL , @WorkstreamID , 400)
insert [ARM_CORE]..[A_SlotStatusDefinition] ( [Label] ,[MapToCollectionID] ,[Deployed] ,[Failed] ,[RemoveFromSlot] ,[SQLTrigger] ,[WorkstreamID] ,[Order] ) values ( 'Cancelled' , @CONFIRM_ID , 0 , 0 , 0 , NULL , @WorkstreamID , 500)
insert [ARM_CORE]..[A_SlotStatusDefinition] ( [Label] ,[MapToCollectionID] ,[Deployed] ,[Failed] ,[RemoveFromSlot] ,[SQLTrigger] ,[WorkstreamID] ,[Order] ) values ( 'Failed' , 0 , 0 , 1 , 0 , NULL , @WorkstreamID , 600)
insert [ARM_CORE]..[A_SlotStatusDefinition] ( [Label] ,[MapToCollectionID] ,[Deployed] ,[Failed] ,[RemoveFromSlot] ,[SQLTrigger] ,[WorkstreamID] ,[Order] ) values ( 'In progress' , 0 , 0 , 0 , 0 , NULL , @WorkstreamID , 100)


Update [ARM_CORE]..[Workstream] set KeyStatusID = @CCID, TargettedID = @TARGET_ID, ConfirmedID = @CONFIRM_ID, ScheduledID = @SCHED_ID, DeployedID = @DEPLOYED_ID, DeferredID = @DEF_ID where WorkstreamID = @WorkstreamID

END

GO
CREATE PROCEDURE [dbo].[Trans-UserUpload]
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

--
-- PreReqs for this procedure are
--    TMP_RAW_Users
--
-- Tables Populated are
--    [Users]
--    [DNA$] .... ?
--    

	IF object_id('[TMP_RAW_Users]','U') is not null 
	BEGIN




		-- Take initial Upload and alter App Keys as AppID
		EXEC [SYS-SiteDown] 'Data upload in progress. This should only take a few minutes.'


			update [ARM_CORE]..[User] set Live = 0


			MERGE [ARM_CORE]..[User]  AS Target
			USING (SELECT distinct u.UserID, ''+u.[LastName]+', '+u.[FirstName] as Name, u.FirstName, Department, Country, Email, Manager, CountryCode FROM [TMP_RAW_Users] u where u.UserID <> '' and UserID <> 'Help4you' and UserID <> 'RiskOpsAmericas') AS Source
			ON (Target.UserID = Source.UserID)
			WHEN NOT MATCHED BY TARGET THEN
				INSERT (userID, FirstName, UserName, Department, Location, Email, Live, DirectManager, CountryCode)
				VALUES (Source.UserID, Source.FirstName, Source.Name, Source.Department, Source.Country, Source.Email, 1, Source.Manager, Source.CountryCode)
			WHEN MATCHED 
				THEN UPDATE SET Target.UserName = Source.Name, Target.FirstName = Source.FirstName, Target.Department=Source.Department, Target.Email=Source.Email, Target.Live=1, Target.DirectManager = Source.Manager, Target.heartbeat = getdate();


			MERGE [ARM_CORE]..[Asset]  AS Target
			USING (SELECT distinct u.UserID, ''+u.[LastName]+', '+u.[FirstName] as Name, u.FirstName, Department, Country, Email FROM [TMP_RAW_Users] u) AS Source
			ON (Target.UserID = Source.UserID  and Target.[Owner] = '[UNSPECIFIED]')
			WHEN MATCHED 
				THEN UPDATE SET Target.[Owner] = Source.Name, Target.Email=Source.Email;


--			WHEN NOT MATCHED BY SOURCE 
--				THEN DELETE 

-- set BusinessUnit if user history 

			Merge [ARM_CORE]..[User] as TARGET
			using (
				select p.UserID, t.AssetID, t.BArea, t.heartbeat, u.[BusinessUnit], row_number() OVER ( PARTITION BY p.UserID ORDER BY t.heartbeat DESC) AS rc from 
				(
					select distinct a.userID from [ARM_CORE]..[Asset] a
					LEFT JOIN [TMP_RAW_Users] u on u.UserID = a.userID and NOT u.UserID Is Null
					where a.[BArea] = 'United Kingdom' and a.Live = 1
				) as p
				LEFT JOIN [ARM_CORE]..[Asset] t on t.UserID = p.UserID 
				LEFT JOIN [ARM_CORE]..[User] u on u.[UserID] = t.[UserID]
				where t.BArea <> 'United Kingdom' and IsNull(t.BArea,'') <> '' and NOT t.BArea like '{%}'
			) as SOURCE
			ON TARGET.UserID = SOURCE.UserID and ISNULL(SOURCE.BArea,'') <> '' and IsNull(SOURCE.BusinessUnit,'') in ('','United Kingdom','UK') and SOURCE.rc = 1
			WHEN MATCHED 
				THEN UPDATE SET TARGET.[BusinessUnit] = [SOURCE].BArea;


		EXEC [SYS-SiteUp]


	END
END
GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Trans-RunTransforms] 
	@tID int = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	DECLARE @tCODE nvarchar(max);

	DECLARE @tTABLE nvarchar(max);
	DECLARE @tSOURCE nvarchar(max);
	DECLARE @tTARGET nvarchar(max);
	DECLARE @tASIS nvarchar(max);
	DECLARE @tTOBE nvarchar(max);


-- Run Initial Custom Action if defined 

	DECLARE Initial_Cursor CURSOR FOR
		SELECT t.[SQL]  FROM [Transform] t 
			WHERE t.TransformID = @tID 

	OPEN Initial_Cursor;

	FETCH NEXT FROM Initial_Cursor INTO @tCODE;

	WHILE @@FETCH_STATUS = 0
	   BEGIN
		  EXECUTE (@tCODE);
		  FETCH NEXT FROM Initial_Cursor INTO @tCODE;
	   END;
	CLOSE Initial_Cursor;
	DEALLOCATE Initial_Cursor;



-- Do All Transform Updates for supplied Transaction ID

	DECLARE Update_Cursor CURSOR FOR
		SELECT tu.[Table], tu.[SourceColumn], tu.[TargetColumn], tu.[AsIs], tu.[ToBe] 
		FROM [Transform] t INNER JOIN TransformUpdate tu ON t.TransformID = tu.TransformID 
		WHERE t.[TransformID] = @tID;
	
	OPEN Update_Cursor;

	FETCH NEXT FROM Update_Cursor INTO @tTABLE,@tSOURCE, @tTARGET, @tASIS, @tTOBE;

	WHILE @@FETCH_STATUS = 0
	   BEGIN
		  EXECUTE ('UPDATE ' + @tTABLE + ' SET [' + @tTARGET + '] = ''' + @tTOBE + ''' WHERE [' + @tSOURCE + '] = ''' + @tASIS + '''');

		  FETCH NEXT FROM Update_Cursor INTO @tTABLE,@tSOURCE, @tTARGET, @tASIS, @tTOBE;
	   END;
	CLOSE Update_Cursor;
	DEALLOCATE Update_Cursor;



-- Additional Transform Actions

	DECLARE Action_Cursor CURSOR FOR
		SELECT ta.Code FROM [Transform] t 
			INNER JOIN TransformAction ta ON t.TransformID = ta.TransformID 
			WHERE t.TransformID = @tID ORDER BY ta.[Order];

	OPEN Action_Cursor;

	FETCH NEXT FROM Action_Cursor INTO @tCODE;

	WHILE @@FETCH_STATUS = 0
	   BEGIN
		  EXECUTE (@tCODE);
		  FETCH NEXT FROM Action_Cursor INTO @tCODE;
	   END;
	CLOSE Action_Cursor;
	DEALLOCATE Action_Cursor;


	update [Transform] set [LastRun] = getDate(), [Running] = 0  where TransformID = @tID
END




GO

-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[TransformTransactions]
@TableScope nvarchar(255) = '%',
@TransformID int = -999999
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    DECLARE @strSQL nvarchar(max);

    DECLARE @tTable nvarchar(max);
	DECLARE @tAction nvarchar(max);
	DECLARE @tSOURCE nvarchar(max);
    DECLARE @tTARGET nvarchar(max);
    DECLARE @tASIS nvarchar(max);
    DECLARE @tTOBE nvarchar(max);


	if @TransformID = -999999 
		DECLARE Transform_Cursor CURSOR FOR
		SELECT [Table], [Action], [SourceColumn], [TargetColumn], [AsIs], [ToBe]
		 FROM [ARM_CORE]..TransformTransaction WHERE [Table] = @TableScope ;
	else
		DECLARE Transform_Cursor CURSOR FOR
		SELECT [Table], [Action], [SourceColumn], [TargetColumn], [AsIs], [ToBe]
		 FROM [ARM_CORE]..TransformTransaction WHERE [Table] = @TableScope and TransformID = @TransformID;



    OPEN Transform_Cursor;

    FETCH NEXT FROM Transform_Cursor INTO @tTable, @tAction, @tSOURCE, @tTARGET, @tASIS, @tTOBE;

    WHILE @@FETCH_STATUS = 0
    BEGIN
				
		Set @strSQL = 
		(
			CASE @tAction
				WHEN 'Override' then
					'UPDATE [' + @tTable + '] SET [' + @tTARGET + '] = ' + @tTOBE + ' WHERE [' + @tSOURCE + '] = ' + @tASIS		

				WHEN 'Update' then
					'UPDATE [' + @tTable + '] SET [' + @tTARGET + '] = ' + @tTOBE + ' WHERE [' + @tSOURCE + '] = ' + @tASIS		

				WHEN 'Insert' then
					'MERGE [' + @tTable + '] as Target using (select ' + @tASIS + ' AS ' + @tSOURCE + ',' + @tTOBE + ' AS ToBe) as Source' 
					+ ' on (target.' + @tSOURCE + ' = source.' + @tSOURCE + ' and target.' +  @tTARGET + ' = source.ToBe)'
					+ ' WHEN NOT MATCHED BY TARGET THEN '
					+ ' insert (' + @tSOURCE + ',' + @tTARGET + ')'
					+ ' Values (Source.' + @tSOURCE + ',Source.ToBe); '
						
				WHEN 'Delete' then
					'DELETE FROM [' + @tTable + '] WHERE [' + @tSOURCE + '] = ' + @tASIS + ' AND [' + @tTARGET + '] = ' + @tTOBE

				ELSE
					''
				END
		)
            
		-- if @strSQL <> '' select @strSQL

		if @strSQL <> '' EXECUTE (@strSQL)


		FETCH NEXT FROM Transform_Cursor INTO @tTable, @tAction, @tSOURCE, @tTARGET, @tASIS, @tTOBE;

    END;

	CLOSE Transform_Cursor;
    DEALLOCATE Transform_Cursor;

END





GO

-- =============================================
-- Author:		John Reed
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[TransformAllTransactionsForAsset]
@TableScope nvarchar(255) = '%',
@AssetID nvarchar(255) = ''
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    DECLARE @strSQL nvarchar(max);

    DECLARE @tTable nvarchar(max);
	DECLARE @tAction nvarchar(max);
	DECLARE @tSOURCE nvarchar(max);
    DECLARE @tTARGET nvarchar(max);
    DECLARE @tASIS nvarchar(max);
    DECLARE @tTOBE nvarchar(max);



	DECLARE Transform_Cursor CURSOR FOR
	SELECT [Table], [Action], [SourceColumn], [TargetColumn], [AsIs], [ToBe]
		FROM [ARM_CORE]..TransformTransaction WHERE [Table] = @TableScope and [AsIs] = '''' + @AssetID + '''';




    OPEN Transform_Cursor;

    FETCH NEXT FROM Transform_Cursor INTO @tTable, @tAction, @tSOURCE, @tTARGET, @tASIS, @tTOBE;

    WHILE @@FETCH_STATUS = 0
    BEGIN
				
		Set @strSQL = 
		(
			CASE @tAction
				WHEN 'Override' then
					'UPDATE [' + @tTable + '] SET [' + @tTARGET + '] = ' + @tTOBE + ' WHERE [' + @tSOURCE + '] = ' + @tASIS		

				WHEN 'Update' then
					'UPDATE [' + @tTable + '] SET [' + @tTARGET + '] = ' + @tTOBE + ' WHERE [' + @tSOURCE + '] = ' + @tASIS		

				WHEN 'Insert' then
					'MERGE [' + @tTable + '] as Target using (select ' + @tASIS + ' AS ' + @tSOURCE + ',' + @tTOBE + ' AS ToBe) as Source' 
					+ ' on (target.' + @tSOURCE + ' = source.' + @tSOURCE + ' and target.' +  @tTARGET + ' = source.ToBe)'
					+ ' WHEN NOT MATCHED BY TARGET THEN '
					+ ' insert (' + @tSOURCE + ',' + @tTARGET + ')'
					+ ' Values (Source.' + @tSOURCE + ',Source.ToBe); '
						
				WHEN 'Delete' then
					'DELETE FROM [' + @tTable + '] WHERE [' + @tSOURCE + '] = ' + @tASIS + ' AND [' + @tTARGET + '] = ' + @tTOBE

				ELSE
					''
				END
		)
            
		-- if @strSQL <> '' select @strSQL

		if @strSQL <> '' EXECUTE (@strSQL)


		FETCH NEXT FROM Transform_Cursor INTO @tTable, @tAction, @tSOURCE, @tTARGET, @tASIS, @tTOBE;

    END;

	CLOSE Transform_Cursor;
    DEALLOCATE Transform_Cursor;

END





GO
CREATE PROCEDURE [dbo].[Transform_User]
AS
BEGIN
SET NOCOUNT ON;
 
-- Assumes that TMP_User has been populated.
-- Dupes are allowed
-- Any manipulation of the data should be done to TMP_User, i.e. merging data sources or setting heartbeat.  This will be a done in ARM_CUSTOM..Import_User.
-- LastLoggedInUser sets tracking in AssetAccessLog

--###### Table Descriptions ######

	declare @DoNothing as bit



-- TMP_Asset
-- Asset
--Import TMP_User
--Remove DUPES from TMP_User keeping NEWEST Heartbeat

	Delete from ARM_CUSTOM..TMP_User
	where UNID in ( 
		select DUPE.UNID from (select a.unid, row_number() OVER ( PARTITION BY a.userid  ORDER BY a.heartbeat DESC ) AS nr
		from [ARM_CUSTOM]..TMP_User as a 
	) as DUPE where nr > 1)

	-- Import TMP_User
	SET DATEFORMAT YMD
	MERGE [ARM_CORE]..[User] as Target
	using (
		SELECT [UserID],[UserName],[Department],[BusinessUnit],[Location],left([JobTitle],49) as JobTitle,[VIP],[Telephone],[Mobile],[Email],[Heartbeat],[FirstName],[Domain],[DirectManager],[CountryCode],[Language] 
		FROM [ARM_CUSTOM]..[TMP_User]
	) as Source
	on (target.UserID = source.UserID )
	WHEN NOT MATCHED THEN
		insert ([UserID],[UserName],[Department],[BusinessUnit],[Location],[JobTitle],[VIP],[Telephone],[Mobile],[Email],[Heartbeat],[FirstName],[Domain],[DirectManager],[CountryCode],[Language])
		Values (source.[UserID],source.[UserName],source.[Department],source.[BusinessUnit],source.[Location],source.[JobTitle],source.[VIP],source.[Telephone],source.[Mobile],source.[Email],source.[Heartbeat],source.[FirstName],source.[Domain],source.[DirectManager],source.[CountryCode],source.[Language])
	WHEN MATCHED AND source.heartbeat > IsNull(target.heartbeat,'1900-01-01') THEN
		UPDATE set target.Heartbeat=source.Heartbeat,target.[Department]=source.[Department], target.[Location]=source.[Location],target.[JobTitle]=source.[JobTitle], target.[Telephone] = source.[Telephone],target.[Mobile] = source.[Mobile],target.[DirectManager]=source.[DirectManager],target.[CountryCode]=source.[CountryCode]; 

	-- Set User Live
	-- Must do this to table to ensure un-matched records are set to Live = 0
	UPDATE [arm_core]..[User] SET Live = 0
	UPDATE [arm_core]..[User] SET Live = 1 WHERE [arm_core]..[User].Heartbeat > getdate() -30


	-- Apply User Transforms
	Exec [ARM_CORE]..[TransformTransactions] 'User'

--###### Scheduled Maintenance and Reporting #######
	--##Run First of the Month##
	IF DATEPART(day,getdate())  = 1 --i.e. First of Month
	-- Run the following on the first of each month
	-- Remove Applications with Zero Instances
	BEGIN
		set @DoNothing = 1
	END
	; --Ends Monthly If
	
	IF DATEPART(dw,getdate())  = 7 --i.e. Sunday
	-- Run the following on Sunday of each week
	-- Remove Applications with Zero Instances
	BEGIN
		set @DoNothing = 1
	END
	; --Ends Weekly If

--	exec [ARM_CORE]..[CalculateBitValues] 'User'
END

GO
-- =============================================
-- Author:  <Andy Bex>
-- ALTER date: <21/5/2019>
-- Description: <Transform User>
-- =============================================
CREATE PROCEDURE [dbo].[zTransform_Other]
AS
BEGIN
SET NOCOUNT ON;
 
-- Assumes that TMP_User has been populated.
-- Dupes are allowed
-- Any manipulation of the data should be done to TMP_User, i.e. merging data sources or setting heartbeat.  This will be a done in ARM_CUSTOM..Import_User.
-- LastLoggedInUser sets tracking in AssetAccessLog

--###### Table Descriptions ######

	declare @DoNothing as bit

-- TMP_Asset
-- Asset
--Import TMP_User
--Remove DUPES from TMP_User keeping NEWEST Heartbeat


	IF object_id('[ARM_CUSTOM]..[Manifest]','U') is not null 
	BEGIN
	
		MERGE [ARM_CUSTOM]..[Manifest] as TARGET
		USING (
			select distinct m.[Serial Number] from [ARM_CORE]..[Asset] a
			LEFT JOIN [ARM_CUSTOM]..[Manifest] m on m.[Serial Number] = a.[SerialNumber]
			where NOT  m.[Serial Number] IS NULL
		) as SOURCE
		On (TARGET.[Serial Number] = SOURCE.[Serial Number])
		WHEN MATCHED THEN
			UPDATE set TARGET.[Seen] = 1;

	END
	
	-- Auto Collection : Add user to MACHINE BUILT Collection if device seen on network built against the userID
	-- SET DATEFORMAT MDY
	 MERGE [ARM_CORE]..[A_CollectionItem] as Target
	 using (select distinct 544 as [CollectionID], substring(a.assetID, 0, CHARINDEX('B0', a.AssetID)) as UserID from [ARM_CORE]..[Asset] a where a.AssetID like '%B0%' ) as Source
	 on (target.ItemID = source.UserID and target.[CollectionID] = source.[CollectionID])
	 WHEN NOT MATCHED THEN
	  insert (itemID, CollectionID)
	  Values (source.[UserID],source.[CollectionID]);

	
	-- provide the MS visio and project combo appv where user has both Visio and Project installed.
	
	IF object_id('#VPtempList','U') is not null DROP TABLE #VPtempList

	select a.AssetID 
	into #VPtempList
	from [ARM_CORE]..[Asset] a
	LEFT JOIN [ARM_CORE]..[AppAstToBe] p on p.AssetID = a.AssetID and p.ApplicationID = 'Microsoft Project Standard 2019 W10-2019'
	LEFT JOIN [ARM_CORE]..[AppAstToBe] v on v.AssetID = a.AssetID and v.ApplicationID = 'Microsoft Visio Standard 2019 W10-2019'
	where NOT p.AssetID IS NULL and NOT v.AssetID IS NULL
	and a.Live = 1

-- Correct Assetag and serial number where device been built in surrogate shell
	SET DATEFORMAT YMD
	MERGE [ARM_CORE]..Asset as Target
	using (SELECT a.[AssetID],a.[AssetTag],a.[SerialNumber],a.[Make],a.[Model],a.[Type],a.[WarrantyDate],a.[Heartbeat],a.[Location],a.[BArea],a.[UserID],u.username,u.[Email],[OU],[OS]
		FROM [ARM_CUSTOM]..[TMP_Asset] a
		left join Arm_core..[User] u on u.userid = a.userid 
		where [Model] in ('x270','x280')
	) as Source on (target.assetID = source.AssetID ) 
	WHEN MATCHED  THEN
		UPDATE set target.[SerialNumber] = source.[SerialNumber], target.[AssetTag] = source.[AssetTag]; 

	
	
	delete from [ARM_CORE]..[AppAstToBe] 
	where AssetID in (		
		select AssetID from #VPtempList
	) and (ApplicationID = 'Microsoft Project Standard 2019 W10-2019' or ApplicationID = 'Microsoft Visio Standard 2019 W10-2019')
	
	
	MERGE [ARM_CORE]..[AppAstToBe]  as TARGET
	USING (
		select AssetID, 'Microsoft Project and Visio Standard 2019 W10-2019' as ApplicationID from #VPtempList
	) as SOURCE
	On (TARGET.[AssetID] = SOURCE.[AssetID] and TARGET.[ApplicationID] = 'Microsoft Project and Visio Standard 2019 W10-2019' )
	WHEN NOT MATCHED BY TARGET THEN
		INSERT (AssetID, ApplicationID)
		VALUES (SOURCE.AssetID, 'Microsoft Project and Visio Standard 2019 W10-2019');



	MERGE [ARM_CORE]..[Asset] as TARGET
	using (
		select a.AssetID, a.UserID, a.Live, a.heartbeat, a.Owner, a.Email 
		, u.BusinessUnit, (Select Top 1 o.BArea from  [ARM_CORE]..[Asset] o where o.AssetID like a.UserID + 'A0%'  order by o.Heartbeat desc) as OldBArea
		from [ARM_CORE]..[Asset] a 
		LEFT JOIN [ARM_CORE]..[User] u on u.UserID = a.UserID
		where ISNULL(a.BArea,'') = ''
	) as Source on (target.assetID = source.AssetID and NOT source.OldBArea IS NULL) 
	WHEN MATCHED  THEN
		UPDATE set target.[BArea] = source.[OldBArea]; 			
	
	
-- Check to see if user is set.  If not then use machine ID if extracted user ID is valid
	
--	MERGE [ARM_CORE]..[Asset] as TARGET
--	using (
--		select a.AssetID, a.BArea, u.UserID, u.UserName, u.Email, u.BusinessUnit, u.CountryCode, u.Location from [ARM_CORE]..[Asset] a 
---		LEFT JOIN [ARM_CORE]..[User] u on u.UserID = LEFT(a.assetID,CHARINDEX('B0', a.assetID, 3)-1)
--		where (IsNull(a.UserID,'unknown') = 'unknown' or a.UserID = '' ) and a.AssetID like '%B0%'
--	) as Source on (target.assetID = source.AssetID and NOT source.UserID IS NULL) 
--	WHEN MATCHED AND TARGET.[BArea] IS NULL THEN
--		UPDATE set target.BAREA = source.BusinessUnit, target.[UserID] = source.[UserID], target.[owner] = source.[userName], target.[Email] = source.[Email];

--	MERGE [ARM_CORE]..[Asset] as TARGET
--	using (
--		select a.AssetID, a.BArea, u.UserID, u.UserName, u.Email, u.BusinessUnit, u.CountryCode, u.Location from [ARM_CORE]..[Asset] a 
--		LEFT JOIN [ARM_CORE]..[User] u on u.UserID = LEFT(a.assetID,CHARINDEX('B0', a.assetID, 3)-1)
--		where (IsNull(a.UserID,'unknown') = 'unknown' or a.UserID = '' ) and a.AssetID like '%B0%'
--	) as Source on (target.assetID = source.AssetID and NOT source.UserID IS NULL) 				
--	WHEN MATCHED AND NOT TARGET.[BArea] IS NULL THEN
--		UPDATE set target.[UserID] = source.[UserID], target.[owner] = source.[userName], target.[Email] = source.[Email]; 	
	

		

	
END


GO

-- =============================================
-- Author:  <JOhn Reed>
-- Create date: <16/7/2021>
-- Description: <Transform Initialise>
-- =============================================
CREATE PROCEDURE [dbo].[Transform_Initialise]
AS
BEGIN
SET NOCOUNT ON;
 
-- Sets up TMP tables for use with import and transform processes.

-- CUSTOM tables
--	TMP_User
--	TMP_Asset
--	TMP_RAW_Apps
--	TMP_RAW_Consolidated_Apps



--###### Table Descriptions ######


	IF object_id('arm_core..[TMP_User]','U') is null 
	BEGIN
		CREATE TABLE  [ARM_CORE]..[TMP_User](
					[UNID] [bigint] IDENTITY(1,1) NOT NULL,
					[UserID] [nvarchar](255) NULL,
					[UserName] [nvarchar](255) NULL,
					[Department] [nvarchar](255) NULL,
					[BusinessUnit] [nvarchar](255) NULL,
					[Location] [nvarchar](255) NULL,
					[JobTitle] [nvarchar](255) NULL,
					[VIP] [bit] NULL,
					[Telephone] [nvarchar](255) NULL,
					[Mobile] [nvarchar](255) NULL,
					[Email] [nvarchar](255) NULL,
					[Heartbeat] [date] NULL,
					[FirstName] [nvarchar](255) NULL,
					[Domain] [nvarchar](255) NULL,
					[DirectManager] [nvarchar](255) NULL,
					[CountryCode] [nvarchar](255) NULL,
					[Language] [nvarchar](255) NULL,
		CONSTRAINT [PK_TMP_User] PRIMARY KEY CLUSTERED 
		(
					[UNID] ASC
		)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
		) ON [PRIMARY]
	END
	ELSE DELETE FROM [ARM_CORE]..[TMP_User]


	IF object_id('[ARM_CORE].[dbo].[TMP_Asset]','U') is null
	BEGIN
		CREATE TABLE [ARM_CORE].[dbo].[TMP_Asset](
					[UNID] [bigint] IDENTITY(1,1) NOT NULL,
					[AssetID] [nvarchar](500) NULL,
					[AssetTag] [nvarchar](500) NULL,
					[SerialNumber] [nvarchar](500) NULL,
					[Make] [nvarchar](500) NULL,
					[Model] [nvarchar](500) NULL,
					[Type] [nvarchar](500) NULL,
					[LifeCycle] [nvarchar](500) NULL,
					[WarrantyDate] [date] NULL,
					[Heartbeat] [date] NULL,
					[Location] [nvarchar](500) NULL,
					[BArea] [nvarchar](500) NULL,
					[UserID] [nvarchar](500) NULL,
					[OU] [nvarchar](500) NULL,
					[OS] [nvarchar](500) NULL,
					[LastLoggedInUser] [nvarchar](500) NULL,
					[BuildNumber] [nvarchar](500) NULL,
		CONSTRAINT [PK_TMP_Asset] PRIMARY KEY CLUSTERED 
		(
					[UNID] ASC
		)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
		) ON [PRIMARY]
	END
	ELSE DELETE FROM [ARM_CORE]..[TMP_Asset]


	IF object_id('[ARM_CORE].[dbo].[TMP_App]','U') is null
	BEGIN


		CREATE TABLE [ARM_CORE].[dbo].[TMP_App](
			[UNID] [bigint] IDENTITY(1,1) NOT NULL,
			[ApplicationID] [nvarchar](500) NULL,
			[AssetID] [nvarchar](500) NULL,
			[Heartbeat] [date] NULL,
			[AppName] [nvarchar](500) NULL,
			[AppVersion] [nvarchar](500) NULL,
		 CONSTRAINT [PK_TMP_App] PRIMARY KEY CLUSTERED 
		(
			[UNID] ASC
		)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
		) ON [PRIMARY]




--		CREATE TABLE [dbo].[TMP_RAW_Apps](
--			[AppAssetID] [nvarchar](max) NULL,
--			[AppName] [nvarchar](max) NULL,
--			[AppVersion] [nvarchar](max) NULL,
--			[AssetID] [nvarchar](max) NULL
--		) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
	END
--	ELSE DELETE FROM [ARM_CORE]..[TMP_App]


	IF object_id('[ARM_CORE].[dbo].[TMP_RAW_Consolidated_Apps]','U') is null
	BEGIN
		CREATE TABLE [dbo].[TMP_RAW_Consolidated_Apps](
			[AppAssetID] [nvarchar](255) NOT NULL,
			[AppName] [nvarchar](max) NOT NULL,
			[AppVersion] [nvarchar](max) NOT NULL,
			[AssetID] [nvarchar](max) NOT NULL,
		CONSTRAINT [PK_TMP_RAW_Consolidated_Apps] PRIMARY KEY CLUSTERED 
		(
			[AppAssetID] ASC
		)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
		) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
	END
--	ELSE DELETE FROM [ARM_CORE]..[TMP_RAW_Consolidated_Apps]


END

GO
CREATE PROCEDURE [dbo].[zTransform_Asset]
AS
BEGIN
SET NOCOUNT ON;
-- Assumes that TMP_Asset has been populated.
-- Dupes are allowed
-- Any manipulation of the data should be done to TMP_Asset, i.e. merging data sources or setting heartbeat.  This will be a done in ARM_CUSTOM..Import_Asset.
-- LastLoggedInUser sets tracking in AssetAccessLog

--###### Table Descriptions ######

-- TMP_Asset
-- Asset
	declare @DoNothing as bit

	--Remove DUPES from TMP_Asset keeping NEWEST Heartbeat
	Delete from [ARM_CUSTOM]..TMP_Asset
	where UNID in ( select DUPE.UNID from (select a.unid, row_number() OVER ( PARTITION BY a.AssetID  ORDER BY a.heartbeat DESC ) AS nr
	from [ARM_CUSTOM]..TMP_Asset as a ) as DUPE where nr > 1)


	--Import TMP_Asset
	SET DATEFORMAT YMD
	MERGE [ARM_CORE]..Asset as Target
	using (SELECT a.[AssetID],a.[AssetTag],a.[SerialNumber],a.[Make],a.[Model],a.[Type],a.[WarrantyDate],a.[Heartbeat],a.[Location],a.[BArea],a.[UserID],u.username,u.[Email],[OU],[OS]
		FROM [ARM_CUSTOM]..[TMP_Asset] a
		left join Arm_core..[User] u on u.userid = a.userid 
	) as Source on (target.assetID = source.AssetID ) --[Does not work at Astellas as mnay instances of same serial] --or (target.[SerialNumber] = source.[SerialNumber])
	WHEN NOT MATCHED THEN
		insert ([AssetID],[AssetTag],[SerialNumber],[Make],[Model],[Type],[WarrantyDate],[Heartbeat],[Location],[BArea],[UserID],[Owner],[Email],[OU],[OS])
		Values (source.[AssetID],source.[AssetTag],source.[SerialNumber],source.[Make],source.[Model],source.[Type],source.[WarrantyDate],source.[Heartbeat],source.[Location],source.[BArea],source.[UserID],source.username,source.[Email],source.[OU],source.[OS])
	WHEN MATCHED AND source.SerialNumber <> '' AND source.heartbeat > IsNull(target.heartbeat,'1900-01-01') 
	THEN
		UPDATE set target.serialNumber=source.SerialNumber, target.AssetTag=Source.AssetTag, target.OS=source.OS, target.UserID=source.UserID, target.heartbeat = source.heartbeat, target.[owner] = source.username, target.[Email] = source.[Email], target.[Model] = source.[Model]; -- , target.Location = source.Location; 

	-- Set Asset Live
	-- Must do this to asset table to ensure un-matched records are set to Live = 0
	UPDATE [arm_core]..[asset] SET Live = 0
	UPDATE [arm_core]..[asset] SET Live = 1 WHERE [arm_core]..[asset].Heartbeat > getdate() -30

	declare @LiveCollectionID as int
	set @LiveCollectionID = 0

	select @LiveCollectionID = c.CollectionID from [ARM_CORE]..[A_Collection] c where c.[CREF] = '_LIVE30'

	if @LiveCollectionID > 0 
	BEGIN
		MERGE [ARM_CORE]..[A_CollectionItem] as Target
		using (select a.AssetID as ItemID, @LiveCollectionID as CollectionID from [ARM_CORE]..[Asset] a where a.Heartbeat > getdate() -30 ) as Source
		on (target.ItemID = source.ItemID and target.[CollectionID] = source.[CollectionID])
		WHEN NOT MATCHED BY TARGET THEN
		insert (itemID, CollectionID)
		Values (source.ItemID,source.[CollectionID]);

		delete from [ARM_CORE]..[A_CollectionItem] where CollectionID = @LiveCollectionID and ItemID NOT in (select a.AssetID from [ARM_CORE]..[Asset] a where a.Heartbeat > getdate() -30 )
	END

	-- Write User Login Count from LastLogin TMP_Asset

	 SET DATEFORMAT MDY
	 MERGE [ARM_CORE].[dbo].[AssetAccessLog] as Target
	 using (SELECT AssetID, LastLoggedInUser as UserID, Heartbeat FROM arm_custom..TMP_Asset) as Source
	 on (target.assetid = source.assetID and target.userid = source.userid)
	 WHEN NOT MATCHED THEN
	  insert (AssetID, UserID, [LastDate], [Counter])
	  Values (source.AssetID,source.[UserID],source.Heartbeat,'1')
	 WHEN MATCHED THEN
	  update set target.[Counter]=target.[Counter]+1, target.[LastDate]=source.Heartbeat;

	-- Apply Asset Transforms
	Exec [ARM_CORE]..[TransformTransactions] 'Asset'


	--###### Scheduled Maintenance and Reporting #######
	--##Run First of the Month##
	IF DATEPART(day,getdate())  = 1 --i.e. First of Month
	-- Run the following on the first of each month
	-- Remove Applications with Zero Instances
	BEGIN
		set @DoNothing = 1
	END
	
	; --Ends Monthly If
	IF DATEPART(dw,getdate())  = 7 --i.e. Sunday
	-- Run the following on Sunday of each week
	-- Remove Applications with Zero Instances
	BEGIN
		set @DoNothing = 1
	END
	; --Ends Weekly If



--	exec [ARM_CORE]..[CalculateBitValues] 'Asset'

--	update [ARM_CORE]..[Asset] set Ready = 0
--	update [ARM_CORE]..[Asset] set Ready = 1  where dbo.[CheckBitStatus](BitStatus,'Readiness','ACE2 Ready') > 0
END



GO
CREATE PROCEDURE [dbo].[zTransform_App]
AS
BEGIN
SET NOCOUNT ON;
-- Assumes that TMP_App has been populated.
-- ARM_CUSTOM..TMP_App: ApplicationID,AssetID,Heartbeat, i.e. AdobeAcrobat~5.4.23,GBLH40HG,2019-05-22
-- Dupes are allowed
-- Any manipulation of the data should be done to TMP_App, i.e. merging data sources or setting heartbeat.  This will be a done in ARM_CUSTOM..import_App.
-- Global ASA has values for Asset Live (30) and Unused Software (90)

--###### Table Descriptions ######

-- TMP_App
-- App_Transform_Last
-- App_Transform_History
-- PreStop refers to the estate BEFORE the STOP list is applied (so will include components and drivers etc).  It is used primarily to show a full application listing on the asset form.
-- AppAstPreStop - a full list off assets/apps
-- ASIS refers to the current estate as deployed now, after applying to STOP table, only includes LIVE assets
-- AppAstAsIs - list of assets/apps 
-- TOBE refers to the future estate, only includes apps with Heartbeat of NULL or <90 old
-- AppAstAsIs - list of assets/apps 

declare @DoNothing as bit

IF object_id('[ARM_CUSTOM]..[TMP_App]','U') is null
BEGIN
	CREATE TABLE ARM_CUSTOM..[TMP_App](
				[UNID] [bigint] IDENTITY(1,1) NOT NULL,
				[ApplicationID] [nvarchar](500) NULL,
				[AssetID] [nvarchar](500) NULL,
				[Heartbeat] [date] NULL,
				[AppName] [nvarchar](500) NULL,
				[AppVersion] [nvarchar](500) NULL,
	CONSTRAINT [PK_TMP_App] PRIMARY KEY CLUSTERED 
	(
				[UNID] ASC
	)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
	) ON [PRIMARY]
END

--Remove DUPES from TMP_App keeping NEWEST Heartbeat
Delete from ARM_CUSTOM..TMP_App
where UNID in ( select DUPE.UNID from (select a.unid, row_number() OVER ( PARTITION BY a.applicationid,a.AssetID  ORDER BY a.heartbeat DESC ) AS nr
from [ARM_CUSTOM]..TMP_App as a ) as DUPE where nr > 1)


--Transform History - Maintain data that drops out of data source, i.e. Asset dropped from SCCM, but keep the applications.
--Insert any additional apps in TMP_App_Last into App_Transform_History
MERGE INTO ARM_CORE..App_Transform_History Target
Using (select l.ApplicationID, l.assetID, l.heartbeat from ARM_CORE..App_Transform_Last l
left join ARM_CUSTOM..TMP_App a WITH(NOLOCK) on a.ApplicationID = l.applicationID and a.AssetID = l.assetID
where a.ApplicationID is null) as Source
on target.ApplicationID=source.ApplicationID and target.assetID=source.assetID
WHEN Not MATCHED THEN 
  insert(ApplicationID, AssetID, Heartbeat)
  Values (source.ApplicationID, source.AssetID, source.Heartbeat);
  
  
--Remove any references Disposed or LIVE assets in App_Transform_History, i.e. as it is live, it will have a current feed, this will remove any Un-installed software
delete h
from ARM_CORE..App_Transform_History h
left join ARM_CORE..Asset a on a.AssetID = h.assetid
where a.live = 1

--Add History back into TMP_Apps
insert into ARM_CUSTOM..TMP_App(ApplicationID, AssetID, Heartbeat)
select h.ApplicationID, h.assetID, h.heartbeat from ARM_CORE..App_Transform_History h WITH(NOLOCK) 

--Remove all records from App_Transform_Last and reset them
IF object_id('[ARM_CORE]..App_Transform_Last','U') is not null DELETE FROM [ARM_CORE]..App_Transform_Last
insert into ARM_CORE..App_Transform_Last (ApplicationID, AssetID, Heartbeat)
select a.ApplicationID, a.assetID, a.heartbeat from ARM_CUSTOM..TMP_App a WITH(NOLOCK) 


--########### AppAstPreStop ###########

-- Update AppAstPreStop (All apps/asset - including not live and unused)
 IF object_id('[ARM_CORE]..AppAstPreStop','U') is not null DELETE FROM [ARM_CORE]..AppAstPreStop
 INSERT INTO [ARM_CORE]..AppAstPreStop (ApplicationID, AssetID, Heartbeat)
  SELECT distinct LEFT(a.ApplicationID,255), a.AssetID, a.heartbeat as Live FROM ARM_CUSTOM..TMP_App a WITH(NOLOCK) 

--########### AppAstAsIS ###########
-- Insert AppAstAsIs (Live Used Apps) - First Phase Insert Only where asset is Live

    IF object_id('[ARM_CORE]..AppAstAsIs','U') is not null 
    BEGIN
                    IF EXISTS (SELECT 1 FROM sys.indexes WHERE name = 'I_AppAstAsIs_APPID' AND object_id = object_id('[ARM_CORE]..AppAstAsIs','U')) DROP INDEX [AppAstAsIs].[I_AppAstAsIs_APPID]
                    IF EXISTS (SELECT 1 FROM sys.indexes WHERE name = 'I_AppAstAsIs_ASSETID' AND object_id = object_id('[ARM_CORE]..AppAstAsIs','U')) DROP INDEX [AppAstAsIs].[I_AppAstAsIs_ASSETID]
                    Delete from [ARM_CORE]..[AppAstAsIs]
    END


	 INSERT INTO [ARM_CORE]..[AppAstAsIs] (ApplicationID, AssetID)
	  SELECT distinct  p.ApplicationID, p.AssetID FROM [ARM_CORE]..AppAstPreStop p
	  left join ARM_CORE..Asset a on a.AssetID = p.AssetID
	  WHERE a.live = 1 and NOT p.ApplicationID IS NULL
-- Update AppAstAsIS - Second Phase - Remove any Explicit STOP
	delete i
	from [ARM_CORE]..[AppAstAsIs] I
	LEFT JOIN [ARM_CORE]..TransformAppStop s on s.ApplicationID = I.ApplicationID
	WHERE s.ApplicationID is not null
-- Update AppAstAsIs  - Third Phase - Remove any Like STOP
	delete i
	from [ARM_CORE]..[AppAstAsIs] I
	left JOIN [ARM_CORE]..TransformAppStop s on I.ApplicationID like s.ApplicationID  
	WHERE s.ApplicationID is not null


--	ALTER TABLE [ARM_CORE]..[AppAstAsIs]
--	ADD CONSTRAINT PK_AppAstAsIs_ASSETID PRIMARY KEY (AssetID);

	CREATE CLUSTERED INDEX I_AppAstAsIs_APPID on [ARM_CORE]..[AppAstAsIs](ApplicationID Asc);
	CREATE INDEX I_AppAstAsIs_ASSETID on [ARM_CORE]..[AppAstAsIs](AssetID);

--########### AppAstUnUsed ###########
-- Insert AppAstUnUsed (Not Live Used Apps) - First Phase Insert Only where asset is Not Live
 IF object_id('[ARM_CORE]..AppAstUnUsed','U') is not null Delete from [ARM_CORE]..AppAstUnUsed
 INSERT INTO [ARM_CORE]..AppAstUnUsed (ApplicationID, AssetID)
  SELECT distinct  p.ApplicationID, p.AssetID FROM [ARM_CORE]..AppAstPreStop p
  left join ARM_CORE..Asset a on a.AssetID = p.AssetID
  WHERE a.live = 0
  
-- Update AppAstUnUsed - Second Phase - Remove any Explicit STOP
delete i
from [ARM_CORE]..AppAstUnUsed I
LEFT JOIN [ARM_CORE]..TransformAppStop s on s.ApplicationID = I.ApplicationID
WHERE s.ApplicationID is not null

-- Update AppAstUnUsed  - Third Phase - Remove any Like STOP
delete i
from [ARM_CORE]..AppAstUnUsed I
left JOIN [ARM_CORE]..TransformAppStop s on I.ApplicationID like s.ApplicationID  
WHERE s.ApplicationID is not null
--Check Group Mappings and Apply to Any Orphans

Exec [ARM_CORE]..[TransformTransactions] 'AppAstAsIs'

EXEC [ARM_CORE]..[Apps-AutoAppsGroupMapping] --- Primary Key ViOlition 


--ALTER AppAstToBe (and apply Transforms)
EXEC [ARM_CORE]..[Apps-ReApplyAppTransforms]

-- Apply Asset Transforms
Exec [ARM_CORE]..[TransformTransactions] 'AppAstToBe'

-- Licence Mapping Update
-- As Installs change daily, these scripts assign/un-assign licences based on Installs.
-- Under Assigned
MERGE INTO ARM_CORE..LicenceMap Target
USING (select y.ApplicationID, y.Licences - y.Assigned as [AddLicence], y.autoassign
from (select x.ApplicationID,isnull(l.Licences,0) as Licences, x.Required,isnull(m.assigned,0) as Assigned, a.DeployType, m.autoassign
from (select b.ApplicationID, count(b.assetid) as Required from ARM_CORE..AppAstToBe b group by b.ApplicationID) as x
left join arm_core..LicenceMap m on m.applicationid = x.ApplicationID
left join ARM_CORE..Licence l on l.LicenceID = m.licenceid
left join ARM_CORE..Application a on a.ApplicationID = x.ApplicationID
left join arm_core..AppGroup g on g.AppGroupID = a.AppGroupID) as y
where y.deploytype <> 'B' and y.Licences > y.Assigned and y.Assigned < y.Required and y.autoassign = 1) Source
   ON target.applicationID = Source.Applicationid
WHEN MATCHED THEN
   UPDATE 
   SET target.Assigned = Target.Assigned + Source.AddLicence;
-- Over Assigned
MERGE INTO ARM_CORE..LicenceMap Target
USING (select y.ApplicationID, y.Assigned - y.Licences as [AddLicence], y.autoassign
from (select x.ApplicationID,isnull(l.Licences,0) as Licences, x.Required,isnull(m.assigned,0) as Assigned, a.DeployType, m.autoassign
from (select b.ApplicationID, count(b.assetid) as Required from ARM_CORE..AppAstToBe b group by b.ApplicationID) as x
left join arm_core..LicenceMap m on m.applicationid = x.ApplicationID
left join ARM_CORE..Licence l on l.LicenceID = m.licenceid
left join ARM_CORE..Application a on a.ApplicationID = x.ApplicationID
left join arm_core..AppGroup g on g.AppGroupID = a.AppGroupID) as y
where y.deploytype <> 'B' and y.Assigned > y.Licences and y.autoassign = 1) Source
   ON target.applicationID = Source.Applicationid
WHEN MATCHED THEN
   UPDATE 
   SET target.Assigned = Target.Assigned - Source.AddLicence;

-- Update AppFirstSeen
 MERGE [ARM_CORE]..AppFirstSeen as Target
 using (SELECT distinct ApplicationID, getDate() as [TimeStamp] from [ARM_CORE]..[AppAstAsIs] ) as Source
 on (target.ApplicationID = source.ApplicationID)
 WHEN Not MATCHED THEN 
   insert (ApplicationID,[TimeStamp])
  Values (source.ApplicationID,[TimeStamp]);
  
  
  
--###### Scheduled Maintenance and Reporting #######
--##Run First of the Month##
IF DATEPART(day,getdate())  = 1 --i.e. First of Month
-- Run the following on the first of each month

-- Remove AS IS mapping in TransformAppMap
delete m
from ARM_CORE..TransformAppMap m
left join
(Select a.ApplicationID from ARM_CORE..[Application] a
 left join (select distinct i.applicationid from ARM_CORE..AppAstAsIs i) x on x.applicationid = a.ApplicationID
 where isnull(x.applicationid,'')= '' and isnull(a.publish,0) = 0 and isnull(a.LocalID,'') = '' and isnull(a.PackageID,'') = ''
)z on z.applicationiD = m.[As Is]
where not z.ApplicationID is null


-- Remove Applications with NO associated instances in the AppAstAsIs

-- delete  a
--  from ARM_CORE..[Application] a
--  left join (select distinct i.applicationid from ARM_CORE..AppAstAsIs i) x on x.applicationid = a.ApplicationID
--  where isnull(x.applicationid,'')= '' and isnull(a.publish,0) = 0 and isnull(a.LocalID,'') = '' and isnull(a.PackageID,'') = ''


; --Ends Monthly If
IF DATEPART(dw,getdate())  = 7 --i.e. Sunday
-- Run the following on Sunday of each week
-- Remove Applications with Zero Instances
set @DoNothing = 1
; --Ends Weekly If


	IF object_id('[ARM_CORE]..[s_ApplicationASISInstallCount]','U') is not null Delete from [ARM_CORE]..[s_ApplicationASISInstallCount]
	 INSERT INTO [ARM_CORE]..[s_ApplicationASISInstallCount] ([ApplicationID], [Count])
		SELECT   ApplicationID, COUNT(DISTINCT AssetID) AS Count
		FROM     dbo.AppAstAsIs 
		GROUP BY ApplicationID

	 IF object_id('[ARM_CORE]..[s_ApplicationToBeInstallCount]','U') is not null Delete from [ARM_CORE]..[s_ApplicationToBeInstallCount]
	 INSERT INTO [ARM_CORE]..[s_ApplicationToBeInstallCount] (ApplicationID, [Count])
		SELECT   ApplicationID, COUNT(DISTINCT AssetID) AS Count
		FROM     dbo.AppAstToBe
		GROUP BY ApplicationID


--	exec [ARM_CORE]..[CalculateBitValues] 'Application'

END


GO
-- =============================================
-- Author:		<John Reed>
-- alter date: <17/2/16>
-- Description:	<Transform for the Asset table>
-- =============================================
CREATE PROCEDURE [dbo].[Trans-AssetUpload] 

AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

-- PreReqs for this procedure are
--		TMP_RAW_Asset

-- Steps
--		1. PREQ: Upload RAW data from data feed
--		2. Merge data from RAW in Asset Table
--		3. Set Live if Less than 30 days
--		4. Merge data from FixedRecord
--		5. Apply Updates
--		6. Apply Overrides
--		7. Empty ModelToBe
--		8. Write default ModelToBe
--		9. Apply Overrides to ModelToBe
--		10. Resolve Data issues

--		1. Empty Asset table

	IF object_id('[ARM_CORE]..[TMP_RAW_2012ArmDataFeed]','U') is not null
	BEGIN

		EXEC [SYS-SiteDown] 'SCCM Asset Upload in progress.  This will only take a few minutes.'

--		EXEC [ARM_CORE]..[C_Trans-AssetUpload-ASTELLAS]

		EXEC [SYS-SiteUp]

--		
	END


END








GO


-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Trans-AssetAppsUpload2012]
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	IF object_id('[ARM_CORE]..[TMP_RAW_AssetApps12]','U') is not null 
	BEGIN

		EXEC [SYS-SiteDown] 'SCCM Asset / Application Upload in progress.  This can take up to 20 minutes.'


-- Remove any Asset / App row from initial (2007) Upload where data is now coming through via SCCM2012
-- without 2007 feed this will retain historic app records !!

		DELETE from [ARM_CORE]..[AppAstPreStop] where AssetID in (SELECT distinct AssetID FROM [ARM_CORE]..TMP_RAW_AssetApps12)

-- Repopulate with fresh Asset and app ids as picked up from SCCM 2012

		MERGE [ARM_CORE]..AppAstPreStop AS Target
			using (SELECT distinct s.AssetID, ''+s.[AppName]+'-'+s.[AppVersion] AS ApplicationID FROM [ARM_CORE]..[TMP_RAW_AssetApps12] s) As Source
			ON (Target.AssetID = Source.AssetID and Target.ApplicationID = Source.ApplicationID)
			WHEN NOT MATCHED BY TARGET THEN
				insert (AssetID, ApplicationID)
					values (Source.AssetID, Source.ApplicationID);

	DELETE from [ARM_CORE]..[AppAstAsIs] where AssetID in (SELECT distinct AssetID FROM [ARM_CORE]..TMP_RAW_AssetApps12)

       INSERT INTO [ARM_CORE]..[AppAstAsIs] (ApplicationID, AssetID)
               SELECT distinct  r.ApplicationID, r.AssetID 
               FROM [ARM_CORE]..AppAstPreStop r where r.AssetID in (SELECT distinct AssetID FROM [ARM_CORE]..TMP_RAW_AssetApps12)

 --       INSERT INTO [ARM_CORE]..[AppAstAsIs] (ApplicationID, AssetID)
 --               SELECT distinct  r.ApplicationID, r.AssetID 
--                FROM [ARM_CORE]..AppAstPreStop r 
--				LEFT JOIN [ARM_CORE]..[TransformAppStop] s  on r.ApplicationID like s.ApplicationID
--				where  s.ApplicationID IS NULL and r.AssetID in (SELECT distinct AssetID FROM [ARM_CORE]..TMP_RAW_AssetApps12)

--		MERGE [ARM_CORE]..[AppAstAsIs] AS TARGET
--		using (
----			select  distinct a.AssetID, a.ApplicationID from [ARM_CORE]..[AppAstAsIs] a
--			LEFT JOIN [ARM_CORE]..[TransformAppStop] s  on a.ApplicationID like s.ApplicationID
--			where  s.ApplicationID IS NULL
--		) as SOURCE
--		ON (TARGET.ASSETID

-- Add Asset if not known

		MERGE [ARM_CORE]..[Asset] AS Target
		using (
			select meta.AssetID as NewAssetID, meta.OldAssetID, a.AssetID, a.UserID, a.Email, a.[Owner], IsNull(a.BArea,'[TO BE PLACED]') as BArea, a.Location
			from  (
			SELECT distinct r.[AssetID], (select top 1 z.AssetID from [ARM_CORE]..Asset z where z.AssetID like Left(r.AssetID,Len(r.AssetID)-4) + '%' order by z.AssetID desc) as OldAssetID
			  FROM [ARM_CORE]..[TMP_RAW_AssetApps12] r
			  LEFT JOIN [ARM_CORE]..[Asset] y on y.AssetID = r.AssetID
			  where y.AssetID IS Null
			) as meta 
			LEFT JOIN [ARM_CORE]..[Asset] a on a.AssetID like meta.OldAssetID
			Where (meta.AssetID > meta.OldAssetID or meta.OldAssetID IS NULL) and NOT meta.AssetID IS NULL
		) As Source
		ON (Target.AssetID = Source.NewAssetID)
			WHEN NOT MATCHED BY TARGET THEN
				insert (AssetID, userID, [Email], [Owner], BArea, Location, [Custom01], [Type], [Heartbeat])
					values (Source.NewAssetID, Source.userID, Source.[Email], Source.[Owner], Source.BArea, Source.Location, 'SCCM2012', 'Laptop', getdate());


		MERGE [ARM_CORE]..[AssetStatus] AS Target
		using (select a.AssetID from [ARM_CORE]..[Asset] a where a.[Custom01] = 'SCCM2012') as SOURCE
		ON (Target.AssetID = SOURCE.AssetID)
			WHEN NOT MATCHED BY TARGET THEN
				insert (AssetID, EngDeployed) values (SOURCE.AssetID, 0);

-- Hmmm, next statement probably now defunct. Needs checking
		update [ARM_CORE]..[AssetStatus] set EngDeployed = 1 where AssetID like '%[AM][0123456789][0123456789][0123456789]' and EngDeployed = 0




-- Add ApplicationID to Unique list if not already captured.

		MERGE [ARM_CORE]..[AppUniqPreStop] AS Target
			using (SELECT distinct ''+s.[AppName]+'-'+s.[AppVersion] AS ApplicationID,s.[AppName],s.[AppVersion] FROM [ARM_CORE]..[TMP_RAW_AssetApps12] s) As Source
			ON (Target.ApplicationID = Source.ApplicationID)
			WHEN NOT MATCHED BY TARGET THEN
				insert (ApplicationID, [AppName], [AppVersion] )
					values (Source.ApplicationID, Source.[AppName], Source.[AppVersion]);

-- Remove any applicationID from Unique list where not contained in AppAstPreStop

		MERGE [ARM_CORE]..[AppUniqPreStop] AS Target
			using (SELECT distinct ApplicationID FROM [ARM_CORE]..[AppAstPreStop]) As Source
			ON (Target.ApplicationID = Source.ApplicationID)
			WHEN NOT MATCHED BY SOURCE THEN
				DELETE;

		exec [ARM_CORE]..[Apps-ReApplyAppTransforms]


		-- CUSTOM COUNTERS ETC.
		EXEC [SYS-SiteUp]

	END
END


GO
 
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Trans-AssetAppsUpload]
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	IF object_id('TMP_RAW_AssetApps','U') is not null 
	BEGIN


		EXEC [SYS-SiteDown] 'SCCM Asset / Application Upload in progress.  This can take up to 20 minutes.'

		-- Take initial Upload and alter App Keys as AppID

		IF object_id('AppAstPreStop','U') is not null DELETE FROM AppAstPreStop
		INSERT INTO AppAstPreStop
			SELECT distinct s.AssetID, ''+s.[AppName]+'-'+s.[AppVersion] AS ApplicationID FROM TMP_RAW_AssetApps s

		IF object_id('AppUniqPreStop','U') is not null DELETE FROM AppUniqPreStop
		INSERT INTO AppUniqPreStop
			SELECT distinct ''+s.[AppName]+'-'+s.[AppVersion] AS ApplicationID,s.[AppName],s.[AppVersion] FROM TMP_RAW_AssetApps s


		MERGE [ARM_CORE]..[Asset] AS Target
		using (
			select meta.AssetID as NewAssetID, meta.OldAssetID, a.AssetID, a.UserID, a.Email, a.[Owner], IsNull(a.BArea,'[TO BE PLACED]') as BArea, a.Location
			from  (
			SELECT distinct r.[AssetID], (select top 1 z.AssetID from [ARM_CORE]..Asset z where z.AssetID like Left(r.AssetID,Len(r.AssetID)-4) + '%' order by z.AssetID desc) as OldAssetID
			  FROM [ARM_CORE]..[TMP_RAW_AssetApps] r
			  LEFT JOIN [ARM_CORE]..[Asset] y on y.AssetID = r.AssetID
			  where y.AssetID IS Null
			) as meta 
			LEFT JOIN [ARM_CORE]..[Asset] a on a.AssetID like meta.OldAssetID
			Where (meta.AssetID > meta.OldAssetID or meta.OldAssetID IS NULL) and NOT meta.AssetID IS NULL
		) As Source
		ON (Target.AssetID = Source.NewAssetID)
			WHEN NOT MATCHED BY TARGET THEN
				insert (AssetID, userID, [Email], [Owner], BArea, Location, [Custom01], [Type], [Heartbeat])
					values (Source.NewAssetID, Source.userID, Source.[Email], Source.[Owner], Source.BArea, Source.Location, 'SCCM2007', 'Laptop', getdate());

		MERGE [ARM_CORE]..[AssetStatus] AS Target
		using (select a.AssetID from [ARM_CORE]..[Asset] a where a.[Custom01] = 'SCCM2007') as SOURCE
		ON (Target.AssetID = SOURCE.AssetID)
			WHEN NOT MATCHED BY TARGET THEN
				insert (AssetID, EngDeployed) values (SOURCE.AssetID, 0);


		exec [Apps-ReApplyAppTransforms]


		-- CUSTOM COUNTERS ETC.


--		MERGE [ARMS].[dbo].[AssetFlags] AS target
--			using (select AssetID from [ARM_CORE]..[AppAstAsIs] where ApplicationID like 'Microsoft Office Professional Plus 2010%') As Source
--			ON (Target.AssetID = Source.AssetID and FlagID = 1029)
--			WHEN NOT MATCHED BY TARGET THEN
--				insert (AssetID, FlagID, State)
--					values (Source.AssetID, 1029, 1);

		EXEC [SYS-SiteUp]

	END
END


GO
CREATE PROCEDURE [dbo].[Tombstone-Target]
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
        SET NOCOUNT ON;
--      BEGIN TRAN;
        DECLARE @TombstoneClassID INT;
        DECLARE @ExemptCollectionID INT;
        DECLARE @NoEmailCollectionID INT;
        DECLARE @CollectionID INT;
        SET @TombstoneClassID = (SELECT top 1 p.Tombstone FROM [A_SiteProperties] p )        
        SET @ExemptCollectionID = (SELECT top 1 p.TombstoneExempt FROM [A_SiteProperties] p )     
        SET @NoEmailCollectionID = (SELECT top 1 p.TombstoneNoEmail FROM [A_SiteProperties] p )        
                       
        SET @CollectionID = (select  items.CollectionID from (select c.CollectionID, Row_Number() OVER(PARTITION BY '1' order by [CollectionClassID],[Order]) as nr from [ARM_CORE]..[A_Collection] c where c.CollectionClassID = @TombstoneClassID) as items where items.nr = 1)           
        if IsNull(@CollectionID,0) <> 0 
        BEGIN
               -- reset items to Target where Email address in Notification Log doesn't match email in asset (i.e. Asset email updated since warning sent)
               EXEC [ARM_CORE]..[Tombstone-Reset]
 
 
               INSERT INTO [ARM_CORE]..[A_CollectionItem] (ItemID, CollectionID)
                       select distinct a.AssetID, @CollectionID
                       from arm_core..Asset as a
                       LEFT JOIN (
                              select i.ItemID as AssetID, count(i.itemID) as IsTombstoned from [ARM_CORE]..[A_CollectionClass] cc  
                              LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionClassID = cc.CollectionClassID
                              LEFT JOIN [ARM_CORE]..[A_CollectionItem] i on i.CollectionID = c.CollectionID 
                              where cc.CollectionClassID = @TombstoneClassID and NOT i.ItemID IS NULL group by i.ItemID
                       ) as Tombstoned on Tombstoned.Assetid = a.AssetID
                       where IsNull(a.Live,0) = 0
                       and SUBSTRING(a.AssetID, 3, 1) in ('L', 'U', 'M','D','W')
                       and SUBSTRING(a.AssetID, 1, 2) not in ('ZA', 'AE','EG', 'JP','US')
                       and LEN(a.assetid) = 10
                       and Tombstoned.AssetID IS NULL
               
               delete from [ARM_CORE]..[A_CollectionItem] 
               where ItemID in (
                       select distinct a.AssetID
                       from arm_core..Asset as a
                       LEFT JOIN (
                              select i.ItemID as AssetID, count(i.itemID) as IsTombstoned from [ARM_CORE]..[A_CollectionClass] cc  
                              LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionClassID = cc.CollectionClassID
                              LEFT JOIN [ARM_CORE]..[A_CollectionItem] i on i.CollectionID = c.CollectionID 
                              where cc.CollectionClassID = @TombstoneClassID and NOT i.ItemID IS NULL group by i.ItemID
                       ) as Tombstoned on Tombstoned.Assetid = a.AssetID
                       where (a.Live = 1)
                       and NOT Tombstoned.AssetID IS NULL 
               ) and CollectionID in (
                       select f.CollectionID from [ARM_CORE]..[A_Collection] f where f.CollectionClassID = @TombstoneClassID and NOT f.CollectionID = @ExemptCollectionID
               )
        END
 
        if IsNull(@NoEmailCollectionID,0) <> 0 
        BEGIN
               update [ARM_CORE]..[A_CollectionItem] set [CollectionID] = @NoEmailCollectionID 
                       where [CollectionID] = @CollectionID and [ItemID] IN (
                              select distinct ItemID from [ARM_CORE]..[A_CollectionItem] c 
                              LEFT JOIN [ARM_CORE]..[Asset] a on a.AssetID = ItemID 
                              where c.[CollectionID] = @CollectionID and IsNull(a.Email,'') = ''
                       )
        END
 
--      OUTPUT $action, inserted.*, deleted.*;
--      ROLLBACK TRAN;
END


GO
-- =============================================
-- Author:             <Author,,Name>
-- Create date: <Create Date,,>
-- Description:        <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Tombstone-Reset]
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
        SET NOCOUNT ON;
--      BEGIN TRAN;
        DECLARE @TombstoneClassID INT;
        DECLARE @ExemptCollectionID INT;
        DECLARE @CollectionID INT;
        SET @TombstoneClassID = (SELECT top 1 p.Tombstone FROM [A_SiteProperties] p )        
        SET @ExemptCollectionID = (SELECT top 1 p.TombstoneExempt FROM [A_SiteProperties] p )     
        
        -- get ID of first collection in Tombstone (i.e. Target)
                       
        SET @CollectionID = (select  items.CollectionID from (select c.CollectionID, Row_Number() OVER(PARTITION BY '1' order by [CollectionClassID],[Order]) as nr from [ARM_CORE]..[A_Collection] c where c.CollectionClassID = @TombstoneClassID) as items where items.nr = 1)           
        if IsNull(@CollectionID,0) <> 0 
        BEGIN
 
               DECLARE @myid nvarchar(255) = CONVERT(nvarchar(255), NEWID());
               --Reset Collection to Target if 1 Sent, Notification 1 Sent and used email <> current asset email
               MERGE [ARM_CORE]..[A_CollectionItem] AS Target
                       USING (
                              select note.* from (
                                      select i.ItemID, i.CollectionID, a.Email as AssetEmail, n.Email as [NoteEmail], n.[TemplateUsed], n.[WhenSent], Row_Number() OVER(PARTITION BY n.AssetID order by n.[WhenSent] desc) as nr
                                      from [NotificationLog] n LEFT JOIN [ARM_CORE]..[A_CollectionItem] i on i.ItemID = n.AssetID 
                                      LEFT JOIN [ARM_CORE]..[Asset] a on a.AssetID = n.AssetID
                              ) as note where note.nr = 1 and note.CollectionID = 76 and note.[TemplateUsed] = 'Tombstone Warning 1.htm' and IsNull(note.AssetEmail,'') <> note.NoteEmail
                       ) As Source
                       ON (Target.ItemID = Source.ItemID and Target.CollectionID = Source.CollectionID )
                       WHEN MATCHED THEN
                              UPDATE SET Target.[TaggedOn] = getdate(), Target.[CollectionID] = @CollectionID, Target.[TransactionID] = @myid;
               --Adds Comment for any changed.
               MERGE [ARM_CORE]..[A_CommentLog] AS Target
                       USING (
                              select i.ItemID, 'Tombstone: Reset from Step 1 to Target' as [Comment], i.[TaggedOn] from [ARM_CORE]..[A_CollectionItem] i where i.[TransactionID] = @myid
                       ) As Source
                       ON (Target.RecordID = Source.ItemID and Target.[Comment] = Source.[Comment] and target.[TimeStamp] = Source.[TaggedOn] )
                       WHEN NOT MATCHED BY TARGET THEN
                              INSERT ([Table],[Type],[recordID],[Author],[Comment]) 
                              VALUES ('Asset','System',Source.ItemID, 'System', Source.[Comment]);     
               set @myid  = CONVERT(nvarchar(255), NEWID());
               --Reset Collection to Target if 2 Sent, Notification 2 Sent and used email <> current asset email
               MERGE [ARM_CORE]..[A_CollectionItem] AS Target
                       USING (
                              select note.* from (
                                      select i.ItemID, i.CollectionID, a.Email as AssetEmail, n.Email as [NoteEmail], n.[TemplateUsed], n.[WhenSent], Row_Number() OVER(PARTITION BY i.ItemID order by [WhenSent] desc) as nr
                                      from [NotificationLog] n LEFT JOIN [ARM_CORE]..[A_CollectionItem] i on i.ItemID = n.AssetID
                                      LEFT JOIN [ARM_CORE]..[Asset] a on a.AssetID = n.AssetID
                              ) as note where note.nr = 1 and note.CollectionID = 77 and note.[TemplateUsed] = 'Tombstone Warning 2.htm' and IsNull(note.AssetEmail,'') <> note.NoteEmail
                       ) As Source
                       ON (Target.ItemID = Source.ItemID and Target.CollectionID = Source.CollectionID )
                       WHEN MATCHED THEN
                              UPDATE SET Target.[TaggedOn] = getdate(), Target.[CollectionID] = @CollectionID, Target.[TransactionID] = @myid;
               --Adds Comment for any changed.
               MERGE [ARM_CORE]..[A_CommentLog] AS Target
                       USING (
                              select i.ItemID, 'Tombstone: Reset from Step 2 to Target' as [Comment], i.[TaggedOn] from [ARM_CORE]..[A_CollectionItem] i where i.[TransactionID] = @myid
                       ) As Source
                       ON (Target.RecordID = Source.ItemID and Target.[Comment] = Source.[Comment] and target.[TimeStamp] = Source.[TaggedOn] )
                       WHEN NOT MATCHED BY TARGET THEN
                              INSERT ([Table],[Type],[recordID],[Author],[Comment]) 
                              VALUES ('Asset','System',Source.ItemID, 'System', Source.[Comment]);     
        END
 
 
 
 
 
--      OUTPUT $action, inserted.*, deleted.*;
--      ROLLBACK TRAN;
END
 
 

GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[TEST-REPORTME]
@AppID nvarchar(255)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;



  select ApplicationID AS AppUniqPreStop from [ARM_CORE].[dbo].[AppUniqPreStop] where ApplicationID like '%' + @AppID + '%'

  select ApplicationID AS TransformAppStop from [ARM_CORE].[dbo].[TransformAppStop] where ApplicationID like '%' + @AppID + '%'



  select distinct ApplicationID AS AsIs from [ARM_CORE].[dbo].[AppAstAsIs] where ApplicationID like '%' + @AppID + '%'

  select ApplicationID AS Application from [ARM_CORE].[dbo].[Application] where ApplicationID like '%' + @AppID + '%'

  select [As Is] AS [TransformAppMAP-AsIs], [To Be] AS [TransformAppMAP-ToBe] from [ARM_CORE].[dbo].[TransformAppMAP] where [As Is] like '%' + @AppID + '%'



select distinct ApplicationID AS ToBe from [ARM_CORE].[dbo].[AppAstToBe] where ApplicationID like '%' + @AppID + '%'

END




GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Task_new] 
	@GroupName nvarchar(255) = 'Your Tasks',
	@ItemID nvarchar(255) = '',
	@ItemType nvarchar(255) = '',
	@UserID nvarchar(255) = '',
	@ActionID int = 0,
	@primeCollectionID int = 0,
	@ConditionID int = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

--	DECLARE @ConditionID int

	-- Check to see if ActionID exists
	IF EXISTS (SELECT * FROM [ARM_CORE]..[A_TaskAction] WHERE ActionID = @ActionID or @ActionID = -1)
	BEGIN
	--do what you need if exists
--		SELECT @ConditionID = ConditionCollectionID FROM [ARM_CORE]..[A_TaskAction] WHERE ActionID = @ActionID

		if @itemID <> '' and @itemtype <> '' and @userID <> '' and @ActionID <> '' 
		BEGIN

			MERGE [ARM_CORE]..[A_Task] as Target using ( 
 				select  @ActionID as [ActionID], @GroupName as [Group], @ItemID as [ItemID], @ItemType as [ItemType], @UserID as [UserID], @ConditionID as ConditionID
			 ) as Source 
			 ON (target.[ItemID] = source.[ItemID] and target.[ItemType] = source.[ItemType] and target.[UserID] = source.[UserID] and target.[ActionID] = source.[ActionID] and IsNull(target.[End],'1900-01-01') = '1900-01-01') 
			 WHEN NOT MATCHED BY TARGET THEN  
 				insert ([Group], [ItemID], [Itemtype], [UserID], [ActionID], [ConditionCollectionID]) Values (Source.[Group], Source.[ItemID], Source.[Itemtype], Source.[UserID], Source.[ActionID], Source.[ConditionID]);

			if @primeCollectionID <> 0
				EXEC [ARM_CORE]..[AddToCollection] '', @itemID, @primeCollectionID, 1 
		END

	END
END

GO
-- =============================================
-- Author:		<Author,,Name>
-- ALTER date: <ALTER Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[TargetAddList]
 @Workstream int = 0,
 @AssetList nvarchar(MAX)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

declare @CollectionID int
declare @MyAssetList nvarchar(MAX)

set @MyAssetList = replace(@AssetList,'''''','''')
set @CollectionID = (select c.CollectionID from A_CollectionClass cc LEFT JOIN A_Collection c on c.CollectionClassID = cc.CollectionClassID where cc.WorkstreamID = @Workstream and c.[Name] = 'Targetted')

if @Workstream > 0 and NOT @CollectionID IS NULL
	MERGE [ARM_CORE]..[A_CollectionItem] AS Target
		USING (select AssetID, @CollectionID as CollectionID from [ARM_CORE]..[Asset] where AssetID in  (@MyAssetList)) As Source
		ON (Target.ItemID = Source.AssetID and Target.CollectionID = Source.CollectionID )
		WHEN NOT MATCHED THEN
			INSERT (ItemID, CollectionID) values (Source.AssetID, Source.CollectionID);


END

GO
-- =============================================
-- Author:           <Author,,Name>
-- Create date: <Create Date,,>
-- Description:      <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SYS-WriteToCSV]
       -- Add the parameters for the stored procedure here
       @SQL NVARCHAR(4000),
       @Filename NVARCHAR(255)
AS
BEGIN
       -- SET NOCOUNT ON added to prevent extra result sets from
       -- interfering with SELECT statements.
       SET NOCOUNT ON;


       DECLARE @eSQL NVARCHAR(4000)
       SET @eSQL = 'bcp "' + @SQL + '" queryout "' + @Filename + '" -t, -c -T'
       EXEC MASTER..XP_CMDSHELL @eSQL

END



GO
-- =============================================
CREATE PROCEDURE [dbo].[SYS-Trans-R-LOOKUPS]
	-- Add the parameters for the stored procedure here
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	delete from [ARM_CORE]..[A_Lookup]

	EXEC [ARM_CORE]..[INITIALISE-Lookups]

	MERGE [ARM_CORE]..[A_Lookup] AS Target
	using (
		select [Table],[Column],[Lookup],[Description],[Label],[Order] from [TMP_RAW_SYS_LOOKUPS]
	) as SOURCE
	ON (Target.[Table] = SOURCE.[Table] and Target.[Column] = SOURCE.[Column] and Target.[Lookup] = SOURCE.[Lookup] )
		WHEN NOT MATCHED BY TARGET THEN
			insert ([Table],[Column],[Lookup],[Description],[Label],[Order]) 
			values (SOURCE.[Table], SOURCE.[Column], SOURCE.[Lookup], SOURCE.[Description], SOURCE.[Label], SOURCE.[Order]);
END
GO
CREATE PROCEDURE [dbo].[SYSTEM-Trackers]
AS
BEGIN

-- Looks for all CollectionClass that have the [tracker] field set to 1 and records the values of all its Collections.



	MERGE [ARM_CORE]..[A_ReportData] as TARGET
	USING ( 
			select co.Name as [ReportName], co.CollectionClassID, o.[Name] as [ReportField], IsNull(v.[Total],0) as Total, CAST( GETDATE() AS Date ) as [ReportDate], o.[Order] as [ReportFieldOrder]
			from ARM_CORE..A_CollectionClass co
			LEFT JOIN ARM_CORE..A_Collection o on co.CollectionClassID = o.CollectionClassID
			LEFT JOIN (
				SELECT  c.CollectionClassID, c.[Name], count(i.ItemID) as Total 
				from ARM_CORE..A_CollectionClass cc 
				left join ARM_CORE..A_Collection c on c.CollectionClassID = cc.CollectionClassID
				left join ARM_CORE..A_CollectionItem i on i.CollectionID = c.CollectionID
				where IsNull(cc.Tracker,0) = 1
				group by c.CollectionClassID, c.[Name], c.[Order] 
			) v on v.CollectionClassID = co.CollectionClassID and v.[Name] = o.[Name] 
			where IsNull(co.Tracker,0) = 1		
	) as SOURCE
	On (TARGET.[ReportName] = SOURCE.[ReportName] and TARGET.[ReportField] = Source.[ReportField] and TARGET.[ReportDate] = Source.[ReportDate]) 
	WHEN NOT MATCHED THEN
		INSERT (ReportName, ReportField, ReportValue, ReportDate, ReportFieldOrder) VALUES (SOURCE.[ReportName],SOURCE.[ReportField],SOURCE.[Total], SOURCE.[ReportDate], SOURCE.[ReportFieldOrder]);



END

GO
CREATE PROCEDURE  [dbo].[SYSTEM-Setup]
        @myVal int = NULL
AS
BEGIN
        SET NOCOUNT ON;
        if @myVal = -1 
        BEGIN
               delete from [ARM_CORE]..[A_SiteProperties]
               delete from [ARM_CORE]..[A_User]
               delete from [ARM_CORE]..[BArea]
               delete from [ARM_CORE]..[ScheduleChannel]
               delete from [ARM_CORE]..[ScheduleTimeTemplate]
               delete from [ARM_CORE]..[ScheduleTimeTemplateSlot]
               delete from [ARM_CORE]..[A_Collection]
               delete from [ARM_CORE]..[Transform]
               delete from [ARM_CORE]..[A_Lookup]
               delete from [ARM_CORE]..[A_TableEdit]
               delete from [ARM_CORE]..[A_TablePermit]
               delete from [ARM_CORE]..[AssetCustomTab]
               delete from [ARM_CORE]..[ScheduleSlot]
        END
--      insert [ARM_CORE]..[A_SiteProperties] values (NULL,'5.0','Y',NULL,0,0,0,NULL,NULL);
        insert [ARM_CORE]..[A_SiteProperties] values ('5.0',getdate(),'C:\ARMS\arm-wwwroot\','C:\ARMS\RawData\',getdate(),1,NULL,NULL,NULL,NULL,NULL,NULL,NULL);
        TRUNCATE TABLE  [ARM_CORE]..[A_Role]
        set IDENTITY_INSERT  [ARM_CORE]..[A_Role] ON
        insert [ARM_CORE]..[A_Role] ( [RoleID] ,[Name] ,[Rank] ) values ( 0 , 'Anon' , 0)
        insert [ARM_CORE]..[A_Role] ( [RoleID] ,[Name] ,[Rank] ) values ( 1 , 'User' , 20)
        insert [ARM_CORE]..[A_Role] ( [RoleID] ,[Name] ,[Rank] ) values ( 3 , 'Team' , 40)
        insert [ARM_CORE]..[A_Role] ( [RoleID] ,[Name] ,[Rank] ) values ( 4 , 'Editor' , 50)
        insert [ARM_CORE]..[A_Role] ( [RoleID] ,[Name] ,[Rank] ) values ( 5 , 'Administrator' , 60)
        insert [ARM_CORE]..[A_Role] ( [RoleID] ,[Name] ,[Rank] ) values ( 6 , 'Developer' , 100)
        set IDENTITY_INSERT  [ARM_CORE]..[A_Role] OFF
        insert [ARM_CORE]..[A_User] (Auth_User,BArea,Requested,Granted,Name,Note) 
               values(Convert(varchar(255),SERVERPROPERTY('MachineName'))+'\ARM_IUSR', '%', getdate(), 1, 'INTERNAL USER', '')
        insert [ARM_CORE]..[A_User] (Auth_User,BArea,Requested,Granted,InternalUse,IssueEditor, SlotEditor, SlotViewer, Survey, AppEditor, BookingEditor, NotificationEditor, ResourceEditor, UserAdmin,SySAdmin,Name,Note,Actor,RoleID, MaxRoleID) 
               values(ORIGINAL_LOGIN(), '%', getdate(), 1,1,1,1,1,1,1,1,1,1,1,1, 'INTERNAL USER', '',1,6,6)
               
        insert [ARM_CORE]..[BArea] (BArea,DeploymentOrder,Internal) values('TEST',NULL,0);
        insert [ARM_CORE]..[BArea] (BArea,DeploymentOrder,Internal) values('SWAPPED OUT',NULL,1);
        insert [ARM_CORE]..[BArea] (BArea,DeploymentOrder,Internal) values('STOCK',NULL,1);
        EXEC [ARM_CORE]..[NewWorkstream] 'PC Refresh'
 
 
        insert [ARM_CORE]..[ScheduleTimeTemplate] (Name,Note) values('30 minute hand over slots (1)', NULL);
        set @myVal = @@IDENTITY;
        insert [ARM_CORE]..[ScheduleTimeTemplateSlot] (TemplateID,Label,MaxBookings,Active,Duration) values (@myVal,      '09:00',       1,        1,      30)
        insert [ARM_CORE]..[ScheduleTimeTemplateSlot] (TemplateID,Label,MaxBookings,Active,Duration) values (@myVal,      '09:30',       1,        1,      30)
        insert [ARM_CORE]..[ScheduleTimeTemplateSlot] (TemplateID,Label,MaxBookings,Active,Duration) values (@myVal,      '10:00',       1,        1,      30)
        insert [ARM_CORE]..[ScheduleTimeTemplateSlot] (TemplateID,Label,MaxBookings,Active,Duration) values (@myVal,      '10:30',       1,        1,      30)
        insert [ARM_CORE]..[ScheduleTimeTemplateSlot] (TemplateID,Label,MaxBookings,Active,Duration) values (@myVal,      '11:00',       1,        1,      30)
        insert [ARM_CORE]..[ScheduleTimeTemplateSlot] (TemplateID,Label,MaxBookings,Active,Duration) values (@myVal,      '11:30',       1,        1,      30)
        insert [ARM_CORE]..[ScheduleTimeTemplateSlot] (TemplateID,Label,MaxBookings,Active,Duration) values (@myVal,      '12:00',       1,        1,      30)
        insert [ARM_CORE]..[ScheduleTimeTemplateSlot] (TemplateID,Label,MaxBookings,Active,Duration) values (@myVal,      '12:30',       1,        0,      30)
        insert [ARM_CORE]..[ScheduleTimeTemplateSlot] (TemplateID,Label,MaxBookings,Active,Duration) values (@myVal,      '13:00',       1,        1,      30)
        insert [ARM_CORE]..[ScheduleTimeTemplateSlot] (TemplateID,Label,MaxBookings,Active,Duration) values (@myVal,      '13:30',       1,        1,      30)
        insert [ARM_CORE]..[ScheduleTimeTemplateSlot] (TemplateID,Label,MaxBookings,Active,Duration) values (@myVal,      '14:00',       1,        1,      30)
        insert [ARM_CORE]..[ScheduleTimeTemplateSlot] (TemplateID,Label,MaxBookings,Active,Duration) values (@myVal,      '14:30',       1,        1,      30)
        insert [ARM_CORE]..[ScheduleTimeTemplateSlot] (TemplateID,Label,MaxBookings,Active,Duration) values (@myVal,      '15:00',       1,        1,      30)
        insert [ARM_CORE]..[ScheduleTimeTemplateSlot] (TemplateID,Label,MaxBookings,Active,Duration) values (@myVal,      '15:30',       1,        1,      30)
        insert [ARM_CORE]..[ScheduleTimeTemplate] (Name,Note) values('10:00 & 14:00 2 Hour Slots (10)', NULL)
        set @myVal = @@IDENTITY;
        insert [ARM_CORE]..[ScheduleTimeTemplateSlot] (TemplateID,Label,MaxBookings,Active,Duration) values (@myVal,      '10:00',       10,        1,      120)
        insert [ARM_CORE]..[ScheduleTimeTemplateSlot] (TemplateID,Label,MaxBookings,Active,Duration) values (@myVal,      '14:00',       10,        1,      120)
        set Identity_Insert A_Collection On
        Insert [ARM_CORE]..[A_Collection] (CollectionID, [Name], [Order], [Type])  Values(1,'Live',1,'Internal')
        Set Identity_Insert A_Collection Off
--      set Identity_Insert AssetFlag On
--      Insert AssetFlag (FlagID, Name, [Type])  Values(2,'Deployed','System')
--      Insert AssetFlag (FlagID, Name, [Type])  Values(3,'Deferred','System')
--      Insert AssetFlag (FlagID, Name, [Type])  Values(4,'Confirmed','System')
--      Insert AssetFlag (FlagID, Name, [Type])  Values(5,'Ready','System')
--      Insert AssetFlag (FlagID, Name, [Type])  Values(6,'Found','System')
--      Insert AssetFlag (FlagID, Name, [Type])  Values(7,'Not Found','System')
--      Insert AssetFlag (FlagID, Name, [Type])  Values(8,'In Progress','System')
--      Insert AssetFlag (FlagID, Name, [Type])  Values(9,'Has Issues','System')
--      Insert AssetFlag (FlagID, Name, [Type])  Values(10,'Frozen','System')
--      Set Identity_Insert AssetFlag Off
 
--      insert [ARM_CORE]..[Transform] ([FileName],[TempLabel],[Order],[Active],[SkipFirstLine],[SQL]) values ('SYS_R_LOOKUPS.txt','SYS_LOOKUPS',1,1,1,'EXEC [ARM_CORE]..[SYS-Trans-R-LOOKUPS]')
--      insert [ARM_CORE]..[Transform] ([FileName],[TempLabel],[Order],[Active],[SkipFirstLine],[SQL]) values ('SYS_R_STOPLIST.txt','SYS_STOPLIST',2,1,1,'EXEC [ARM_CORE]..[SYS-Trans-R-STOPLIST]')
--      insert [ARM_CORE]..[Transform] ([FileName],[TempLabel],[Order],[Active],[SkipFirstLine],[SQL]) values ('SYS_R_GAUGES.txt','SYS_GAUGES',3,1,1,'EXEC [ARM_CORE]..[SYS-Trans-R-GAUGES]')
--      insert [ARM_CORE]..[Transform] ([FileName],[TempLabel],[Order],[Active],[SkipFirstLine],[SQL]) values ('SYS_M_BAREAS.txt','SYS_BAREAS',2,1,1,'EXEC [ARM_CORE]..[SYS-Trans-M-BAREAS]')
--      insert [ARM_CORE]..[Transform] ([FileName],[TempLabel],[Order],[Active],[SkipFirstLine],[SQL]) values ('SYS_M_CHANNELS.txt','SYS_TMP_CHANNELS',2,1,1,'EXEC [ARM_CORE]..[SYS-Trans-M-CHANNELS]')
        insert [ARM_CORE]..[Transform] ([FileName],[TempLabel],[Order],[Active],[SkipFirstLine],[SQL]) values ('APEL_SCCM_2012_All_installed_Software_Report.txt','AssetApps12',500,0,0,'')
        insert [ARM_CORE]..[Transform] ([FileName],[TempLabel],[Order],[Active],[SkipFirstLine],[SQL]) values ('ARM_Data_Feed.csv','2012ArmDataFeed',90,0,1,'EXEC [ARM_CUSTOM]..[CUSTOM-Trans-AssetUpload]')
 
 
        EXEC [ARM_CORE]..[SYSTEM-Initialise-Lookups]
        EXEC [ARM_CORE]..[SYSTEM-Initialise-Menu]                   -- File, FileAccess, Menu, MenuAccess
        EXEC [ARM_CORE]..[SYSTEM-Initialise-TablePermit]     -- TablePermit, TableEdit
               
        EXEC [ARM_CORE]..[SYS_PrimeSlotIDs] 365
        DECLARE @CCID INT;
        DECLARE @CID INT;
        DECLARE @CID1 INT;
        DECLARE @CID2 INT;
        insert [ARM_CORE]..[A_CollectionClass] ( [Name] ,[Description] ,[Distinct] ,[Status] ,[WorkstreamID] ) values ( 'Tombstone' , NULL , 1 , 0 , NULL)
        Set @CCID = @@IDENTITY;
        insert [ARM_CORE]..[A_Collection] ( [Name] ,[Order] ,[Auth_User] ,[Visible] ,[Type] ,[Marker] ,[CollectionClassID] ,[Colour] ,[Locked] ) values ( 'Target' , 10 , NULL , NULL , 'Asset' , 0 , @CCID , 'warning' , 1)
        insert [ARM_CORE]..[A_Collection] ( [Name] ,[Order] ,[Auth_User] ,[Visible] ,[Type] ,[Marker] ,[CollectionClassID] ,[Colour] ,[Locked] ) values ( '1 Sent' , 20 , NULL , NULL , 'Asset' , 0 , @CCID , 'warning' , 1)
        insert [ARM_CORE]..[A_Collection] ( [Name] ,[Order] ,[Auth_User] ,[Visible] ,[Type] ,[Marker] ,[CollectionClassID] ,[Colour] ,[Locked] ) values ( '2 Sent' , 30 , NULL , NULL , 'Asset' , 0 , @CCID , 'warning' , 1)
        insert [ARM_CORE]..[A_Collection] ( [Name] ,[Order] ,[Auth_User] ,[Visible] ,[Type] ,[Marker] ,[CollectionClassID] ,[Colour] ,[Locked] ) values ( '3 Sent' , 40 , NULL , NULL , 'Asset' , 0 , @CCID , 'warning' , 1)
        insert [ARM_CORE]..[A_Collection] ( [Name] ,[Order] ,[Auth_User] ,[Visible] ,[Type] ,[Marker] ,[CollectionClassID] ,[Colour] ,[Locked] ) values ( 'No Email' , 100 , NULL , NULL , 'Asset' , 0 , @CCID , 'warning' , 1)   
        Set @CID1 = @@IDENTITY;
        insert [ARM_CORE]..[A_Collection] ( [Name] ,[Order] ,[Auth_User] ,[Visible] ,[Type] ,[Marker] ,[CollectionClassID] ,[Colour] ,[Locked] ) values ( 'Death Row' , 500 , NULL , NULL , 'Asset' , 0 , @CCID , 'warning' , 1)
        insert [ARM_CORE]..[A_Collection] ( [Name] ,[Order] ,[Auth_User] ,[Visible] ,[Type] ,[Marker] ,[CollectionClassID] ,[Colour] ,[Locked] ) values ( 'Exempt' , 1000 , NULL , NULL , 'Asset' , 0 , @CCID , 'warning' , 1)
        Set @CID2 = @@IDENTITY;
        update [ARM_CORE]..[A_SiteProperties] set TombstoneExempt = @CID2, TombstoneNoEmail = @CID1
        TRUNCATE TABLE  [ARM_CORE]..[A_MenuGroup]
        set IDENTITY_INSERT  [ARM_CORE]..[A_MenuGroup] ON
 
        insert [ARM_CORE]..[A_MenuGroup] ( [MenuGroupID] ,[Name] ) values ( 100 , 'ApplicationMapping')
        insert [ARM_CORE]..[A_MenuGroup] ( [MenuGroupID] ,[Name] ) values ( 101 , 'WhatIf')
        insert [ARM_CORE]..[A_MenuGroup] ( [MenuGroupID] ,[Name] ) values ( 102 , 'Application')
        insert [ARM_CORE]..[A_MenuGroup] ( [MenuGroupID] ,[Name] ) values ( 103 , 'GaugeEditor')
        insert [ARM_CORE]..[A_MenuGroup] ( [MenuGroupID] ,[Name] ) values ( 104 , 'Asset')
        insert [ARM_CORE]..[A_MenuGroup] ( [MenuGroupID] ,[Name] ) values ( 105 , 'User')
        insert [ARM_CORE]..[A_MenuGroup] ( [MenuGroupID] ,[Name] ) values ( 106 , 'Workstream')
        insert [ARM_CORE]..[A_MenuGroup] ( [MenuGroupID] ,[Name] ) values ( 107 , 'ApplicationRequest')
        set IDENTITY_INSERT [ARM_CORE]..[A_MenuGroup] OFF 
 
        TRUNCATE TABLE  [ARM_CORE]..[A_MenuGroupTab]
        set IDENTITY_INSERT  [ARM_CORE]..[A_MenuGroupTab] ON
 
        insert [ARM_CORE]..[A_MenuGroupTab] ( [MenuGroupTabID] ,[Label] ,[Link] ,[Active] ,[Order] ,[MenuGroupID] ) values ( 100 , 'Application Map' , '/Admin/ApplicationMap.asp' , 1 , '1' , 100)
        insert [ARM_CORE]..[A_MenuGroupTab] ( [MenuGroupTabID] ,[Label] ,[Link] ,[Active] ,[Order] ,[MenuGroupID] ) values ( 101 , 'New Application' , '/Admin/Edit.asp' , 1 , '10' , 100)
        insert [ARM_CORE]..[A_MenuGroupTab] ( [MenuGroupTabID] ,[Label] ,[Link] ,[Active] ,[Order] ,[MenuGroupID] ) values ( 102 , 'Stop List' , '/Admin/ApplicationStop.asp' , 1 , '20' , 100)
        insert [ARM_CORE]..[A_MenuGroupTab] ( [MenuGroupTabID] ,[Label] ,[Link] ,[Active] ,[Order] ,[MenuGroupID] ) values ( 103 , 'Ready Assets' , '/Admin/WhatIfAssetList.asp' , 1 , '50' , 101)
        insert [ARM_CORE]..[A_MenuGroupTab] ( [MenuGroupTabID] ,[Label] ,[Link] ,[Active] ,[Order] ,[MenuGroupID] ) values ( 104 , 'Applications NOT Ready' , '/Admin/WhatIfAppsList.asp' , 1 , '20' , 101)
        insert [ARM_CORE]..[A_MenuGroupTab] ( [MenuGroupTabID] ,[Label] ,[Link] ,[Active] ,[Order] ,[MenuGroupID] ) values ( 105 , 'Application Console' , '/Admin/ApplicationList.asp' , 1 , '10' , 101)
        insert [ARM_CORE]..[A_MenuGroupTab] ( [MenuGroupTabID] ,[Label] ,[Link] ,[Active] ,[Order] ,[MenuGroupID] ) values ( 106 , 'Application' , '/Admin/ApplicationTab.asp' , 1 , '10' , 102)
        insert [ARM_CORE]..[A_MenuGroupTab] ( [MenuGroupTabID] ,[Label] ,[Link] ,[Active] ,[Order] ,[MenuGroupID] ) values ( 109 , 'Application Map' , '/Admin/ApplicationMap.asp' , 1 , '120' , 102)
        insert [ARM_CORE]..[A_MenuGroupTab] ( [MenuGroupTabID] ,[Label] ,[Link] ,[Active] ,[Order] ,[MenuGroupID] ) values ( 110 , 'Editor' , '/Admin/GaugeEditor.asp' , 1 , '5' , 103)
        insert [ARM_CORE]..[A_MenuGroupTab] ( [MenuGroupTabID] ,[Label] ,[Link] ,[Active] ,[Order] ,[MenuGroupID] ) values ( 111 , 'Gauge Library' , '/Admin/Gauges.asp' , 1 , '10' , 103)
        insert [ARM_CORE]..[A_MenuGroupTab] ( [MenuGroupTabID] ,[Label] ,[Link] ,[Active] ,[Order] ,[MenuGroupID] ) values ( 112 , 'Asset' , '/Admin/AssetTab.asp' , 1 , '10' , 104)
        insert [ARM_CORE]..[A_MenuGroupTab] ( [MenuGroupTabID] ,[Label] ,[Link] ,[Active] ,[Order] ,[MenuGroupID] ) values ( 114 , 'Detailed Application List' , '/Admin/AssetAsIs.asp' , 1 , '30' , 104)
        insert [ARM_CORE]..[A_MenuGroupTab] ( [MenuGroupTabID] ,[Label] ,[Link] ,[Active] ,[Order] ,[MenuGroupID] ) values ( 117 , 'Booking' , '/Booking/MakeBooking.asp' , 1 , '50' , 104)
        insert [ARM_CORE]..[A_MenuGroupTab] ( [MenuGroupTabID] ,[Label] ,[Link] ,[Active] ,[Order] ,[MenuGroupID] ) values ( 107 , 'Distribution' , '/Admin/AppsSummaryBySlice.asp' , 1 , '20' , 102)
        insert [ARM_CORE]..[A_MenuGroupTab] ( [MenuGroupTabID] ,[Label] ,[Link] ,[Active] ,[Order] ,[MenuGroupID] ) values ( 108 , 'Variants' , '/Admin/ApplicationInstances.asp' , 1 , '30' , 102)
        insert [ARM_CORE]..[A_MenuGroupTab] ( [MenuGroupTabID] ,[Label] ,[Link] ,[Active] ,[Order] ,[MenuGroupID] ) values ( 113 , 'Applications' , '/Admin/AssetApplications.asp' , 1 , '20' , 104)
        insert [ARM_CORE]..[A_MenuGroupTab] ( [MenuGroupTabID] ,[Label] ,[Link] ,[Active] ,[Order] ,[MenuGroupID] ) values ( 116 , 'Installs' , '/Admin/ApplicationAssets.asp' , 1 , '25' , 102)
        insert [ARM_CORE]..[A_MenuGroupTab] ( [MenuGroupTabID] ,[Label] ,[Link] ,[Active] ,[Order] ,[MenuGroupID] ) values ( 118 , 'Collections' , '/Admin/ItemCollections.asp' , 1 , '40' , 102)
        insert [ARM_CORE]..[A_MenuGroupTab] ( [MenuGroupTabID] ,[Label] ,[Link] ,[Active] ,[Order] ,[MenuGroupID] ) values ( 119 , 'Collections' , '/Admin/ItemCollections.asp' , 1 , '45' , 104)
        insert [ARM_CORE]..[A_MenuGroupTab] ( [MenuGroupTabID] ,[Label] ,[Link] ,[Active] ,[Order] ,[MenuGroupID] ) values ( 120 , 'User' , '/Admin/UserTab.asp' , 1 , '10' , 109)
        insert [ARM_CORE]..[A_MenuGroupTab] ( [MenuGroupTabID] ,[Label] ,[Link] ,[Active] ,[Order] ,[MenuGroupID] ) values ( 121 , 'Collections' , '/Admin/ItemCollections.asp' , 1 , '20' , 109)
        insert [ARM_CORE]..[A_MenuGroupTab] ( [MenuGroupTabID] ,[Label] ,[Link] ,[Active] ,[Order] ,[MenuGroupID] ) values ( 122 , 'Access Log' , '/Admin/AssetAccessLog.asp' , 1 , '40' , 104)
        insert [ARM_CORE]..[A_MenuGroupTab] ( [MenuGroupTabID] ,[Label] ,[Link] ,[Active] ,[Order] ,[MenuGroupID] ) values ( 123 , 'User' , '/Admin/UserTab.asp' , 1 , '1' , 105)
        insert [ARM_CORE]..[A_MenuGroupTab] ( [MenuGroupTabID] ,[Label] ,[Link] ,[Active] ,[Order] ,[MenuGroupID] ) values ( 124 , 'Collections' , '/Admin/ItemCollections.asp' , 1 , '2' , 105)
        insert [ARM_CORE]..[A_MenuGroupTab] ( [MenuGroupTabID] ,[Label] ,[Link] ,[Active] ,[Order] ,[MenuGroupID] ) values ( 125 , 'System' , '/Admin/UserSystemAccess.asp' , 1 , '3' , 105)
        insert [ARM_CORE]..[A_MenuGroupTab] ( [MenuGroupTabID] ,[Label] ,[Link] ,[Active] ,[Order] ,[MenuGroupID] ) values ( 126 , 'Asset Access Log' , '/Admin/AssetUserAccessLog.asp' , 1 , '4' , 105)
        insert [ARM_CORE]..[A_MenuGroupTab] ( [MenuGroupTabID] ,[Label] ,[Link] ,[Active] ,[Order] ,[MenuGroupID] ) values ( 127 , 'Workstream' , '/Admin/WorkstreamTab.asp' , 1 , '10' , 106)
        insert [ARM_CORE]..[A_MenuGroupTab] ( [MenuGroupTabID] ,[Label] ,[Link] ,[Active] ,[Order] ,[MenuGroupID] ) values ( 128 , 'Collections' , '/Admin/WorkstreamCollections.asp' , 1 , '20' , 106)
        insert [ARM_CORE]..[A_MenuGroupTab] ( [MenuGroupTabID] ,[Label] ,[Link] ,[Active] ,[Order] ,[MenuGroupID] ) values ( 129 , 'Schedule' , '/Admin/WorkstreamSchedule.asp' , 1 , '50' , 106)
        insert [ARM_CORE]..[A_MenuGroupTab] ( [MenuGroupTabID] ,[Label] ,[Link] ,[Active] ,[Order] ,[MenuGroupID] ) values ( 132 , 'Slot Events' , '/Admin/WorkstreamSlotEvents.asp' , 1 , '400' , 106)
        insert [ARM_CORE]..[A_MenuGroupTab] ( [MenuGroupTabID] ,[Label] ,[Link] ,[Active] ,[Order] ,[MenuGroupID] ) values ( 134 , 'Deployments' , '/Admin/WorkstreamView.asp' , 1 , '500' , 106)
        insert [ARM_CORE]..[A_MenuGroupTab] ( [MenuGroupTabID] ,[Label] ,[Link] ,[Active] ,[Order] ,[MenuGroupID] ) values ( 135 , 'Channels' , '/admin/WorkstreamChannels.asp' , 1 , '30' , 106)
        insert [ARM_CORE]..[A_MenuGroupTab] ( [MenuGroupTabID] ,[Label] ,[Link] ,[Active] ,[Order] ,[MenuGroupID] ) values ( 136 , 'Collections' , '/Admin/ItemCollections.asp' , 1 , '30' , 107)
        insert [ARM_CORE]..[A_MenuGroupTab] ( [MenuGroupTabID] ,[Label] ,[Link] ,[Active] ,[Order] ,[MenuGroupID] ) values ( 137 , 'App Request' , '/Admin/ApplicationRequestTab.asp' , 1 , '10' , 107)
        insert [ARM_CORE]..[A_MenuGroupTab] ( [MenuGroupTabID] ,[Label] ,[Link] ,[Active] ,[Order] ,[MenuGroupID] ) values ( 130 , 'Deployment By period' , '/Admin/WorkstreamDeployedByPeriod.asp' , 0 , '300' , 106)
        insert [ARM_CORE]..[A_MenuGroupTab] ( [MenuGroupTabID] ,[Label] ,[Link] ,[Active] ,[Order] ,[MenuGroupID] ) values ( 133 , 'Bookings' , '/Admin/WorkstreamBookings.asp' , 1 , '200' , 106)
        set IDENTITY_INSERT [ARM_CORE]..[A_MenuGroupTab] OFF 
 
        TRUNCATE TABLE  [ARM_CORE]..[A_MenuGroupParam]
        set IDENTITY_INSERT  [ARM_CORE]..[A_MenuGroupParam] ON
 
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 100 , 100 , 'st' , NULL)
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 101 , 100 , 'ss' , 'all')
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 102 , 100 , 'sr' , NULL)
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 103 , 100 , 'ps' , '40')
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 105 , 101 , 'Area' , NULL)
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 106 , 101 , 'Filter' , NULL)
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 107 , 101 , 'OrderBy' , NULL)
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 108 , 101 , 'R' , NULL)
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 110 , 102 , 'ID' , NULL)
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 111 , 102 , 'REF' , NULL)
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 112 , 102 , 'F_Table' , NULL)
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 113 , 102 , 'Scope' , NULL)
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 114 , 102 , 'AppKey' , NULL)
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 115 , 102 , 'AppGroupKey' , NULL)
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 116 , 102 , 'IDENTITY' , NULL)
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 124 , 104 , 'AssetID' , NULL)
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 125 , 104 , 'UserID' , NULL)
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 127 , 102 , 'ApplicationID' , NULL)
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 104 , 100 , 'ic' , ' ')
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 109 , 101 , 'showDisplay' , NULL)
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 117 , 102 , 'REFERRER' , NULL)
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 123 , 100 , 'REF' , NULL)
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 119 , 102 , 'Slice' , NULL)
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 120 , 102 , 'Internal' , NULL)
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 126 , 102 , 'OS' , NULL)
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 128 , 104 , 'ID' , NULL)
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 129 , 104 , 'REF' , NULL)
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 130 , 104 , 'IDENTITY' , NULL)
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 131 , 104 , 'MenuGroupName' , NULL)
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 132 , 105 , 'UserID' , NULL)
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 133 , 105 , 'ID' , NULL)
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 137 , 106 , 'WorkstreamID' , '')
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 138 , 106 , 'ID' , '')
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 139 , 106 , 'REF' , '')
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 141 , 106 , 'MenuGroupName' , '')
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 142 , 107 , 'ID' , '')
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 143 , 107 , 'REF' , '')
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 144 , 107 , 'IDENTITY' , '')
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 145 , 107 , 'MenuGroupName' , '')
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 134 , 105 , 'REF' , NULL)
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 135 , 105 , 'IDENTITY' , NULL)
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 136 , 105 , 'MenuGroupName' , NULL)
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 140 , 106 , 'IDENTITY' , '')
        insert [ARM_CORE]..[A_MenuGroupParam] ( [MenuGroupParamID] ,[MenuGroupID] ,[Name] ,[DefaultValue] ) values ( 146 , 107 , 'ApplicationRequestID' , '')
        set IDENTITY_INSERT [ARM_CORE]..[A_MenuGroupParam] OFF 
 
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'af' , 'Afrikaans' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'ar-ae' , 'Arabic (U.A.E.)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'ar-bh' , 'Arabic (Bahrain)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'ar-dz' , 'Arabic (Algeria)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'ar-eg' , 'Arabic (Egypt)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'ar-iq' , 'Arabic (Iraq)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'ar-jo' , 'Arabic (Jordan)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'ar-kw' , 'Arabic (Kuwait)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'ar-lb' , 'Arabic (Lebanon)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'ar-ly' , 'Arabic (Libya)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'ar-ma' , 'Arabic (Morocco)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'ar-om' , 'Arabic (Oman)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'ar-qa' , 'Arabic (Qatar)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'ar-sa' , 'Arabic (Saudi Arabia)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'ar-sy' , 'Arabic (Syria)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'ar-tn' , 'Arabic (Tunisia)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'ar-ye' , 'Arabic (Yemen)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'be' , 'Belarusian' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'bg' , 'Bulgarian' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'ca' , 'Catalan' , NULL , 0 , 'ca.xml')
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'cs' , 'Czech' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'cy' , 'Welsh' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'da' , 'Danish' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'de' , 'German (Standard)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'de-at' , 'German (Austria)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'de-ch' , 'German (Switzerland)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'de-li' , 'German (Liechtenstein)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'de-lu' , 'German (Luxembourg)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'el' , 'Greek' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'en' , 'English' , NULL , 1 , 'en.xml')
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'en-au' , 'English (Australia)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'en-bz' , 'English (Belize)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'en-ca' , 'English (Canada)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'en-gb' , 'English (United Kingdom)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'en-ie' , 'English (Ireland)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'en-jm' , 'English (Jamaica)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'en-nz' , 'English (New Zealand)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'en-tt' , 'English (Trinidad)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'en-us' , 'English (United States)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'en-za' , 'English (South Africa)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'es' , 'Spanish' , NULL , 1 , 'es.xml')
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'es-ar' , 'Spanish (Argentina)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'es-bo' , 'Spanish (Bolivia)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'es-cl' , 'Spanish (Chile)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'es-co' , 'Spanish (Colombia)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'es-cr' , 'Spanish (Costa Rica)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'es-do' , 'Spanish (Dominican Republic)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'es-ec' , 'Spanish (Ecuador)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'es-gt' , 'Spanish (Guatemala)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'es-hn' , 'Spanish (Honduras)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'es-mx' , 'Spanish (Mexico)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'es-ni' , 'Spanish (Nicaragua)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'es-pa' , 'Spanish (Panama)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'es-pe' , 'Spanish (Peru)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'es-pr' , 'Spanish (Puerto Rico)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'es-py' , 'Spanish (Paraguay)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'es-sv' , 'Spanish (El Salvador)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'es-uy' , 'Spanish (Uruguay)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'es-ve' , 'Spanish (Venezuela)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'et' , 'Estonian' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'eu' , 'Basque' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'fa' , 'Farsi' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'fi' , 'Finnish' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'fo' , 'Faeroese' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'fr' , 'French (Standard)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'fr-be' , 'French (Belgium)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'fr-ca' , 'French (Canada)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'fr-ch' , 'French (Switzerland)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'fr-lu' , 'French (Luxembourg)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'ga' , 'Irish' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'gd' , 'Gaelic (Scotland)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'he' , 'Hebrew' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'hi' , 'Hindi' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'hr' , 'Croatian' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'hu' , 'Hungarian' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'id' , 'Indonesian' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'is' , 'Icelandic' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'it' , 'Italian (Standard)' , 'flag-icon-it' , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'it-ch' , 'Italian (Switzerland)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'ja' , 'Japanese' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'ji' , 'Yiddish' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'ko' , 'Korean' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'ko' , 'Korean (Johab)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'ku' , 'Kurdish' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'lt' , 'Lithuanian' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'lv' , 'Latvian' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'mk' , 'Macedonian (FYROM)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'ml' , 'Malayalam' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'ms' , 'Malaysian' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'mt' , 'Maltese' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'nl' , 'Dutch (Standard)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'nl-be' , 'Dutch (Belgium)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'nb' , 'Norwegian (Bokm l)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'nn' , 'Norwegian (Nynorsk)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'no' , 'Norwegian' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'pa' , 'Punjabi' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'pl' , 'Polish' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'pt' , 'Portuguese (Portugal)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'pt-br' , 'Portuguese (Brazil)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'rm' , 'Rhaeto-Romanic' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'ro' , 'Romanian' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'ro-md' , 'Romanian (Republic of Moldova)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'ru' , 'Russian' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'ru-md' , 'Russian (Republic of Moldova)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'sb' , 'Sorbian' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'sk' , 'Slovak' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'sl' , 'Slovenian' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'sq' , 'Albanian' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'sr' , 'Serbian' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'sv' , 'Swedish' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'sv-fi' , 'Swedish (Finland)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'th' , 'Thai' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'tn' , 'Tswana' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'tr' , 'Turkish' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'ts' , 'Tsonga' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'uk' , 'Ukrainian' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'ur' , 'Urdu' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 've' , 'Venda' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'vi' , 'Vietnamese' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'xh' , 'Xhosa' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'zh-cn' , 'Chinese (PRC)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'zh-hk' , 'Chinese (Hong Kong)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'zh-sg' , 'Chinese (Singapore)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'zh-tw' , 'Chinese (Taiwan)' , NULL , 0 , NULL)
        insert [ARM_CORE]..[A_LanguageCode] ( [Code] ,[Language] ,[Icon] ,[Active] ,[Pack] ) values ( 'zu' , 'Zulu' , NULL , 0 , NULL)
        insert [ARM_CORE]..[BookingKeyInfo] ( [AssetType] ,[FieldName] ,[AltLabel] ,[Order] ,[HelpText] ,[Property] ,[Height] ) values ( 'Phone' , 'SerialNumber' , 'IMEI Number' , 10 , 'Open your phone app and dial: *#06#' , 'Required' , '0')
        insert [ARM_CORE]..[BookingKeyInfo] ( [AssetType] ,[FieldName] ,[AltLabel] ,[Order] ,[HelpText] ,[Property] ,[Height] ) values ( 'Phone' , 'UserID' , 'UserID' , 20 , 'i.e. UK12345' , 'Required' , '0')
        insert [ARM_CORE]..[BookingKeyInfo] ( [AssetType] ,[FieldName] ,[AltLabel] ,[Order] ,[HelpText] ,[Property] ,[Height] ) values ( 'Desktop' , 'Owner' , 'Owner' , 10 , 'The primary owner of the device' , 'Required' , '0')
        insert [ARM_CORE]..[BookingKeyInfo] ( [AssetType] ,[FieldName] ,[AltLabel] ,[Order] ,[HelpText] ,[Property] ,[Height] ) values ( 'Phone' , 'Model' , 'Handset Type' , 40 , 'If your phone type is not listed please specify in ''Additional Info'' field below' , 'Required' , NULL)
        insert [ARM_CORE]..[BookingKeyInfo] ( [AssetType] ,[FieldName] ,[AltLabel] ,[Order] ,[HelpText] ,[Property] ,[Height] ) values ( 'Phone' , 'Custom05' , 'MAC Address' , 50 , '' , 'Optional' , '0')
        insert [ARM_CORE]..[BookingKeyInfo] ( [AssetType] ,[FieldName] ,[AltLabel] ,[Order] ,[HelpText] ,[Property] ,[Height] ) values ( 'Laptop' , 'Owner' , 'Owner' , 10 , 'The primary owner of the device' , 'Required' , '0')
        insert [ARM_CORE]..[BookingKeyInfo] ( [AssetType] ,[FieldName] ,[AltLabel] ,[Order] ,[HelpText] ,[Property] ,[Height] ) values ( 'Laptop' , 'Email' , 'Email' , 20 , 'The email address of the specified owner' , 'Required' , NULL)
        insert [ARM_CORE]..[BookingKeyInfo] ( [AssetType] ,[FieldName] ,[AltLabel] ,[Order] ,[HelpText] ,[Property] ,[Height] ) values ( 'Desktop' , 'BArea' , 'Department' , 25 , 'Which Department are you from?' , 'Lookup' , '0')
        insert [ARM_CORE]..[BookingKeyInfo] ( [AssetType] ,[FieldName] ,[AltLabel] ,[Order] ,[HelpText] ,[Property] ,[Height] ) values ( 'Laptop' , 'BArea' , 'Department' , 25 , 'Which Department are you from?' , 'Required' , '0')
        insert [ARM_CORE]..[BookingKeyInfo] ( [AssetType] ,[FieldName] ,[AltLabel] ,[Order] ,[HelpText] ,[Property] ,[Height] ) values ( 'Phone' , 'Custom04' , 'Sim Card Number' , NULL , 'Go to Home screen, select Setting/About Device/Status. The SIM card # is listed under ICCID.' , '' , '0')
        insert [ARM_CORE]..[BookingKeyInfo] ( [AssetType] ,[FieldName] ,[AltLabel] ,[Order] ,[HelpText] ,[Property] ,[Height] ) values ( 'Desktop' , 'Email' , 'Email' , 20 , ' The email address of the specified owner' , 'Required' , '0')
        insert [ARM_CORE]..[BookingKeyInfo] ( [AssetType] ,[FieldName] ,[AltLabel] ,[Order] ,[HelpText] ,[Property] ,[Height] ) values ( 'Desktop' , 'Location' , 'Location' , 30 , 'An accurate location, such as Line 2 Central Meeting Area.' , 'Required' , '0')
        insert [ARM_CORE]..[Chart] ( [ChartTitle] ,[Units] ,[Type] ,[Data] ,[Options] ,[SQL] ,[Description] ,[URL] ,[Active] ,[Order] ) values ( 'Bubble Chart Example' , '4' , 'BubbleChart' , ' [''ID'', ''Life Expectancy'', ''Fertility Rate'', ''Region'', ''Population''], [''CAN'', 80.66, 1.67, ''North America'', 33739900], [''DEU'', 79.84, 1.36, ''Europe'', 81902307], [''DNK'', 78.6, 1.84, ''Europe'', 5523095], [''EGY'', 72.73, 2.78, ''Middle East'', 79716203], [''GBR'', 80.05, 2, ''Europe'', 61801570], [''IRN'', 72.49, 1.7, ''Middle East'', 73137148], [''IRQ'', 68.09, 4.77, ''Middle East'', 31090763], [''ISR'', 81.55, 2.96, ''Middle East'', 7485600], [''RUS'', 68.6, 1.54, ''Europe'', 141850000], [''USA'', 78.09, 2.05, ''North America'', 307007000]' , ' title: ''Correlation between life expectancy, fertility rate '' + ''and population of some world countries (2010)'', hAxis: {title: ''Life Expectancy''}, vAxis: {title: ''Fertility Rate''}, bubble: {textStyle: {fontSize: 11}}' , NULL , NULL , NULL , 0 , 30)
        insert [ARM_CORE]..[Chart] ( [ChartTitle] ,[Units] ,[Type] ,[Data] ,[Options] ,[SQL] ,[Description] ,[URL] ,[Active] ,[Order] ) values ( 'Line Chart Example' , '6' , 'LineChart' , ' [''Year'', ''Sales'', ''Expenses''], [''2004'', 1000, 400], [''2005'', 1170, 460], [''2006'', 660, 1120], [''2007'', 1030, 540]' , ' title: ''Company Performance'', curveType: ''function'', legend: { position: ''bottom'' }' , NULL , NULL , NULL , 0 , 30)
        insert [ARM_CORE]..[Chart] ( [ChartTitle] ,[Units] ,[Type] ,[Data] ,[Options] ,[SQL] ,[Description] ,[URL] ,[Active] ,[Order] ) values ( 'Project Status' , '4' , 'Gantt' , NULL , 'criticalPathEnabled: true, textStyle: {color: ''red'', fontSize: 16}' , 'select [Task ID], [Task Name], [Start Date], [End Date], [Duration], [Percent Complete],[Dependencies] from [ARM_CUSTOM]..[Example_GanttTask]' , 'Project Progress' , NULL , 1 , 25)
        insert [ARM_CORE]..[Chart] ( [ChartTitle] ,[Units] ,[Type] ,[Data] ,[Options] ,[SQL] ,[Description] ,[URL] ,[Active] ,[Order] ) values ( 'Candlestick Example' , '4' , 'CandlestickChart' , ' [''Mon'', 20, 28, 38, 45], [''Tue'', 31, 38, 55, 66], [''Wed'', 50, 55, 77, 80], [''Thu'', 77, 77, 66, 50], [''Fri'', 68, 66, 22, 15]' , ' legend:''none''' , NULL , NULL , NULL , 1 , 100)
        insert [ARM_CORE]..[Chart] ( [ChartTitle] ,[Units] ,[Type] ,[Data] ,[Options] ,[SQL] ,[Description] ,[URL] ,[Active] ,[Order] ) values ( 'Sankey Example' , '3' , 'Sankey' , '[''From'',''To'',''Weight''], [ ''A'', ''X'', 5 ], [ ''A'', ''Y'', 7 ], [ ''A'', ''Z'', 6 ], [ ''B'', ''X'', 2 ], [ ''B'', ''Y'', 9 ], [ ''B'', ''Z'', 4 ]' , NULL , NULL , NULL , NULL , 0 , 120)
        insert [ARM_CORE]..[Chart] ( [ChartTitle] ,[Units] ,[Type] ,[Data] ,[Options] ,[SQL] ,[Description] ,[URL] ,[Active] ,[Order] ) values ( 'Timeline Example' , '4' , 'Timeline' , '[''President'',''Start'',''End''], [ ''Washington'', new Date(1789, 3, 30), new Date(1797, 2, 4) ], [ ''Adams'', new Date(1797, 2, 4), new Date(1801, 2, 4) ], [ ''Jefferson'', new Date(1801, 2, 4), new Date(1809, 2, 4) ]' , NULL , NULL , NULL , NULL , 1 , 110)
        insert [ARM_CORE]..[Chart] ( [ChartTitle] ,[Units] ,[Type] ,[Data] ,[Options] ,[SQL] ,[Description] ,[URL] ,[Active] ,[Order] ) values ( 'Org Chart Example' , '3' , 'OrgChart' , '[''Name'',''Manager'',''ToolTip''], [''Mike'','''', ''The President''], [''Jim'',''Mike'', ''VP''], [''Alice'', ''Mike'', ''''], [''Bob'', ''Jim'', ''Bob Sponge''], [''Carol'', ''Bob'', '''']' , 'allowCollapse:true' , NULL , NULL , NULL , 0 , 130)
        insert [ARM_CORE]..[Chart] ( [ChartTitle] ,[Units] ,[Type] ,[Data] ,[Options] ,[SQL] ,[Description] ,[URL] ,[Active] ,[Order] ) values ( 'Table Example' , '3' , 'Table' , '[''Name'',''Salary'',''Full Time Employee''], [''Mike'', {v: 10000, f: ''$10,000''}, true], [''Jim'', {v:8000, f: ''$8,000''}, false], [''Alice'', {v: 12500, f: ''$12,500''}, true], [''Bob'', {v: 7000, f: ''$7,000''}, true]' , 'showRowNumber: true, width: ''100%'', height: ''100%''' , NULL , NULL , NULL , 1 , 150)
        insert [ARM_CORE]..[Chart] ( [ChartTitle] ,[Units] ,[Type] ,[Data] ,[Options] ,[SQL] ,[Description] ,[URL] ,[Active] ,[Order] ) values ( 'Progress' , '4' , 'BarChart' , '' , 'legend: {position: ''top'', maxLines: 3}, bar: { groupWidth: ''100%'' }, isStacked: true' , 'EXEC [WS-KeyStatus] 16' , '' , '' , 0 , 0)
        insert [ARM_CORE]..[Chart] ( [ChartTitle] ,[Units] ,[Type] ,[Data] ,[Options] ,[SQL] ,[Description] ,[URL] ,[Active] ,[Order] ) values ( 'Maturity Matrix' , '4' , 'Gauge' , '' , 'min: 0, max: 5, greenFrom: 3, greenTo: 5, yellowFrom: 2, yellowTo: 3, redFrom: 0, redTo: 2' , 'select 2 as Total' , 'Based on 42 Indicators for NE maturity' , '' , 0 , 0)
        insert [ARM_CORE]..[Chart] ( [ChartTitle] ,[Units] ,[Type] ,[Data] ,[Options] ,[SQL] ,[Description] ,[URL] ,[Active] ,[Order] ) values ( 'By Region' , '4' , 'GeoChart' , ' [''Country'', ''Assets''], [''GB'', 416], [''Spain'', 308], [''Finland'', 6], [''Russia'', 69], [''Switzerland'', 44]' , 'region: ''150'', backgroundColor: ''#81d4fa'', datalessRegionColor: ''#f8bbd0'', colorAxis: {colors: [''yellow'', ''orange'', ''red'']}, ' , '' , 'Deployments for each country' , '/views/default.asp?ID=19' , 1 , 0)
        insert [ARM_CORE]..[Chart] ( [ChartTitle] ,[Units] ,[Type] ,[Data] ,[Options] ,[SQL] ,[Description] ,[URL] ,[Active] ,[Order] ) values ( 'Histogram Example' , '3' , 'Histogram' , '[''Dinosaur'', ''Length''], [''Acrocanthosaurus (top-spined lizard)'', 12.2], [''Albertosaurus (Alberta lizard)'', 9.1], [''Allosaurus (other lizard)'', 12.2], [''Apatosaurus (deceptive lizard)'', 22.9], [''Archaeopteryx (ancient wing)'', 0.9], [''Argentinosaurus (Argentina lizard)'', 36.6], [''Baryonyx (heavy claws)'', 9.1], [''Brachiosaurus (arm lizard)'', 30.5], [''Ceratosaurus (horned lizard)'', 6.1], [''Coelophysis (hollow form)'', 2.7], [''Compsognathus (elegant jaw)'', 0.9], [''Deinonychus (terrible claw)'', 2.7], [''Diplodocus (double beam)'', 27.1], [''Dromicelomimus (emu mimic)'', 3.4], [''Gallimimus (fowl mimic)'', 5.5], [''Mamenchisaurus (Mamenchi lizard)'', 21.0], [''Megalosaurus (big lizard)'', 7.9], [''Microvenator (small hunter)'', 1.2], [''Ornithomimus (bird mimic)'', 4.6], [''Oviraptor (egg robber)'', 1.5], [''Plateosaurus (flat lizard)'', 7.9], [''Sauronithoides (narrow-clawed lizard)'', 2.0], [''Seismosaurus (tremor lizard)'', 45.7], [''Spinosaurus (spiny lizard)'', 12.2], [''Supersaurus (super lizard)'', 30.5], [''Tyrannosaurus (tyrant lizard)'', 15.2], [''Ultrasaurus (ultra lizard)'', 30.5], [''Velociraptor (swift robber)'', 1.8]' , 'title: ''Lengths of dinosaurs, in meters'', legend: { position: ''none'' },' , NULL , NULL , NULL , 0 , 140)
 
END

GO
CREATE PROCEDURE [dbo].[zSYSTEM-Reporting]	
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	
	EXEC [ARM_CORE]..[zSYSTEM-Trackers]


--		IF object_id('[ARM_CUSTOM]..[TMP_RAW_AssetApps12]','U') is not null 
--			drop TABLE [ARM_CUSTOM]..[TMP_RAW_AssetApps12]

--		SELECT [AssetID]
--			,[NULL1]
--			,[AppName]
--			,[AppVersion]
--			,[NULL4]
--		INTO [ARM_CUSTOM]..[TMP_RAW_AssetApps12]
--		FROM [CORE]..[TMP_RAW_AssetApps12]

--		IF object_id('[ARM_CUSTOM]..[TMP_RAW_AssetApps]','U') is not null 
--			drop TABLE [ARM_CUSTOM]..[TMP_RAW_AssetApps]

--		SELECT [AssetID]
--			,[NULL1]
--			,[AppName]
--			,[AppVersion]
--			,[NULL4]
--		INTO [ARM_CUSTOM]..[TMP_RAW_AssetApps]
--		FROM [CORE].[dbo].[TMP_RAW_AssetApps]

--		EXEC [ARM_CUSTOM]..[Trans-AssetAppsUpload-ASTELLAS]

	IF DATEPART(dw,getdate())  = 6 --i.e. Friday
	-- Enter Once a Week Reports Here	
	BEGIN
		--Application Count
		insert A_ReportData (ReportName, ReportValue, ReportDate)
		SELECT 'Application Instances' as ReportName, count (distinct([ApplicationID])) as ReportValue, getdate() as ReportDate
		FROM [ARM_CORE].[dbo].[AppAstToBe];

		--Live Assets
		insert A_ReportData (ReportName, ReportValue, ReportDate)
		--Updated Oct 2018 - includes more assets
		select 'Live Assets' as ReportName,100*c.ANLive/(c.ALive+c.ANLive) as Percentage,getdate() as ReportDate from
		--Caclulate the Two Values
		(Select
			(Select Count([AssetID]) FROM [arm_Core].[dbo].[Asset] where len(AssetID) = 10 and SUBSTRING(assetid,3,1) in ('L','U','M','D','W') and live=0) as ALive,
			(Select Count([AssetID]) FROM [arm_Core].[dbo].[Asset] where len(AssetID) = 10 and SUBSTRING(assetid,3,1) in ('L','U','M','D','W') and live=1) as ANLive
		) as C
	END


--	IF DATEPART(dw,getdate())  = 4 --i.e. Wednesday
	-- Enter Once a Week Reports Here	
--	BEGIN
		
--		 EXEC [ARM_CORE]..[SYSTEM-Trackers]

--	END



	-- Snap shot responses for Checklists that are Active and have WeeklySnapShot flag set to 1.  data used in Summary3 (response over time) summary
	IF DATEPART(dw,getdate())  = 2 --i.e. Monday
	-- Enter Once a Week Reports Here	
	BEGIN
		MERGE [ARM_CORE]..[CheckListSnapShot] AS Target using (select * from [CheckListResponse] where CheckListID in (select CheckListID from [ARM_CORE]..[CheckList] where Active=1 and WeeklySnapShot = 1)) as SOURCE 
		ON (Target.[itemID] = SOURCE.[ItemID] and Target.[Area] = SOURCE.[Area] and DateDiff(day,TARGET.[Timestamp],getdate()) = 0  )
		WHEN NOT MATCHED BY TARGET THEN 
		insert ([ItemID], [Value], [Area], [AuthUser], [CheckListID]) values (SOURCE.[ItemID], SOURCE.[Value], SOURCE.[Area], SOURCE.[AuthUser], SOURCE.[ChecklistID]) ;

--		insert into [ARM_CORE].[dbo].[A_ReportData] ([ReportName],[ReportValue],[ReportDate])

		MERGE [ARM_CORE]..[A_ReportData] AS Target using (
			select sc.Name+'-Actual' as [ReportName], count(s.itemid) as [ReportValue], getdate() as [ReportDate]
			from ARM_CORE..A_CollectionItem s
			left Join ARM_CORE..A_Collection sc on sc.CollectionID = s.CollectionID
			left join ARM_CORE..A_CollectionItem i on i.ItemID=s.ItemID
			left join ARM_CORE..A_Collection c on c.CollectionID=i.CollectionID
			where sc.CollectionClassID =30 and sc.EndState <> 1 and c.CollectionClassID = 5 and c.EndState <> 1
			group by sc.Name+'-Actual'
		) as SOURCE
		ON (Target.[ReportName] = SOURCE.[ReportName] and Target.[ReportValue] = SOURCE.[ReportValue] and DateDiff(day,TARGET.[ReportDate],getdate()) = 0  )
		WHEN NOT MATCHED BY TARGET THEN 
		insert ([ReportName], [ReportValue], [ReportDate]) values (SOURCE.[ReportName], SOURCE.[ReportValue], SOURCE.[ReportDate]) ;




	-- Count number of assets in scope 
--		insert [ARM_CUSTOM]..[ReportData] (	[Type],[30],[60],[90] )
--		select t.[Type],
--		sum(CASE WHEN t.heartbeat >= GETDATE()-30 THEN 1 ELSE 0 END) as [30],
--		sum(CASE WHEN t.heartbeat >= GETDATE()-60 THEN 1 ELSE 0 END) as [60],
--		sum(CASE WHEN t.heartbeat >= GETDATE()-90 THEN 1 ELSE 0 END) as [90]
--		from (
--			select x.[Type], x.[heartbeat], row_number() OVER ( PARTITION BY x.[SerialNumber] ORDER BY x.[SerialNumber], x.heartbeat DESC) AS dc
--			from [ARM_CORE]..[Asset] x
--			LEFT JOIN [ARM_CORE]..[BArea] b on b.BArea = x.BArea
--			where IsNull(b.Internal,0) = 0 and NOT x.Model in ('X270','X280','X290')
--		) as t
--		where t.dc = 1 
--		group by t.[Type];
	END


	--ELSE
	-- Enter Everyday reports
END


GO
CREATE PROCEDURE [dbo].[zSYSTEM-ManageBitCollections]
AS
BEGIN

-- Modes are as follows
--  0 - MERGE & PURGE  (keep only those items that are listed by qualifying SQL)
--  1 - MERGE NO PURGE  (add new items identified but retain items already captured)
--  2 - NEW TO CLASS ONLY & PURGE

-- TEMPORARY INCLUDE : ReRun stoplist, ReApplyAppTransforms and re count installs for As Is
	SET NOCOUNT ON;

if 1=2 
BEGIN
	delete i
	from [ARM_CORE]..[AppAstAsIs] I
	LEFT JOIN [ARM_CORE]..TransformAppStop s on s.ApplicationID = I.ApplicationID
	WHERE s.ApplicationID is not null

	delete i
	from [ARM_CORE]..[AppAstAsIs] I
	left JOIN [ARM_CORE]..TransformAppStop s on I.ApplicationID like s.ApplicationID  
	WHERE s.ApplicationID is not null
END


	EXEC [ARM_CORE]..[Apps-ReApplyAppTransforms]

	update [ARM_CORE]..[Application] set Ready = 1  where ApplicationID in (
		select ApplicationID from (
		   SELECT a.[ApplicationID],  a.[Name]
		  ,IsNull((select top 1 Name from [ARM_CORE]..[A_CollectionItem] i LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionID = i.CollectionID   where i.ItemID = a.ApplicationID and c.CollectionClassID = 20),'TBC') as [IE]
		  ,IsNull((select top 1 Name from [ARM_CORE]..[A_CollectionItem] i LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionID = i.CollectionID   where i.ItemID = a.ApplicationID and c.CollectionClassID = 19),'TBC') as [Edge]
		  ,IsNull((select top 1 Name from [ARM_CORE]..[A_CollectionItem] i LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionID = i.CollectionID   where i.ItemID = a.ApplicationID and c.CollectionClassID = 18),'TBC') as [Chrome]
		  from [ARM_CORE]..[Application] a 
		  LEFT JOIN [ARM_CORE]..[AppGroup] g on g.AppGroupID = a.AppGroupID
		  where a.[DeployType] = 'W'
		) r where r.[IE] = 'Pass' or r.[Edge] = 'Pass' or r.[Chrome] = 'Pass'
	) and [DeployType] = 'W'


	IF object_id('[ARM_CORE]..[s_ApplicationASISInstallCount]','U') is not null Delete from [ARM_CORE]..[s_ApplicationASISInstallCount]
	 INSERT INTO [ARM_CORE]..[s_ApplicationASISInstallCount] ([ApplicationID], [Count])
		SELECT   ApplicationID, COUNT(DISTINCT AssetID) AS Count
		FROM     dbo.AppAstAsIs 
		GROUP BY ApplicationID

--- PASS 0 -------------------------------

	EXEC [ARM_CORE]..[CalculateAllBitValues] 0
	
	EXEC [ARM_CORE]..[SYSTEM-AutoCollections] 0

--	EXEC [ARM_CORE]..[CalculateAllBitValues] 0

--- PASS 1 -------------------------------

	EXEC [ARM_CORE]..[CalculateAllBitValues] 1
	
	EXEC [ARM_CORE]..[SYSTEM-AutoCollections] 1

--	EXEC [ARM_CORE]..[CalculateAllBitValues] 1

--- PASS 2 -------------------------------


	-- Tidies up Application readiness Collections ... MUST BE ON TOBE


delete from [ARM_CORE]..[A_CollectionItem] where itemID in (
	select distinct itemID from [ARM_CORE]..[A_CollectionItem] i 
	LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionID = i.CollectionID
	LEFT JOIN [ARM_CORE]..[AppAstToBe] b on b.ApplicationID = i.ItemID
	LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = i.ItemID
	where c.CollectionClassID = 33 and b.ApplicationID IS NULL and a.DeployType <> 'W'
) and CollectionID in (
	select distinct collectionID from [ARM_CORE]..[A_Collection] c 
	where c.CollectionClassID = 33 
)


	EXEC [ARM_CORE]..[CalculateAllBitValues] 2
	
	EXEC [ARM_CORE]..[SYSTEM-AutoCollections] 2

--	EXEC [ARM_CORE]..[CalculateAllBitValues] 2

-------------------------------



END


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SYSTEM-LastModified]
	@After date = NULL
AS
BEGIN
	set dateformat ymd

	if @After IS NULL set @After = GETDATE() - 7
	
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;



	select * from (
		select 'NEW' as [Status], @After as [Since], name AS [Name], create_date as [Date], 'create_date' as [DateType], 'Stored Procedure' as [Artifact]
		from sys.procedures where create_date >= @After 

		UNION 

		select 'UPDATE' as [Status], @After as [Since], name AS [Name], modify_date as [Date], 'modify_date' as [DateType], 'Stored Procedure' as [Artifact]
		from sys.procedures where modify_date >= @After and NOT create_date >= @After

		UNION

		select 'NEW' as [Status], @After as [Since], s.name AS [Name], create_date as [Date], 'create_date' as [DateType], 'Table' as [Artifact]
		from sys.tables s where create_date >= @After 
	) a order by [Artifact], [Name], [Status], [Date] Desc


	select s.name AS TableName, s.create_date, s.modify_date, u.last_user_update, u.last_user_scan, u.user_updates, u.last_system_scan
	from [ARM_CORE].sys.tables s
	LEFT JOIN sys.dm_db_index_usage_stats u on u.object_id = s.object_id
	where modify_date >= @After 
	order by left(create_date,10) , left(modify_date,10) , TableName


END




GO
-- =============================================
-- Author:             
-- Create date: 
-- Description:        
-- =============================================
CREATE PROCEDURE [dbo].[SYSTEM-Initialise-TablePermit]
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
        SET NOCOUNT ON;
TRUNCATE TABLE  [ARM_CORE]..[A_TablePermit]
set IDENTITY_INSERT  [ARM_CORE]..[A_TablePermit] ON
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 1 , 'ARM_CORE' , 'A_TableEdit' , 1 , NULL , 'minimal.css' , 'System' , 0)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 2 , 'ARM_CORE' , 'A_lookup' , 1 , NULL , 'minimal.css' , 'System' , NULL)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 3 , 'ARM_CORE' , 'User' , 1 , 'UserID' , 'minimal.css' , 'Main' , 1)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 4 , 'ARM_CORE' , 'Transform' , 1 , NULL , 'minimal.css' , 'Admin' , NULL)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 5 , 'ARM_CORE' , 'Asset' , 1 , 'AssetID' , 'minimal.css' , 'Main' , 1)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 6 , 'ARM_CORE' , 'A_TablePermit' , 1 , '' , 'minimal.css' , 'System' , 0)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 7 , 'ARM_CORE' , 'Views' , 1 , '' , 'minimal.css' , 'Admin' , NULL)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 8 , 'ARM_CORE' , 'AppGroup' , 1 , NULL , 'minimal.css' , 'Main' , 1)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 9 , 'ARM_CORE' , 'BArea' , 1 , NULL , 'minimal.css' , 'Admin' , NULL)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 10 , 'ARM_CORE' , 'A_Menu' , 1 , NULL , 'minimal.css' , 'Dev' , NULL)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 11 , 'ARM_CORE' , 'A_Role' , 1 , NULL , 'minimal.css' , 'Dev' , NULL)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 12 , 'ARM_CORE' , 'A_File' , 1 , NULL , 'minimal.css' , 'Dev' , NULL)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 13 , 'ARM_CORE' , 'Application' , 1 , 'ApplicationID' , 'minimal.css' , 'Main' , 1)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 14 , 'ARM_CORE' , 'A_CommentLog' , 1 , NULL , 'minimal.css' , 'System' , 0)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 15 , 'ARM_CORE' , 'A_FileAccess' , 1 , NULL , 'minimal.css' , 'Dev' , 0)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 16 , 'ARM_CORE' , 'A_User' , 1 , NULL , 'minimal.css' , 'Dev' , 0)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 17 , 'ARM_CORE' , 'A_MenuGroupTab' , 1 , NULL , 'minimal.css' , 'System' , 0)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 18 , 'ARM_CORE' , 'A_MenuGroup' , 1 , NULL , 'minimal.css' , 'System' , 0)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 19 , 'ARM_CORE' , 'A_MenuGroupParam' , 1 , NULL , 'minimal.css' , 'System' , 0)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 1031 , 'ARM_CORE' , 'BookingKeyInfo' , 1 , '' , 'minimal.css' , 'System' , NULL)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 22 , 'ARM_CORE' , 'Chart' , 1 , 'ChartID' , 'minimal.css' , 'Dev' , 0)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 23 , 'ARM_CORE' , 'DashboardText' , 1 , NULL , 'minimal.css' , 'Dev' , NULL)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 24 , 'ARM_CORE' , 'HitListInfo' , 1 , 'ApplicationID' , 'minimal.css' , 'Custom' , 1)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 25 , 'ARM_CORE' , 'A_DashBoard' , 1 , 'DashboardID' , 'minimal.css' , 'Dev' , 0)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 1025 , 'ARM_CORE' , 'A_CollectionClass' , 1 , '' , 'minimal.css' , 'System' , 0)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 1032 , 'ARM_CORE' , 'AssetAccessLog' , 1 , '' , 'minimal.css' , 'System' , 0)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 1027 , 'ARM_CORE' , 'A_Collection' , 1 , '' , 'minimal.css' , 'Admin' , NULL)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 1029 , 'ARM_CORE' , 'Notices' , 1 , '' , 'minimal.css' , 'Admin' , NULL)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 1030 , 'ARM_CORE' , 'ScheduleChannel' , 0 , '' , 'minimal.css' , 'Admin' , NULL)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 1053 , 'ARM_CORE' , 'A_CollectionItem' , 1 , 'ItemID' , 'minimal.css' , 'System' , 0)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 1055 , 'ARM_CORE' , 'Workstream' , 1 , '' , 'minimal.css' , 'Main' , 1)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 1056 , 'ARM_CORE' , 'Transform' , 1 , '' , 'minimal.css' , 'System' , 1)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 1039 , 'ARM_CUSTOM' , 'W_Contacts' , 1 , NULL , 'minimal.css' , 'Web' , 1)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 1040 , 'ARM_CUSTOM' , 'W_Help' , 1 , NULL , 'minimal.css' , 'Web' , 1)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 1041 , 'ARM_CUSTOM' , 'W_SnipIt' , 1 , NULL , 'minimal.css' , 'Web' , 1)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 1059 , 'ARM_CUSTOM' , 'Catalog' , 1 , 'Application' , 'minimal.css' , 'Custom' , 1)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 1058 , 'ARM_CUSTOM' , 'ImportException' , 1 , NULL , 'minimal.css' , 'System' , 1)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 1060 , 'ARM_CORE' , 'AppUsedMap' , 1 , 'AppUsedMapID' , 'minimal.css' , 'Main' , 1)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 1061 , 'ARM_CUSTOM' , 'AppsManualInstall' , 1 , 'AppName' , 'minimal.css' , 'Main' , 1)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 1062 , 'ARM_CORE' , 'A_LanguageCode' , 1 , '' , 'minimal.css' , 'Custom' , NULL)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 1063 , 'ARM_CORE' , 'ApplicationRequest' , 1 , 'ApplicationRequestID' , 'minimal.css' , 'Main' , 1)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 1028 , 'ARM_CUSTOM' , 'TombstoneException' , 1 , '' , 'minimal.css' , 'Custom' , 1)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 1054 , 'ARM_CORE' , 'NotificationLog' , 1 , '' , 'minimal.css' , 'System' , 0)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 1037 , 'ARM_CUSTOM' , 'W_Opportunity' , 1 , '' , 'minimal.css' , 'Web' , 1)
insert [ARM_CORE]..[A_TablePermit] ( [TableEditPermitID] ,[Schema] ,[Table] ,[Visible] ,[KEY] ,[Style] ,[Cluster] ,[CommentOn] ) values ( 1038 , 'ARM_CUSTOM' , 'Page' , 1 , '' , 'minimal.css' , 'Web' , 1)
set IDENTITY_INSERT  [ARM_CORE]..[A_TablePermit] OFF
TRUNCATE TABLE  [ARM_CORE]..[A_TableEdit]
set IDENTITY_INSERT  [ARM_CORE]..[A_TableEdit] ON
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1 , 'Views' , 'Description' , '' , 6 , 70 , 6 , '' , '' , 0 , '' , '400' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 2 , 'Views' , 'SQL' , NULL , 10 , 70 , 14 , NULL , NULL , 0 , 'Used if custom filename not specified' , 'x' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 3 , 'Views' , 'ViewID' , 'ID' , NULL , NULL , NULL , NULL , 'ReadOnly' , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 4 , 'Views' , 'Cluster' , NULL , 3 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 5 , 'Views' , 'Visible' , NULL , 2 , NULL , NULL , NULL , NULL , 0 , 'Hidden views not advertised in Export list' , 'x' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 6 , 'Views' , 'Name' , 'Filename' , 7 , NULL , NULL , '' , 'HIDDEN' , 0 , 'Name of custom view script file.' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 7 , 'Views' , 'DefParams' , 'Default Parameters' , 5 , NULL , NULL , '' , '' , 0 , '' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 8 , 'Transform' , 'LastRun' , NULL , NULL , NULL , NULL , NULL , 'ReadOnly' , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 9 , 'Transform' , 'SQL' , NULL , NULL , 70 , 14 , NULL , NULL , 0 , NULL , '400' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 10 , 'A_TableEdit' , 'Order' , NULL , NULL , 10 , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 11 , 'A_TableEdit' , 'Width' , NULL , NULL , 10 , NULL , NULL , NULL , 0 , 'Width of field on form' , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 12 , 'A_TableEdit' , 'Height' , NULL , NULL , 10 , NULL , NULL , NULL , 0 , 'If greater than 1 turns form text field into textarea.' , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 13 , 'A_TableEdit' , 'ListColWidth' , NULL , NULL , 10 , NULL , NULL , NULL , 0 , 'Width of column for list view. Can be fixed or a percentage of browser width. If no value supplied, width is determined by browser. Set value of 0 (zero) to not display. To omit from data record, set value to ''x'' (without quote marks). ' , ' ' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 14 , 'A_Lookup' , 'Description' , NULL , NULL , 50 , 5 , NULL , NULL , 1 , NULL , 'x' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 15 , 'A_TableEdit' , 'HelpText' , NULL , NULL , 50 , 5 , NULL , NULL , 0 , 'Limited to 250 characters ' , '400' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 16 , 'A_TableEdit' , 'Label' , NULL , NULL , NULL , NULL , NULL , NULL , 0 , 'Used as title for column if specified.' , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 17 , 'BArea' , 'BArea' , NULL , NULL , 0 , NULL , NULL , NULL , 0 , NULL , '400' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 18 , 'BArea' , 'DeploymentOrder' , NULL , NULL , NULL , NULL , NULL , NULL , 1 , NULL , 'x' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 19 , 'A_MeetingItem' , 'Status' , NULL , NULL , NULL , NULL , NULL , 'MANDATORY' , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 20 , 'A_MeetingItem' , 'Date' , NULL , NULL , NULL , NULL , NULL , 'MANDATORY' , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 21 , 'A_MeetingItem' , 'Type' , NULL , NULL , NULL , NULL , NULL , 'MANDATORY' , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 22 , 'A_TableEdit' , 'Table' , NULL , NULL , NULL , NULL , NULL , 'MANDATORY' , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 23 , 'A_TableEdit' , 'Column' , NULL , NULL , NULL , NULL , NULL , 'MANDATORY' , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 24 , 'User' , 'Custom01' , NULL , NULL , NULL , NULL , NULL , NULL , 0 , NULL , 'x' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 25 , 'User' , 'Custom02' , NULL , NULL , NULL , NULL , NULL , NULL , 0 , NULL , 'x' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 26 , 'User' , 'Custom03' , NULL , NULL , NULL , NULL , NULL , NULL , 0 , NULL , 'x' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 27 , 'User' , 'Custom04' , NULL , NULL , NULL , NULL , NULL , NULL , 0 , NULL , 'x' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 28 , 'User' , 'Custom05' , NULL , NULL , NULL , NULL , NULL , NULL , 0 , NULL , 'x' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 29 , 'User' , 'VIP' , NULL , NULL , NULL , NULL , NULL , NULL , 0 , NULL , 'x' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 30 , 'User' , 'Notes' , NULL , NULL , 50 , 6 , NULL , NULL , 0 , NULL , 'x' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 31 , 'User' , 'Telephone' , NULL , NULL , NULL , NULL , NULL , NULL , 0 , NULL , 'x' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 32 , 'User' , 'Mobile' , NULL , NULL , NULL , NULL , NULL , NULL , 0 , NULL , 'x' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 33 , 'User' , 'Heartbeat' , NULL , NULL , NULL , NULL , NULL , NULL , 0 , NULL , 'x' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 34 , 'User' , 'Department' , NULL , NULL , NULL , NULL , NULL , NULL , 0 , NULL , '200' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 35 , 'User' , 'JobTitle' , NULL , NULL , NULL , NULL , NULL , NULL , 0 , NULL , '200' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 36 , 'User' , 'UserName' , NULL , NULL , NULL , NULL , NULL , NULL , 0 , NULL , '200' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 37 , 'User' , 'UserID' , NULL , NULL , NULL , NULL , NULL , 'MANDATORY' , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 38 , 'TEST' , 'Label' , NULL , NULL , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 39 , 'A_TablePermit' , 'Schema' , NULL , NULL , NULL , NULL , NULL , 'MANDATORY' , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 40 , 'A_TablePermit' , 'Table' , NULL , NULL , NULL , NULL , NULL , 'MANDATORY' , 0 , NULL , '180' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 41 , 'A_TablePermit' , 'KEY' , NULL , NULL , NULL , NULL , NULL , NULL , 0 , 'Optional. Name of column to use as a primary key if table does not contain an identity field.' , '180' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 43 , 'A_Lookup' , 'Table' , NULL , NULL , NULL , NULL , NULL , 'MANDATORY' , 0 , 'Name of Table' , '180' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 44 , 'A_Lookup' , 'Column' , NULL , NULL , NULL , NULL , NULL , 'MANDATORY' , 0 , NULL , '180' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 45 , 'A_Lookup' , 'Lookup' , '' , NULL , NULL , NULL , '' , 'MANDATORY' , 0 , 'The value that gets saved in the record. Can use a table lookup DYN:ARM_CUSTOM..Catalog:Display Name or DYN:[ARM_CORE].sys.[Tables]:Name' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 46 , 'A_Lookup' , 'Label' , NULL , NULL , NULL , NULL , NULL , 'MANDATORY' , 0 , 'An alternative label to the column name' , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 47 , 'A_TablePermit' , 'Style' , NULL , NULL , NULL , NULL , NULL , NULL , 0 , NULL , '100' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 48 , 'A_TableEdit' , 'Property' , NULL , NULL , NULL , NULL , NULL , NULL , 0 , NULL , '120' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 49 , 'A_lookup' , 'Order' , NULL , NULL , 10 , NULL , NULL , NULL , 0 , 'Order they appear in drop down' , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 50 , 'A_TableEdit' , 'Exclude' , NULL , NULL , NULL , NULL , NULL , NULL , 0 , 'Determines whether displayed on edit form' , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 51 , 'Transform' , 'FileName' , NULL , NULL , NULL , NULL , NULL , NULL , 0 , NULL , '200' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 52 , 'Asset' , '64bit' , NULL , NULL , NULL , NULL , NULL , NULL , 1 , NULL , 'x' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 53 , 'A_Menu' , 'Icon' , NULL , NULL , 20 , NULL , NULL , NULL , 0 , NULL , '150' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 54 , 'Asset' , 'OS' , NULL , NULL , NULL , NULL , NULL , NULL , 0 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 55 , 'Asset' , 'Association' , NULL , NULL , NULL , NULL , NULL , NULL , 0 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 56 , 'Asset' , 'Notes' , NULL , NULL , NULL , NULL , NULL , NULL , 0 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 57 , 'Asset' , 'Custom01' , NULL , NULL , NULL , NULL , NULL , NULL , 0 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 58 , 'Asset' , 'Custom02' , NULL , NULL , NULL , NULL , NULL , NULL , 0 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 59 , 'Asset' , 'Custom03' , NULL , NULL , NULL , NULL , NULL , NULL , 0 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 60 , 'Asset' , 'Custom04' , NULL , NULL , NULL , NULL , NULL , NULL , 0 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 61 , 'Asset' , 'Custom05' , '' , NULL , NULL , NULL , '' , '' , 0 , '' , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 62 , 'Asset' , 'Make' , '' , 3 , NULL , NULL , '' , '' , 0 , '' , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 63 , 'Asset' , 'OU' , '' , NULL , NULL , NULL , '' , '' , 0 , '' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 64 , 'Asset' , 'Select' , '' , NULL , NULL , NULL , '' , '' , 1 , '' , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 65 , 'Asset' , 'AssetTag' , NULL , NULL , NULL , NULL , NULL , NULL , 0 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 66 , 'Asset' , 'Type' , NULL , 3 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 67 , 'Asset' , 'UserID' , NULL , 25 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 68 , 'Asset' , 'BArea' , NULL , 10 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 69 , 'Asset' , 'Lifecycle' , NULL , 8 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 70 , 'Asset' , 'Target' , '' , 9 , NULL , NULL , '' , '' , 1 , '' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 71 , 'Asset' , 'Confirmed' , '' , NULL , NULL , NULL , '' , '' , 1 , '' , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 72 , 'Asset' , 'Heartbeat' , NULL , 10 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 73 , 'Asset' , 'Email' , NULL , NULL , NULL , NULL , NULL , NULL , 0 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 74 , 'Asset' , 'Deferred' , '' , 9 , NULL , NULL , '' , '' , 1 , '' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 75 , 'AppGroup' , 'AppGroupID' , NULL , 1 , NULL , NULL , NULL , NULL , 0 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 76 , 'AppGroup' , 'AppGroupName' , NULL , 2 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 77 , 'AppGroup' , 'ApplicationOwner' , NULL , 8 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 78 , 'AppGroup' , 'ApplicationOwnerEmail' , NULL , 17 , NULL , NULL , NULL , NULL , 0 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 79 , 'AppGroup' , 'BusinessArea' , NULL , 6 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 80 , 'AppGroup' , 'BusinessOwner' , NULL , 7 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 81 , 'AppGroup' , 'BusinessOwnerEmail' , NULL , 18 , NULL , NULL , NULL , NULL , 0 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 82 , 'AppGroup' , 'Class' , NULL , 4 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 83 , 'AppGroup' , 'Criticality' , NULL , 9 , NULL , NULL , NULL , NULL , 0 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 84 , 'AppGroup' , 'CurrentApplication' , NULL , 14 , NULL , NULL , NULL , NULL , 0 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 85 , 'AppGroup' , 'Description' , NULL , 11 , NULL , NULL , NULL , NULL , 0 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 86 , 'AppGroup' , 'LocalID' , NULL , 15 , NULL , NULL , NULL , NULL , 0 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 87 , 'AppGroup' , 'Notes' , NULL , 13 , NULL , NULL , NULL , NULL , 0 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 88 , 'AppGroup' , 'Platform' , NULL , 3 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 89 , 'AppGroup' , 'Scope' , NULL , 10 , NULL , NULL , NULL , NULL , 0 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 90 , 'AppGroup' , 'Type' , NULL , 5 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 91 , 'AppGroup' , 'Vendor' , NULL , 12 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 92 , 'AppGroup' , 'VendorURL' , NULL , 16 , NULL , NULL , NULL , NULL , 0 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 93 , 'Transform' , 'Active' , NULL , 5 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 94 , 'Transform' , 'Order' , NULL , 4 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 95 , 'Transform' , 'SkipFirstLine' , NULL , 6 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 96 , 'Transform' , 'TempLabel' , NULL , 3 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 97 , 'Transform' , 'TransformID' , NULL , 1 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 98 , 'A_TableEdit' , 'InitialValue' , NULL , 8 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 99 , 'A_TableEdit' , 'TableEditID' , NULL , 1 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 100 , 'A_lookup' , 'LookupID' , NULL , 1 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 101 , 'User' , 'BusinessUnit' , NULL , 4 , NULL , NULL , NULL , NULL , 0 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 102 , 'User' , 'Email' , NULL , 10 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 103 , 'User' , 'FirstName' , NULL , 19 , NULL , NULL , NULL , NULL , 0 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 104 , 'User' , 'Live' , NULL , 11 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 105 , 'User' , 'Location' , NULL , 5 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 106 , 'Asset' , 'AssetID' , '' , 1 , NULL , NULL , '' , 'MANDATORY' , 0 , '' , '50' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 107 , 'Asset' , 'Live' , NULL , 10 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 108 , 'Asset' , 'Location' , NULL , 18 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 109 , 'Asset' , 'Model' , NULL , 4 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 110 , 'Asset' , 'Owner' , NULL , 25 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 111 , 'Asset' , 'SerialNumber' , NULL , 3 , NULL , NULL , NULL , NULL , 0 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 112 , 'Asset' , 'Status' , '' , 9 , NULL , NULL , '' , '' , 0 , '' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 113 , 'Asset' , 'WarrantyDate' , NULL , 8 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 114 , 'A_TablePermit' , 'Cluster' , NULL , 7 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 115 , 'A_TablePermit' , 'Visible' , NULL , 4 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 116 , 'BArea' , 'BAreaID' , NULL , 1 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 117 , 'BArea' , 'Internal' , NULL , 4 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 118 , 'A_Menu' , 'Active' , NULL , 5 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 119 , 'A_Menu' , 'MenuID' , NULL , 1 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 120 , 'A_Menu' , 'Name' , NULL , 3 , NULL , NULL , NULL , NULL , 0 , NULL , '200' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 121 , 'A_Menu' , 'Order' , NULL , 4 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 122 , 'A_Menu' , 'ParentID' , NULL , 2 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 123 , 'A_Menu' , 'URL' , '' , 6 , NULL , NULL , '' , '' , 0 , 'Just add the URL that you want to hit. For ARM tables you must include the DB and UNID. You can also set up Sort order and Filters, like this &F_Status=Open%25&_OrderBy=AssignedTo ' , '300' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 124 , 'A_Role' , 'Name' , NULL , 2 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 125 , 'A_Role' , 'Rank' , NULL , 3 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 126 , 'A_Role' , 'RoleID' , NULL , 1 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 127 , 'A_File' , 'FileID' , NULL , 1 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 128 , 'A_File' , 'FilePath' , NULL , 2 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 129 , 'A_File' , 'Folder' , NULL , 6 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 130 , 'A_File' , 'GroupName' , NULL , 3 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 131 , 'A_File' , 'Ignore' , NULL , 9 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 132 , 'A_File' , 'LastModified' , NULL , 7 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 133 , 'A_File' , 'LastSync' , NULL , 8 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 134 , 'A_File' , 'Name' , NULL , 4 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 135 , 'A_File' , 'Size' , NULL , 5 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 136 , 'Application' , 'AppGroupID' , NULL , 2 , NULL , NULL , NULL , 'MANDATORY' , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 137 , 'Application' , 'ApplicationID' , NULL , 1 , NULL , NULL , NULL , 'MANDATORY' , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 138 , 'Application' , 'BaseBuild' , '' , 8 , NULL , NULL , '' , '' , 1 , '' , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 139 , 'Application' , 'Deploy' , '' , 6 , NULL , NULL , '' , '' , 1 , '' , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 140 , 'Application' , 'DeployType' , NULL , 9 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 141 , 'Application' , 'LifeCycle' , NULL , 5 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 142 , 'Application' , 'LocalID' , NULL , 7 , NULL , NULL , NULL , NULL , 0 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 143 , 'Application' , 'Name' , NULL , 3 , NULL , NULL , NULL , 'MANDATORY' , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 144 , 'Application' , 'PackageID' , NULL , 12 , NULL , NULL , NULL , NULL , 0 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 145 , 'Application' , 'Ready' , NULL , 11 , NULL , NULL , NULL , NULL , 0 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 146 , 'Application' , 'Status' , NULL , 10 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 147 , 'Application' , 'Version' , NULL , 4 , NULL , NULL , NULL , 'MANDATORY' , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 148 , 'Application' , 'WhatIf' , NULL , 13 , NULL , NULL , NULL , NULL , 0 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 149 , 'A_TablePermit' , 'CommentOn' , NULL , 8 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 150 , 'A_CommentLog' , 'Author' , NULL , 6 , NULL , NULL , NULL , NULL , 0 , NULL , '200' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 151 , 'A_CommentLog' , 'Comment' , NULL , 5 , NULL , NULL , NULL , NULL , 0 , NULL , '450' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 152 , 'A_CommentLog' , 'CommentLogID' , NULL , 1 , NULL , NULL , NULL , NULL , 0 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 153 , 'A_CommentLog' , 'Internal' , NULL , 8 , NULL , NULL , NULL , NULL , 0 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 154 , 'A_CommentLog' , 'RecordID' , NULL , 4 , NULL , NULL , NULL , NULL , 0 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 155 , 'A_CommentLog' , 'Table' , NULL , 2 , NULL , NULL , NULL , NULL , 0 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 156 , 'A_CommentLog' , 'TimeStamp' , NULL , 7 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 157 , 'A_CommentLog' , 'Type' , NULL , 3 , NULL , NULL , NULL , NULL , 0 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 158 , 'A_FileAccess' , 'FileID' , NULL , 2 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 159 , 'A_FileAccess' , 'PID' , NULL , 1 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 160 , 'A_FileAccess' , 'RoleID' , NULL , 3 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 161 , 'A_User' , 'Actor' , NULL , 60 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 162 , 'A_User' , 'AppEditor' , NULL , 11 , NULL , NULL , NULL , NULL , 1 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 163 , 'A_User' , 'Auth_User' , NULL , 5 , NULL , NULL , NULL , 'MANDATORY' , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 164 , 'A_User' , 'BArea' , NULL , 3 , NULL , NULL , NULL , NULL , 1 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 165 , 'A_User' , 'BookingEditor' , NULL , 12 , NULL , NULL , NULL , NULL , 1 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 166 , 'A_User' , 'Email' , NULL , 30 , NULL , NULL , NULL , 'MANDATORY' , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 167 , 'A_User' , 'Granted' , '' , 200 , NULL , NULL , '' , '' , 0 , '' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 168 , 'A_User' , 'InternalUse' , NULL , 6 , NULL , NULL , NULL , NULL , 1 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 169 , 'A_User' , 'IssueEditor' , NULL , 7 , NULL , NULL , NULL , NULL , 1 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 170 , 'A_User' , 'LastAccess' , NULL , 10 , NULL , NULL , NULL , 'READONLY' , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 171 , 'A_User' , 'Name' , NULL , 20 , NULL , NULL , NULL , 'MANDATORY' , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 172 , 'A_User' , 'Note' , NULL , 100 , NULL , 3 , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 173 , 'A_User' , 'NotificationEditor' , NULL , 17 , NULL , NULL , NULL , NULL , 1 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 174 , 'A_User' , 'OU' , NULL , 40 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 175 , 'A_User' , 'Requested' , NULL , 70 , NULL , NULL , NULL , 'READONLY' , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 176 , 'A_User' , 'ResourceEditor' , NULL , 15 , NULL , NULL , NULL , NULL , 1 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 177 , 'A_User' , 'RoleID' , NULL , 50 , NULL , NULL , NULL , 'MANDATORY' , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 178 , 'A_User' , 'SlotEditor' , NULL , 8 , NULL , NULL , NULL , NULL , 1 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 179 , 'A_User' , 'SlotViewer' , NULL , 9 , NULL , NULL , NULL , NULL , 1 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 180 , 'A_User' , 'Survey' , NULL , 10 , NULL , NULL , NULL , NULL , 1 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 181 , 'A_User' , 'SysAdmin' , NULL , 16 , NULL , NULL , NULL , NULL , 1 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 182 , 'A_User' , 'UserAdmin' , NULL , 13 , NULL , NULL , NULL , NULL , 1 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 183 , 'A_User' , 'UserID' , NULL , 1 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 184 , 'A_Menu' , 'Override' , NULL , 20 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 199 , 'DashboardText' , 'Active' , 'Library' , 3 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 200 , 'DashboardText' , 'Height' , NULL , 5 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 201 , 'DashboardText' , 'TextID' , NULL , 1 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 202 , 'DashboardText' , 'TextTitle' , NULL , 2 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 203 , 'DashboardText' , 'TextValue' , '' , 4 , NULL , 5 , '' , '' , 0 , '' , '' , 1)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 204 , 'DashboardText' , 'NoBorder' , NULL , 8 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 205 , 'DashboardText' , 'URL' , NULL , 7 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 217 , 'HitListInfo' , 'Description' , NULL , NULL , NULL , NULL , NULL , NULL , 0 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 218 , 'HitListInfo' , 'VendorURL' , NULL , NULL , NULL , NULL , NULL , NULL , 0 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 219 , 'HitListInfo' , 'Notes' , NULL , NULL , NULL , 5 , NULL , NULL , 0 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 220 , 'HitListInfo' , 'AuthUser' , NULL , NULL , NULL , NULL , NULL , NULL , 0 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1217 , 'HitListInfo' , 'LastModified' , NULL , NULL , NULL , NULL , NULL , 'HIDDEN' , 1 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1236 , 'A_Collection' , 'CollectionClassID' , NULL , 8 , NULL , NULL , NULL , 'MANDATORY' , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1237 , 'A_Collection' , 'Colour' , NULL , 9 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1238 , 'A_CollectionClass' , 'Description' , NULL , 3 , NULL , 6 , NULL , NULL , 0 , NULL , '600' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1239 , 'A_CollectionClass' , 'Name' , NULL , 2 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1240 , 'A_CollectionClass' , 'CollectionClassID' , NULL , 1 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1241 , 'A_CollectionClass' , 'Distinct' , NULL , 4 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1260 , 'A_Collection' , 'Auth_User' , NULL , 4 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1261 , 'A_Collection' , 'CollectionID' , NULL , 1 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1262 , 'A_Collection' , 'Marker' , NULL , 7 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1263 , 'A_Collection' , 'Name' , NULL , 2 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1264 , 'A_Collection' , 'Order' , NULL , 3 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1265 , 'A_Collection' , 'Type' , NULL , 6 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1266 , 'A_Collection' , 'Visible' , NULL , 5 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1267 , 'HitListInfo' , 'ApplicationID' , NULL , 1 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1268 , 'HitListInfo' , 'AssignedTo' , 'Assigned To' , 2 , NULL , NULL , '' , '' , 0 , '' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1271 , 'HitListInfo' , 'LocalID' , NULL , 9 , NULL , NULL , NULL , NULL , 1 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1273 , 'HitListInfo' , 'Status' , '' , 3 , NULL , NULL , '' , '' , 0 , '' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1276 , 'ScheduleChannel' , 'AssetType' , '' , 8 , NULL , NULL , '' , '' , 0 , '' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1277 , 'ScheduleChannel' , 'BgColour' , '' , 6 , NULL , NULL , '' , '' , 0 , '' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1278 , 'ScheduleChannel' , 'Bookable' , '' , 5 , NULL , NULL , '' , '' , 1 , '' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1279 , 'ScheduleChannel' , 'CancellationTemplate' , '' , 10 , NULL , NULL , '' , '' , 1 , '' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1280 , 'ScheduleChannel' , 'ChannelID' , NULL , 1 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1281 , 'ScheduleChannel' , 'ConfirmationTemplate' , '' , 9 , NULL , NULL , '' , '' , 1 , '' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1282 , 'ScheduleChannel' , 'Mode' , '' , 5 , NULL , NULL , '' , '' , 0 , '' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1283 , 'ScheduleChannel' , 'Name' , NULL , 2 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1284 , 'ScheduleChannel' , 'ShortName' , '' , 4 , NULL , NULL , '' , '' , 0 , '' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1285 , 'ScheduleChannel' , 'Active' , '' , 3 , NULL , NULL , '' , '' , 0 , '' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1286 , 'ScheduleChannel' , 'BCC' , '' , 14 , NULL , NULL , '' , '' , 1 , '' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1287 , 'ScheduleChannel' , 'CC' , '' , 13 , NULL , NULL , '' , '' , 1 , '' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1288 , 'ScheduleChannel' , 'From' , '' , 11 , NULL , NULL , '' , '' , 1 , '' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1289 , 'ScheduleChannel' , 'ReplyTo' , '' , 12 , NULL , NULL , '' , '' , 1 , '' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1290 , 'Notices' , 'Alert' , '' , 3 , NULL , NULL , '' , '' , 0 , '' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1291 , 'Notices' , 'Anon' , NULL , 6 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1292 , 'Notices' , 'CreatedOn' , '' , 5 , NULL , NULL , '' , '' , 1 , '' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1293 , 'Notices' , 'Link' , '' , 4 , NULL , NULL , '' , '' , 0 , '' , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1294 , 'Notices' , 'Notice' , '' , 7 , NULL , 6 , '' , 'MANDATORY' , 0 , '' , '500' , 1)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1295 , 'Notices' , 'NoticeID' , NULL , 1 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1296 , 'Notices' , 'Headline' , '' , 2 , NULL , NULL , '' , '' , 0 , '' , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1297 , 'Notices' , 'Units' , '' , 8 , NULL , NULL , '' , '' , 0 , '' , '25' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1298 , 'BookingKeyInfo' , 'AltLabel' , NULL , 4 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1299 , 'BookingKeyInfo' , 'AssetType' , NULL , 2 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1300 , 'BookingKeyInfo' , 'BKI' , NULL , 1 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1301 , 'BookingKeyInfo' , 'FieldName' , NULL , 3 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1302 , 'BookingKeyInfo' , 'Height' , NULL , 8 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1303 , 'BookingKeyInfo' , 'HelpText' , NULL , 6 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1304 , 'BookingKeyInfo' , 'Order' , NULL , 5 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1305 , 'BookingKeyInfo' , 'Property' , NULL , 7 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1307 , 'A_DashBoard' , 'DashboardID' , NULL , 1 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1308 , 'A_DashBoard' , 'Name' , NULL , 2 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1309 , 'A_DashBoard' , 'Reference' , NULL , 3 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1312 , 'HitListInfo' , 'Vendor' , 'Vendor' , NULL , NULL , NULL , '' , '' , 0 , '' , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1313 , 'HitListInfo' , 'TicketNumber' , 'Ticket #' , NULL , NULL , NULL , '' , '' , 0 , '' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1314 , 'AssetAccessLog' , 'AssetAccessLogID' , NULL , 1 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , 0)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1315 , 'AssetAccessLog' , 'AssetID' , NULL , 2 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , 0)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1316 , 'AssetAccessLog' , 'Counter' , NULL , 5 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , 0)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1317 , 'AssetAccessLog' , 'LastDate' , NULL , 4 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , 0)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1318 , 'AssetAccessLog' , 'UserID' , NULL , 3 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , 0)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1393 , 'W_Opportunity' , 'Forecast' , '' , NULL , NULL , NULL , '' , '' , 0 , 'Multiply Value base on Type, i.e. Contact: 0, Lead: 25, Qualified: 50, Proposal: 75.' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1394 , 'Page' , 'PageID' , NULL , 1 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , 0)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1395 , 'Page' , 'PageContent' , '' , 3 , NULL , 12 , '' , 'MANDATORY' , 0 , '' , '0' , 1)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1396 , 'Page' , 'PageTitle' , '' , 2 , NULL , NULL , '' , 'MANDATORY' , 0 , '' , '300' , 0)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1397 , 'Page' , 'PageHeader' , '' , 3 , NULL , NULL , '' , '' , 0 , '' , '300' , 0)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1398 , 'W_Help' , 'Content' , '' , NULL , NULL , 5 , '' , '' , 0 , '' , '' , 1)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1586 , 'Chart' , 'ChartID' , NULL , 1 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1587 , 'Chart' , 'Description' , NULL , 8 , NULL , 6 , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1588 , 'Chart' , 'Options' , NULL , 7 , NULL , 6 , NULL , NULL , 0 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1589 , 'Chart' , 'SQL' , NULL , 5 , NULL , 6 , NULL , NULL , 0 , NULL , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1590 , 'Chart' , 'Type' , NULL , 3 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1591 , 'Chart' , 'URL' , NULL , 12 , NULL , NULL , NULL , NULL , 0 , 'linked page. Hyperlink provided in chart footer if specified.' , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1592 , 'Chart' , 'Active' , 'Library' , 2 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1593 , 'Chart' , 'Data' , NULL , 6 , NULL , 6 , NULL , NULL , 0 , 'Static data array. Will only be used if SQL not specified.' , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1594 , 'Chart' , 'Order' , NULL , 4 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1595 , 'Chart' , 'ChartTitle' , NULL , 2 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1596 , 'A_TablePermit' , 'TableEditPermitID' , NULL , NULL , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1597 , 'A_CollectionItem' , 'CollectionID' , NULL , 2 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1598 , 'A_CollectionItem' , 'ItemID' , NULL , 1 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1599 , 'A_CollectionItem' , 'State' , NULL , 3 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1600 , 'A_CollectionItem' , 'Status' , NULL , 5 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1601 , 'A_CollectionItem' , 'TaggedOn' , NULL , 4 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1602 , 'NotificationLog' , 'AssetID' , NULL , 5 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1603 , 'NotificationLog' , 'AutoNotificationID' , NULL , 7 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1604 , 'NotificationLog' , 'Email' , NULL , 4 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1605 , 'NotificationLog' , 'Name' , NULL , 2 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1606 , 'NotificationLog' , 'NotificationLogID' , NULL , 1 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1607 , 'NotificationLog' , 'Owner' , NULL , 3 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1608 , 'NotificationLog' , 'Status' , NULL , 9 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1609 , 'NotificationLog' , 'TemplateUsed' , NULL , 8 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1610 , 'NotificationLog' , 'Type' , NULL , 10 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1611 , 'NotificationLog' , 'WhenSent' , NULL , 6 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1612 , 'Views' , 'NoMenu' , '' , 4 , NULL , NULL , '' , '' , 0 , '' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1615 , 'ScheduleChannel' , 'Custom01' , 'ZTP Site' , 100 , NULL , NULL , '' , '' , 0 , '' , '' , 0)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1616 , 'ScheduleChannel' , 'Custom02' , 'ZTP Place' , 110 , NULL , NULL , '' , '' , 0 , '' , '' , 0)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1617 , 'ScheduleChannel' , 'AttachInvite' , NULL , 16 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1618 , 'ScheduleChannel' , 'ExampleText' , NULL , 15 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1619 , 'ScheduleChannel' , 'PDFTemplate' , NULL , 17 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1620 , 'ScheduleChannel' , 'TargetOnly' , NULL , 19 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1621 , 'ScheduleChannel' , 'WorkstreamID' , NULL , 18 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1623 , 'TombstoneException' , 'Justification' , NULL , NULL , NULL , 5 , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1624 , 'Workstream' , 'Active' , '' , 5 , NULL , NULL , '' , 'MANDATORY' , 0 , '' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1625 , 'Workstream' , 'ConfirmedID' , '' , 7 , NULL , NULL , '' , '' , 1 , '' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1626 , 'Workstream' , 'DeferredID' , '' , 10 , NULL , NULL , '' , '' , 1 , '' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1627 , 'Workstream' , 'DeployedID' , '' , 9 , NULL , NULL , '' , '' , 1 , '' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1628 , 'Workstream' , 'KeyStatusID' , '' , 4 , NULL , NULL , '' , '' , 1 , '' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1630 , 'Workstream' , 'Name' , '' , 2 , NULL , NULL , '' , 'MANDATORY' , 0 , '' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1631 , 'Workstream' , 'Purpose' , '' , 10 , 400 , 6 , '' , '' , 0 , '' , '300' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1632 , 'Workstream' , 'ScheduledID' , '' , 8 , NULL , NULL , '' , '' , 1 , '' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1633 , 'Workstream' , 'TargettedID' , '' , 6 , NULL , NULL , '' , '' , 1 , '' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1634 , 'Workstream' , 'WorkstreamID' , NULL , 1 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1635 , 'A_TablePermit' , 'OnCreateHandler' , '' , 9 , NULL , NULL , '' , '' , 0 , 'Stored procedure called after creation of a new record. Identity of new record will be passed as parameter.' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1636 , 'Workstream' , 'ClosedList' , '' , 12 , NULL , NULL , '' , 'MANDATORY' , 0 , 'If marked as a Closed List, only assets that are listed in the Workstream key collections can book.' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1637 , 'ScheduleChannel' , 'NothingAvailableText' , 'No Available Bookings Left text' , 200 , NULL , NULL , '' , '' , 1 , 'When there are no available slots left, either no dates or all slots full, this text will be displayed.' , '' , 1)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1638 , 'Catalog' , 'Category' , '' , NULL , NULL , NULL , '' , '' , 0 , 'Text' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1639 , 'AppUsedMap' , 'ApplicationExe' , NULL , 3 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1640 , 'AppUsedMap' , 'ApplicationID' , NULL , 1 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1641 , 'AppUsedMap' , 'ApplicationName' , NULL , 2 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1647 , 'AppUsedMap' , 'AppUsedMapID' , NULL , 1 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1648 , 'A_LanguageCode' , 'Code' , NULL , 2 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1649 , 'A_LanguageCode' , 'Language' , NULL , 3 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1650 , 'A_LanguageCode' , 'LanguageCodeID' , NULL , 1 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1651 , 'Workstream' , 'Display' , '' , 13 , NULL , NULL , '' , 'MANDATORY' , 0 , '' , '6' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1652 , 'Workstream' , 'Order' , NULL , 14 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1653 , 'ApplicationRequest' , 'AdditionalInfo' , 'Additional Information' , 20 , NULL , 5 , '' , '' , 0 , '' , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1654 , 'ApplicationRequest' , 'ApplicationID' , NULL , 1 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1655 , 'ApplicationRequest' , 'ApplicationOwner' , 'App Owner' , 14 , NULL , NULL , '' , '' , 0 , '' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1656 , 'ApplicationRequest' , 'CatalogCategory' , 'Category' , 6 , NULL , NULL , '' , '' , 0 , '' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1657 , 'ApplicationRequest' , 'CatalogDescription' , 'Catalog Description' , 7 , NULL , 5 , '' , '' , 0 , '' , '0' , 0)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1658 , 'ApplicationRequest' , 'CatalogIcon' , 'Icon' , 5 , NULL , NULL , '' , '' , 0 , '' , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1659 , 'ApplicationRequest' , 'Criticality' , NULL , 10 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1660 , 'ApplicationRequest' , 'Dependencies' , '' , 17 , NULL , NULL , '' , '' , 0 , '' , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1661 , 'ApplicationRequest' , 'Domain' , NULL , 15 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1662 , 'ApplicationRequest' , 'FolderName' , '' , 13 , NULL , NULL , '' , '' , 0 , '' , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1663 , 'ApplicationRequest' , 'Language' , '' , 16 , NULL , NULL , '' , '' , 0 , '' , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1664 , 'ApplicationRequest' , 'LicenceDetails' , 'Licence Details' , 19 , NULL , NULL , '' , '' , 0 , '' , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1665 , 'ApplicationRequest' , 'LicenceType' , 'Licence Type' , 18 , NULL , NULL , '' , '' , 0 , '' , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1666 , 'ApplicationRequest' , 'Name' , NULL , 2 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1667 , 'ApplicationRequest' , 'ReplaceApplication' , 'Application to Replace' , 12 , NULL , NULL , '' , '' , 0 , 'Only applicable if this is a Update to a previous application.' , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1668 , 'ApplicationRequest' , 'Scope' , NULL , 9 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1669 , 'ApplicationRequest' , 'Timescale' , NULL , 11 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1670 , 'ApplicationRequest' , 'RequestType' , '' , 8 , NULL , NULL , '' , '' , 0 , '' , '' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1671 , 'ApplicationRequest' , 'Vendor' , NULL , 4 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1672 , 'ApplicationRequest' , 'Version' , NULL , 3 , NULL , NULL , NULL , NULL , 0 , NULL , NULL , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1673 , 'ApplicationRequest' , 'ApplicationOwnerEmail' , '' , 15 , NULL , NULL , '' , '' , 0 , '' , '0' , NULL)
insert [ARM_CORE]..[A_TableEdit] ( [TableEditID] ,[Table] ,[Column] ,[Label] ,[Order] ,[Width] ,[Height] ,[InitialValue] ,[Property] ,[Exclude] ,[HelpText] ,[ListColWidth] ,[TextEditor] ) values ( 1674 , 'ApplicationRequest' , 'ApplicationRequestID' , '' , 1 , NULL , NULL , '' , '' , 0 , '' , '0' , NULL)
set IDENTITY_INSERT  [ARM_CORE]..[A_TableEdit] OFF
END
 

GO
-- =============================================
-- Author:		
-- Create date: 
-- Description:	
-- =============================================
CREATE PROCEDURE [dbo].[SYSTEM-Initialise-Menu]
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	set DATEFORMAT DMY;
	
TRUNCATE TABLE  [ARM_CORE]..[A_File]
set IDENTITY_INSERT  [ARM_CORE]..[A_File] ON
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 300 , '/Admin/_AssetIds.asp' , 'Admin' , '_AssetIds.asp' , 1514 , 'Admin' , '27/07/2018 14:40:28' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 186 , '/Admin/_Edit.asp' , 'Admin' , '_Edit.asp' , 14118 , 'Admin' , '22/03/2018 14:42:02' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 315 , '/Admin/_TableView.asp' , 'Admin' , '_TableView.asp' , 9499 , 'Admin' , '03/09/2018 14:58:28' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 233 , '/Admin/A_UserTab.asp' , 'Admin' , 'A_UserTab.asp' , 817 , 'Admin' , '11/04/2018 21:04:00' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 1 , '/Admin/AddAssetToSlot.asp' , 'Admin' , 'AddAssetToSlot.asp' , 4777 , 'Admin' , '16/07/2018 15:43:52' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 2 , '/Admin/Application.asp' , 'Admin' , 'Application.asp' , 17915 , 'Admin' , '02/04/2018 17:00:22' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 213 , '/Admin/ApplicationAssets.asp' , 'Admin' , 'ApplicationAssets.asp' , 26308 , 'Admin' , '18/09/2018 16:18:20' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 3 , '/Admin/ApplicationClassify.asp' , 'Admin' , 'ApplicationClassify.asp' , 2390 , 'Admin' , '02/04/2018 17:00:22' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 4 , '/Admin/ApplicationClassifyDo.asp' , 'Admin' , 'ApplicationClassifyDo.asp' , 1729 , 'Admin' , '03/01/2018 15:30:22' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 267 , '/Admin/ApplicationCollections.asp' , 'Admin' , 'ApplicationCollections.asp' , 5090 , 'Admin' , '29/04/2018 19:46:44' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 323 , '/Admin/ApplicationGroupTab.asp' , 'Admin' , 'ApplicationGroupTab.asp' , 1159 , 'Admin' , '17/09/2018 15:51:04' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 214 , '/Admin/ApplicationInstances - Copy.asp' , 'Admin' , 'ApplicationInstances - Copy.asp' , 8043 , 'Admin' , '06/04/2018 22:14:50' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 5 , '/Admin/ApplicationInstances.asp' , 'Admin' , 'ApplicationInstances.asp' , 7319 , 'Admin' , '17/09/2018 19:41:24' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 6 , '/Admin/ApplicationList.asp' , 'Admin' , 'ApplicationList.asp' , 10320 , 'Admin' , '21/09/2018 11:06:39' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 7 , '/Admin/ApplicationMap.asp' , 'Admin' , 'ApplicationMap.asp' , 10542 , 'Admin' , '04/09/2018 17:26:46' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 8 , '/Admin/ApplicationMapDo.asp' , 'Admin' , 'ApplicationMapDo.asp' , 3068 , 'Admin' , '12/07/2018 11:04:05' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 9 , '/Admin/ApplicationMapList.asp' , 'Admin' , 'ApplicationMapList.asp' , 7295 , 'Admin' , '17/09/2018 19:08:24' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 10 , '/Admin/ApplicationNew.asp' , 'Admin' , 'ApplicationNew.asp' , 7129 , 'Admin' , '06/04/2018 09:04:24' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 326 , '/Admin/ApplicationRequestTab.asp' , 'Admin' , 'ApplicationRequestTab.asp' , 994 , 'Admin' , '04/10/2018 11:46:00' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 11 , '/Admin/ApplicationStop.asp' , 'Admin' , 'ApplicationStop.asp' , 5870 , 'Admin' , '17/07/2018 10:13:23' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 215 , '/Admin/ApplicationTab.asp' , 'Admin' , 'ApplicationTab.asp' , 1054 , 'Admin' , '10/04/2018 11:37:40' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 216 , '/Admin/ApplicationUsers.asp' , 'Admin' , 'ApplicationUsers.asp' , 4770 , 'Admin' , '09/04/2018 12:44:46' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 12 , '/Admin/AppsSummaryBySlice.asp' , 'Admin' , 'AppsSummaryBySlice.asp' , 9052 , 'Admin' , '17/09/2018 16:22:12' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 274 , '/Admin/AssetAccessLog.asp' , 'Admin' , 'AssetAccessLog.asp' , 3409 , 'Admin' , '06/06/2018 15:51:28' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 217 , '/Admin/AssetApplications.asp' , 'Admin' , 'AssetApplications.asp' , 2215 , 'Admin' , '16/04/2018 17:08:50' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 218 , '/Admin/AssetAsis.asp' , 'Admin' , 'AssetAsis.asp' , 12572 , 'Admin' , '12/09/2018 12:00:15' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 13 , '/Admin/AssetBatch.asp' , 'Admin' , 'AssetBatch.asp' , 5505 , 'Admin' , '27/07/2018 12:01:46' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 14 , '/Admin/AssetBatchDo.asp' , 'Admin' , 'AssetBatchDo.asp' , 9433 , 'Admin' , '28/08/2018 11:42:22' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 15 , '/Admin/AssetEditor.asp' , 'Admin' , 'AssetEditor.asp' , 20865 , 'Admin' , '02/04/2018 17:00:22' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 16 , '/Admin/AssetIssueUpdate.asp' , 'Admin' , 'AssetIssueUpdate.asp' , 5093 , 'Admin' , '04/01/2018 11:52:22' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 280 , '/Admin/AssetList.asp' , 'Admin' , 'AssetList.asp' , 68256 , 'Admin' , '28/09/2018 11:10:41' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 286 , '/Admin/AssetList2.asp' , 'Admin' , 'AssetList2.asp' , 44497 , 'Admin' , '10/07/2018 13:38:33' , '10/07/2018 13:39:03' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 287 , '/Admin/AssetList-mk1.asp' , 'Admin' , 'AssetList-mk1.asp' , 43732 , 'Admin' , '23/07/2018 09:02:13' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 17 , '/Admin/AssetReplacement.asp' , 'Admin' , 'AssetReplacement.asp' , 1308 , 'Admin' , '04/01/2018 12:46:54' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 18 , '/Admin/Assets.asp' , 'Admin' , 'Assets.asp' , 9616 , 'Admin' , '02/04/2018 17:00:22' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 288 , '/Admin/assets2screen.asp' , 'Admin' , 'assets2screen.asp' , 3358 , 'Admin' , '13/07/2018 14:41:44' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 19 , '/Admin/AssetsByAppBySlice.asp' , 'Admin' , 'AssetsByAppBySlice.asp' , 35509 , 'Admin' , '23/07/2018 09:02:05' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 219 , '/Admin/AssetTab.asp' , 'Admin' , 'AssetTab.asp' , 1015 , 'Admin' , '04/10/2018 11:47:15' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 20 , '/Admin/AssetTrackingPanel.asp' , 'Admin' , 'AssetTrackingPanel.asp' , 16108 , 'Admin' , '02/04/2018 17:00:22' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 21 , '/Admin/AssetUpdateDo.asp' , 'Admin' , 'AssetUpdateDo.asp' , 11590 , 'Admin' , '03/01/2018 16:44:58' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 275 , '/Admin/AssetUserAccessLog.asp' , 'Admin' , 'AssetUserAccessLog.asp' , 1891 , 'Admin' , '07/06/2018 10:58:08' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 22 , '/Admin/AutoNotificationDelete.asp' , 'Admin' , 'AutoNotificationDelete.asp' , 2001 , 'Admin' , '02/04/2018 17:00:22' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 23 , '/Admin/AutoNotificationDeleteDo.asp' , 'Admin' , 'AutoNotificationDeleteDo.asp' , 588 , 'Admin' , '04/01/2018 18:20:04' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 24 , '/Admin/AutoNotificationEdit.asp' , 'Admin' , 'AutoNotificationEdit.asp' , 21418 , 'Admin' , '11/09/2018 14:41:16' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 25 , '/Admin/AutoNotifications.asp' , 'Admin' , 'AutoNotifications.asp' , 5910 , 'Admin' , '14/09/2018 14:23:19' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 26 , '/Admin/AutoNotificationsRunNow.asp' , 'Admin' , 'AutoNotificationsRunNow.asp' , 698 , 'Admin' , '04/01/2018 18:21:58' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 27 , '/Admin/BAreaAdd.asp' , 'Admin' , 'BAreaAdd.asp' , 559 , 'Admin' , '02/01/2018 17:14:06' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 28 , '/Admin/BAreaDelete.asp' , 'Admin' , 'BAreaDelete.asp' , 558 , 'Admin' , '02/01/2018 17:14:54' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 29 , '/Admin/BAreaEditor.asp' , 'Admin' , 'BAreaEditor.asp' , 7001 , 'Admin' , '20/05/2018 21:19:46' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 30 , '/Admin/BAreaGetComments.asp' , 'Admin' , 'BAreaGetComments.asp' , 5442 , 'Admin' , '02/04/2018 17:00:22' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 31 , '/Admin/BAreaUpdate.asp' , 'Admin' , 'BAreaUpdate.asp' , 1444 , 'Admin' , '02/01/2018 17:11:12' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 32 , '/Admin/ChannelAdd.asp' , 'Admin' , 'ChannelAdd.asp' , 1053 , 'Admin' , '26/06/2018 14:51:36' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 33 , '/Admin/ChannelBookingInfo.asp' , 'Admin' , 'ChannelBookingInfo.asp' , 9951 , 'Admin' , '13/08/2018 10:14:00' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 34 , '/Admin/ChannelDelete.asp' , 'Admin' , 'ChannelDelete.asp' , 573 , 'Admin' , '02/01/2018 17:32:14' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 35 , '/Admin/ChannelEditor.asp' , 'Admin' , 'ChannelEditor.asp' , 20252 , 'Admin' , '10/09/2018 10:13:38' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 36 , '/Admin/ChannelSchedule.asp' , 'Admin' , 'ChannelSchedule.asp' , 20963 , 'Admin' , '17/08/2018 08:39:20' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 305 , '/Admin/ChannelSchedule2.asp' , 'Admin' , 'ChannelSchedule2.asp' , 20577 , 'Admin' , '03/08/2018 10:42:26' , '03/08/2018 10:42:44' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 37 , '/Admin/ChannelScheduleCreate.asp' , 'Admin' , 'ChannelScheduleCreate.asp' , 1789 , 'Admin' , '02/01/2018 18:17:20' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 306 , '/Admin/ChannelSchedule-old.asp' , 'Admin' , 'ChannelSchedule-old.asp' , 20577 , 'Admin' , '30/07/2018 16:35:05' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 38 , '/Admin/ChannelScheduleUpdate.asp' , 'Admin' , 'ChannelScheduleUpdate.asp' , 2671 , 'Admin' , '02/01/2018 17:57:34' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 39 , '/Admin/ChannelUpdate.asp' , 'Admin' , 'ChannelUpdate.asp' , 1089 , 'Admin' , '02/01/2018 17:29:32' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 234 , '/Admin/Chart.asp' , 'Admin' , 'Chart.asp' , 4715 , 'Admin' , '16/04/2018 11:12:26' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 235 , '/Admin/Chartme.asp' , 'Admin' , 'Chartme.asp' , 4522 , 'Admin' , '13/04/2018 16:23:56' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 40 , '/Admin/Collection.asp' , 'Admin' , 'Collection.asp' , 6261 , 'Admin' , '03/10/2018 11:52:06' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 41 , '/Admin/CollectionAdd.asp' , 'Admin' , 'CollectionAdd.asp' , 717 , 'Admin' , '02/11/2017 21:51:14' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 42 , '/Admin/CollectionAddItem.asp' , 'Admin' , 'CollectionAddItem.asp' , 2945 , 'Admin' , '24/07/2018 11:21:11' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 302 , '/Admin/CollectionAddItemDo - Copy.asp' , 'Admin' , 'CollectionAddItemDo - Copy.asp' , 8313 , 'Admin' , '02/04/2018 17:00:22' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 43 , '/Admin/CollectionAddItemDo.asp' , 'Admin' , 'CollectionAddItemDo.asp' , 3203 , 'Admin' , '04/10/2018 09:45:17' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 44 , '/Admin/CollectionDelete.asp' , 'Admin' , 'CollectionDelete.asp' , 2339 , 'Admin' , '02/04/2018 17:00:22' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 281 , '/Admin/CollectionDeleteItem.asp' , 'Admin' , 'CollectionDeleteItem.asp' , 2537 , 'Admin' , '06/07/2018 11:11:02' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 282 , '/Admin/CollectionDeleteItemDo.asp' , 'Admin' , 'CollectionDeleteItemDo.asp' , 905 , 'Admin' , '06/07/2018 11:16:12' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 45 , '/Admin/CollectionEditor.asp' , 'Admin' , 'CollectionEditor.asp' , 7290 , 'Admin' , '23/08/2018 16:56:08' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 46 , '/Admin/CollectionItems.asp' , 'Admin' , 'CollectionItems.asp' , 9435 , 'Admin' , '02/07/2018 13:25:16' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 47 , '/Admin/CollectionUpdate.asp' , 'Admin' , 'CollectionUpdate.asp' , 966 , 'Admin' , '03/01/2018 11:29:14' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 298 , '/Admin/CompareLists.asp' , 'Admin' , 'CompareLists.asp' , 10516 , 'Admin' , '27/07/2018 14:47:29' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 299 , '/Admin/CompareLists2.asp' , 'Admin' , 'CompareLists2.asp' , 6274 , 'Admin' , '23/07/2018 15:36:35' , '23/07/2018 15:36:44' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 48 , '/Admin/Console.asp' , 'Admin' , 'Console.asp' , 20935 , 'Admin' , '20/05/2018 19:56:26' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 49 , '/Admin/ConsoleAssets.asp' , 'Admin' , 'ConsoleAssets.asp' , 12654 , 'Admin' , '02/04/2018 17:00:22' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 50 , '/Admin/consoleHeader.asp' , 'Admin' , 'consoleHeader.asp' , 4716 , 'Admin' , '15/02/2018 18:01:30' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 192 , '/Admin/Console-old.asp' , 'Admin' , 'Console-old.asp' , 21005 , 'Admin' , '31/03/2018 17:56:58' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 51 , '/Admin/ConsoleStatus.asp' , 'Admin' , 'ConsoleStatus.asp' , 11938 , 'Admin' , '09/07/2018 14:14:32' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 52 , '/Admin/DashBoard.asp' , 'Admin' , 'DashBoard.asp' , 8361 , 'Admin' , '12/09/2018 10:13:17' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 265 , '/Admin/DashboardEditor.asp' , 'Admin' , 'DashboardEditor.asp' , 19861 , 'Admin' , '02/10/2018 16:50:15' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 264 , '/Admin/DashBoard-OLD.asp' , 'Admin' , 'DashBoard-OLD.asp' , 5621 , 'Admin' , '15/04/2018 12:39:40' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 53 , '/Admin/DashBoardUpdate.asp' , 'Admin' , 'DashBoardUpdate.asp' , 1169 , 'Admin' , '08/04/2018 12:53:06' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 54 , '/Admin/Datasets.asp' , 'Admin' , 'Datasets.asp' , 5208 , 'Admin' , '11/04/2018 12:34:04' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 220 , '/Admin/default.asp' , 'Admin' , 'default.asp' , 86 , 'Admin' , '05/04/2018 09:55:26' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 55 , '/Admin/DeployedByPeriod.asp' , 'Admin' , 'DeployedByPeriod.asp' , 11366 , 'Admin' , '02/04/2018 17:00:22' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 221 , '/Admin/DoAddApp.asp' , 'Admin' , 'DoAddApp.asp' , 708 , 'Admin' , '09/04/2018 09:27:08' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 56 , '/Admin/DoAddASlot.asp' , 'Admin' , 'DoAddASlot.asp' , 2121 , 'Admin' , '16/07/2018 15:56:23' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 57 , '/Admin/DoAddAssetToSlot.asp' , 'Admin' , 'DoAddAssetToSlot.asp' , 10369 , 'Admin' , '02/04/2018 17:00:22' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 58 , '/Admin/DoAddToCollection.asp' , 'Admin' , 'DoAddToCollection.asp' , 8423 , 'Admin' , '03/01/2018 10:34:56' , '22/03/2018 17:31:44' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 266 , '/Admin/DoDashChange.asp' , 'Admin' , 'DoDashChange.asp' , 3427 , 'Admin' , '08/06/2018 15:00:18' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 59 , '/Admin/DoDelCollection.asp' , 'Admin' , 'DoDelCollection.asp' , 740 , 'Admin' , '03/01/2018 11:29:48' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 60 , '/Admin/DoExtendSlots.asp' , 'Admin' , 'DoExtendSlots.asp' , 1885 , 'Admin' , '07/02/2018 21:07:00' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 61 , '/Admin/doLookupUser.asp' , 'Admin' , 'doLookupUser.asp' , 573 , 'Admin' , '03/01/2018 16:55:22' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 222 , '/Admin/DoRemoveApp.asp' , 'Admin' , 'DoRemoveApp.asp' , 770 , 'Admin' , '08/04/2018 21:58:00' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 185 , '/Admin/doRemoveStop.asp' , 'Admin' , 'doRemoveStop.asp' , 2089 , 'Admin' , '21/03/2018 15:48:30' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 62 , '/Admin/Edit.asp' , 'Admin' , 'Edit.asp' , 29278 , 'Admin' , '28/09/2018 10:10:48' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 188 , '/Admin/Edit2.asp' , 'Admin' , 'Edit2.asp' , 12071 , 'Admin' , '28/02/2018 20:17:38' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 63 , '/Admin/EditDelete.asp' , 'Admin' , 'EditDelete.asp' , 2557 , 'Admin' , '15/05/2018 16:17:08' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 64 , '/Admin/EditDo.asp' , 'Admin' , 'EditDo.asp' , 8692 , 'Admin' , '25/07/2018 16:02:41' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 65 , '/Admin/Export.asp' , 'Admin' , 'Export.asp' , 7461 , 'Admin' , '03/07/2018 15:36:13' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 296 , '/Admin/Export/_exportToCSV.asp' , 'Export' , '_exportToCSV.asp' , 2528 , 'Export' , '16/07/2018 08:50:49' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 294 , '/Admin/Export/_exportView.asp' , 'Export' , '_exportView.asp' , 2848 , 'Export' , '16/07/2018 14:07:39' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 293 , '/Admin/Export/ZTP.asp' , 'Export' , 'ZTP.asp' , 2992 , 'Export' , '16/07/2018 13:48:54' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 279 , '/Admin/Export_AssetsByAppBySlice.asp' , 'Admin' , 'Export_AssetsByAppBySlice.asp' , 12523 , 'Admin' , '25/06/2018 12:10:16' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 166 , '/Admin/FileUpload.asp' , 'Admin' , 'FileUpload.asp' , 8426 , 'Admin' , '30/07/2018 19:37:48' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 167 , '/Admin/FileUploadDo.asp' , 'Admin' , 'FileUploadDo.asp' , 14115 , 'Admin' , '15/03/2018 09:51:34' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 66 , '/Admin/GaugeClone.asp' , 'Admin' , 'GaugeClone.asp' , 377 , 'Admin' , '02/01/2018 19:27:46' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 67 , '/Admin/GaugeDelete.asp' , 'Admin' , 'GaugeDelete.asp' , 840 , 'Admin' , '02/01/2018 19:18:04' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 68 , '/Admin/GaugeEditor.asp' , 'Admin' , 'GaugeEditor.asp' , 13214 , 'Admin' , '08/04/2018 11:11:30' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 223 , '/Admin/Gauges.asp' , 'Admin' , 'Gauges.asp' , 3590 , 'Admin' , '08/04/2018 12:52:02' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 276 , '/Admin/GrantAccess.asp' , 'Admin' , 'GrantAccess.asp' , 1601 , 'Admin' , '08/06/2018 19:21:30' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 268 , '/Admin/ItemCollections.asp' , 'Admin' , 'ItemCollections.asp' , 15721 , 'Admin' , '11/09/2018 10:32:31' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 316 , '/Admin/ItemCollections2.asp' , 'Admin' , 'ItemCollections2.asp' , 9451 , 'Admin' , '22/08/2018 14:38:23' , '22/08/2018 14:38:33' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 269 , '/Admin/ItemCollectionsDo.asp' , 'Admin' , 'ItemCollectionsDo.asp' , 3593 , 'Admin' , '31/08/2018 10:20:04' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 317 , '/Admin/ItemCollectionsDo-old.asp' , 'Admin' , 'ItemCollectionsDo-old.asp' , 3437 , 'Admin' , '20/07/2018 11:30:11' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 289 , '/Admin/lib.asp' , 'Admin' , 'lib.asp' , 1875 , 'Admin' , '06/01/2014 15:42:26' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 69 , '/Admin/List.asp' , 'Admin' , 'List.asp' , 26067 , 'Admin' , '04/09/2018 11:26:16' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 70 , '/Admin/mappingListApps.asp' , 'Admin' , 'mappingListApps.asp' , 1810 , 'Admin' , '07/02/2018 19:15:22' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 224 , '/Admin/MenuGroups.asp' , 'Admin' , 'MenuGroups.asp' , 2149 , 'Admin' , '10/04/2018 11:24:56' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 71 , '/Admin/miniConsole.asp' , 'Admin' , 'miniConsole.asp' , 3344 , 'Admin' , '15/02/2018 17:55:28' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 72 , '/Admin/NotificationDelete.asp' , 'Admin' , 'NotificationDelete.asp' , 694 , 'Admin' , '02/01/2018 19:08:06' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 73 , '/Admin/NotificationEditor.asp' , 'Admin' , 'NotificationEditor.asp' , 9791 , 'Admin' , '17/04/2018 20:56:52' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 74 , '/Admin/NotificationsByAssets.asp' , 'Admin' , 'NotificationsByAssets.asp' , 14174 , 'Admin' , '02/08/2018 11:30:10' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 236 , '/Admin/NotificationsByAssets2.asp' , 'Admin' , 'NotificationsByAssets2.asp' , 14614 , 'Admin' , '23/07/2018 09:01:48' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 75 , '/Admin/NotificationSend.asp' , 'Admin' , 'NotificationSend.asp' , 19036 , 'Admin' , '11/09/2018 13:16:47' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 283 , '/Admin/paginate_bottom.asp' , 'Admin' , 'paginate_bottom.asp' , 1308 , 'Admin' , '17/09/2018 19:53:46' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 284 , '/Admin/paginate_init.asp' , 'Admin' , 'paginate_init.asp' , 636 , 'Admin' , '05/07/2018 15:21:02' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 285 , '/Admin/paginate_top.asp' , 'Admin' , 'paginate_top.asp' , 1390 , 'Admin' , '17/09/2018 19:52:52' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 76 , '/Admin/PDFGenerate.asp' , 'Admin' , 'PDFGenerate.asp' , 474 , 'Admin' , '04/01/2018 13:30:40' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 77 , '/Admin/PDFGenerateDo.asp' , 'Admin' , 'PDFGenerateDo.asp' , 1253 , 'Admin' , '04/01/2018 13:31:04' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 78 , '/Admin/PublishedSurveys.asp' , 'Admin' , 'PublishedSurveys.asp' , 2446 , 'Admin' , '11/09/2018 08:58:57' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 79 , '/Admin/QuickSearch.asp' , 'Admin' , 'QuickSearch.asp' , 8236 , 'Admin' , '06/09/2018 08:29:35' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 80 , '/Admin/ReApplyAppsTransforms.asp' , 'Admin' , 'ReApplyAppsTransforms.asp' , 673 , 'Admin' , '21/08/2018 11:41:53' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 81 , '/Admin/RoleSwitch.asp' , 'Admin' , 'RoleSwitch.asp' , 1520 , 'Admin' , '23/02/2018 09:38:27' , '08/03/2018 16:23:23' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 295 , '/Admin/RunPinToggle.asp' , 'Admin' , 'RunPinToggle.asp' , 693 , 'Admin' , '16/07/2018 16:06:38' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 162 , '/Admin/ScheduledUpdates.asp' , 'Admin' , 'ScheduledUpdates.asp' , 682 , 'Admin' , '05/06/2018 15:12:27' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 82 , '/Admin/ScheduleShiftRange.asp' , 'Admin' , 'ScheduleShiftRange.asp' , 2874 , 'Admin' , '03/01/2018 11:18:40' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 83 , '/Admin/ScheduleSummary.asp' , 'Admin' , 'ScheduleSummary.asp' , 21610 , 'Admin' , '02/04/2018 17:00:22' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 84 , '/Admin/ScheduleView.asp' , 'Admin' , 'ScheduleView.asp' , 8231 , 'Admin' , '06/08/2018 15:31:17' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 85 , '/Admin/SearchAdvanced.asp' , 'Admin' , 'SearchAdvanced.asp' , 4973 , 'Admin' , '02/04/2018 17:00:22' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 86 , '/Admin/SearchByApplication.asp' , 'Admin' , 'SearchByApplication.asp' , 7150 , 'Admin' , '07/06/2018 15:11:28' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 87 , '/Admin/SearchByName.asp' , 'Admin' , 'SearchByName.asp' , 9600 , 'Admin' , '02/04/2018 17:00:22' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 321 , '/Admin/SGB_Search.asp' , 'Admin' , 'SGB_Search.asp' , 3087 , 'Admin' , '12/09/2018 16:42:26' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 290 , '/Admin/side_nav - Copy.asp' , 'Admin' , 'side_nav - Copy.asp' , 5772 , 'Admin' , '12/07/2018 11:38:56' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 291 , '/Admin/side_nav.asp' , 'Admin' , 'side_nav.asp' , 979 , 'Admin' , '12/07/2018 13:47:17' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 88 , '/Admin/SliceNav.asp' , 'Admin' , 'SliceNav.asp' , 9361 , 'Admin' , '02/02/2018 13:52:12' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 90 , '/Admin/SlotAdd.asp' , 'Admin' , 'SlotAdd.asp' , 8496 , 'Admin' , '02/04/2018 17:00:24' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 91 , '/Admin/SlotAddAsset.asp' , 'Admin' , 'SlotAddAsset.asp' , 4955 , 'Admin' , '02/04/2018 17:00:24' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 92 , '/Admin/SlotMove.asp' , 'Admin' , 'SlotMove.asp' , 6590 , 'Admin' , '16/07/2018 16:17:59' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 271 , '/Admin/Slot-OLD.asp' , 'Admin' , 'Slot-OLD.asp' , 44196 , 'Admin' , '12/05/2018 17:07:44' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 93 , '/Admin/SlotPinToggle.asp' , 'Admin' , 'SlotPinToggle.asp' , 716 , 'Admin' , '02/01/2018 19:47:16' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 89 , '/Admin/Slot-Redirect.asp' , 'Admin' , 'Slot-Redirect.asp' , 171 , 'Admin' , '02/01/2018 19:57:08' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 318 , '/Admin/Slots - Copy.asp' , 'Admin' , 'Slots - Copy.asp' , 31513 , 'Admin' , '09/08/2018 08:35:51' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 94 , '/Admin/Slots.asp' , 'Admin' , 'Slots.asp' , 33652 , 'Admin' , '04/09/2018 16:49:01' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 311 , '/Admin/Slots2.asp' , 'Admin' , 'Slots2.asp' , 32527 , 'Admin' , '04/09/2018 14:17:21' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 95 , '/Admin/SlotToggle.asp' , 'Admin' , 'SlotToggle.asp' , 905 , 'Admin' , '15/05/2018 16:21:38' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 96 , '/Admin/SurveyAddQuestion.asp' , 'Admin' , 'SurveyAddQuestion.asp' , 3157 , 'Admin' , '03/01/2018 13:13:24' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 97 , '/Admin/SurveyCreator.asp' , 'Admin' , 'SurveyCreator.asp' , 10870 , 'Admin' , '10/09/2018 16:06:52' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 98 , '/Admin/SurveyDelete.asp' , 'Admin' , 'SurveyDelete.asp' , 1230 , 'Admin' , '03/01/2018 13:30:28' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 99 , '/Admin/SurveyPreview.asp' , 'Admin' , 'SurveyPreview.asp' , 4875 , 'Admin' , '02/04/2018 17:00:24' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 100 , '/Admin/SurveyPublish.asp' , 'Admin' , 'SurveyPublish.asp' , 1457 , 'Admin' , '02/04/2018 17:00:24' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 101 , '/Admin/SurveyPublishDo.asp' , 'Admin' , 'SurveyPublishDo.asp' , 653 , 'Admin' , '03/01/2018 12:53:56' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 102 , '/Admin/SurveyQuestionDelete.asp' , 'Admin' , 'SurveyQuestionDelete.asp' , 952 , 'Admin' , '03/01/2018 13:13:18' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 103 , '/Admin/SurveyResults.asp' , 'Admin' , 'SurveyResults.asp' , 12306 , 'Admin' , '10/09/2018 14:17:01' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 104 , '/Admin/SurveySwapQuestions.asp' , 'Admin' , 'SurveySwapQuestions.asp' , 843 , 'Admin' , '03/01/2018 12:47:16' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 225 , '/Admin/TempTab.asp' , 'Admin' , 'TempTab.asp' , 790 , 'Admin' , '08/04/2018 18:27:38' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 189 , '/Admin/TEST.asp' , 'Admin' , 'TEST.asp' , 3822 , 'Admin' , '01/03/2018 17:27:32' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 105 , '/Admin/TimeTemplateCreate.asp' , 'Admin' , 'TimeTemplateCreate.asp' , 1372 , 'Admin' , '02/01/2018 18:52:26' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 106 , '/Admin/TimeTemplateDelete.asp' , 'Admin' , 'TimeTemplateDelete.asp' , 580 , 'Admin' , '02/01/2018 18:53:54' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 107 , '/Admin/TimeTemplateEditor.asp' , 'Admin' , 'TimeTemplateEditor.asp' , 9480 , 'Admin' , '04/06/2018 14:40:08' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 108 , '/Admin/TimeTemplates.asp' , 'Admin' , 'TimeTemplates.asp' , 1996 , 'Admin' , '02/04/2018 17:00:24' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 109 , '/Admin/UAM.asp' , 'Admin' , 'UAM.asp' , 17988 , 'Admin' , '17/09/2018 17:18:26' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 110 , '/Admin/UAMUpdate.asp' , 'Admin' , 'UAMUpdate.asp' , 6175 , 'Admin' , '02/04/2018 17:00:24' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 319 , '/Admin/UpdateStatus - Copy.asp' , 'Admin' , 'UpdateStatus - Copy.asp' , 6421 , 'Admin' , '13/07/2018 08:46:52' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 273 , '/Admin/UpdateStatus.asp' , 'Admin' , 'UpdateStatus.asp' , 5451 , 'Admin' , '04/09/2018 14:58:52' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 312 , '/Admin/UpdateStatus2.asp' , 'Admin' , 'UpdateStatus2.asp' , 5455 , 'Admin' , '04/09/2018 14:16:32' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 111 , '/Admin/UserAccess.asp' , 'Admin' , 'UserAccess.asp' , 4649 , 'Admin' , '07/06/2018 10:17:46' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 112 , '/Admin/UserAccessDelete.asp' , 'Admin' , 'UserAccessDelete.asp' , 587 , 'Admin' , '03/01/2018 09:45:36' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 113 , '/Admin/UserAccessEditor.asp' , 'Admin' , 'UserAccessEditor.asp' , 15552 , 'Admin' , '02/04/2018 17:00:24' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 114 , '/Admin/UserAccessPending.asp' , 'Admin' , 'UserAccessPending.asp' , 2917 , 'Admin' , '12/04/2018 08:25:26' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 115 , '/Admin/UserAccessUpdate.asp' , 'Admin' , 'UserAccessUpdate.asp' , 3770 , 'Admin' , '03/01/2018 10:11:06' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 226 , '/Admin/UserApps.asp' , 'Admin' , 'UserApps.asp' , 6470 , 'Admin' , '20/05/2018 19:37:44' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 277 , '/Admin/UserSystemAccess.asp' , 'Admin' , 'UserSystemAccess.asp' , 3610 , 'Admin' , '08/06/2018 11:02:30' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 227 , '/Admin/UserTab.asp' , 'Admin' , 'UserTab.asp' , 863 , 'Admin' , '25/07/2018 16:35:55' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 190 , '/Admin/Utils/BottleLookups.asp' , 'Utils' , 'BottleLookups.asp' , 1085 , 'Utils' , '25/03/2018 20:14:30' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 164 , '/Admin/Utils/Bottlemenu.asp' , 'Utils' , 'Bottlemenu.asp' , 2001 , 'Utils' , '25/03/2018 20:26:38' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 228 , '/Admin/Utils/BottleMenuTabs.asp' , 'Utils' , 'BottleMenuTabs.asp' , 2267 , 'Utils' , '08/04/2018 11:22:14' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 187 , '/Admin/Utils/BottlePermit.asp' , 'Utils' , 'BottlePermit.asp' , 1403 , 'Utils' , '25/03/2018 20:14:16' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 119 , '/Admin/Utils/DirListing.asp' , 'Utils' , 'DirListing.asp' , 1556 , 'Utils' , '24/02/2018 10:48:10' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 120 , '/Admin/Utils/FilePermissions.asp' , 'Utils' , 'FilePermissions.asp' , 6552 , 'Utils' , '09/04/2018 11:27:10' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 121 , '/Admin/Utils/GenerateMenu.asp' , 'Utils' , 'GenerateMenu.asp' , 250 , 'Utils' , '04/04/2018 16:55:01' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 193 , '/Admin/Utils/GenerateMenu2.asp' , 'Utils' , 'GenerateMenu2.asp' , 250 , 'Utils' , '02/04/2018 09:09:40' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 122 , '/Admin/Utils/GenerateMenuFn.asp' , 'Utils' , 'GenerateMenuFn.asp' , 5704 , 'Utils' , '16/03/2018 14:17:58' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 194 , '/Admin/Utils/GenerateMenuFn2.asp' , 'Utils' , 'GenerateMenuFn2.asp' , 5770 , 'Utils' , '26/09/2018 13:43:28' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 163 , '/Admin/Utils/MenuPermissions.asp' , 'Utils' , 'MenuPermissions.asp' , 6194 , 'Utils' , '09/04/2018 09:52:18' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 123 , '/Admin/Utils/RegisterFiles.asp' , 'Utils' , 'RegisterFiles.asp' , 3417 , 'Utils' , '02/10/2018 11:21:58' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 124 , '/Admin/Utils/RoleSwitch.asp' , 'Utils' , 'RoleSwitch.asp' , 1521 , 'Utils' , '26/02/2018 10:52:44' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 125 , '/Admin/Utils/Script.asp' , 'Utils' , 'Script.asp' , 3165 , 'Utils' , '16/04/2018 08:21:16' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 165 , '/Admin/Utils/ScriptFn.asp' , 'Utils' , 'ScriptFn.asp' , 2790 , 'Utils' , '10/03/2018 10:18:40' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 116 , '/Admin/WhatIfAppsList.asp' , 'Admin' , 'WhatIfAppsList.asp' , 15779 , 'Admin' , '13/07/2018 09:34:50' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 117 , '/Admin/WhatIfAssetList.asp' , 'Admin' , 'WhatIfAssetList.asp' , 10150 , 'Admin' , '26/04/2018 13:49:04' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 313 , '/Admin/WorkstreamBookings.asp' , 'Admin' , 'WorkstreamBookings.asp' , 9708 , 'Admin' , '24/08/2018 14:07:40' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 320 , '/Admin/WorkstreamChannels.asp' , 'Admin' , 'WorkstreamChannels.asp' , 19906 , 'Admin' , '10/09/2018 10:18:41' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 304 , '/Admin/WorkstreamCollections.asp' , 'Admin' , 'WorkstreamCollections.asp' , 7918 , 'Admin' , '26/09/2018 16:25:39' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 309 , '/Admin/WorkstreamDeployedByPeriod.asp' , 'Admin' , 'WorkstreamDeployedByPeriod.asp' , 11708 , 'Admin' , '09/08/2018 16:00:21' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 307 , '/Admin/WorkstreamSchedule.asp' , 'Admin' , 'WorkstreamSchedule.asp' , 8176 , 'Admin' , '26/09/2018 16:40:06' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 310 , '/Admin/WorkstreamSlotEvents.asp' , 'Admin' , 'WorkstreamSlotEvents.asp' , 7984 , 'Admin' , '03/09/2018 12:03:12' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 303 , '/Admin/WorkstreamTab.asp' , 'Admin' , 'WorkstreamTab.asp' , 811 , 'Admin' , '25/07/2018 16:35:25' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 314 , '/Admin/WorkstreamView.asp' , 'Admin' , 'WorkstreamView.asp' , 1375 , 'Admin' , '05/09/2018 17:19:00' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 137 , '/ARM_footer.asp' , 'arm-wwwroot' , 'ARM_footer.asp' , 3047 , 'arm-wwwroot' , '09/02/2018 09:13:52' , '04/10/2018 11:49:04' , 1)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 138 , '/AssetAsis.asp' , 'arm-wwwroot' , 'AssetAsis.asp' , 13215 , 'arm-wwwroot' , '03/04/2018 16:24:44' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 168 , '/AssetCheck/Asis.asp' , 'AssetCheck' , 'Asis.asp' , 9012 , 'AssetCheck' , '07/12/2016 16:41:50' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 169 , '/AssetCheck/AssetConfirm.asp' , 'AssetCheck' , 'AssetConfirm.asp' , 738 , 'AssetCheck' , '16/03/2018 10:51:32' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 170 , '/AssetCheck/BaseBuild.asp' , 'AssetCheck' , 'BaseBuild.asp' , 13681 , 'AssetCheck' , '06/06/2017 17:37:18' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 171 , '/AssetCheck/Custom_PST.asp' , 'AssetCheck' , 'Custom_PST.asp' , 6540 , 'AssetCheck' , '07/12/2016 16:42:54' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 172 , '/AssetCheck/DoAddComment.asp' , 'AssetCheck' , 'DoAddComment.asp' , 1303 , 'AssetCheck' , '01/10/2016 17:57:54' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 173 , '/AssetCheck/doCustomPST_Update.asp' , 'AssetCheck' , 'doCustomPST_Update.asp' , 1213 , 'AssetCheck' , '29/09/2016 11:01:52' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 174 , '/AssetCheck/DoPostComment.asp' , 'AssetCheck' , 'DoPostComment.asp' , 726 , 'AssetCheck' , '16/03/2018 11:03:12' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 175 , '/AssetCheck/DoRemoveApp.asp' , 'AssetCheck' , 'DoRemoveApp.asp' , 700 , 'AssetCheck' , '16/03/2018 10:34:42' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 176 , '/AssetCheck/DoRemoveComment.asp' , 'AssetCheck' , 'DoRemoveComment.asp' , 1459 , 'AssetCheck' , '16/03/2018 10:41:56' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 177 , '/AssetCheck/doUpdateAsset.asp' , 'AssetCheck' , 'doUpdateAsset.asp' , 12202 , 'AssetCheck' , '16/03/2018 11:02:16' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 178 , '/AssetCheck/Header.asp' , 'AssetCheck' , 'Header.asp' , 560 , 'AssetCheck' , '30/09/2016 20:57:22' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 179 , '/AssetCheck/MappedDrives.asp' , 'AssetCheck' , 'MappedDrives.asp' , 1617 , 'AssetCheck' , '09/06/2017 22:34:08' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 180 , '/AssetCheck/myHeader.asp' , 'AssetCheck' , 'myHeader.asp' , 646 , 'AssetCheck' , '07/05/2017 15:42:24' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 292 , '/AssetCheck/PDF.asp' , 'AssetCheck' , 'PDF.asp' , 18742 , 'AssetCheck' , '12/07/2018 09:03:22' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 182 , '/AssetCheck/showDetails.asp' , 'AssetCheck' , 'showDetails.asp' , 26074 , 'AssetCheck' , '16/03/2018 10:42:16' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 183 , '/AssetCheck/UserApps.asp' , 'AssetCheck' , 'UserApps.asp' , 6240 , 'AssetCheck' , '16/03/2018 10:28:24' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 139 , '/AssetConfirm.asp' , 'arm-wwwroot' , 'AssetConfirm.asp' , 16368 , 'arm-wwwroot' , '04/01/2018 09:50:34' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 140 , '/AssetSummaryView.asp' , 'arm-wwwroot' , 'AssetSummaryView.asp' , 610 , 'arm-wwwroot' , '03/01/2018 16:46:20' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 141 , '/AssetTabMenu.asp' , 'arm-wwwroot' , 'AssetTabMenu.asp' , 971 , 'arm-wwwroot' , '04/01/2018 11:14:58' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 184 , '/Booking/AssetConfirm.asp' , 'Booking' , 'AssetConfirm.asp' , 15112 , 'Booking' , '26/06/2018 14:08:48' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 126 , '/Booking/BookDates.asp' , 'Booking' , 'BookDates.asp' , 13102 , 'Booking' , '24/09/2018 15:59:25' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 308 , '/Booking/BookDates2.asp' , 'Booking' , 'BookDates2.asp' , 11654 , 'Booking' , '03/08/2018 11:04:41' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 127 , '/Booking/BookOptions.asp' , 'Booking' , 'BookOptions.asp' , 5002 , 'Booking' , '24/09/2018 13:51:22' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 128 , '/Booking/CancelBooking.asp' , 'Booking' , 'CancelBooking.asp' , 17385 , 'Booking' , '24/09/2018 14:21:18' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 129 , '/Booking/CheckBooking.asp' , 'Booking' , 'CheckBooking.asp' , 6564 , 'Booking' , '24/09/2018 14:28:10' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 130 , '/Booking/ConfirmBookDate.asp' , 'Booking' , 'ConfirmBookDate.asp' , 25728 , 'Booking' , '24/09/2018 16:14:37' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 272 , '/Booking/ConfirmRegistration.asp' , 'Booking' , 'ConfirmRegistration.asp' , 12598 , 'Booking' , '21/09/2018 10:42:04' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 131 , '/Booking/MakeBooking.asp' , 'Booking' , 'MakeBooking.asp' , 26893 , 'Booking' , '03/10/2018 15:38:31' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 132 , '/Booking/ProgressBar.asp' , 'Booking' , 'ProgressBar.asp' , 5601 , 'Booking' , '20/09/2018 17:12:21' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 133 , '/Booking/UpdateCache.asp' , 'Booking' , 'UpdateCache.asp' , 1005 , 'Booking' , '26/06/2018 14:11:22' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 270 , '/Booking/UpdateDo.asp' , 'Booking' , 'UpdateDo.asp' , 4364 , 'Booking' , '24/09/2018 13:56:35' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 142 , '/check.asp' , 'arm-wwwroot' , 'check.asp' , 1086 , 'arm-wwwroot' , '08/03/2018 17:12:10' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 191 , '/Custom/myPDF.asp' , 'Custom' , 'myPDF.asp' , 20088 , 'Custom' , '04/01/2018 13:41:58' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 143 , '/default.asp' , 'arm-wwwroot' , 'default.asp' , 170 , 'arm-wwwroot' , '05/01/2018 11:58:06' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 229 , '/DoAddApp.asp' , 'arm-wwwroot' , 'DoAddApp.asp' , 708 , 'arm-wwwroot' , '09/04/2018 09:23:20' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 144 , '/DoPostComment.asp' , 'arm-wwwroot' , 'DoPostComment.asp' , 728 , 'arm-wwwroot' , '04/01/2018 11:04:56' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 145 , '/DoRemoveApp.asp' , 'arm-wwwroot' , 'DoRemoveApp.asp' , 764 , 'arm-wwwroot' , '08/04/2018 21:58:22' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 195 , '/endpage.asp' , 'arm-wwwroot' , 'endpage.asp' , 512 , 'arm-wwwroot' , '02/04/2018 11:07:46' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 146 , '/Footer.asp' , 'arm-wwwroot' , 'Footer.asp' , 1992 , 'arm-wwwroot' , '28/02/2018 15:02:52' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 196 , '/Footer2.asp' , 'arm-wwwroot' , 'Footer2.asp' , 2127 , 'arm-wwwroot' , '04/04/2018 14:58:24' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 147 , '/Header.asp' , 'arm-wwwroot' , 'Header.asp' , 572 , 'arm-wwwroot' , '04/01/2018 17:30:54' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 324 , '/help.asp' , 'arm-wwwroot' , 'help.asp' , 1551 , 'arm-wwwroot' , '02/10/2018 10:59:11' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 325 , '/Help/default.asp' , 'Help' , 'default.asp' , 1555 , 'Help' , '02/10/2018 11:25:35' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 148 , '/home.asp' , 'arm-wwwroot' , 'home.asp' , 2891 , 'arm-wwwroot' , '02/10/2018 16:48:32' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 149 , '/InvalidLicence.asp' , 'arm-wwwroot' , 'InvalidLicence.asp' , 2046 , 'arm-wwwroot' , '02/01/2018 12:40:46' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 150 , '/multiResults.asp' , 'arm-wwwroot' , 'multiResults.asp' , 6113 , 'arm-wwwroot' , '04/01/2018 11:04:26' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 322 , '/NoMenu.asp' , 'arm-wwwroot' , 'NoMenu.asp' , 2692 , 'arm-wwwroot' , '10/09/2018 11:39:21' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 278 , '/page.asp' , 'arm-wwwroot' , 'page.asp' , 1531 , 'arm-wwwroot' , '12/06/2018 08:47:27' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 151 , '/permissionDenied.asp' , 'arm-wwwroot' , 'permissionDenied.asp' , 2575 , 'arm-wwwroot' , '20/05/2018 10:51:46' , '04/10/2018 11:49:04' , 1)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 152 , '/register.asp' , 'arm-wwwroot' , 'register.asp' , 1939 , 'arm-wwwroot' , '02/01/2018 14:41:16' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 230 , '/Review/doAddToHitList.asp' , 'Review' , 'doAddToHitList.asp' , 690 , 'Review' , '09/04/2018 11:37:46' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 231 , '/Review/HitList.asp' , 'Review' , 'HitList.asp' , 10071 , 'Review' , '11/04/2018 16:41:04' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 232 , '/Review/ShowInfo.asp' , 'Review' , 'ShowInfo.asp' , 10314 , 'Review' , '11/04/2018 16:33:32' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 153 , '/search.asp' , 'arm-wwwroot' , 'search.asp' , 93 , 'arm-wwwroot' , '04/01/2018 11:06:58' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 154 , '/showDetails.asp' , 'arm-wwwroot' , 'showDetails.asp' , 34353 , 'arm-wwwroot' , '03/04/2018 15:10:14' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 155 , '/sitecheck.asp' , 'arm-wwwroot' , 'sitecheck.asp' , 2386 , 'arm-wwwroot' , '24/09/2018 14:41:37' , '04/10/2018 11:49:04' , 1)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 156 , '/SiteDown.asp' , 'arm-wwwroot' , 'SiteDown.asp' , 2127 , 'arm-wwwroot' , '21/08/2018 15:09:11' , '04/10/2018 11:49:04' , 1)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 157 , '/SnapShot.asp' , 'arm-wwwroot' , 'SnapShot.asp' , 2584 , 'arm-wwwroot' , '04/01/2018 11:08:42' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 158 , '/StdUserCheck.asp' , 'arm-wwwroot' , 'StdUserCheck.asp' , 13566 , 'arm-wwwroot' , '11/06/2018 13:20:15' , '04/10/2018 11:49:04' , 1)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 134 , '/Survey/Survey.asp' , 'Survey' , 'Survey.asp' , 9206 , 'Survey' , '10/09/2018 11:33:55' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 135 , '/Survey/SurveyComplete.asp' , 'Survey' , 'SurveyComplete.asp' , 1718 , 'Survey' , '08/09/2018 19:08:26' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 136 , '/Survey/SurveyDoPost.asp' , 'Survey' , 'SurveyDoPost.asp' , 1406 , 'Survey' , '03/01/2018 13:40:52' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 118 , '/System/ServerVariables.asp' , 'System' , 'ServerVariables.asp' , 1650 , 'System' , '17/04/2017 22:47:56' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 159 , '/systemInfo.asp' , 'arm-wwwroot' , 'systemInfo.asp' , 206 , 'arm-wwwroot' , '02/01/2018 14:02:34' , '04/10/2018 11:49:04' , 1)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 160 , '/UpdateCache.asp' , 'arm-wwwroot' , 'UpdateCache.asp' , 8090 , 'arm-wwwroot' , '04/01/2018 10:50:48' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 161 , '/UserApps.asp' , 'arm-wwwroot' , 'UserApps.asp' , 6842 , 'arm-wwwroot' , '04/01/2018 10:34:04' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 212 , '/views/_TableView.asp' , 'views' , '_TableView.asp' , 9348 , 'views' , '03/09/2018 14:49:20' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 197 , '/views/AppsAndComponents.asp' , 'views' , 'AppsAndComponents.asp' , 2016 , 'views' , '02/01/2018 13:44:44' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 198 , '/views/AppsBareaCounts.asp' , 'views' , 'AppsBareaCounts.asp' , 251 , 'views' , '02/01/2018 13:23:08' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 199 , '/views/AppsBareaCountsAsIs.asp' , 'views' , 'AppsBareaCountsAsIs.asp' , 256 , 'views' , '02/01/2018 13:22:56' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 200 , '/views/AppsPivot.asp' , 'views' , 'AppsPivot.asp' , 320 , 'views' , '02/01/2018 13:39:06' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 201 , '/views/AppUserList.asp' , 'views' , 'AppUserList.asp' , 1447 , 'views' , '02/01/2018 12:50:38' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 301 , '/views/AssetIds.asp' , 'views' , 'AssetIds.asp' , 462 , 'views' , '24/07/2018 14:02:29' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 202 , '/views/AssetsNotDeployed.asp' , 'views' , 'AssetsNotDeployed.asp' , 2747 , 'views' , '02/01/2018 12:58:42' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 203 , '/views/Console.asp' , 'views' , 'Console.asp' , 4813 , 'views' , '02/01/2018 13:17:54' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 204 , '/views/CSAT.asp' , 'views' , 'CSAT.asp' , 893 , 'views' , '02/01/2018 13:38:50' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 205 , '/views/default.asp' , 'views' , 'default.asp' , 736 , 'views' , '03/07/2018 16:31:30' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 206 , '/views/DeployedAssets.asp' , 'views' , 'DeployedAssets.asp' , 565 , 'views' , '02/01/2018 13:55:28' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 297 , '/views/Export.asp' , 'views' , 'Export.asp' , 249 , 'views' , '23/07/2018 09:34:32' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 207 , '/views/GaugeAssetList.asp' , 'views' , 'GaugeAssetList.asp' , 1094 , 'views' , '02/01/2018 13:08:04' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 208 , '/views/GetChannelSchedule.asp' , 'views' , 'GetChannelSchedule.asp' , 2517 , 'views' , '03/01/2018 11:15:18' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 209 , '/views/LatestID.asp' , 'views' , 'LatestID.asp' , 501 , 'views' , '02/01/2018 13:20:44' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 210 , '/views/List.asp' , 'views' , 'List.asp' , 667 , 'views' , '02/01/2018 12:51:04' , '04/10/2018 11:49:04' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 237 , '/views/Nissan/AGBActions.asp' , 'Nissan' , 'AGBActions.asp' , 512 , 'Nissan' , '13/11/2017 11:40:31' , '20/04/2018 09:17:16' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 238 , '/views/Nissan/AGBDecisions.asp' , 'Nissan' , 'AGBDecisions.asp' , 517 , 'Nissan' , '13/11/2017 11:40:31' , '20/04/2018 09:17:16' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 239 , '/views/Nissan/AGBMinutes.asp' , 'Nissan' , 'AGBMinutes.asp' , 515 , 'Nissan' , '13/11/2017 11:41:13' , '20/04/2018 09:17:16' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 240 , '/views/Nissan/AppBreach.asp' , 'Nissan' , 'AppBreach.asp' , 316 , 'Nissan' , '19/04/2017 15:42:00' , '20/04/2018 09:17:16' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 241 , '/views/Nissan/AppDSL.asp' , 'Nissan' , 'AppDSL.asp' , 305 , 'Nissan' , '21/04/2017 11:20:13' , '20/04/2018 09:17:16' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 242 , '/views/Nissan/AppDSLRequest.asp' , 'Nissan' , 'AppDSLRequest.asp' , 320 , 'Nissan' , '26/04/2017 15:45:19' , '20/04/2018 09:17:16' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 243 , '/views/Nissan/Applications.asp' , 'Nissan' , 'Applications.asp' , 409 , 'Nissan' , '30/03/2017 15:10:30' , '20/04/2018 09:17:16' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 244 , '/views/Nissan/AppManualAsIs.asp' , 'Nissan' , 'AppManualAsIs.asp' , 321 , 'Nissan' , '29/03/2017 15:10:52' , '20/04/2018 09:17:16' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 245 , '/views/Nissan/AppNewRequests.asp' , 'Nissan' , 'AppNewRequests.asp' , 313 , 'Nissan' , '19/04/2017 15:35:05' , '20/04/2018 09:17:16' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 246 , '/views/Nissan/AppPackagingRequest.asp' , 'Nissan' , 'AppPackagingRequest.asp' , 324 , 'Nissan' , '26/04/2017 15:04:44' , '20/04/2018 09:17:16' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 247 , '/views/Nissan/AppPendingRequests.asp' , 'Nissan' , 'AppPendingRequests.asp' , 317 , 'Nissan' , '19/04/2017 15:42:16' , '20/04/2018 09:17:16' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 248 , '/views/Nissan/AppTestRequest.asp' , 'Nissan' , 'AppTestRequest.asp' , 321 , 'Nissan' , '26/04/2017 15:45:35' , '20/04/2018 09:17:16' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 249 , '/views/Nissan/BreachApplications.asp' , 'Nissan' , 'BreachApplications.asp' , 314 , 'Nissan' , '30/03/2017 14:41:05' , '20/04/2018 09:17:16' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 251 , '/views/Nissan/DeltaDSL_DSLPhysicall.asp' , 'Nissan' , 'DeltaDSL_DSLPhysicall.asp' , 360 , 'Nissan' , '30/03/2017 10:16:21' , '17/04/2018 11:32:46' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 252 , '/views/Nissan/DeltaDSL_NoManualInstall.asp' , 'Nissan' , 'DeltaDSL_NoManualInstall.asp' , 381 , 'Nissan' , '29/03/2017 15:40:25' , '17/04/2018 11:32:46' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 250 , '/views/Nissan/DeltaDSLPhysical_DSL.asp' , 'Nissan' , 'DeltaDSLPhysical_DSL.asp' , 360 , 'Nissan' , '30/03/2017 10:17:49' , '17/04/2018 11:32:46' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 253 , '/views/Nissan/DeltaManualInstall_NoDSL.asp' , 'Nissan' , 'DeltaManualInstall_NoDSL.asp' , 410 , 'Nissan' , '26/04/2017 11:08:41' , '17/04/2018 11:32:46' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 254 , '/views/Nissan/DeployNMUKTargets.asp' , 'Nissan' , 'DeployNMUKTargets.asp' , 460 , 'Nissan' , '01/06/2017 17:02:56' , '20/04/2018 09:17:16' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 255 , '/views/Nissan/DSL.asp' , 'Nissan' , 'DSL.asp' , 274 , 'Nissan' , '30/03/2017 09:09:26' , '20/04/2018 09:17:16' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 256 , '/views/Nissan/MaturityWashupByModel.asp' , 'Nissan' , 'MaturityWashupByModel.asp' , 638 , 'Nissan' , '09/05/2017 16:06:01' , '20/04/2018 09:17:16' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 257 , '/views/Nissan/NewApplications.asp' , 'Nissan' , 'NewApplications.asp' , 382 , 'Nissan' , '30/03/2017 11:26:13' , '20/04/2018 09:17:16' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 261 , '/views/Nissan/SGBOutput.asp' , 'Nissan' , 'SGBOutput.asp' , 484 , 'Nissan' , '14/12/2017 12:24:52' , '20/04/2018 09:17:16' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 262 , '/views/Nissan/Tombstone.asp' , 'Nissan' , 'Tombstone.asp' , 622 , 'Nissan' , '11/05/2017 16:12:03' , '20/04/2018 09:17:16' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 263 , '/views/Nissan/ZTP Export.asp' , 'Nissan' , 'ZTP Export.asp' , 1620 , 'Nissan' , '04/07/2017 15:38:26' , '20/04/2018 09:17:16' , 0)
insert [ARM_CORE]..[A_File] ( [FileID] ,[FilePath] ,[GroupName] ,[Name] ,[Size] ,[Folder] ,[LastModified] ,[LastSync] ,[Ignore] ) values ( 211 , '/views/NotificationLog.asp' , 'views' , 'NotificationLog.asp' , 1476 , 'views' , '15/05/2018 13:57:02' , '04/10/2018 11:49:04' , 0)
set IDENTITY_INSERT  [ARM_CORE]..[A_File] OFF
TRUNCATE TABLE  [ARM_CORE]..[A_FileAccess]

set IDENTITY_INSERT  [ARM_CORE]..[A_FileAccess] ON
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 17242 , 6 , 3)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 17243 , 12 , 3)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 17244 , 15 , 3)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 17245 , 36 , 3)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 17246 , 234 , 3)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 17247 , 40 , 3)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 17248 , 281 , 3)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 17249 , 282 , 3)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 17250 , 48 , 3)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 17251 , 51 , 3)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 17252 , 52 , 3)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 17253 , 55 , 3)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 17254 , 65 , 3)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 17255 , 69 , 3)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 17256 , 78 , 3)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 17257 , 83 , 3)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 17258 , 84 , 3)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 17259 , 85 , 3)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 17260 , 86 , 3)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 17261 , 87 , 3)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 17262 , 94 , 3)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 17263 , 97 , 3)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 17264 , 109 , 3)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 17265 , 116 , 3)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 17266 , 201 , 3)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21119 , 3 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21120 , 6 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21121 , 7 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21122 , 12 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21123 , 13 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21124 , 15 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21125 , 25 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21126 , 29 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21127 , 35 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21128 , 36 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21129 , 234 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21130 , 40 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21131 , 44 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21132 , 281 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21133 , 282 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21134 , 48 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21135 , 51 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21136 , 52 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21137 , 54 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21138 , 55 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21139 , 60 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21140 , 65 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21141 , 166 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21142 , 167 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21143 , 68 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21144 , 276 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21145 , 69 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21146 , 73 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21147 , 78 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21148 , 80 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21149 , 162 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21150 , 83 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21151 , 84 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21152 , 85 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21153 , 86 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21154 , 87 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21155 , 94 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21156 , 311 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21157 , 97 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21158 , 108 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21159 , 109 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21160 , 111 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21161 , 115 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21162 , 277 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21163 , 164 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21164 , 187 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21165 , 119 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21166 , 120 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21167 , 121 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21168 , 122 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21169 , 163 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21170 , 123 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21171 , 125 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21172 , 165 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21173 , 116 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21174 , 320 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21175 , 304 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 19705 , 304 , 3)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21176 , 310 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21177 , 201 , 6)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21733 , 6 , 1)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21734 , 12 , 1)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21735 , 36 , 1)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21736 , 234 , 1)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21737 , 48 , 1)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21738 , 51 , 1)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21739 , 52 , 1)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21740 , 55 , 1)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21741 , 65 , 1)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21742 , 69 , 1)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21743 , 83 , 1)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21744 , 84 , 1)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21745 , 85 , 1)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21746 , 86 , 1)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21747 , 87 , 1)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21748 , 94 , 1)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21749 , 304 , 1)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21750 , 201 , 1)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21751 , 300 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21752 , 186 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21753 , 315 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21754 , 233 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21755 , 1 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21756 , 2 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21757 , 213 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21758 , 4 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21759 , 267 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21760 , 323 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21761 , 214 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21762 , 5 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21763 , 8 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21764 , 9 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21765 , 10 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21766 , 326 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21767 , 11 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21768 , 215 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21769 , 216 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21770 , 274 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21771 , 217 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21772 , 218 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21773 , 14 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21774 , 16 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21775 , 280 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21776 , 286 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21777 , 287 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21778 , 17 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21779 , 18 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21780 , 288 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21781 , 19 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21782 , 219 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21783 , 20 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21784 , 21 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21785 , 275 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21786 , 22 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21787 , 23 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21788 , 24 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21789 , 26 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21790 , 27 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21791 , 28 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21792 , 30 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21793 , 31 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21794 , 32 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21795 , 33 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21796 , 34 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21797 , 305 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21798 , 37 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21799 , 306 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21800 , 38 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21801 , 39 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21802 , 235 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21803 , 41 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21804 , 42 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21805 , 302 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21806 , 43 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21807 , 45 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21808 , 46 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21809 , 47 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21810 , 298 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21811 , 299 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21812 , 49 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21813 , 50 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21814 , 192 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21815 , 265 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21816 , 264 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21817 , 53 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21818 , 220 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21819 , 221 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21820 , 56 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21821 , 57 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21822 , 58 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21823 , 266 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21824 , 59 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21825 , 61 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21826 , 222 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21827 , 185 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21828 , 62 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21829 , 188 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21830 , 63 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21831 , 64 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21832 , 296 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21833 , 294 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21834 , 293 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21835 , 279 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21836 , 66 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21837 , 67 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21838 , 223 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21839 , 268 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21840 , 316 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21841 , 269 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21842 , 317 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21843 , 289 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21844 , 70 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21845 , 224 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21846 , 71 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21847 , 72 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21848 , 74 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21849 , 236 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21850 , 75 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21851 , 283 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21852 , 284 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21853 , 285 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21854 , 76 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21855 , 77 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21856 , 79 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21857 , 81 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21858 , 295 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21859 , 82 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21860 , 321 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21861 , 290 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21862 , 291 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21863 , 88 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21864 , 90 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21865 , 91 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21866 , 92 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21867 , 271 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21868 , 93 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21869 , 89 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21870 , 318 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21871 , 95 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21872 , 96 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21873 , 98 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21874 , 99 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21875 , 100 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21876 , 101 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21877 , 102 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21878 , 103 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21879 , 104 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21880 , 225 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21881 , 189 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21882 , 105 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21883 , 106 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21884 , 107 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21885 , 110 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21886 , 319 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21887 , 273 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21888 , 312 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21889 , 112 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21890 , 113 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21891 , 114 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21892 , 226 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21893 , 227 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21894 , 190 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21895 , 228 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21896 , 193 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21897 , 194 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21898 , 124 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21899 , 117 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21900 , 313 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21901 , 309 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21902 , 307 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21903 , 303 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21904 , 314 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21905 , 138 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21906 , 168 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21907 , 169 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21908 , 170 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21909 , 171 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21910 , 172 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21911 , 173 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21912 , 174 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21913 , 175 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21914 , 176 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21915 , 177 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21916 , 178 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21917 , 179 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21918 , 180 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21919 , 292 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21920 , 182 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21921 , 183 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21922 , 139 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21923 , 140 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21924 , 141 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21925 , 184 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21926 , 126 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21927 , 308 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21928 , 127 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21929 , 128 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21930 , 129 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21931 , 130 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21932 , 272 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21933 , 131 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21934 , 132 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21935 , 133 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21936 , 270 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21937 , 142 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21938 , 191 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21939 , 143 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21940 , 229 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21941 , 144 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21942 , 145 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21943 , 195 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21944 , 146 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21945 , 196 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21946 , 147 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21947 , 324 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21948 , 325 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21949 , 148 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21950 , 149 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21951 , 150 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21952 , 322 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21953 , 278 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21954 , 152 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21955 , 230 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21956 , 231 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21957 , 232 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21958 , 153 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21959 , 154 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21960 , 157 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21961 , 134 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21962 , 135 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21963 , 136 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21964 , 118 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21965 , 160 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21966 , 161 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21967 , 212 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21968 , 197 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21969 , 198 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21970 , 199 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21971 , 200 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21972 , 301 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21973 , 202 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21974 , 203 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21975 , 204 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21976 , 205 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21977 , 206 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21978 , 297 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21979 , 207 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21980 , 208 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21981 , 209 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21982 , 210 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21983 , 237 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21984 , 238 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21985 , 239 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21986 , 240 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21987 , 241 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21988 , 242 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21989 , 243 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21990 , 244 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21991 , 245 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21992 , 246 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21993 , 247 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21994 , 248 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21995 , 249 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21996 , 251 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21997 , 252 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21998 , 250 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21999 , 253 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 22000 , 254 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 22001 , 255 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 22002 , 256 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 22003 , 257 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 22004 , 261 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 22005 , 262 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 22006 , 263 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 22007 , 211 , 0)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21434 , 3 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21435 , 6 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21436 , 7 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21437 , 12 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21438 , 13 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21439 , 15 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21440 , 25 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21441 , 29 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21442 , 35 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21443 , 36 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21444 , 234 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21445 , 40 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21446 , 44 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21447 , 281 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21448 , 282 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21449 , 48 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21450 , 51 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21451 , 52 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21452 , 54 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21453 , 55 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21454 , 60 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21455 , 65 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21456 , 276 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21457 , 69 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21458 , 73 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21459 , 78 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21460 , 83 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21461 , 84 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21462 , 85 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21463 , 86 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21464 , 87 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21465 , 94 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21466 , 97 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21467 , 108 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21468 , 109 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21469 , 111 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21470 , 115 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21471 , 277 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21472 , 116 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21473 , 320 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 20530 , 3 , 4)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 20531 , 6 , 4)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 20532 , 7 , 4)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 20533 , 12 , 4)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 20534 , 13 , 4)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 20535 , 15 , 4)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 20536 , 25 , 4)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 20537 , 29 , 4)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 20538 , 35 , 4)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 20539 , 36 , 4)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 20540 , 40 , 4)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 20541 , 44 , 4)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 20542 , 281 , 4)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 20543 , 282 , 4)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 20544 , 48 , 4)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 20545 , 51 , 4)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 20546 , 52 , 4)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 20547 , 55 , 4)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 20548 , 65 , 4)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 20549 , 69 , 4)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 20550 , 73 , 4)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 20551 , 78 , 4)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 20552 , 83 , 4)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 20553 , 84 , 4)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 20554 , 85 , 4)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 20555 , 86 , 4)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 20556 , 87 , 4)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 20557 , 94 , 4)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 20558 , 97 , 4)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 20559 , 109 , 4)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 20560 , 116 , 4)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 20561 , 320 , 4)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 20562 , 304 , 4)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 20563 , 201 , 4)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21474 , 304 , 5)
insert [ARM_CORE]..[A_FileAccess] ( [PID] ,[FileID] ,[RoleID] ) values ( 21475 , 201 , 5)
set IDENTITY_INSERT  [ARM_CORE]..[A_FileAccess] OFF
TRUNCATE TABLE  [ARM_CORE]..[A_Menu]

set IDENTITY_INSERT  [ARM_CORE]..[A_Menu] ON
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 1109 , 1111 , 'Unmapped' , 200 , 1 , '/views/default.asp?ID=37' , '' , 0)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 63 , 67 , 'Update File Permissions' , 500 , 1 , '/admin/utils/FilePermissions.asp' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 3 , 44 , 'Asset Console' , 100 , 0 , '/admin/ConsoleStatus.asp' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 4 , 34 , 'Slots' , 6 , 1 , '/admin/slots.asp' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 5 , 34 , 'Schedule Summary' , 8 , 1 , '/admin/ScheduleSummary.asp' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 6 , 34 , 'Deployed Assets by Period' , 10 , 1 , '/admin/DeployedByPeriod.asp' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 7 , 34 , 'UAM - By Business Area' , 12 , 0 , '/admin/UAM.asp?Slice=BArea' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 8 , 34 , 'UAM - By Collection' , 14 , 0 , '/admin/UAM.asp?Slice=COLLECTION' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 9 , 10 , 'Collections' , 210 , 1 , '/admin/Collection.asp' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 10 , NULL , 'EDITOR' , 20 , 1 , NULL , 'fa fa-edit' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 11 , 10 , 'Business Areas' , 200 , 1 , '/admin/List.asp?ref=BArea&db=ARM_Core&Title=Bussiness%20Area%20List&identity=BAreaID' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 12 , 10 , 'Channel' , 100 , 1 , '/admin/ChannelEditor.asp' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 13 , 10 , 'Slot Template' , 110 , 1 , '/admin/TimeTemplates.asp' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 14 , 10 , 'Booking Schedule Editor' , 4 , 0 , '/admin/ChannelSchedule.asp' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 15 , 10 , 'Notifications' , 120 , 1 , '/admin/NotificationEditor.asp' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 16 , 10 , 'Surveys' , 120 , 1 , '/admin/SurveyCreator.asp' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 17 , 10 , 'Gauge Editor' , 7 , 0 , '/admin/GaugeEditor.asp' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 18 , 34 , 'What If' , 200 , 1 , '/admin/WhatIfAppsList.asp?R=1' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 1110 , 10 , 'Lookups' , 230 , 1 , '/admin/List.asp?ref=a_lookup&db=ARM_Core&Title=Lookup&identity=LookupID' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 20 , 1111 , 'Map' , 300 , 1 , '/admin/ApplicationMap.asp' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 21 , 44 , 'Application Console' , 300 , 1 , '/admin/ApplicationList.asp' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 22 , 10 , 'Tools - Asset Batch Set' , 500 , 1 , '/admin/AssetBatch.asp' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 1099 , NULL , 'USER GUIDE' , 999 , 1 , '' , 'fa fa-question-circle' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 24 , NULL , 'SYSTEM' , 70 , 1 , NULL , 'fa fa-cogs' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 25 , 24 , 'User Access / Roles' , 1 , 1 , '/admin/UserAccess.asp' , NULL , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 26 , 34 , 'Export' , 600 , 1 , '/admin/Export.asp' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 27 , 67 , 'Auto Notifications' , 100 , 1 , '/admin/AutoNotifications.asp' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 28 , 24 , 'View Licence' , 4 , 1 , '/System/Licence/viewLicence.asp' , '' , 1)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 29 , 24 , 'Activate Licence' , 5 , 1 , '/System/Licence/Activate.asp' , '' , 1)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 30 , 1111 , 'Re-Apply Mappings' , 400 , 1 , '/admin/ReApplyAppsTransforms.asp' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 31 , 67 , 'Run File Transforms' , 510 , 1 , '/admin/ScheduledUpdates.asp' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 32 , 24 , '* Extend Slots by 4 Weeks' , 8 , 0 , '/admin/DoExtendSlots.asp' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 33 , 67 , 'Data Sets' , 100 , 0 , '/admin/Datasets.asp' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 34 , NULL , 'DEPLOYMENT' , 5 , 1 , NULL , 'fa fa-random' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 35 , 34 , 'Console' , 18 , 0 , '/admin/Console.asp' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 36 , 34 , 'View Booking Schedules' , 20 , 0 , '/admin/ScheduleView.asp' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 1113 , 1111 , 'Application First Seen' , 100 , 1 , '/admin/List.asp?ref=AppFirstSeen&db=ARM_Core&Title=Application%20First%20Seen&identity=ApplicationID&_OrderBy=Timestamp&DESC=1' , '' , 1)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 38 , 34 , 'Published Surveys' , 40 , 1 , '/admin/PublishedSurveys.asp' , NULL , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 41 , 10 , 'Search By Name' , 510 , 1 , '/admin/SearchByName.asp' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 42 , 10 , 'Search By Application' , 520 , 1 , '/admin/SearchByApplication.asp' , '' , 0)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 44 , NULL , 'LISTS' , 2 , 1 , '' , 'fa fa-list' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 65 , 67 , 'Menu - Generate ' , 210 , 1 , '/Admin/Utils/GenerateMenu.asp' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 53 , NULL , 'BOOKING' , 100 , 1 , '/Booking/MakeBooking.asp' , 'fa fa-user' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 67 , NULL , 'DEVELOPER' , 1000 , 1 , '' , 'fa fa-coffee' , 0)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 61 , 44 , 'Application List' , 310 , 1 , '/admin/List.asp?ref=application&db=ARM_Core&Title=Application%20List&identity=ApplicationID' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 68 , 67 , 'Menu - Update Permissions' , 220 , 1 , '/admin/utils/MenuPermissions.asp' , '' , 0)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 77 , 67 , 'Dashboard Editor' , 110 , 1 , '/Admin/DashboardEditor.asp' , '' , 0)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 71 , 34 , 'File Upload' , 600 , 1 , '/Admin/FileUpload.asp' , '' , 0)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 55 , 34 , 'Dashboard' , 2 , 1 , '/admin/dashboard.asp?view=deployment' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 57 , 44 , 'User List' , 200 , 1 , '/admin/List.asp?ref=User&db=ARM_Core&Title=User%20List&identity=UserID' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 58 , 44 , 'Asset List' , 110 , 1 , '/Admin/AssetList.asp' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 62 , 44 , 'Application Group List' , 320 , 1 , '/admin/List.asp?ref=appgroup&db=ARM_Core&Title=Application%20%20Group%20List&identity=AppGroupID&_OrderBy=AppGroupName' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 69 , 67 , 'Menu - Edit' , 200 , 1 , '/Admin/List.asp?REF=A_Menu' , '' , 0)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 1108 , 1099 , 'Tombstone' , 500 , 1 , '/Help/default.asp?Page=Tombstone.htm&Title=Tombstone' , '' , 1)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 1112 , 44 , 'New Application Request' , 999 , 1 , '/admin/List.asp?ref=applicationrequest&db=ARM_Core&Title=Application%20Request&identity=ApplicationRequestID' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 1081 , 67 , 'Asset List (BETA)' , 500 , 0 , '/Admin/AssetList.asp' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 1082 , 34 , 'List Compare' , 610 , 1 , '/admin/CompareLists.asp' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 1083 , 10 , 'Workstreams' , 200 , 1 , '/Admin/List.asp?REF=Workstream' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 1096 , 44 , 'Applications - Manual' , 320 , 1 , '/admin/List.asp?ref=AppsManualInstall&db=ARM_Custom&Title=Manual&Identity=AppID' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 1098 , 1111 , 'SGB Search' , 300 , 1 , '/Admin/SGB_Search.asp' , '' , 0)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 1111 , NULL , 'APPLICATION EDITOR' , 60 , 1 , '' , 'fa fa-windows' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 1104 , 1099 , 'How To Guides' , 300 , 1 , '/Help/default.asp?Page=How To.htm&Title=How To Guides' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 1094 , 44 , 'Applications - Catalog' , 340 , 1 , '/admin/List.asp?ref=Catalog&db=ARM_Custom&Title=Catalog&identity=Application&f_active=1' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 1105 , 1099 , 'Concepts' , 310 , 1 , '/Help/default.asp?Page=Concepts.htm&Title=Help: Concepts' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 1106 , 1099 , 'Admin Tasks' , 320 , 1 , '/Help/default.asp?Page=Admin Tasks.htm&Title=Help: Admin Tasks' , '' , NULL)
insert [ARM_CORE]..[A_Menu] ( [MenuID] ,[ParentID] ,[Name] ,[Order] ,[Active] ,[URL] ,[Icon] ,[Override] ) values ( 1107 , 1099 , 'Applications' , 400 , 1 , '/Help/default.asp?Page=Applications.htm&Title=Applications' , '' , NULL)
set IDENTITY_INSERT  [ARM_CORE]..[A_Menu] OFF
TRUNCATE TABLE  [ARM_CORE]..[A_MenuAccess]

set IDENTITY_INSERT  [ARM_CORE]..[A_MenuAccess] ON
insert [ARM_CORE]..[A_MenuAccess] ( [MID] ,[MenuID] ,[RoleID] ) values ( 193 , 53 , 0)
insert [ARM_CORE]..[A_MenuAccess] ( [MID] ,[MenuID] ,[RoleID] ) values ( 151 , 1099 , 1)
insert [ARM_CORE]..[A_MenuAccess] ( [MID] ,[MenuID] ,[RoleID] ) values ( 152 , 39 , 1)
insert [ARM_CORE]..[A_MenuAccess] ( [MID] ,[MenuID] ,[RoleID] ) values ( 185 , 1099 , 3)
insert [ARM_CORE]..[A_MenuAccess] ( [MID] ,[MenuID] ,[RoleID] ) values ( 186 , 34 , 3)
insert [ARM_CORE]..[A_MenuAccess] ( [MID] ,[MenuID] ,[RoleID] ) values ( 187 , 39 , 3)
insert [ARM_CORE]..[A_MenuAccess] ( [MID] ,[MenuID] ,[RoleID] ) values ( 188 , 44 , 3)
insert [ARM_CORE]..[A_MenuAccess] ( [MID] ,[MenuID] ,[RoleID] ) values ( 189 , 46 , 3)
insert [ARM_CORE]..[A_MenuAccess] ( [MID] ,[MenuID] ,[RoleID] ) values ( 190 , 47 , 3)
insert [ARM_CORE]..[A_MenuAccess] ( [MID] ,[MenuID] ,[RoleID] ) values ( 191 , 72 , 3)
insert [ARM_CORE]..[A_MenuAccess] ( [MID] ,[MenuID] ,[RoleID] ) values ( 192 , 1080 , 3)
insert [ARM_CORE]..[A_MenuAccess] ( [MID] ,[MenuID] ,[RoleID] ) values ( 194 , 10 , 4)
insert [ARM_CORE]..[A_MenuAccess] ( [MID] ,[MenuID] ,[RoleID] ) values ( 195 , 1099 , 4)
insert [ARM_CORE]..[A_MenuAccess] ( [MID] ,[MenuID] ,[RoleID] ) values ( 196 , 34 , 4)
insert [ARM_CORE]..[A_MenuAccess] ( [MID] ,[MenuID] ,[RoleID] ) values ( 197 , 44 , 4)
insert [ARM_CORE]..[A_MenuAccess] ( [MID] ,[MenuID] ,[RoleID] ) values ( 198 , 1111 , 4)
insert [ARM_CORE]..[A_MenuAccess] ( [MID] ,[MenuID] ,[RoleID] ) values ( 199 , 10 , 5)
insert [ARM_CORE]..[A_MenuAccess] ( [MID] ,[MenuID] ,[RoleID] ) values ( 200 , 1099 , 5)
insert [ARM_CORE]..[A_MenuAccess] ( [MID] ,[MenuID] ,[RoleID] ) values ( 201 , 24 , 5)
insert [ARM_CORE]..[A_MenuAccess] ( [MID] ,[MenuID] ,[RoleID] ) values ( 202 , 34 , 5)
insert [ARM_CORE]..[A_MenuAccess] ( [MID] ,[MenuID] ,[RoleID] ) values ( 203 , 44 , 5)
insert [ARM_CORE]..[A_MenuAccess] ( [MID] ,[MenuID] ,[RoleID] ) values ( 204 , 1111 , 5)
insert [ARM_CORE]..[A_MenuAccess] ( [MID] ,[MenuID] ,[RoleID] ) values ( 153 , 44 , 1)
insert [ARM_CORE]..[A_MenuAccess] ( [MID] ,[MenuID] ,[RoleID] ) values ( 154 , 46 , 1)
insert [ARM_CORE]..[A_MenuAccess] ( [MID] ,[MenuID] ,[RoleID] ) values ( 155 , 47 , 1)
insert [ARM_CORE]..[A_MenuAccess] ( [MID] ,[MenuID] ,[RoleID] ) values ( 156 , 72 , 1)
insert [ARM_CORE]..[A_MenuAccess] ( [MID] ,[MenuID] ,[RoleID] ) values ( 205 , 10 , 6)
insert [ARM_CORE]..[A_MenuAccess] ( [MID] ,[MenuID] ,[RoleID] ) values ( 206 , 1099 , 6)
insert [ARM_CORE]..[A_MenuAccess] ( [MID] ,[MenuID] ,[RoleID] ) values ( 207 , 24 , 6)
insert [ARM_CORE]..[A_MenuAccess] ( [MID] ,[MenuID] ,[RoleID] ) values ( 208 , 34 , 6)
insert [ARM_CORE]..[A_MenuAccess] ( [MID] ,[MenuID] ,[RoleID] ) values ( 209 , 44 , 6)
insert [ARM_CORE]..[A_MenuAccess] ( [MID] ,[MenuID] ,[RoleID] ) values ( 210 , 67 , 6)
insert [ARM_CORE]..[A_MenuAccess] ( [MID] ,[MenuID] ,[RoleID] ) values ( 211 , 1111 , 6)
set IDENTITY_INSERT  [ARM_CORE]..[A_MenuAccess] OFF

END

GO
-- =============================================
-- Author:             
-- Create date: 
-- Description:        
-- =============================================
CREATE PROCEDURE [dbo].[SYSTEM-Initialise-Lookups]
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
        SET NOCOUNT ON;
TRUNCATE TABLE  [ARM_CORE]..[A_Lookup]
set IDENTITY_INSERT  [ARM_CORE]..[A_Lookup] ON
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1 , 'Application' , 'Deploytype' , 'B' , 'Base Build' , 'Base Build' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 2 , 'Application' , 'DeployType' , 'P' , 'Packaged' , 'Packaged' , 2)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 3 , 'Application' , 'DeployType' , 'P+' , 'Packaged plus Post Deployment Action' , 'Packaged plus Post Deployment Action' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 4 , 'Application' , 'DeployType' , 'Pw' , 'Wrapped Packaged' , 'Wrapped Packaged' , 4)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 5 , 'Application' , 'DeployType' , 'M' , 'Manual' , 'Manual' , 3)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 6 , 'Application' , 'DeployType' , 'W' , 'Web based' , 'Web based' , 6)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 7 , 'Application' , 'DeployType' , 'S' , 'Specialised' , 'Specialised' , 7)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 8 , 'Application' , 'DeployType' , 'V' , 'Virtual' , 'Virtual' , 8)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 9 , 'Application' , 'LifeCycle' , 'Discovered' , '' , 'Discovered' , 1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 10 , 'Application' , 'LifeCycle' , 'In Media Library' , '' , 'In Media Library' , 2)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 11 , 'Application' , 'Ready' , '1' , 'Ready' , '1 - Ready' , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 12 , 'Application' , 'Ready' , '0' , 'Not Ready' , '0 - Not Ready' , 2)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 19 , 'Application ' , 'BaseBuild' , '1' , 'Base Build' , '1 - Base Build' , 1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 20 , 'Application ' , 'BaseBuild' , '0' , 'Not Base Build' , '0 - Not Base Build' , 2)


insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 35 , 'Asset' , 'Live' , '1' , '' , '1 - Live' , 1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 36 , 'Asset' , 'Live' , '0' , '' , '0 - Not Live' , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 37 , 'Asset' , 'Type' , 'Laptop' , '' , 'Laptop' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 38 , 'Asset' , 'Type' , 'Desktop' , '' , 'Desktop' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 39 , 'AutoNotification' , 'AudienceFrom' , 'Schedule' , '' , 'Schedule' , 1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 40 , 'AutoNotification' , 'AudienceFrom' , 'Collection' , '' , 'Collection' , 2)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 41 , 'AutoNotification' , 'AudienceFrom' , 'Query' , '' , 'Query' , 3)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 42 , 'Internal' , 'RAG' , 'Breach' , '' , 'O' , -1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 43 , 'Internal' , 'RAG' , 'In Service' , '' , 'G' , -1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 44 , 'Internal' , 'RAG' , 'Base Build' , '' , 'B' , -1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 45 , 'Internal' , 'RAG' , 'Unclassified' , '' , '*' , -1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 46 , 'Internal' , 'RAG' , 'REMOVED' , '' , 'R' , -1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 47 , 'Internal' , 'RAG' , 'Available' , '' , 'A' , -1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 48 , 'Review' , 'Status' , 'Info Supplied' , '' , 'Info Supplied' , 5)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 49 , 'Review' , 'Status' , 'In Review' , '' , 'In Review' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 50 , 'Review' , 'Status' , 'Approved' , '' , 'Approved' , 30)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 51 , 'Review' , 'Status' , 'Denied' , '' , 'Denied' , 50)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 57 , 'TransformAppStop' , 'Reason' , 'BaseBuild' , '' , 'BaseBuild' , 2)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 58 , 'TransformAppStop' , 'Reason' , 'Component' , '' , 'Component' , 3)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 59 , 'TransformAppStop' , 'Reason' , 'Driver' , '' , 'Driver' , 4)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 60 , 'TransformAppStop' , 'Reason' , 'Patch' , '' , 'Patch' , 5)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 61 , 'TransformAppStop' , 'Reason' , 'Update' , '' , 'Update' , 6)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 62 , 'TransformAppStop' , 'Reason' , 'Unreadable' , '' , 'Unreadable' , 7)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 63 , 'TransformAppStop' , 'Reason' , 'Other' , '' , 'Other' , 8)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 64 , 'A_Collection' , 'Type' , 'Asset' , '' , 'Asset' , 2)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 65 , 'A_Collection' , 'Type' , 'Application' , '' , 'Application' , 4)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 66 , 'A_Collection' , 'Type' , 'User' , '' , 'User' , 6)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 67 , 'Views' , 'Visible' , '0' , NULL , '0 - Hidden' , 1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 68 , 'Views' , 'Visible' , '1' , NULL , '1 - List in Export View' , 2)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 69 , 'Transform' , 'Active' , '1' , '' , '1 - Active' , 1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 70 , 'Transform' , 'Active' , '0' , '' , '0 - Not Active' , 2)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 71 , 'Transform' , 'SkipFirstLine' , '1' , '' , '1 - Skip' , 1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 72 , 'Transform' , 'SkipFirstLine' , '0' , '' , '0 - Do not Skip' , 2)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 73 , 'A_TableEdit' , 'Property' , 'MANDATORY' , NULL , 'Mandatory' , 1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 74 , 'A_TableEdit' , 'Property' , 'READONLY' , NULL , 'Read Only' , 2)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 75 , 'A_TableEdit' , 'Property' , 'HIDDEN' , NULL , 'Hidden' , 3)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 76 , 'A_TableEdit' , 'Exclude' , '0' , NULL , '0 - Include' , 1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 77 , 'A_TableEdit' , 'Exclude' , '1' , NULL , '1 - Exclude' , 2)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 78 , 'A_TablePermit' , 'Style' , 'mint.css' , NULL , 'Mint' , 1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 79 , 'A_TablePermit' , 'Style' , 'snow.css' , NULL , 'Snow' , 2)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 80 , 'A_TablePermit' , 'Style' , 'minimal.css' , NULL , 'Minimal' , 3)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 81 , 'A_TablePermit' , 'Visible' , '0' , NULL , '0 - Not Visible' , 2)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 82 , 'A_TablePermit' , 'Visible' , '1' , NULL , '1 - Visible' , 1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 83 , 'BArea' , 'Internal' , '0' , NULL , '0 - In Scope ' , 1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 84 , 'BArea' , 'Internal' , '1' , NULL , '1 - Internal / Out of Scope' , 2)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 85 , 'User' , 'VIP' , '1' , NULL , '1 - VIP' , 1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 86 , 'User' , 'VIP' , '0' , NULL , '0 - NOT VIP' , 2)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 87 , 'User' , 'Live' , '1' , NULL , 'Active' , 1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 88 , 'User' , 'Live' , '0' , NULL , 'Inactive' , 2)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 89 , 'A_menu' , 'Active' , '1' , NULL , 'Yes' , 1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 90 , 'A_Menu' , 'Active' , '0' , NULL , 'No' , 2)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 91 , 'A_Menu' , 'IsGranted' , '1' , NULL , 'Yes' , 1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 92 , 'A_Menu' , 'IsGranted' , '0' , NULL , 'No' , 2)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 93 , 'A_TablePermit' , 'Cluster' , 'System' , NULL , 'System' , 3)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 94 , 'A_TablePermit' , 'Cluster' , 'Admin' , NULL , 'Admin' , 2)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 95 , 'A_TablePermit' , 'Cluster' , 'Custom' , NULL , 'Custom' , 1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 96 , 'Upload' , 'Directory' , 'E:\NMFTestSite\Root\ARM\arm-wwwroot\Notifications\images' , NULL , 'Notification Image' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 97 , 'Upload' , 'Directory' , 'E:\NMFTestSite\Root\ARM\arm-wwwroot\Public' , NULL , 'Resource' , 5)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 98 , 'Upload' , 'Directory' , 'E:\NMFTestSite\Root\ARM\RawData\Queue' , NULL , 'Data Queue' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 99 , 'Upload' , 'Directory' , 'E:\NMFTestSite\Root\ARM\RawData\Config' , NULL , 'Data Config' , 30)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 100 , 'ScheduleDeployRunAsset' , 'Status' , '''In Progress''' , '' , 'In Progress' , 12)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 101 , 'ScheduleDeployRunAsset' , 'Status' , '''No Show ''' , '' , 'No Show' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 102 , 'ScheduleDeployRunAsset' , 'Status' , '''Build Failure ''' , '' , 'Build Failure' , 35)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 104 , 'A_User' , 'RoleID' , '0' , NULL , 'Anon' , 1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 105 , 'A_User' , 'RoleID' , '1' , NULL , 'User' , 2)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 106 , 'A_User' , 'RoleID' , '3' , NULL , 'Team' , 3)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 107 , 'A_User' , 'RoleID' , '4' , NULL , 'Editor' , 4)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 108 , 'A_User' , 'RoleID' , '5' , NULL , 'Administrator' , 5)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 109 , 'A_User' , 'RoleID' , '6' , NULL , 'Developer' , 6)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 110 , 'Asset' , 'Association' , 'Training' , NULL , 'Training' , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 111 , 'Users' , 'Department' , '?' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 112 , 'Users' , 'Business Unit' , '?' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 113 , 'Users' , 'Location' , '?' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 114 , 'Application' , 'Status' , 'Breach' , 'Application that has been discovered on estate, but has not started any qualification process' , 'Breach ' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 115 , 'Application' , 'Status' , 'Pending' , 'Is in process of qualification, but has not yet been deployed onto estate' , 'Pending' , 70)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 116 , 'Application' , 'Status' , 'Exception' , 'Deployed on estate and following retrospective qualification' , 'Exception' , 50)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 117 , 'Application' , 'Status' , 'In Service' , 'Passed qualification and on estate' , 'In Service' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 118 , 'Application' , 'Status' , 'Restricted' , 'Can be deployed, but only by exception. Such as an older version of software still in place for specific compatibility issues.' , 'Restricted' , 80)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 119 , 'Application' , 'Status' , 'Legacy' , 'Can no longer be deployed, but still exists as a legacy application.' , 'Legacy' , 60)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 120 , 'Application' , 'Status' , 'Decommed' , 'Can no longer be deployed and not on estate' , 'Decommed' , 40)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 121 , 'Application' , 'Status' , 'Declined' , 'Failed qualification process' , 'Declined' , 30)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 122 , 'Application' , 'Platform' , 'Desktop' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 123 , 'Application' , 'Platform' , 'Thin Client (Citrix)' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 124 , 'Application' , 'Platform' , 'Internal Web Service' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 125 , 'Application' , 'Platform' , 'External Web Site' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 126 , 'Application' , 'Platform' , 'External Web Service' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 127 , 'Application' , 'Platform' , 'Mobile' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 128 , 'Application' , 'Class' , 'Application' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 129 , 'Application' , 'Class' , 'Enabler' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 130 , 'Application' , 'Type' , 'E. Add In' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 131 , 'Application' , 'Type' , 'E. Component' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 132 , 'Application' , 'Type' , 'E. Driver' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 133 , 'Application' , 'Type' , 'E. Library' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 134 , 'Application' , 'Type' , 'E. Middleware' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 135 , 'Application' , 'Type' , 'E. Not Set' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 136 , 'Application' , 'Type' , 'A. Collaboration' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 137 , 'Application' , 'Type' , 'A. Communication' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 138 , 'Application' , 'Type' , 'A. Office' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 139 , 'Application' , 'Type' , 'A. Web' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 140 , 'Application' , 'Type' , 'T. Database' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 141 , 'Application' , 'Type' , 'T. Design' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 142 , 'Application' , 'Type' , 'T. Development' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 143 , 'Application' , 'Type' , 'T. Editor' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 144 , 'Application' , 'Type' , 'T. File' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 145 , 'Application' , 'Type' , 'T. Player' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 146 , 'Application' , 'Type' , 'T. Reader' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 147 , 'Application' , 'Type' , 'T. Reporting' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 148 , 'Application' , 'Type' , 'T. Viewer' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 149 , 'Application' , 'Criticality' , 'High' , 'immediate impact on EMEA business' , 'High' , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 150 , 'Application' , 'Criticality' , 'Medium' , 'impact on single affiliate' , 'Medium' , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 151 , 'Application' , 'Criticality' , 'Low' , 'no immediate impact on business' , 'Low' , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 152 , 'Application' , 'LifeCycle' , 'Governance' , NULL , 'Governance' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 153 , 'Application' , 'LifeCycle' , 'Discovery' , NULL , 'Discovery' , 5)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 154 , 'Application' , 'LifeCycle' , 'Package Request' , NULL , 'Package Request' , 15)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 155 , 'Application' , 'LifeCycle' , 'DSL Request' , NULL , 'DSL Request' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 156 , 'Application' , 'LifeCycle' , 'Testing' , NULL , 'Testing' , 25)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 157 , 'Application' , 'LifeCycle' , 'Processed' , NULL , 'Processed' , 30)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 158 , 'AdditionalApplications' , 'Status' , 'Pending ' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 159 , 'AdditionalApplications' , 'Status' , '''Approved''' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 160 , 'DeployEvent' , 'Status' , 'Active' , 'Check these ??????' , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 161 , 'DeployEvent' , 'Status' , 'Inactive' , 'Check these ??????' , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 162 , 'TransformAction' , 'TransformType' , 'SQL' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 163 , 'TransformAction' , 'TransformType' , 'Stored Proc' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 164 , 'TransformAction' , 'TransformType' , 'Delete' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 165 , 'TransformAction' , 'TransformType' , 'Override' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 166 , 'TransformAction' , 'TransformType' , 'Update' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 167 , 'TransformAction' , 'TransformType' , 'Post' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 168 , 'ModelMapping' , 'Type' , 'Desktop' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 169 , 'ModelMapping' , 'Type' , 'Laptop' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 170 , 'ModelMapping' , 'Type' , 'Workstation' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 171 , 'Asset' , 'Status' , '1. Discovery' , 'An asset that has not been seen on the network' , '1. Discovery' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 172 , 'Asset' , 'Status' , '3. Scheduled' , 'An asset that has been scheduled' , '3. Scheduled' , 30)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 173 , 'Asset' , 'Status' , '5. Deployed' , 'A Deployed asset' , '5. Deployed' , 50)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 174 , 'DeployEvent' , 'Type' , 'Office' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 175 , 'DeployEvent' , 'Type' , 'Kiosk' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 176 , 'DeployEvent' , 'Type' , 'Shopfloor' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 177 , 'Deployment' , 'Status' , 'Not Found' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 178 , 'Deployment' , 'Status' , 'Found' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 179 , 'Deployment' , 'Status' , 'Deployed' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 180 , 'Deployment' , 'Status' , 'Failed - Not Found' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 181 , 'Deployment' , 'Status' , 'Failed - User Refused' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 182 , 'Deployment' , 'Status' , 'Failed - Technical' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 183 , 'Stock' , 'Status' , '1. Stores' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 184 , 'Stock' , 'Status' , '2. Built' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 185 , 'Stock' , 'Status' , '3. Deployed' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 186 , 'Stock' , 'Status' , '4. Broken' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 187 , 'Stock' , 'Status' , '5. BAU' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 188 , 'Stock' , 'Status' , '6. Lost' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 189 , 'Asset' , 'Status' , '2. Found' , 'An asset that has been seen on the network' , '2. Found' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 190 , 'Asset' , 'Type' , 'ProBook' , NULL , 'ProBook' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 191 , 'Asset' , 'Type' , 'EliteBook' , NULL , 'EliteBook' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 192 , 'Asset' , 'Type' , 'Workstation' , NULL , 'Workstation' , 40)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 193 , 'Asset' , 'Type' , 'MobileCAD' , NULL , 'MobileCAD' , 50)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 195 , 'Application' , 'Status' , 'Unclassified' , NULL , 'Unclassified' , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 196 , 'Asset' , 'LifeCycle' , 'Stock' , NULL , 'Stock' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 197 , 'Asset' , 'LifeCycle' , 'In Service' , NULL , 'In Service' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 199 , 'Asset' , 'LifeCycle' , 'Disposed' , NULL , 'Disposed' , 30)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 201 , 'Asset' , 'LifeCycle' , 'Bought Out' , NULL , 'Bought Out' , 90)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 202 , 'Asset' , 'OU' , 'NMUK' , NULL , 'NMUK' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 203 , 'Asset' , 'OU' , 'NBMUK' , NULL , 'NBMUK' , 12)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 208 , 'Asset' , 'OU' , 'NMISA' , 'NMISA' , 'NMISA' , 30)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 209 , 'Asset' , 'OU' , 'NMUK-Other' , NULL , 'NMUK-Other' , 15)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 210 , 'Asset' , 'OU' , 'NMGR' , NULL , 'NMGR' , 40)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 211 , 'Asset' , 'OU' , 'NMGR-Other' , NULL , 'NMGR-Other' , 45)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 212 , 'Asset' , 'OU' , 'NMISA-Other' , NULL , 'NMISA-Other' , 35)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 213 , 'Asset' , 'OU' , 'NMPC' , NULL , 'NMPC' , 50)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 214 , 'Asset' , 'OU' , 'NMPC-Other' , NULL , 'NMPC-Other' , 55)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 215 , 'Asset' , 'Status' , '6. Missing' , 'An asset that cannot be located' , '6. Missing' , 80)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 217 , 'Asset' , 'Status' , '7. Buy Off' , 'Do not replace, but buy off from HP' , '7. Buy Off' , 90)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 219 , 'Asset' , 'OU' , 'NTCE-Other' , NULL , 'NTCE-Other' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 220 , 'Asset' , 'OU' , 'NTCE' , NULL , 'NTCE' , 25)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 228 , 'Asset' , 'OS' , 'Windows 7' , NULL , 'Windows 7' , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 229 , 'Asset' , 'OS' , 'Windows 10' , NULL , 'Windows 10' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 230 , 'Asset' , 'OS' , 'Windows XP' , NULL , 'Windows XP' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 231 , 'Asset' , 'OS' , 'Windows Other' , NULL , 'Windows Other' , 30)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 232 , 'Asset' , 'OS' , 'Not Windows' , NULL , 'Not Windows' , 40)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 233 , 'Application' , 'DeployType' , 'Web' , NULL , 'Web' , 25)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 234 , 'Application' , 'DeployType' , 'Thin Client' , NULL , 'Thin Client' , 60)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 235 , 'AppReadiness' , 'ReadinessStatus' , '''Discovery''' , NULL , 'Discovery' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 236 , 'AppReadiness' , 'ReadinessStatus' , '''Packaging''' , NULL , 'Packaging' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 237 , 'AppReadiness' , 'OSBuild' , '''ACE1''' , NULL , 'ACE1' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 238 , 'AppReadiness' , 'OSBuild' , '''ACE2''' , NULL , 'ACE2' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 239 , 'AppReadiness' , 'ReadinessType' , '''Package''' , NULL , 'Package' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 240 , 'Asset' , 'Type' , 'Printer' , NULL , 'Printer' , 60)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 241 , 'Asset' , 'Status' , '8. Disposed' , 'Asset removed from site' , '8. Disposed' , 100)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 243 , 'Application' , 'BaseBuild' , '1' , NULL , '1-Basebuild' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 244 , 'Application' , 'WhatIf' , '1' , NULL , '1-Ready' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 245 , 'AppTestLabel' , 'Test1' , 'Test1' , NULL , 'Test1' , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 246 , 'Application' , 'DeployType' , '''''' , NULL , 'To Be Determined' , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 249 , 'Internal' , 'RAG' , 'Decommission' , NULL , 'D' , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 250 , 'Review' , 'Status' , 'New Application Request Created' , NULL , 'New Application Request Created' , 50)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 251 , 'Review' , 'Status' , 'Application Owner Assigned' , NULL , 'Application Owner Assigned' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 252 , 'Review' , 'Status' , 'SGB App Owner Review' , NULL , 'SGB App Owner Review' , 40)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 253 , 'Review' , 'Status' , 'Refused' , NULL , 'Refused' , 70)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 254 , 'TransformAppStop' , 'Reason' , 'Black List' , NULL , 'Black List' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 256 , 'Review' , 'Status' , 'Accepted Additional Software Request' , NULL , 'Accepted Additional Software Request' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 257 , 'Review' , 'Status' , 'Raised by SGB' , NULL , 'Raised by SGB' , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 258 , 'Application' , 'Status' , 'New' , 'A new request before submission to the AGB' , 'New' , 1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 259 , 'AppTestLabel' , 'Test1' , 'Test1' , NULL , 'Unit Test' , -1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 260 , 'RunAssets$' , 'Status' , '''Dropped Off''' , NULL , 'Dropped Off' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 261 , 'RunAssets$' , 'Status' , '''Awaiting User''' , NULL , 'Awaiting User' , 30)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 262 , 'Asset' , 'Status' , '4. ZTP' , NULL , '4. ZTP' , 40)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 263 , 'ModelToBe' , 'ToBeModel' , 'MWS Standard' , NULL , 'MWS Standard' , 1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 264 , 'ModelToBe' , 'ToBeModel' , 'Desktop SFF' , NULL , 'Desktop SFF' , 1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 265 , 'ModelToBe' , 'ToBeModel' , 'Laptop Large Screen' , NULL , 'Laptop Large Screen' , 1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 266 , 'ModelToBe' , 'ToBeModel' , 'Desktop MT' , NULL , 'Desktop MT' , 1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 267 , 'ModelToBe' , 'ToBeModel' , 'Laptop Standard' , NULL , 'Laptop Standard' , 1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 268 , 'ModelToBe' , 'ToBeModel' , 'WS Standard' , NULL , 'WS Standard' , 1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 269 , 'ModelToBe' , 'ToBeModel' , 'WS HighSpec' , NULL , 'WS HighSpec' , 1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 270 , 'A_MeetingItem' , 'Status' , 'Open' , 'Open' , 'Open' , 1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 271 , 'A_MeetingItem' , 'Status' , 'Closed' , 'Closed' , 'Closed' , 2)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 272 , 'AppGroup' , 'Class' , 'Web' , NULL , 'Web' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 273 , 'AppGroup' , 'Type' , 'Business ' , NULL , 'Business' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 274 , 'AppGroup' , 'Type' , 'CAD' , NULL , 'CAD' , 15)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 275 , 'AppGroup' , 'Type' , 'Communication' , NULL , 'Communication' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 276 , 'AppGroup' , 'Type' , 'Database' , NULL , 'Database' , 25)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 277 , 'AppGroup' , 'Type' , 'Finance' , NULL , 'Finance' , 25)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 278 , 'AppGroup' , 'Type' , 'Hardware Drivers' , NULL , 'Hardware Drivers' , 30)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 279 , 'AppGroup' , 'Type' , 'IT Tools' , NULL , 'IT Tools' , 35)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 280 , 'AppGroup' , 'Type' , 'Language Packs' , NULL , 'Language Packs' , 35)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 281 , 'AppGroup' , 'Type' , 'Legal' , NULL , 'Legal' , 40)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 282 , 'AppGroup' , 'Type' , 'Manufacture' , NULL , 'Manufacture' , 45)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 283 , 'AppGroup' , 'Type' , 'Media' , NULL , 'Media' , 45)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 284 , 'AppGroup' , 'Type' , 'Microsoft Office' , NULL , 'Microsoft Office' , 50)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 285 , 'AppGroup' , 'Type' , 'Software Development' , NULL , 'Software Development' , 55)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 286 , 'AppGroup' , 'Type' , 'Specialist' , NULL , 'Specialist' , 55)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 287 , 'AppGroup' , 'Type' , 'Utility' , NULL , 'Utility' , 60)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 288 , 'AppGroup' , 'Criticality' , 'Low' , NULL , 'Low' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 289 , 'AppGroup' , 'Criticality' , 'Medium' , NULL , 'Medium' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 290 , 'AppGroup' , 'Criticality' , 'High' , NULL , 'High' , 30)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 291 , 'AppGroup' , 'Scope' , 'Local' , NULL , 'Local' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 292 , 'AppGroup' , 'Scope' , 'Region' , NULL , 'Region' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 293 , 'AppGroup' , 'Scope' , 'Global' , NULL , 'Global' , 30)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 294 , 'AppPackageRequest' , 'TargetBuild' , 'ACE1 1.20.3' , NULL , 'ACE1 1.20.3' , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 295 , 'AppPackageRequest' , 'SecurityTestVersion' , 'Security Test V1.00' , NULL , 'Security Test V1.00' , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 296 , 'A_MeetingItem' , 'Type' , 'SGB Action' , NULL , 'SGB Action' , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 297 , 'A_MeetingItem' , 'Type' , 'SGB Decision' , NULL , 'SGB Decision' , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 298 , 'A_MeetingItem' , 'Type' , 'SGB Meeting' , NULL , 'SGB Meeting' , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 299 , 'TombstoneException' , 'Type' , 'Off Site' , NULL , 'Off Site' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 300 , 'TombstoneException' , 'Type' , 'No Network Point' , NULL , 'No Network Point' , 30)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 301 , 'TombstoneException' , 'Type' , 'Intermittent Use' , NULL , 'Intermittent Use' , 40)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 302 , 'Asset' , 'LifeCycle' , 'Tombstoned' , NULL , 'Tombstoned' , 80)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 303 , 'A_MeetingItem' , 'Status' , 'Delayed' , NULL , 'Delayed' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 304 , 'Users' , 'Department' , '?' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 305 , 'Users' , 'Business Unit' , '?' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 306 , 'Users' , 'Location' , '?' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 307 , 'Application' , 'Platform' , 'Desktop' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 308 , 'Application' , 'Platform' , 'Thin Client (Citrix)' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 309 , 'Application' , 'Platform' , 'Internal Web Service' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 310 , 'Application' , 'Platform' , 'External Web Site' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 311 , 'Application' , 'Platform' , 'External Web Service' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 312 , 'Application' , 'Platform' , 'Mobile' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 313 , 'Application' , 'Class' , 'Application' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 314 , 'Application' , 'Class' , 'Enabler' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 315 , 'Application' , 'Type' , 'E. Add In' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 316 , 'Application' , 'Type' , 'E. Component' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 317 , 'Application' , 'Type' , 'E. Driver' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 318 , 'Application' , 'Type' , 'E. Library' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 319 , 'Application' , 'Type' , 'E. Middleware' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 320 , 'Application' , 'Type' , 'E. Not Set' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 321 , 'Application' , 'Type' , 'A. Collaboration' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 322 , 'Application' , 'Type' , 'A. Communication' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 323 , 'Application' , 'Type' , 'A. Office' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 324 , 'Application' , 'Type' , 'A. Web' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 325 , 'Application' , 'Type' , 'T. Database' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 326 , 'Application' , 'Type' , 'T. Design' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 327 , 'Application' , 'Type' , 'T. Development' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 328 , 'Application' , 'Type' , 'T. Editor' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 329 , 'Application' , 'Type' , 'T. File' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 330 , 'Application' , 'Type' , 'T. Player' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 331 , 'Application' , 'Type' , 'T. Reader' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 332 , 'Application' , 'Type' , 'T. Reporting' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 333 , 'Application' , 'Type' , 'T. Viewer' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 334 , 'AdditionalApplications' , 'Status' , 'Pending ' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 335 , 'AdditionalApplications' , 'Status' , '''Approved''' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 336 , 'DeployEvent' , 'Status' , 'Active' , 'Check these ??????' , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 337 , 'DeployEvent' , 'Status' , 'Inactive' , 'Check these ??????' , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 338 , 'TransformAction' , 'TransformType' , 'SQL' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 339 , 'TransformAction' , 'TransformType' , 'Stored Proc' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 340 , 'TransformAction' , 'TransformType' , 'Delete' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 341 , 'TransformAction' , 'TransformType' , 'Override' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 342 , 'TransformAction' , 'TransformType' , 'Update' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 343 , 'TransformAction' , 'TransformType' , 'Post' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 344 , 'ModelMapping' , 'Type' , 'Desktop' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 345 , 'ModelMapping' , 'Type' , 'Laptop' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 346 , 'ModelMapping' , 'Type' , 'Workstation' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 347 , 'DeployEvent' , 'Type' , 'Office' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 348 , 'DeployEvent' , 'Type' , 'Kiosk' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 349 , 'DeployEvent' , 'Type' , 'Shopfloor' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 350 , 'Deployment' , 'Status' , 'Not Found' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 351 , 'Deployment' , 'Status' , 'Found' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 352 , 'Deployment' , 'Status' , 'Deployed' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 353 , 'Deployment' , 'Status' , 'Failed - Not Found' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 354 , 'Deployment' , 'Status' , 'Failed - User Refused' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 355 , 'Deployment' , 'Status' , 'Failed - Technical' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 356 , 'Stock' , 'Status' , '1. Stores' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 357 , 'Stock' , 'Status' , '2. Built' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 358 , 'Stock' , 'Status' , '3. Deployed' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 359 , 'Stock' , 'Status' , '4. Broken' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 360 , 'Stock' , 'Status' , '5. BAU' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 361 , 'Stock' , 'Status' , '6. Lost' , NULL , NULL , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 362 , 'AppReadiness' , 'ReadinessType' , '''Manual''' , NULL , 'Manual' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 363 , 'AppTestResults' , 'Test1' , '''Yes''' , NULL , 'Yes' , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 364 , 'Application' , 'WhatIf' , '0' , NULL , '0 - Not Ready' , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 365 , 'RunAssets$' , 'Status' , '''In Progress''' , NULL , 'In Progress' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 366 , 'A_TableEditPermit' , 'Style' , 'mint.css' , NULL , 'Mint' , 1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 367 , 'A_TableEditPermit' , 'Style' , 'snow.css' , NULL , 'Snow' , 2)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 368 , 'A_TableEditPermit' , 'Style' , 'minimal.css' , NULL , 'Minimal' , 3)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 369 , 'A_TableEditPermit' , 'Visible' , '0' , NULL , '0 - Not Visible' , 2)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 370 , 'A_TableEditPermit' , 'Visible' , '1' , NULL , '1 - Visible' , 1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 371 , 'BAreas$' , 'Internal' , '0' , NULL , '0 - In Scope ' , 1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 372 , 'BAreas$' , 'Internal' , '1' , NULL , '1 - Internal / Out of Scope' , 2)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 373 , 'AppGroup' , 'Class' , 'Desktop' , NULL , 'Desktop' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 374 , 'AppPackageRequest' , 'UploadedMedia' , '1' , NULL , 'Yes' , 5)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 375 , 'AppPackageRequest' , 'UploadedMedia' , '0' , NULL , 'No' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 376 , 'AppPackageRequest' , 'UploadedInstructions' , '1' , NULL , 'Yes' , 5)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 377 , 'AppPackageRequest' , 'UploadedInstructions' , '0' , NULL , 'No' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 378 , 'AppPackageRequest' , 'UploadedTestScript ' , '1' , NULL , 'Yes' , 5)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 379 , 'AppPackageRequest' , 'UploadedTestScript ' , '0' , NULL , 'No' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 380 , 'TombstoneException' , 'Type' , 'Developer' , NULL , 'Developer' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 381 , 'internal' , 'OsFilter' , '%Windows%10%' , NULL , 'Windows 10' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 382 , 'internal' , 'OsFilter' , '%Windows%7%' , NULL , 'Windows 7' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 383 , 'internal' , 'OsFilter' , '%' , NULL , 'Any' , 30)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 384 , 'internal' , 'OsFilter' , ' ' , NULL , 'Undefined' , 40)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 385 , 'Application' , 'AppGroupID' , 'DYN:ARM_CORE..AppGroup:AppGroupID' , NULL , 'AppGroupName' , NULL)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 386 , 'A_Menu' , 'ParentID' , 'DYN:ARM_CORE..A_MENU:MenuID:ParentID is NULL' , NULL , 'Name' , NULL)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 387 , 'A_FileAccess' , 'FileID' , 'DYN:ARM_CORE..[A_FILE]:FILEID' , NULL , 'FilePath' , NULL)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 390 , 'A_TablePermit' , 'Cluster' , 'Main' , NULL , 'Main' , NULL)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 392 , 'A_MenuGroupTab' , 'MenuGroupID' , 'DYN:ARM_CORE..A_MenuGroup:MenuGroupID' , NULL , 'Name' , NULL)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 393 , 'A_MenuGroupParam' , 'MenuGroupID' , 'DYN:ARM_CORE..A_MenuGroup:MenuGroupID' , NULL , 'Name' , NULL)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 394 , 'Chart' , 'Type' , 'PieChart' , NULL , 'Pie Chart' , 100)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 395 , 'Chart' , 'Type' , 'BarChart' , NULL , 'Bar Chart' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 396 , 'Chart' , 'Type' , 'ColumnChart' , NULL , 'Column Chart' , 40)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 397 , 'Chart' , 'Units' , '1' , NULL , '1' , 1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 398 , 'Chart' , 'Units' , '2' , NULL , '2' , 2)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 399 , 'Chart' , 'Units' , '3' , NULL , '3' , 3)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 400 , 'Chart' , 'Units' , '4' , NULL , '4' , 4)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 401 , 'Chart' , 'Units' , '5' , NULL , '5' , 5)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 402 , 'Chart' , 'Units' , '6' , NULL , '6' , 6)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 403 , 'Chart' , 'Units' , '7' , NULL , '7' , 7)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 404 , 'Chart' , 'Units' , '8' , NULL , '8' , 8)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 405 , 'Chart' , 'Units' , '9' , NULL , '9' , 9)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 406 , 'Chart' , 'Units' , '10' , NULL , '10' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 407 , 'Chart' , 'Units' , '11' , NULL , '11' , 11)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 408 , 'Chart' , 'Units' , '12' , NULL , '12' , 12)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 409 , 'Chart' , 'Type' , 'BubbleChart' , NULL , 'Bubble Chart' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 410 , 'Chart' , 'Type' , 'LineChart' , NULL , 'Line Chart' , 80)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 411 , 'Chart' , 'Type' , 'ComboChart' , NULL , 'Combo Chart' , 50)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 412 , 'Chart' , 'Type' , 'Gantt' , NULL , 'Gantt Chart' , 60)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 413 , 'Chart' , 'Type' , 'CandlestickChart' , NULL , 'Candlestick Chart' , 30)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 414 , 'Chart' , 'Type' , 'Table' , NULL , 'Table Chart' , 120)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 415 , 'Chart' , 'Type' , 'Sankey' , NULL , 'Sankey Diagram' , 110)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 416 , 'Chart' , 'Type' , 'Histogram' , NULL , 'Histogram' , 70)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 417 , 'Chart' , 'Type' , 'OrgChart' , NULL , 'Org Chart' , 90)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 418 , 'Chart' , 'Type' , 'Timeline' , NULL , 'Timeline' , 130)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 419 , 'A_TablePermit' , 'Cluster' , 'Dev' , NULL , 'Dev' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 420 , 'Chart' , 'Type' , 'Gauge' , NULL , 'Gauge' , 65)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 421 , 'HitListInfo' , 'Status' , 'Open: Raised by SGB ' , NULL , 'Open: Raised by SGB ' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 422 , 'HitListInfo' , 'Status' , 'Open: Accepted ASR' , NULL , 'Open: Accepted ASR' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 423 , 'HitListInfo' , 'Status' , 'Open: App Owner Assigned' , NULL , 'Open: App Owner Assigned' , 30)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 424 , 'HitListInfo' , 'Status' , 'Closed: Refused' , NULL , 'Closed: Refused' , 50)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1421 , 'Views' , 'Cluster' , 'Applications' , NULL , 'Applications' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1422 , 'VIP' , 'Cluster' , 'Assets' , NULL , 'Assets' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1423 , 'Views' , 'Cluster' , 'Reports - Deltas' , NULL , 'Reports - Deltas' , 30)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1424 , 'Views' , 'Cluster' , 'Assets' , NULL , 'Assets' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1425 , 'HitListInfo' , 'Status' , 'Closed: Raised NAR' , NULL , 'Closed: Raised NAR' , 40)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1426 , 'Chart' , 'Type' , 'GeoChart' , NULL , 'GeoChart' , 67)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1428 , 'A_Collection' , 'CollectionClassID' , 'DYN:ARM_CORE..A_CollectionClass:CollectionClassID' , NULL , 'Name' , NULL)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1429 , 'A_Collection' , 'Colour' , 'primary' , NULL , 'Primary' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1430 , 'A_Collection' , 'Colour' , 'success' , NULL , 'Green' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1431 , 'A_Collection' , 'Colour' , 'warning' , NULL , 'Orange' , 30)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1432 , 'A_Collection' , 'Colour' , 'danger' , NULL , 'red' , 40)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1433 , 'A_Collection' , 'Colour' , 'info' , NULL , 'Blue' , 50)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1434 , 'A_Collection' , 'Colour' , 'purple' , NULL , 'Purple' , 60)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1436 , 'Asset' , 'Type' , 'Phone' , NULL , 'Phone' , 30)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1482 , 'BookingKeyInfo-Laptop' , 'BArea' , 'DYN:ARM_CORE..BArea:BArea' , NULL , 'BArea' , NULL)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1483 , 'ScheduleChannel' , 'Mode' , 'BOOKABLE' , NULL , 'Bookable' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1484 , 'ScheduleChannel' , 'Mode' , 'REGISTRATION' , NULL , 'Registration Only' , 40)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1485 , 'ScheduleChannel' , 'Mode' , 'MANUAL' , NULL , 'Manual' , 30)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1486 , 'ScheduleChannel' , 'AssetType' , 'Laptop' , NULL , 'Laptop' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1487 , 'ScheduleChannel' , 'AssetType' , 'Desktop' , NULL , 'Desktop' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1488 , 'ScheduleChannel' , 'AssetType' , 'Phone' , NULL , 'Phone' , 30)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1489 , 'ScheduleChannel' , 'AssetType' , 'ALL' , NULL , 'ALL' , 0)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1490 , 'Notices' , 'Alert' , 'panel-white' , NULL , 'White' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1491 , 'Notices' , 'Alert' , 'panel-green' , NULL , 'Green' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1492 , 'Notices' , 'Alert' , 'panel-red' , NULL , 'Red' , 30)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1493 , 'Notices' , 'Alert' , 'panel-blue' , NULL , 'Blue' , 40)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1494 , 'Notices' , 'Alert' , 'partition-light-primary' , NULL , 'Light Primary' , 50)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1495 , 'Notices' , 'Alert' , 'partition-dark-primary' , NULL , 'Dark Primary' , 60)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1496 , 'Notices' , 'Units' , '12' , NULL , '12' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1497 , 'Notices' , 'Units' , '10' , NULL , '10' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1498 , 'Notices' , 'Units' , '8' , NULL , '8' , 30)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1499 , 'Notices' , 'Units' , '4' , NULL , '4' , 50)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1500 , 'Notices' , 'Units' , '6' , NULL , '6' , 40)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1502 , 'BookingKeyInfo-Phone' , 'Model' , 'Alcatel One Touch' , NULL , 'Alcatel One Touch' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1503 , 'BookingKeyInfo-Phone' , 'Model' , 'Blackberry 9300' , NULL , 'Blackberry 9300' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1504 , 'BookingKeyInfo-Phone' , 'Model' , 'ECOM EX HANDY 09 -E' , NULL , 'ECOM EX HANDY 09 -E' , 30)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1505 , 'BookingKeyInfo-Phone' , 'Model' , 'ECOM SMART-EX 01.2 -E' , NULL , 'ECOM SMART-EX 01.2 -E' , 40)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1506 , 'BookingKeyInfo-Phone' , 'Model' , 'EE Rook' , NULL , 'EE Rook' , 50)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1507 , 'BookingKeyInfo-Phone' , 'Model' , 'Galaxy 5 Neo' , NULL , 'Galaxy 5 Neo' , 60)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1508 , 'BookingKeyInfo-Phone' , 'Model' , 'Galaxy A3' , NULL , 'Galaxy A3' , 70)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1509 , 'BookingKeyInfo-Phone' , 'Model' , 'Galaxy A5' , NULL , 'Galaxy A5' , 80)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1510 , 'BookingKeyInfo-Phone' , 'Model' , 'Galaxy Ace 4' , NULL , 'Galaxy Ace 4' , 90)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1511 , 'BookingKeyInfo-Phone' , 'Model' , 'Galaxy J3' , NULL , 'Galaxy J3' , 100)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1512 , 'BookingKeyInfo-Phone' , 'Model' , 'Galaxy J5' , NULL , 'Galaxy J5' , 110)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1513 , 'BookingKeyInfo-Phone' , 'Model' , 'Galaxy S3' , NULL , 'Galaxy S3' , 120)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1514 , 'BookingKeyInfo-Phone' , 'Model' , 'Galaxy S5 Mini' , NULL , 'Galaxy S5 Mini' , 130)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1515 , 'BookingKeyInfo-Phone' , 'Model' , 'Galaxy S5 Neo' , NULL , 'Galaxy S5 Neo' , 140)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1516 , 'BookingKeyInfo-Phone' , 'Model' , 'Galaxy S6' , NULL , 'Galaxy S6' , 150)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1517 , 'BookingKeyInfo-Phone' , 'Model' , 'Galaxy S7' , NULL , 'Galaxy S7' , 160)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1518 , 'BookingKeyInfo-Phone' , 'Model' , 'Galaxy S8' , NULL , 'Galaxy S8' , 170)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1519 , 'BookingKeyInfo-Phone' , 'Model' , 'Galaxy XCover 3' , NULL , 'Galaxy XCover 3' , 180)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1520 , 'BookingKeyInfo-Phone' , 'Model' , 'Galaxy XCover 4' , NULL , 'Galaxy XCover 4' , 190)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1521 , 'BookingKeyInfo-Phone' , 'Model' , 'Huawei E3131-S2' , NULL , 'Huawei E3131-S2' , 200)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1522 , 'BookingKeyInfo-Phone' , 'Model' , 'iPhone 4' , NULL , 'iPhone 4' , 210)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1523 , 'BookingKeyInfo-Phone' , 'Model' , 'iPhone 4s' , NULL , 'iPhone 4s' , 220)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1524 , 'BookingKeyInfo-Phone' , 'Model' , 'iPhone 5' , NULL , 'iPhone 5' , 230)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1525 , 'BookingKeyInfo-Phone' , 'Model' , 'iPhone 5s' , NULL , 'iPhone 5s' , 240)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1526 , 'BookingKeyInfo-Phone' , 'Model' , 'iPhone 6' , NULL , 'iPhone 6' , 250)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1527 , 'BookingKeyInfo-Phone' , 'Model' , 'iPhone 6 Plus' , NULL , 'iPhone 6 Plus' , 260)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1528 , 'BookingKeyInfo-Phone' , 'Model' , 'iPhone 6s' , NULL , 'iPhone 6s' , 270)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1529 , 'BookingKeyInfo-Phone' , 'Model' , 'iPhone 7' , NULL , 'iPhone 7' , 280)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1530 , 'BookingKeyInfo-Phone' , 'Model' , 'iPhone 7 Plus' , NULL , 'iPhone 7 Plus' , 290)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1531 , 'BookingKeyInfo-Phone' , 'Model' , 'Kazam Life B7' , NULL , 'Kazam Life B7' , 300)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1532 , 'BookingKeyInfo-Phone' , 'Model' , 'Nokia 300' , NULL , 'Nokia 300' , 310)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1533 , 'BookingKeyInfo-Phone' , 'Model' , 'Nokia 301' , NULL , 'Nokia 301' , 320)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1534 , 'BookingKeyInfo-Phone' , 'Model' , 'Nokia 6301' , NULL , 'Nokia 6301' , 330)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1535 , 'BookingKeyInfo-Phone' , 'Model' , 'Nokia B2100 (Solid)' , NULL , 'Nokia B2100 (Solid)' , 340)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1536 , 'BookingKeyInfo-Phone' , 'Model' , 'Nokia B2710' , NULL , 'Nokia B2710' , 350)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1537 , 'BookingKeyInfo-Phone' , 'Model' , 'Nokia C3-01' , NULL , 'Nokia C3-01' , 360)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1538 , 'BookingKeyInfo-Phone' , 'Model' , 'Nokia C3350' , NULL , 'Nokia C3350' , 370)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1539 , 'BookingKeyInfo-Phone' , 'Model' , 'Nokia Lumia 610' , NULL , 'Nokia Lumia 610' , 380)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1540 , 'BookingKeyInfo-Phone' , 'Model' , 'Nokia Lumia 625' , NULL , 'Nokia Lumia 625' , 390)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1541 , 'BookingKeyInfo-Phone' , 'Model' , 'Nokia Lumia 635' , NULL , 'Nokia Lumia 635' , 400)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1542 , 'BookingKeyInfo-Phone' , 'Model' , 'Nokia Lumia 640' , NULL , 'Nokia Lumia 640' , 410)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1543 , 'BookingKeyInfo-Phone' , 'Model' , 'Nokia Lumia 920' , NULL , 'Nokia Lumia 920' , 420)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1544 , 'BookingKeyInfo-Phone' , 'Model' , 'Siemens C65' , NULL , 'Siemens C65' , 430)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1545 , 'BookingKeyInfo-Phone' , 'Model' , 'Sony Ericsson K530i' , NULL , 'Sony Ericsson K530i' , 440)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1546 , 'BookingKeyInfo-Phone' , 'Model' , 'Other' , NULL , 'Other' , 450)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1547 , 'HitListInfo' , 'Status' , 'Closed: Consolidate Candidate' , NULL , 'Closed: Consolidate Candidate' , 60)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1548 , 'HitListInfo' , 'Status' , 'Open: Gather Information' , NULL , 'Open: Gather Information' , 40)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1549 , 'HitListInfo' , 'Status' , 'Closed: Withdrawn' , NULL , 'Closed: Withdrawn' , 80)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1550 , 'Asset' , 'Type' , 'VM' , NULL , 'VM' , 100)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1555 , 'A_TablePermit' , 'Cluster' , 'Web' , NULL , 'Web' , 90)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1556 , 'W_Opportunity' , 'Phase' , 'Contact' , '' , 'Contact' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1557 , 'W_Opportunity' , 'Phase' , 'Lead' , '' , 'Lead' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1558 , 'W_Opportunity' , 'Phase' , 'Qualified' , '' , 'Qualified' , 30)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1559 , 'W_Opportunity' , 'Phase' , '''Proposal''' , '' , 'Proposal' , 40)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1560 , 'W_Opportunity' , 'Phase' , 'Won' , '' , 'Won' , 50)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1561 , 'W_Opportunity' , 'Phase' , 'Lost' , '' , 'Lost' , 60)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1562 , 'W_Opportunity' , 'Category' , 'Direct' , NULL , 'Direct' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1563 , 'W_Opportunity' , 'Category' , 'Partner' , NULL , 'Partner' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1564 , 'W_Help' , 'Audience' , 'Team' , NULL , 'Team' , 2)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1565 , 'W_Help' , 'Audience' , 'EU' , NULL , 'EU' , 1)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1566 , 'W_Help' , 'Audience' , 'Admin' , NULL , 'Admin' , 3)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1567 , 'W_Help' , 'Audience' , 'Developer' , NULL , 'Developer' , 4)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1579 , 'Asset' , 'Status' , 'M_Clean' , NULL , 'M_Clean' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1580 , 'Asset' , 'Status' , 'M_UnlockCode' , NULL , 'M_UnlockCode' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1581 , 'Asset' , 'Status' , 'M_PACRequest' , NULL , 'M_PACRequest' , 30)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1582 , 'Asset' , 'status' , 'M_UnlockRequest' , NULL , 'M_UnlockRequest' , 15)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1583 , 'Asset' , 'status' , 'M_Ready4Trans' , NULL , 'M_Ready4Trans' , 40)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1584 , 'Asset' , 'status' , 'M_Transitioned' , NULL , 'M_Transitioned' , 50)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1585 , 'Asset' , 'LifeCycle' , 'Stock - Retire' , NULL , 'Stock - Retire' , 100)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1587 , 'BookingKeyInfo-Desktop' , 'BArea' , 'DYN:ARM_CORE..BArea:BArea' , NULL , 'BArea' , NULL)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1588 , 'Application' , 'DeployType' , 'P3' , NULL , 'Packaged 3D CAD Build' , 100)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1589 , 'ScheduleChannel' , 'Custom01' , 'NMUK' , NULL , 'NMUK' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1590 , 'ScheduleChannel' , 'Custom02' , 'Kiosk-ISD' , NULL , 'Kiosk-ISD' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1591 , 'ScheduleChannel' , 'Custom02' , 'Desk' , NULL , 'Desk' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1592 , 'ScheduleChannel' , 'Custom01' , 'NTCE' , NULL , 'NTCE' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1593 , 'ScheduleChannel' , 'Custom01' , 'NDE' , NULL , 'NCE' , 30)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1594 , 'ScheduleChannel' , 'Custom01' , 'NMISA' , NULL , 'NMISA' , 40)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1595 , 'Views' , 'Cluster' , 'NTCE' , NULL , 'NTCE' , 90)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1596 , 'Views' , 'Cluster' , 'NMUK' , NULL , 'NMUK' , 70)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1597 , 'Views' , 'Cluster' , 'NMISA' , NULL , 'NMISA' , 80)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1599 , 'ImportException' , 'Status' , 'Open' , 'Open' , 'Open' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1600 , 'ImportException' , 'Status' , 'Closed' , 'Closed' , 'Closed' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1601 , 'TombstoneException' , 'Type' , 'SFS' , 'SFS' , 'SFS' , 70)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1602 , 'Upload' , 'Directory' , 'E:\NMFTestSite\Root\ARM\arm-wwwroot\Notifications\Attachments' , NULL , 'Notification Attachments' , 12)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1603 , 'Chart' , 'Type' , 'Calendar' , NULL , 'Calendar' , 25)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1604 , 'Asset' , 'OU' , 'RBU' , NULL , 'RBU' , 100)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1605 , 'Asset' , 'OU' , 'NITA' , NULL , 'NITA' , 100)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1606 , 'Asset' , 'OU' , 'NESAS' , NULL , 'NESAS' , 100)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1607 , 'Asset' , 'OU' , 'NNE' , NULL , 'NNE' , 100)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1608 , 'Asset' , 'OU' , 'NBNV' , NULL , 'NBNV' , 100)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1609 , 'Asset' , 'OU' , 'NSCEE' , NULL , 'NSCEE' , 100)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1610 , 'Asset' , 'OU' , 'ZA' , NULL , 'ZA' , 100)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1611 , 'Asset' , 'OU' , 'NMEF' , NULL , 'NMEF' , 100)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1612 , 'Asset' , 'OU' , 'NCE' , NULL , 'NCE' , 100)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1613 , 'Application' , 'PackageID' , 'DYN:ARM_CUSTOM..Catalog:Application' , NULL , 'Application' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1614 , 'Catalog' , 'Category' , 'DYN:ARM_CUSTOM..Catalog:Category' , NULL , 'Category' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1615 , 'AppUsedMap' , 'ApplicationID' , 'DYN:ARM_CORE..AppAstToBe:ApplicationID' , NULL , 'ApplicationID' , 100)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1616 , 'Asset' , 'OU' , 'NMGB' , NULL , 'NMGB' , 100)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1617 , 'ApplicationRequest' , 'RequestType' , 'New' , NULL , 'New' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1618 , 'ApplicationRequest' , 'RequestType' , 'Update' , NULL , 'Update' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1619 , 'ApplicationRequest' , 'Scope' , 'Local' , NULL , 'Local' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1620 , 'ApplicationRequest' , 'Scope' , 'Region' , NULL , 'Region' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1621 , 'ApplicationRequest' , 'Scope' , 'Global' , NULL , 'Global' , 30)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1622 , 'ApplicationRequest' , 'Criticality' , 'Low' , NULL , 'Low' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1623 , 'ApplicationRequest' , 'Criticality' , 'Medium' , NULL , 'Medium' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1624 , 'ApplicationRequest' , 'Criticality' , 'High' , NULL , 'High' , 30)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1625 , 'ApplicationRequest' , 'Timescale' , 'Standard' , NULL , 'Standard' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1626 , 'ApplicationRequest' , 'Timescale' , 'Urgent' , NULL , 'Urgent' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1627 , 'ApplicationRequest' , 'Language' , 'English' , NULL , 'English' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1628 , 'ApplicationRequest' , 'Language' , 'French' , NULL , 'French' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1629 , 'ApplicationRequest' , 'Language' , 'Spanish' , NULL , 'Spanish' , 30)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1630 , 'ApplicationRequest' , 'Language' , 'Russian' , NULL , 'Russian' , 40)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1631 , 'ApplicationRequest' , 'Language' , 'Japanese' , NULL , 'Japanese' , 50)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1632 , 'ApplicationRequest' , 'Language' , 'Italian' , NULL , 'Italian' , 50)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1633 , 'ApplicationRequest' , 'CatalogCategory' , 'DYN:ARM_CUSTOM..Catalog:Category' , NULL , 'Category' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1634 , 'ApplicationRequest' , 'Domain' , 'A&F' , NULL , 'A&F' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1635 , 'ApplicationRequest' , 'Domain' , 'R&D' , NULL , 'R&D' , 20)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1636 , 'A_Collection' , 'Type' , 'ApplicationRequest' , NULL , 'Application Request' , 40)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1637 , 'ScheduleChannel' , 'Custom01' , 'NMISA_ZonaFranca' , NULL , 'NMISA_ZonaFranca' , 10)
insert [ARM_CORE]..[A_Lookup] ( [LookupID] ,[Table] ,[Column] ,[Lookup] ,[Description] ,[Label] ,[Order] ) values ( 1638 , 'ScheduleChannel' , 'Custom02' , 'At Your Desk' , NULL , 'At Your Desk' , 20)
set IDENTITY_INSERT  [ARM_CORE]..[A_Lookup] OFF
END
 

GO
-- ============================================================================
-- Author:		John Reed
-- ALTER date: 15/07/2016
-- Description:	Generates a grid of counters as determined by Asset 'Status' values.
-- ============================================================================
CREATE PROCEDURE [dbo].[System-FileAccessMatrix]
@OU AS nvarchar(500) = '',
@Target AS int = -1,
@BArea AS nvarchar(255) = '[Undefined]',
@LifeCycle AS nvarchar(255) = '%',
@Collections AS nvarchar(500) = ''
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

		DECLARE @tSQL nvarchar(max);
		DECLARE @tHEADERS nvarchar(max);
		DECLARE @vHEADERS nvarchar(max);
		DECLARE @tJOINS nvarchar(max);
		DECLARE @tSTATUS nvarchar(max);
		DECLARE @TargetLabel nvarchar(20);
		DECLARE @BAreaWhere nvarchar(max);
		DECLARE @TargetOn nvarchar(max) = '';
		DECLARE @ColFilter nvarchar(max) = '';
		DECLARE @ColJoin nvarchar(max) = '';
		DECLARE @fC int = 0; 
		DECLARE @Label nvarchar(20) = '';

		if @Collections <> '' 
		BEGIN
			DECLARE @CID nvarchar(max);
			DECLARE Collection_Cursor CURSOR FOR select distinct collectionID from [ARM_CORE]..[A_Collection] f RIGHT JOIN [dbo].SplitOrderIDs(@Collections) As s ON f.CollectionID = s.OrderID where NOT CollectionID IS NULL;

			OPEN Collection_Cursor;	

			FETCH NEXT FROM Collection_Cursor INTO @CID;
			WHILE @@FETCH_STATUS = 0
			BEGIN

				SET @fC = @fC + 1
				SET @Label = 'f' + CAST(@fC AS VARCHAR(10))
				SET @ColJoin = @ColJoin + ' LEFT JOIN [ARM_CORE]..[A_CollectionItem] ' + @Label + ' on ' + @Label + '.ItemID = a.AssetID and ' + @Label + '.CollectionID = ' + @CID 


				IF @ColFilter = '' 
					SET @ColFilter = '( NOT ' + @Label + '.ItemID IS NULL ' 
				ELSE
					SET @ColFilter = @ColFilter + ' and NOT ' + @Label + '.ItemID IS NULL ' 


				FETCH NEXT FROM Collection_Cursor INTO @CID;
			END;

		    if @ColFilter <> '' SET @ColFilter = @ColFilter + ') and '
			

			CLOSE Collection_Cursor;
			DEALLOCATE Collection_Cursor;


		END



-- LEFT JOIN [ARMS].[dbo].[AssetFlags] f on f.AssetID = a.AssetID where (f.FlagID = 1009 or f.FlagID = 1005) and NOT f.AssetID is NULL and 

		SET @tHEADERS = ' b.BArea, (select count(a.AssetID) from [ARM_CORE]..[Asset] a where a.BArea=b.BArea and IsNull(a.[OU],'''') like ''' + @OU + ''') as BAreaTotal ';
		SET @tSQL = '';
		SET @TargetLabel = '';
		SET @BAreaWhere = '';

		DECLARE Status_Cursor CURSOR FOR SELECT [Lookup]  FROM [ARM_CORE].[dbo].[A_LookUp] where [Table] = 'Asset' and [Column] = 'Status' Order By [Order];

		OPEN Status_Cursor;

		FETCH NEXT FROM Status_Cursor INTO @tSTATUS;


		IF @BArea <> '[Undefined]' SET @BAreaWhere = ' where  b.BArea like ''' + replace(@BArea,'[','![') + ''' Escape ''!'' ' 

		IF @Target = 1 SET @TargetOn = ' and a.Target = 1 '
		IF @Target = 0 SET @TargetOn = ' and a.Target = 0 '

		IF @LifeCycle = '' SET @LifeCycle = '%'
		IF @LifeCycle = 'All' SET @LifeCycle = '%'


		WHILE @@FETCH_STATUS = 0
			BEGIN
				SET @tHEADERS = @tHEADERS + ',(select count(a.AssetID) from [ARM_CORE]..[Asset] a ' + @ColJoin + ' where ' + @ColFilter + ' a.Status = ' + @tSTATUS + ' and IsNull(a.Deferred,0) = 0 and a.BArea=b.BArea ' + @TargetOn + ' and IsNull(a.[LifeCycle],'''') like ''' + @LifeCycle + ''' and IsNull(a.[OU],'''') like ''' + @OU + ''') as [' + @tStatus +'] '

				FETCH NEXT FROM Status_Cursor INTO @tSTATUS;
			END;
		CLOSE Status_Cursor;
		DEALLOCATE Status_Cursor;

		SET @tSQL = ' select distinct ' + @tHEADERS + ', (select count(a.AssetID) from [ARM_CORE]..[Asset] a ' + @ColJoin + ' where ' + @ColFilter + ' IsNull(a.Status,'''') = '''' and IsNull(a.Deferred,0) = 0 and a.BArea=b.BArea ' + @TargetOn + ' and IsNull(a.[LifeCycle],'''') like ''' + @LifeCycle + ''' and IsNull(a.[OU],'''') like ''' + @OU + ''') [''Undefined'']';
		SET @tSQL = @tSQL + ', (select count(a.AssetID) from [ARM_CORE]..[Asset] a ' + @ColJoin + ' where ' + @ColFilter + ' IsNull(a.Deferred,0) = 1 and a.BArea=b.BArea ' + @TargetOn + ' and IsNull(a.[LifeCycle],'''') like ''' + @LifeCycle + ''' and IsNull(a.[OU],'''') like ''' + @OU + ''') [''Deferred'']';
		SET @tSQL = @tSQL + ' from [ARM_CORE]..[BArea] b ' + @BAreaWhere + ' Order by b.BArea ' 
		
 		EXEC (@tSQL);

END





GO
CREATE PROCEDURE [dbo].[SYSTEM-DailyUpdate]
	
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	-- Switch Off Access to users that are beyond their Expiry Date

	Update [ARM_CORE]..[A_User] set Granted = 0 where IsNull(Granted,1) = 1 and IsNull([ExpiryDate],'') <> '' and [ExpiryDate] <= getdate()

	exec [ARM_CORE]..[Transform_Initialise]

--	exec arm_custom..ImportLansweeperData
--	exec [arm_custom]..[LivingstoneReport]


	exec [ARM_CUSTOM]..[Import_User]
	exec [ARM_CUSTOM]..[Import_Asset]
--	exec [ARM_CUSTOM]..[Import_App]      

	exec [ARM_CUSTOM]..[Import_Other] 

	exec [ARM_CORE]..[Transform_User]
	exec [ARM_CORE]..[Transform_Asset]
--	exec [ARM_CORE]..[Transform_App]


-- update Asset BArea where previously not known.


	merge ARM_CORE..Asset as TARGET
	using (
	select * from [ARM_CORE]..[ExtractorOU]
	) as SOURCE
	ON (Target.AssetID = SOURCE.[Station name])
	WHEN MATCHED THEN
	update set TARGET.BArea = SOURCE.[OU site];



	merge [ARM_CORE]..[Asset] as Target
	using (
		select a.AssetID, c.Name, a.BArea from [ARM_CORE]..[Asset] a
		left JOIN [ARM_CORE]..[A_CollectionItem] i on i.ItemID = a.AssetID 
		LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionID = i.CollectionID
		where c.CollectionClassID = 30 and IsNull(c.EndState,0) = 0 and c.Name <> a.BArea
	) as source
	ON target.AssetID = source.assetID
	when MATCHED then
	update set target.BArea = Source.Name;







--	exec [ARM_CORE]..[Tombstone-Target]
--	exec [ARM_CORE]..[Transform_Other]

	EXEC [ARM_CORE]..[Apps-AutoAppsGroupMapping]
	exec [ARM_CORE]..[Apps-ReApplyAppTransforms]
	
		
	exec [ARM_CORE]..[CheckAllTasks]

	exec [ARM_CORE]..[SYSTEM-ManageBitCollections]

	exec [ARM_CORE]..[SYSTEM-Reporting]


    
END

GO
CREATE PROCEDURE [dbo].[SYSTEM-AutoCollections-PASS]
@Pass int = 0
AS
BEGIN

-- Modes are as follows
--  0 - MERGE & PURGE  (keep only those items that are listed by qualifying SQL)
--  1 - MERGE NO PURGE  (add new items identified but retain items already captured)
--  2 - NEW TO CLASS ONLY & PURGE

-- IS Typically Called Twice for two pass model

--------------------------------------------------



	DECLARE @query VARCHAR(MAX)

	Declare @TheHour as int;
	DECLARE @qualifySQl nvarchar(3000);
	DECLARE @mode nvarchar(500);
	DECLARE @collectionID int;

	DECLARE @CollectionClassID int;
	DECLARE @Distinct bit;
		
	set @TheHour = datePart(hour,getdate())

--	DECLARE Agents CURSOR FOR 
--		select qualifySQl, IsNull(mode,0) as Mode, collectionID from [ARM_CORE]..[A_CollectionAgent] where @TheHour in (select value from STRING_SPLIT(IsNull([Frequency],0), ',')) and IsNull(Active,0) = 1 order by [Order]

	DECLARE Agents CURSOR FOR 
		select qualifySQl, IsNull(mode,0) as Mode, collectionID from [ARM_CORE]..[A_CollectionAgent] where IsNull(pass,0) = @pass and @TheHour in (
			select x.[value] from (Select Seq  = Row_Number() over (Order By (Select null)) ,Value = v.value('(./text())[1]', 'varchar(max)')
			From  (values (convert(xml,'<x>' + replace(IsNull([Frequency],0),',','</x><x>')+'</x>'))) x(n) Cross Apply n.nodes('x') node(v) ) x
		) and IsNull(Active,0) = 1 order by [Order]



	SET NOCOUNT ON;

	OPEN Agents  
    
	FETCH NEXT FROM Agents INTO @qualifySQl, @mode, @collectionID  

	IF OBJECT_ID('[ARM_CORE]..[TMP_tempItems]') IS NOT NULL
	DROP TABLE [ARM_CORE]..[TMP_tempItems];


	WHILE @@FETCH_STATUS = 0  
	BEGIN 

		IF OBJECT_ID('[ARM_CORE]..[TMP_tempItems]') IS NOT NULL
			DROP TABLE [ARM_CORE]..[TMP_tempItems];

		set @query = 'select it.ItemID into [ARM_CORE]..[TMP_tempItems] from (' + @qualifySQl + ' ) it '

		EXECUTE(@query)	

		set @CollectionClassID = 0
		set @Distinct = 0

		select @CollectionClassID = IsNull(g.CollectionClassID,0), @Distinct = IsNull(g.[Distinct],0) from [ARM_CORE]..[A_Collection] c LEFT JOIN [ARM_CORE]..[A_CollectionClass] g on g.CollectionClassID = c.CollectionClassID where c.CollectionID = @collectionID

		
		if @Distinct = 1 and NOT @mode = 2
        BEGIN
			-- remove items that are found by qualifying SQL that belong to a collection of the same collection Class as the target Collection but NOT the target collection itself.

			set @query = '
				MERGE [ARM_CORE]..[A_CollectionItem] as TARGET
				USING ( 
					select it.ItemID, guard.CollectionID from [ARM_CORE]..[TMP_tempItems] it 
					LEFT JOIN (
						select distinct i.itemID, i.CollectionID from [ARM_CORE]..[A_CollectionItem] i  
						LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionID = i.CollectionID
						LEFT JOIN [ARM_CORE]..[A_CollectionClass] g on g.CollectionClassID = c.CollectionClassID
						where c.CollectionClassID = ' + cast(@CollectionClassID as nvarchar) + ' and IsNull(g.[Distinct],0) = 1 and NOT c.CollectionID = ' + cast(@collectionID as nvarchar) + '
					) guard on guard.ItemID = it.ItemID
					where NOT Guard.ItemID IS NULL  				
				) as SOURCE
				On (TARGET.[ItemID] = SOURCE.[Itemid] and TARGET.[CollectionID] = SOURCE.[CollectionID]) 
				WHEN MATCHED THEN
				   DELETE;
			'
--			select @query
			EXECUTE(@query)


		END

		IF @mode = 2 

			set @query = '
				MERGE [ARM_CORE]..[A_CollectionItem] as TARGET
				USING ( 
					select it.ItemID, guard.CollectionID from [ARM_CORE]..[TMP_tempItems] it 
					LEFT JOIN (
						select distinct i.itemID, i.CollectionID from [ARM_CORE]..[A_CollectionItem] i  
						LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionID = i.CollectionID
						LEFT JOIN [ARM_CORE]..[A_CollectionClass] g on g.CollectionClassID = c.CollectionClassID
						where c.CollectionClassID = ' + cast(@CollectionClassID as nvarchar) + ' and IsNull(g.[Distinct],0) = 1 and NOT c.CollectionID = ' + cast(@collectionID as nvarchar) + '
					) guard on guard.ItemID = it.ItemID
					where Guard.ItemID IS NULL  				
				) as SOURCE
				On (TARGET.[ItemID] = SOURCE.[Itemid] and TARGET.[CollectionID] = ' + cast(@collectionID as nvarchar) + ' ) 
				WHEN NOT MATCHED THEN
				   INSERT (Itemid,CollectionID) VALUES (Source.[ItemID], ' + cast(@collectionID as nvarchar) + ');
			'	
		ELSE
			set @query = '
				MERGE [ARM_CORE]..[A_CollectionItem] as TARGET
				USING ( select * from [ARM_CORE]..[TMP_tempItems] ) as SOURCE
				On (TARGET.[ItemID] = SOURCE.[Itemid] and TARGET.[CollectionID] = ' + cast(@collectionID as nvarchar) + ' ) 
				WHEN NOT MATCHED THEN
				   INSERT (Itemid,CollectionID) VALUES (Source.[ItemID], ' + cast(@collectionID as nvarchar) + ');
			'

--		select @query
		EXECUTE(@query)



		IF @mode <> 1 
		BEGIN
		-- remove items from target collection that are not contained in qualifying SQL data set
			set @query = '
				delete from [ARM_CORE]..[A_CollectionItem] where CollectionID = ' + cast(@collectionID as nvarchar) + ' and NOT ItemID in (select ItemID from [ARM_CORE]..[TMP_tempItems] ) 
			'

	--		select @query
			EXECUTE(@query)
		END

		FETCH NEXT FROM Agents INTO @qualifySQl, @mode, @collectionID  
		
	END 
 
	CLOSE Agents  
	DEALLOCATE Agents 

			IF OBJECT_ID('[ARM_CORE]..[TMP_tempItems]') IS NOT NULL
			DROP TABLE [ARM_CORE]..[TMP_tempItems];

--	select 1;





END

GO
CREATE PROCEDURE [dbo].[SYSTEM-AutoCollections]
@Pass int = 0
AS
BEGIN

-- Modes are as follows
--  0 - MERGE & PURGE  (keep only those items that are listed by qualifying SQL)
--  1 - MERGE NO PURGE  (add new items identified but retain items already captured)
--  2 - NEW TO CLASS ONLY & PURGE

-- IS Typically Called Twice for two pass model

--------------------------------------------------
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;


	DECLARE @query VARCHAR(MAX)

	Declare @TheHour as int;
	DECLARE @qualifySQl nvarchar(3000);
	DECLARE @mode nvarchar(500);
	DECLARE @collectionID int;

	DECLARE @CollectionClassID int;
	DECLARE @Distinct bit;
		
	set @TheHour = datePart(hour,getdate())

--	DECLARE Agents CURSOR FOR 
--		select qualifySQl, IsNull(mode,0) as Mode, collectionID from [ARM_CORE]..[A_CollectionAgent] where @TheHour in (select value from STRING_SPLIT(IsNull([Frequency],0), ',')) and IsNull(Active,0) = 1 order by [Order]

	DECLARE Agents CURSOR FOR 
		select qualifySQl, IsNull(mode,0) as Mode, collectionID from [ARM_CORE]..[A_CollectionAgent] where IsNull(pass,0) = @pass and @TheHour in (
			select x.[value] from (Select Seq  = Row_Number() over (Order By (Select null)) ,Value = v.value('(./text())[1]', 'varchar(max)')
			From  (values (convert(xml,'<x>' + replace(IsNull([Frequency],0),',','</x><x>')+'</x>'))) x(n) Cross Apply n.nodes('x') node(v) ) x
		) and IsNull(Active,0) = 1 order by [Order]



	SET NOCOUNT ON;

	OPEN Agents  
    
	FETCH NEXT FROM Agents INTO @qualifySQl, @mode, @collectionID  

	IF OBJECT_ID('[ARM_CORE]..[TMP_tempItems]') IS NOT NULL
	DROP TABLE [ARM_CORE]..[TMP_tempItems];


	WHILE @@FETCH_STATUS = 0  
	BEGIN 

		IF OBJECT_ID('[ARM_CORE]..[TMP_tempItems]') IS NOT NULL
			DROP TABLE [ARM_CORE]..[TMP_tempItems];

		set @query = 'select it.ItemID into [ARM_CORE]..[TMP_tempItems] from (' + @qualifySQl + ' ) it '

		EXECUTE(@query)	

		set @CollectionClassID = 0
		set @Distinct = 0

		select @CollectionClassID = IsNull(g.CollectionClassID,0), @Distinct = IsNull(g.[Distinct],0) from [ARM_CORE]..[A_Collection] c LEFT JOIN [ARM_CORE]..[A_CollectionClass] g on g.CollectionClassID = c.CollectionClassID where c.CollectionID = @collectionID

		
		if @Distinct = 1 and NOT @mode = 2
        BEGIN
			-- remove items that are found by qualifying SQL that belong to a collection of the same collection Class as the target Collection but NOT the target collection itself.

			set @query = '
				MERGE [ARM_CORE]..[A_CollectionItem] as TARGET
				USING ( 
					select it.ItemID, guard.CollectionID from [ARM_CORE]..[TMP_tempItems] it 
					LEFT JOIN (
						select distinct i.itemID, i.CollectionID from [ARM_CORE]..[A_CollectionItem] i  
						LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionID = i.CollectionID
						LEFT JOIN [ARM_CORE]..[A_CollectionClass] g on g.CollectionClassID = c.CollectionClassID
						where c.CollectionClassID = ' + cast(@CollectionClassID as nvarchar) + ' and IsNull(g.[Distinct],0) = 1 and NOT c.CollectionID = ' + cast(@collectionID as nvarchar) + '
					) guard on guard.ItemID = it.ItemID
					where NOT Guard.ItemID IS NULL  				
				) as SOURCE
				On (TARGET.[ItemID] = SOURCE.[Itemid] and TARGET.[CollectionID] = SOURCE.[CollectionID]) 
				WHEN MATCHED THEN
				   DELETE;
			'
--			select @query
			EXECUTE(@query)


		END

		IF @mode = 2 

			set @query = '
				MERGE [ARM_CORE]..[A_CollectionItem] as TARGET
				USING ( 
					select it.ItemID, guard.CollectionID from [ARM_CORE]..[TMP_tempItems] it 
					LEFT JOIN (
						select distinct i.itemID, i.CollectionID from [ARM_CORE]..[A_CollectionItem] i  
						LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionID = i.CollectionID
						LEFT JOIN [ARM_CORE]..[A_CollectionClass] g on g.CollectionClassID = c.CollectionClassID
						where c.CollectionClassID = ' + cast(@CollectionClassID as nvarchar) + ' and IsNull(g.[Distinct],0) = 1 and NOT c.CollectionID = ' + cast(@collectionID as nvarchar) + '
					) guard on guard.ItemID = it.ItemID
					where Guard.ItemID IS NULL  				
				) as SOURCE
				On (TARGET.[ItemID] = SOURCE.[Itemid] and TARGET.[CollectionID] = ' + cast(@collectionID as nvarchar) + ' ) 
				WHEN NOT MATCHED THEN
				   INSERT (Itemid,CollectionID) VALUES (Source.[ItemID], ' + cast(@collectionID as nvarchar) + ');
			'	
		ELSE
			set @query = '
				MERGE [ARM_CORE]..[A_CollectionItem] as TARGET
				USING ( select * from [ARM_CORE]..[TMP_tempItems] ) as SOURCE
				On (TARGET.[ItemID] = SOURCE.[Itemid] and TARGET.[CollectionID] = ' + cast(@collectionID as nvarchar) + ' ) 
				WHEN NOT MATCHED THEN
				   INSERT (Itemid,CollectionID) VALUES (Source.[ItemID], ' + cast(@collectionID as nvarchar) + ');
			'

--		select @query
		EXECUTE(@query)



		IF @mode <> 1 
		BEGIN
		-- remove items from target collection that are not contained in qualifying SQL data set
			set @query = '
				delete from [ARM_CORE]..[A_CollectionItem] where CollectionID = ' + cast(@collectionID as nvarchar) + ' and NOT ItemID in (select ItemID from [ARM_CORE]..[TMP_tempItems] ) 
			'

	--		select @query
			EXECUTE(@query)
		END

		FETCH NEXT FROM Agents INTO @qualifySQl, @mode, @collectionID  
		
	END 
 
	CLOSE Agents  
	DEALLOCATE Agents 

			IF OBJECT_ID('[ARM_CORE]..[TMP_tempItems]') IS NOT NULL
			DROP TABLE [ARM_CORE]..[TMP_tempItems];

--	select 1;





END

GO
CREATE PROCEDURE [dbo].[SYSTEM-AutoCollection-NOW]
@CollectionAgentID int = 0
AS
BEGIN

-- Modes are as follows
--  0 - MERGE & PURGE  (keep only those items that are listed by qualifying SQL)
--  1 - MERGE NO PURGE  (add new items identified but retain items already captured)
--  2 - NEW TO CLASS ONLY & PURGE

-- IS Typically Called Twice for two pass model

--------------------------------------------------


	DECLARE @query VARCHAR(MAX)

	Declare @TheHour as int;
	DECLARE @qualifySQl nvarchar(3000);
	DECLARE @mode nvarchar(500);
	DECLARE @collectionID int;

	DECLARE @CollectionClassID int;
	DECLARE @Distinct bit;
		
	set @TheHour = datePart(hour,getdate())

--	DECLARE Agents CURSOR FOR 
--		select qualifySQl, IsNull(mode,0) as Mode, collectionID from [ARM_CORE]..[A_CollectionAgent] where @TheHour in (select value from STRING_SPLIT(IsNull([Frequency],0), ',')) and IsNull(Active,0) = 1 order by [Order]

	DECLARE Agents CURSOR FOR 
		select qualifySQl, IsNull(mode,0) as Mode, collectionID from [ARM_CORE]..[A_CollectionAgent] where CollectionAgentID = @CollectionAgentID 



	SET NOCOUNT ON;

	OPEN Agents  
    
	FETCH NEXT FROM Agents INTO @qualifySQl, @mode, @collectionID  

	IF OBJECT_ID('[ARM_CORE]..[TMP_tempItems]') IS NOT NULL
	DROP TABLE [ARM_CORE]..[TMP_tempItems];


	WHILE @@FETCH_STATUS = 0  
	BEGIN 

		IF OBJECT_ID('[ARM_CORE]..[TMP_tempItems]') IS NOT NULL
			DROP TABLE [ARM_CORE]..[TMP_tempItems];

		set @query = 'select it.ItemID into [ARM_CORE]..[TMP_tempItems] from (' + @qualifySQl + ' ) it '

		EXECUTE(@query)	

		set @CollectionClassID = 0
		set @Distinct = 0

		select @CollectionClassID = IsNull(g.CollectionClassID,0), @Distinct = IsNull(g.[Distinct],0) from [ARM_CORE]..[A_Collection] c LEFT JOIN [ARM_CORE]..[A_CollectionClass] g on g.CollectionClassID = c.CollectionClassID where c.CollectionID = @collectionID

		
		if @Distinct = 1 and NOT @mode = 2
        BEGIN
			-- remove items that are found by qualifying SQL that belong to a collection of the same collection Class as the target Collection but NOT the target collection itself.

			set @query = '
				MERGE [ARM_CORE]..[A_CollectionItem] as TARGET
				USING ( 
					select it.ItemID, guard.CollectionID from [ARM_CORE]..[TMP_tempItems] it 
					LEFT JOIN (
						select distinct i.itemID, i.CollectionID from [ARM_CORE]..[A_CollectionItem] i  
						LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionID = i.CollectionID
						LEFT JOIN [ARM_CORE]..[A_CollectionClass] g on g.CollectionClassID = c.CollectionClassID
						where c.CollectionClassID = ' + cast(@CollectionClassID as nvarchar) + ' and IsNull(g.[Distinct],0) = 1 and NOT c.CollectionID = ' + cast(@collectionID as nvarchar) + '
					) guard on guard.ItemID = it.ItemID
					where NOT Guard.ItemID IS NULL  				
				) as SOURCE
				On (TARGET.[ItemID] = SOURCE.[Itemid] and TARGET.[CollectionID] = SOURCE.[CollectionID]) 
				WHEN MATCHED THEN
				   DELETE;
			'
--			select @query
			EXECUTE(@query)


		END

		IF @mode = 2 

			set @query = '
				MERGE [ARM_CORE]..[A_CollectionItem] as TARGET
				USING ( 
					select it.ItemID, guard.CollectionID from [ARM_CORE]..[TMP_tempItems] it 
					LEFT JOIN (
						select distinct i.itemID, i.CollectionID from [ARM_CORE]..[A_CollectionItem] i  
						LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionID = i.CollectionID
						LEFT JOIN [ARM_CORE]..[A_CollectionClass] g on g.CollectionClassID = c.CollectionClassID
						where c.CollectionClassID = ' + cast(@CollectionClassID as nvarchar) + ' and IsNull(g.[Distinct],0) = 1 and NOT c.CollectionID = ' + cast(@collectionID as nvarchar) + '
					) guard on guard.ItemID = it.ItemID
					where Guard.ItemID IS NULL  				
				) as SOURCE
				On (TARGET.[ItemID] = SOURCE.[Itemid] and TARGET.[CollectionID] = ' + cast(@collectionID as nvarchar) + ' ) 
				WHEN NOT MATCHED THEN
				   INSERT (Itemid,CollectionID) VALUES (Source.[ItemID], ' + cast(@collectionID as nvarchar) + ');
			'	
		ELSE
			set @query = '
				MERGE [ARM_CORE]..[A_CollectionItem] as TARGET
				USING ( select * from [ARM_CORE]..[TMP_tempItems] ) as SOURCE
				On (TARGET.[ItemID] = SOURCE.[Itemid] and TARGET.[CollectionID] = ' + cast(@collectionID as nvarchar) + ' ) 
				WHEN NOT MATCHED THEN
				   INSERT (Itemid,CollectionID) VALUES (Source.[ItemID], ' + cast(@collectionID as nvarchar) + ');
			'

--		select @query
		EXECUTE(@query)



		IF @mode <> 1 
		BEGIN
		-- remove items from target collection that are not contained in qualifying SQL data set
			set @query = '
				delete from [ARM_CORE]..[A_CollectionItem] where CollectionID = ' + cast(@collectionID as nvarchar) + ' and NOT ItemID in (select ItemID from [ARM_CORE]..[TMP_tempItems]) 
			'

	--		select @query
			EXECUTE(@query)
		END

		FETCH NEXT FROM Agents INTO @qualifySQl, @mode, @collectionID  
		
	END 
 
	CLOSE Agents  
	DEALLOCATE Agents 

			IF OBJECT_ID('[ARM_CORE]..[TMP_tempItems]') IS NOT NULL
			DROP TABLE [ARM_CORE]..[TMP_tempItems];

--	select 1;





END

GO
-- =============================================
-- Author:		John Reed
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SYSTEM_AUTO_WIP]
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

---- SQL to feed _WIP process
---- Apps with less than 5 installs will be hoovered in _WIP AppGroup IF the root of the app doesnt generate 5 or more. Here mapping application will need to be created, its AppGrp set and a mapping to _WIP-101 
---- where inidividual is less than 5 but root is 5 or more, create its own group, set Automapping- and currentApplication to _WIP (X).  Here application will be created when AitoMapping script runs.

	IF object_id('[ARM_CORE]..[TMP_TempWIPlist]','U') is not null
		DROP TABLE [ARM_CORE]..[TMP_TempWIPlist]


--- WILL NEED TO CREATE APPGROUP IF _WIP NOT DEFINED  !!!!!

	declare @WIPgroupID int
	select @WIPgroupID = AppGroupID from [ARM_CORE]..[AppGroup] where AppGroupName = '_WIP'


	MERGE [ARM_CORE]..[Application] as TARGET
	USING ( select '_WIP-101' as [ApplicationID], @WIPgroupID as AppGroupID, '_WIP' as [Name], '101' as [Version] ) as SOURCE
	ON (TARGET.[ApplicationID] = SOURCE.[ApplicationID])
	WHEN NOT MATCHED THEN
		INSERT ([ApplicationID], [AppGroupID], [Name], [Version], Exclude) 
		VALUES (SOURCE.[ApplicationID], SOURCE.[AppGroupID], SOURCE.[Name], SOURCE.[Version], 1);




	select x.*, b.Total, Replace(x.ApplicationID,x.[root]+'-','') as [Version]  
	into [ARM_CORE]..[TMP_TempWIPlist]
	from (
		select distinct s.ApplicationID , Count(s.AssetID) as Installs
			, replace(s.[ApplicationID],'-'+reverse(left(reverse(s.[ApplicationID]), charindex('-', reverse(s.[ApplicationID])) -1)),'') as [root]
		from [ARM_CORE]..[AppAstAsIs] s 
		group by s.ApplicationID
	) x 
	LEFT JOIN (
		select distinct replace(r.[ApplicationID],'-'+reverse(left(reverse(r.[ApplicationID]), charindex('-', reverse(r.[ApplicationID])) -1)),'') as [root]
			, Count(r.AssetID) as [Total]
		from [ARM_CORE]..[AppAstAsIs] r group by replace(r.[ApplicationID],'-'+reverse(left(reverse(r.[ApplicationID]), charindex('-', reverse(r.[ApplicationID])) -1)),'')
	) b on b.root = x.root

	LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = x.ApplicationID
	LEFT JOIN [ARM_CORE]..[AppGroup] g on g.AppGroupName = x.root

	where x.Installs < 5 and IsNull(a.AppGroupID,0) = 0  --- a.ApplicationID IS NULL    ---  IsNull(a.AppGroupID,0) = 0 -- and IsNull(a.Exclude,0) = 0
	and  g.AppGroupName IS NULL



	-- Create App Groups, their mappings and current app in group to be _WIP-101 where root of app as mapping pattern generates more than 5 installs

	MERGE [ARM_CORE]..[AppGroup] as TARGET
	USING (

		select NewGroup.[root] as [AppGroupName], NewGroup.[root]+'%' as AutoMappingPattern, '_WIP-101' as [CurrentApplication] from (
			select * from [ARM_CORE]..[TMP_TempWIPlist]
		) NewGroup where NewGroup.Total > 4

	) as SOURCE
	ON (TARGET.[AppGroupName]  = SOURCE.[AppGroupName])
	WHEN NOT MATCHED THEN
		INSERT (AppGroupName, AutoMappingPattern, [CurrentApplication], AutoGenerated) 
		VALUES (SOURCE.AppGroupName, SOURCE.AutoMappingPattern, SOURCE.[CurrentApplication], 1);


	-- run auto mapping to create application and do mapping.
		
	EXEC [ARM_CORE]..[Apps-AutoAppsGroupMapping]



	-- SQL to use to create Auto Mappings for apps with less than 5 installs into AppGroup called '_WIP'
	-- first create the Application

--	declare @WIPgroupID int
	select @WIPgroupID = AppGroupID from [ARM_CORE]..[AppGroup] where AppGroupName = '_WIP'

	MERGE [ARM_CORE]..[Application] as TARGET
	USING (
		select ForWIPgroup.[ApplicationID], @WIPgroupID as AppGroupID, ForWIPgroup.[root] as [Name], Left(ForWIPgroup.[Version],49) as [Version] from (
			select * from [ARM_CORE]..[TMP_TempWIPlist]
		) ForWIPgroup where ForWIPgroup.Total < 5
	) as SOURCE
	ON (TARGET.[ApplicationID] = SOURCE.[ApplicationID])
	WHEN NOT MATCHED THEN
		INSERT ([ApplicationID], [AppGroupID], [Name], [Version]) 
		VALUES (SOURCE.[ApplicationID], SOURCE.[AppGroupID], SOURCE.[Name], SOURCE.[Version]);

	-- now create the Mapping

	MERGE [ARM_CORE]..[TransformAppMap] as TARGET
	USING (
		select ForWIPgroup.[ApplicationID] as [As Is], '_WIP-101' as [To Be], 'Auto' as [Status] from (
			select * from [ARM_CORE]..[TMP_TempWIPlist]
		) ForWIPgroup where ForWIPgroup.Total < 5
	) as SOURCE
	ON (TARGET.[As Is]  = SOURCE.[As Is])
	WHEN NOT MATCHED THEN
		INSERT ([As Is], [To Be], [Status]) 
		VALUES (SOURCE.[As Is], SOURCE.[To Be], SOURCE.[Status]);




	EXEC [ARM_CORE]..[Apps-ReApplyAppTransforms]
	EXEC [ARM_CORE]..[SYSTEM-AutoCollections]
	EXEC [ARM_CORE]..[CalculateAllBitValues]
	EXEC [ARM_CORE]..[SYSTEM-AutoCollections]



END

GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SYS-TableUploadFields]
@tbl nvarchar(500) = '',
@db nvarchar(500) = 'ARM_CORE'
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.

	SET NOCOUNT ON 

	if @db <> '' and @tbl <> ''
	BEGIN

		SELECT s.[name] AS [Column], t.name as [Type],   
		columnproperty(s.id, s.[name] ,'IsIdentity') as IsIdentity,	s.[colorder], IsNull(e.[Order],s.[colorder]) as AdjustedOrder, e.[HelpText],  
		IsNull(e.[Property],0) as [Property], IsNull(e.[Exclude],0) as [Exclude], IsNull(e.[InitialValue],'') as InitialValue,   
		IsNull(e.[Group],'') as [Group], IsNull(e.[Height], 1) as Height, IsNull(e.[Width],'') as Width, IsNull(e.[TextEditor],0) as [TextEditor], s.prec as MaxLength 
		, IsNull(e.[UploadExclude],0) as [UploadExclude] 
		FROM [syscolumns] s 
		LEFT JOIN sys.[Tables] x on x.object_id =s.id
		LEFT JOIN [ARM_CORE]..[A_TableEdit] e on e.[Column] = s.[name] and e.[Table] = x.name   
		LEFT JOIN [ARM_CORE].sys.[types] t on t.system_type_id = s.xtype   
		WHERE s.id = object_id('[' + @db + ']..[' + @tbl + ']') and IsNull(e.[UploadExclude],0) = 0 and IsNull(t.[name],'') <> 'sysname' 
		Order by IsNull(e.[Group],'') ,IsNull(e.[Order],s.[colorder]), s.[colorder], s.[name]

	END
END


GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SYS-TableStructure]
@tbl nvarchar(500) = '',
@db nvarchar(500) = '',
@set nvarchar(500) = ''
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.

	SET NOCOUNT ON 

	if @db = '' set @db = DB_NAME()


	if @db <> '' and @tbl <> ''
	BEGIN
		IF @Set = '' 
			SELECT IsNull(e.[Label],s.[name]) AS [FieldLabel], s.[name] AS [Column], IsNull(l.[Lookup],'no_lookup_values') as [Lookup], l.[Label] as OptionText, l.[Order], t.name as [Type],   
			columnproperty(s.id, s.[name] ,'IsIdentity') as IsIdentity,	s.[colorder], IsNull(e.[Order],s.[colorder]) as AdjustedOrder,  IsNull(e.[HelpText],'') as HelpText,  
			IsNull(e.[Property],0) as [Property], IsNull(e.[Exclude],0) as [Exclude], IsNull(e.[InitialValue],'') as InitialValue,   
			IsNull(e.[Group],'') as [Group], IsNull(e.[Height], 1) as Height, IsNull(e.[Width],'') as Width, IsNull(e.[TextEditor],0) as [TextEditor], s.prec as MaxLength, e.ClosedList  
			FROM [syscolumns] s 
			LEFT JOIN sys.[Tables] x on x.object_id =s.id
			LEFT JOIN [ARM_CORE]..[A_Lookup] l on l.[Column] = s.[name] and l.[Table] = x.name   
			LEFT JOIN [ARM_CORE]..[A_TableEdit] e on e.[Column] = s.[name] and e.[Table] = x.name   
			LEFT JOIN sys.[types] t on t.system_type_id = s.xtype   
			WHERE s.id = object_id('[' + @db + ']..[' + @tbl + ']') and IsNull(e.[Exclude],0) = 0 and IsNull(t.[name],'') <> 'sysname' 
			Order by IsNull(e.[Group],'') ,IsNull(e.[Order],s.[colorder]), s.[colorder], s.[name], l.[Order], l.[Label]
		ELSE
			SELECT IsNull(e.[Label],s.[name]) AS [FieldLabel], s.[name] AS [Column], IsNull(l.[Lookup],'no_lookup_values') as [Lookup], l.[Label] as OptionText, l.[Order], t.name as [Type],   
			columnproperty(s.id, s.[name] ,'IsIdentity') as IsIdentity,	s.[colorder], IsNull(e.[Order],s.[colorder]) as AdjustedOrder, IsNull(e.[HelpText],'') as HelpText,  
			IsNull(e.[Property],0) as [Property], IsNull(e.[Exclude],0) as [Exclude], IsNull(e.[InitialValue],'') as InitialValue,   
			IsNull(e.[Group],'') as [Group], IsNull(e.[Height], 1) as Height, IsNull(e.[Width],'') as Width, IsNull(e.[TextEditor],0) as [TextEditor], s.prec as MaxLength, e.ClosedList  
			FROM [syscolumns] s 
			LEFT JOIN sys.[Tables] x on x.object_id =s.id
			LEFT JOIN [ARM_CORE]..[A_Lookup] l on l.[Column] = s.[name] and l.[Table] = x.name   
			LEFT JOIN [ARM_CORE]..[A_TableEdit] e on e.[Column] = s.[name] and e.[Table] = x.name   
			LEFT JOIN sys.[types] t on t.system_type_id = s.xtype   
			LEFT JOIN [A_TableEditSet] g on g.[SetName] = @set and g.[SetFieldName] = s.[name]
			WHERE s.id = object_id('[' + @db + ']..[' + @tbl + ']') and IsNull(e.[Exclude],0) = 0 and IsNull(t.[name],'') <> 'sysname' and NOT g.TableEditSetID IS NULL
			Order by IsNull(e.[Group],'') ,IsNull(e.[Order],s.[colorder]), s.[colorder], s.[name], l.[Order], l.[Label]
	END
END


GO
 
 
 
CREATE PROCEDURE [dbo].[SYS-SQL-TableMods]
                @ObjName nvarchar(500) = '',
                @theText nvarchar(Max) output
AS  
BEGIN  
 
                set @theText = ''
                DECLARE @myEventTime datetime
                DECLARE @myLoginName nvarchar(500)
                DECLARE @myUserName nvarchar(500)
                DECLARE @myDatabaseName nvarchar(500)
                DECLARE @mySchemaName nvarchar(500)
                DECLARE @myObjectName nvarchar(500)
                DECLARE @myObjectType nvarchar(500)
                DECLARE @myCommand nvarchar(MAX)
                DECLARE @CRLF NCHAR(5)  SET @CRLF = Nchar(13) + NChar(10)
               DECLARE db_list  CURSOR FOR 
                                SELECT 
--                                                             [DDL_Event_Time]
--                                               ,[DDL_Login_Name]
--                                               ,[DDL_User_Name]
--                                               ,[DDL_Database_Name]
--                                               ,[DDL_Schema_Name]
--                                               ,[DDL_Object_Name]
--                                               ,[DDL_Object_Type]
--                                               ,
                                                  Replace([DDL_Command],'&#x0D;',@CRLF) as [DDL_Command]
--,[DDL_Command]
                                  FROM [ARM_CORE].[dbo].[Audit_DDL_Events] 
                                  where [DDL_Object_Name] = @ObjName and [DDL_Object_Type] = 'TABLE'
                                  Order by [DDL_Event_Time] 
 
                OPEN db_list  
--             FETCH NEXT FROM db_list INTO @myEventTime, @myLoginName, @myUserName, @myDatabaseName, @mySchemaName, @myObjectName, @myObjectType, @myCommand 
                FETCH NEXT FROM db_list INTO @myCommand
                
 
                WHILE @@FETCH_STATUS = 0  
                BEGIN  
                                set @theText = @theText + @myCommand + @CRLF
                                FETCH NEXT FROM db_list INTO @myCommand
                END 
 
                CLOSE db_list  
                DEALLOCATE db_list 
END
 
 

GO
 
 
 
 
CREATE PROCEDURE [dbo].[SYS-SQL-Table]
                @ObjName nvarchar(500) = '',
                @Output nvarchar(Max) output
AS  
BEGIN  
 
                DECLARE @CRLF NCHAR(2)
                SET @CRLF = Nchar(13) + NChar(10)
                DECLARE @PLACEHOLDER NCHAR(3)
                SET @PLACEHOLDER = '{:}'
 
                SELECT @Output = '' +
                                CAST(
                                                REPLACE(
                                                                'create table ' + QuoteName(t.TABLE_CATALOG) + '.' + QuoteName(t.TABLE_SCHEMA) + '.' + QuoteName(so.name) + ' (' + @CRLF 
                                                                + LEFT(o.List, Len(o.List) - (LEN(@PLACEHOLDER)+2)) + @CRLF + ');' + @CRLF
                                                                + CASE WHEN tc.Constraint_Name IS NULL THEN '' 
                                                                  ELSE
                                                                                'ALTER TABLE ' + QuoteName(t.TABLE_CATALOG) + '.' + QuoteName(t.TABLE_SCHEMA) + '.' + QuoteName(so.Name) 
                                                                                + ' ADD CONSTRAINT ' + tc.Constraint_Name  + ' PRIMARY KEY (' + LEFT(j.List, Len(j.List) - 1) + ');' + @CRLF
                                                                  END,
                                                                @PLACEHOLDER,
                                                                @CRLF
                                                )
                                AS nvarchar(max)) 
                FROM sysobjects so
                CROSS APPLY (
                                SELECT 
                                                  '   '
                                                  + '['+column_name+'] ' 
                                                  +  data_type 
                                                  + case data_type
                                                                                when 'sql_variant' then ''
                                                                                when 'text' then ''
                                                                                when 'ntext' then ''
                                                                                when 'decimal' then '(' + cast(numeric_precision as varchar) + ', ' + cast(numeric_scale as varchar) + ')'
                                                                  else 
                                                                  coalesce(
                                                                                '('+ case when character_maximum_length = -1 
                                                                                                then 'MAX' 
                                                                                                else cast(character_maximum_length as varchar) end 
                                                                                + ')','') 
                                                                end 
                                                + ' ' 
                                                + case when exists ( 
                                                                SELECT id 
                                                                FROM syscolumns
                                                                WHERE 
                                                                                object_name(id) = so.name
                                                                                and name = column_name
                                                                                and columnproperty(id,name,'IsIdentity') = 1 
  ) then
                                                                'IDENTITY(' + 
                                                                cast(ident_seed(so.name) as varchar) + ',' + 
                                                                cast(ident_incr(so.name) as varchar) + ')'
                                                  else ''
                                                  end 
                                                + ' ' 
                                                + (case when IS_NULLABLE = 'No' then 'NOT ' else '' end) 
                                                + 'NULL ' 
                                                + case when information_schema.columns.COLUMN_DEFAULT IS NOT NULL THEN 'DEFAULT '+ information_schema.columns.COLUMN_DEFAULT 
                                                  ELSE '' 
                                                  END 
                                                + ', ' 
                                                + @PLACEHOLDER  -- note, can't have a field name or we'll end up with XML
                                FROM information_schema.columns where table_name = so.name
                                ORDER BY ordinal_position
                                FOR XML PATH('')
                ) o (list)
                LEFT JOIN information_schema.table_constraints tc on  
                                tc.Table_name = so.Name
                                AND tc.Constraint_Type  = 'PRIMARY KEY'
                LEFT JOIN information_schema.tables t on  
                                t.Table_name = so.Name
                CROSS APPLY (
                                SELECT QUOTENAME(Column_Name) + ', '
                                FROM information_schema.key_column_usage kcu
                                WHERE kcu.Constraint_Name = tc.Constraint_Name
                                ORDER BY ORDINAL_POSITION
                                FOR XML PATH('')
                ) j (list)
 
                WHERE
                                xtype = 'U'
                                AND name NOT IN ('dtproperties')
                                AND so.name = @ObjName
 
 
END

GO
 
 
 
CREATE PROCEDURE [dbo].[SYS-SQL-StoredProcedure]
                @ObjName nvarchar(500) = '',
                @Update bit = 0,
                @theText nvarchar(Max) output
AS  
BEGIN  
 
                Declare @T Table ([text] VARCHAR(Max))
                Insert @T Exec sp_helptext @ObjName
 
                DECLARE db_cursor CURSOR FOR 
                Select [text] from @T
                DECLARE @myLine nvarchar(MAX)
                set @theText = ''
                OPEN db_cursor  
                FETCH NEXT FROM db_cursor INTO @myLine  
 
                WHILE @@FETCH_STATUS = 0  
                BEGIN  
                                set @theText = @theText +  @myLine
                                FETCH NEXT FROM db_cursor INTO @myLine 
                END 
 
                CLOSE db_cursor  
                DEALLOCATE db_cursor 
                
                if @Update = 1 
                BEGIN
                                SET @theText = REPLACE(@theText, 'CREATE PROC', 'ALTER PROC')
                                SET @theText = REPLACE(@theText, 'CREATE FUNC', 'ALTER FUNC')
                                SET @theText = REPLACE(@theText, 'CREATE VIEW', 'ALTER VIEW')
                END
END
 
 

GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SYS-SiteUp]
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
	update [ARM_CORE]..[A_SiteProperties] set SiteActive = 1, LastUpdate = getdate(), SystemMessage = ''
END


GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SYS-SiteDown]
@Message nvarchar(MAX) = ''
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
	update [ARM_CORE]..[A_SiteProperties] set SiteActive = 0, LastUpdate = getdate(), SystemMessage = @Message
END


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SYS-Show_All_Primary_Keys]
	-- Add the parameters for the stored procedure here
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

select schema_name(tab.schema_id) as [schema_name], 
    pk.[name] as pk_name,
    ic.index_column_id as column_id,
    col.[name] as column_name, 
    tab.[name] as table_name
	,t.[name] as [type]
FROM   sys.[Tables] tab 

    inner join sys.indexes pk
        on tab.object_id = pk.object_id 
        and pk.is_primary_key = 1
    inner join sys.index_columns ic
        on ic.object_id = pk.object_id
        and ic.index_id = pk.index_id
    inner join sys.columns col
        on pk.object_id = col.object_id
        and col.column_id = ic.column_id

	inner JOIN sys.[types] t on t.system_type_id = col.system_type_id 
where IsNull(t.[name],'') <> 'sysname' 
order by schema_name(tab.schema_id),
    pk.[name],
    ic.index_column_id
END

GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SYS-PurgeAssets]
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here

	delete from [ARM_CORE]..[AssetCache] where AssetID In (
		Select AssetID from [ARM_CORE]..[Asset] a where a.BArea = 'PURGE'
	) 
	delete from [ARM_CORE]..[AssetStatus] where AssetID In (
		Select AssetID from [ARM_CORE]..[Asset] a where a.BArea = 'PURGE'
	) 
	delete from [ARM_CORE]..[AppAstToBe] where AssetID In (
		Select AssetID from [ARM_CORE]..[Asset] a where a.BArea = 'PURGE'
	) 
	delete from [ARM_CORE]..[AppAstAsIs] where AssetID In (
		Select AssetID from [ARM_CORE]..[Asset] a where a.BArea = 'PURGE'
	) 
	delete from [ARM_CORE]..[ModelToBe] where AssetID In (
		Select AssetID from [ARM_CORE]..[Asset] a where a.BArea = 'PURGE'
	)
	delete from [ARM_CORE]..[NotificationLog] where AssetID In (
		Select AssetID from [ARM_CORE]..[Asset] a where a.BArea = 'PURGE'
	)

	delete from [ARM_CORE]..[A_CollectionItem] where itemID In (
		Select itemID from [ARM_CORE]..[A_CollectionItem] i 
			LEFT JOIN [ARM_CORE]..[Collection] c on c.CollectionID = i.CollectionID 
			LEFT JOIN [ARM_CORE]..[Asset] a on a.AssetID = i.ItemID
		where a.BArea = 'PURGE' and c.[Type] = 'Asset'
	)  
	


	delete from [ARM_CORE]..[ScheduleBooking] where AssetID In (
		Select AssetID from [ARM_CORE]..[Asset] a where a.BArea = 'PURGE'
	) 


	delete from [ARM_CORE]..[AssetIssues] where AssetID In (
		Select AssetID from [ARM_CORE]..[Asset] a where a.BArea = 'PURGE'
	)
	delete from [ARM_CORE]..[MappedDrives] where AssetID In (
		Select AssetID from [ARM_CORE]..[Asset] a where a.BArea = 'PURGE'
	)
	delete from [ARM_CORE]..[ScheduleDeployRunAssets] where AssetID In (
		Select AssetID from [ARM_CORE]..[Asset] a where a.BArea = 'PURGE'
	)

	delete from [ARM_CORE]..[Transaction] where AssetID In (
		Select AssetID from [ARM_CORE]..[Asset] a where a.BArea = 'PURGE'
	)



	delete from [ARM_CORE]..[Asset]  where BArea = 'PURGE'
	 
END




GO

-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SYS-Prime-Workstreams-from-BAREA]
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	DECLARE @myName NVARCHAR(255)

	DECLARE db_create CURSOR FOR 
		select BArea from BArea where Internal = 0 and NOt BArea like '{%' 
		and NOT BArea in ('Japan','United Kingdom','APEL - PILOT 2016','Leiden W10','APEL - Sweep Up WINSHUTTLE','APEL - Sweep Up Mat leave and long term sick','Netherlands','Russia','Ukraine','SPECIAL')

	OPEN db_create  
	FETCH NEXT FROM db_create INTO @myName  
 
    WHILE @@FETCH_STATUS = 0  
    BEGIN  
        EXEC [ARM_CORE]..[NewWorkstream] @myName, 'GPCR19'

        FETCH NEXT FROM db_create INTO @myName   
    END 

	CLOSE db_create  
	DEALLOCATE db_create 
END




GO
-- =============================================
-- Author:		<Author,,Name>
-- ALTER date: <ALTER Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SYS-IsAnonymous]
	-- Add the parameters for the stored procedure here
	@URL varchar(500),
	@RoleID int = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
	DECLARE @response bit = 0

	if(@RoleID = 0)
		BEGIN
			if NOT exists(select top 1 a.PID from [ARM_CORE]..[A_File] f 
						LEFT JOIN [ARM_CORE]..[A_FileAccess] a on a.FileID = f.FileID 
						where f.FilePath = @URL 
					)
				begin
					set @response = 1
				end
		END


	if (@RoleID <> 0)
		BEGIN
			if exists(select top 1 a.PID from [ARM_CORE]..[A_File] f 
						LEFT JOIN [ARM_CORE]..[A_FileAccess] a on a.FileID = f.FileID 
						where f.FilePath = @URL  and a.RoleID = @RoleID
					)
				begin
					set @response = 1
				end
		END
END


GO
-- =============================================
CREATE PROCEDURE [dbo].[SYS-Import_ExternProfile] 
                @file nvarchar(250) = 'ExternProfile.json',
                @FolderPath nvarchar(500) = NULL
AS
BEGIN
                -- SET NOCOUNT ON added to prevent extra result sets from
                -- interfering with SELECT statements.
                SET NOCOUNT ON;
                                -- Insert statements for procedure here
                DECLARE @DumpFolder NVARCHAR(250)
                DECLARE @query VARCHAR(MAX)
                select @DumpFolder = IsNull(@FolderPath, [DataRoot]+'DUMP\') from [ARM_CORE]..[A_SiteProperties]
                SET @query = 'DECLARE @json NVARCHAR(MAX); SELECT @json = BulkColumn FROM OPENROWSET (BULK ''' + @DumpFolder + @file + ''', SINGLE_CLOB) as j;
                
                                
                                SELECT * 
                                Into [sys_ExternProfile]
                                FROM OPENJSON(@json)
                                WITH (
                                                [TypeDesc]                         nvarchar(255)    ''$.type_desc'',
                                                [Type]                                   nvarchar(12)      ''$.type'',
                                                [Name]                                nvarchar(255)    ''$.name'',
                                                [create_date]    datetime                             ''$.create_date'',
                                                [modify_date]   datetime                             ''$.modify_date'',
                                                [ObjID]                                 int                                                           ''$.Object_id''
                                )
                '
                IF object_id('[sys_ExternProfile]','U') is not null Drop Table [sys_ExternProfile]
                EXECUTE(@query)
END
GO
CREATE PROCEDURE [dbo].[SYS-HasAccess]
	-- Add the parameters for the stored procedure here
	@URL varchar(500),
	@RoleID int = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
	DECLARE @response bit = 0


	if exists(select top 1 f.FileID from [ARM_CORE]..[A_File] f  where f.FilePath = @URL and IsNull(f.Ignore,0) = 1 )
	begin
			set @response = 1
	end
	
	if (@response = 0)
		BEGIN
			if exists(select top 1 a.PID from [ARM_CORE]..[A_File] f 
						LEFT JOIN [ARM_CORE]..[A_FileAccess] a on a.FileID = f.FileID 
						where f.FilePath = @URL  and (a.RoleID = @RoleID or a.RoleID = 0)
					)
				begin
					set @response = 1
				end
		END

	select @response as [HasAccess]
END


GO
 
 
-- =============================================
-- Author:                            <Author,,Name>
-- Create date: <Create Date,,>
-- Description:    <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SYS-GetProfile]
AS
BEGIN
                -- SET NOCOUNT ON added to prevent extra result sets from
                -- interfering with SELECT statements.
                SET NOCOUNT ON;
                DECLARE @lastModifiedDate datetime
--                select @lastModifiedDate = p.LastProfileUpdate from [ARM_CORE]..[A_SiteProperties] p 
 
 
    -- Insert statements for procedure here
                select type_desc, type, name,create_date,IsNull(@lastModifiedDate,modify_date) as [modify_date], Object_id
                from sys.procedures 
 
                UNION
                select type_desc, type, name,create_date,IsNull(@lastModifiedDate,modify_date) as [modify_date], Object_id
                from sys.tables 
 
                UNION
 
                select type_desc, type, name,create_date,IsNull(@lastModifiedDate,modify_date) as [modify_date], Object_id
                from sys.views 
 
                UNION
                select type_desc, type, name,create_date,IsNull(@lastModifiedDate,modify_date) as [modify_date], Object_id
                FROM    sys.objects
                WHERE   type IN (N'FN', N'IF', N'TF')
--                FOR JSON PATH
 
END
 

GO
 
 
 
CREATE PROCEDURE [dbo].[SYS-GetIdentity]
@tbl nvarchar(1000) = '', @idName VARCHAR(100)  = '' OUTPUT
AS  
BEGIN 
	SET NOCOUNT ON 

	Select x.name as [Table], IsNull(s.[Column Name],p.[Key]) as [Identity], IsNull(s.[Column Name],'') as [IsIdentity]
	from  sys.[Tables] x 
	LEFT JOIN (
		Select distinct Object_Name([object_id]) as [Table Name],[name] as [Column Name]
		from sys.columns s
		LEFT JOIN [ARM_CORE]..[A_TablePermit] p on p.[Table] = Object_Name([object_id])
		Where is_identity=1 And Objectproperty(object_id,'IsUserTable')=1
	) s on s.[Table Name] = x.Name
	LEFT JOIN [ARM_CORE]..[A_TablePermit] p on p.[Table] = x.Name
	where Objectproperty(x.object_id,'IsUserTable')=1 and x.Name = @tbl

		Select @idName = IsNull(s.[Column Name],p.[Key])
	from  sys.[Tables] x 
	LEFT JOIN (
		Select distinct Object_Name([object_id]) as [Table Name],[name] as [Column Name]
		from sys.columns s
		LEFT JOIN [ARM_CORE]..[A_TablePermit] p on p.[Table] = Object_Name([object_id])
		Where is_identity=1 And Objectproperty(object_id,'IsUserTable')=1
	) s on s.[Table Name] = x.Name
	LEFT JOIN [ARM_CORE]..[A_TablePermit] p on p.[Table] = x.Name
	where Objectproperty(x.object_id,'IsUserTable')=1 and x.Name = @tbl

	RETURN 

END



GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SYS-Get_Primary_Key]
	-- Add the parameters for the stored procedure here
	@TABLE nvarchar(255), @pk varchar(100) = NULL output
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

select schema_name(tab.schema_id) as [schema_name], 
    pk.[name] as pk_name,
    ic.index_column_id as column_id,
    tab.[name] as table_name,
    col.[name] as column_name, 
	t.[name] as [type] 
	INTO #tableOut
FROM   sys.[Tables] tab 

    inner join sys.indexes pk
        on tab.object_id = pk.object_id 
        and pk.is_primary_key = 1
    inner join sys.index_columns ic
        on ic.object_id = pk.object_id
        and ic.index_id = pk.index_id
    inner join sys.columns col
        on pk.object_id = col.object_id
        and col.column_id = ic.column_id

	inner JOIN sys.[types] t on t.system_type_id = col.system_type_id 
where IsNull(t.[name],'') <> 'sysname' and tab.[name] = @TABLE
order by schema_name(tab.schema_id),
    pk.[name],
    ic.index_column_id
select @pk = column_name FROM  #tableOut

select * from #tableOut
END


GO
CREATE PROCEDURE [dbo].[SYS-GenerateSQLDelta]
	@Since date
AS  
BEGIN  
	SET NOCOUNT ON;
 
                DECLARE @theText nvarchar(MAX) set @theText = ''
				DECLARE @myTheText nvarchar(MAX) 

                DECLARE @myTypeDesc nvarchar(500)
                DECLARE @myType nvarchar(500)
                DECLARE @myName nvarchar(500)
                DECLARE @myCDate datetime
                DECLARE @myMDate datetime
                DECLARE @myObjectID int
                DECLARE @CRLF NVARCHAR(5)                 SET @CRLF = Nchar(13) + NChar(10)
                DECLARE @GO NVARCHAR(20)                  SET @GO = @CRLF + 'GO' + @CRLF + @CRLF

                DECLARE @DUMPFILE NVARCHAR(250) select @DUMPFILE = [DataRoot] + 'DUMP\UpdateScript.sql' from [ARM_CORE]..[A_SiteProperties]

                DECLARE @runDate smalldatetime
                select @runDate = getdate();


                IF OBJECT_ID (N'TMP_SQLStatements', N'U') IS NULL
                BEGIN

					CREATE TABLE [TMP_SQLStatements](
						[ID] [int] IDENTITY(1,1) NOT NULL,
						--[StatementOrder] [int] NULL,
						[Descriptor] [nvarchar](50) NULL,
						[StatementString] [nvarchar](max) NULL,
					PRIMARY KEY CLUSTERED 
					(
						[ID] ASC
					) WITH (
						PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
					) ON [PRIMARY]
				END
				ELSE
					TRUNCATE TABLE [TMP_SQLStatements]
                


 --               set @theText += 'USE [ARM_CORE] ' + @GO + 'Update [A_SiteProperties] set [LastProfileUpdate] = ''' + cast(@runDate as nvarchar(50)) + '''' + @GO
 --               EXEC [ARM_CORE]..[WriteToFile] @DUMPFILE, @theText
                set @theText += 'SET ANSI_NULLS ON ' + @GO + 'SET QUOTED_IDENTIFIER ON ' + @GO
 --               EXEC [ARM_CORE]..[WriteToFile] @DUMPFILE, @theText
 
                INSERT INTO [TMP_SQLStatements] (Descriptor, StatementString)
                VALUES ('Stamp Update', @theText)
 
                -- Cursor for all Objects not yet created in External Profile 
                DECLARE db_create CURSOR FOR 
                    select [CORE_CODE].* from (
                        select type_desc, type, name,create_date,modify_date, Object_id from sys.procedures 
                                        UNION
                        select type_desc, type, name,create_date,modify_date, Object_id from sys.tables 
                                        UNION
                        select type_desc, type, name,create_date,modify_date, Object_id from sys.views 
                                        UNION
                        select type_desc, type, name,create_date,modify_date, Object_id FROM sys.objects WHERE [type] IN (N'FN', N'IF', N'TF')
                    ) as [CORE_CODE] 
                    where create_date > IsNull(@Since,getdate()-1) and NOT name like 'TMP%'
 
                OPEN db_create  
                FETCH NEXT FROM db_create INTO @myTypeDesc, @myType, @myName, @myCDate, @myMDate, @myObjectID  
 
                WHILE @@FETCH_STATUS = 0  
                BEGIN  
					set @theText = ''

                    if @myTypeDesc = 'SQL_STORED_PROCEDURE' or @myTypeDesc = 'SQL_TABLE_VALUED_FUNCTION' or @myTypeDesc = 'VIEW' or @myType = 'FN' EXEC [SYS-SQL-StoredProcedure] @myName, 0, @theText OUTPUT
                    else if @myTypeDesc = 'USER_TABLE' EXEC [SYS-SQL-Table] @myName, @theText OUTPUT
                    else set @theText += @CRLF + '-- Something else -- ' + @myTypeDesc + ' [' + @myName + ']' + @CRLF

                    set @theText += @GO

					INSERT INTO [TMP_SQLStatements] (Descriptor, StatementString)
					VALUES ('Create ' + @myName, @theText)

--                  EXEC [ARM_CORE]..[WriteToFile] @DUMPFILE, @theText

                    FETCH NEXT FROM db_create INTO @myTypeDesc, @myType, @myName, @myCDate, @myMDate , @myObjectID   
                END 
 
                CLOSE db_create  
                DEALLOCATE db_create 
 
--             type_desc           type       name    create_date       modify_date      Object_id
-- SQL_STORED_PROCEDURE      P             sp_MScleanupmergepublisher   2016-04-30 00:47:59.790               2016-04-30 00:48:23.277       1819153526
 
 
 
 
                -- Cursor for all Objects not yet created in External Profile 
                DECLARE db_alter CURSOR FOR 
					select [CORE_CODE].* from (
                                    select type_desc, type, name,create_date,modify_date, Object_id from sys.procedures 
                                                    UNION
                                    select type_desc, type, name,create_date,modify_date, Object_id from sys.tables 
                                                    UNION
                                    select type_desc, type, name,create_date,modify_date, Object_id from sys.views 
                                                    UNION
                                    select type_desc, type, name,create_date,modify_date, Object_id FROM sys.objects WHERE [type] IN (N'FN', N'IF', N'TF')
                    ) as [CORE_CODE] 
                    where [modify_date] > IsNull(@Since,getdate()-1) and NOT name like 'TMP%' and NOT create_date > IsNull(@Since,getdate()-1) 
 
                OPEN db_alter  
                FETCH NEXT FROM db_alter INTO @myTypeDesc, @myType, @myName, @myCDate, @myMDate, @myObjectID  
 
                WHILE @@FETCH_STATUS = 0  
                BEGIN  
					set @TheText = ''

                    if @myTypeDesc = 'SQL_STORED_PROCEDURE' or @myTypeDesc = 'SQL_TABLE_VALUED_FUNCTION' or @myTypeDesc = 'VIEW' EXEC [SYS-SQL-StoredProcedure] @myName, 1, @TheText OUTPUT
                    else if @myTypeDesc = 'USER_TABLE' EXEC [SYS-SQL-TableMods] @myName, @TheText OUTPUT
                    else set @TheText = @CRLF + '-- Something else -- ' + @myTypeDesc + ' [' + @myName + ']' + @CRLF


                    set @theText += @GO
--                                EXEC [ARM_CORE]..[WriteToFile] @DUMPFILE, @theText

					INSERT INTO [TMP_SQLStatements] (Descriptor, StatementString)
					VALUES ('Alter ' + @myName, @theText)

                    FETCH NEXT FROM db_alter INTO @myTypeDesc, @myType, @myName, @myCDate, @myMDate , @myObjectID   
                END 
 
                CLOSE db_alter  
                DEALLOCATE db_alter 
 
				select * from [TMP_SQLStatements]
 
END
GO
CREATE PROCEDURE [dbo].[SYS-GenerateDeltaSQL-ToScreen]
AS  
BEGIN  
 
                DECLARE @theText nvarchar(MAX) set @theText = ''
                DECLARE @SQLText nvarchar(MAX) set @SQLText = ''
                DECLARE @myTypeDesc nvarchar(500)
                DECLARE @myType nvarchar(500)
                DECLARE @myName nvarchar(500)
                DECLARE @myCDate datetime
                DECLARE @myMDate datetime
                DECLARE @myObjectID int
                DECLARE @CRLF NVARCHAR(5)                 SET @CRLF = Nchar(13) + NChar(10)
                DECLARE @GO NVARCHAR(20)                  SET @GO = @CRLF + 'GO' + @CRLF + @CRLF
                DECLARE @DUMPFILE NVARCHAR(250) select @DUMPFILE = [DataRoot] + 'DUMP\UpdateScript.sql' from [ARM_CORE]..[A_SiteProperties]
                DECLARE @runDate smalldatetime
                select @runDate = getdate();
                set @theText = 'USE [ARM_CORE] ' + @GO + 'Update [A_SiteProperties] set [LastProfileUpdate] = ''' + cast(@runDate as nvarchar(50)) + '''' + @GO
                -- EXEC [ARM_CORE]..[WriteToFile] @DUMPFILE, @theText
                set @SQLText = @SQLText + @theText
                set @theText = 'SET ANSI_NULLS ON ' + @GO + 'SET QUOTED_IDENTIFIER ON ' + @GO
                -- EXEC [ARM_CORE]..[WriteToFile] @DUMPFILE, @theText
                set @SQLText = @SQLText + @theText
 
 
                -- Cursor for all Objects not yet created in External Profile 
                DECLARE db_create CURSOR FOR 
                                select [CORE_CODE].* from (
                                                select type_desc, type, name,create_date,modify_date, Object_id from sys.procedures 
                                                                UNION
                                                select type_desc, type, name,create_date,modify_date, Object_id from sys.tables 
                                                                UNION
                                                select type_desc, type, name,create_date,modify_date, Object_id from sys.views 
                                                                UNION
                                                select type_desc, type, name,create_date,modify_date, Object_id FROM sys.objects WHERE [type] IN (N'FN', N'IF', N'TF')
                                ) as [CORE_CODE] 
                                LEFT JOIN [sys_ExternProfile] P on [CORE_CODE].[name] = P.[Name] collate Latin1_General_CI_AS_KS_WS  and [CORE_CODE].[type_desc] = P.[TypeDesc] collate Latin1_General_CI_AS_KS_WS
                                where p.[Name] IS NULL
                OPEN db_create  
                FETCH NEXT FROM db_create INTO @myTypeDesc, @myType, @myName, @myCDate, @myMDate, @myObjectID  
 
                WHILE @@FETCH_STATUS = 0  
                BEGIN  
 
                                if @myTypeDesc = 'SQL_STORED_PROCEDURE' or @myTypeDesc = 'SQL_TABLE_VALUED_FUNCTION' or @myTypeDesc = 'VIEW' EXEC [SYS-SQL-StoredProcedure] @myName, 0, @theText OUTPUT
                                else if @myTypeDesc = 'USER_TABLE' EXEC [SYS-SQL-Table] @myName, @theText OUTPUT
                                else set @theText = @CRLF + '-- Something else -- ' + @myTypeDesc + ' [' + @myName + ']' + @CRLF
                                set @theText = @theText + @GO
                                -- EXEC [ARM_CORE]..[WriteToFile] @DUMPFILE, @theText
                                set @SQLText = @SQLText + @theText
                                FETCH NEXT FROM db_create INTO @myTypeDesc, @myType, @myName, @myCDate, @myMDate , @myObjectID   
                END 
 
                CLOSE db_create  
                DEALLOCATE db_create 
 
--             type_desc           type       name    create_date       modify_date      Object_id
-- SQL_STORED_PROCEDURE      P             sp_MScleanupmergepublisher   2016-04-30 00:47:59.790               2016-04-30 00:48:23.277       1819153526
 
 
 
 
                -- Cursor for all Objects not yet created in External Profile 
                DECLARE db_alter CURSOR FOR 
                                select [CORE_CODE].* from (
                                                select type_desc, type, name,create_date,modify_date, Object_id from sys.procedures 
                                                                UNION
                                                select type_desc, type, name,create_date,modify_date, Object_id from sys.tables 
                                                                UNION
                                                select type_desc, type, name,create_date,modify_date, Object_id from sys.views 
                                                                UNION
                                                select type_desc, type, name,create_date,modify_date, Object_id FROM sys.objects WHERE [type] IN (N'FN', N'IF', N'TF')
                                ) as [CORE_CODE] 
                                LEFT JOIN [sys_ExternProfile] P on [CORE_CODE].[name] = P.[Name] collate Latin1_General_CI_AS_KS_WS  and [CORE_CODE].[type_desc] = P.[TypeDesc] collate Latin1_General_CI_AS_KS_WS
                                where NOT p.[Name] IS NULL and [CORE_CODE].[modify_date] > P.[modify_date]
 
                OPEN db_alter  
                FETCH NEXT FROM db_alter INTO @myTypeDesc, @myType, @myName, @myCDate, @myMDate, @myObjectID  
 
                WHILE @@FETCH_STATUS = 0  
                BEGIN  
 
                                if @myTypeDesc = 'SQL_STORED_PROCEDURE' or @myTypeDesc = 'SQL_TABLE_VALUED_FUNCTION' or @myTypeDesc = 'VIEW' EXEC [SYS-SQL-StoredProcedure] @myName, 1, @theText OUTPUT
                                else if @myTypeDesc = 'USER_TABLE' EXEC [SYS-SQL-TableMods] @myName, @theText OUTPUT
                                else set @theText = @CRLF + '-- Something else -- ' + @myTypeDesc + ' [' + @myName + ']' + @CRLF
                                set @theText = @theText + @GO
                                -- EXEC [ARM_CORE]..[WriteToFile] @DUMPFILE, @theText
                                set @SQLText = @SQLText + @theText
                                FETCH NEXT FROM db_alter INTO @myTypeDesc, @myType, @myName, @myCDate, @myMDate , @myObjectID   
                END 
 
                CLOSE db_alter  
                DEALLOCATE db_alter 
 
--             PRINT CAST(@SQLText AS NTEXT)
--             SELECT CAST('<root><![CDATA[' + @SQLText + ']]></root>' AS XML)
 
                DECLARE @CurrentEnd BIGINT; /* track the length of the next substring */
                DECLARE @offset tinyint; /*tracks the amount of offset needed */
                set @SQLText = replace(  replace(@SQLText, char(13) + char(10), char(10))   , char(13), char(10))
                WHILE LEN(@SQLText) > 1
                BEGIN
                                IF CHARINDEX(CHAR(10), @SQLText) between 1 AND 4000
                                BEGIN
                                                   SET @CurrentEnd =  CHARINDEX(char(10), @SQLText) -1
                                                   set @offset = 2
                                END
                                ELSE
                                BEGIN
                                                   SET @CurrentEnd = 4000
                                                                set @offset = 1
                                END   
                                PRINT SUBSTRING(@SQLText, 1, @CurrentEnd) 
                                set @SQLText = SUBSTRING(@SQLText, @CurrentEnd+@offset, LEN(@SQLText))   
                END /*End While loop*/
 
END
GO
CREATE PROCEDURE [dbo].[SYS-GenerateDeltaSQL]
AS  
BEGIN  
 
                DECLARE @theText nvarchar(MAX) set @theText = ''
                DECLARE @myTypeDesc nvarchar(500)
                DECLARE @myType nvarchar(500)
                DECLARE @myName nvarchar(500)
                DECLARE @myCDate datetime
                DECLARE @myMDate datetime
                DECLARE @myObjectID int
                DECLARE @CRLF NVARCHAR(5)                 SET @CRLF = Nchar(13) + NChar(10)
                DECLARE @GO NVARCHAR(20)                  SET @GO = @CRLF + 'GO' + @CRLF + @CRLF
                DECLARE @DUMPFILE NVARCHAR(250) select @DUMPFILE = [DataRoot] + 'DUMP\UpdateScript.sql' from [ARM_CORE]..[A_SiteProperties]
                DECLARE @runDate smalldatetime
                select @runDate = getdate();
                set @theText = 'USE [ARM_CORE] ' + @GO + 'Update [A_SiteProperties] set [LastProfileUpdate] = ''' + cast(@runDate as nvarchar(50)) + '''' + @GO
                EXEC [ARM_CORE]..[WriteToFile] @DUMPFILE, @theText
                set @theText = 'SET ANSI_NULLS ON ' + @GO + 'SET QUOTED_IDENTIFIER ON ' + @GO
                EXEC [ARM_CORE]..[WriteToFile] @DUMPFILE, @theText
 
 
 
                -- Cursor for all Objects not yet created in External Profile 
                DECLARE db_create CURSOR FOR 
                                select [CORE_CODE].* from (
                                                select type_desc, type, name,create_date,modify_date, Object_id from sys.procedures 
                                                                UNION
                                                select type_desc, type, name,create_date,modify_date, Object_id from sys.tables 
                                                                UNION
                                                select type_desc, type, name,create_date,modify_date, Object_id from sys.views 
                                                                UNION
                                                select type_desc, type, name,create_date,modify_date, Object_id FROM sys.objects WHERE [type] IN (N'FN', N'IF', N'TF')
                                ) as [CORE_CODE] 
                                LEFT JOIN [sys_ExternProfile] P on [CORE_CODE].[name] = P.[Name] collate Latin1_General_CI_AS_KS_WS  and [CORE_CODE].[type_desc] = P.[TypeDesc] collate Latin1_General_CI_AS_KS_WS
                                where p.[Name] IS NULL
                OPEN db_create  
                FETCH NEXT FROM db_create INTO @myTypeDesc, @myType, @myName, @myCDate, @myMDate, @myObjectID  
 
                WHILE @@FETCH_STATUS = 0  
                BEGIN  
 
                                if @myTypeDesc = 'SQL_STORED_PROCEDURE' or @myTypeDesc = 'SQL_TABLE_VALUED_FUNCTION' or @myTypeDesc = 'VIEW' EXEC [SYS-SQL-StoredProcedure] @myName, 0, @theText OUTPUT
                                else if @myTypeDesc = 'USER_TABLE' EXEC [SYS-SQL-Table] @myName, @theText OUTPUT
                                else set @theText = @CRLF + '-- Something else -- ' + @myTypeDesc + ' [' + @myName + ']' + @CRLF
                                set @theText = @theText + @GO
                                EXEC [ARM_CORE]..[WriteToFile] @DUMPFILE, @theText
                                FETCH NEXT FROM db_create INTO @myTypeDesc, @myType, @myName, @myCDate, @myMDate , @myObjectID   
                END 
 
                CLOSE db_create  
                DEALLOCATE db_create 
 
--             type_desc           type       name    create_date       modify_date      Object_id
-- SQL_STORED_PROCEDURE      P             sp_MScleanupmergepublisher   2016-04-30 00:47:59.790               2016-04-30 00:48:23.277       1819153526
 
 
 
 
                -- Cursor for all Objects not yet created in External Profile 
                DECLARE db_alter CURSOR FOR 
            select [CORE_CODE].* from (
                                                select type_desc, type, name,create_date,modify_date, Object_id from sys.procedures 
                                                                UNION
                                                select type_desc, type, name,create_date,modify_date, Object_id from sys.tables 
                                                                UNION
                                                select type_desc, type, name,create_date,modify_date, Object_id from sys.views 
                                                                UNION
                                                select type_desc, type, name,create_date,modify_date, Object_id FROM sys.objects WHERE [type] IN (N'FN', N'IF', N'TF')
                                ) as [CORE_CODE] 
                                LEFT JOIN [sys_ExternProfile] P on [CORE_CODE].[name] = P.[Name] collate Latin1_General_CI_AS_KS_WS  and [CORE_CODE].[type_desc] = P.[TypeDesc] collate Latin1_General_CI_AS_KS_WS
                                where NOT p.[Name] IS NULL and [CORE_CODE].[modify_date] > P.[modify_date]
 
                OPEN db_alter  
                FETCH NEXT FROM db_alter INTO @myTypeDesc, @myType, @myName, @myCDate, @myMDate, @myObjectID  
 
                WHILE @@FETCH_STATUS = 0  
                BEGIN  
 
                                if @myTypeDesc = 'SQL_STORED_PROCEDURE' or @myTypeDesc = 'SQL_TABLE_VALUED_FUNCTION' or @myTypeDesc = 'VIEW' EXEC [SYS-SQL-StoredProcedure] @myName, 1, @theText OUTPUT
                                else if @myTypeDesc = 'USER_TABLE' EXEC [SYS-SQL-TableMods] @myName, @theText OUTPUT
                                else set @theText = @CRLF + '-- Something else -- ' + @myTypeDesc + ' [' + @myName + ']' + @CRLF
                                set @theText = @theText + @GO
                                EXEC [ARM_CORE]..[WriteToFile] @DUMPFILE, @theText
                                FETCH NEXT FROM db_alter INTO @myTypeDesc, @myType, @myName, @myCDate, @myMDate , @myObjectID   
                END 
 
                CLOSE db_alter  
                DEALLOCATE db_alter 
 
 
 
END
GO
 
 
 
CREATE PROCEDURE [dbo].[SYS-FileCheck]
AS  
BEGIN 

	DECLARE @FileID int
	DECLARE @filename nvarchar(255)
	DECLARE @folder nvarchar(255)
	DECLARE @Root nvarchar(255) = 'D:\ARMS\arm-wwwroot\'
	DECLARE @FileExists int
	DECLARE @filepath nvarchar(500)

	DECLARE db_file CURSOR FOR 
		SELECT [FileID] ,[Name], [Folder], [FilePath] FROM [ARM_CORE]..[A_File]

    OPEN db_file  
    FETCH NEXT FROM db_file INTO @FileID, @Filename, @folder, @filepath
 
    WHILE @@FETCH_STATUS = 0  
    BEGIN  
		set @filepath = @Root + '' + @filepath 
		set @filepath = replace(@filepath,'/','\')

		EXEC master..xp_fileexist @filepath, @fileExists OUTPUT

		update  [ARM_CORE]..[A_File] set [FileExists] = @fileExists where FileID = @FileID

		FETCH NEXT FROM db_file INTO @FileID, @Filename, @folder , @filepath
    END 
 
    CLOSE db_file  
    DEALLOCATE db_file 

END

EXEC master..xp_fileexist 'C:\Program Files\Microsoft SQL Server\MSSQL10.MSSQLSERVER\test.txt'

GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SYS-DeleteFile]
@dir nvarchar(1000) = '',
@file nvarchar(100) = ''
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.

	-- Requires xp_cmdshell to be enabled (CAUTION)

	-- EXEC sp_configure 'show advanced options', 1;  
	-- GO  
	-- To update the currently configured value for advanced options.  
	-- RECONFIGURE;  
	-- GO  
	-- To enable the feature.  
	-- EXEC sp_configure 'xp_cmdshell', 1;  
	-- GO  
	-- To update the currently configured value for this feature.  
	-- RECONFIGURE;  
	-- GO 

	declare @cmd nvarchar(MAX);

	set @cmd = 'xp_cmdshell ''del "' + @dir + @file + '"''';

	SET NOCOUNT ON;

    -- Insert statements for procedure here
	EXEC (@cmd);
END


GO
Create PROCEDURE [dbo].[SYS-DeleteClass]
	-- Add the parameters for the stored procedure here
	@ClassID int = -999
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;



    Delete from [ARM_CORE]..[A_CollectionItem] where CollectionID in (
		select distinct c.CollectionID from [ARM_CORE]..[A_Collection] c where c.CollectionClassID = @ClassID
	)

	Delete from [ARM_CORE]..[A_Collection] where CollectionClassID = @ClassID

	Delete from [ARM_CORE]..[A_CollectionClass] where CollectionClassID = @ClassID

END


GO

-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SYS-AD-OU-TO-BAREA]
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	DECLARE @myName NVARCHAR(255)

	DECLARE db_create CURSOR FOR 
		select BArea from BArea where Internal = 0 and NOt BArea like '{%' 
		and NOT BArea in ('Japan','United Kingdom','APEL - PILOT 2016','Leiden W10','APEL - Sweep Up WINSHUTTLE','APEL - Sweep Up Mat leave and long term sick','Netherlands','Russia','Ukraine','SPECIAL')

	OPEN db_create  
	FETCH NEXT FROM db_create INTO @myName  
 
    WHILE @@FETCH_STATUS = 0  
    BEGIN  
        EXEC [ARM_CORE]..[NewWorkstream] @myName, 'GPCR19'

        FETCH NEXT FROM db_create INTO @myName   
    END 

	CLOSE db_create  
	DEALLOCATE db_create 
END




GO
CREATE PROCEDURE  [dbo].[SYS_PrimeSlotIDs]
	@myVal int = 0
AS
BEGIN
	
	declare @myDate as date
	declare @endDate as date

	select top 1 @myDate = [Date] from [ARM_CORE]..[ScheduleSlot] order by [Date] Desc

	select @myDate = IsNull(@myDate,DATEADD(day, -7, getdate() )) 
	select @endDate = DATEADD(day, @myVal, @myDate )	

	while @myDate < @endDate 
	BEGIN
		select @myDate = DATEADD(day, 1, @myDate )

		insert into [ARM_CORE]..[ScheduleSlot] (SlotID,[Date],[Month],[Week],[Day],[DayTxt],[Year],[FixedPoint]) values ( DATEPART(week,@myDate)+'-'+DATEPART(dw,@myDate)+'-'+Year(@myDate) , @myDate, Month(@myDate), DATEPART(week,@myDate), DATEPART(dw,@myDate), Left(DATENAME(dw,@myDate),3), Year(@myDate), 0 ) 
		

	END

	select top 1 [Date] from [ARM_CORE]..[ScheduleSlot] order by [Date] Desc

END

GO

-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Status-Lifecycle]
@OrderBy as nvarchar(255) = 'LastAccess], [UserID'
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;


	SELECT distinct r.Name, u.Name as [User Name], u.UserID, u.Auth_User as [USER ID], u.LastAccess, u.Email, cast(1 as int) as Permit 
	INTO #tempPivotTable3
	from [ARM_CORE]..[A_User] u
	LEFT JOIN [ARM_CORE]..[A_Role] r on r.RoleID = u.RoleID 
	where IsNull(u.Granted,0) = 1



	DECLARE @Columns VARCHAR(MAX)

	SELECT @columns = STUFF(( SELECT TOP 100 PERCENT
									'],[' + cast(Name as varchar)
							FROM    [ARM_CORE]..[A_Role] AS t2
							ORDER BY Rank,'],[' + cast(Name as varchar)
							FOR XML PATH('')
						  ), 1, 2, '') + ']'


	DECLARE @query VARCHAR(8000)

	SET @query = '
	SELECT *
	FROM #tempPivotTable3
	PIVOT
	(
	Count(Permit)
	FOR [Name]
	IN (' + @columns + ')
	)
	AS p order by [' + @OrderBy + ']'


	EXECUTE(@query)


	DROP TABLE #tempPivotTable
END


GO



CREATE PROCEDURE [dbo].[SQLTableOrViewToJSON]
@TableName VARCHAR(MAX) = '',
@ExportPath VARCHAR(MAX) = '',
@ExportName VARCHAR(MAX) = ''
AS
BEGIN   --BEGIN OF STORED PROCEDURE

--*******************************************************************

/*

Author: Ahliana Byrd, 20151201

Purpose: To take any table or view, export the data as a JSON file


EXAMPLE: EXEC SQLTableOrViewToJSON 'MyTable', 'C:\WhereIStowMyJSON\'


WARNING: This code will enable xp_cmdshell
WARNING: This code will create 2 tables and leave them so they can be checked later, easier for debugging
WARNING: This code will create a saved stored procedure, SQLTableOrViewToJSON


This creates a string to declare variables, declare a cursor, walk the cursor, and output the resulting strings to a table
The string is then executed, so that the entire procedure is essentially done in a virtual memory space
The string that will be executed is printed in the Messages window, so if something doesn't seem to be working, 
you can scroll down, grab the generated script, and paste it into a new window so you can debug it


Metadata code by: marc_s on StackOverflow, http://stackoverflow.com/questions/2418527/sql-server-query-to-get-the-list-of-columns-in-a-table-along-with-data-types-no

*/

--*******************************************************************

--*******************************************************************

--This code will enable xp_cmdshell
-- To allow advanced options to be changed.

EXEC sp_configure 'show advanced options', 1

-- To update the currently configured value for advanced options.

RECONFIGURE

-- To enable the feature.

EXEC sp_configure 'xp_cmdshell', 1

-- To update the currently configured value for this feature.

RECONFIGURE

--*******************************************************************


--*******************************************************************

--Create the tables we need for SQL bits and output

PRINT 'Beginning creating tables needed for SQL bits and output'

                IF OBJECT_ID (N'dbo.SQLStatementsForJSONOutput', N'U') IS NULL

                                BEGIN

                                                PRINT '<><><><><><><><><><> SQLStatementsForJSONOutput does not exist. It will be created. <><><><><><><><><><>'

                                                CREATE TABLE [dbo].[SQLStatementsForJSONOutput](

                                                                [ID] [int] IDENTITY(1,1) NOT NULL,

                                                                --[StatementOrder] [int] NULL,

                                                                [Descriptor] [nvarchar](50) NULL,

                                                                [StatementString] [nvarchar](max) NULL,

                                                PRIMARY KEY CLUSTERED 

                                                (

                                                                [ID] ASC

                                                )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]

                                                ) ON [PRIMARY]

                                END

                IF OBJECT_ID (N'dbo.StringsForOutput', N'U') IS NULL

                                BEGIN

                                                PRINT '<><><><><><><><><><> StringsForOutput does not exist. It will be created. <><><><><><><><><><>'

                                                CREATE TABLE [dbo].[StringsForOutput](

                                                                ID INT IDENTITY(1,1) PRIMARY KEY,

                                                                [String] [nvarchar](max) NULL

                                                ) ON [PRIMARY]

                                END

PRINT 'Finished creating tables needed for SQL bits and output'

--*******************************************************************













--*******************************************************************

PRINT 'Beginning main transaction'

BEGIN TRANSACTION





                

--*******************************************************************

--Declare variables

                DECLARE @Error INT = 0
                DECLARE @CompletionMessage VARCHAR (256)= 'Completed creating table data to export.'
                DECLARE @Flowerbox VARCHAR (256)= '********************************************************'
                DECLARE @CRLF VARCHAR(20) = char(13) + char(10)

                DECLARE @ColName VARCHAR(50)
                DECLARE @ColType VARCHAR(20)
                DECLARE @ColMaxLen INT
                DECLARE @ColID INT

                DECLARE @Metadata TABLE (ColName VARCHAR(50), ColType VARCHAR(20), ColID INT, ColMaxLen INT, ColPrecision INT, ColScale INT, ColIsNullable BIT, ColPrimaryKey BIT)
                DECLARE @SQLString_Metadata VARCHAR(MAX)
                DECLARE @SQLString_DeclareStatments VARCHAR(MAX)
                DECLARE @SQLString_Table_Cursor VARCHAR(MAX)
                DECLARE @SQLString_Table_Fetch VARCHAR(MAX)
                DECLARE @SQLString_ToExecute VARCHAR(MAX)
                DECLARE @SQLString_Builder VARCHAR(MAX)
                DECLARE @SQLString_Composite VARCHAR(MAX)

                DECLARE @Cursor_Name VARCHAR(20)
                DECLARE @StatementString VARCHAR(MAX)

                DECLARE @IfIsNotNull VARCHAR(MAX)
                DECLARE @StringBuilderClause VARCHAR(MAX) = 'SET @StringToOutput += '
                DECLARE @Begin VARCHAR(20) = 'BEGIN' + @CRLF
                DECLARE @End VARCHAR(20) = 'END' + @CRLF
              
                DECLARE @PostTest TABLE (ID INT, String VARCHAR(MAX))

                PRINT 'Finished declaring variables'

--*******************************************************************





--*******************************************************************

--Set variables   

                PRINT 'Set variables'

                

                SET @Cursor_Name = 'Cur_TableData'

                

                IF UPPER(LEFT(@TableName, 4)) = 'DBO.'

                                BEGIN

                                                SET @TableName = RIGHT(@TableName, LEN(@TableName) - 4)

                                END

                

                IF UPPER(LEFT(@ExportPath, 1)) != '\'

                                BEGIN

                                                SET @ExportPath = @ExportPath + '\'

                                END

                                

                PRINT 'Finished setting variables'

--*******************************************************************





--*******************************************************************

--Pre testing

                PRINT 'Pre testing'

                

--Check for the table to export

                IF COALESCE((OBJECT_ID (N'dbo.' + @TableName, N'U')), (OBJECT_ID (N'dbo.' + @TableName, N'V'))) IS NULL

                                BEGIN

                                                PRINT '<><><><><><><><><><> ' + @TableName + ' does not exist. Nothing to export. <><><><><><><><><><>'

                                                GOTO EmergencyExitHatch

                                END

--*******************************************************************





--*******************************************************************

--If tables exist, truncate them   



--Check for SQLStatementsForJSONOutput, create if not there, truncate

                IF OBJECT_ID (N'dbo.SQLStatementsForJSONOutput', N'U') IS NULL

                                BEGIN

                                                PRINT '<><><><><><><><><><> SQLStatementsForJSONOutput does not exist. It should have been created already. Exiting. <><><><><><><><><><>'

                                                GOTO EmergencyExitHatch

                                END

                ELSE

                                BEGIN

                                                PRINT 'Truncating SQLStatementsForJSONOutput'

                                                TRUNCATE TABLE SQLStatementsForJSONOutput

                                END



--Check for StringsForOutput, truncate

                IF OBJECT_ID (N'dbo.StringsForOutput', N'U') IS NULL

                                BEGIN

                                                PRINT '<><><><><><><><><><> StringsForOutput does not exist. It should have been created already. Exiting. <><><><><><><><><><>'

                                                GOTO EmergencyExitHatch

                                END

                ELSE

                                BEGIN

                                                PRINT 'Truncating StringsForOutput'

                                                TRUNCATE TABLE StringsForOutput

                                END

                                                

--*******************************************************************





--*******************************************************************

--Do yer stuff



--Metadata

                --http://stackoverflow.com/questions/2418527/sql-server-query-to-get-the-list-of-columns-in-a-table-along-with-data-types-no



                INSERT INTO @Metadata

                SELECT 

                                c.name 'Column Name',

                                t.Name 'Data type',

                                c.column_id,

                                c.max_length 'Max Length',

                                c.precision ,

                                c.scale ,

                                c.is_nullable,

                                ISNULL(i.is_primary_key, 0) 'Primary Key'

                FROM    

                                sys.columns c

                INNER JOIN 

                                sys.types t ON c.user_type_id = t.user_type_id

                LEFT OUTER JOIN 

                                sys.index_columns ic ON ic.object_id = c.object_id AND ic.column_id = c.column_id

                LEFT OUTER JOIN 

                                sys.indexes i ON ic.object_id = i.object_id AND ic.index_id = i.index_id

                WHERE

                                c.object_id = OBJECT_ID(@TableName)



                SET @Error += @@ERROR

                PRINT 'Error count = ' + CONVERT(VARCHAR(20), @Error)

                

                SELECT * FROM @Metadata



                SET @SQLString_Table_Cursor = 'DECLARE  ' + @Cursor_Name + '  CURSOR FORWARD_ONLY FOR SELECT '

                SET @SQLString_Table_Fetch = 'FETCH NEXT FROM  ' + @Cursor_Name + '  INTO '

                SET @SQLString_DeclareStatments = 'DECLARE '

                SET @SQLString_Builder = ''

                SET @SQLString_Composite = ''



                

                DECLARE Cur_Metadata CURSOR FOR SELECT ColName, ColType, ColMaxLen, ColID FROM @Metadata



                OPEN Cur_Metadata

                FETCH NEXT FROM Cur_Metadata INTO @ColName, @ColType, @ColMaxLen, @ColID



                WHILE @@FETCH_STATUS = 0

                BEGIN

                                SET @SQLString_DeclareStatments += '@' + @ColName + ' ' + @ColType

                                

                                SET @IfIsNotNull = 'IF ' + '@' + @ColName + ' IS NOT NULL' + @CRLF

                                

                                

                                IF CHARINDEX('CHAR',@ColType) >  0

                                                BEGIN

                                                                IF @ColMaxLen >0

                                                                                BEGIN

                                                                                                SET @SQLString_DeclareStatments += '(' + CONVERT(NVARCHAR(20), @ColMaxLen) + ')'

                                                                                END

                                                                ELSE

                                                                                BEGIN

                                                                                                SET @SQLString_DeclareStatments += '(MAX)'

                                                                                END

                                                                SET @SQLString_Builder = '''"' + @ColName + '": "'' + RTRIM(CONVERT(NVARCHAR(MAX), @' + @ColName + ')) + ''",''' + @CRLF

                                                                SET @SQLString_Composite += @IfIsNotNull + @Begin + @StringBuilderClause+ @SQLString_Builder + @End + @CRLF

                                                END



                                IF CHARINDEX('DATE',@ColType) >  0

                                                BEGIN

                                                                SET @SQLString_Builder = '''"' + @ColName + '": "'' + RTRIM(CONVERT(NVARCHAR(MAX), @' + @ColName + ')) + ''",''' + @CRLF

                                                                SET @SQLString_Composite += @IfIsNotNull + @Begin + @StringBuilderClause+ @SQLString_Builder + @End + @CRLF

                                                END

                                                

                                IF CHARINDEX('INT',@ColType) >  0

                                                BEGIN

                                                                SET @SQLString_Builder = '''"' + @ColName + '": '' + RTRIM(CONVERT(NVARCHAR(MAX), @' + @ColName + ')) + '',''' + @CRLF

                                                                SET @SQLString_Composite += @IfIsNotNull + @Begin + @StringBuilderClause+ @SQLString_Builder + @End + @CRLF

                                                END



                                IF CHARINDEX('NUMERIC',@ColType) >  0

                                                BEGIN

                                                                SET @SQLString_Builder = '''"' + @ColName + '": '' + RTRIM(CONVERT(NVARCHAR(MAX), @' + @ColName + ')) + '',''' + @CRLF

                                                                SET @SQLString_Composite += @IfIsNotNull + @Begin + @StringBuilderClause+ @SQLString_Builder + @End + @CRLF

                                                END



                                IF CHARINDEX('BIT',@ColType) >  0

                                                BEGIN

                                                                SET @SQLString_Builder = '''"' + @ColName + '": '' + '

                                                                SET @SQLString_Builder += 'CASE WHEN @' + @ColName + ' = 1 THEN ''true'' ELSE ''false'' END + '',''' + @CRLF

                                                                SET @SQLString_Composite += @IfIsNotNull + @Begin + @StringBuilderClause+ @SQLString_Builder + @End + @CRLF

                                                END



                                                

                                SET @SQLString_DeclareStatments += ', '

                                

                                SET @SQLString_Table_Cursor += @ColName + ', '

                                

                                SET @SQLString_Table_Fetch += '@' + @ColName + ', '



                                FETCH NEXT FROM Cur_Metadata INTO @ColName, @ColType, @ColMaxLen, @ColID

                END



                CLOSE Cur_Metadata

                DEALLOCATE Cur_Metadata

                

                --Remove trailing space

                                SET @SQLString_DeclareStatments = SUBSTRING(@SQLString_DeclareStatments,1, DATALENGTH(@SQLString_DeclareStatments)-2)

                

                --Remove the trailing comma and space

                                SET @SQLString_Table_Cursor = SUBSTRING(@SQLString_Table_Cursor,1, DATALENGTH(@SQLString_Table_Cursor)-2)

                                SET @SQLString_Table_Fetch = SUBSTRING(@SQLString_Table_Fetch,1, DATALENGTH(@SQLString_Table_Fetch)-2)

                



                --Add the tablename                      

                                SET @SQLString_Table_Cursor += ' FROM ' + @TableName





                --Build the executable pieces in a table, easier to debug that way

                                INSERT INTO SQLStatementsForJSONOutput (Descriptor, StatementString)

                                VALUES ('Declare String To Output', 'DECLARE @StringToOutput NVARCHAR(MAX)')



                                INSERT INTO SQLStatementsForJSONOutput (Descriptor, StatementString)

                                VALUES ('Declare BitValue', 'DECLARE @BitValue BIT')

                                

                                INSERT INTO SQLStatementsForJSONOutput (Descriptor, StatementString)

                                VALUES ('Truncate Output Table', 'TRUNCATE TABLE StringsForOutput')

                                

                                INSERT INTO SQLStatementsForJSONOutput (Descriptor, StatementString)

                                VALUES ('Declare Statements', @SQLString_DeclareStatments + @CRLF)



                                INSERT INTO SQLStatementsForJSONOutput (Descriptor, StatementString)

                                VALUES ('Insert Opening Bracket', 'INSERT INTO StringsForOutput VALUES (''['')' + @CRLF)



                                INSERT INTO SQLStatementsForJSONOutput (Descriptor, StatementString)

                                VALUES ('Table Cursor', @SQLString_Table_Cursor)



                                INSERT INTO SQLStatementsForJSONOutput (Descriptor, StatementString)

                                VALUES ('Open Cursor', 'OPEN  ' + @Cursor_Name)



                                INSERT INTO SQLStatementsForJSONOutput (Descriptor, StatementString)

                                VALUES ('Table Fetch', @SQLString_Table_Fetch + @CRLF)



                                INSERT INTO SQLStatementsForJSONOutput (Descriptor, StatementString)

                                VALUES ('While Fetch', 'WHILE @@FETCH_STATUS = 0')



                                INSERT INTO SQLStatementsForJSONOutput (Descriptor, StatementString)

                                VALUES ('BEGIN', 'BEGIN')



                                INSERT INTO SQLStatementsForJSONOutput (Descriptor, StatementString)

                                VALUES ('Open Object', 'SET @StringToOutput = ''{''' + @CRLF)



                                INSERT INTO SQLStatementsForJSONOutput (Descriptor, StatementString)

                                VALUES ('Build Object', @SQLString_Composite)



                                INSERT INTO SQLStatementsForJSONOutput (Descriptor, StatementString)

                                VALUES ('Remove Trailing Comma', 'SET @StringToOutput = SUBSTRING(@StringToOutput,1, LEN(@StringToOutput)-1)')



                                INSERT INTO SQLStatementsForJSONOutput (Descriptor, StatementString)

                                VALUES ('Close Object', 'SET @StringToOutput += ''},''')



                                INSERT INTO SQLStatementsForJSONOutput (Descriptor, StatementString)

                                VALUES ('Table Fetch', @SQLString_Table_Fetch)



                                --If this is the last record, strip off the trailing comma for the export

                                                INSERT INTO SQLStatementsForJSONOutput (Descriptor, StatementString)

                                                VALUES ('Strip very last comma for export, Part 1', 'IF @@FETCH_STATUS != 0' + @CRLF)



                                                INSERT INTO SQLStatementsForJSONOutput (Descriptor, StatementString)

                                                VALUES ('Strip very last comma for export, Part 2', @Begin)



                                                INSERT INTO SQLStatementsForJSONOutput (Descriptor, StatementString)

                                                VALUES ('Strip very last comma for export, Part 3', 'SET @StringToOutput = SUBSTRING(@StringToOutput,1, LEN(@StringToOutput)-1)' + @CRLF)



                                                INSERT INTO SQLStatementsForJSONOutput (Descriptor, StatementString)

                                                VALUES ('Strip very last comma for export, Part 4', @End)



                                INSERT INTO SQLStatementsForJSONOutput (Descriptor, StatementString)

                                VALUES ('Insert Object', 'INSERT INTO StringsForOutput VALUES (@StringToOutput)')



                                INSERT INTO SQLStatementsForJSONOutput (Descriptor, StatementString)

                                VALUES ('END', 'END')



                                INSERT INTO SQLStatementsForJSONOutput (Descriptor, StatementString)

                                VALUES ('CLOSE', 'CLOSE  ' + @Cursor_Name + ' ')



                                INSERT INTO SQLStatementsForJSONOutput (Descriptor, StatementString)

                                VALUES ('DEALLOCATE', 'DEALLOCATE  ' + @Cursor_Name + ' ')



                                INSERT INTO SQLStatementsForJSONOutput (Descriptor, StatementString)

                                VALUES ('Insert Closing Bracket', 'INSERT INTO StringsForOutput VALUES ('']'')')





                                PRINT 'Finished inserting statements into SQLStatementsForJSONOutput'

                                



--Get the statement pieces out of the table, assemble, execute

                PRINT 'Get the statement pieces out of the table, assemble, execute'

                

                SET @SQLString_ToExecute = ''

                DECLARE Cur_SQLStrings CURSOR FORWARD_ONLY STATIC FOR SELECT StatementString FROM SQLStatementsForJSONOutput ORDER BY ID

                OPEN Cur_SQLStrings

                FETCH NEXT FROM Cur_SQLStrings INTO @StatementString



                PRINT 'Building string'

                WHILE @@FETCH_STATUS = 0

                BEGIN

                SET @SQLString_ToExecute += @StatementString + @CRLF

                FETCH NEXT FROM Cur_SQLStrings INTO @StatementString

                END

                CLOSE Cur_SQLStrings

                DEALLOCATE Cur_SQLStrings



                PRINT 'Finished building string'

                PRINT ''

                PRINT ''



                PRINT @Flowerbox

                PRINT @SQLString_ToExecute

                PRINT @Flowerbox

                

                PRINT ''

                PRINT ''

                PRINT 'Executing string'

                

                EXEC(@SQLString_ToExecute) 



--*******************************************************************





--*******************************************************************

--Post testing

                PRINT 'POST Testing'

                INSERT INTO @PostTest

                SELECT ID, String

                FROM StringsForOutput

                

                IF NOT EXISTS(

                                SELECT * FROM @PostTest

                                )

                                BEGIN

                                                SELECT * FROM @PostTest

                                                

                                                SET @Error += 1

                                                PRINT 'Post testing shows errors. PLEASE CHECK.'

                                END

                PRINT 'Finished POST testing.'

--*******************************************************************





--*******************************************************************

--This is the label for just bailing out of the procedure, used above if we know we're done and need to just leave

EmergencyExitHatch:

--*******************************************************************



--*******************************************************************

--Housecleaning

--*******************************************************************





IF @Error > 0 

                BEGIN

                                ROLLBACK

                                PRINT '/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\'

                                PRINT '\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/'

                                PRINT 'Error count = ' + CONVERT(VARCHAR(20), @Error)

                                PRINT 'ROLLING BACK TRANSACTION'

                END

ELSE 

                BEGIN

                                COMMIT TRANSACTION 

                                PRINT @Flowerbox

                                PRINT @Flowerbox

                                PRINT 'Completed - ' + @CompletionMessage

                END















--*******************************************************************

--The export has to be outside of the main transaction



DECLARE @DateTime VARCHAR(MAX) = (SELECT CONVERT(VARCHAR(20),GETDATE(),112) + '_' + LEFT(REPLACE(CONVERT(VARCHAR,GETDATE(),114),':',''),6))

DECLARE @ExportFileName VARCHAR(MAX)

DECLARE @DatabaseName VARCHAR(MAX) = (SELECT DB_NAME() AS DataBaseName)



IF @ExportName = ''

                BEGIN

                                SET @ExportFileName = @ExportPath + @TableName + '_' + @DateTime + '.json'

                END

ELSE

                BEGIN

                                SET @ExportFileName = @ExportPath + @ExportName

                END

--*******************************************************************

--Check for the table to export

                IF COALESCE((OBJECT_ID (N'dbo.' + @TableName, N'U')), (OBJECT_ID (N'dbo.' + @TableName, N'V'))) IS NULL

                                BEGIN

                                                PRINT '<><><><><><><><><><> ' + @TableName + ' does not exist. Nothing to export. <><><><><><><><><><>'

                                END

                ELSE

                                BEGIN

                                                --Use BCP to export the table

                                                --If you don't ORDER BY ID, the closing bracket will end up in the middle, SQL oddity in the INSERT INTO statement

                                                PRINT 'Starting export.'

                                                DECLARE @cmd varchar(1000)

                                                SET @cmd = 'bcp "SELECT String FROM ' + @DatabaseName + '..StringsForOutput ORDER BY ID" queryout ' + @ExportFileName + ' -c -t, -UTF8 -T -S ' + @@servername

                                                PRINT @cmd

                                                EXEC master..xp_cmdshell @cmd

                                                PRINT 'Finished export.'

                                END

--*******************************************************************





END       --END OF STORED PROCEDURE

GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SPOC-Apps-RELEASE-BArea]
	@base nvarchar(255) = '%',
	@top int = 7,
	@type nvarchar(255) = '',
	@mode int = 0,
	@userID nvarchar(255) = '',
	@site nvarchar(250) = ''
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	DECLARE @sample NVARCHAR(MAX)
	DECLARE @DeployFlag int = 0
	DECLARE @DeployedSQL NVARCHAR(3000) = ''

	DECLARE @OrderBy NVARCHAR(250) 
	DECLARE @Focus NVARCHAR(250) 

	set @Focus = ''

	if @mode = 0 or @mode > 3
		set @OrderBy = ' order by p.[Installs] desc, p.[release] desc '

	if @mode = 1 
		set @OrderBy = ' order by p.[release] desc, p.[Installs] desc '

	if @mode = 2
		set @OrderBy = ' order by p.[Impact (%)], p.[release] desc '

	if @mode = 3 
	BEGIN
		set @OrderBy = ' order by p.[Installs] desc, p.[release] desc '
		set @Focus = ' where  p.[Area Most Installs] like ''' + @base + ''' '
	END

	IF OBJECT_ID('tempdb..#tempReleaseTable') IS NOT NULL
		DROP TABLE #tempReleaseTable;


	CREATE TABLE #tempReleaseTable(
		[App ID] [nvarchar](255) NULL,
		[Status] [nvarchar](255) NULL,
		[Type] [nvarchar](255) NULL,
		[Installs] [int] NULL
	) ON [PRIMARY]

	CREATE TABLE #tempReleaseTable2(
		[App ID] [nvarchar](255) NULL,
		[Status] [nvarchar](255) NULL,
		[Type] [nvarchar](255) NULL,
		[App Owner] [nvarchar](255) NULL,
		[Most Installs] [nvarchar](255) NULL,
		[Installs] [int] NULL,
		[Release] [int] NULL,
		[Impact] [int] NULL
	) ON [PRIMARY]



	if NOT @type = '' 
		set @type = ' and [Type] = ''' + @type + ''' '

	select @DeployFlag = BitPosition  FROM [ARM_CORE]..[A_BitCondition] where Attribute = 'Deployed' and GroupName = 'Deployment'

	if NOT @DeployFlag = 0  
		set @DeployedSQL = ' and dbo.[CheckBitStatus](t.BitStatus,''Deployment'',''Deployed'')=0 '


	set @sample = '
	INSERT INTO #tempReleaseTable ([App ID], [Status], [Type], [Installs])
	select distinct  top 100 b.ApplicationID as [App ID]
	, (SELECT top 1 c.Name from [ARM_CORE]..[A_Collection] c LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc on cc.CollectionClassID = c.CollectionClassID LEFT JOIN [ARM_CORE]..[A_CollectionItem] i on i.CollectionID = c.CollectionID where i.ItemID = a.ApplicationID and cc.CLASSREF = ''ApplicationReadiness'' ) as [Status] 
	, a.DeployType
	, CUT_IC.IC as [Installs] 
	from  [ARM_CORE]..[Asset] t 	
	LEFT JOIN [ARM_CORE]..[AppAstToBe] b on b.AssetID = t.AssetID
	LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = b.ApplicationID 
	LEFT JOIN [ARM_CORE]..[GoFish] f on f.ApplicationID = b.ApplicationID
	LEFT JOIN ( 

		SELECT z.ApplicationID, count(distinct z.AssetID) as IC from [ARM_CORE]..[AppAstToBe] z 
		LEFT JOIN [ARM_CORE]..[Asset] y on y.AssetID = z.AssetID 
		where y.[BArea] like  ''' + @base + ''' and y.Live = 1 ' + @type  + ' group by z.ApplicationID 

	) AS CUT_IC on CUT_IC.ApplicationID = b.ApplicationID 
	where NOT b.[ApplicationID] IS NULL  and IsNull(a.DeployType,''-'') <> ''B'' and IsNull(a.DeployType,''-'') <> ''X'' and IsNull(a.Ready,0) = 0 and IsNull(a.Exclude,0) = 0 
		and t.[BArea] like ''' + @base + ''' and t.Live = 1 ' + @type + @DeployedSQL + ' and (f.GoFishID IS NULL or f.Logged = 0)
	order by [Installs] Desc, [App ID]
	'

	EXECUTE(@sample)

	set @sample = '
	INSERT INTO #tempReleaseTable2 (	
		[App ID] 
		,[Status]
		,[Type]
		,[App Owner]
		,[Most Installs]
		,[Installs]
		,[Release]
		,[Impact]
	)
	select top ' + cast(@top as nvarchar(12) ) + ' * from (
	select z.[App ID], z.[Status], z.[Type], g.ApplicationOwner, dbo.[BAreaWithMostInstalls](z.[App ID]) as [Area Most Installs], z.Installs, z.release, 100 * z.Installs / h.[Count] as [Impact (%)] from (
		select r.*,
		(
			select count(*) from (
				select b.AssetID, count(b.ApplicationID) AppsNotReady from [ARM_CORE]..[AppAstToBe] b
				LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = b.ApplicationID
				LEFT JOIN [ARM_CORE]..[Asset] t on t.AssetID = b.AssetID
				where IsNull(a.DeployType,''-'') <> ''B'' and IsNull(a.DeployType,''-'') <> ''X'' and IsNull(a.Ready,0) = 0 and IsNull(a.Exclude,0) = 0 
					and t.[BArea] like  ''' + @base + '''  and t.Live = 1 ' + @type + @DeployedSQL + ' 
				group by b.AssetID 
			) q LEFT JOIN (
				select x.AssetID from [ARM_CORE]..[AppAstToBe] x where x.ApplicationID = r.[App ID]
			) s on s.AssetID = q.AssetID 
			where q.AppsNotReady = 1 and NOT s.AssetID IS NULL 
		) as Release 
		from #tempReleaseTable r )  z 
		LEFT JOIN [ARM_CORE]..[s_ApplicationToBeInstallCount] h on h.ApplicationID = z.[App ID] 
		LEFT JOIN [ARM_CORE]..[Application] a2 on a2.[ApplicationID] = z.[App ID]
		LEFT JOIN [ARM_CORE]..[AppGroup] g on g.AppGroupID = a2.AppGroupID 
	) p ' + @Focus + @OrderBy


	EXECUTE(@sample)

	merge #tempReleaseTable2 as TARGET
	using (
			select * from [GoFish] where [Site] = @Site and UserID = @UserID
	) as SOURCE
	ON TARGET.[App ID] = SOURCE.ApplicationID 
	WHEN MATCHED THEN
		delete;



	merge [ARM_CORE]..[GoFish] as TARGET
	using (
			select * from #tempReleaseTable2
	) as SOURCE
	ON TARGET.ApplicationID = SOURCE.[App ID] and TARGET.UserID = @UserID
	WHEN NOT MATCHED BY TARGET THEN
		insert ([UserID]
      ,[Site]
      ,[ApplicationID]
      ,[DeployType]
      ,[Owner]
      ,[OwnerEmail]
      ,[Info])
	  values (@UserID, @Site, SOURCE.[App ID], SOURCE.[Type], SOURCE.[App Owner], '', '');

	select * from #tempReleaseTable2

	DROP TABLE #tempReleaseTable
	DROP TABLE #tempReleaseTable2

END




GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[ShowDirectReport] 
	-- Add the parameters for the stored procedure here
	@ManagerID nvarchar(255) = ''
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
select R.* from (
	SELECT u.[UserID], u.[Username], u.[Email], u.[FirstName], c.Deployed, 

	case 
		when c.CollectionID IN ( 40, 51, 55, 52, 41 ) THEN 'Not Started - Please Prompt'
		when c.CollectionID IN ( 42, 43, 44, 45 ) and  DateDiff(day,i.[TaggedOn],GETDATE()) > 14 THEN c.Name + ' Update Required - Please Prompt '
		when c.[Deployed] = 1 THEN 'Complete - No Action required'
		else c.Name
	end AS Status,

	i.[TaggedOn] as [Last Updated], DateDiff(day,i.[TaggedOn],GETDATE()) as [Days Since], @ManagerID as [Manager],

	(
		select Count(w.UserID) from [ARM_CORE]..[User] w 
		LEFT JOIN [ARM_CORE]..[A_CollectionItem] i on i.ItemID = w.userID 
		LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionID = i.CollectionID
		where NOT i.ItemID IS NULL and ISNULL(w.Directmanager,'') = u.[UserID] and c.CollectionClassID = 10
	) as [Total],
	(
		select Sum(cast(c.Deployed as int)) from [ARM_CORE]..[User] w 
		LEFT JOIN [ARM_CORE]..[A_CollectionItem] i on i.ItemID = w.userID 
		LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionID = i.CollectionID
		where NOT i.ItemID IS NULL and ISNULL(w.Directmanager,'') = u.[UserID] and c.CollectionClassID = 10
	) as [Done],
	(
		select Sum(case when c.CollectionID IN ( 40, 51, 55, 52, 41 ) THEN 1 else 0 end) from [ARM_CORE]..[User] w 
		LEFT JOIN [ARM_CORE]..[A_CollectionItem] i on i.ItemID = w.userID 
		LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionID = i.CollectionID
		where NOT i.ItemID IS NULL and ISNULL(w.Directmanager,'') = u.[UserID] and c.CollectionClassID = 10
	) as [NotStarted]


	from [ARM_CORE]..[User] u LEFT JOIN [ARM_CORE]..[A_CollectionItem] i on i.ItemID = u.userID LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionID = i.CollectionID 
	where IsNULL(u.[Email],'') <> ''  and c.CollectionClassID = 10 and ISNULL(u.[DirectManager],'') = @ManagerID
) R
	Order by  R.Deployed, R.[Days Since] desc, R.[USERNAME]
END

GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[ShiftSlot]
    @FromDate Date = NULL,
    @ToDate Date = NULL
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	select TOP 1 s.[Date],s.[SlotID]
	from [ARM_CORE]..[ScheduleSlot] s 
	where 
		s.[Date] >= convert(date,COALESCE( @FromDate, ISNULL(@FromDate, GETDATE()+1))) 
		and s.[Date] < convert(date,COALESCE( @ToDate, ISNULL(@ToDate, GETDATE()+365))) 
		and s.[FixedPoint] = 0  
	ORDER BY s.[Date] Asc
END






GO
-- =============================================
-- Author:             <Author,,Name>
-- Create date: <Create Date,,>
-- Description:        <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SGB_Lookup]
@searchTerm nvarchar(500) = ''
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
        SET NOCOUNT ON;
/****** Script for SelectTopNRows command from SSMS  ******/
 
SELECT 'Catalog' as [Class], c.[Application], IsNull(c.[Vendor],'') as [Vendor], 
        IsNull(c.[Version],'') as [Version], IsNull(c.Category,'') as [Category], IsNull(c.[Active],'') as [Active], '' as Workstream, '' as Licenced  
        from [ARM_CORE].[dbo].[Catalog] c where c.[Application] like N'%'+@searchTerm+'%' or c.[Category] like N'%'+@searchTerm+'%'
UNION
SELECT 'Manual' as [Class], m.AppName as [Application], IsNull(m.[manufacturer],'') as [Vendor], IsNull(m.[Deploy_Version],'') as [Version], '' as Category, '' as [Active], 
        IsNull(m.[Workstream],'') as [Workstream], IsNull(m.[Licenced],'') as [Licenced] FROM [ARM_CORE]..[AppsManualInstall] m where  m.[AppName] like N'%'+@searchTerm+'%'
Order by [Class], [Application]
 
 
 
END
 

GO
-- =============================================
-- Author:		John Reed
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SetTransformOverride]
	@Table as Varchar(255) = '',
	@Action as Varchar(255) = '',
	@SourceColumn as Varchar(255) = '',
	@SourceValue as Varchar(255) = '',
	@TargetColumn as Varchar(255) = '',
	@TargetValue as Varchar(255) = '',
	@Author as Varchar(255) = 'Admin'
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	SET DATEFORMAT dmy;

	if NOT @Table = '' and NOT @Action = ''

		MERGE [ARM_CORE].[dbo].[TransformTransaction] AS Target
			USING (select @Table as [Table], @Action as [Action], @SourceColumn as [SourceColumn], @SourceValue as [SourceValue], 
				@TargetColumn as [TargetColumn], @TargetValue as [TargetValue], @Author as [Author] ) AS Source
			ON (Target.[Table] = Source.[Table] and Target.[SourceColumn] = Source.[SourceColumn] and 
				Target.[TargetColumn] = Source.[TargetColumn] and Target.[AsIs] = Source.[SourceValue])
			WHEN NOT MATCHED THEN
			   INSERT ([TransformID],[Table],[Action],[SourceColumn],[TargetColumn],[AsIs],[ToBe],[Author],[TimeStamp])
			   VALUES (0, Source.[Table], Source.[Action], Source.[SourceColumn], Source.[TargetColumn], Source.[SourceValue], Source.[TargetValue], source.[Author], getdate())
			WHEN MATCHED THEN
			   UPDATE SET target.[Action] = source.[Action], target.[Author] = source.[Author], target.[Timestamp] = getdate(), target.[ToBe] = Source.[TargetValue];


END




GO
-- =============================================
-- Author:             <Author,,Name>
-- Create date: <Create Date,,>
-- Description:        <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SetTombstone]
        @AssetID nvarchar(255) = '',
        @Step int = 0
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
        SET NOCOUNT ON;
--      BEGIN TRAN;
        DECLARE @TombstoneClassID INT;
        DECLARE @CollectionID INT;
        DECLARE @query nvarchar(max);
        set @Step = @Step + 1
        if @AssetID <> ''
        BEGIN
               SET @TombstoneClassID = (SELECT top 1 p.Tombstone FROM [A_SiteProperties] p )     
               
               SET @CollectionID = (select  items.CollectionID from (select c.CollectionID, Row_Number() OVER(PARTITION BY '1' order by [CollectionClassID],[Order]) as nr from [ARM_CORE]..[A_Collection] c where c.CollectionClassID = @TombstoneClassID) as items where items.nr = @Step)             
               if IsNull(@CollectionID,0) <> 0 
               BEGIN
                       Set @query = 'EXEC [ARM_CORE]..[Collection-AddAsset-FromList] ' + convert(nvarchar(255),@CollectionID) + ', ''''''' + @AssetID + ''''''', 1 '
                       EXECUTE (@query)       
               END     
        END            
--      OUTPUT $action, inserted.*, deleted.*;
--      ROLLBACK TRAN;
END
 
 

GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SetStatusUnTargettedbyList]
	@WorkstreamID int,
	@AssetList nvarchar(max)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
--	BEGIN TRAN;

	DECLARE @TARGET_ID INT;
	DECLARE @CONFIRM_ID INT;
	DECLARE @SCHED_ID INT;
	DECLARE @DEPLOYED_ID INT;
	DECLARE @DEF_ID INT;


	DECLARE @query nvarchar(max)

	if @WorkstreamID > 0 
	BEGIN
		SET @TARGET_ID = (SELECT w.TargettedID FROM [Workstream] w WHERE w.WorkstreamID = @WorkstreamID)
		SET @CONFIRM_ID = (SELECT w.ConfirmedID FROM [Workstream] w WHERE w.WorkstreamID = @WorkstreamID)
		SET @SCHED_ID = (SELECT w.ScheduledID FROM [Workstream] w WHERE w.WorkstreamID = @WorkstreamID)
		SET @DEPLOYED_ID = (SELECT w.DeployedID FROM [Workstream] w WHERE w.WorkstreamID = @WorkstreamID)
		SET @DEF_ID = (SELECT w.DeferredID FROM [Workstream] w WHERE w.WorkstreamID = @WorkstreamID)

		Set @query = '
		DELETE FROM [ARM_CORE]..[A_CollectionItem] where ItemID in (' + @AssetList + ') and CollectionID = ' + convert(nvarchar(255),@TARGET_ID) + ';
		'
		EXECUTE(@query)		
	END
END




GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SetStatusTargettedbyList]
	@WorkstreamID int,
	@AssetList nvarchar(max)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
--	BEGIN TRAN;

	DECLARE @TARGET_ID INT;
	DECLARE @CONFIRM_ID INT;
	DECLARE @SCHED_ID INT;
	DECLARE @DEPLOYED_ID INT;
	DECLARE @DEF_ID INT;


	DECLARE @query nvarchar(max)

	if @WorkstreamID > 0 
	BEGIN
		SET @TARGET_ID = (SELECT w.TargettedID FROM [Workstream] w WHERE w.WorkstreamID = @WorkstreamID)
		SET @CONFIRM_ID = (SELECT w.ConfirmedID FROM [Workstream] w WHERE w.WorkstreamID = @WorkstreamID)
		SET @SCHED_ID = (SELECT w.ScheduledID FROM [Workstream] w WHERE w.WorkstreamID = @WorkstreamID)
		SET @DEPLOYED_ID = (SELECT w.DeployedID FROM [Workstream] w WHERE w.WorkstreamID = @WorkstreamID)
		SET @DEF_ID = (SELECT w.DeferredID FROM [Workstream] w WHERE w.WorkstreamID = @WorkstreamID)


		Set @query = '
		MERGE [ARM_CORE]..[A_CollectionItem] AS Target
		USING (SELECT AssetID, ' + convert(nvarchar(255),@TARGET_ID) + ' as CollectionID from [ARM_CORE]..[Asset] where AssetID in  (' + @AssetList + ')) As Source
		ON (Target.ItemID = Source.AssetID and Target.CollectionID = Source.CollectionID )
		WHEN NOT MATCHED BY TARGET THEN
			INSERT ([ItemID],[CollectionID]) 
			VALUES (Source.AssetID, Source.CollectionID);	'

		EXECUTE(@query)			

--		DELETE FROM [ARM_CORE]..[A_CollectionItem] where ItemID in (' + @AssetList + ') and CollectionID = @TARGET_ID

		Set @query = '
		DELETE FROM [ARM_CORE]..[A_CollectionItem] where ItemID in (' + @AssetList + ') and CollectionID = ' + convert(nvarchar(255),@CONFIRM_ID) + ';
		DELETE FROM [ARM_CORE]..[A_CollectionItem] where ItemID in (' + @AssetList + ') and CollectionID = ' + convert(nvarchar(255),@SCHED_ID) + ';
		DELETE FROM [ARM_CORE]..[A_CollectionItem] where ItemID in (' + @AssetList + ') and CollectionID = ' + convert(nvarchar(255),@DEPLOYED_ID) + ';
		DELETE FROM [ARM_CORE]..[A_CollectionItem] where ItemID in (' + @AssetList + ') and CollectionID = ' + convert(nvarchar(255),@DEF_ID) + ';
		'
		EXECUTE(@query)		
	END
END




GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SetStatusTargetted]
	@WorkstreamID int,
	@AssetID nvarchar(255),
	@who nvarchar(500) = 'System'
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
--	BEGIN TRAN;

	DECLARE @CollectionID INT;
	DECLARE @query nvarchar(max);

	if @WorkstreamID > 0 
	BEGIN
		SET @CollectionID = (SELECT w.TargettedID FROM [Workstream] w WHERE w.WorkstreamID = @WorkstreamID)			

		Set @query = 'EXEC [ARM_CORE]..[Collection-AddAsset-FromList] ' + convert(nvarchar(255),@CollectionID) + ', ''''''' + @AssetID + ''''''', 1,''' + @who + ''' '

		EXECUTE (@query)	
			
	END
END




GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SetStatusScheduled-NEW]
	@WorkstreamID int,
	@AssetID nvarchar(255)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
--	BEGIN TRAN;

	DECLARE @CollectionID INT;
	DECLARE @query nvarchar(max);

	if @WorkstreamID > 0 
	BEGIN
		SET @CollectionID = (SELECT w.ScheduledID FROM [Workstream] w WHERE w.WorkstreamID = @WorkstreamID)			

		Set @query = 'EXEC [ARM_CORE]..[Collection-AddAsset-FromList] ' + convert(nvarchar(255),@CollectionID) + ', ''''''' + @AssetID + ''''''', 1 '

		EXECUTE (@query)	
--		Select @query
			
	END
END




GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SetStatusScheduledbyList]
	@WorkstreamID int,
	@AssetList nvarchar(max)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
--	BEGIN TRAN;

	DECLARE @TARGET_ID INT;
	DECLARE @CONFIRM_ID INT;
	DECLARE @SCHED_ID INT;
	DECLARE @DEPLOYED_ID INT;
	DECLARE @DEF_ID INT;


	DECLARE @query nvarchar(max)

	if @WorkstreamID > 0 
	BEGIN
		SET @TARGET_ID = (SELECT w.TargettedID FROM [Workstream] w WHERE w.WorkstreamID = @WorkstreamID)
		SET @CONFIRM_ID = (SELECT w.ConfirmedID FROM [Workstream] w WHERE w.WorkstreamID = @WorkstreamID)
		SET @SCHED_ID = (SELECT w.ScheduledID FROM [Workstream] w WHERE w.WorkstreamID = @WorkstreamID)
		SET @DEPLOYED_ID = (SELECT w.DeployedID FROM [Workstream] w WHERE w.WorkstreamID = @WorkstreamID)
		SET @DEF_ID = (SELECT w.DeferredID FROM [Workstream] w WHERE w.WorkstreamID = @WorkstreamID)


		Set @query = '
		MERGE [ARM_CORE]..[A_CollectionItem] AS Target
		USING (SELECT AssetID, ' + convert(nvarchar(255),@SCHED_ID) + ' as CollectionID from [ARM_CORE]..[Asset] where AssetID in  (' + @AssetList + ')) As Source
		ON (Target.ItemID = Source.AssetID and Target.CollectionID = Source.CollectionID )
		WHEN NOT MATCHED BY TARGET THEN
			INSERT ([ItemID],[CollectionID]) 
			VALUES (Source.AssetID, Source.CollectionID);	'

		EXECUTE(@query)			

--		DELETE FROM [ARM_CORE]..[A_CollectionItem] where ItemID in (' + @AssetList + ') and CollectionID = @TARGET_ID

		Set @query = '
		DELETE FROM [ARM_CORE]..[A_CollectionItem] where ItemID in (' + @AssetList + ') and CollectionID = ' + convert(nvarchar(255),@CONFIRM_ID) + ';
		DELETE FROM [ARM_CORE]..[A_CollectionItem] where ItemID in (' + @AssetList + ') and CollectionID = ' + convert(nvarchar(255),@TARGET_ID) + ';
		DELETE FROM [ARM_CORE]..[A_CollectionItem] where ItemID in (' + @AssetList + ') and CollectionID = ' + convert(nvarchar(255),@DEPLOYED_ID) + ';
		DELETE FROM [ARM_CORE]..[A_CollectionItem] where ItemID in (' + @AssetList + ') and CollectionID = ' + convert(nvarchar(255),@DEF_ID) + ';
		'
		EXECUTE(@query)		
	END
END




GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SetStatusScheduled]
	@WorkstreamID int,
	@AssetID nvarchar(255),
	@who nvarchar(500) = 'System'
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
--	BEGIN TRAN;

	DECLARE @CollectionID INT;
	DECLARE @query nvarchar(max);

	if @WorkstreamID > 0 
	BEGIN
		SET @CollectionID = (SELECT w.ScheduledID FROM [Workstream] w WHERE w.WorkstreamID = @WorkstreamID)			

		Set @query = 'EXEC [ARM_CORE]..[Collection-AddAsset-FromList] ' + convert(nvarchar(255),@CollectionID) + ', ''''''' + @AssetID + ''''''', 1,''' + @who + ''' '

		EXECUTE (@query)	
--		Select @query
			
	END
END




GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SetStatusRegistered]
	@WorkstreamID int,
	@AssetID nvarchar(255),
	@who nvarchar(500) = 'System - Registration'
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
--	BEGIN TRAN;

	DECLARE @CollectionID INT;
	DECLARE @query nvarchar(max);

	if @WorkstreamID > 0 
	BEGIN
		SET @CollectionID = (SELECT w.RegisteredID FROM [Workstream] w WHERE w.WorkstreamID = @WorkstreamID)			

		Set @query = 'EXEC [ARM_CORE]..[Collection-AddAsset-FromList] ' + convert(nvarchar(255),@CollectionID) + ', ''''''' + @AssetID + ''''''', 1,''' + @who + ''' '

		EXECUTE (@query)	
			
	END
END




GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SetStatusDeployedbyList]
	@WorkstreamID int,
	@AssetList nvarchar(max)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
--	BEGIN TRAN;

	DECLARE @TARGET_ID INT;
	DECLARE @CONFIRM_ID INT;
	DECLARE @SCHED_ID INT;
	DECLARE @DEPLOYED_ID INT;
	DECLARE @DEF_ID INT;

	DECLARE @query nvarchar(max)

	if @WorkstreamID > 0 
	BEGIN
		SET @TARGET_ID = (SELECT w.TargettedID FROM [Workstream] w WHERE w.WorkstreamID = @WorkstreamID)
		SET @CONFIRM_ID = (SELECT w.ConfirmedID FROM [Workstream] w WHERE w.WorkstreamID = @WorkstreamID)
		SET @SCHED_ID = (SELECT w.ScheduledID FROM [Workstream] w WHERE w.WorkstreamID = @WorkstreamID)
		SET @DEPLOYED_ID = (SELECT w.DeployedID FROM [Workstream] w WHERE w.WorkstreamID = @WorkstreamID)
		SET @DEF_ID = (SELECT w.DeferredID FROM [Workstream] w WHERE w.WorkstreamID = @WorkstreamID)

		Set @query = '
		MERGE [ARM_CORE]..[A_CollectionItem] AS Target
		USING (SELECT AssetID, ' + convert(nvarchar(255),@DEPLOYED_ID) + ' as CollectionID from [ARM_CORE]..[Asset] where AssetID in  (' + @AssetList + ')) As Source
		ON (Target.ItemID = Source.AssetID and Target.CollectionID = Source.CollectionID )
		WHEN NOT MATCHED BY TARGET THEN
			INSERT ([ItemID],[CollectionID]) 
			VALUES (Source.AssetID, Source.CollectionID);	'

		EXECUTE(@query)			

--		DELETE FROM [ARM_CORE]..[A_CollectionItem] where ItemID in (' + @AssetList + ') and CollectionID = @TARGET_ID

		Set @query = '
		DELETE FROM [ARM_CORE]..[A_CollectionItem] where ItemID in (' + @AssetList + ') and CollectionID = ' + convert(nvarchar(255),@CONFIRM_ID) + ';
		DELETE FROM [ARM_CORE]..[A_CollectionItem] where ItemID in (' + @AssetList + ') and CollectionID = ' + convert(nvarchar(255),@TARGET_ID) + ';
		DELETE FROM [ARM_CORE]..[A_CollectionItem] where ItemID in (' + @AssetList + ') and CollectionID = ' + convert(nvarchar(255),@SCHED_ID) + ';
		DELETE FROM [ARM_CORE]..[A_CollectionItem] where ItemID in (' + @AssetList + ') and CollectionID = ' + convert(nvarchar(255),@DEF_ID) + ';
		'
		EXECUTE(@query)		
	END
END




GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SetStatusDeployed]
	@WorkstreamID int,
	@AssetID nvarchar(255),
	@who nvarchar(500) = 'System'
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
--	BEGIN TRAN;

	DECLARE @CollectionID INT;
	DECLARE @query nvarchar(max);

	if @WorkstreamID > 0 
	BEGIN
		SET @CollectionID = (SELECT w.DeployedID FROM [Workstream] w WHERE w.WorkstreamID = @WorkstreamID)			

		Set @query = 'EXEC [ARM_CORE]..[Collection-AddAsset-FromList] ' + convert(nvarchar(255),@CollectionID) + ', ''''''' + @AssetID + ''''''', 1,''' + @who + ''' '

		EXECUTE (@query)	
			
	END
END




GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SetStatusDeferredbyList-NEW]
	@WorkstreamID int,
	@AssetList nvarchar(max),
	@who nvarchar(500) = 'System'
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
--	BEGIN TRAN;

	DECLARE @CollectionID INT;
	DECLARE @query nvarchar(max);

	if @WorkstreamID > 0 
	BEGIN
		SET @CollectionID = (SELECT w.DeployedID FROM [Workstream] w WHERE w.WorkstreamID = @WorkstreamID)			

		Set @query = 'EXEC [ARM_CORE]..[Collection-AddAsset-FromList] ' + convert(nvarchar(255),@CollectionID) + ', ''''''' + @AssetList + ''''''', 1,''' + @who + ''' '

		EXECUTE (@query)	
			
	END
END




GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SetStatusDeferredbyList]
	@WorkstreamID int,
	@AssetList nvarchar(max)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
--	BEGIN TRAN;

	DECLARE @TARGET_ID INT;
	DECLARE @CONFIRM_ID INT;
	DECLARE @SCHED_ID INT;
	DECLARE @DEPLOYED_ID INT;
	DECLARE @DEF_ID INT;


	DECLARE @query nvarchar(max)

	if @WorkstreamID > 0 
	BEGIN
		SET @TARGET_ID = (SELECT w.TargettedID FROM [Workstream] w WHERE w.WorkstreamID = @WorkstreamID)
		SET @CONFIRM_ID = (SELECT w.ConfirmedID FROM [Workstream] w WHERE w.WorkstreamID = @WorkstreamID)
		SET @SCHED_ID = (SELECT w.ScheduledID FROM [Workstream] w WHERE w.WorkstreamID = @WorkstreamID)
		SET @DEPLOYED_ID = (SELECT w.DeployedID FROM [Workstream] w WHERE w.WorkstreamID = @WorkstreamID)
		SET @DEF_ID = (SELECT w.DeferredID FROM [Workstream] w WHERE w.WorkstreamID = @WorkstreamID)

		Set @query = '
		MERGE [ARM_CORE]..[A_CollectionItem] AS Target
		USING (SELECT AssetID, ' + convert(nvarchar(255),@DEF_ID) + ' as CollectionID from [ARM_CORE]..[Asset] where AssetID in  (' + @AssetList + ')) As Source
		ON (Target.ItemID = Source.AssetID and Target.CollectionID = Source.CollectionID )
		WHEN NOT MATCHED BY TARGET THEN
			INSERT ([ItemID],[CollectionID]) 
			VALUES (Source.AssetID, Source.CollectionID);	'

		EXECUTE(@query)			

--		DELETE FROM [ARM_CORE]..[A_CollectionItem] where ItemID in (' + @AssetList + ') and CollectionID = @TARGET_ID

		Set @query = '
		DELETE FROM [ARM_CORE]..[A_CollectionItem] where ItemID in (' + @AssetList + ') and CollectionID = ' + convert(nvarchar(255),@CONFIRM_ID) + ';
		DELETE FROM [ARM_CORE]..[A_CollectionItem] where ItemID in (' + @AssetList + ') and CollectionID = ' + convert(nvarchar(255),@TARGET_ID) + ';
		DELETE FROM [ARM_CORE]..[A_CollectionItem] where ItemID in (' + @AssetList + ') and CollectionID = ' + convert(nvarchar(255),@SCHED_ID) + ';
		DELETE FROM [ARM_CORE]..[A_CollectionItem] where ItemID in (' + @AssetList + ') and CollectionID = ' + convert(nvarchar(255),@DEPLOYED_ID) + ';
		'
		EXECUTE(@query)		
	END
END




GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SetStatusDeferred]
	@WorkstreamID int,
	@AssetID nvarchar(255),
	@who nvarchar(500) = 'System'
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
--	BEGIN TRAN;

	DECLARE @CollectionID INT;
	DECLARE @query nvarchar(max);

	if @WorkstreamID > 0 
	BEGIN
		SET @CollectionID = (SELECT w.DeferredID FROM [Workstream] w WHERE w.WorkstreamID = @WorkstreamID)			

		Set @query = 'EXEC [ARM_CORE]..[Collection-AddAsset-FromList] ' + convert(nvarchar(255),@CollectionID) + ', ''''''' + @AssetID + ''''''', 1,''' + @who + ''' '

		EXECUTE (@query)	
			
	END
END




GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SetStatusConfirmedbyList]
	@WorkstreamID int,
	@AssetList nvarchar(max)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
--	BEGIN TRAN;

	DECLARE @TARGET_ID INT;
	DECLARE @CONFIRM_ID INT;
	DECLARE @SCHED_ID INT;
	DECLARE @DEPLOYED_ID INT;
	DECLARE @DEF_ID INT;

	DECLARE @query nvarchar(max)

	if @WorkstreamID > 0 
	BEGIN
		SET @TARGET_ID = (SELECT w.TargettedID FROM [Workstream] w WHERE w.WorkstreamID = @WorkstreamID)
		SET @CONFIRM_ID = (SELECT w.ConfirmedID FROM [Workstream] w WHERE w.WorkstreamID = @WorkstreamID)
		SET @SCHED_ID = (SELECT w.ScheduledID FROM [Workstream] w WHERE w.WorkstreamID = @WorkstreamID)
		SET @DEPLOYED_ID = (SELECT w.DeployedID FROM [Workstream] w WHERE w.WorkstreamID = @WorkstreamID)
		SET @DEF_ID = (SELECT w.DeferredID FROM [Workstream] w WHERE w.WorkstreamID = @WorkstreamID)

		Set @query = '
		MERGE [ARM_CORE]..[A_CollectionItem] AS Target
		USING (SELECT AssetID, ' + convert(nvarchar(255),@CONFIRM_ID) + ' as CollectionID from [ARM_CORE]..[Asset] where AssetID in  (' + @AssetList + ')) As Source
		ON (Target.ItemID = Source.AssetID and Target.CollectionID = Source.CollectionID )
		WHEN NOT MATCHED BY TARGET THEN
			INSERT ([ItemID],[CollectionID]) 
			VALUES (Source.AssetID, Source.CollectionID);	'

		EXECUTE(@query)			

--		DELETE FROM [ARM_CORE]..[A_CollectionItem] where ItemID in (' + @AssetList + ') and CollectionID = @TARGET_ID

		Set @query = '
		DELETE FROM [ARM_CORE]..[A_CollectionItem] where ItemID in (' + @AssetList + ') and CollectionID = ' + convert(nvarchar(255),@DEF_ID) + ';
		DELETE FROM [ARM_CORE]..[A_CollectionItem] where ItemID in (' + @AssetList + ') and CollectionID = ' + convert(nvarchar(255),@TARGET_ID) + ';
		DELETE FROM [ARM_CORE]..[A_CollectionItem] where ItemID in (' + @AssetList + ') and CollectionID = ' + convert(nvarchar(255),@SCHED_ID) + ';
		DELETE FROM [ARM_CORE]..[A_CollectionItem] where ItemID in (' + @AssetList + ') and CollectionID = ' + convert(nvarchar(255),@DEPLOYED_ID) + ';
		'
		EXECUTE(@query)		
	END
END




GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SetStatusConfirmed]
	@WorkstreamID int,
	@AssetID nvarchar(255),
	@who nvarchar(500) = 'System'
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
--	BEGIN TRAN;

	DECLARE @CollectionID INT;
	DECLARE @query nvarchar(max);

	if @WorkstreamID > 0 
	BEGIN
		SET @CollectionID = (SELECT w.ConfirmedID FROM [Workstream] w WHERE w.WorkstreamID = @WorkstreamID)			

		Set @query = 'EXEC [ARM_CORE]..[Collection-AddAsset-FromList] ' + convert(nvarchar(255),@CollectionID) + ', ''''''' + @AssetID + ''''''', 1,''' + @who + ''' '

		EXECUTE (@query)	
			
	END
END




GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[SetModelByCode]
	-- Add the parameters for the stored procedure here

AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
		MERGE [ARM_CORE]..[Asset] AS Target
			USING (
				select a.AssetID, a.Model, m.Model_Code,  m.Model_Label, m.Model_type, m.[Model_make], l.model_label as Label
				from [ARM_CORE]..[Asset] a 
				LEFT JOIN [ARM_CORE]..[A_ModelCode] m on a.Model like m.Model_Code 
				LEFT JOIN (
					select distinct model_label from [ARM_CORE]..[A_ModelCode] 
				) as l on l.model_label = a.Model
--				LEFT JOIN [ARM_CORE]..[TMP_RAW_2012ArmDataFeed] t on t.ComputerName = a.AssetID
				where  l.model_label IS NULL and NOT a.Model IS NULL  
				and NOT m.Model_Code IS NULL
				) AS Source
			ON (Target.AssetID = Source.[AssetID])
			WHEN MATCHED THEN
			   UPDATE Set TARGET.Model = SOURCE.MODEL_Label, TARGET.[Type] = SOURCE.[Model_type], TARGET.[Make] = SOURCE.[Model_make] ;


END

GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[ScheduleSummaryLocations] 
	-- Add the parameters for the stored procedure here
	@ChannelID int = 1,
	@AssetType nvarchar(50) = '',
	@window int = 12,
	@loc nvarchar(255) = '',
	@FromDate date = NULL
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

SET @FromDate = ISNULL(@FromDate, (SELECT TOP 1 [Date] FROM [ARM_CORE]..[ScheduleSlot] where [DATE] <= GETDATE() and DAY = 1 order by [Date] desc))

SET @FromDate = (SELECT TOP 1 [Date] FROM [ARM_CORE]..[ScheduleSlot] where [DATE] <= @FromDate and DAY = 1 order by [Date] desc)


SELECT  distinct s.[SlotID]
      ,s.[Date]
      ,s.[Month]
      ,s.[Week]
      ,DATEPART(D,s.[Date]) As DayOfMonth
      ,s.[Day]
      ,s.[DayTxt]
      ,s.[Year]
      ,s.[FixedPoint]
      ,d.[Label]
      ,LEFT(z.location,7)
      ,ISNULL(LEFT(z.location,7),'') AS Building
      ,c.ShortName
      ,(SELECT Count(q.AssetID) FROM [ARM_CORE]..[ScheduleDeployRunAsset] q LEFT JOIN [ARM_CORE]..[AssetCache] y ON y.AssetID = q.AssetID where q.RunID = r.RunID and LEFT(y.location,7)=LEFT(z.location,7) ) AS AssetCount
  FROM [ARM_CORE]..[ScheduleDeployRunAsset] r 
  LEFT JOIN [ARM_CORE]..[ScheduleDeployRun] d on d.RunID = r.RunID 
  LEFT JOIN [ARM_CORE]..[ScheduleSlot] s ON s.Date = d.RunDate
  LEFT JOIN [ARM_CORE]..[AssetCache] z ON z.AssetID = r.AssetID
  LEFT JOIN Channel$ c ON c.ChannelID = d.ChannelID
  where s.[Date] >= @FromDate and s.[Date] < DateAdd(week,@window+1,@FromDate )
  order by s.SlotID, c.ShortName, LEFT(z.location,7)
  
END








GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[ScheduleSummary2] 
	-- Add the parameters for the stored procedure here
	@ChannelID int = 1,
	@AssetType nvarchar(50) = '',
	@window int = 3,
	@loc nvarchar(255) = '',
	@Barea nvarchar(255) = '',
	@StatusFilter nvarchar(255) = '',
	@FromDate date = NULL
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

declare @DEPFLAG bit = 0
declare @myStatusFilter nvarchar(255) = ''


SET @FromDate = ISNULL(@FromDate, (SELECT TOP 1 [Date] FROM [ARM_CORE]..[ScheduleSlot] where [DATE] <= GETDATE() and DAY = 1 order by [Date] desc))

SET @FromDate = (SELECT TOP 1 [Date] FROM [ARM_CORE]..[ScheduleSlot] where [DATE] <= @FromDate and DAY = 1 order by [Date] desc)

set @myStatusFilter = @StatusFilter


if @StatusFilter = 'MARKED AS DEPLOYED' 
BEGIN
	set @DEPFLAG = 1;
	set @myStatusFilter = '';
END
if @StatusFilter = 'NOT DEPLOYED'
BEGIN
	set @DEPFLAG = 0;
	set @myStatusFilter = '';
END

if @StatusFilter = 'MARKED AS DEPLOYED' or @StatusFilter = 'NOT DEPLOYED'
BEGIN


	if @ChannelID > 0 
		BEGIN

			SELECT s.[SlotID]
			  ,s.[Date]
			  ,s.[Month]
			  ,s.[Week]
			  ,DATEPART(D,s.[Date]) As DayOfMonth
			  ,s.[Day]
			  ,s.[DayTxt]
			  ,s.[Year]
			  ,s.[FixedPoint]
			  ,(select COUNT(r.AssetID) from [ARM_CORE]..[ScheduleDeployRunAsset] r 
				LEFT JOIN [ARM_CORE]..[ScheduleDeployRun] d on d.RunID = r.RunID 
				LEFT JOIN [ARM_CORE]..[Asset] z ON z.AssetID = r.AssetID
				LEFT JOIN [ARM_CORE]..[AssetStatus] a ON a.AssetID = r.AssetID 
				where d.RunDate = s.Date AND z.[Type] like  '%' + @AssetType + '%' and d.ChannelID = @ChannelID and z.Location like '%' + @loc + '%' 
					and z.BArea like '%' + @BArea + '%' and IsNull(r.[Status],'') like '%' + @myStatusFilter + '%' and IsNull(a.EngDeployed,0) = @DEPFLAG
				) 
				AS ATotal 
			  ,0 AS AWin7
			  , CONVERT(date,getDate()) AS Today
			FROM [ARM_CORE]..[ScheduleSlot] s 
			where s.[Date] >= @FromDate and s.[Date] < DateAdd(week,@window+1,@FromDate ) order by s.[Date]

		END
	ELSE

		SELECT s.[SlotID]
		  ,s.[Date]
		  ,s.[Month]
		  ,s.[Week]
		  ,DATEPART(D,s.[Date]) As DayOfMonth
		  ,s.[Day]
		  ,s.[DayTxt]
		  ,s.[Year]
		  ,s.[FixedPoint]
		  ,(select COUNT(r.AssetID) from [ARM_CORE]..[ScheduleDeployRunAsset] r 
			LEFT JOIN [ARM_CORE]..[ScheduleDeployRun] d on d.RunID = r.RunID 
			LEFT JOIN [ARM_CORE]..[Asset] z ON z.AssetID = r.AssetID
			LEFT JOIN [ARM_CORE]..[AssetStatus] a ON a.AssetID = r.AssetID 
			where d.RunDate = s.Date AND z.[Type] like  '%' + @AssetType + '%'  and z.Location like '%' + @loc + '%' and z.BArea like '%' + @BArea + '%' 
				and IsNull(r.[Status],'') like '%' + @myStatusFilter + '%' and IsNull(a.EngDeployed,0) = @DEPFLAG ) 
			AS ATotal 
		  ,0 AS AWin7
		  , CONVERT(date,getDate()) AS Today
	  FROM [ARM_CORE]..[ScheduleSlot] s 
	  where s.[Date] >= @FromDate and s.[Date] < DateAdd(week,@window+1,@FromDate ) order by s.[Date]
	
END

ELSE

	if @ChannelID > 0 
		BEGIN

		SELECT s.[SlotID]
		  ,s.[Date]
		  ,s.[Month]
		  ,s.[Week]
		  ,DATEPART(D,s.[Date]) As DayOfMonth
		  ,s.[Day]
		  ,s.[DayTxt]
		  ,s.[Year]
		  ,s.[FixedPoint]
		  ,(select COUNT(r.AssetID) from [ARM_CORE]..[ScheduleDeployRunAsset] r 
			LEFT JOIN [ARM_CORE]..[ScheduleDeployRun] d on d.RunID = r.RunID 
			LEFT JOIN [ARM_CORE]..[Asset] z ON z.AssetID = r.AssetID
			LEFT JOIN [ARM_CORE]..[AssetStatus] a ON a.AssetID = r.AssetID 
			where d.RunDate = s.Date AND z.[Type] like  '%' + @AssetType + '%' and d.ChannelID = @ChannelID and z.Location like '%' + @loc + '%' 
				and z.BArea like '%' + @BArea + '%' and IsNull(r.[Status],'') like '%' + @myStatusFilter + '%'
			) 
			AS ATotal 
		  ,0 AS AWin7
		  , CONVERT(date,getDate()) AS Today
	  FROM [ARM_CORE]..[ScheduleSlot] s 
	  where s.[Date] >= @FromDate and s.[Date] < DateAdd(week,@window+1,@FromDate ) order by s.[Date]

		END
	ELSE

		SELECT s.[SlotID]
		  ,s.[Date]
		  ,s.[Month]
		  ,s.[Week]
		  ,DATEPART(D,s.[Date]) As DayOfMonth
		  ,s.[Day]
		  ,s.[DayTxt]
		  ,s.[Year]
		  ,s.[FixedPoint]
		  ,(select COUNT(r.AssetID) from [ARM_CORE]..[ScheduleDeployRunAsset] r 
			LEFT JOIN [ARM_CORE]..[ScheduleDeployRun] d on d.RunID = r.RunID 
			LEFT JOIN [ARM_CORE]..[Asset] z ON z.AssetID = r.AssetID
			LEFT JOIN [ARM_CORE]..[AssetStatus] a ON a.AssetID = r.AssetID 
			where d.RunDate = s.Date AND z.[Type] like  '%' + @AssetType + '%'  and z.Location like '%' + @loc + '%' and z.BArea like '%' + @BArea + '%' 
				and IsNull(r.[Status],'') like '%' + @myStatusFilter + '%' ) 
			AS ATotal 
		  ,0 AS AWin7
		  , CONVERT(date,getDate()) AS Today
	  FROM [ARM_CORE]..[ScheduleSlot] s 
	  where s.[Date] >= @FromDate and s.[Date] < DateAdd(week,@window+1,@FromDate ) order by s.[Date]

END







GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[ScheduleSummary] 
	-- Add the parameters for the stored procedure here
	@ChannelID int = 1,
	@AssetType nvarchar(50) = '',
	@window int = 3,
	@loc nvarchar(255) = '',
	@Barea nvarchar(255) = '',
	@FromDate date = NULL
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

SET @FromDate = ISNULL(@FromDate, (SELECT TOP 1 [Date] FROM [ARM_CORE]..[ScheduleSlot] where [DATE] <= GETDATE() and DAY = 1 order by [Date] desc))

SET @FromDate = (SELECT TOP 1 [Date] FROM [ARM_CORE]..[ScheduleSlot] where [DATE] <= @FromDate and DAY = 1 order by [Date] desc)

if @ChannelID > 0 
	BEGIN

	SELECT s.[SlotID]
      ,s.[Date]
      ,s.[Month]
      ,s.[Week]
      ,DATEPART(D,s.[Date]) As DayOfMonth
      ,s.[Day]
      ,s.[DayTxt]
      ,s.[Year]
      ,s.[FixedPoint]
      ,(select COUNT(r.AssetID) from [ARM_CORE]..[ScheduleDeployRunAsset] r 
		LEFT JOIN [ARM_CORE]..[ScheduleDeployRun] d on d.RunID = r.RunID 
		LEFT JOIN [ARM_CORE]..[Asset] z ON z.AssetID = r.AssetID
		LEFT JOIN [ARM_CORE]..[AssetStatus] a ON a.AssetID = r.AssetID 
		where d.RunDate = s.Date AND z.[Type] like  '%' + @AssetType + '%' and d.ChannelID = @ChannelID and z.Location like '%' + @loc + '%' and z.BArea like '%' + @BArea + '%'
		) 
		AS ATotal 
      ,0 AS AWin7
	  , CONVERT(date,getDate()) AS Today
  FROM [ARM_CORE]..[ScheduleSlot] s 
  where s.[Date] >= @FromDate and s.[Date] < DateAdd(week,@window+1,@FromDate ) order by s.[Date]

	END
ELSE

	SELECT s.[SlotID]
      ,s.[Date]
      ,s.[Month]
      ,s.[Week]
      ,DATEPART(D,s.[Date]) As DayOfMonth
      ,s.[Day]
      ,s.[DayTxt]
      ,s.[Year]
      ,s.[FixedPoint]
      ,(select COUNT(r.AssetID) from [ARM_CORE]..[ScheduleDeployRunAsset] r 
		LEFT JOIN [ARM_CORE]..[ScheduleDeployRun] d on d.RunID = r.RunID 
		LEFT JOIN [ARM_CORE]..[Asset] z ON z.AssetID = r.AssetID
		LEFT JOIN [ARM_CORE]..[AssetStatus] a ON a.AssetID = r.AssetID 
		where d.RunDate = s.Date AND z.[Type] like  '%' + @AssetType + '%'  and z.Location like '%' + @loc + '%' and z.BArea like '%' + @BArea + '%') 
		AS ATotal 
      ,0 AS AWin7
	  , CONVERT(date,getDate()) AS Today
  FROM [ARM_CORE]..[ScheduleSlot] s 
  where s.[Date] >= @FromDate and s.[Date] < DateAdd(week,@window+1,@FromDate ) order by s.[Date]
END








GO
CREATE PROCEDURE [dbo].[SaveBatchNotification]
	@Batch_From nvarchar(MAX),
	@Batch_Reply nvarchar(MAX),
	@Batch_Subject nvarchar(MAX),
	@Batch_Body nvarchar(MAX),
	@Batch_Assets nvarchar(MAX)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;


insert into [ARM_CORE]..[BatchNotification] (SendFrom, ReplyTo, Subject, Message) 
values (@Batch_From, @Batch_Reply, @Batch_Subject, @Batch_Body)

DECLARE @BatchID INT;
DECLARE @BatchAssetList nvarchar(MAX);
DECLARE @mySQl nvarchar(MAX);

Set @BatchID = SCOPE_IDENTITY();
Set @BatchAssetList = '''' + REPLACE(@Batch_Assets,',',''',''') + ''''

select @BatchAssetList;

SET @mySQL = 'insert into [ARM_CORE]..BatchQueue (BatchNotificationID, AssetID, Email) 	select ' + convert(nvarchar(255), @BatchID) + ', a.AssetID, a.[Email] from Asset a 	where a.AssetID in (' + @BatchAssetList + ')';

EXECUTE (@mySQL);

SELECT @BatchID AS [NewBatchID];
END


GO

-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Role-Pivot]
@FileID int = 0,
@Since date = '1900-01-01'
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;


	SELECT distinct f.FileID, f.[Folder], f.[Name] as FileName, f.FilePath, f.LastModified, f.[FileExists], (select top 1 IsNull(m.MenuID,0) from [ARM_CORE]..[A_Menu] m where m.URL like f.FilePath+'%') as MenuID, r.Name, 1 as Permit
	INTO #tempPivotTable
	FROM [ARM_CORE]..[A_File] f 
	LEFT JOIN [ARM_CORE]..[A_FileAccess] a on a.FileID = f.FileID 
	LEFT JOIN [ARM_CORE]..[A_Role] r on r.RoleID = a.RoleID 
	where IsNull(f.Ignore,0) = 0 and (f.FileID = @FileID or @FileID = 0) and LastModified > @since





	DECLARE @Columns VARCHAR(MAX)

	SELECT @columns = STUFF(( SELECT TOP 100 PERCENT
									'],[' + cast(Name as varchar)
							FROM    [ARM_CORE]..[A_Role] AS t2
							ORDER BY Rank,'],[' + cast(Name as varchar)
							FOR XML PATH('')
						  ), 1, 2, '') + ']'


	DECLARE @query VARCHAR(8000)

	SET @query = '
	SELECT p.*, v.Description
	FROM #tempPivotTable q
	PIVOT
	(
	SUM(Permit)
	FOR [Name]
	IN (' + @columns + ')
	)
	AS p 
	LEFT JOIN [ARM_CORE]..[A_File] v on v.FileID = p.FileID
    order by p.Folder, p.FilePath'


	EXECUTE(@query)


	DROP TABLE #tempPivotTable
END




GO
CREATE PROCEDURE [dbo].[ReportData-TargetPivot]
       @fieldList nvarchar(1000) = ''
AS
BEGIN
       -- SET NOCOUNT ON added to prevent extra result sets from
       -- interfering with SELECT statements.
       SET NOCOUNT ON;





	SELECT distinct c.[Name] , ((select f.ReportValue from [ARM_CORE].[dbo].[A_ReportData] f where f.ReportName = c.Name+'-Baseline1' and f.[ReportDate] = dateadd(wk,-1,r.[ReportDate])) - r.ReportValue ) as [ReportValue], [ReportDate] 
	INTO #tempReportPivotTable
	from [ARM_CORE]..[A_Collection] c 
	LEFT JOIN [ARM_CORE].[dbo].[A_ReportData] r on r.ReportName = c.Name+'-Baseline1'
	where IsNull(c.EndState,0) <> 1 and c.CollectionClassID = 30 and [ReportDate] > '2022-01-10' order by [Name], [ReportDate] 

	insert into #tempReportPivotTable
	select ' TOTALS', sum(ReportValue), ReportDate from #tempReportPivotTable group by ReportDate

	DECLARE @Columns VARCHAR(MAX)

	SELECT @columns = STUFF(( SELECT DISTINCT TOP 100 PERCENT
														'],[' + cast([ReportDate] as varchar)
											FROM    #tempReportPivotTable AS t2
											ORDER BY '],[' + cast([ReportDate] as varchar)
											FOR XML PATH('')
										), 1, 2, '') + ']'

	DECLARE @query VARCHAR(8000)

	SET @query = '
	SELECT *
	FROM #tempReportPivotTable t
	PIVOT
	(
	SUM(ReportValue)
	FOR [ReportDate] 
	IN (' + @columns + ')
	)
	AS p 
	order by p.Name'


	exec(@query)


	DROP TABLE #tempReportPivotTable
END

GO
CREATE PROCEDURE [dbo].[ReportData-Pivot]
       @fieldList nvarchar(1000) = ''
AS
BEGIN
       -- SET NOCOUNT ON added to prevent extra result sets from
       -- interfering with SELECT statements.
       SET NOCOUNT ON;


       SELECT [ReportDate], [ReportName] as [Name], [ReportValue]
       INTO #tempReportPivotTable
       FROM [ARM_CORE].[dbo].[A_ReportData] with(nolock)
       where [ReportName] in (select x.[value] from (Select Seq  = Row_Number() over (Order By (Select null)) ,Value = v.value('(./text())[1]', 'varchar(max)')
                     From  (values (convert(xml,'<x>' + replace(@fieldList,',','</x><x>')+'</x>'))) x(n) Cross Apply n.nodes('x') node(v) ) x )
       order by [ReportDate]  


       DECLARE @Columns VARCHAR(MAX)

       SELECT @columns = STUFF(( SELECT DISTINCT TOP 100 PERCENT
                                                            '],[' + cast([Name] as varchar)
                                               FROM    #tempReportPivotTable AS t2 with(nolock)
                                               ORDER BY '],[' + cast([Name] as varchar)
                                               FOR XML PATH('')
                                          ), 1, 2, '') + ']'

       DECLARE @query VARCHAR(8000)

       SET @query = '
       SELECT *
       FROM #tempReportPivotTable t with(nolock)
       PIVOT
       (
       SUM([ReportValue])
       FOR t.[Name]
       IN (' + @columns + ')
       )
       AS p '


       EXECUTE(@query)


       DROP TABLE #tempReportPivotTable
END

GO
CREATE PROCEDURE [dbo].[ReportData-GroupPivot]
       @field1 nvarchar(1000) = '',
	   @field2 nvarchar(1000) = 'Nope',
	   @field3 nvarchar(1000) = 'Nope'
AS
BEGIN
       -- SET NOCOUNT ON added to prevent extra result sets from
       -- interfering with SELECT statements.
	SET NOCOUNT ON;



		SELECT [ReportDate], @field1 as [Name], Sum([ReportValue]) as [ReportValue]
		   INTO #tempReportPivotTable
		FROM [ARM_CORE].[dbo].[A_ReportData] 
		where [ReportName] like '%-'+@field1 group by [ReportDate]
		UNION
		SELECT [ReportDate], @field2 as [Name], Sum([ReportValue]) as [ReportValue]
			FROM [ARM_CORE].[dbo].[A_ReportData] 
		where [ReportName] like '%-'+@field2 group by [ReportDate]
		UNION
		SELECT [ReportDate], @field3 as [Name], Sum([ReportValue]) as [ReportValue]
			FROM [ARM_CORE].[dbo].[A_ReportData] 
		where [ReportName] like '%-'+@field3 group by [ReportDate]


		DECLARE @Columns VARCHAR(MAX)

		SELECT @columns = STUFF(( SELECT DISTINCT TOP 100 PERCENT
															'],[' + cast([Name] as varchar)
												FROM    #tempReportPivotTable AS t2
												ORDER BY '],[' + cast([Name] as varchar)
												FOR XML PATH('')
											), 1, 2, '') + ']'

		DECLARE @query VARCHAR(8000)

		SET @query = '
		SELECT *
		FROM #tempReportPivotTable t
		PIVOT
		(
		SUM([ReportValue])
		FOR t.[Name]
		IN (' + @columns + ')
		)
		AS p '


		EXECUTE(@query)


		DROP TABLE #tempReportPivotTable
END

GO
-- =============================================
-- Author:          <Author,,Name>
-- alter date: <alter Date,,>
-- Description:     <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[ReportData-Class]
       @ClassName nvarchar(255) = '',
       @FromDate date = '1900-01-01'
AS
BEGIN
       -- SET NOCOUNT ON added to prevent extra result sets from
       -- interfering with SELECT statements.
       SET NOCOUNT ON;

       -- get the columns




       SELECT [ReportDate]
               ,[ReportField]
               ,[ReportValue]
       INTO #tempClassPivotTable
       FROM [ARM_CORE].[dbo].[A_ReportData] where [ReportName] = @ClassName and [ReportDate] >= @FromDate

       DECLARE @Columns VARCHAR(MAX)

--     SELECT @columns = STUFF(( SELECT DISTINCT TOP 100 PERCENT
--                                                          '],[' + cast([ReportField] as varchar)
--                                             FROM    #tempClassPivotTable AS t2
--                                             ORDER BY '],[' + cast([ReportField] as varchar)
--                                             FOR XML PATH('')
--                                        ), 1, 2, '') + ']'

       SELECT @columns = STUFF(( SELECT  TOP 100 PERCENT
                                                            '],[' + cast(c.[Name] as varchar)
                                               FROM    [ARM_CORE]..[A_Collection] c LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc on cc.CollectionClassID = c.CollectionClassID where cc.Name = @ClassName and c.ignore = 0
                                               ORDER BY c.[Order] 
                                               FOR XML PATH('')
                                          ), 1, 2, '') + ']'



       DECLARE @query VARCHAR(8000)

       SET @query = '
       SELECT *
       FROM #tempClassPivotTable t
       PIVOT
       (
       SUM(ReportValue)
       FOR t.[ReportField]
       IN (' + @columns + ')
       )
       AS p '


       EXECUTE(@query)


       DROP TABLE #tempClassPivotTable
END

GO
CREATE PROCEDURE [dbo].[ReportData-ActualsPivot]
       @fieldList nvarchar(1000) = ''
AS
BEGIN
       -- SET NOCOUNT ON added to prevent extra result sets from
       -- interfering with SELECT statements.
       SET NOCOUNT ON;





--	SELECT distinct c.[Name] , r.ReportValue, r.ReportDate, (select sum(ReportValue) from [ARM_CORE].[dbo].[A_ReportData] where ReportName = c.Name+'-Actual') as [Total]
--	INTO #tempReportPivotTable
--	from [ARM_CORE]..[A_Collection] c 
--	LEFT JOIN [ARM_CORE].[dbo].[A_ReportData] r on r.ReportName = c.Name+'-Actual'
--	where IsNull(c.EndState,0) <> 1 and c.CollectionClassID = 30 order by [Name], [ReportDate] 


	select x.Name, x.Deployed as [ReportValue], cast(DateAdd(wk,x.wk-1,'2022-01-01')+2  as date) as [ReportDate], t.[Total] 
	INTO #tempReportPivotTable
	from (
		select distinct s.Name, count(i.ItemID) as Deployed, DatePart(wk,i.TaggedOn)-1 as wk  from [ARM_CORE]..[A_CollectionItem] i with(nolock) LEFT JOIN [ARM_CORE]..[A_Collection] c with(nolock) on c.CollectionID = i.CollectionID 
		LEFT JOIN [ARM_CORE]..[A_CollectionItem] si with(nolock) on si.ItemID = i.ItemID LEFT JOIN [ARM_CORE]..[A_Collection] s with(nolock) on s.CollectionID = si.CollectionID
		where c.CollectionClassID = 36 and s.CollectionClassID = 38 and s.EndState = 0
		group by s.Name, DatePart(wk,i.TaggedOn)-1
	) x
	LEFT JOIN (
		select distinct s.Name, count(i.ItemID) as [Total] from [ARM_CORE]..[A_CollectionItem] i with(nolock) LEFT JOIN [ARM_CORE]..[A_Collection] c with(nolock) on c.CollectionID = i.CollectionID 
		LEFT JOIN [ARM_CORE]..[A_CollectionItem] si with(nolock) on si.ItemID = i.ItemID LEFT JOIN [ARM_CORE]..[A_Collection] s with(nolock) on s.CollectionID = si.CollectionID
		where c.CollectionClassID = 36 and s.CollectionClassID = 38 and s.EndState = 0
		group by s.Name
	) t on t.Name = x.Name

	insert into #tempReportPivotTable
	select ' TOTALS', sum(ReportValue), ReportDate, (select sum(ReportValue) from #tempReportPivotTable) as [TOTAL] from #tempReportPivotTable group by ReportDate

	DECLARE @Columns VARCHAR(MAX)

	SELECT @columns = STUFF(( SELECT DISTINCT TOP 100 PERCENT
														'],[' + cast([ReportDate] as varchar)
											FROM    #tempReportPivotTable AS t2
											ORDER BY '],[' + cast([ReportDate] as varchar)
											FOR XML PATH('')
										), 1, 2, '') + ']'

	DECLARE @query VARCHAR(8000)

	SET @query = '
	SELECT *
	FROM #tempReportPivotTable t
	PIVOT
	(
	SUM(ReportValue)
	FOR [ReportDate] 
	IN (' + @columns + ')
	)
	AS p 
	order by p.Name'


	exec(@query)


	DROP TABLE #tempReportPivotTable
END

GO
CREATE PROCEDURE [dbo].[REPORT_App_Venn] 
	-- Add the parameters for the stored procedure here
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

Select 'ToBe' as Scope,
(select count(distinct a.ApplicationID)
from [ARM_CORE]..[AppAstToBe] a
LEFT JOIN [ARM_CORE]..[AppBaselineTracker] t on a.ApplicationID = t.ApplicationID
LEFT JOIN [ARM_CORE]..[Application] app on app.ApplicationID = a.ApplicationID
where t.ApplicationID IS NULL
) as A,
(SELECT count(distinct t.ApplicationID) 
from [ARM_CORE]..[AppBaselineTracker] t
LEFT JOIN [ARM_CORE]..[AppAstToBe] a on a.ApplicationID = t.ApplicationID
where t.Discovery = 'Removed' and a.ApplicationID IS NULL
) as B,
(SELECT count(distinct a.ApplicationID)
from [ARM_CORE]..[AppAstToBe] a
INNER JOIN [ARM_CORE]..[AppBaselineTracker] t on a.ApplicationID = t.ApplicationID
LEFT JOIN [ARM_CORE]..[Application] app on app.ApplicationID = a.ApplicationID
where t.Discovery <> 'Removed' 
) as C,
(SELECT count(distinct a.ApplicationID)
from [ARM_CORE]..[AppAstToBe] a
INNER JOIN [ARM_CORE]..[AppBaselineTracker] t on a.ApplicationID = t.ApplicationID
LEFT JOIN [ARM_CORE]..[Application] app on app.ApplicationID = a.ApplicationID
where t.Discovery = 'Removed' 
) as D,
(SELECT count(distinct t.ApplicationID)
from [ARM_CORE]..[AppBaselineTracker] t
LEFT JOIN [ARM_CORE]..[AppAstToBe] a on a.ApplicationID = t.ApplicationID
where t.Discovery <> 'Removed' and a.ApplicationID IS NULL
) as E

END


GO



-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[RemoveFromGroup] 
	@GroupName nvarchar(255),
	@AssetID nvarchar(255),
	@GrpID int = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	if @GrpID > 0 
		MERGE [ARMS]..[AssetFlags] AS Target
		USING (SELECT @AssetID as AssetID, @GrpID as FlagID) As Source
		ON (Target.AssetID = Source.AssetID and Target.FlagID = Source.FlagID )
		WHEN MATCHED 
			THEN DELETE;
	Else
		MERGE [ARMS]..[AssetFlags] AS Target
		USING (SELECT @AssetID as AssetID, (Select top 1 f.FlagID from [ARMS]..[AssetFlag] f where f.Name = @GroupName) AS FlagID) As Source
		ON (Target.AssetID = Source.AssetID and Target.FlagID = Source.FlagID )
		WHEN MATCHED 
			THEN DELETE;
					

END




GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[RecordTransaction]
    @Auth_User nvarchar(255) = '',
    @AssetID nvarchar(255) = '',
    @What nvarchar(255) = '',
	@AppKey nvarchar(255) = ''
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	
-- DECLARE @MyTableVar table( NewResponseID smallint);

INSERT [ARM_CORE]..[Transaction] (Who,What,AppKey,AssetID)  VALUES (@Auth_User, @What, @AppKey, @AssetID);

--Return the result set of the table variable.

-- SELECT NewResponseID AS RID FROM @MyTableVar;

 
END






GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[RecordSurvey]
    @Auth_User nvarchar(255) = '',
    @AssetID nvarchar(255) = '',
    @ChannelID int = NULL,
	@SID int = NULL
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	
DECLARE @MyTableVar table( NewResponseID smallint);

INSERT [ARM_CORE]..[SurveyResponse] (USER_AUTH,AssetID,ChannelID,[SID]) OUTPUT INSERTED.RID INTO @MyTableVar VALUES (@Auth_User, @AssetID, @ChannelID,@SID);

--Return the result set of the table variable.

SELECT NewResponseID AS RID FROM @MyTableVar;

 
END









GO
 
 
 
 
-- =============================================
-- Author:           <Author,,Name>
-- alter date: <alter Date,,>
-- Description:      <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Profile-Estate]
AS
BEGIN
       -- SET NOCOUNT ON added to prevent extra result sets from
       -- interfering with SELECT statements.
       SET NOCOUNT ON;
 
       DECLARE @AppID nvarchar(1000);
       DECLARE @LocalID nvarchar(255);

       DECLARE @NumberReady int;
       DECLARE @AppCount int;
	   Declare @AssetsNoApps int;
	   Declare @AssetsTotal int;
 
	   IF object_id('[arm_core]..[TMP_ESTATE]','U') is not null  Drop TABLE [arm_core]..[TMP_ESTATE];
 
 
-- Build a list of unique apps, all set to Ready = 0.  We will later iterate through this list setting each
-- app to ready.  This list excludes any apps that we will not deploy.
       SELECT distinct  b.[ApplicationID], a.LocalID, COUNT(b.AssetID) as Total, 0 AS READY
	   INTO arm_core..TMP_ESTATE
       FROM [arm_Core].[dbo].[AppAstToBe] b 
       LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = b.ApplicationID 
       LEFT JOIN [ARM_CORE]..[Asset] t on t.AssetID = b.AssetID 
 --      LEFT JOIN [ARM_CORE]..[BArea] c on c.BArea = t.BArea 
       where  t.Live = 1 -- and IsNull(a.DeployType,'-')  not in ('B','X','W')  -- c.Internal = 0 
       group by b.[ApplicationID], a.LocalID order by COUNT(b.AssetID) desc
 
	   IF object_id('[arm_core]..[TMP_AppAstToBe]','U') is not null  Drop TABLE [arm_core]..TMP_AppAstToBe;
 
 
-- Build a list of active apps from AppAstToBe by excluding all the instances that will not deployed - Basebuild, Except, Internal BAreas
       SELECT distinct b.[ApplicationID], b.AssetID
	   INTO arm_core..TMP_AppAstToBe
       FROM [arm_Core].[dbo].[AppAstToBe] b 
       LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = b.ApplicationID 
       LEFT JOIN [ARM_CORE]..[Asset] t on t.AssetID = b.AssetID 
 --      LEFT JOIN [ARM_CORE]..[BArea] c on c.BArea = t.BArea 
       where t.Live = 1 -- and IsNull(a.DeployType,'-') not in ('B','X','W') -- and  c.Internal = 0 
   
--Count the total number of Assets that are in scope and live
  	   select @AssetsTotal = count (a.AssetID)
	   FROM [arm_Core].[dbo].[asset] a 
 --      LEFT JOIN [ARM_CORE]..[BArea] b on b.BArea = a.BArea
       where a.Live = 1 -- b.Internal = 0 
 
--Loop through TMP_Estate and count number of free assets for each app and write them into a table.
       DECLARE App_Cursor CURSOR FOR SELECT  [ApplicationID], [LocalID] from arm_core..TMP_ESTATE order by [Total] desc, ApplicationID
       OPEN App_Cursor
 
       FETCH NEXT FROM App_Cursor INTo @AppID, @LocalID
	   Delete from ESTATE_PROFILE
	   Set @AppCount = 1
 
       WHILE @@FETCH_STATUS = 0
       BEGIN
              Update arm_core..TMP_ESTATE set READY = 1 where ApplicationID = @AppID
 --             select @NumberReady =  @AssetsTotal - count(ta.AssetID)
--				from (
--					select distinct t.assetid from
--						(select a.AssetID,a.ApplicationID
--						FROM [arm_core]..TMP_AppAstToBe a
--						left join [ARM_CORE]..[TMP_ESTATE] e on e.applicationid = a.ApplicationID
--					 where e.ready = 0) as t
--					 )ta

			SELECT @NumberReady = count(distinct a.Assetid)  from ARM_CORE..[Asset] a
			left join (
				SELECT distinct AssetID from ARM_CORE..TMP_AppAstToBe apps 
				LEFT JOIN ARM_CORE..[TMP_ESTATE] ap on ap.ApplicationID = apps.ApplicationID 
				where IsNull(ap.Ready,0) = 0 -- and  ap.DeployType <> 'X'
			) x on x.assetid = a.assetID
			left join ARM_CORE..TMP_AppAstToBe i on i.AssetID = a.AssetID
			where a.Live = 1 and x.Assetid IS NULL -- and i.AssetID is not null

 
              insert into ESTATE_PROFILE (Apps, LocalID, Assets, ApplicationID) values (@AppCount, @LocalID, @NumberReady, @AppID)
              set @AppCount = @AppCount + 1
 
              FETCH NEXT FROM App_Cursor INTO @AppID, @LocalID
       END
 
       CLOSE App_Cursor;
       DEALLOCATE App_Cursor;
 
	   IF object_id('arm_core..TMP_ESTATE','U') is not null  DROP Table arm_core..TMP_ESTATE;
END
 

GO
CREATE PROCEDURE [dbo].[NewWorkstream]
        @WSname nvarchar(255) = 'Workstream ',
		@WSprogram nvarchar(255) = ''
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
        SET NOCOUNT ON;
DECLARE @CCID INT;
DECLARE @WSID INT;
DECLARE @TARGET_ID INT;
DECLARE @CONFIRM_ID INT;
DECLARE @NORESPONSE_ID INT;
DECLARE @SCHED_ID INT;
DECLARE @DEPLOYED_ID INT;
DECLARE @DEF_ID INT;
DECLARE @NOTLIVE_ID INT;

DECLARE @BOOKING_ID INT;
 
-- ALTER Collection Class for System supported Workstream Status.
insert into [ARM_CORE]..[A_CollectionClass] ([Name],[Description],[Distinct],[Status]) values (@WSname,'',1,1)
Set @CCID = SCOPE_IDENTITY();
 
-- ALTER System supported Workstream Status.
insert into [ARM_CORE]..[A_Collection] ([Name],[Order],[Type],[Marker],[CollectionClassID]) values ('Targeted',10,'Asset',0,@CCID)
Set @TARGET_ID = SCOPE_IDENTITY();
insert into [ARM_CORE]..[A_Collection] ([Name],[Order],[Type],[Marker],[CollectionClassID]) values ('Engaged',20,'Asset',0,@CCID)
Set @CONFIRM_ID = SCOPE_IDENTITY();
insert into [ARM_CORE]..[A_Collection] ([Name],[Order],[Type],[Marker],[CollectionClassID]) values ('No Response',25,'Asset',0,@CCID)
Set @NORESPONSE_ID = SCOPE_IDENTITY();
insert into [ARM_CORE]..[A_Collection] ([Name],[Order],[Type],[Marker],[CollectionClassID]) values ('Scheduled',30,'Asset',0,@CCID)
Set @SCHED_ID = SCOPE_IDENTITY();
insert into [ARM_CORE]..[A_Collection] ([Name],[Order],[Type],[Marker],[CollectionClassID],[Deployed], [EndState]) values ('Deployed',40,'Asset',0,@CCID,1,1)
Set @DEPLOYED_ID = SCOPE_IDENTITY();
insert into [ARM_CORE]..[A_Collection] ([Name],[Order],[Type],[Marker],[CollectionClassID]) values ('Deferred',50,'Asset',0,@CCID)
Set @DEF_ID = SCOPE_IDENTITY();
insert into [ARM_CORE]..[A_Collection] ([Name],[Order],[Type],[Marker],[CollectionClassID],[EndState]) values ('Exclude',60,'Asset',0,@CCID,1)
Set @NOTLIVE_ID = SCOPE_IDENTITY();

-- ALTER new Workstream .
insert into [ARM_CORE]..[Workstream] ([Name],[Purpose],[KeyStatusID],[Active],[TargettedID],[ConfirmedID],[NoResponseID],[ScheduledID],[DeployedID],[DeferredID],[NotLiveID],[ClosedList],[ACLProtected], [Program]) values (@WSname,'',@CCID,0, @TARGET_ID, @CONFIRM_ID, @NORESPONSE_ID, @SCHED_ID, @DEPLOYED_ID, @DEF_ID, @NOTLIVE_ID, 1, 1, @WSprogram)
Set @WSID = SCOPE_IDENTITY();
update [ARM_CORE]..[A_CollectionClass] set [WorkstreamID] = @WSID where [CollectionClassID] = @CCID

-- update [ARM_CORE]..[A_CollectionClass] set [WorkstreamID] = @WSID, [Name] = [Name] + CAST(@WSID AS NVARCHAR(16)) where [CollectionClassID] = @CCID

-- update [ARM_CORE]..[Workstream] set [Name] = [Name] + CAST(@WSID AS NVARCHAR(16)) where [WorkstreamID] = @WSID

insert [ARM_CORE]..[A_SlotStatusDefinition] ( [Label] ,[MapToCollectionID] ,[Deployed] ,[Failed] ,[RemoveFromSlot] ,[SQLTrigger] ,[WorkstreamID] ,[Order], [Logged] ) values ( 'Delete and Set to Targeted' , @TARGET_ID , 0 , 0 , 1 , NULL , @WSID , 700, 0)
insert [ARM_CORE]..[A_SlotStatusDefinition] ( [Label] ,[MapToCollectionID] ,[Deployed] ,[Failed] ,[RemoveFromSlot] ,[SQLTrigger] ,[WorkstreamID] ,[Order], [Logged] ) values ( 'Delete and Set to Engaged' , @CONFIRM_ID , 0 , 0 , 1 , NULL , @WSID , 800, 0)
insert [ARM_CORE]..[A_SlotStatusDefinition] ( [Label] ,[MapToCollectionID] ,[Deployed] ,[Failed] ,[RemoveFromSlot] ,[SQLTrigger] ,[WorkstreamID] ,[Order], [Logged] ) values ( 'Deployed' , @DEPLOYED_ID , 1 , 0 , 0 , NULL , @WSID , 300, 1)
insert [ARM_CORE]..[A_SlotStatusDefinition] ( [Label] ,[MapToCollectionID] ,[Deployed] ,[Failed] ,[RemoveFromSlot] ,[SQLTrigger] ,[WorkstreamID] ,[Order], [Logged] ) values ( 'No Show' , @CONFIRM_ID , 0 , 1 , 0 , NULL , @WSID , 400, 1)
insert [ARM_CORE]..[A_SlotStatusDefinition] ( [Label] ,[MapToCollectionID] ,[Deployed] ,[Failed] ,[RemoveFromSlot] ,[SQLTrigger] ,[WorkstreamID] ,[Order], [Logged] ) values ( 'Cancelled (Set to Engaged)' , @CONFIRM_ID , 0 , 1 , 0 , NULL , @WSID , 500, 0)
insert [ARM_CORE]..[A_SlotStatusDefinition] ( [Label] ,[MapToCollectionID] ,[Deployed] ,[Failed] ,[RemoveFromSlot] ,[SQLTrigger] ,[WorkstreamID] ,[Order], [Logged] ) values ( 'Cancelled (Set to Targeted)' , @TARGET_ID , 0 , 1 , 0 , NULL , @WSID , 550, 0)
insert [ARM_CORE]..[A_SlotStatusDefinition] ( [Label] ,[MapToCollectionID] ,[Deployed] ,[Failed] ,[RemoveFromSlot] ,[SQLTrigger] ,[WorkstreamID] ,[Order], [Logged] ) values ( 'Failed' , 0 , 0 , 1 , 0 , NULL , @WSID , 600, 0)
insert [ARM_CORE]..[A_SlotStatusDefinition] ( [Label] ,[MapToCollectionID] ,[Deployed] ,[Failed] ,[RemoveFromSlot] ,[SQLTrigger] ,[WorkstreamID] ,[Order], [Logged] ) values ( 'Received' , 0 , 0 , 0 , 0 , NULL , @WSID , 100, 0)
insert [ARM_CORE]..[A_SlotStatusDefinition] ( [Label] ,[MapToCollectionID] ,[Deployed] ,[Failed] ,[RemoveFromSlot] ,[SQLTrigger] ,[WorkstreamID] ,[Order], [Logged] ) values ( 'Delete and Remove from Workstream' , -1 , 0 , 0 , 1 , NULL , @WSID , 900, 0)

-- Create a Booking (no schedule) and Manual Channel

INSERT [ARM_CORE].[dbo].[ScheduleChannel] ([Name],[ShortName],[BgColour],[Bookable],[AssetType],[Mode],[Active],[WorkstreamID])
VALUES(	@WSname+' Laptops',UPPER(LEFT(@WSname,2)),'#777777',1,'Laptop','BOOKABLE',0,@WSID) 
Set @BOOKING_ID = SCOPE_IDENTITY();

INSERT [ARM_CORE].[dbo].[ScheduleChannel] ([Name],[ShortName],[BgColour],[Bookable],[AssetType],[Mode],[Active],[WorkstreamID])
VALUES(@WSname+' - Manual',UPPER(LEFT(@WSname,1))+'M','#997777',0,'ALL','MANUAL',1,@WSID) 

-- Set up supporting Autonotifications (NEED TO SPECIFY TEMPLATE IDS)

INSERT [ARM_CORE].[dbo].[AutoNotification] ( [Name],[Active],[AudienceFrom],[AudiencePropertyID],[DateProperty],[TraceLog],[Order],[TemplateID],[Throttle],[InActionAction]
      ,[InActionCollectionID],[Taskgroup],[ReadReceipt],[Important],[DayCountTriggers] )
VALUES(@WSname+' Booking Request',0,'Collection',@CONFIRM_ID,'Days After',1,1000,0,200,'',0,'PC Refresh',0,0,'0,3,7')
  
INSERT [ARM_CORE].[dbo].[AutoNotification] ( [Name],[Active],[AudienceFrom],[AudiencePropertyID],[DateProperty],[TraceLog],[Order],[TemplateID],[Throttle],[InActionAction]
      ,[InActionCollectionID],[Taskgroup],[ReadReceipt],[Important],[DayCountTriggers] )
VALUES(@WSname+' Booking Request MOVE',0,'Collection',@CONFIRM_ID,'Days After',1,1000,0,200,'Add to Collection',@NORESPONSE_ID,'PC Refresh',0,0,'10')

INSERT [ARM_CORE].[dbo].[AutoNotification] ( [Name],[Active],[AudienceFrom],[AudiencePropertyID],[DateProperty],[TraceLog],[Order],[TemplateID],[Throttle],[InActionAction]
      ,[InActionCollectionID],[Taskgroup],[ReadReceipt],[Important],[DayCountTriggers] )
VALUES(@WSname+' Reminder',0,'Schedule',@BOOKING_ID,'1',1,1000,0,-1,'',0,'PC Refresh',0,0,'0')

INSERT [ARM_CORE].[dbo].[AutoNotification] ( [Name],[Active],[AudienceFrom],[AudiencePropertyID],[DateProperty],[TraceLog],[Order],[TemplateID],[Throttle],[InActionAction]
      ,[InActionCollectionID],[Taskgroup],[ReadReceipt],[Important],[DayCountTriggers] )
VALUES(@WSname+' Support',0,'Collection',@DEPLOYED_ID,'Days After',1,1000,0,-1,'',0,'PC Refresh',0,0,'0')

--Return the result set of the table variable.
SELECT @WSID AS [NewWorkstreamID]
END


GO

CREATE PROCEDURE [dbo].[NewTimeTemplate]
    @TName nvarchar(255) = '',
	@TNote nvarchar(2000) = '',
	@CBuffer smallint = 2
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

--INSERT [ARM_CORE]..[ScheduleTimeTemplate](Name) OUTPUT INSERTED.RID INTO @MyTableVar VALUES (@TName);

INSERT [ARM_CORE]..[ScheduleTimeTemplate](Name,CloseBuffer,[Note]) VALUES (@TName, @CBuffer, @TNote);

--Return the result set of the table variable.
SELECT SCOPE_IDENTITY() AS [NewID]


 
END


GO

CREATE PROCEDURE [dbo].[NewSurvey]
    @Title nvarchar(MAX),
	@Author nvarchar(255) = NULL
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

DECLARE @KEY nvarchar(50);
Set @KEY = NewID();

insert into Survey([Title],[Published],[PublishedOn],[Active],[Key],[Auth_User]) values (@Title,1,getdate(),1,@KEY,@Author);

DECLARE @SID INT;
Set @SID = SCOPE_IDENTITY();


INSERT INTO [ARM_CORE]..[SurveyPQuestion] (QID,Question,Qorder,Active,[Type],[SID]) SELECT QID,Question,Qorder,Active,[Type],@SID FROM [ARM_CORE]..[SurveyEQuestion] where [Auth_User] = @Author

INSERT INTO [ARM_CORE]..[SurveyPScalar] (AID,QID,LeftLabel,RightLabel,[Range],[NA],[SID]) SELECT AID,QID,LeftLabel,RightLabel,[Range],[NA],@SID FROM [ARM_CORE]..[SurveyEScalar] where [Auth_User] = @Author
INSERT INTO [ARM_CORE]..[SurveyPOption] (AID,QID,OptionA,OptionB,OptionC,OptionD,OptionE,Other,[SID]) SELECT AID,QID,OptionA,OptionB,OptionC,OptionD,OptionE,Other,@SID FROM [ARM_CORE]..[SurveyEOption] where [Auth_User] = @Author
INSERT INTO [ARM_CORE]..[SurveyPText] (AID,QID,[Rows],[Cols],[SID]) SELECT AID,QID,[Rows],[Cols],@SID FROM [ARM_CORE]..[SurveyEText] where [Auth_User] = @Author

delete from [ARM_CORE]..[SurveyEQuestion] where [Auth_User] = @Author
delete from [ARM_CORE]..[SurveyEScalar] where [Auth_User] = @Author
delete from [ARM_CORE]..[SurveyEOption] where [Auth_User] = @Author
delete from [ARM_CORE]..[SurveyEText] where [Auth_User] = @Author


--Return the result set of the table variable.
SELECT @SID AS [NewID], @KEY AS [NewKEY]
END


GO
CREATE PROCEDURE [dbo].[NewQuestion]
    @Question nvarchar(MAX) ,
	@QType nvarchar(25) = '',
	@Author nvarchar(255) = NULL
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

insert into [ARM_CORE]..[SurveyEQuestion] (Question,Qorder,Type,[Auth_User]) values (@Question,IsNull((select max(Qorder)+1 from [ARM_CORE]..[SurveyEQuestion]),1),@QType,@Author);


--Return the result set of the table variable.
SELECT SCOPE_IDENTITY() AS [NewID]
END


GO
CREATE PROCEDURE [dbo].[NewNotificationTemplate]
       @Label  nvarchar(255)
AS
BEGIN
       -- SET NOCOUNT ON added to prevent extra result sets from
       -- interfering with SELECT statements.
       SET NOCOUNT ON;


DECLARE @CID INT;

insert into [ARM_CORE]..[Notificationtemplate] ([Label]) values (@Label)

Set @CID = SCOPE_IDENTITY();

--Return the result set of the table variable.
SELECT @CID AS [NewID]

END


GO
CREATE PROCEDURE [dbo].[NewIDBySQL]
	@TheSQL nvarchar(MAX)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

EXEC @TheSQL

DECLARE @NID INT;
Set @NID = SCOPE_IDENTITY();


--Return the result set of the table variable.
SELECT @NID AS [NewID]
END


GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[NewGauge]
	@GID_Title nvarchar(MAX),
	@GID_ValueSQL nvarchar(MAX),
	@GID_MaxSQL nvarchar(MAX),
	@GID_MinSQL nvarchar(MAX),
	@GID_Decimals int, 
	@GID_WidthScale real,
	@GID_CUS bit = 0,
	@GID_loColour nvarchar(MAX), 
	@GID_midColour nvarchar(MAX), 
	@GID_hiColour nvarchar(MAX),
	@GID_URL nvarchar(MAX),
	@GID_DESC nvarchar(MAX) = ''
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;


insert into [ARM_CORE]..[Gauge] (title,reference,valueSQL,MaxSQL,MinSQL,Decimals,WidthScale,Custom,loColour,midColour,hiColour,[ActionURL], [Description]) 
values (@GID_Title, '', @GID_ValueSQL, @GID_MaxSQL, @GID_MinSQL, @GID_Decimals, @GID_WidthScale,
        @GID_CUS, @GID_loColour, @GID_midColour, @GID_hiColour, @GID_URL, @GID_DESC ) 



DECLARE @GID INT;
Set @GID = SCOPE_IDENTITY();

insert into [ARM_CORE]..[GaugeLibrary] (GaugeID) values (@GID)

--Return the result set of the table variable.
SELECT @GID AS [NewGaugeID]
END


GO
CREATE PROCEDURE [dbo].[NewDashboardWidget]
       @DID  int
AS
BEGIN
       -- SET NOCOUNT ON added to prevent extra result sets from
       -- interfering with SELECT statements.
       SET NOCOUNT ON;
 
DECLARE @CID INT;
insert into [ARM_CORE]..[DashboardWidget] ([WidgetTitle]) values ('')
Set @CID = SCOPE_IDENTITY();
insert into [ARM_CORE]..[A_DashboardItem] (DashBoardID, itemID, ItemType, [Order], [Active]) values (@DID, @CID, 'DashboardWidget', 0, 0)
--Return the result set of the table variable.
SELECT @CID AS [NewID]
END


GO
CREATE PROCEDURE [dbo].[NewDashboardText]
	@DID  int
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;


DECLARE @CID INT;

insert into [ARM_CORE]..[DashboardText] ([Active]) values (0)

Set @CID = SCOPE_IDENTITY();

insert into [ARM_CORE]..[A_DashboardItem] (DashBoardID, itemID, ItemType, [Order], [Active]) values (@DID, @CID, 'DashboardText', 0, 0)

--Return the result set of the table variable.
SELECT @CID AS [NewID]
END


GO
CREATE PROCEDURE [dbo].[NewDashboardVenn]
	@DID  int,
	@Clone int = -1
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;


DECLARE @CID INT;

insert into [ARM_CORE]..[Venn] (VennTitle) values ('Venn Diagram')

Set @CID = SCOPE_IDENTITY();

insert into [ARM_CORE]..[A_DashboardItem] (DashBoardID, itemID, ItemType, [Order], [Active]) values (@DID, @CID, 'Venn', 0, 0)

--Return the result set of the table variable.

if NOT @Clone = -1 
BEGIN
	MERGE [ARM_CORE]..[Venn] AS Target
		USING (select n.VennID as NewVennID, c.VennID, 'C(' + convert(varchar(255),n.VennID) + ') ' + c.VennTitle as VennTitle, c.[Style], c.[Data],  c.[Height], c.[Width] from [ARM_CORE]..[Venn] n 
			LEFT JOIN [ARM_CORE]..[Venn] c on c.VennID = @Clone where n.VennID=@CID) As Source
		ON (Target.VennID = Source.NewVennID )
		WHEN MATCHED THEN
			UPDATE SET Target.VennTitle = Source.VennTitle, Target.[Style] = Source.[Style], Target.[Data] = Source.[Data], Target.[Width] = Source.[Width], Target.[Height] = Source.[Height];

END


SELECT @CID AS [NewID]
END


GO

CREATE PROCEDURE [dbo].[NewDashboardSection]
       @DID  int
AS
BEGIN
       -- SET NOCOUNT ON added to prevent extra result sets from
       -- interfering with SELECT statements.
       SET NOCOUNT ON;
 
DECLARE @CID INT;
insert into [ARM_CORE]..[DashboardSection] ([SectionTitle]) values (NULL)
Set @CID = SCOPE_IDENTITY();
insert into [ARM_CORE]..[A_DashboardItem] (DashBoardID, itemID, ItemType, [Order], [Active]) values (@DID, @CID, 'DASHBOARDSECTION', 0, 1)
--Return the result set of the table variable.
SELECT @CID AS [NewID]
END


GO
CREATE PROCEDURE [dbo].[NewDashboardFrame]
       @DID  int
AS
BEGIN
       -- SET NOCOUNT ON added to prevent extra result sets from
       -- interfering with SELECT statements.
       SET NOCOUNT ON;
 
DECLARE @CID INT;
insert into [ARM_CORE]..[DashboardFrame] ([Active]) values (0)
Set @CID = SCOPE_IDENTITY();
insert into [ARM_CORE]..[A_DashboardItem] (DashBoardID, itemID, ItemType, [Order], [Active],[Units], [Height]) values (@DID, @CID, 'DashboardFrame', 0, 0, 12,500)
--Return the result set of the table variable.
SELECT @CID AS [NewID]
END


GO
CREATE PROCEDURE [dbo].[NewDashboardGroup]
	@DID  int
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;


DECLARE @CID INT;

insert into [ARM_CORE]..[DashboardGroup] ([GroupTitle]) values ('')

Set @CID = SCOPE_IDENTITY();

insert into [ARM_CORE]..[A_DashboardItem] (DashBoardID, itemID, ItemType, [Order], [Active]) values (@DID, @CID, 'DashboardGroup', 0, 0)

--Return the result set of the table variable.
SELECT @CID AS [NewID]
END


GO
CREATE PROCEDURE [dbo].[NewDashboardFilter]
       @DID  int
AS
BEGIN
       -- SET NOCOUNT ON added to prevent extra result sets from
       -- interfering with SELECT statements.
       SET NOCOUNT ON;
 
DECLARE @CID INT;
insert into [ARM_CORE]..[DashboardFilter] ([Active]) values (0)
Set @CID = SCOPE_IDENTITY();
insert into [ARM_CORE]..[A_DashboardItem] (DashBoardID, itemID, ItemType, [Order], [Active]) values (@DID, @CID, 'DashboardFilter', 0, 0)
--Return the result set of the table variable.
SELECT @CID AS [NewID]
END


GO
CREATE PROCEDURE [dbo].[NewDashboardChart]
	@DID  int,
	@Clone int = -1
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;


DECLARE @CID INT;

insert into [ARM_CORE]..[Chart] ([Order], [Active]) values (0, 0)

Set @CID = @@IDENTITY;

insert into [ARM_CORE]..[A_DashboardItem] (DashBoardID, itemID, ItemType, [Order], [Active]) values (@DID, @CID, 'Chart', 0, 0)

--Return the result set of the table variable.

if NOT @Clone = -1 
BEGIN
	MERGE [ARM_CORE]..[Chart] AS Target
		USING (select n.ChartID as NewChartID, c.ChartID, 'C(' + convert(varchar(255),n.ChartID) + ') ' + c.ChartTitle as ChartTitle, c.[Type], c.[Data], c.[Options], c.[SQL], c.[URL], c.[Description], 0 as Active from [ARM_CORE]..[Chart] n 
			LEFT JOIN [ARM_CORE]..[Chart] c on c.ChartID = @Clone where n.ChartID=@CID) As Source
		ON (Target.ChartID = Source.NewChartID )
		WHEN MATCHED THEN
			UPDATE SET Target.[ChartTitle] = Source.[ChartTitle], Target.[Type] = Source.[Type], Target.[Data] = Source.[Data], Target.[Options] = Source.[Options], Target.[SQL] = Source.[SQL], Target.[URL] = Source.[URL], Target.[Description] = Source.[Description];

END


SELECT @CID AS [NewID]
END




GO

CREATE PROCEDURE [dbo].[NewBookmark]
        @Title	nvarchar(500) = 'Page',
		@Page	nvarchar(1000) = '#',
		@Who	nvarchar(1000) = '',
		@method nvarchar(10) = 'get',
		@Threshold int = 100
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
    SET NOCOUNT ON;

	DECLARE @BookmarkID INT;
	DECLARE @When datetime;

	DECLARE @LastPage nvarchar(500);
	DECLARE @LastID INT;

	set @When = getdate()

	set @LastPage = (select top 1 [Page] FROM [ARM_CORE]..[A_BookmarkBlock] where [Page] = @Page )
	
	if NOT @LastPage IS NULL
	BEGIN
		Select -1 as [NewBookmarkID]
	END
	Else
	BEGIN
		set @LastPage = (select top 1 [Page] FROM [ARM_CORE]..[Bookmarks] where [AUTH_USER] = @Who and [Sys] = 1 ORDER BY [When] DESC)

		insert into [ARM_CORE]..[Bookmarks]([Title], [Page], [AUTH_USER],[When],[Method], [Sys]) values (@Title, @Page, @Who, @When, @method,1)
		Set @BookmarkID = SCOPE_IDENTITY();


		DELETE [ARM_CORE]..[A_RequestCapture] 
		WHERE BookmarkID IN (SELECT BookmarkID 
				FROM [ARM_CORE]..[Bookmarks] WHERE datediff(hour,[When],getdate()) > 12 and [Sys] = 1 
			) 

		DELETE FROM [ARM_CORE]..[Bookmarks] 
		WHERE datediff(hour,[When],getdate()) > 12 and [Sys] = 1 


	
		SELECT @BookmarkID AS [NewBookmarkID]
	END
END


GO

-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Menu-Pivot]
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;


	SELECT distinct r.Name, m.menuID, m.Name as MenuName, m.URL, m.override, m.[Order] as MenuOrder, 1 as Permit  
	INTO #tempPivotTable
	from [ARM_CORE]..[A_Menu] m
	LEFT JOIN [ARM_CORE]..[A_MenuAccess] a on a.MenuID = m.MenuID 
	LEFT JOIN [ARM_CORE]..[A_Role] r on r.RoleID = a.RoleID 
	where IsNull(m.ParentID,0) = 0 and IsNull(m.Active,0) = 1



	DECLARE @Columns VARCHAR(MAX)

	SELECT @columns = STUFF(( SELECT TOP 100 PERCENT
									'],[' + cast(Name as varchar)
							FROM    [ARM_CORE]..[A_Role] AS t2
							ORDER BY Rank,'],[' + cast(Name as varchar)
							FOR XML PATH('')
						  ), 1, 2, '') + ']'


	DECLARE @query VARCHAR(8000)

	SET @query = '
	SELECT *
	FROM #tempPivotTable
	PIVOT
	(
	SUM(Permit)
	FOR [Name]
	IN (' + @columns + ')
	)
	AS p order by [MenuOrder], [MenuName]'


	EXECUTE(@query)


	DROP TABLE #tempPivotTable
END


GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[NewBookDay]
    @CID int ,
	@TheDate nvarchar(255) = ''
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	--INSERT [ARM_CORE]..[ScheduleTimeTemplate](Name) OUTPUT INSERTED.RID INTO @MyTableVar VALUES (@TName);

	Declare @BID as Int;
	Declare @DID as Int;

	-- first check to make sure run doesnt already exist
	set @BID = -1

	select @DID = RunID from [ARM_CORE]..[ScheduleDeployRun] where CHannelID = @CID and RunDate = @TheDate

	select @DID = IsNull(@DID,-1)

	if @DID = -1 
	BEGIN

		Insert [ARM_CORE]..[ScheduleDeployRun] (ChannelID, RunDate, SlotID, Label) VALUES (@CID, @TheDate, (select top 1 SlotID from [ARM_CORE]..[ScheduleSlot] where [Date] = @TheDate), 
			'BOOKED-'+(select Name from [ARM_CORE]..[ScheduleChannel] where ChannelID=@CID)+'-'+@TheDate );

		set @DID = SCOPE_IDENTITY()

		INSERT [ARM_CORE]..[ScheduleBookDay](ChannelID, TheDate, RunID) VALUES (@CID, @TheDate, @DID);

		set @BID = SCOPE_IDENTITY()

		update [ARM_CORE]..[ScheduleDeployRun] set BID = @BID where RunID = @DID


	END

	--Return the result set of the table variable.
	SELECT @BID AS [NewID]

END


GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[IndexTermCounters]
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

select  t.[LABEL], count(distinct a.ApplicationID) from [ARM_CORE]..Application a, ARM_DSL..IndexTerm t 
where a.ApplicationID like t.[Term] Group By t.[Label]
END




GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	Given any date, get the next unprotected SlotID in direction specified. direction = 1 (future), direction = 0 (past)
-- =============================================
CREATE PROCEDURE [dbo].[GetShiftSlots]
	@ChannelID Int = 0,
    @FromDate Date = NULL,
    @ToDate Date = NULL
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	
	SET NOCOUNT ON;

	select d.RunID, d.SLotID, d.Status, d.RunDate, d.Label, CONVERT(date,GetDate()-1) AS yesterday
	from [ARM_CORE]..[ScheduleDeployRun] d LEFT JOIN [ARM_CORE]..[ScheduleSlot] s ON s.SlotID = d.SlotID
	where 
		s.[Date] > convert(date,COALESCE( @FromDate, ISNULL(@FromDate, GETDATE()))) 
		and s.[Date] <= convert(date,COALESCE( @ToDate, ISNULL(@ToDate, GETDATE()+365))) 
		and s.[FixedPoint] = 0 and d.[FixedPoint] = 0 
		and d.[ChannelID] = @ChannelID
	ORDER BY s.[Date] Asc
	
						
END





GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	Given any date, get the next unprotected SlotID in direction specified. direction = 1 (future), direction = 0 (past)
-- =============================================
CREATE PROCEDURE [dbo].[GetNextShiftSlot]
	@currentDate Date = NULL,
    @direction Int = 1
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	
	SET NOCOUNT ON;

	if @direction = 1 
	BEGIN
		SELECT top 1 s.[SlotID], s.[Date]
		from [ARM_CORE]..[ScheduleSlot] s
		where s.[Date] > convert(date,COALESCE( @currentDate, ISNULL(@currentDate, GETDATE()))) 
			and s.[FixedPoint] = 0
		ORDER BY s.[Date] Asc
	END
	else
	BEGIN
		SELECT top 1 s.[SlotID], s.[Date]
		from [ARM_CORE]..[ScheduleSlot] s
		where s.[Date] < convert(date,COALESCE( @currentDate, ISNULL(@currentDate, GETDATE())))
			and s.[FixedPoint] = 0
		ORDER BY s.[Date] Desc
	END
	
						
END









GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[GetModelCodes]
	-- Add the parameters for the stored procedure here

AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
select a.AssetID, a.Model, t.[Model], m.Model_Code,  m.Model_Label, l.model_label
from [ARM_CORE]..[Asset] a 
LEFT JOIN [ARM_CORE]..[A_ModelCode] m on a.Model like m.Model_Code 
LEFT JOIN (
	select distinct model_label from [ARM_CORE]..[A_ModelCode] 
) as l on l.model_label = a.Model
LEFT JOIN [ARM_CORE]..[TMP_RAW_2012ArmDataFeed] t on t.ComputerName = a.AssetID
where  l.model_label IS NULL and NOT a.Model IS NULL


END

GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[GetDeployedAssets]
	@window int = -7,
	@ReferenceDate varchar(10) = ''

AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

DECLARE @d DATE

if @ReferenceDate = ''
	set @d = getdate();
else
	set @d = cast(@ReferenceDate AS date); 

Select a.AssetID, a.[Model], c.Name as [Booking Channel], s.RunDate as [Scheduled For], IsNull(a.UserID, u.userID) as UserID, a.Owner, a.Email, st.EngDeployedDate as 'Marked as Deployed On'
 from [ARM_CORE]..[AssetStatus] st 
 LEFT Join [ARM_CORE]..[Asset] a on a.AssetID = st.AssetID 
 LEFT Join [ARM_CORE]..[ScheduleDeployRunAsset] r on r.AssetID = st.AssetID 
 LEFT Join [ARM_CORE]..[ScheduleDeployRun] s on s.RunID = r.RunID
 LEFT Join [ARM_CORE]..[ScheduleChannel] c on c.ChannelID = s.ChannelID
 LEFT JOIN [ARM_CORE]..[User] u on u.[Email] = a.[Email]
 Where  NOT a.AssetID IS NULL and st.EngDeployed = 1 and st.[EngDeployedDate] >= convert(varchar(10),DATEADD(day,@window,@d),20) and st.[EngDeployedDate] < convert(varchar(10),DATEADD(day,0,@d),20)
 Order by s.RunDate, c.Name, r.AssetID, Owner, Email


END





GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[GetCSATScore]
@KEY nvarchar(50)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

		select RES.Question, cast(RES.Total as float) / cast(RES.r as float) as [Average],
	 			(select Cast(SUM(convert(Integer,ra.[VALUE]) * p.Weight) As float) / CAST( Sum(p.[Weight]) as float) 
				 from [ARM_CORE]..[Survey] s 
				 LEFT JOIN [ARM_CORE]..[SurveyResponse] r on r.SID = s.SID 
				 LEFT JOIN [ARM_CORE]..[SurveyResponseAnswers] ra on ra.RID = r.RID 
				 LEFT JOIN [ARM_CORE]..[SurveyPGrid] p on p.QID = ra.QID 
				 LEFT JOIN [ARM_CORE]..[SurveyPQuestion] q on q.QID = p.QID
				 where s.[KEY] = @KEY 
				) as [Overall Score]
		from (
			select IsNull(ra.QID,0) AS QID, q.Question, Count(ra.RID) as r, SUM(convert(Integer,ra.[VALUE]))  as Total, SUM(convert(Integer,ra.[VALUE]) * p.Weight) As Weighted, p.[Weight]
									 from [ARM_CORE]..[Survey] s 
									 LEFT JOIN [ARM_CORE]..[SurveyResponse] r on r.SID = s.SID 
									 LEFT JOIN [ARM_CORE]..[SurveyResponseAnswers] ra on ra.RID = r.RID 
									 LEFT JOIN [ARM_CORE]..[SurveyPGrid] p on p.QID = ra.QID 
									 LEFT JOIN [ARM_CORE]..[SurveyPQuestion] q on q.QID = p.QID
									 where s.[KEY] = @KEY 
									 Group By ra.QID, q.Question, p.Weight
		) as RES	
END

GO
-- =============================================
-- Author:		John Reed
-- ALTER date: <ALTER Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[GetChannelBookDaysRemaining-test]
	@AssetType nvarchar(50) = 'ALL',
	@AssetID nvarchar(255) = ''
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
	select * from (
		select c.ChannelID, w.[name] as WorkstreamName, c.[name], c.[Mode], Count(BookDaysLeft.TheDate) as DaysLeft
		from [ARM_CORE]..[ScheduleChannel] c  
		LEFT JOIN (
			Select distinct ch.ChannelID,  BookDays.TheDate
			from [ARM_CORE]..[ScheduleChannel] ch 
			LEFT JOIN (
					select bb.ChannelID, bb.TheDate, tt.TID, tt.MaxBooking, Count(bg.AssetID) as Booked, cc.WorkstreamID
					from [ARM_CORE]..[ScheduleChannel] cc 
					LEFT JOIN [ARM_CORE]..[ScheduleBookDay] bb on bb.ChannelID = cc.ChannelID
					LEFT JOIN [ARM_CORE]..[ScheduleTimeSlot] tt on tt.BID = bb.BID 
					LEFT JOIN [ARM_CORE]..[ScheduleBooking] bg on bg.TID = tt.TID
					where tt.Active = 1 and bb.Active = 1  
					and bb.TheDate >= convert(date,dateadd(day,IsNull(bb.closeBuffer,0),getdate()))
					Group By tt.TID, bb.ChannelID, bb.TheDate, tt.MaxBooking, cc.WorkstreamID
			) As BookDays  on BookDays.ChannelID = ch.ChannelID and BookDays.MaxBooking > BookDays.Booked
			LEFT JOIN [ARM_CORE]..[Workstream] w on w.WorkstreamID = ch.WorkstreamID
			LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionClassID = w.[KeyStatusID]
			LEFT JOIN [ARM_CORE]..[A_CollectionItem] i on i.CollectionID = c.CollectionID 
			LEFT JOIN [ARM_CORE]..[A_CollectionItem] j on j.CollectionID = ch.AdditionalCollectionID and j.ItemID = @AssetID
			where 
				Bookable = 1  and NOT BookDays.ChannelID IS NULL and w.Active = 1
				and ( 
					(i.ItemID = @AssetID and IsNull(w.ClosedList,0) = 1 and i.CollectionID NOT in (w.TargettedID, w.DeferredID) and IsNull(ch.QualifyingCollectionID,0) = 0) 
				or	(i.ItemID = @AssetID and IsNull(w.ClosedList,0) = 1 and IsNull(ch.QualifyingCollectionID,0) = i.CollectionID and ( IsNull(ch.AdditionalCollectionID,0) = 0 or NOT j.CollectionID IS NULL))
				or	(IsNull(w.ClosedList,0) = 0 )
				or	(@assetID = '')
				)

							Group By ch.ChannelID, BookDays.TheDate
		) AS BookDaysLeft on BookDaysLeft.ChannelID = c.ChannelID and NOT BookDaysLeft.ChannelID IS NULL
		LEFT JOIN [ARM_CORE]..[WorkStream] w on w.WorkstreamID = c.WorkstreamID
		where IsNull(c.[Active],0) = 1 and IsNull(w.[Active],0) = 1 and  (c.AssetType = @AssetType or c.AssetType = 'ALL')
		Group By w.[name],c.ChannelID, c.[Mode], c.name
	) as WS 
	where (WS.DaysLeft > 0 or WS.Mode = 'REGISTRATION') 

END




GO
-- =============================================
-- Author:		John Reed
-- ALTER date: <ALTER Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[GetChannelBookDaysRemaining-old]
	@AssetType nvarchar(50) = 'ALL'
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
select * from 
(select c.ChannelID, c.name, c.[Mode], Count(BookDaysLeft.TheDate) as DaysLeft
from [ARM_CORE]..[ScheduleChannel] c  
LEFT JOIN (
	Select distinct ch.ChannelID,  BookDays.TheDate
	from [ARM_CORE]..[ScheduleChannel] ch 
	LEFT JOIN (
				select bb.ChannelID, bb.TheDate, tt.TID, tt.MaxBooking, Count(bg.AssetID) as Booked
				from [ARM_CORE]..[ScheduleChannel] cc 
				LEFT JOIN [ARM_CORE]..[ScheduleBookDay] bb on bb.ChannelID = cc.ChannelID
				LEFT JOIN [ARM_CORE]..[ScheduleTimeSlot] tt on tt.BID = bb.BID 
				LEFT JOIN [ARM_CORE]..[ScheduleBooking] bg on bg.TID = tt.TID
				where tt.Active = 1 and bb.Active = 1  
				and bb.TheDate > dateadd(day,IsNull(bb.closeBuffer,0),getdate())  
				Group By tt.TID, bb.ChannelID, bb.TheDate, tt.MaxBooking
	) As BookDays  on BookDays.ChannelID = ch.ChannelID and BookDays.MaxBooking > BookDays.Booked
	where Bookable = 1  and NOT BookDays.ChannelID IS NULL
	Group By ch.ChannelID, BookDays.TheDate
) AS BookDaysLeft on BookDaysLeft.ChannelID = c.ChannelID and NOT BookDaysLeft.ChannelID IS NULL
where IsNull(c.[Active],0) = 1 and  (c.AssetType = @AssetType or c.AssetType = 'ALL')
Group By c.ChannelID, c.[Mode], c.name
) as WS 
where WS.DaysLeft > 0 or WS.Mode = 'REGISTRATION'

END


GO
-- =============================================
-- Author:		John Reed
-- ALTER date: <ALTER Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[GetChannelBookDaysRemaining2]
	@AssetType nvarchar(50) = 'ALL',
	@AssetID nvarchar(255) = ''
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
select * from 
(select c.ChannelID, c.name, c.[Mode], Count(BookDaysLeft.TheDate) as DaysLeft
from [ARM_CORE]..[ScheduleChannel] c  
LEFT JOIN (
	Select distinct ch.ChannelID,  BookDays.TheDate
	from [ARM_CORE]..[ScheduleChannel] ch 
	LEFT JOIN (
				select bb.ChannelID, bb.TheDate, tt.TID, tt.MaxBooking, Count(bg.AssetID) as Booked, cc.WorkstreamID
				from [ARM_CORE]..[ScheduleChannel] cc 
				LEFT JOIN [ARM_CORE]..[ScheduleBookDay] bb on bb.ChannelID = cc.ChannelID
				LEFT JOIN [ARM_CORE]..[ScheduleTimeSlot] tt on tt.BID = bb.BID 
				LEFT JOIN [ARM_CORE]..[ScheduleBooking] bg on bg.TID = tt.TID
				where tt.Active = 1 and bb.Active = 1  
				and bb.TheDate > dateadd(day,IsNull(bb.closeBuffer,0),getdate())  
				Group By tt.TID, bb.ChannelID, bb.TheDate, tt.MaxBooking, cc.WorkstreamID
	) As BookDays  on BookDays.ChannelID = ch.ChannelID and BookDays.MaxBooking > BookDays.Booked
	where Bookable = 1  and NOT BookDays.ChannelID IS NULL and BookDays.WorkstreamID in (
		select distinct w.WorkstreamID from [ARM_CORE]..[Workstream] w LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionClassID = w.[KeyStatusID]
		LEFT JOIN [ARM_CORE]..[A_CollectionItem] i on i.CollectionID = c.CollectionID where  ((i.ItemID = @AssetID and IsNull(w.ClosedList,0) = 1) or IsNull(w.ClosedList,0) = 0) or @assetID = ''
		)
	Group By ch.ChannelID, BookDays.TheDate
) AS BookDaysLeft on BookDaysLeft.ChannelID = c.ChannelID and NOT BookDaysLeft.ChannelID IS NULL
where IsNull(c.[Active],0) = 1 and  (c.AssetType = @AssetType or c.AssetType = 'ALL')
Group By c.ChannelID, c.[Mode], c.name
) as WS 
	where (WS.DaysLeft > 0 or WS.Mode = 'REGISTRATION') 

END


GO
-- =============================================
-- Author:		John Reed
-- ALTER date: <ALTER Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[GetChannelBookDaysRemaining]
	@AssetType nvarchar(50) = 'ALL',
	@AssetID nvarchar(255) = ''
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
	select WS.*, qi.ItemID from (
		select c.ChannelID, w.[name] as WorkstreamName, c.[name], c.[Mode], Count(BookDaysLeft.TheDate) as DaysLeft, c.QualifyingCollectionID, c.AdditionalCollectionID
		from [ARM_CORE]..[ScheduleChannel] c  
		LEFT JOIN (
			Select distinct ch.ChannelID,  BookDays.TheDate
			from [ARM_CORE]..[ScheduleChannel] ch 
			LEFT JOIN (
					select bb.ChannelID, bb.TheDate, tt.TID, tt.MaxBooking, Count(bg.AssetID) as Booked, cc.WorkstreamID
					from [ARM_CORE]..[ScheduleChannel] cc 
					LEFT JOIN [ARM_CORE]..[ScheduleBookDay] bb on bb.ChannelID = cc.ChannelID
					LEFT JOIN [ARM_CORE]..[ScheduleTimeSlot] tt on tt.BID = bb.BID 
					LEFT JOIN [ARM_CORE]..[ScheduleBooking] bg on bg.TID = tt.TID
					where tt.Active = 1 and bb.Active = 1  
					and bb.TheDate >= convert(date,dateadd(day,IsNull(bb.closeBuffer,0),getdate()))
					Group By tt.TID, bb.ChannelID, bb.TheDate, tt.MaxBooking, cc.WorkstreamID
			) As BookDays  on BookDays.ChannelID = ch.ChannelID and BookDays.MaxBooking > BookDays.Booked
			LEFT JOIN [ARM_CORE]..[Workstream] w on w.WorkstreamID = ch.WorkstreamID
			LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionClassID = w.[KeyStatusID]
			LEFT JOIN [ARM_CORE]..[A_CollectionItem] i on i.CollectionID = c.CollectionID 
			LEFT JOIN [ARM_CORE]..[A_CollectionItem] j on j.CollectionID = ch.AdditionalCollectionID and j.ItemID = @AssetID
			where 
				Bookable = 1  and NOT BookDays.ChannelID IS NULL and w.Active = 1
				and ( 
					(i.ItemID = @AssetID and IsNull(w.ClosedList,0) = 1 and i.CollectionID NOT in (w.TargettedID, w.DeferredID) and IsNull(ch.QualifyingCollectionID,0) = 0) 
				or	(i.ItemID = @AssetID and IsNull(w.ClosedList,0) = 1 and IsNull(ch.QualifyingCollectionID,0) = i.CollectionID and ( IsNull(ch.AdditionalCollectionID,0) = 0 or NOT j.CollectionID IS NULL))
				or	(IsNull(w.ClosedList,0) = 0 )
				or	(@assetID = '')
				)

							Group By ch.ChannelID, BookDays.TheDate
		) AS BookDaysLeft on BookDaysLeft.ChannelID = c.ChannelID and NOT BookDaysLeft.ChannelID IS NULL
		LEFT JOIN [ARM_CORE]..[WorkStream] w on w.WorkstreamID = c.WorkstreamID
		where IsNull(c.[Active],0) = 1 and IsNull(w.[Active],0) = 1 and  (c.AssetType = @AssetType or c.AssetType = 'ALL')
		Group By w.[name],c.ChannelID, c.[Mode], c.name, c.QualifyingCollectionID, c.AdditionalCollectionID
	) as WS 
	LEFT JOIN [ARM_CORE]..[A_CollectionItem] qi on qi.CollectionID = WS.QualifyingCollectionID and qi.ItemID = @AssetID
	LEFT JOIN [ARM_CORE]..[A_CollectionItem] ai on ai.CollectionID = WS.AdditionalCollectionID and ai.ItemID = @AssetID
	where (WS.DaysLeft > 0 or 
			(WS.Mode = 'REGISTRATION'  
	
			and  
				(
					(IsNull(WS.QualifyingCollectionID,0) = 0 and IsNull(WS.AdditionalCollectionID,0) = 0)
				 or	(NOT qi.ItemID IS NULL and IsNull(WS.AdditionalCollectionID,0) = 0) 
				 or (NOT ai.ItemID IS NULL and IsNull(WS.QualifyingCollectionID,0) = 0) 
				 or (NOT qi.ItemID IS NULL and NOT ai.ItemID IS NULL)
				)
			)
		)
END




GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[GetBitAttributes]
	@BitValue as bigint = 0,
	@Table as nvarchar(255) = 'Asset',
	@Field as nvarchar(255) = ''

AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	if @Field <> ''  set @Field = ' and [Field] = ''' + @Field + ''''

	declare @fetch as nvarchar(1000);

	set @fetch = 'select Attribute, GroupName from [ARM_CORE]..[A_BitCondition] where IsNull(Active,0) = 1 and [Table] = ''' + @Table + ''' and (convert(BigInt,' + convert(nvarchar(1000),@BitValue) + ') & Power(convert(BigInt,2),BitPosition -1) > 0) ' + @Field + ' order by [Order]'

	EXECUTE( @fetch )
END

GO






-- =============================================
-- Author:		<Andy Bex>
-- alter date: <17/2/16>
-- Description:	<Transform for the Asset table>
-- =============================================
CREATE PROCEDURE [dbo].[ExtractorTransform] 

AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

-- PreReqs for this procedure are
--		TMP_RAW_Extractor

-- Steps
--		1. Empty Asset table
--		2. Insert data from RAW
--		3. Write useful data to main tables


--		1. Empty Asset table
		Delete from CustomExtractor;
		
--		2. Insert data from RAW
		INSERT INTO CustomExtractor (AssetID,Company,alterd,Department,ExistsInSCCM,FirstName,[Format],FreeSpaceC,FreeSpaceD,InstallRAM,Kekyboard,[Language],LastLogon,LastName,Link,Mail, Model, MostFrequentUser,MultiUserID, MultiUserName, OS,OU, PrimaryUserCount,RefDate,Serial,TotalSpaceC,TotalSpaceD,Usage,UsedOnC,UsedOnD, Telephone,Title, [Type])
		Select substring(e.Stations,CHARINDEX('\',e.Stations)+1,100) ,e.Company, e.[Creation date],e.[Department no],e.[Exists in SCCM],e.[First name], e.[Format],e.[Free space on C],e.[Free space on D],e.[Installed RAM],e.Keyboard,e.[Language],e.[Last logon1],e.[Last name],e.[Link IAO], e.Mail,e.Model1, substring(e.[Most freq user] ,CHARINDEX('\',e.[Most freq user])+1,100),e.userid,e.name,e.[Operating system1], e.[OU Site1],e.[Nb primary users], e.[Ref date],e.Serial,e.[Total space on C],e.[Total space on D],e.Usage1, e.[used on C], e.[used on D], e.Telephone, e.Title, e.Type1
		FROM TMP_RAW_Extractor as E
		where e.[OU Site1] = 'NMUK' or e.[OU Site1] = 'NBMUK';

--		3.Write useful data to main tables
--		Update LastUser to MostFrequentUser
		UPDATE asset 
		SET asset.UserID = CustomExtractor.MostFrequentUser
		FROM asset
		INNER JOIN CustomExtractor ON asset.assetid = CustomExtractor.AssetID 
		WHERE
		asset.UserID != CustomExtractor.MostFrequentUser or 
		(CustomExtractor.MostFrequentUser is not null and asset.UserID is null);

		update asset
		set 
			asset.live = 1,
			asset.SerialNumber = CustomExtractor.Serial
		FROM Asset INNER JOIN CustomExtractor ON Asset.AssetID = CustomExtractor.AssetID
		WHERE Asset.Live=0;


END


GO
-- =============================================
-- Author:             <Author,,Name>
-- ALTER date: <ALTER Date,,>
-- Description:        <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[DeleteWorkstream]
        @WSID int = 0
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
        SET NOCOUNT ON;
DECLARE @CCID INT;
DECLARE @TARGET_ID INT;
DECLARE @CONFIRM_ID INT;
DECLARE @NORESPONSE_ID INT;
DECLARE @SCHED_ID INT;
DECLARE @DEPLOYED_ID INT;
DECLARE @DEF_ID INT;
DECLARE @NOTLIVE_ID INT;

DECLARE @BOOKING_ID INT;
 

select @CCID = [KeyStatusID], @TARGET_ID = [TargettedID], @CONFIRM_ID = [ConfirmedID], @NORESPONSE_ID = [NoResponseID], 
	@SCHED_ID = [ScheduledID], @DEPLOYED_ID = [DeployedID], @DEF_ID = [DeferredID], @NOTLIVE_ID = [NotLiveID]
	FROM [ARM_CORE]..[Workstream]
	where [WorkstreamID] = @WSID

delete from [ARM_CORE]..[A_CollectionItem] where [CollectionID] in (@TARGET_ID, @CONFIRM_ID, @NORESPONSE_ID, @NORESPONSE_ID, @SCHED_ID, @DEPLOYED_ID, @DEF_ID, @NOTLIVE_ID)
delete from [ARM_CORE]..[A_Collection] where [CollectionClassID] = @CCID
delete from [ARM_CORE]..[A_CollectionClass] where [CollectionClassID] = @CCID

delete from [ARM_CORE]..[A_SlotStatusDefinition] where [WorkstreamID] = @WSID
delete from [ARM_CORE]..[A_WorkStreamACL] where [WorkstreamID] = @WSID

Update [ARM_CORE].[dbo].[ScheduleChannel] set [Active] = 0 
where [WorkstreamID] = @WSID


Update [ARM_CORE].[dbo].[AutoNotification] set [Active] = 0 
where 
	(NOT [AudiencePropertyID] IS NULL and [AudiencePropertyID] in (@TARGET_ID, @CONFIRM_ID, @NORESPONSE_ID, @NORESPONSE_ID, @SCHED_ID, @DEPLOYED_ID, @DEF_ID, @NOTLIVE_ID))
  or
	(NOT [InActionCollectionID] IS NULL and [InActionCollectionID] in (@TARGET_ID, @CONFIRM_ID, @NORESPONSE_ID, @NORESPONSE_ID, @SCHED_ID, @DEPLOYED_ID, @DEF_ID, @NOTLIVE_ID))
  

DELETE from [ARM_CORE]..[Workstream] where [WorkstreamID] = @WSID



END
 
 
/****** Object:  StoredProcedure [dbo].[Apps-Collections]    Script Date: 17/09/2018 21:38:07 ******/
SET ANSI_NULLS ON

GO
CREATE PROCEDURE [dbo].[CUSTOM-App-Closer]
	@BArea as nvarchar(255) = 'NOTHING'
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	select distinct APP.AppKey, i.[LocalID] as [AppCode] , CASE 
				WHEN NOT fs.AppID IS NULL 
				   THEN 1 
				   ELSE 0 
				END as DAL, i.DeployType as DType, 
			IsNull(i.[Ready],0) as Ready, IsNull(lu.[Label],'*') AS [RAG], Count(a.AssetID) Installs
	from [ARM_CORE]..AppAstToBe s 
		LEFT JOIN [ARM_CORE]..[Asset] a on a.AssetID = s.AssetID
		LEFT JOIN [ARM_CORE]..[Application] i on i.[ApplicationID] = s.[ApplicationID]  
		LEFT JOIN [ARM_CORE]..[Asset] t on t.AssetID = s.AssetID 
		LEFT JOIN [ARM_CORE]..[A_Lookup] lu ON lu.[Table] = 'Internal' 
		LEFT JOIN [ARMS]..[ApplicationFlags] fs on fs.AppID = s.[ApplicationID]  
		LEFT JOIN [ARMS]..[ApplicationFlag] f on f.FlagID = fs.FlagID and f.Name = 'ON DAL'
		LEFT JOIN (
			select distinct IsNull(s.ApplicationID,'') as [AppKey]
				 from [ARM_CORE]..AppAstToBe s 
				 LEFT JOIN [ARM_CORE]..[Asset] t on t.AssetID = s.AssetID 
				 where t.[BArea] = @BArea and t.AssetID like '%[AM][0123456789][0123456789][0123456789]' and IsNull(s.ApplicationID,'') <> ''
		) as APP on APP.AppKey = s.ApplicationID
	where a.[BArea] = @BArea and s.AssetID like '%[AM][0123456789][0123456789][0123456789]' and IsNull(APP.AppKey,'') <> ''
	group by App.[AppKey], i.[LocalID], fs.AppID, i.DeployType, Ready, lu.[Label]
END






GO
-- ============================================================================
-- Author:		John Reed
-- alter date: 15/07/2016
-- Description:	Generates a grid of counters as determined by Asset 'Status' values.
-- ============================================================================
CREATE PROCEDURE [dbo].[Console-Status3]
@OU AS nvarchar(500) = '',
@Target AS int = 0,
@BArea AS nvarchar(255) = '[Undefined]'
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

		DECLARE @tSQL nvarchar(max);
		DECLARE @tHEADERS nvarchar(max);
		DECLARE @vHEADERS nvarchar(max);
		DECLARE @tJOINS nvarchar(max);
		DECLARE @tSTATUS nvarchar(max);
		DECLARE @TargetLabel nvarchar(20);
		DECLARE @BAreaWhere nvarchar(max);


		SET @tHEADERS = ' b.BArea, (select count(a.AssetID) from [ARM_CORE]..[Asset] a where a.BArea=b.BArea and IsNull(a.[OU],'''') like ''' + @OU + ''') as BAreaTotal ';
		SET @tSQL = '';
		SET @TargetLabel = '';
		SET @BAreaWhere = '';

		DECLARE Status_Cursor CURSOR FOR SELECT [Lookup]  FROM [ARM_CORE].[dbo].[A_LookUp] where [Table] = 'Asset' and [Column] = 'Status' Order By [Order];

		OPEN Status_Cursor;

		FETCH NEXT FROM Status_Cursor INTO @tSTATUS;


		IF @BArea <> '[Undefined]' SET @BAreaWhere = ' where  b.BArea = ''' + @BArea + ''' '


		WHILE @@FETCH_STATUS = 0
			BEGIN
				SET @tHEADERS = @tHEADERS + ',(select count(a.AssetID) from [ARM_CORE]..[Asset] a where a.Status = ' + @tSTATUS + ' and a.BArea=b.BArea and IsNull(a.[OU],'''') like ''' + @OU + ''') as [' + @tStatus +'] '

				FETCH NEXT FROM Status_Cursor INTO @tSTATUS;
			END;
		CLOSE Status_Cursor;
		DEALLOCATE Status_Cursor;

		SET @tSQL = ' select distinct ' + @tHEADERS + ', (select count(a.AssetID) from [ARM_CORE]..[Asset] a where IsNull(a.Status,'''') = '''' and a.BArea=b.BArea and IsNull(a.[OU],'''') like ''' + @OU + ''') [undefined]';
		SET @tSQL = @tSQL + ' from [ARM_CORE]..[BArea] b ' + @BAreaWhere + ' Order by b.BArea ' 
		
 		EXECUTE (@tSQL);

END





GO
-- ============================================================================
-- Author:		John Reed
-- ALTER date: 15/07/2016
-- Description:	Generates a grid of counters as determined by Asset 'Status' values.
-- ============================================================================
CREATE PROCEDURE [dbo].[Console-Status2]
@OU AS nvarchar(500) = '',
@Target AS int = -1,
@BArea AS nvarchar(255) = '[Undefined]',
@LifeCycle AS nvarchar(255) = '%',
@Collections AS nvarchar(500) = ''
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

		DECLARE @tSQL nvarchar(max);
		DECLARE @tHEADERS nvarchar(max);
		DECLARE @vHEADERS nvarchar(max);
		DECLARE @tJOINS nvarchar(max);
		DECLARE @tSTATUS nvarchar(max);
		DECLARE @TargetLabel nvarchar(20);
		DECLARE @BAreaWhere nvarchar(max);
		DECLARE @TargetOn nvarchar(max) = '';
		DECLARE @ColFilter nvarchar(max) = '';
		DECLARE @ColJoin nvarchar(max) = '';
		DECLARE @fC int = 0; 
		DECLARE @Label nvarchar(20) = '';

		if @Collections <> '' 
		BEGIN
			DECLARE @CID nvarchar(max);
			DECLARE Collection_Cursor CURSOR FOR select distinct f.CollectionID as FlagID from [ARM_CORE]..[A_Collection] f RIGHT JOIN [dbo].SplitOrderIDs(2) As s ON f.CollectionID = s.OrderID where NOT CollectionID IS NULL;




			OPEN Collection_Cursor;	

			FETCH NEXT FROM Collection_Cursor INTO @CID;
			WHILE @@FETCH_STATUS = 0
			BEGIN

				SET @fC = @fC + 1
				SET @Label = 'f' + CAST(@fC AS VARCHAR(10))
				SET @ColJoin = @ColJoin + ' LEFT JOIN [ARM_CORE]..[A_CollectionItem] ' + @Label + ' on ' + @Label + '.ItemID = a.AssetID and ' + @Label + '.CollectionID = ' + @CID 


				IF @ColFilter = '' 
					SET @ColFilter = '( NOT ' + @Label + '.ItemID IS NULL ' 
				ELSE
					SET @ColFilter = @ColFilter + ' and NOT ' + @Label + '.ItemID IS NULL ' 


				FETCH NEXT FROM Collection_Cursor INTO @CID;
			END;

		   if @ColFilter <> '' SET @ColFilter = @ColFilter + ') and '
			

			CLOSE Collection_Cursor;
			DEALLOCATE Collection_Cursor;


		END



-- LEFT JOIN [ARMS].[dbo].[AssetFlags] f on f.AssetID = a.AssetID where (f.FlagID = 1009 or f.FlagID = 1005) and NOT f.AssetID is NULL and 

		SET @tHEADERS = ' b.BArea, (select count(a.AssetID) from [ARM_CORE]..[Asset] a where a.BArea=b.BArea and IsNull(a.[OU],'''') like ''' + @OU + ''') as BAreaTotal ';
		SET @tSQL = '';
		SET @TargetLabel = '';
		SET @BAreaWhere = '';

		DECLARE Status_Cursor CURSOR FOR SELECT [Lookup]  FROM [ARM_CORE].[dbo].[A_LookUp] where [Table] = 'Asset' and [Column] = 'Status' Order By [Order];

		OPEN Status_Cursor;

		FETCH NEXT FROM Status_Cursor INTO @tSTATUS;


		IF @BArea <> '[Undefined]' SET @BAreaWhere = ' where  b.BArea like ''' + replace(@BArea,'[','![') + ''' Escape ''!'' ' 

		IF @Target = 1 SET @TargetOn = ' and a.Target = 1 '
		IF @Target = 0 SET @TargetOn = ' and a.Target = 0 '

		IF @LifeCycle = '' SET @LifeCycle = '%'
		IF @LifeCycle = 'All' SET @LifeCycle = '%'


		WHILE @@FETCH_STATUS = 0
			BEGIN
				SET @tHEADERS = @tHEADERS + ',(select count(a.AssetID) from [ARM_CORE]..[Asset] a ' + @ColJoin + ' where ' + @ColFilter + ' a.Status = ' + @tSTATUS + ' and IsNull(a.Deferred,0) = 0 and a.BArea=b.BArea ' + @TargetOn + ' and IsNull(a.[LifeCycle],'''') like ''' + @LifeCycle + ''' and IsNull(a.[OU],'''') like ''' + @OU + ''') as [' + @tStatus +'] '

				FETCH NEXT FROM Status_Cursor INTO @tSTATUS;
			END;
		CLOSE Status_Cursor;
		DEALLOCATE Status_Cursor;

		SET @tSQL = ' select distinct ' + @tHEADERS + ', (select count(a.AssetID) from [ARM_CORE]..[Asset] a ' + @ColJoin + ' where ' + @ColFilter + ' IsNull(a.Status,'''') = '''' and IsNull(a.Deferred,0) = 0 and a.BArea=b.BArea ' + @TargetOn + ' and IsNull(a.[LifeCycle],'''') like ''' + @LifeCycle + ''' and IsNull(a.[OU],'''') like ''' + @OU + ''') [''Undefined'']';
		SET @tSQL = @tSQL + ', (select count(a.AssetID) from [ARM_CORE]..[Asset] a ' + @ColJoin + ' where ' + @ColFilter + ' IsNull(a.Deferred,0) = 1 and a.BArea=b.BArea ' + @TargetOn + ' and IsNull(a.[LifeCycle],'''') like ''' + @LifeCycle + ''' and IsNull(a.[OU],'''') like ''' + @OU + ''') [''Deferred'']';
		SET @tSQL = @tSQL + ' from [ARM_CORE]..[BArea] b ' + @BAreaWhere + ' Order by b.BArea ' 
		
 		EXEC (@tSQL);

END


GO
-- ============================================================================
-- Author:		John Reed
-- alter date: 15/07/2016
-- Description:	Generates a grid of counters as determined by Asset 'Status' values.
-- ============================================================================
CREATE PROCEDURE [dbo].[Console-Status]
@OU AS nvarchar(500) = '',
@Target AS int = -1,
@BArea AS nvarchar(255) = '[Undefined]',
@LifeCycle AS nvarchar(255) = '%'
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

		DECLARE @tSQL nvarchar(max);
		DECLARE @tHEADERS nvarchar(max);
		DECLARE @vHEADERS nvarchar(max);
		DECLARE @tJOINS nvarchar(max);
		DECLARE @tSTATUS nvarchar(max);
		DECLARE @TargetLabel nvarchar(20);
		DECLARE @BAreaWhere nvarchar(max);
		DECLARE @TargetOn nvarchar(max) = '';


		SET @tHEADERS = ' b.BArea, (select count(a.AssetID) from [ARM_CORE]..[Asset] a where a.BArea=b.BArea and IsNull(a.[OU],'''') like ''' + @OU + ''') as BAreaTotal ';
		SET @tSQL = '';
		SET @TargetLabel = '';
		SET @BAreaWhere = '';

		DECLARE Status_Cursor CURSOR FOR SELECT [Lookup]  FROM [ARM_CORE].[dbo].[A_LookUp] where [Table] = 'Asset' and [Column] = 'Status' Order By [Order];

		OPEN Status_Cursor;

		FETCH NEXT FROM Status_Cursor INTO @tSTATUS;


		IF @BArea <> '[Undefined]' SET @BAreaWhere = ' where  b.BArea like ''' + replace(@BArea,'[','![') + ''' '

		IF @Target = 1 SET @TargetOn = ' and a.Target = 1 '
		IF @Target = 0 SET @TargetOn = ' and a.Target = 0 '

		IF @LifeCycle = '' SET @LifeCycle = '%'
		IF @LifeCycle = 'All' SET @LifeCycle = '%'


		WHILE @@FETCH_STATUS = 0
			BEGIN
				SET @tHEADERS = @tHEADERS + ',(select count(a.AssetID) from [ARM_CORE]..[Asset] a where a.Status = ' + @tSTATUS + ' and IsNull(a.Deferred,0) = 0 and a.BArea=b.BArea ' + @TargetOn + ' and IsNull(a.[LifeCycle],'''') like ''' + @LifeCycle + ''' and IsNull(a.[OU],'''') like ''' + @OU + ''') as [' + @tStatus +'] '

				FETCH NEXT FROM Status_Cursor INTO @tSTATUS;
			END;
		CLOSE Status_Cursor;
		DEALLOCATE Status_Cursor;

		SET @tSQL = ' select distinct ' + @tHEADERS + ', (select count(a.AssetID) from [ARM_CORE]..[Asset] a where IsNull(a.Status,'''') = '''' and IsNull(a.Deferred,0) = 0 and a.BArea=b.BArea ' + @TargetOn + ' and IsNull(a.[LifeCycle],'''') like ''' + @LifeCycle + ''' and IsNull(a.[OU],'''') like ''' + @OU + ''') [''Undefined'']';
		SET @tSQL = @tSQL + ', (select count(a.AssetID) from [ARM_CORE]..[Asset] a where IsNull(a.Deferred,0) = 1 and a.BArea=b.BArea ' + @TargetOn + ' and IsNull(a.[LifeCycle],'''') like ''' + @LifeCycle + ''' and IsNull(a.[OU],'''') like ''' + @OU + ''') [''Deferred'']';
		SET @tSQL = @tSQL + ' from [ARM_CORE]..[BArea] b ' + @BAreaWhere + ' Escape ''!'' Order by b.BArea ' 
		
 		EXEC (@tSQL);

END





GO

-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Collection-PIVOT]
@CollectionClassID int = 0,
@ItemType nvarchar(255) = 'Asset',
@field nvarchar(255) = 'Model'
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	-- @ItemType 
	--		The name of the table (e.g. Aset, Application, User) corresponding to the Collections held in the Class
	--		
	-- @field
	--		Any field belongng to the @ItemType
	--




	DECLARE @query VARCHAR(MAX)



	IF OBJECT_ID('tempdb..#tempCPTable') IS NOT NULL
		DROP TABLE #tempCPTable;


	CREATE TABLE #tempCPTable(
		[Field] [nvarchar](500) NULL,
		[Name] [nvarchar](500) NULL,
		[Total] [int] NULL
	) ON [PRIMARY]


--	SELECT a.Type as [Field], c.[Name], Count(i.ItemID) as Total
--	FROM [ARM_CORE]..[A_CollectionClass] cc 
--	LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionClassID = cc.CollectionClassID 
--	LEFT JOIN [ARM_CORE]..[A_CollectionItem] i on i.CollectionID = c.CollectionID
--	LEFT JOIN [ARM_CORE]..[asset] a on a.AssetID = i.ItemID
--	where cc.CollectionClassID = 91
--	Group by a.Type, c.[Order], c.[Name]

	SET @query = '
		INSERT INTO #tempCPTable 
		SELECT IsNull(a.[' + @field + '],''NULL'') as [Field], c.[Name], Count(i.ItemID) as Total
		FROM [ARM_CORE]..[A_CollectionClass] cc 
		LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionClassID = cc.CollectionClassID 
		LEFT JOIN [ARM_CORE]..[A_CollectionItem] i on i.CollectionID = c.CollectionID
		LEFT JOIN [ARM_CORE]..[' + @ItemType + '] a on a.' + @ItemType + 'ID = i.ItemID
		where cc.CollectionClassID = ' + cast(@CollectionClassID as nvarchar) + ' 
		Group by a.[' + @field + '], c.[Order], c.[Name]
		UNION
		SELECT ''zSub Total'', c.[Name],Count(i.ItemID)
		FROM [ARM_CORE]..[A_Collection] c      
		LEFT JOIN [ARM_CORE]..[A_CollectionItem] i on i.CollectionID = c.CollectionID
		where c.CollectionClassID = 93     
		Group by c.[Name]
		'


	EXECUTE(@query)


	DECLARE @Columns VARCHAR(MAX)

	SELECT @columns = STUFF(( SELECT TOP 100 PERCENT
									'],[' + cast(Name as nvarchar(255))
							FROM    [ARM_CORE]..[A_Collection] AS t2 where t2.CollectionClassID =  @CollectionClassID 
							ORDER BY t2.[Order],'],[' + cast(Name as nvarchar(255))
							FOR XML PATH('')
						  ), 1, 2, '') + ']'




	SET @query = '
	SELECT p.*
	FROM #tempCPTable q
	PIVOT
	(
	SUM(Total)
	FOR [Name]
	IN (' + @columns + ')
	)
	AS p 
    order by p.Field'


	EXECUTE(@query)


	DROP TABLE #tempCPTable
END




GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Comments]
	-- Add the parameters for the stored procedure here
    @searchterm nvarchar(50) 
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
select ap.AssetID, d.Label, d.slotID, a.Owner, a.BArea, a.Location
from AppCache$ ap 
LEFT JOIN [ARM_CORE]..[ScheduleDeployRunAsset] r ON r.AssetID = ap.AssetID
LEFT JOIN [ARM_CORE]..[ScheduleDeployRun] d ON d.RunID = r.RunID
LEFT JOIN [ARM_CORE]..[AssetCache] a ON a.AssetID = ap.AssetID
LEFT JOIN Issues$ i on i.AssetId = ap.AssetID
where ap.Comment like '%' + @searchterm + '%' or i.IssueComment like '%' + @searchterm + '%' 

UNION

select a.AssetID, d.Label, d.slotID, a.Owner, a.BArea, a.Location
from [ARM_CORE]..[AssetCache] a 
LEFT JOIN [ARM_CORE]..[ScheduleDeployRunAsset] r ON r.AssetID = a.AssetID
LEFT JOIN [ARM_CORE]..[ScheduleDeployRun] d ON d.RunID = r.RunID
LEFT JOIN Issues$ i on i.AssetId = a.AssetID
where a.Comment like '%' + @searchterm + '%' or i.IssueComment like '%' + @searchterm + '%' 

Order By AssetID
END




GO
-- =============================================
-- Author:		<Author,,Name>
-- ALTER date: <ALTER Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Collection-DeleteItem]
	@AssetID nvarchar(255),
	@GrpID int = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
--	BEGIN TRAN;

	if @GrpID > 0 
		DELETE from [ARM_CORE]..[A_CollectionItem] where CollectionID = @GrpID and ItemID = @AssetID 


END

GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[CollectionClassToClass-Pivot]
	@ccid as int = 0,
	@ccid2 as int = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

  	SELECT c.[Name], d.[Name] as [Column], Count(i.ItemID) as Total
	INTO #tempClassPivotTable
	FROM [ARM_CORE]..[A_CollectionClass] cc 
	LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionClassID = cc.CollectionClassID 
	LEFT JOIN [ARM_CORE]..[A_CollectionItem] i on i.CollectionID = c.CollectionID
	LEFT JOIN [ARM_CORE]..[A_CollectionItem] di on di.ItemID = i.ItemID
	LEFT JOIN [ARM_CORE]..[A_Collection] d on d.CollectionID = di.CollectionID 
	where cc.CollectionClassID = @ccid and d.CollectionClassID = @ccid2
	Group by c.[Order], c.[Name], d.[Name]
	Order by c.[Order], c.[Name], d.[Name] 

	DECLARE @Columns VARCHAR(MAX)

	SELECT @columns = STUFF(( SELECT DISTINCT TOP 100 PERCENT
									'],[' + cast([Column] as varchar)
							FROM    #tempClassPivotTable AS t2
							ORDER BY '],[' + cast([Column] as varchar)
							FOR XML PATH('')
						  ), 1, 2, '') + ']'

	DECLARE @query VARCHAR(8000)

	SET @query = '
	SELECT *
	FROM #tempClassPivotTable t
	PIVOT
	(
	SUM(Total)
	FOR t.[Column]
	IN (' + @columns + ')
	)
	AS p '


	EXECUTE(@query)


	DROP TABLE #tempClassPivotTable
END




GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[CollectionClass-Pivot]
	@ccid as int = 18
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	SELECT cc.Name as [ClassName], c.[Name], Count(i.ItemID) as Total
	INTO #tempClassPivotTable
	FROM [ARM_CORE]..[A_CollectionClass] cc 
	LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionClassID = cc.CollectionClassID 
	LEFT JOIN [ARM_CORE]..[A_CollectionItem] i on i.CollectionID = c.CollectionID
	where cc.CollectionClassID = @ccid
	Group by cc.Name, c.[Order], c.[Name] 
	Order by [ClassName], [Order], [Name] 


	DECLARE @Columns VARCHAR(MAX)

	SELECT @columns = STUFF(( SELECT DISTINCT TOP 100 PERCENT
									'],[' + cast([Name] as varchar)
							FROM    #tempClassPivotTable AS t2
							ORDER BY '],[' + cast([Name] as varchar)
							FOR XML PATH('')
						  ), 1, 2, '') + ']'

	DECLARE @query VARCHAR(8000)

	SET @query = '
	SELECT *
	FROM #tempClassPivotTable t
	PIVOT
	(
	SUM(Total)
	FOR t.[Name]
	IN (' + @columns + ')
	)
	AS p '


	EXECUTE(@query)


	DROP TABLE #tempClassPivotTable
END




GO
-- =============================================
-- Author:                           <Author,,Name>
-- Create date: <Create Date,,>
-- Description:    <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Collection-AddUser-FromList]
               @CollectionID int = 0,
               @itemList nvarchar(max),
               @Distinct bit = 0,
               @Who nvarchar(500) = 'System'
AS
BEGIN
               -- SET NOCOUNT ON added to prevent extra result sets from
               -- interfering with SELECT statements.
               SET NOCOUNT ON;
--            BEGIN TRAN;

               DECLARE @query nvarchar(max)
               DECLARE @CClass int


               select @Distinct = IsNull(cc.[Distinct],0), @CClass = IsNull(cc.CollectionClassID,0) from [ARM_CORE]..[A_Collection] c LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc on cc.CollectionClassID = c.CollectionClassID where c.CollectionID = @CollectionID

               if @CollectionID > 0 
               BEGIN

                              if @Distinct = 1 
                              BEGIN
                                             Set @query = '
                                             delete from [ARM_CORE]..[A_CollectionItem]  where ItemID in  (' + @itemList + ')
                                                            and CollectionID in (select CollectionID from [ARM_CORE]..[A_Collection] c where c.CollectionClassID = ' + convert(nvarchar(255),@CClass) + ') and CollectionID <> ' + convert(nvarchar(255),@CollectionID)
                                             

                                             EXECUTE(@query)                           
                                             
                              END

                              Set @query = '
                                             MERGE [ARM_CORE]..[A_CollectionItem] AS Target
                                             USING (SELECT UserID, ' + convert(nvarchar(255),@CollectionID) + ' as CollectionID from [ARM_CORE]..[User] where UserID in  (' + @itemList + ')) As Source
                                             ON (Target.ItemID = Source.UserID and Target.CollectionID = Source.CollectionID )
                                             WHEN NOT MATCHED BY TARGET THEN
                                                            INSERT ([ItemID],[CollectionID]) 
                                                            VALUES (Source.UserID, Source.CollectionID);      
                              '              

                              EXECUTE(@query)            

               END                                                                                  
--            OUTPUT $action, inserted.*, deleted.*;

--            ROLLBACK TRAN;

END




GO
-- =============================================
-- Author:                           <Author,,Name>
-- Create date: <Create Date,,>
-- Description:    <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Collection-AddItem-FromList]
               @CollectionID int = 0,
               @itemList nvarchar(max)

AS
BEGIN
               -- SET NOCOUNT ON added to prevent extra result sets from
               -- interfering with SELECT statements.
            SET NOCOUNT ON;
--            BEGIN TRAN;

			DECLARE @query nvarchar(max)
			DECLARE @CClass int
			DECLARE @Distinct bit 

			select @Distinct = IsNull(cc.[Distinct],0), @CClass = IsNull(cc.CollectionClassID,0)  from [ARM_CORE]..[A_Collection] c LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc on cc.CollectionClassID = c.CollectionClassID where c.CollectionID = @CollectionID


			if @CollectionID > 0 
			BEGIN

                if @Distinct = 1 
                BEGIN

					Set @query = '
						delete from [ARM_CORE]..[A_CollectionItem]  where ItemID in  (' + @itemList + ')
						and CollectionID in (select CollectionID from [ARM_CORE]..[A_Collection] c where c.CollectionClassID = ' + convert(nvarchar(255),@CClass) + ') and CollectionID <> ' + convert(nvarchar(255),@CollectionID)
									
					EXECUTE(@query)                           
                                             
                END

					Set @query = '
						MERGE [ARM_CORE]..[A_CollectionItem] AS Target
						USING (SELECT value as ItemID, ' + convert(nvarchar(255),@CollectionID) + ' as CollectionID from STRING_SPLIT(''' + replace(Replace(@itemList,'N''',''),'''','') +''','','') ) As Source
						ON (Target.ItemID = Source.ItemID and Target.CollectionID = Source.CollectionID )
						WHEN NOT MATCHED BY TARGET THEN
							INSERT ([ItemID],[CollectionID]) 
							VALUES (Source.ItemID, Source.CollectionID);     
					'              

                EXECUTE(@query)            

              END   
			  
--            OUTPUT $action, inserted.*, deleted.*;

--            ROLLBACK TRAN;

END




GO
-- =============================================
-- Author:		<Author,,Name>
-- ALTER date: <ALTER Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Collection-AddItem]
	@ItemID nvarchar(255),
	@CollectionID int = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.


	SET NOCOUNT ON;

	DECLARE @query nvarchar(max)
	DECLARE @CClass int
	DECLARE @Distinct bit 

	select @Distinct = IsNull(cc.[Distinct],0), @CClass = IsNull(cc.CollectionClassID,0)  from [ARM_CORE]..[A_Collection] c LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc on cc.CollectionClassID = c.CollectionClassID where c.CollectionID = @CollectionID


	if @CollectionID > 0 
	BEGIN

		if @Distinct = 1 
		BEGIN

			delete from [ARM_CORE]..[A_CollectionItem] where ItemID =  @ItemID and CollectionID in (select CollectionID from [ARM_CORE]..[A_Collection] c where c.CollectionClassID = @CClass and CollectionID <> @CollectionID)
                                             
		END

		MERGE [ARM_CORE]..[A_CollectionItem] AS Target
		USING (SELECT @ItemID as ItemID, @CollectionID as CollectionID) As Source
		ON (Target.ItemID = Source.ItemID and Target.CollectionID = Source.CollectionID )
		WHEN NOT MATCHED BY TARGET THEN
			INSERT ([ItemID],[CollectionID]) 
			VALUES (Source.ItemID, Source.CollectionID);          

	END   

						
--	OUTPUT $action, inserted.*, deleted.*;

--	ROLLBACK TRAN;

END




GO
-- =============================================
-- Author:		<Author,,Name>
-- ALTER date: <ALTER Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Collection-AddAsset-FromList2]
	@CollectionID int = 0,
	@itemList nvarchar(max),
	@Distinct bit = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
--	BEGIN TRAN;

	DECLARE @query nvarchar(max)
	DECLARE @message nvarchar(250)
	DECLARE @CollectionName nvarchar(500)
	DECLARE @TheDate nvarchar(500)

	if @CollectionID > 0 
	BEGIN

		if @Distinct = 1 
		BEGIN
			Set @query = '
			delete from [ARM_CORE]..[A_CollectionItem] 
			where CollectionID in (select collectionID from  [ARM_CORE]..[A_Collection] where CollectionClassID = (select CollectionClassID from [ARM_CORE]..[A_Collection] where CollectionID = ' + convert(nvarchar(255),@CollectionID) + ') )
			and itemID in (' + @itemList + ')
			'

			EXECUTE(@query)		
			
		END

		Set @query = '
			MERGE [ARM_CORE]..[A_CollectionItem] AS Target
			USING (SELECT AssetID, ' + convert(nvarchar(255),@CollectionID) + ' as CollectionID from [ARM_CORE]..[Asset] where AssetID in  (' + @itemList + ')) As Source
			ON (Target.ItemID = Source.AssetID and Target.CollectionID = Source.CollectionID )
			WHEN NOT MATCHED BY TARGET THEN
				INSERT ([ItemID],[CollectionID]) 
				VALUES (Source.AssetID, Source.CollectionID);	
		'	

		EXECUTE(@query)	

		select  @CollectionName = c.[Name], @TheDate = getdate() from [ARM_CORE]..[A_Collection] c where C.CollectionID = @CollectionID
		set @message = 'Status collection set to  "' + @CollectionName + '"  at  ' + @TheDate

		Set @query = '
			MERGE [ARM_CORE]..[A_CommentLog] AS Target
			USING (SELECT AssetID, ''' + @message + ''' as [Comment] from [ARM_CORE]..[Asset] where AssetID in  (' + @itemList + ')) As Source
			ON (Target.RecordID = Source.AssetID and Target.[Comment] = Source.[Comment] )
			WHEN NOT MATCHED BY TARGET THEN
				INSERT ([Table],[Type],[recordID],[Author],[Comment]) 
				VALUES (''Asset'',''System'',Source.AssetID, ''System'', Source.[Comment]);	
		'	

		EXECUTE(@query)	


--		insert into [ARM_CORE]..[A_CommentLog] ([Table],[Type],recordID,[Author],[Comment]) values ('Asset', 'System',@AssetID, @Who, 'Details Confirmed '+@Message)


	END						
--	OUTPUT $action, inserted.*, deleted.*;

--	ROLLBACK TRAN;

END




GO
-- =============================================
-- Author:                           <Author,,Name>
-- Create date: <Create Date,,>
-- Description:    <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Collection-AddAsset-FromList]
               @CollectionID int = 0,
               @itemList nvarchar(max),
               @Distinct bit = 0,
               @Who nvarchar(500) = 'System'
AS
BEGIN
               -- SET NOCOUNT ON added to prevent extra result sets from
               -- interfering with SELECT statements.
               SET NOCOUNT ON;
--            BEGIN TRAN;

               DECLARE @query nvarchar(max)
               DECLARE @message nvarchar(250)
               DECLARE @CollectionName nvarchar(500)
               DECLARE @WorkStreamName nvarchar(500)
               DECLARE @TheDate nvarchar(500)
               DECLARE @CClass int


               select @Distinct = IsNull(cc.[Distinct],0), @CClass = IsNull(cc.CollectionClassID,0) from [ARM_CORE]..[A_Collection] c LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc on cc.CollectionClassID = c.CollectionClassID where c.CollectionID = @CollectionID


               if @CollectionID > 0 
               BEGIN

                              if @Distinct = 1 
                              BEGIN
                                             Set @query = '
                                             delete from [ARM_CORE]..[A_CollectionItem]  where ItemID in  (' + @itemList + ')
                                                            and CollectionID in (select CollectionID from [ARM_CORE]..[A_Collection] c where c.CollectionClassID = ' + convert(nvarchar(255),@CClass) + ') and CollectionID <> ' + convert(nvarchar(255),@CollectionID)
                                             


                                             EXECUTE(@query)                           
                                             
                              END

                              Set @query = '
                                             MERGE [ARM_CORE]..[A_CollectionItem] AS Target
                                             USING (SELECT AssetID, ' + convert(nvarchar(255),@CollectionID) + ' as CollectionID from [ARM_CORE]..[Asset] where AssetID in  (' + @itemList + ')) As Source
                                             ON (Target.ItemID = Source.AssetID and Target.CollectionID = Source.CollectionID )
                                             WHEN NOT MATCHED BY TARGET THEN
                                                            INSERT ([ItemID],[CollectionID]) 
                                                            VALUES (Source.AssetID, Source.CollectionID);     
                              '              

                              EXECUTE(@query)            

                              select  @CollectionName = c.[Name], @TheDate = getdate(), @WorkStreamName = Isnull(w.[Name],convert(nvarchar(255),w.WorkstreamID)) from [ARM_CORE]..[A_Collection] c 
                                             LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc on cc.CollectionClassID = c.CollectionClassID 
                                             LEFT JOIN [ARM_CORE]..[Workstream] w on w.WorkstreamID = cc.WorkstreamID 
                                             where c.CollectionID = @CollectionID

                              set @message = 'Status collection set to  "' + @CollectionName + '"  in Workstream "' + @WorkStreamName + '" at  ' + @TheDate

                              Set @query = '
                                             MERGE [ARM_CORE]..[A_CommentLog] AS Target
                                             USING (SELECT AssetID, ''' + @message + ''' as [Comment] from [ARM_CORE]..[Asset] where AssetID in  (' + @itemList + ')) As Source
                                             ON (Target.RecordID = Source.AssetID and Target.[Comment] = Source.[Comment] )
                                             WHEN NOT MATCHED BY TARGET THEN
                                                            INSERT ([Table],[Type],[recordID],[Author],[Comment]) 
                                                            VALUES (''Asset'',''System'',Source.AssetID, ''' + @Who + ''', Source.[Comment]);        
                              '              

                              EXECUTE(@query)            


--                           insert into [ARM_CORE]..[A_CommentLog] ([Table],[Type],recordID,[Author],[Comment]) values ('Asset', 'System',@AssetID, @Who, 'Details Confirmed '+@Message)


               END                                                                                  
--            OUTPUT $action, inserted.*, deleted.*;

--            ROLLBACK TRAN;

END




GO
-- =============================================
-- Author:             <Author,,Name>
-- Create date: <Create Date,,>
-- Description:        <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Collection-AddApplicationRequest-FromList]
        @CollectionID int = 0,
        @itemList nvarchar(max),
        @Distinct bit = 0,
        @Who nvarchar(500) = 'System'
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
        SET NOCOUNT ON;
--      BEGIN TRAN;
        DECLARE @query nvarchar(max)
        DECLARE @message nvarchar(250)
        DECLARE @CollectionName nvarchar(500)
        DECLARE @WorkStreamName nvarchar(500)
        DECLARE @TheDate nvarchar(500)
        if @Distinct = 0
        BEGIN
               select @Distinct = IsNull(cc.[Distinct],0) from [ARM_CORE]..[A_Collection] c LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc on cc.CollectionClassID = c.CollectionClassID where c.CollectionID = @CollectionID
        END
        if @CollectionID > 0 
        BEGIN
               if @Distinct = 1 
               BEGIN
                       Set @query = '
                       delete from [ARM_CORE]..[A_CollectionItem] 
                       where CollectionID in (select collectionID from  [ARM_CORE]..[A_Collection] where CollectionClassID = (select CollectionClassID from [ARM_CORE]..[A_Collection] where CollectionID = ' + convert(nvarchar(255),@CollectionID) + ') and CollectionID <> ' + convert(nvarchar(255),@CollectionID) + ')  
                       and itemID in (' + @itemList + ')
                       '
                       EXECUTE(@query)               
                       
               END
               Set @query = '
                       MERGE [ARM_CORE]..[A_CollectionItem] AS Target
                       USING (SELECT ApplicationRequestID as ItemID, ' + convert(nvarchar(255),@CollectionID) + ' as CollectionID from [ARM_CORE]..[ApplicationRequest] where ApplicationRequestID in  (' + @itemList + ')) As Source
                       ON (Target.ItemID = Source.ItemID and Target.CollectionID = Source.CollectionID )
                       WHEN NOT MATCHED BY TARGET THEN
                              INSERT ([ItemID],[CollectionID]) 
                              VALUES (Source.ItemID, Source.CollectionID); 
               '       
               EXECUTE(@query)        
               select  @CollectionName = c.[Name], @TheDate = getdate(), @WorkStreamName = Isnull(w.[Name],convert(nvarchar(255),IsNull(w.WorkstreamID,' '))) from [ARM_CORE]..[A_Collection] c 
                       LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc on cc.CollectionClassID = c.CollectionClassID 
                       LEFT JOIN [ARM_CORE]..[Workstream] w on w.WorkstreamID = cc.WorkstreamID 
                       where c.CollectionID = @CollectionID
               if @WorkStreamName <> ' ' set @WorkStreamName = 'in Workstream ' + @WorkStreamName
               set @message = 'Status collection set to  "' + @CollectionName + @WorkStreamName + '" at  ' + @TheDate
               Set @query = '
                       MERGE [ARM_CORE]..[A_CommentLog] AS Target
                       USING (SELECT ApplicationRequestID as ItemID, ''' + @message + ''' as [Comment] from [ARM_CORE]..[ApplicationRequest] where ApplicationRequestID in  (' + @itemList + ')) As Source
                       ON (Target.RecordID = Source.ItemID and Target.[Comment] = Source.[Comment] )
                       WHEN NOT MATCHED BY TARGET THEN
                              INSERT ([Table],[Type],[recordID],[Author],[Comment]) 
                              VALUES (''Asset'',''System'',Source.ItemID, ''' + @Who + ''', Source.[Comment]);       
               '       
               EXECUTE(@query)        
 
--             insert into [ARM_CORE]..[A_CommentLog] ([Table],[Type],recordID,[Author],[Comment]) values ('Asset', 'System',@AssetID, @Who, 'Details Confirmed '+@Message)
 
        END                                          
--      OUTPUT $action, inserted.*, deleted.*;
--      ROLLBACK TRAN;
END
 
 

GO
-- =============================================
-- Author:                           <Author,,Name>
-- Create date: <Create Date,,>
-- Description:    <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Collection-AddApplication-FromList]
               @CollectionID int = 0,
               @itemList nvarchar(max),
               @Distinct bit = 0,
               @Who nvarchar(500) = 'System'

AS
BEGIN
               -- SET NOCOUNT ON added to prevent extra result sets from
               -- interfering with SELECT statements.
               SET NOCOUNT ON;
--            BEGIN TRAN;

               DECLARE @query nvarchar(max)
               DECLARE @CClass int


               select @Distinct = IsNull(cc.[Distinct],0), @CClass = IsNull(cc.CollectionClassID,0) from [ARM_CORE]..[A_Collection] c LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc on cc.CollectionClassID = c.CollectionClassID where c.CollectionID = @CollectionID

               if @CollectionID > 0 
               BEGIN

                              if @Distinct = 1 
                              BEGIN

                                             Set @query = '
                                             delete from [ARM_CORE]..[A_CollectionItem]  where ItemID in  (' + @itemList + ')
                                                            and CollectionID in (select CollectionID from [ARM_CORE]..[A_Collection] c where c.CollectionClassID = ' + convert(nvarchar(255),@CClass) + ') and CollectionID <> ' + convert(nvarchar(255),@CollectionID)
                                             
                                             

                                             EXECUTE(@query)                           
                                             
                              END

                              Set @query = '
                                             MERGE [ARM_CORE]..[A_CollectionItem] AS Target
                                             USING (SELECT distinct ApplicationID, ' + convert(nvarchar(255),@CollectionID) + ' as CollectionID from [ARM_CORE]..[Application] where ApplicationID in  (' + @itemList + ')) As Source
                                             ON (Target.ItemID = Source.ApplicationID and Target.CollectionID = Source.CollectionID )
                                             WHEN NOT MATCHED BY TARGET THEN
                                                            INSERT ([ItemID],[CollectionID]) 
                                                            VALUES (Source.ApplicationID, Source.CollectionID);         
                              '              

                              EXECUTE(@query)            

               END                                                                                  
--            OUTPUT $action, inserted.*, deleted.*;

--            ROLLBACK TRAN;

END






GO

CREATE PROCEDURE [dbo].[CloneSurvey]
    @OLD_SID int,
	@Author nvarchar(255) = NULL
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

DECLARE @KEY nvarchar(50);
Set @KEY = NewID();

insert into Survey([Title],[Published],[PublishedOn],[Active],[Key],[Auth_User]) SELECT Title,1,getdate(),1,@KEY,@Author from Survey where SID = @OLD_SID

DECLARE @SID INT;
Set @SID = SCOPE_IDENTITY();


INSERT INTO [ARM_CORE]..[SurveyPQuestions] (QID,Question,Qorder,Active,[Type],[SID]) SELECT QID,Question,Qorder,Active,[Type],@SID FROM [ARM_CORE]..[SurveyPQuestions] where SID = @OLD_SID

INSERT INTO [ARM_CORE]..[SurveyPScalar] (AID,QID,LeftLabel,RightLabel,[Range],[NA],[SID]) SELECT AID,QID,LeftLabel,RightLabel,[Range],[NA],@SID FROM [ARM_CORE]..[SurveyPScalar]  where SID = @OLD_SID
INSERT INTO [ARM_CORE]..[SurveyPOption] (AID,QID,OptionA,OptionB,OptionC,OptionD,OptionE,Other,[SID]) SELECT AID,QID,OptionA,OptionB,OptionC,OptionD,OptionE,Other,@SID FROM [ARM_CORE]..[SurveyPOption]  where SID = @OLD_SID
INSERT INTO [ARM_CORE]..[SurveyPText] (AID,QID,[Rows],[Cols],[SID]) SELECT AID,QID,[Rows],[Cols],@SID FROM [ARM_CORE]..[SurveyPText]  where SID = @OLD_SID
INSERT INTO PGridAttributes (QID,KPI, [Description], [HowMeasured], [Weight], [1Guide], [2Guide], [3Guide], [4Guide], [5Guide],[SID]) SELECT QID,KPI, [Description], [HowMeasured], [Weight], [1Guide], [2Guide], [3Guide], [4Guide], [5Guide],@SID FROM PGridAttributes  where SID = @OLD_SID


--Return the result set of the table variable.
SELECT @SID AS [NewID], @KEY AS [NewKEY]
END


GO

CREATE PROCEDURE [dbo].[CloneGauge]
	@GID_IN int=0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

Insert into [ARM_CORE]..[Gauge] (Reference, Title, ValueSQL, MaxSQL, MinSQL, Decimals, WidthScale, Custom, loColour, midColour, hiColour, ActionURL, Description, AssetListSQL)
    SELECT Reference, Title, ValueSQL, MaxSQL, MinSQL, Decimals, WidthScale, Custom, loColour, midColour, hiColour, ActionURL, IsNull(Description,'') as [DESC], IsNull(AssetListSQL,'') as AssetListSQL 
	FROM [ARM_CORE]..[Gauge] where GaugeID = @GID_IN

if (@@ERROR = 0 and @@ROWCOUNT = 1)
BEGIN 
	DECLARE @GID INT;
	Set @GID = SCOPE_IDENTITY();

	insert into [ARM_CORE]..[GaugeLibrary] (GaugeID) values (@GID)
END
ELSE
BEGIN 
	Set @GID = -1
END

--Return the result set of the table variable.
SELECT @GID AS [NewGaugeID]
END


GO

CREATE PROCEDURE [dbo].[CheckMyTasks]
       @UserID nvarchar(255) = ''
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	DECLARE @myTaskID int
	DECLARE @myConditionID int
	DECLARE @myCheckID int
	DECLARE @myItemID nvarchar(500)
	DECLARE @myItemType nvarchar(500)
	DECLARE @myActionID int

	DECLARE @tasks int SET @tasks = 0

--	DECLARE db_tasks CURSOR FOR 

--		select t.taskID, IsNull(a.ConditionCollectionIDs,'') as ConditionCollectionIDs, (select count(i.CollectionID) from [ARM_CORE]..[A_CollectionItem] i where i.itemid = t.ItemID and i.CollectionID in (select value from string_split(IsNull(a.ConditionCollectionIDs,''), ',')) ) as CheckID, 
--			IsNull(t.ItemID,'') as [_ItemID], t.ItemType, a.ActionID
--		from [ARM_CORE]..[A_Task] t  
--		LEFT JOIN [ARM_CORE]..[A_Action] a on a.ActionID = t.ActionID 
--		where t.UserID = @UserID and isnull(t.[End],'') = ''  


	DECLARE db_tasks CURSOR FOR 

		select t.taskID, IsNull(t.ConditionCollectionID,0) as ConditionCollectionID, iif(IsNull(t.ConditionCollectionID,0)=0,1,(select count(i.CollectionID) from [ARM_CORE]..[A_CollectionItem] i where i.itemid = t.ItemID and i.CollectionID  = IsNull(t.ConditionCollectionID,0))) as CheckID 
			,IsNull(t.ItemID,'') as [_ItemID], t.ItemType, a.ActionID
		from [ARM_CORE]..[A_Task] t  
		LEFT JOIN [ARM_CORE]..[A_TaskAction] a on a.ActionID = t.ActionID 
		where t.UserID = @UserID and isnull(t.[End],'') = ''  

	OPEN db_tasks  
    
	FETCH NEXT FROM db_tasks INTO @myTaskID, @myConditionID, @myCheckID, @myItemID, @myItemType, @myActionID   
 
	WHILE @@FETCH_STATUS = 0  
	BEGIN  
 
		if @myCheckID = 0 
			BEGIN

				MERGE [ARM_CORE]..[A_TaskResponse] as Target using (
					select @myTaskID as [TaskID], @userID as [UserID], @myActionID as [ActionID], -1 as [ActionOptionID], 'SYS_CANCELLED' as [Value], 'Task no longer required; Either fullfilled elsewhere or cancelled.'  as [AdditionalInfo]
				) as Source
				ON (target.taskID  = source.taskID)
				WHEN NOT MATCHED BY TARGET THEN 
					insert ([TaskID],[UserID],[ActionID],[ActionOptionID],[Value],[AdditionalInfo]) Values (Source.[TaskID], Source.[UserID], Source.[ActionID], Source.[ActionOptionID], Source.[Value], Source.[AdditionalInfo]); 


				update [ARM_CORE]..[A_Task] set [END] = getdate() where taskID = @myTaskID;
						
				delete from [ARM_CORE]..[Alert] where taskID = @myTaskID

			END
		ELSE
			set @tasks = @tasks + 1

		FETCH NEXT FROM db_tasks INTO @myTaskID, @myConditionID, @myCheckID, @myItemID, @myItemType, @myActionID   
 
	END 
 
	CLOSE db_tasks  
	DEALLOCATE db_tasks 

	select @tasks as [Count]
END

GO

-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[checklist-PIVOT-Summary-Snapshot]
@CheckListID int = 0,
@ListType int = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	-- @ListType 
	--		0 = driven by responses
	--		1 = Controlled List


--	SELECT distinct f.FileID, f.[Folder], f.[Name] as FileName, f.FilePath, (select top 1 IsNull(m.MenuID,0) from [ARM_CORE]..[A_Menu] m where m.URL like f.FilePath+'%') as MenuID, r.Name, 1 as Permit
--	INTO #tempPivotTable
--	FROM [ARM_CORE]..[A_File] f 
--	LEFT JOIN [ARM_CORE]..[A_FileAccess] a on a.FileID = f.FileID 
--	LEFT JOIN [ARM_CORE]..[A_Role] r on r.RoleID = a.RoleID 
--	where IsNull(f.Ignore,0) = 0 and (f.FileID = @FileID or @FileID = 0)

	IF OBJECT_ID('tempdb..#tempPTable2') IS NOT NULL
		DROP TABLE #tempPTable2;


	CREATE TABLE #tempPTable2(
		[Area] [nvarchar](255) NULL,
		[Timestamp] [date] NULL,
		[Name] [nvarchar](500) NULL,
		[Permit] float NULL
	) ON [PRIMARY]




	if @ListType = 1 
	BEGIN 
		INSERT INTO #tempPTable2 (Area, [Timestamp], [Name], [Permit])
		select c.Area,  cast(r.[timestamp] as date) , g.[Name], ( case when o.slider = 1 then Round(((cast(r.[Value] as float)-cast(cast(r.[Value] as float) as int)) * 1000),0) / cast(t.Total as float) else ISNULL(o.Value, 0) / cast(t.Total as float) end)  as [Value] 
		FROM [ARM_CORE]..[CheckListControlList] c 
		LEFT JOIN [ARM_CORE]..[CheckListSnapShot] r on r.Area = c.Area
		LEFT JOIN [ARM_CORE]..[CheckListOption] O on O.CheckListOptionID = cast(cast(r.[Value] as float) as int) and O.CheckListID = c.CheckListID
		LEFT JOIN [ARM_CORE]..[CheckListItem] i on i.[CheckListItemID] = r.ItemID
		LEFT JOIN [ARM_CORE]..[CheckListGroup] g on g.[CheckListGroupID] = i.[CheckListGroupID]
		LEFT JOIN (
			SELECT g.[name], COUNT(i.CheckListItemID) AS Total  
			FROM [ARM_CORE]..CheckListGroup g
			LEFT JOIN [ARM_CORE]..CheckListItem AS i on i.CheckListGroupID = g.CheckListGroupID
			where g.CheckListID = @CheckListID
			Group by g.[Name]
		) t on t.[Name] = g.[Name]
		where c.CheckListID =  @CheckListID and c.Active = 1 -- and  g.CheckListID = @CheckListID
		Order by c.[Area], g.[StageOrder], g.[Order]
	END
	ELSE
	BEGIN 	
		INSERT INTO #tempPTable2 (Area, [Timestamp], [Name], [Permit])
		select r.Area as Area,   cast(r.[timestamp] as date)  , g.[Name], ( case when o.slider = 1 then Round(((cast(r.[Value] as float)-cast(cast(r.[Value] as float) as int)) * 1000),0) / cast(t.Total as float) else ISNULL(o.Value, 0) / cast(t.Total as float) end)  as [Value] 
		from [ARM_CORE]..[CheckListSnapShot] r    
		LEFT JOIN [ARM_CORE]..[CheckListOption] O on O.CheckListOptionID = cast(cast(r.[Value] as float) as int) and O.CheckListID = @CheckListID
		LEFT JOIN [ARM_CORE]..[CheckListItem] i on i.CheckListItemID = r.ItemID  
		LEFT JOIN [ARM_CORE]..[CheckListGroup] g on g.CheckListGroupID = i.CheckListgroupID and g.CheckListID =  @CheckListID
		LEFT JOIN (
			SELECT g.[name], COUNT(i.CheckListItemID) AS Total  
			FROM [ARM_CORE]..CheckListGroup g
			LEFT JOIN [ARM_CORE]..CheckListItem AS i on i.CheckListGroupID = g.CheckListGroupID
			where g.CheckListID = @CheckListID
			Group by g.[Name]
		) t on t.[Name] = g.[Name]
		where r.CheckListID = @CheckListID and NOT g.CheckListgroupID IS NULL  
		Order by r.[Area], g.[StageOrder], g.[Order]
	END




	DECLARE @Columns VARCHAR(MAX)


	SELECT @columns = STUFF(( SELECT distinct TOP 12 
									'],[' + cast(cast([TimeStamp] as date) as nvarchar(255))
							FROM    [ARM_CORE]..[CheckListSnapShot] AS t2 where t2.CheckListID =  @CheckListID 
							ORDER BY '],[' + cast(cast([TimeStamp] as date) as nvarchar(255)) desc
							FOR XML PATH('')
						  ), 1, 2, '') + ']'


	DECLARE @query VARCHAR(MAX)
	DECLARE @query2 VARCHAR(MAX)
	DECLARE @query3 VARCHAR(MAX)

	SET @query = '
	SELECT p.*
	FROM #tempPTable2 q
	PIVOT
	(
	SUM(Permit)
	FOR [TimeStamp]
	IN (' + @columns + ')
	)
	AS p 
    order by p.Area'

	SET @query2 = '
	SELECT p.*, x.OVR
	FROM #tempPTable2 q
	PIVOT
	(
	SUM(Permit)
	FOR [Name]
	IN (' + @columns + ')
	)
	AS p 
	LEFT JOIN (
		select r.Area, Sum(( case when o.slider = 1 then Round(((cast(r.[Value] as float)-cast(cast(r.[Value] as float) as int)) * 1000),0) else ISNULL(o.Value, 0) end) * 100.0/ t.Total*1.0) as OVR
		FROM [ARM_CORE]..CheckListResponse AS r 
		LEFT JOIN [ARM_CORE]..[CheckListOption] O on O.CheckListOptionID = cast(cast(r.[Value] as float) as int)   
		LEFT JOIN [ARM_CORE]..[CheckListItem] AS i on i.CheckListItemID = r.ItemID
		LEFT JOIN [ARM_CORE]..[CheckListGroup] AS g ON g.CheckListGroupID = i.CheckListGroupID  
		LEFT JOIN (
			SELECT ''Total'' as Label, COUNT(ii.CheckListItemID)*100 AS Total
			FROM [ARM_CORE]..[CheckListItem] AS ii
			LEFT JOIN [ARM_CORE]..CheckListGroup AS gg ON gg.CheckListGroupID = ii.CheckListGroupID  
			where gg.CheckListID = ' +  cast(@CheckListID as nvarchar) + ' 
		) t on t.Label = ''Total''
		where g.CheckListID = ' +  cast(@CheckListID as nvarchar) + ' 
		group by r.Area
	) as x on x.Area = p.Area

    order by p.Area'


	EXECUTE(@query)


	DROP TABLE #tempPTable2
END




GO

-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[checklist-PIVOT-Summary-Heatmat]
@CheckListID int = 0,
@ListType int = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	-- @ListType 
	--		0 = driven by responses
	--		1 = Controlled List


--	SELECT distinct f.FileID, f.[Folder], f.[Name] as FileName, f.FilePath, (select top 1 IsNull(m.MenuID,0) from [ARM_CORE]..[A_Menu] m where m.URL like f.FilePath+'%') as MenuID, r.Name, 1 as Permit
--	INTO #tempPivotTable
--	FROM [ARM_CORE]..[A_File] f 
--	LEFT JOIN [ARM_CORE]..[A_FileAccess] a on a.FileID = f.FileID 
--	LEFT JOIN [ARM_CORE]..[A_Role] r on r.RoleID = a.RoleID 
--	where IsNull(f.Ignore,0) = 0 and (f.FileID = @FileID or @FileID = 0)

	IF OBJECT_ID('tempdb..#tempPTable') IS NOT NULL
		DROP TABLE #tempPTable;


	CREATE TABLE #tempPTable(
		[Area] [nvarchar](255) NULL,
		[cn] [int] NULL,
		[Name] [nvarchar](500) NULL,
		[Permit] float NULL
	) ON [PRIMARY]




	if @ListType = 1 
	BEGIN 
		INSERT INTO #tempPTable (Area, cn, [Name], [Permit])
		select c.Area,  (
			select count( r.[Timestamp] ) from [ARM_CORE]..[CheckListResponseNote] r  
			LEFT JOIN [ARM_CORE]..[CheckListGroup] g on g.CheckListGroupID = r.CheckListgroupID and g.CheckListID = @CheckListID 
			where r.[Area] = c.Area and NOT g.CheckListgroupID IS NULL  
		) as cn  , g.[Name], ( case when o.slider = 1 then Round(((cast(r.[Value] as float)-cast(cast(r.[Value] as float) as int)) * 1000),0) / cast(t.Total as float) else ISNULL(o.Value, 0) / cast(t.Total as float) end)  as [Value] 
		FROM [ARM_CORE]..[CheckListControlList] c 
		LEFT JOIN [ARM_CORE]..[CheckListResponse] r on r.Area = c.Area
		LEFT JOIN [ARM_CORE]..[CheckListOption] O on O.CheckListOptionID = cast(cast(r.[Value] as float) as int) and O.CheckListID = c.CheckListID
		LEFT JOIN [ARM_CORE]..[CheckListItem] i on i.[CheckListItemID] = r.ItemID
		LEFT JOIN [ARM_CORE]..[CheckListGroup] g on g.[CheckListGroupID] = i.[CheckListGroupID]
		LEFT JOIN (
			SELECT g.[name], COUNT(i.CheckListItemID) AS Total  
			FROM [ARM_CORE]..CheckListGroup g
			LEFT JOIN [ARM_CORE]..CheckListItem AS i on i.CheckListGroupID = g.CheckListGroupID
			where g.CheckListID = @CheckListID
			Group by g.[Name]
		) t on t.[Name] = g.[Name]
		where c.CheckListID =  @CheckListID and c.Active = 1 -- and  g.CheckListID = @CheckListID
		Order by c.[Area], g.[StageOrder], g.[Order]
	END
	ELSE
	BEGIN 
		INSERT INTO #tempPTable (Area, cn, [Name], [Permit])
		select r.Area as Area,   
		(select count( n.[Timestamp] ) from [ARM_CORE]..[CheckListResponseNote] n   
		 			LEFT JOIN [ARM_CORE]..[CheckListGroup] h on h.CheckListGroupID = n.CheckListgroupID and h.CheckListID =  @CheckListID 
			where n.[Area] = r.Area and NOT h.CheckListgroupID IS NULL   
		) as cn  , g.[Name], ( case when o.slider = 1 then Round(((cast(r.[Value] as float)-cast(cast(r.[Value] as float) as int)) * 1000),0) / cast(t.Total as float) else ISNULL(o.Value, 0) / cast(t.Total as float) end)  as [Value] 
		from [ARM_CORE]..[CheckListResponse] r    
		LEFT JOIN [ARM_CORE]..[CheckListOption] O on O.CheckListOptionID = cast(cast(r.[Value] as float) as int) and O.CheckListID = @CheckListID
		LEFT JOIN [ARM_CORE]..[CheckListItem] i on i.CheckListItemID = r.ItemID  
		LEFT JOIN [ARM_CORE]..[CheckListGroup] g on g.CheckListGroupID = i.CheckListgroupID and g.CheckListID =  @CheckListID
		LEFT JOIN (
			SELECT g.[name], COUNT(i.CheckListItemID) AS Total  
			FROM [ARM_CORE]..CheckListGroup g
			LEFT JOIN [ARM_CORE]..CheckListItem AS i on i.CheckListGroupID = g.CheckListGroupID
			where g.CheckListID = @CheckListID
			Group by g.[Name]
		) t on t.[Name] = g.[Name]
		where r.CheckListID = @CheckListID and NOT g.CheckListgroupID IS NULL  
		Order by r.[Area], g.[StageOrder], g.[Order]
	END




	DECLARE @Columns VARCHAR(MAX)

	SELECT @columns = STUFF(( SELECT TOP 100 PERCENT
									'],[' + cast(Name as nvarchar(255))
							FROM    [ARM_CORE]..[CheckListGroup] AS t2 where t2.CheckListID =  @CheckListID 
							ORDER BY StageOrder, [Order],'],[' + cast(Name as nvarchar(255))
							FOR XML PATH('')
						  ), 1, 2, '') + ']'


	DECLARE @query VARCHAR(MAX)
	DECLARE @query2 VARCHAR(MAX)
	DECLARE @query3 VARCHAR(MAX)

	SET @query2 = '
	SELECT p.*
	FROM #tempPTable q
	PIVOT
	(
	SUM(Permit)
	FOR [Name]
	IN (' + @columns + ')
	)
	AS p 
    order by p.Area'

	SET @query = '
	SELECT p.*, x.OVR
	FROM #tempPTable q
	PIVOT
	(
	SUM(Permit)
	FOR [Name]
	IN (' + @columns + ')
	)
	AS p 
	LEFT JOIN (
		select r.Area, Sum(( case when o.slider = 1 then Round(((cast(r.[Value] as float)-cast(cast(r.[Value] as float) as int)) * 1000),0) else ISNULL(o.Value, 0) end) * 100.0/ t.Total*1.0) as OVR
		FROM [ARM_CORE]..CheckListResponse AS r 
		LEFT JOIN [ARM_CORE]..[CheckListOption] O on O.CheckListOptionID = cast(cast(r.[Value] as float) as int)   
		LEFT JOIN [ARM_CORE]..[CheckListItem] AS i on i.CheckListItemID = r.ItemID
		LEFT JOIN [ARM_CORE]..[CheckListGroup] AS g ON g.CheckListGroupID = i.CheckListGroupID  
		LEFT JOIN (
			SELECT ''Total'' as Label, COUNT(ii.CheckListItemID)*100 AS Total
			FROM [ARM_CORE]..[CheckListItem] AS ii
			LEFT JOIN [ARM_CORE]..CheckListGroup AS gg ON gg.CheckListGroupID = ii.CheckListGroupID  
			where gg.CheckListID = ' +  cast(@CheckListID as nvarchar) + ' 
		) t on t.Label = ''Total''
		where g.CheckListID = ' +  cast(@CheckListID as nvarchar) + ' 
		group by r.Area
	) as x on x.Area = p.Area

    order by p.Area'


	EXECUTE(@query)


	DROP TABLE #tempPTable
END




GO

-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[checklist-PIVOT-Summary]
@CheckListID int = 0,
@ListType int = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	-- @ListType 
	--		0 = driven by responses
	--		1 = Controlled List


--	SELECT distinct f.FileID, f.[Folder], f.[Name] as FileName, f.FilePath, (select top 1 IsNull(m.MenuID,0) from [ARM_CORE]..[A_Menu] m where m.URL like f.FilePath+'%') as MenuID, r.Name, 1 as Permit
--	INTO #tempPivotTable
--	FROM [ARM_CORE]..[A_File] f 
--	LEFT JOIN [ARM_CORE]..[A_FileAccess] a on a.FileID = f.FileID 
--	LEFT JOIN [ARM_CORE]..[A_Role] r on r.RoleID = a.RoleID 
--	where IsNull(f.Ignore,0) = 0 and (f.FileID = @FileID or @FileID = 0)

	IF OBJECT_ID('tempdb..#tempPTable') IS NOT NULL
		DROP TABLE #tempPTable;


	CREATE TABLE #tempPTable(
		[Area] [nvarchar](255) NULL,
		[cn] [int] NULL,
		[Name] [nvarchar](255) NULL,
		[Permit] [float] NULL
	) ON [PRIMARY]




	if @ListType = 1 
	BEGIN 
		INSERT INTO #tempPTable (Area, cn, [Name], [Permit])
		select c.Area,  (
			select count( r.[Timestamp] ) from [ARM_CORE]..[CheckListResponseNote] r  
			LEFT JOIN [ARM_CORE]..[CheckListGroup] g on g.CheckListGroupID = r.CheckListgroupID and g.CheckListID =   @CheckListID 
			where r.[Area] = c.Area and NOT g.CheckListgroupID IS NULL  
		) as cn  , g.[Name], (IsNull(O.[Value],0) * 100.00 / t.Total) as [Value] FROM [ARM_CORE]..[CheckListControlList] c 
		LEFT JOIN [ARM_CORE]..[CheckListResponse] r on r.Area = c.Area
		LEFT JOIN [ARM_CORE]..[CheckListOption] O on O.CheckListOptionID = r.[Value] 
		LEFT JOIN [ARM_CORE]..[CheckListItem] i on i.[CheckListItemID] = r.ItemID
		LEFT JOIN [ARM_CORE]..[CheckListGroup] g on g.[CheckListGroupID] = i.[CheckListGroupID]
		LEFT JOIN (
			SELECT g.[name], COUNT(i.CheckListItemID)*10 AS Total  
			FROM [ARM_CORE]..CheckListGroup g
			LEFT JOIN [ARM_CORE]..CheckListItem AS i on i.CheckListGroupID = g.CheckListGroupID
			where g.CheckListID = @CheckListID
			Group by g.[Name]
		) t on t.[Name] = g.[Name]
		where c.CheckListID =  @CheckListID and c.Active = 1
		Order by c.[Area], g.[StageOrder], g.[Order]
	END
	ELSE
	BEGIN 	
		INSERT INTO #tempPTable (Area, cn, [Name], [Permit])
		select Distinct r.Area as Area,   
		(select count( n.[Timestamp] ) from [ARM_CORE]..[CheckListResponseNote] n   
		 			LEFT JOIN [ARM_CORE]..[CheckListGroup] h on h.CheckListGroupID = n.CheckListgroupID and h.CheckListID =  @CheckListID 
			where n.[Area] = r.Area and NOT h.CheckListgroupID IS NULL   
		) as cn  , 'Banks', 1 as [Permit]
		from [ARM_CORE]..[CheckListResponse] r    
		LEFT JOIN [ARM_CORE]..[CheckListItem] i on i.CheckListItemID = r.ItemID  
		LEFT JOIN [ARM_CORE]..[CheckListGroup] g on g.CheckListGroupID = i.CheckListgroupID and g.CheckListID =  @CheckListID
		where NOT g.CheckListgroupID IS NULL  
		group by r.Area 
	END




	DECLARE @Columns VARCHAR(MAX)

	SELECT @columns = STUFF(( SELECT TOP 100 PERCENT
									'],[' + cast(Name as nvarchar(255))
							FROM    [ARM_CORE]..[CheckListGroup] AS t2 where t2.CheckListID =  @CheckListID 
							ORDER BY StageOrder, [Order],'],[' + cast(Name as nvarchar(255))
							FOR XML PATH('')
						  ), 1, 2, '') + ']'


	DECLARE @query VARCHAR(MAX)
	DECLARE @query2 VARCHAR(MAX)
	DECLARE @query3 VARCHAR(MAX)

	SET @query2 = '
	SELECT p.*
	FROM #tempPTable q
	PIVOT
	(
	SUM(Permit)
	FOR [Name]
	IN (' + @columns + ')
	)
	AS p 
    order by p.Area'

	SET @query = '
	SELECT p.*, x.OVR
	FROM #tempPTable q
	PIVOT
	(
	SUM(Permit)
	FOR [Name]
	IN (' + @columns + ')
	)
	AS p 
	LEFT JOIN (
		select r.Area, Sum(O.Value * 100.0/ t.Total) as OVR
		FROM [ARM_CORE]..CheckListResponse AS r 
		LEFT JOIN [ARM_CORE]..[CheckListOption] O on O.CheckListOptionID = r.[Value]  
		LEFT JOIN [ARM_CORE]..[CheckListItem] AS i on i.CheckListItemID = r.ItemID
		LEFT JOIN [ARM_CORE]..[CheckListGroup] AS g ON g.CheckListGroupID = i.CheckListGroupID  
		LEFT JOIN (
			SELECT ''Total'' as Label, COUNT(ii.CheckListItemID)*10 AS Total
			FROM [ARM_CORE]..[CheckListItem] AS ii
			LEFT JOIN [ARM_CORE]..CheckListGroup AS gg ON gg.CheckListGroupID = ii.CheckListGroupID  
			where gg.CheckListID = ' +  cast(@CheckListID as nvarchar) + ' 
		) t on t.Label = ''Total''
		where g.CheckListID = ' +  cast(@CheckListID as nvarchar) + ' 
		group by r.Area
	) as x on x.Area = p.Area
    order by p.Area'


	EXECUTE(@query)


	DROP TABLE #tempPTable
END




GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[CheckCanBook]
	@CollectionIDs nvarchar(255)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here

	-- if record then Booked 
	-- if record and TID = 0 then Manual Booking
	declare @Query as nvarchar(max)

	set @Query = '
	select distinct a.AssetID, a.[Type], CHANNEL.QualifyingCID, CHANNEL.AdditionalCID, qi.ItemID, ai.ItemID
		, CASE 
			WHEN NOT IsBooked.Slot IS NULL THEN IsBooked.Slot
			WHEN NOT CHANNEL.AssetType IS NULL and (CHANNEL.BookableDays - CHANNEL.Booked) <= 0 THEN ''No Space''
			WHEN CHANNEL.AssetType IS NULL THEN ''No Channel''
			ELSE ''Not Yet Booked''
		  END as Status
		,  CHANNEL.AssetType, (CHANNEL.BookableDays - CHANNEL.Booked) as [Available]
	from [ARM_CORE]..[A_Collection] c
	LEFT JOIN [ARM_CORE]..[A_CollectionItem] i on i.CollectionID = c.CollectionID
	LEFT JOIN [ARM_CORE]..[Asset] a on a.AssetID = i.ItemID
	LEFT JOIN (
	select i.ItemID, r.Label as Slot, IsNull(ra.[Status],'''') as [status]    
		from [ARM_CORE]..[A_CollectionItem] i
		left join [ARM_CORE]..[ScheduleBooking] b on b.AssetID = i.ItemID 
		left join [ARM_CORE]..[ScheduleDeployRun] r on r.RunID = b.RunID  
		Left Join [ARM_CORE]..[ScheduleTimeSlot] t on t.TID = b.TID      
		Left join [ARM_CORE]..[ScheduleChannel] c on c.ChannelID = r.ChannelID    
		left join [ARM_CORE]..[ScheduleDeployRunAsset] ra on ra.AssetID = b.AssetID and ra.RunID = b.RunID 
		where i.CollectionID in (' + @CollectionIDs + ') and r.RunDate > getdate()-1  
	) as IsBooked on IsBooked.ItemID = a.AssetID
	
	LEFT JOIN (
		Select distinct ch.ChannelID,  w.Name as Workstream, ch.Name, ch.[AssetType]
			, IsNull(ch.QualifyingCollectionID,0) as QualifyingCID, IsNull(ch.AdditionalCollectionID,0) as AdditionalCID
			, Count(BookDays.TheDate) BookableDays, IsNull(BookDays.Booked,0) Booked
		from [ARM_CORE]..[ScheduleChannel] ch 
		LEFT JOIN (
				select bb.ChannelID, bb.TheDate, tt.TID, tt.MaxBooking, Count(bg.AssetID) as Booked, cc.WorkstreamID
				from [ARM_CORE]..[ScheduleChannel] cc 
				LEFT JOIN [ARM_CORE]..[ScheduleBookDay] bb on bb.ChannelID = cc.ChannelID
				LEFT JOIN [ARM_CORE]..[ScheduleTimeSlot] tt on tt.BID = bb.BID 
				LEFT JOIN [ARM_CORE]..[ScheduleBooking] bg on bg.TID = tt.TID
				where tt.Active = 1 and bb.Active = 1  
				and bb.TheDate >= convert(date,dateadd(day,IsNull(bb.closeBuffer,0),getdate()))
				Group By tt.TID, bb.ChannelID, bb.TheDate, tt.MaxBooking, cc.WorkstreamID
		) As BookDays  on BookDays.ChannelID = ch.ChannelID and BookDays.MaxBooking > BookDays.Booked
		LEFT JOIN [ARM_CORE]..[Workstream] w on w.WorkstreamID = ch.WorkstreamID
		where ch.Active = 1 and ch.Bookable = 1
		group by ch.ChannelID, w.Name, ch.Name, ch.[AssetType], BookDays.Booked, IsNull(ch.QualifyingCollectionID,0), IsNull(ch.AdditionalCollectionID,0)
	) CHANNEL on (CHANNEL.AssetType = a.[Type] or CHANNEL.AssetType = ''ALL'') 

	LEFT JOIN [ARM_CORE]..[A_CollectionItem] qi on qi.ItemID = a.AssetID and qi.CollectionID = CHANNEL.QualifyingCID
	LEFT JOIN [ARM_CORE]..[A_CollectionItem] ai on ai.ItemID = a.AssetID and ai.CollectionID = CHANNEL.AdditionalCID

	where c.CollectionID in (' + @CollectionIDs + ') and (
		(CHANNEL.QualifyingCID = 0  and CHANNEL.AdditionalCID = 0 )
	or	(NOT qi.ItemID IS NULL and CHANNEL.AdditionalCID = 0 )
	or	(CHANNEL.QualifyingCID = 0 and NOT ai.ItemID IS NULL )
	or	(NOT qi.ItemID IS NULL and NOT ai.ItemID IS NULL )
	)
	'

	EXECUTE(@Query)
	
END

GO

CREATE PROCEDURE [dbo].[CheckAllTasks]
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	DECLARE @myTaskID int
	DECLARE @myConditionID int
	DECLARE @myCheckID int
	DECLARE @myItemID nvarchar(500)
	DECLARE @myItemType nvarchar(500)
	DECLARE @myActionID int
	DECLARE @UserID nvarchar(255) 

	DECLARE @tasks int SET @tasks = 0

	DECLARE db_tasks CURSOR FOR 

		select t.taskID, IsNull(t.ConditionCollectionID,0) as ConditionCollectionID, iif(IsNull(t.ConditionCollectionID,0)=0,1,(select count(i.CollectionID) from [ARM_CORE]..[A_CollectionItem] i where i.itemid = t.ItemID and i.CollectionID  = IsNull(t.ConditionCollectionID,0))) as CheckID 
			,IsNull(t.ItemID,'') as [_ItemID], t.ItemType, a.ActionID, t.UserID
		from [ARM_CORE]..[A_Task] t  
		LEFT JOIN [ARM_CORE]..[A_TaskAction] a on a.ActionID = t.ActionID 
		where isnull(t.[End],'') = ''  

	OPEN db_tasks  
    
	FETCH NEXT FROM db_tasks INTO @myTaskID, @myConditionID, @myCheckID, @myItemID, @myItemType, @myActionID , @UserID  
 
	WHILE @@FETCH_STATUS = 0  
	BEGIN  
 
		if @myCheckID = 0 
			BEGIN

				MERGE [ARM_CORE]..[A_TaskResponse] as Target using (
					select @myTaskID as [TaskID], @userID as [UserID], @myActionID as [ActionID], -1 as [ActionOptionID], 'SYS_CANCELLED' as [Value], 'Task no longer required; Either fullfilled elsewhere or cancelled.' as [AdditionalInfo]
				) as Source
				ON (target.taskID  = source.taskID)
				WHEN NOT MATCHED BY TARGET THEN 
					insert ([TaskID],[UserID],[ActionID],[ActionOptionID],[Value],[AdditionalInfo]) Values (Source.[TaskID], Source.[UserID], Source.[ActionID], Source.[ActionOptionID], Source.[Value], Source.[AdditionalInfo]); 


				update [ARM_CORE]..[A_Task] set [END] = getdate() where taskID = @myTaskID;

				delete from [Alert] where taskID = @myTaskID;

			END
		ELSE
			set @tasks = @tasks + 1

		FETCH NEXT FROM db_tasks INTO @myTaskID, @myConditionID, @myCheckID, @myItemID, @myItemType, @myActionID   , @UserID  
 
	END 
 
	CLOSE db_tasks  
	DEALLOCATE db_tasks 

	-- Remove any stale Alert that is older than 60 days.

	delete from [Alert] where datediff(day,CreatedOn,getdate()) > 60
--	select * from  [Alert] where datediff(day,getdate(),CreatedOn) > 10

	select @tasks as [Count]
END


GO
CREATE PROCEDURE [dbo].[Chart-Burndown]
	@Total	int = 1000,
	@STARTDATE Date = NULL,
	@ENDDATE Date = NULL,
--	@ExcludeDays nvarchar(500) = '',
	@DataTable nvarchar(100) = NULL,
	@DataKey nvarchar(100) = 'Date',
	@DataFields nvarchar(500) = '',
	@DataWhere nvarchar(100) = ''
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON

	-- Works out a burn rate from start to finish
	-- Numbers are cast to float during calculation to reduce rounding errors

	IF @STARTDATE IS NULL SELECT @STARTDATE = DATEADD(DAY,0,getdate());
	IF @ENDDATE IS NULL SET @ENDDATE = getdate()

	DECLARE @DayIntervals INTEGER;
	DECLARE @BurnDown FLOAT;

	SELECT @DayIntervals = DATEDIFF(day,@STARTDATE,@ENDDATE) 
	SELECT @BurnDown = cast(@Total as Float) / cast(@DayIntervals as float)

	;WITH CTE_DATES
	AS
	(
		SELECT @STARTDATE AS [DATE],
		0 AS [Level], @Total as [Remaining]
		UNION ALL
		SELECT 
			DATEADD(DAY,1, [DATE] )  , [Level] + 1  , cast(Round((@DayIntervals - ([Level]+1)) * @BurnDown,0) as int)
		FROM CTE_DATES
		WHERE [DATE] < @ENDDATE
	)
	SELECT 
		cast(c.[DATE] as nvarchar(50)) as [Date],
		c.[Remaining]
	INTO #tempBurnDownTable
	FROM CTE_DATES c
--	WHERE NOT DATEPART(dw,[Date]) in (@ExcludeDays)
	ORDER BY c.[DATE] ASC
	OPTION (MAXRECURSION 1000);


	IF @DataTable IS NULL 
		select [Date], [Remaining] from  #tempBurnDownTable
--		select * from #tempBurnDownTable
	ELSE
	BEGIN
		DECLARE @query VARCHAR(8000)

		IF NOT @DataFields = '' set @DataFields = ', ' + @DataFields 

		SET @query = '
			select d.[Date], case x when 1 then ' + cast(@Total as nvarchar(20)) + '  else Round( ( (cast (d.[Intervals] + 1 - d.[x] as float) *  ' + cast(@Total as nvarchar(20)) + '  / cast(d.[Intervals] as float)  ) ),0) end as Remaining ' + @DataFields + ' from (
				select x, (select Count(*)-1 from #tempBurnDownTable t LEFT JOIN ' + @DataTable  + ' d on d.[' + @DataKey + '] = t.[Date] ' + @DataWhere + ') as Intervals, d.[' + @DataKey + '] ' + @DataFields + ' from (
					SELECT Row_Number() over (order by t.[date]) as x, 1 as r, t.[Date] ' + @DataFields + ' FROM #tempBurnDownTable t
					LEFT JOIN ' + @DataTable  + ' d on d.[' + @DataKey + '] = t.[Date] ' + @DataWhere + '
				) d 
			) d
			ORDER BY d.[Date] Asc
		'

		EXECUTE(@query)
	END

	DROP TABLE #tempBurnDownTable
END


GO
-- =============================================
-- Author:             <Author,,Name>
-- Create date: <Create Date,,>
-- Description:        <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Channel-DYN-CollectionIDs]
        -- Add the parameters for the stored procedure here
        @ChannelID as int = 0
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
        SET NOCOUNT ON;
    -- Insert statements for procedure here
        select c.CollectionID AS DynamicValue, c.Name AS DynamicLabel
        from [ARM_CORE]..[ScheduleChannel] s
        LEFT JOIN [ARM_CORE]..[Workstream] w on w.WorkstreamID = s.WorkstreamID
		LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionClassID = w.KeyStatusID
        where s.ChannelID =  @ChannelID
        Order by c.[Order] 
END

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[CalculateBitValues]
   @Table nvarchar(255) = '',
   @Pass int =0,
   @Field nvarchar(255) = 'BitStatus'
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	DECLARE @query VARCHAR(8000)

	DECLARE @aConditionalSQL nvarchar(3000)
	DECLARE @aConditionClassID int
	DECLARE @aConditionCID int
	DECLARE @aBitPosition smallint
	DECLARE @aIdentity nvarchar(500)



	DECLARE BitValues CURSOR FOR 
		select b.ConditionSQL, BitPosition, IsNull(ConditionClassID,0) as ConditionClassID, IsNull(ConditionCID,0) as ConditionCID,  [IdentityID] from [ARM_CORE]..[A_BitCondition] b where isNull(Active,0) = 1 and isNull(Pass,0) = @pass and b.[Table] = @Table and b.[Field] = @Field order by [Order]

	OPEN BitValues  
    
	FETCH NEXT FROM BitValues INTO @aConditionalSQL, @aBitPosition, @aConditionClassID, @aConditionCID, @aIdentity  



	WHILE @@FETCH_STATUS = 0  
	BEGIN 

		set @query = 'update [ARM_CORE]..[' + @Table + '] set [' + @Field + '] = [' + @Field + '] - case when Power(CONVERT(bigint,2),' + cast(@aBitPosition as nvarchar(20)) + '-1) & [' + @Field + '] > 0 then Power(CONVERT(bigint,2),' + cast(@aBitPosition as nvarchar(20)) + '-1) else 0 end'

		EXECUTE(@query)
		
		if @aConditionClassID <> 0 
		BEGIN
			set @aConditionalSQL = dbo.[Criteria-Class-fn] (@aConditionClassID, @Table)
		END
		else if @aConditionCID <> 0 
		BEGIN
			set @aConditionalSQL = 'select itemID as [' + @aIdentity + '], 1 [RESULT] from [ARM_CORE]..[A_CollectionItem] where CollectionID = ' + cast(@aConditionCID as nvarchar(20))
		END

		set @query = '
			MERGE [ARM_CORE]..[' + @Table + '] as TARGET
			USING (
				select v.*, Power(CONVERT(bigint,2),' + cast(@aBitPosition as nvarchar(20)) + '-1) as BitValue from (
				' + @aConditionalSQL + '
				) v where [RESULT] = 1
			) as SOURCE
			On (TARGET.[' + @aIdentity + '] = SOURCE.[' + @aIdentity + '])
			WHEN MATCHED THEN
				UPDATE set TARGET.[' + @Field + '] = IsNull(TARGET.[' + @Field + '],0) + SOURCE.[BitValue] ;
		'	

		EXECUTE(@query)

		FETCH NEXT FROM BitValues INTO @aConditionalSQL, @aBitPosition, @aConditionClassID, @aConditionCID, @aIdentity  
		
	END 
 
	CLOSE BitValues  
	DEALLOCATE BitValues 
		
		
END

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[CalculateBitValueNow]
   @BitConditionID int = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	DECLARE @query VARCHAR(8000)

	DECLARE @aConditionalSQL nvarchar(3000)
	DECLARE @aConditionClassID int
	DECLARE @aConditionCID int
	DECLARE @aBitPosition smallint
	DECLARE @aIdentity nvarchar(500)

	DECLARE @Table nvarchar(255) 
	DECLARE @Field nvarchar(255) 



	DECLARE BitValues CURSOR FOR 
		select b.ConditionSQL, BitPosition, IsNull(ConditionClassID,0) as ConditionClassID, IsNull(ConditionCID,0) as ConditionCID,  [IdentityID], [Table], [Field] from [ARM_CORE]..[A_BitCondition] b where BitConditionID = @BitConditionID order by [Order]

	OPEN BitValues  
    
	FETCH NEXT FROM BitValues INTO @aConditionalSQL, @aBitPosition, @aConditionClassID, @aConditionCID, @aIdentity, @Table, @Field 



	WHILE @@FETCH_STATUS = 0  
	BEGIN 

		set @query = 'update [ARM_CORE]..[' + @Table + '] set [' + @Field + '] = [' + @Field + '] - case when Power(CONVERT(bigint,2),' + cast(@aBitPosition as nvarchar(20)) + '-1) & [' + @Field + '] > 0 then Power(CONVERT(bigint,2),' + cast(@aBitPosition as nvarchar(20)) + '-1) else 0 end'

		EXECUTE(@query)
		
		if @aConditionClassID <> 0 
		BEGIN
			set @aConditionalSQL = dbo.[Criteria-Class-fn] (@aConditionClassID, @Table)
		END
		else if @aConditionCID <> 0 
		BEGIN
			set @aConditionalSQL = 'select itemID as [ApplicationID], 1 [RESULT] from [ARM_CORE]..[A_CollectionItem] where CollectionID = ' + cast(@aConditionCID as nvarchar(20))
		END

		set @query = '
			MERGE [ARM_CORE]..[' + @Table + '] as TARGET
			USING (
				select v.*, Power(CONVERT(bigint,2),' + cast(@aBitPosition as nvarchar(20)) + '-1) as BitValue from (
				' + @aConditionalSQL + '
				) v where [RESULT] = 1
			) as SOURCE
			On (TARGET.[' + @aIdentity + '] = SOURCE.[' + @aIdentity + '])
			WHEN MATCHED THEN
				UPDATE set TARGET.[' + @Field + '] = IsNull(TARGET.[' + @Field + '],0) + SOURCE.[BitValue] ;
		'	

		EXECUTE(@query)

		FETCH NEXT FROM BitValues INTO @aConditionalSQL, @aBitPosition, @aConditionClassID, @aConditionCID, @aIdentity, @Table, @Field 
		
	END 
 
	CLOSE BitValues  
	DEALLOCATE BitValues 
		
		
END

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[CalculateAllBitValues]
@pass int = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	
	-- currently onl.y Asset, User and Application supported
	-- Default field for calculation is [BitStatus]

	EXEC [ARM_CORE]..[CalculateBitValues] 'AppGroup',  @pass

	EXEC [ARM_CORE]..[CalculateBitValues] 'Application',  @pass
	EXEC [ARM_CORE]..[CalculateBitValues] 'Asset', @pass

	EXEC [ARM_CORE]..[CalculateBitValues] 'User',  @pass






END

GO
CREATE PROCEDURE [dbo].[BArea-Readiness-Pivot-SPOC]
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;


	SELECT x.BArea, x.[Name], Sum(x.[Total]) as Total 
	INTO #tempPivotTable
	from (
		SELECT IsNull(a.[BArea],'') as BArea, c.Name, c.Total, 0 as [Order]
		from (
			select distinct IsNull(x.[BArea],'') as BArea, 1 as flag from [ARM_CORE]..[Asset] x where x.Live = 1
			) a 
			FULL OUTER JOIN (
				SELECT distinct c.Name, 0 as total, 1 as flag
				from [ARM_CORE]..[A_Collection] c LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc on cc.CollectionClassID = c.CollectionClassID
				where cc.CLASSREF = 'ReadinessCriteria'
				UNION
					SELECT 'Deployed' as Name, 0, 1
			) c on c.flag = a.flag
		UNION
			SELECT a.BArea, c.Name, Count(i.ItemID) as [Total], c.[Order]
			from [ARM_CORE]..[A_Collection] c LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc on cc.CollectionClassID = c.CollectionClassID
			LEFT JOIN [ARM_CORE]..[A_CollectionItem] i on i.CollectionID = c.CollectionID LEFT JOIN [ARM_CORE]..[Asset] a on a.AssetID = i.ItemID
			where cc.CLASSREF = 'ReadinessCriteria' and a.Live=1 and dbo.[CheckBitStatus](a.BitStatus,'Deployment','Deployed')=0
			group by a.BArea, c.Name, c.CriteriaState, c.[Order], c.CollectionID  
		UNION
			SELECT a.BArea, 'Deployed' as [Name], count(ItemID) as [Total], 5000 from [ARM_CORE]..[A_CollectionItem] i
			LEFT JOIN [ARM_CORE]..[Asset] a on a.AssetID = i.ItemID
			where CollectionID = 108 group by BArea, CollectionID
	) x
	group by  x.BArea, x.[Name], x.[Order] order by x.BArea, x.[Order]



	DECLARE @Columns VARCHAR(MAX)

	SELECT @columns = STUFF(( SELECT TOP 100 PERCENT
									'],[' + cast(c.Name as varchar)					
							FROM [ARM_CORE]..[A_Collection] c 
							LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc on cc.CollectionClassID = c.CollectionClassID
							where cc.CLASSREF = 'ReadinessCriteria'
							ORDER BY c.[Order],'],[' + cast(c.[Name] as varchar) 
							FOR XML PATH('')
						  ), 1, 2, '') + '],[Deployed]'

	DECLARE @query VARCHAR(8000)

	SET @query = '
	SELECT distinct p.*
	FROM #tempPivotTable q
	PIVOT
	(
	Sum([Total])
	FOR [Name]
	IN (' + @columns + ')
	)
	AS p 
	LEFT JOIN [ARM_CORE]..[SPOC] s on p.BARea like s.BArea+''%''
	where NOT s.SpocID IS NULL 
    order by p.BArea'


	EXECUTE(@query)


	DROP TABLE #tempPivotTable
END






GO
CREATE PROCEDURE [dbo].[BArea-Readiness-Pivot-NON-SPOC]
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;


	SELECT x.BArea, x.[Name], Sum(x.[Total]) as Total 
	INTO #tempPivotTable
	from (
		SELECT IsNull(a.[BArea],'') as BArea, c.Name, c.Total, 0 as [Order]
		from (
			select distinct IsNull(x.[BArea],'') as BArea, 1 as flag from [ARM_CORE]..[Asset] x where x.Live = 1
			) a 
			FULL OUTER JOIN (
				SELECT distinct c.Name, 0 as total, 1 as flag
				from [ARM_CORE]..[A_Collection] c LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc on cc.CollectionClassID = c.CollectionClassID
				where cc.CLASSREF = 'ReadinessCriteria'
				UNION
					SELECT 'Deployed' as Name, 0, 1
			) c on c.flag = a.flag
		UNION
			SELECT a.BArea, c.Name, Count(i.ItemID) as [Total], c.[Order]
			from [ARM_CORE]..[A_Collection] c LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc on cc.CollectionClassID = c.CollectionClassID
			LEFT JOIN [ARM_CORE]..[A_CollectionItem] i on i.CollectionID = c.CollectionID LEFT JOIN [ARM_CORE]..[Asset] a on a.AssetID = i.ItemID
			where cc.CLASSREF = 'ReadinessCriteria' and a.Live=1 and dbo.[CheckBitStatus](a.BitStatus,'Deployment','Deployed')=0
			group by a.BArea, c.Name, c.CriteriaState, c.[Order], c.CollectionID  
		UNION
			SELECT a.BArea, 'Deployed' as [Name], count(ItemID) as [Total], 5000 from [ARM_CORE]..[A_CollectionItem] i
			LEFT JOIN [ARM_CORE]..[Asset] a on a.AssetID = i.ItemID
			where CollectionID = 108 group by BArea, CollectionID
	) x
	group by  x.BArea, x.[Name], x.[Order] order by x.BArea, x.[Order]



	DECLARE @Columns VARCHAR(MAX)

	SELECT @columns = STUFF(( SELECT TOP 100 PERCENT
									'],[' + cast(c.Name as varchar)					
							FROM [ARM_CORE]..[A_Collection] c 
							LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc on cc.CollectionClassID = c.CollectionClassID
							where cc.CLASSREF = 'ReadinessCriteria'
							ORDER BY c.[Order],'],[' + cast(c.[Name] as varchar) 
							FOR XML PATH('')
						  ), 1, 2, '') + '],[Deployed]'

	DECLARE @query VARCHAR(8000)

	SET @query = '
	SELECT distinct p.*
	FROM #tempPivotTable q
	PIVOT
	(
	Sum([Total])
	FOR [Name]
	IN (' + @columns + ')
	)
	AS p 
	LEFT JOIN [ARM_CORE]..[SPOC] s on p.BARea like s.BArea+''%''
	where s.SpocID IS NULL 
    order by p.BArea'


	EXECUTE(@query)


	DROP TABLE #tempPivotTable
END






GO
CREATE PROCEDURE [dbo].[BArea-Readiness-Pivot]
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;


	SELECT x.BArea, x.[Name], Sum(x.[Total]) as Total 
	INTO #tempPivotTable
	from (
		SELECT IsNull(a.[BArea],'') as BArea, c.Name, c.Total, 0 as [Order]
		from (
			select distinct IsNull(x.[BArea],'') as BArea, 1 as flag from [ARM_CORE]..[Asset] x where x.Live = 1
			) a 
			FULL OUTER JOIN (
				SELECT distinct c.Name, 0 as total, 1 as flag
				from [ARM_CORE]..[A_Collection] c LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc on cc.CollectionClassID = c.CollectionClassID
				where cc.CLASSREF = 'ReadinessCriteria'
				UNION
					SELECT 'Deployed' as Name, 0, 1
			) c on c.flag = a.flag
		UNION
			SELECT a.BArea, c.Name, Count(i.ItemID) as [Total], c.[Order]
			from [ARM_CORE]..[A_Collection] c LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc on cc.CollectionClassID = c.CollectionClassID
			LEFT JOIN [ARM_CORE]..[A_CollectionItem] i on i.CollectionID = c.CollectionID LEFT JOIN [ARM_CORE]..[Asset] a on a.AssetID = i.ItemID
			where cc.CLASSREF = 'ReadinessCriteria' and a.Live=1 and dbo.[CheckBitStatus](a.BitStatus,'Deployment','Deployed')=0
			group by a.BArea, c.Name, c.CriteriaState, c.[Order], c.CollectionID  
		UNION
			SELECT a.BArea, 'Deployed' as [Name], count(ItemID) as [Total], 5000 from [ARM_CORE]..[A_CollectionItem] i
			LEFT JOIN [ARM_CORE]..[Asset] a on a.AssetID = i.ItemID
			where CollectionID = 108 group by BArea, CollectionID
	) x
	group by  x.BArea, x.[Name], x.[Order] order by x.BArea, x.[Order]



	DECLARE @Columns VARCHAR(MAX)

	SELECT @columns = STUFF(( SELECT TOP 100 PERCENT
									'],[' + cast(c.Name as varchar)					
							FROM [ARM_CORE]..[A_Collection] c 
							LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc on cc.CollectionClassID = c.CollectionClassID
							where cc.CLASSREF = 'ReadinessCriteria'
							ORDER BY c.[Order],'],[' + cast(c.[Name] as varchar) 
							FOR XML PATH('')
						  ), 1, 2, '') + '],[Deployed]'

	DECLARE @query VARCHAR(8000)

	SET @query = '
	SELECT distinct p.*
	FROM #tempPivotTable q
	PIVOT
	(
	Sum([Total])
	FOR [Name]
	IN (' + @columns + ')
	)
	AS p 
    order by p.BArea'


	EXECUTE(@query)


	DROP TABLE #tempPivotTable
END






GO

-- =============================================
-- Author:		John Reed
-- alter date: 26-11-2016
-- Description:	generates list of Assets with EMails for use within Auto Notifcation sub system
-- =============================================
CREATE PROCEDURE [dbo].[AUTO-Schedule2]
	@ChannelID as int = 0,
	@Offset as int = 0,
	@templateID as nvarchar(10) = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	select r.[AssetID], IsNull(a.[Email],'') AS Email, IsNull(a.[Email],'') AS [OWNEREMAIL], IsNull(a.[Owner],'') AS [Owner], IsNull(a.[USERID],'') AS [USERID], IsNull(a.[Location],'') AS Location, r.[RUNID], d.[RunDate] AS [DATE], d.[RunDate] AS [RUNDATE], d.[RunDate] AS [BDATE], a.[TYPE], 
		IsNull(b.BID,'-1') as BID, IsNull(t.TID,'-1') AS TID, IsNull(t.Label,'UNSPECIFIED') as BTIME, a.[OS], a.[BArea], IsNull(u.[FIRSTNAME],'Colleague') as FIRSTNAME, IsNull(x.EngDeployed,0) as Deployed,
		IsNull ( (select top 1 k.Model from [ARM_CORE]..[Asset] k where k.AssetID = x.[ReplaceWith]),'' ) as NewModel, IsNull(m.ToBeModel,'') as ToBeModel, IsNull(x.[ReplaceWith],'') as [ReplaceWith], 
		IsNull(altO.AltTargetOS, IsNULL( (select top 1 om.[TargetOS] from OSMappings om where om.[InitialOS] like a.[OS]+'%' ),'')) as NewOS, 
		isNull(a.Custom01,'') as Custom01, IsNull(a.Custom02,'') AS Custom02, IsNull(a.Custom03,'') as Custom03, IsNull(a.Custom04,'') as Custom04, IsNull(a.Custom05,'') as Custom05,
		d.[ChannelID] as [CID], c.[Name] AS [CHANNEL], d.[SLOTID], c.WorkstreamID, DATEName(month,d.[RunDate]) as [MONTH], IsNull(i.TheText,'') AS BINSTRUCTIONS  
		from [ARM_CORE]..[ScheduleDeployRun] d 
		LEFT JOIN [ARM_CORE]..[ScheduleDeployRunAsset] r ON r.RunID = d.RunID  
		LEFT JOIN [ARM_CORE]..[Asset] a  ON a.AssetID = r.AssetID  
		LEFT JOIN [ARM_CORE]..[AssetStatus] x  ON x.AssetID = r.AssetID  
		LEFT JOIN [ARM_CORE]..[ScheduleChannel] c ON c.ChannelID = d.ChannelID  
		LEFT JOIN [ARM_CORE]..[ScheduleBookDay] b ON b.ChannelID = d.[ChannelID] and b.TheDate = d.[RunDate]  
		LEFT JOIN [ARM_CORE]..[ScheduleBooking] z ON z.AssetID = r.AssetID  and z.RunID = d.RunID
		LEFT JOIN [ARM_CORE]..[ScheduleTimeSlot] t on t.BID = b.BID and t.TID = z.TID  
		LEFT JOIN [ARM_CORE]..[ScheduleInstruction] i ON i.ChannelID = d.[ChannelID]  
		LEFT JOIN [ARM_CORE]..[User] u on u.UserID = a.UserID 
		LEFT JOIN [ARM_CORE]..[ModelToBe] m ON m.AssetID = r.AssetID 
		LEFT JOIN [ARM_CORE]..[AltModelType] altM on altM.[AssetID] = a.AssetID 
		LEFT JOIN [ARM_CORE]..[AltTargetOS] altO on altO.[AssetID] = a.AssetID 
		LEFT JOIN [ARM_CORE]..[NotificationLog] n on  n.Email = a.[Email] and DATEDIFF(d, n.WhenSent, { fn NOW() }) = 0 and n.templateID = @templateID
		where d.RunDate = convert(date,getDate()+@Offset) AND IsNull(d.ChannelID,-1) = @ChannelID and IsNULL(a.[Email],'') <> '' 
			and n.NotificationLogID IS NULL 
END


GO


-- =============================================
-- Author:		John Reed
-- alter date: 26-11-2016
-- Description:	generates list of Assets with EMails for use within Auto Notifcation sub system
-- =============================================
CREATE PROCEDURE [dbo].[AUTO-Schedule]
	@ChannelID as int = 0,
	@Offset as int = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	select r.[AssetID], IsNull(a.[Email],'') AS Email, IsNull(a.[Owner],'') AS [Owner], IsNull(a.[Location],'') AS Location, r.[RunID], d.[RunDate] AS [DATE], a.[TYPE], 
		IsNull(b.BID,'-1') as BID, IsNull(t.TID,'-1') AS TID, IsNull(t.Label,'UNSPECIFIED') as BTIME, a.[OS], a.[BArea], IsNull(u.[FIRSTNAME],'Colleague') as FIRSTNAME, IsNull(x.EngDeployed,0) as Deployed, 
		isNull(a.Custom01,'') as Custom01, IsNull(a.Custom02,'') AS Custom02, IsNull(a.Custom03,'') as Custom03, IsNull(a.Custom04,'') as Custom04, IsNull(a.Custom05,'') as Custom05,
		d.[ChannelID] as [CID], c.[Name] AS [CHANNEL], s.[SlotID], IsNull(i.TheText,'') AS BINSTRUCTIONS  
		from [ARM_CORE]..[ScheduleDeployRun] d 
		LEFT JOIN [ARM_CORE]..[ScheduleDeployRunAsset] r ON r.RunID = d.RunID  
		LEFT JOIN [ARM_CORE]..[Asset] a  ON a.AssetID = r.AssetID  
		LEFT JOIN [ARM_CORE]..[AssetStatus] x  ON x.AssetID = r.AssetID  
		LEFT JOIN [ARM_CORE]..[ScheduleChannel] c ON c.ChannelID = d.ChannelID  
		LEFT JOIN [ARM_CORE]..[ScheduleSlot] s ON s.SlotID = d.SlotID  
		LEFT JOIN [ARM_CORE]..[ScheduleBookDay] b ON b.ChannelID = d.[ChannelID] and b.TheDate = d.[RunDate]  
		LEFT JOIN [ARM_CORE]..[ScheduleBooking] z ON z.AssetID = r.AssetID  and z.RunID = d.RunID
		LEFT JOIN [ARM_CORE]..[ScheduleTimeSlot] t on t.BID = b.BID and t.TID = z.TID  
		LEFT JOIN [ARM_CORE]..[ScheduleInstructions] i ON i.ChannelID = d.[ChannelID]  
		LEFT JOIN [ARM_CORE]..[User] u on u.Email = a.Email 
		where d.RunDate = convert(date,getDate()+@Offset) AND IsNull(d.ChannelID,-1) = @ChannelID and IsNULL(a.[Email],'') <> '' 
END


GO


-- =============================================
-- Author:		John Reed
-- Description:	Generates list of Assets That are ready but not confirmed
-- =============================================
CREATE PROCEDURE [dbo].[AUTO-ReadyNotConfirmed]
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.




	SET NOCOUNT ON;

select distinct a.[AssetID], IsNull(a.[Owner],'') AS Owner, IsNull(a.[Email],'') AS Email, a.[BArea], a.[Location]
from [ARM_CORE]..[Asset] a 
left JOIN [ARM_CORE]..[AssetCache] z on z.AssetID = a.AssetID 
left JOIN [ARM_CORE]..[AssetStatus] s on s.AssetID = a.AssetID 
left JOIN [ARM_CORE]..AppAstAsIs e on e.AssetID = a.AssetID 
LEFT JOIN [ARM_CORE]..[ScheduleDeployRunAsset] r on r.AssetID = a.AssetID 
LEFT JOIN [ARM_CORE]..[ScheduleDeployRun] d ON d.RunID = r.RunID 
LEFT JOIN [ARM_CORE]..[BAreas] b ON b.BArea = a.BArea 
where b.Internal = 0 and (a.[BArea] like 'APEL%' or a.[BArea] like 'APL%' or a.[BArea] like '%Leiden%' )
and IsNull(s.[EngDeployed],0) <> 1
and (select Count(f.[ApplicationID]) 
		from [ARM_CORE]..[AppAstToBe] f 
		LEFT JOIN [ARM_CORE]..[Application] g ON g.[ApplicationID] = f.[ApplicationID] 
		LEFT JOIN [ARM_CORE]..[A_Lookup] lu ON lu.[Table] = 'Internal' 
		where f.AssetID = a.AssetID and IsNull(g.DeployType,'-') <> 'B' and IsNull(lu.[Label],'*') <> 'R' and IsNull(lu.[Label],'*') <> 'B' and IsNull(lu.[Label],'*') <> 'X' 
	) = (select Count(f.[ApplicationID]) 
		from [ARM_CORE]..[AppAstToBe] f 
		LEFT JOIN [ARM_CORE]..[Application] g ON g.[ApplicationID] = f.[ApplicationID] 
		LEFT JOIN [ARM_CORE]..[A_Lookup] lu ON lu.[Table] = 'Internal' 
		where f.AssetID = a.AssetID and IsNull(g.DeployType,'-') <> 'B' and IsNull(lu.[Label],'*') <> 'R' and IsNull(lu.[Label],'*') <> 'B' and IsNull(lu.[Label],'*') <> 'X' and g.[Ready] = 1
	)
and IsNull((select TOP 1 h.[Label] from [ARM_CORE]..[ScheduleDeployRun] h LEFT JOIN [ARM_CORE]..[ScheduleDeployRunAsset] r on h.RunID = r.RunID where r.AssetID = a.[AssetID] and h.RunDate >= convert(date,getDate()) order by h.Rundate Asc ),'') = ''
and (select Count(f.[ApplicationID]) from [ARM_CORE]..[AppAstAsIs] f LEFT JOIN [ARM_CORE]..[Application] g ON g.[ApplicationID] = f.[ApplicationID] where f.AssetID = a.AssetID ) > 0 
ORDER BY a.[BArea], a.[Location], Owner  ASC 
END



GO
-- =============================================
-- Author:		John Reed
-- alter date: 26-11-2016
-- Description:	generates list of Assets with Emails for use within Auto Notifcation sub system. Condition of use is MUST return valid AssetID with an Email address as minimum
-- =============================================
CREATE PROCEDURE [dbo].[AUTO-GetTableFromViewID]
	@viewID as int = 0
AS
BEGIN


	DECLARE @viewSQL as nvarchar(3000)

	SET NOCOUNT ON;

	select @viewSQL = [sql] from [ARM_CORE]..[Views] where ViewID = @viewID

	execute( @viewSQL );

END




GO


-- =============================================
-- Author:		John Reed
-- alter date: 19-12-2016
-- Description:	generates tracking counters and used via Auto Notifications
-- =============================================
CREATE PROCEDURE [dbo].[AUTO-DailyCounters]
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from


	SET NOCOUNT ON;

select 
	(select Count(s.AssetID) from [ARM_CORE]..[AssetStatus] s LEFT JOIN [ARM_CORE]..[Asset] a on a.AssetID = s.AssetID LEFT JOIN [ARM_CORE]..[BArea] b on b.BArea = a.BArea where s.EngDeployed = 1 and s.AssetID like '%[AM][0123456789][0123456789][0123456789]' and isNull(b.Internal,0) = 0) as [Windows 10   ],
	(select Count(a.AssetID) from [ARM_CORE]..[Asset] a LEFT JOIN [ARM_CORE]..[AssetStatus] s on s.AssetID = a.AssetID LEFT JOIN [ARM_CORE]..[BArea] b on b.BArea = a.BArea 
		where IsNull(s.EngDeployed,0) = 0 and NOT a.AssetID like '%[AM][0123456789][0123456789][0123456789]' and isNull(b.Internal,0) = 0
	) as [Remaining   ],
	(select Count(a.AssetID) from [ARM_CORE]..[Asset] a LEFT JOIN [ARM_CORE]..[AssetStatus] s on s.AssetID = a.AssetID LEFT JOIN [ARM_CORE]..[BArea] b on b.BArea = a.BArea 
		where IsNull(s.EngDeployed,0) = 0 and NOT a.AssetID like '%[AM][0123456789][0123456789][0123456789]' and isNull(b.Internal,0) = 0
	) as [Deferred   ],
	(Select Count(distinct r.AssetID) 
		  from [ARM_CORE]..[ScheduleDeployRun] d
		  LEFT Join [ARM_CORE]..[ScheduleDeployRunAsset] r on r.RunID = d.RunID
		  LEFT Join [ARM_CORE]..[Asset] a on a.AssetID = r.AssetID 
		  Where  d.RunDate >= getDate() - 1 
	) as [Scheduled   ],
	(select  Count(distinct r.AssetID) from [ARM_CORE]..[ScheduleDeployRun] d   
		LEFT Join [ARM_CORE]..[ScheduleDeployRunAsset] r on r.RunID = d.RunID
		LEFT JOIN [ARM_CORE]..[AssetStatus] s on s.AssetID = r.AssetID
		where ( d.RunDate > getDate()-1 and d.RunDate < getDate() ) and  NOT s.EngDeployed = 1
	) as [Booked for Today]
END


GO
-- =============================================
-- Author:		John Reed
-- alter date: 26-11-2016
-- Description:	generates list of Assets with Emails for use within Auto Notifcation sub system. Condition of use is MUST return valid AssetID with an Email address as minimum
-- =============================================
CREATE PROCEDURE [dbo].[AUTO-Collection3]
	@CollectionID as int = 0,
	@Throttle as int = 99999,
	@Condition as nvarchar(1000) = '',
	@templateID as nvarchar(10) = '0'
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.


	DECLARE @CollectionType as nvarchar(255)
	DECLARE @query nvarchar(max)
	DECLARE @logCheck nvarchar(max)

	SET NOCOUNT ON;

	select @CollectionType = UPPER(IsNull(c.[Type],'ASSET')) from [ARM_CORE]..A_Collection c where c.CollectionID = @CollectionID


	-- Default is ASSET

	
	IF @CollectionType = 'USER'  
		BEGIN
--		SET @query = '
			SELECT  'USER' as [NOTIFICATIONTYPE], i.[TAGGEDON], DATEDIFF(d, i.[TAGGEDON], { fn NOW() }) as DaysSince, [USERID], i.[ITEMID], [USERNAME], [DEPARTMENT], [BUSINESSUNIT], [LOCATION] ,[JOBTITLE], [VIP], [TELEPHONE], [MOBILE], Email as [USEREMAIL], [EMAIL], [LIVE], [HEARTBEAT] 
				,[NOTES], [CUSTOM01], [CUSTOM02], [CUSTOM03], [CUSTOM04], [CUSTOM05], [FIRSTNAME], [DOMAIN], [DIRECTMANAGER] , [COLLECTIONID]
				into ##CandidatesUSER
				from [ARM_CORE]..[A_CollectionItem] i
				LEFT JOIN  [ARM_CORE]..[User] u on u.UserID = i.ItemID
				where i.CollectionID = @CollectionID AND IsNULL(u.[Email],'') <> ''
			Order by i.[TaggedOn]
--			' + @Condition + ' Order by i.[TaggedOn] '

			SET @query = 'select * from ##CandidatesUSER where 1=1 ' + @Condition

		END
	ELSE IF @CollectionType = 'APPLICATION'  
		BEGIN
--			SET @query = '

			select  'APPLICATION' as [NOTIFICATIONTYPE], i.[TAGGEDON], DATEDIFF(d, i.[TAGGEDON], { fn NOW() }) as DaysSince, a.ApplicationID as APPLICATIONID, i.[ITEMID], a.NAME as [APPNAME], a.VERSION, a.LOCALID, a.DEPLOYTYPE, a.READY, a.PACKAGEID, a.APPGROUPID, g.APPGROUPNAME , i.[COLLECTIONID]
				into ##CandidatesAPPS
				from [ARM_CORE]..[A_CollectionItem] i
				LEFT JOIN ARM_CORE..[Application] a on a.[ApplicationID] = i.[itemID]
				LEFT JOIN ARM_CORE..AppGroup g on g.AppGroupID =  a.AppGroupID 
				where i.CollectionID = @CollectionID
				Order by i.[TaggedOn]
--			' + @Condition + ' Order by i.[TaggedOn] '

			SET @query = 'select * from ##CandidatesAPPS where 1=1 ' + @Condition
		END
	ELSE IF @CollectionType = 'APPPACKAGEREQUEST'  
		BEGIN
--			SET @query = '

			select  'APPPACKAGEREQUEST' as [NOTIFICATIONTYPE], i.[TAGGEDON], DATEDIFF(d, i.[TAGGEDON], { fn NOW() }) as DaysSince, p.APRID, p.ApplicationID as APPLICATIONID, 
					i.[ITEMID], a.NAME as [APPNAME], a.VERSION, 
					a.LOCALID, a.DEPLOYTYPE, a.READY, a.PACKAGEID, a.APPGROUPID, g.APPGROUPNAME , i.[COLLECTIONID]
				into ##CandidatesAPPREQS
				from [ARM_CORE]..[A_CollectionItem] i
				LEFT JOIN [ARM_CORE]..[AppPackageRequest] p on p.APRID = i.[itemID]
				LEFT JOIN [ARM_CORE]..[Application] a on a.[ApplicationID] = p.[ApplicationID]
				LEFT JOIN [ARM_CORE]..[AppGroup] g on g.AppGroupID = a.AppGroupID 
				where i.CollectionID = @CollectionID
				Order by i.[TaggedOn]
--			' + @Condition + ' Order by i.[TaggedOn] '

			SET @query = 'select * from ##CandidatesAPPREQS where 1=1 ' + @Condition
		END
	ELSE
		BEGIN
--			SET @query = '
			select  'ASSET' as [NOTIFICATIONTYPE], i.[TAGGEDON], DATEDIFF(d, i.[TAGGEDON], { fn NOW() }) as DaysSince, a.[ASSETID], a.[ASSETTAG], i.[ITEMID], IsNull(a.[Email],'') AS EMAIL, a.BAREA, IsNull(a.[Owner],'') AS [OWNER], IsNull(u.[FirstName],'') AS FIRSTNAME, IsNull(a.[Location],'') AS LOCATION, a.[OS], a.[MODEL], a.[TYPE], i.[COLLECTIONID],
--					r.[RUNID], IsNull(d.[RunDate],'') as [RUNDATE], IsNull(d.[RunDate],'') AS [BDATE], 
--					b.BID,IsNull(t.TID,'0') AS TID,IsNull(t.Label,'UNSPECIFIED') as BTIME, 
				IsNull ( (select top 1 k.Model from [ARM_CORE]..[Asset] k where k.AssetID = j.[ReplaceWith]),'' ) as NEWMODEL, IsNull(m.ToBeModel,'') as TOBEMODEL, IsNull(j.[ReplaceWith],'') as [REPLACEWITH], 
				IsNull(altO.AltTargetOS,(select top 1 om.[TargetOS] from [ARM_CORE]..OSMappings om where om.[InitialOS] like a.[OS]+'%' )) AS NEWOS, 
				IsNull(a.Custom01,'') as CUSTOM01, IsNull(a.Custom02,'') as CUSTOM02, IsNull(a.Custom03,'') as CUSTOM03, IsNull(a.Custom04,'') as CUSTOM04, IsNull(a.Custom05,'') as CUSTOM05

--					,d.[ChannelID] as CID, c.[Name] AS CHANNEL, IsNull(h.TheText,'') AS [BINSTRUCTIONS] 
--					,IsNull(s.[SlotID],'') as [SLOTID], IsNull(s.[DayTxt],'') as [DAYTXT], s.[MONTH]  

				into ##Candidates
				from [ARM_CORE]..[A_CollectionItem] i
				LEFT JOIN [ARM_CORE]..[Asset] a  ON a.AssetID = i.ItemID 
--					LEFT JOIN [ARM_CORE]..[ScheduleDeployRunAsset] r ON r.AssetID = a.AssetID 
				LEFT JOIN [ARM_CORE]..[User] u on u.[Email] = a.[Email]
--					LEFT JOIN [ARM_CORE]..[ScheduleDeployRun] d ON d.RunID = r.RunID 
--					LEFT JOIN [ARM_CORE]..[ScheduleChannel] c ON c.ChannelID = d.ChannelID 
--					LEFT JOIN [ARM_CORE]..[ScheduleSlot] s ON s.SlotID = d.SlotID 
--					LEFT JOIN [ARM_CORE]..[ScheduleBookDay] b ON b.ChannelID = d.[ChannelID] and b.TheDate = d.[RunDate] 
--					LEFT JOIN [ARM_CORE]..[ScheduleBooking] z ON z.AssetID = r.AssetID and z.RunID = r.RunID
--					LEFT JOIN [ARM_CORE]..[ScheduleTimeSlot] t on t.BID = b.BID and t.TID = z.TID 
--					LEFT JOIN [ARM_CORE]..[ScheduleInstruction] h ON h.ChannelID = d.[ChannelID] 
				LEFT JOIN [ARM_CORE]..[AssetStatus] j on j.AssetID = a.AssetID 
				LEFT JOIN [ARM_CORE]..[ModelToBe] m ON m.AssetID = a.AssetID  
				LEFT JOIN [ARM_CORE]..[AltModelType] altM on altM.[AssetID]=a.AssetID 
				LEFT JOIN [ARM_CORE]..[AltTargetOS] altO on altO.[AssetID]=a.AssetID 
				where i.CollectionID = @CollectionID  AND IsNULL(a.[Email],'') <> ''
				Order by i.[TaggedOn] 
					
	--		' + @Condition + ' Order by i.[TaggedOn] ; '

			SET @query = 'select * from ##Candidates where 1=1 ' + @Condition
		END


	SET @query = 'select top (' + Cast(@throttle as nvarchar(50)) +') c.* from (' + @query + ') c 
		LEFT JOIN [ARM_CORE]..[NotificationLog] n on n.CollectionID = c.CollectionID and n.AssetID = c.ItemID and n.Email = c.Email and DATEDIFF(d, n.WhenSent, { fn NOW() }) = 0 and n.templateID = ' + @templateID + '
		where n.NotificationLogID IS NULL 
	'		
	
	EXECUTE(@query)
	
	If Exists(Select * from tempdb..sysobjects Where id = object_id('tempdb.dbo.##Candidates')) Drop TABLE ##Candidates
	If Exists(Select * from tempdb..sysobjects Where id = object_id('tempdb.dbo.##CandidatesUSERS')) Drop TABLE ##CandidatesUSERS
	If Exists(Select * from tempdb..sysobjects Where id = object_id('tempdb.dbo.##CandidatesAPPS')) Drop TABLE ##CandidatesAPPS
	If Exists(Select * from tempdb..sysobjects Where id = object_id('tempdb.dbo.##CandidatesAPPREQS')) Drop TABLE ##CandidatesAPPREQS
				
--	Select @query

END


GO
-- =============================================
-- Author:		John Reed
-- alter date: 26-11-2016
-- Description:	generates list of Assets with Emails for use within Auto Notifcation sub system. Condition of use is MUST return valid AssetID with an Email address as minimum
-- =============================================
CREATE PROCEDURE [dbo].[AUTO-Collection2]
	@CollectionID as int = 0,
	@Throttle as int = 99999,
	@Condition as nvarchar(1000) = '',
	@templateID as nvarchar(10) = '0'
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.


	DECLARE @CollectionType as nvarchar(255)
	DECLARE @query nvarchar(max)
	DECLARE @logCheck nvarchar(max)

	SET NOCOUNT ON;

	select @CollectionType = UPPER(IsNull(c.[Type],'ASSET')) from [ARM_CORE]..A_Collection c where c.CollectionID = @CollectionID


	-- Default is ASSET

	
	IF @CollectionType = 'USER'  
		BEGIN
--		SET @query = '
			If Exists(Select * from tempdb..sysobjects Where id = object_id('tempdb..##CandidatesUSERS')) Drop TABLE ##CandidatesUSERS

			SELECT  'USER' as [NOTIFICATIONTYPE], i.[TAGGEDON], DATEDIFF(d, i.[TAGGEDON], { fn NOW() }) as DaysSince, [USERID], i.[ITEMID], [USERNAME], [DEPARTMENT], [BUSINESSUNIT], [LOCATION] ,[JOBTITLE], [VIP], [TELEPHONE], [MOBILE], Email as [USEREMAIL], [EMAIL], [LIVE], [HEARTBEAT] 
				,[NOTES], [CUSTOM01], [CUSTOM02], [CUSTOM03], [CUSTOM04], [CUSTOM05], [FIRSTNAME], [DOMAIN], [DIRECTMANAGER] , [COLLECTIONID]
				into ##CandidatesUSERS
				from [ARM_CORE]..[A_CollectionItem] i
				LEFT JOIN  [ARM_CORE]..[User] u on u.UserID = i.ItemID
				where i.CollectionID = @CollectionID AND IsNULL(u.[Email],'') <> ''
			Order by i.[TaggedOn]
--			' + @Condition + ' Order by i.[TaggedOn] '

			SET @query = 'select * from ##CandidatesUSERS where 1=1 ' + @Condition

		END
	ELSE IF @CollectionType = 'APPLICATION'  
		BEGIN
--			SET @query = '

			select  'APPLICATION' as [NOTIFICATIONTYPE], i.[TAGGEDON], DATEDIFF(d, i.[TAGGEDON], { fn NOW() }) as DaysSince, a.ApplicationID as APPLICATIONID, i.[ITEMID], 
				a.NAME as [APPNAME], a.VERSION, a.LOCALID, a.DEPLOYTYPE, a.READY, a.PACKAGEID,
				a.APPGROUPID, g.APPGROUPNAME , i.[COLLECTIONID]--, (select top 1 u.FirstName from [ARM_CORE]..[User] u where u.Email = g.ApplicationOwnerEmail) AS FIRSTNAME 
				into ##CandidatesAPPS
				from [ARM_CORE]..[A_CollectionItem] i
				LEFT JOIN ARM_CORE..[Application] a on a.[ApplicationID] = i.[itemID]
				LEFT JOIN ARM_CORE..AppGroup g on g.AppGroupID =  a.AppGroupID 
				where i.CollectionID = @CollectionID
				Order by i.[TaggedOn]
--			' + @Condition + ' Order by i.[TaggedOn] '

			SET @query = 'select * from ##CandidatesAPPS where 1=1 ' + @Condition
		END
	ELSE IF @CollectionType = 'APPPACKAGEREQUEST'  
		BEGIN
--			SET @query = '

			select  'APPPACKAGEREQUEST' as [NOTIFICATIONTYPE], i.[TAGGEDON], DATEDIFF(d, i.[TAGGEDON], { fn NOW() }) as DaysSince, p.APRID, p.ApplicationID as APPLICATIONID, 
					i.[ITEMID], a.NAME as [APPNAME], a.VERSION, 
					a.LOCALID, a.DEPLOYTYPE, a.READY, a.PACKAGEID, a.APPGROUPID, g.APPGROUPNAME , i.[COLLECTIONID]--, (select top 1 u.FirstName from [ARM_CORE]..[User] u where u.Email = g.ApplicationOwnerEmail) AS FIRSTNAME 
				into ##CandidatesAPPREQS
				from [ARM_CORE]..[A_CollectionItem] i
				LEFT JOIN [ARM_CORE]..[AppPackageRequest] p on p.APRID = i.[itemID]
				LEFT JOIN [ARM_CORE]..[Application] a on a.[ApplicationID] = p.[ApplicationID]
				LEFT JOIN [ARM_CORE]..[AppGroup] g on g.AppGroupID = a.AppGroupID 
				where i.CollectionID = @CollectionID
				Order by i.[TaggedOn]
--			' + @Condition + ' Order by i.[TaggedOn] '

			SET @query = 'select * from ##CandidatesAPPREQS where 1=1 ' + @Condition
		END
	ELSE
		BEGIN
--			SET @query = '
			select  distinct 'ASSET' as [NOTIFICATIONTYPE], i.[TAGGEDON], DATEDIFF(d, i.[TAGGEDON], { fn NOW() }) as DaysSince, a.[ASSETID], a.[ASSETTAG], i.[ITEMID], IsNull(a.[Email],'') AS EMAIL, a.BAREA, IsNull(a.[Owner],'') AS [OWNER], IsNull(u.[FirstName],'') AS FIRSTNAME, IsNull(a.[Location],'') AS LOCATION, a.[OS], a.[MODEL], a.[TYPE], i.[COLLECTIONID],
--					r.[RUNID], IsNull(d.[RunDate],'') as [RUNDATE], IsNull(d.[RunDate],'') AS [BDATE], 
--					b.BID,IsNull(t.TID,'0') AS TID,IsNull(t.Label,'UNSPECIFIED') as BTIME, 
				IsNull ( (select top 1 k.Model from [ARM_CORE]..[Asset] k where k.AssetID = j.[ReplaceWith]),'' ) as NEWMODEL, IsNull(m.ToBeModel,'') as TOBEMODEL, IsNull(j.[ReplaceWith],'') as [REPLACEWITH], 
				IsNull(altO.AltTargetOS,(select top 1 om.[TargetOS] from [ARM_CORE]..OSMappings om where om.[InitialOS] like a.[OS]+'%' )) AS NEWOS, 
				IsNull(a.Custom01,'') as CUSTOM01, IsNull(a.Custom02,'') as CUSTOM02, IsNull(a.Custom03,'') as CUSTOM03, IsNull(a.Custom04,'') as CUSTOM04, IsNull(a.Custom05,'') as CUSTOM05

--					,d.[ChannelID] as CID, c.[Name] AS CHANNEL, IsNull(h.TheText,'') AS [BINSTRUCTIONS] 
--					,IsNull(s.[SlotID],'') as [SLOTID], IsNull(s.[DayTxt],'') as [DAYTXT], s.[MONTH]  

				into ##Candidates
				from [ARM_CORE]..[A_CollectionItem] i
				LEFT JOIN [ARM_CORE]..[Asset] a  ON a.AssetID = i.ItemID 
--					LEFT JOIN [ARM_CORE]..[ScheduleDeployRunAsset] r ON r.AssetID = a.AssetID 
				LEFT JOIN [ARM_CORE]..[User] u on u.[Email] = a.[Email]
--					LEFT JOIN [ARM_CORE]..[ScheduleDeployRun] d ON d.RunID = r.RunID 
--					LEFT JOIN [ARM_CORE]..[ScheduleChannel] c ON c.ChannelID = d.ChannelID 
--					LEFT JOIN [ARM_CORE]..[ScheduleSlot] s ON s.SlotID = d.SlotID 
--					LEFT JOIN [ARM_CORE]..[ScheduleBookDay] b ON b.ChannelID = d.[ChannelID] and b.TheDate = d.[RunDate] 
--					LEFT JOIN [ARM_CORE]..[ScheduleBooking] z ON z.AssetID = r.AssetID and z.RunID = r.RunID
--					LEFT JOIN [ARM_CORE]..[ScheduleTimeSlot] t on t.BID = b.BID and t.TID = z.TID 
--					LEFT JOIN [ARM_CORE]..[ScheduleInstruction] h ON h.ChannelID = d.[ChannelID] 
				LEFT JOIN [ARM_CORE]..[AssetStatus] j on j.AssetID = a.AssetID 
				LEFT JOIN [ARM_CORE]..[ModelToBe] m ON m.AssetID = a.AssetID  
				LEFT JOIN [ARM_CORE]..[AltModelType] altM on altM.[AssetID]=a.AssetID 
				LEFT JOIN [ARM_CORE]..[AltTargetOS] altO on altO.[AssetID]=a.AssetID 
				where i.CollectionID = @CollectionID  AND IsNULL(a.[Email],'') <> ''
				Order by i.[TaggedOn] 
					
	--		' + @Condition + ' Order by i.[TaggedOn] ; '

			SET @query = 'select * from ##Candidates where 1=1 ' + @Condition
		END


	SET @query = 'select top (' + Cast(@throttle as nvarchar(50)) +') c.* from (' + @query + ') c 
		LEFT JOIN [ARM_CORE]..[NotificationLog] n on n.CollectionID = c.CollectionID and n.AssetID = c.ItemID and n.Email = c.Email and DATEDIFF(d, n.WhenSent, { fn NOW() }) = 0 and n.templateID = ' + @templateID + '
		where n.NotificationLogID IS NULL 
	'		
	
	EXECUTE(@query)
	
	If Exists(Select * from tempdb..sysobjects Where id = object_id('tempdb.dbo.##Candidates')) Drop TABLE ##Candidates
	If Exists(Select * from tempdb..sysobjects Where id = object_id('tempdb.dbo.##CandidatesUSERS')) Drop TABLE ##CandidatesUSERS
	If Exists(Select * from tempdb..sysobjects Where id = object_id('tempdb.dbo.##CandidatesAPPS')) Drop TABLE ##CandidatesAPPS
	If Exists(Select * from tempdb..sysobjects Where id = object_id('tempdb.dbo.##CandidatesAPPREQS')) Drop TABLE ##CandidatesAPPREQS
				
--	Select @query

END


GO


-- =============================================
-- Author:		John Reed
-- alter date: 26-11-2016
-- Description:	generates list of Assets with Emails for use within Auto Notifcation sub system. Condition of use is MUST return valid AssetID with an Email address as minimum
-- =============================================
CREATE PROCEDURE [dbo].[AUTO-Collection]
	@FlagID as int = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.

	-- SQL Must return a value (or null string) for following fields
			-- rsAssets("AssetID")
			-- rsAssets("Email")
			-- rsAssets("Owner")
			-- rsAssets("Location")
			-- rsAssets("FIRSTNAME")
			-- rsAssets("BArea")				
			-- rsAssets("OS")
			-- rsAssets("TYPE")

			-- rsAssets("Confirmed")
			-- rsAssets("Deployed")

			-- rsAssets("RUNID")
			-- rsAssets("CHANNEL")
			-- rsAssets("CID")
			-- rsAssets("SLOTID")
			-- rsAssets("DATE")
			-- rsAssets("BID")
			-- rsAssets("BTIME")
			-- rsAssets("BINSTRUCTIONS")
			-- rsAssets("TID")


	SET NOCOUNT ON;

	select f.[AssetID], IsNull(a.[Email],'') AS Email, IsNull(a.[Owner],'') AS [Owner], IsNull(a.[Location],'') AS Location, a.[TYPE], a.[OS], a.[BArea], IsNull(u.[FIRSTNAME],'') as FIRSTNAME, isNull(s.[EngDeployed],0) as Deployed
		,isNull(a.Custom01,'') as Custom01, IsNull(a.Custom02,'') AS Custom02, IsNull(a.Custom03,'') as Custom03, IsNull(a.Custom04,'') as Custom04, IsNull(a.Custom05,'') as Custom05
		,-1 as BID, -1 AS TID,  -1 AS RUNID,  '' AS CHANNEL, -1 AS CID, '' AS SLOTID, '' AS [DATE], '' AS BTIME, '' AS BINSTRUCTIONS
		from [ARMS]..[AssetFlags] f 
		LEFT JOIN [ARM_CORE]..[Asset] a  ON a.AssetID = f.AssetID  
		LEFT JOIN [ARM_CORE]..[AssetStatus] s  ON s.AssetID = f.AssetID 
		LEFT JOIN [ARM_CORE]..[User] u on u.Email = a.Email 
		where f.FlagID = @FlagID and NOT a.AssetID IS NULL and IsNULL(a.[Email],'') <> '' 
END


GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[auto_prime_AppOwnerCheckUsers_tasks]
	-- Add the parameters for the stored procedure here
	@GroupName nvarchar(255) = 'Your tasks',
	@CollectionID int = 0,
	@ActionID int = 0,
	@Email nvarchar(500),
	@ApplicationID nvarchar(500)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;



	DECLARE @myItemID nvarchar(500)
	DECLARE @myItemType nvarchar(500)
	DECLARE @myUserID nvarchar(500)

	DECLARE db_tasks CURSOR FOR 
		select x.* from (
			select  i.Itemid, c.[Type] as [ItemType], (select top 1 userID from [ARM_CORE]..[User] u where u.[Email] = @Email ) as UserID
			from [ARM_CORE]..[A_CollectionItem] i 
			LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionID = i.CollectionID
			LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = i.ItemID
			LEFT JOIN [ARM_CORE]..[AppAstToBe] t on t.ApplicationID = a.ApplicationID
			LEFT JOIN [ARM_CORE]..[Asset] s on s.AssetID = t.AssetID
			where i.CollectionID = @CollectionID and i.ItemID = @ApplicationID and s.Email = @EMail
		) x 
		LEFT JOIN [ARM_CORE]..[A_Task] t on t.ItemID = x.ItemID and t.ActionID = @ActionID and t.UseriD = x.UserID and t.[End] IS NULL
		where  NOT x.UserID is NULL and t.taskID IS NULL


	OPEN db_tasks

	FETCH NEXT FROM db_tasks INTO @myItemID, @myItemType, @myUserID

	WHILE @@FETCH_STATUS = 0  
	BEGIN 
		EXEC [ARM_CORE]..[Task_new] @GroupName, @myItemID, @myItemType, @myUserID, @ActionID

		FETCH NEXT FROM db_tasks INTO @myItemID, @myItemType, @myUserID
	END
 
	CLOSE db_tasks  
	DEALLOCATE db_tasks 


	SELECT t.[Group], t.ItemID FROM [ARM_CORE]..[A_Task] t LEFT JOIN [ARM_CORE]..[A_CollectionItem] i on i.CollectionID = @CollectionID and i.ItemID = t.ItemID where UserID = @myUserID and [END] IS NULL and NOT i.ItemID IS NULL 
END

GO
CREATE PROCEDURE [dbo].[auto_prime_application_tester_tasks]
	-- Add the parameters for the stored procedure here
	@GroupName nvarchar(255) = 'Your tasks',
	@CollectionID int = 0,
	@ActionID int = 0,
	@Email nvarchar(500)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	DECLARE @myItemID nvarchar(500)
	DECLARE @myItemType nvarchar(500)
	DECLARE @myUserID nvarchar(500)

	DECLARE db_tasks CURSOR FOR 
		select  i.Itemid, c.[Type] as [ItemType], u.UserID
		from [ARM_CORE]..[A_CollectionItem] i 
		LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionID = i.CollectionID
		LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = i.ItemID
		LEFT JOIN [ARM_CORE]..[Appgroup] g on g.AppGroupID = a.AppGroupID
		LEFT JOIN [ARM_CORE]..[User] u on u.[Email] = @Email
		LEFT JOIN [ARM_CORE]..[A_Task] t on t.ItemID = i.ItemID and t.ActionID = @ActionID and t.UseriD = u.UserID and t.[End] IS NULL
		where i.CollectionID = @CollectionID and t.taskID IS NULL

	OPEN db_tasks

	FETCH NEXT FROM db_tasks INTO @myItemID, @myItemType, @myUserID

	WHILE @@FETCH_STATUS = 0  
	BEGIN 
		EXEC [ARM_CORE]..[Task_new] @GroupName, @myItemID, @myItemType, @myUserID, @ActionID

		FETCH NEXT FROM db_tasks INTO @myItemID, @myItemType, @myUserID
	END
 
	CLOSE db_tasks  
	DEALLOCATE db_tasks 


	SELECT [Group], ItemID FROM [ARM_CORE]..[A_Task] where UserID = @myUserID and [END] IS NULL
END



GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[auto_prime_application_tasks2] 
	-- Add the parameters for the stored procedure here
	@AutoID int,
	@GroupName nvarchar(255) = 'Your tasks',
	@CollectionID int = 0,
	@ActionID int = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	DECLARE @myItemID nvarchar(500)
	DECLARE @myItemType nvarchar(500)
	DECLARE @myUserID nvarchar(500)


	DECLARE @query VARCHAR(8000)

	CREATE TABLE #myResults
	(
		ItemID nvarchar(500),
		ItemType nvarchar(500),
		UserID nvarchar(500)
	)


	select @query = [Query] from [ARM_CORE]..[AutoNotification] where AutoNotificationID = @AutoID;

--	set @query = 'select ItemID, ItemType, UserID from (' + @query + ')'

	INSERT INTO #myResults(ItemID, ItemType, userID)
	EXECUTE(@query)

	DECLARE db_tasks CURSOR FOR 
	select ItemID, ItemType, userID from #myResults



	OPEN db_tasks

	FETCH NEXT FROM db_tasks INTO @myItemID, @myItemType, @myUserID

	WHILE @@FETCH_STATUS = 0  
	BEGIN 
--		EXEC [ARM_CORE]..[Task_new] @GroupName,@myItemID,@myItemType,@myUserID,@ActionID

		FETCH NEXT FROM db_tasks INTO @myItemID, @myItemType, @myUserID
	END
 
	CLOSE db_tasks  
	DEALLOCATE db_tasks 
	select 'Good' as [Status]
END

GO
CREATE PROCEDURE [dbo].[auto_prime_application_tasks_all]
	-- Add the parameters for the stored procedure here
	@AutoID int,
	@GroupName nvarchar(255) = 'Your tasks',
	@CollectionID int = 0,
	@ActionID int = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	DECLARE @myEmail nvarchar(500)
	DECLARE @myFirstName nvarchar(500)

	DECLARE @myItemID nvarchar(500)
	DECLARE @myItemType nvarchar(500)
	DECLARE @myUserID nvarchar(500)


	DECLARE @query VARCHAR(8000)

	CREATE TABLE #myAudience
	(
		Email nvarchar(500),
		FirstName nvarchar(500)
	)


	select @query = [Query] from [ARM_CORE]..[AutoNotification] where AutoNotificationID = @AutoID;

--	set @query = 'select ItemID, ItemType, UserID from (' + @query + ')'

	INSERT INTO #myAudience(Email, FirstName)
	EXECUTE(@query)

	DECLARE db_tasks CURSOR FOR 
		select  i.Itemid, c.[Type] as [ItemType], 'enter UserID'--u.UserID
		from [ARM_CORE]..[A_CollectionItem] i 
		LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionID = i.CollectionID
		LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = i.ItemID
		LEFT JOIN [ARM_CORE]..[Appgroup] g on g.AppGroupID = a.AppGroupID
		--LEFT JOIN [ARM_CORE]..[User] u on u.[Email] = g.[ApplicationOwnerEmail]
		LEFT JOIN [ARM_CORE]..[A_Task] t on t.ItemID = i.ItemID and t.ActionID = 1 and t.UseriD = 'enter UserID' --u.UserID 
		and t.[End] IS NULL
		--LEFT JOIN 
		--(
		--	select Email, FirstName from #myAudience
		--) e on e.[Email] = g.ApplicationOwnerEmail
		where --NOT e.[Email] IS NULL and 
		i.CollectionID = @CollectionID and t.taskID IS NULL


	OPEN db_tasks

	FETCH NEXT FROM db_tasks INTO @myItemID, @myItemType, @myUserID

	WHILE @@FETCH_STATUS = 0  
	BEGIN 
--		EXEC [ARM_CORE]..[Task_new] @GroupName,@myItemID,@myItemType,@myUserID,@ActionID

		FETCH NEXT FROM db_tasks INTO @myItemID, @myItemType, @myUserID
	END
 
	CLOSE db_tasks  
	DEALLOCATE db_tasks 

	--added temporarily
	select  i.Itemid, c.[Type] as [ItemType], 'enter UserID'--u.UserID
		from [ARM_CORE]..[A_CollectionItem] i 
		LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionID = i.CollectionID
		LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = i.ItemID
		LEFT JOIN [ARM_CORE]..[Appgroup] g on g.AppGroupID = a.AppGroupID
		--LEFT JOIN [ARM_CORE]..[User] u on u.[Email] = g.[ApplicationOwnerEmail]
		LEFT JOIN [ARM_CORE]..[A_Task] t on t.ItemID = i.ItemID and t.ActionID = 1 and t.UseriD = 'enter UserID' --u.UserID 
		and t.[End] IS NULL
		--LEFT JOIN 
		--(
		--	select Email, FirstName from #myAudience
		--) e on e.[Email] = g.ApplicationOwnerEmail
		where --NOT e.[Email] IS NULL and 
		i.CollectionID = @CollectionID and t.taskID IS NULL

		--commented by Karl
	--select  i.Itemid, c.[Type] as [ItemType], u.UserID
	--from [ARM_CORE]..[A_CollectionItem] i 
	--LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionID = i.CollectionID
	--LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = i.ItemID
	--LEFT JOIN [ARM_CORE]..[Appgroup] g on g.AppGroupID = a.AppGroupID
	--LEFT JOIN [ARM_CORE]..[User] u on u.[Email] = g.[ApplicationOwnerEmail]
	--LEFT JOIN [ARM_CORE]..[A_Task] t on t.ItemID = i.ItemID and t.ActionID = 1 and t.UseriD = u.UserID and t.[End] IS NULL
	--LEFT JOIN 
	--(
	--	select Email, FirstName from #myAudience
	--) e on e.[Email] = g.ApplicationOwnerEmail
	--where NOT e.[Email] IS NULL and i.CollectionID = @CollectionID and Isnull(g.[ApplicationOwnerEmail],'') <> '' and t.taskID IS NULL
END




GO
CREATE PROCEDURE [dbo].[auto_prime_application_tasks]
	-- Add the parameters for the stored procedure here
	@GroupName nvarchar(255) = 'Your tasks',
	@CollectionID int = 0,
	@ActionID int = 0,
	@Email nvarchar(500)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	DECLARE @myItemID nvarchar(500)
	DECLARE @myItemType nvarchar(500)
	DECLARE @myUserID nvarchar(500)

	DECLARE db_tasks CURSOR FOR 
		select x.* from (
			select  i.Itemid, c.[Type] as [ItemType], IsNull((select top 1 userID from [ARM_CORE]..[User] u where u.[Email] = @Email and u.Live = 1 and NOT ISNULL(u.UserID,'') like '%-dev'),'') as UserID
			from [ARM_CORE]..[A_CollectionItem] i 
			LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionID = i.CollectionID
			LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = i.ItemID
			LEFT JOIN [ARM_CORE]..[Appgroup] g on g.AppGroupID = a.AppGroupID
			where i.CollectionID = @CollectionID
		) x 
		LEFT JOIN [ARM_CORE]..[A_Task] t on t.ItemID = x.ItemID and t.ActionID = @ActionID and t.UseriD = x.UserID and t.[End] IS NULL
		where  NOT x.UserID is NULL and t.taskID IS NULL


	OPEN db_tasks

	FETCH NEXT FROM db_tasks INTO @myItemID, @myItemType, @myUserID

	WHILE @@FETCH_STATUS = 0  
	BEGIN 
		IF @myUserID <> '' 
			EXEC [ARM_CORE]..[Task_new] @GroupName, @myItemID, @myItemType, @myUserID, @ActionID

		FETCH NEXT FROM db_tasks INTO @myItemID, @myItemType, @myUserID
	END
 
	CLOSE db_tasks  
	DEALLOCATE db_tasks 


	SELECT [Group], ItemID FROM [ARM_CORE]..[A_Task] where UserID = @myUserID and [END] IS NULL
END



GO
CREATE PROCEDURE [dbo].[Asset-Workstream-Pivot]
 @OrderBy as nvarchar(255) = 'AssetID'
-- @OrderBy as nvarchar(255) = 'LastAccess] Desc, [UserID'
AS
BEGIN
       -- SET NOCOUNT ON added to prevent extra result sets from
       -- interfering with SELECT statements.
       SET NOCOUNT ON;


       SELECT distinct a.AssetID, a.Live, w.Name, cast(1 as int) as Permit 
       INTO #tempPivotTable
       from [ARM_CORE]..[Asset] a
	   LEFT JOIN [ARM_CORE]..[A_CollectionItem] i on i.ItemID = a.AssetID
	   LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionID = i.CollectionID
	   LEFT JOIN [ARM_CORE]..[Workstream] w on w.KeyStatusID = c.CollectionClassID
       where IsNull(w.Active,0) = 1 and w.[Name] like 'AP%'
	   order by a.AssetID, w.Name



       DECLARE @Columns VARCHAR(MAX)

       SELECT @columns = STUFF(( SELECT TOP 100 PERCENT
                                                            '],[' + cast(Name as varchar)
                                               FROM    [ARM_CORE]..[Workstream] AS t2 where IsNull(Active,0) = 1 and [Name] like 'AP%'
                                               ORDER BY Name,'],[' + cast(Name as varchar)
                                               FOR XML PATH('')
                                          ), 1, 2, '') + ']'


       DECLARE @query VARCHAR(8000)

       SET @query = '
       SELECT *
       FROM #tempPivotTable
       PIVOT
       (
       Count(Permit)
       FOR [Name]
       IN (' + @columns + ')
       )
       AS p order by [' + @OrderBy + ']'


       EXECUTE(@query)


       DROP TABLE #tempPivotTable
END


GO
CREATE PROCEDURE [dbo].[Asset-unConfirmDetails]
@AssetID AS nvarchar(255) = '',
@Who AS nvarchar(255) = 'System'
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here


	insert into [ARM_CORE]..[A_CommentLog] ([Table],[type],recordID,[Author],[Comment]) values ('Asset', 'System',@AssetID, @Who, 'DETAILS MARKED AS INCORRECT OR INCOMPLETE.')
	
	delete from [ARM_CORE]..[AssetCache] where AssetID = @AssetID


END


GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Assets-UpdateHeartBeat]
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	MERGE [ARM_CORE]..[ASSET] AS Target
		USING (SELECT RTrim(LTRIM([AssetID])) as AssetID, Max(CONVERT(date,[TimeStamp],103)) AS [Heartbeat] FROM [ARM_CORE]..TMP_RAW_AssetHeartbeat group by AssetID) As Source
		ON (Target.AssetID = Source.AssetID and IsNull(Source.Heartbeat,'1900-01-01') >= IsNull(Target.Heartbeat,'1900-01-01') )
		WHEN MATCHED THEN
			UPDATE SET Target.[Heartbeat] = Source.[Heartbeat];

	UPDATE [ARM_CORE]..Asset set asset.live = 0
	UPDATE [ARM_CORE]..Asset SET asset.Live = 1 WHERE IsNull(asset.Heartbeat,'1900-01-01') > getdate() -30

END





GO

CREATE PROCEDURE [dbo].[Assets-RELEASE-CID]
	@CID int = 0,
	@top int = 12,
	@ByReleaseCount bit = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	DECLARE @sample NVARCHAR(MAX)
	DECLARE @i int
	DECLARE @CurrentCount int
	DECLARE @RID NVARCHAR(500)


	IF OBJECT_ID('tempdb..#tempAssetReleaseTable') IS NOT NULL
		DROP TABLE #tempAssetReleaseTable;


	CREATE TABLE #tempAssetReleaseTable(
		[TID] [int] IDENTITY(1,1) NOT NULL,
		[App ID] [nvarchar](255) NULL,
		[Released] [nvarchar](255) NULL,
		[Total] [nvarchar](255) NULL
	) ON [PRIMARY]

	
	set @i = 0

	set @CurrentCount = 0

	WHILE @i < @top
	BEGIN
		INSERT INTO #tempAssetReleaseTable ([App ID],[Released], [Total])
		select [App ID],[Release],[Total] from [dbo].[AppReleasePathByReleaseCID](@CID,@CurrentCount)

		select @RID = [App ID] , @CurrentCount = [Total] from #tempAssetReleaseTable where TID = SCOPE_IDENTITY()

		set @i = @i + 1
	END

	select [App ID], [Released], [Total] from #tempAssetReleaseTable

	DROP TABLE #tempAssetReleaseTable
END

GO


CREATE PROCEDURE [dbo].[Assets-RELEASE-BArea]
	@base nvarchar(255) = '%',
	@top int = 12,
	@ByReleaseCount bit = 0,
	@StatusID int = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	DECLARE @sample NVARCHAR(MAX)
	DECLARE @i int
	DECLARE @CurrentCount int
	DECLARE @RID NVARCHAR(500)


	IF OBJECT_ID('tempdb..#tempAssetReleaseTable') IS NOT NULL
		DROP TABLE #tempAssetReleaseTable;


	CREATE TABLE #tempAssetReleaseTable(
		[TID] [int] IDENTITY(1,1) NOT NULL,
		[App ID] [nvarchar](255) NULL,
		[Released] [nvarchar](255) NULL,
		[Total] [nvarchar](255) NULL
	) ON [PRIMARY]

	
	set @i = 0

	set @CurrentCount = 0

	WHILE @i < @top
	BEGIN
		if @ByReleaseCount = 0 
			if @StatusID = 0
				INSERT INTO #tempAssetReleaseTable ([App ID],[Released], [Total])
				select [App ID],[Release],[Total] from [dbo].[AppReleasePath](@base,@CurrentCount)
			else
				INSERT INTO #tempAssetReleaseTable ([App ID],[Released], [Total])
				select [App ID],[Release],[Total] from [dbo].[AppReleasePathByStatus](@base,@CurrentCount,@StatusID)
		ELSE
			INSERT INTO #tempAssetReleaseTable ([App ID],[Released], [Total])
			select [App ID],[Release],[Total] from [dbo].[AppReleasePathByRelease](@base,@CurrentCount)

		select @RID = [App ID] , @CurrentCount = [Total] from #tempAssetReleaseTable where TID = SCOPE_IDENTITY()

		set @i = @i + 1
	END

	select [App ID], [Released], [Total] from #tempAssetReleaseTable

	DROP TABLE #tempAssetReleaseTable
END



GO
-- =============================================
-- Author:		<Author,,Name>
-- ALTER date: <ALTER Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[AssetsReady2] 
	@AssetType nvarchar(50) = 'Computer',
	@BArea nvarchar(255) = '',
	@AssetLocation nvarchar(255) = '',

	@Flag_AllApps As Bit = 1,
	@Flag_64Bit As Bit = 0,
	@Flag_Scheduled As Bit = 0,

	@AssetID As nvarchar(10) = ''
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	
	-- IF @Flag_AllApps		=1 then all apps for asset must be Ready 
	-- if @Flag_64Bit		=1 then if asset is 64 bit machine MARK AS NOT READY
	-- if @Flag_Scheduled	=1 then do not show assets already scheduled into future. (NOT YET IMPLEMENTED)
	
	-- READY (Mandatory attributes)
	---  Confirmed (i.e. in AssetCache$ table)
	---  NOT in Deferred$ table
	---  NOT already deployed !!
	
	-- Filter by Asset Type, BArea and Location

-- 		AND (s.[SO2] = 1)
--		AND (s.[W7] = 0)
	
	SET NOCOUNT ON;
	
	select  a.AssetID, a.Location, Left(a.Location,7) AS Building, Left(a.Location,11) AS [Floor], a.[Email], d.[Internal], a.BArea, e.[KODIT-TYPE], e.[KODIT-Model], e.[Replace], x.[DNA_64Bit],
	x.[DeviceName], a.Owner,  (select Count(q.AppKey) from SQLAssetApps$ q where q.AssetID =  a.AssetID) As NumApps, 
	(select Count(c.AppKey) from SQLAssetApps$ c LEFT JOIN SQLWIP$ w ON w.[KEY] = c.AppKEY where c.AssetID =  a.AssetID and w.Ready = 'Y') As NumAppsReady, 
	IsNull(s.[EngDeployed],0) As Deployed, s.EngDeployedDate As DeployedOn, IsNull(i.[Ready],'N') AS Override,
	(select top 1 ISNULL(f.RunDate,'') from DeployRun$ f, RunAssets$ g where f.RunID = g.RunID and g.AssetID = a.AssetID Order By RunDate Desc) AS RunDate,
	(select top 1 ISNULL(h.RunDate,'') from BookDay$ h, BookAssets$ j where h.RunID = j.RunID and j.AssetID = a.AssetID Order By RunDate Desc) AS BookDate,
	e.[KODIT-Status], s.SO2, s.W7
	from assetCache$ a 
		LEFT JOIN CMDB$ e on e.AssetNo = a.AssetID 
		LEFT JOIN DNA$ x on x.Asset = a.AssetID
		LEFT JOIN BAreas$ d on d.BArea = a.BArea 
		LEFT JOIN AssetStatus$ s ON s.AssetID = a.AssetID 
		LEFT JOIN Issues$ i ON i.AssetID = a.AssetID 
	where  
		e.[KODIT-TYPE] like  '%' + @AssetType + '%' 
		AND ( a.BArea like '%' + @BArea + '%' )
		AND ( a.Location like '%' + @AssetLocation + '%' )
		AND ( a.AssetID like '%' + @AssetID + '%' )
		AND ( IsNull(s.[EngDeployed],0) = 0 ) 
		AND ( (select COUNT(z.AssetID) from Deferred$ z where z.AssetID = a.AssetID) = 0)
		AND (d.[Internal] = 0)
				AND (
				(IsNull(i.[Ready],'N') = 'Y' )
				OR 
				(
					case
						WHEN @Flag_AllApps = 1 AND @Flag_64Bit = 1 then
							case when (select Count(b.AppKey) from SQLAssetApps$ b where b.AssetID =  a.AssetID) = (select Count(b.AppKey) from SQLAssetApps$ b LEFT JOIN SQLWIP$ w ON w.[KEY] = b.AppKEY where b.AssetID =  a.AssetID and w.Ready = 'Y') AND NOT x.[DNA_64Bit] = 1 then 1 else 0 end
						WHEN @Flag_AllApps = 1 then
							case when (select Count(b.AppKey) from SQLAssetApps$ b where b.AssetID =  a.AssetID) = (select Count(b.AppKey) from SQLAssetApps$ b LEFT JOIN SQLWIP$ w ON w.[KEY] = b.AppKEY where b.AssetID =  a.AssetID and w.Ready = 'Y') then 1 else 0 end
						WHEN @Flag_64Bit = 1 then
							case when NOT x.[DNA_64Bit] = 1 then 1 else 0 end
						else
							1
						end
				) = 1
			)

	Order By  case 	WHEN @AssetType like '%Laptop%' then a.Owner else  a.Location end, a.Barea, AssetID
			

END









GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[AssetID-Apps-Collection-PIVOT3]
@AssetCollectionID int=0,
@AppCollectionID int = 0,
@NewTable nvarchar(50) = '',
@List bit = 1,
@Show smallint = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	-- Show :  
	--    0  = Only list asset if there is at least one hit with the applications
	--	  1  = Show all Assets regardless of where there is a hit
	--	  2  = Show only assets where there are no hits at all


	SET NOCOUNT ON;

	DECLARE @query NVARCHAR(MAX)
	DECLARE @into NVARCHAR(100)
	set @into = ''

	DECLARE @ShowRule NVARCHAR(100)
	set @ShowRule = ' and NOT asis.AssetID IS NULL '

	IF @NewTable <> '' BEGIN
		set @NewTable = '[ARM_CORE]..[PIVOT_' + @NewTable + ']'
	
		if object_id(@NewTable,'U') is not null EXECUTE('Drop Table ' + @NewTable)
		set @into = ' INTO ' + @NewTable
	END



	CREATE table #tempPivotTable (
		[AssetID] nvarchar(255), 
		[Model] nvarchar(255), 
		[UserID] nvarchar(255), 
		[Owner] nvarchar(255), 
		[Email] nvarchar(255), 
		[Heartbeat] date, 
		[ApplicationID] nvarchar(255), 
		[Build] nvarchar(255), 
		[mark] int
	)


	if @Show = 0
	BEGIN
		insert into #tempPivotTable
		SELECT distinct asis.AssetID, a.Model, a.UserID, a.Owner, a.Email, a.Heartbeat, asis.ApplicationID, 1 as mark
		from ARM_CORE..A_CollectionItem i
		left join ARM_CORE..AppAstAsIs asis on asis.AssetID = i.ItemID
		LEFT JOIN ARM_CORE..A_CollectionItem j on j.ItemID = asis.ApplicationID
		LEFT JOIN ARM_CORE..Asset a on a.AssetID = asis.AssetID
		where i.CollectionID = @AssetCollectionID and NOT asis.AssetID IS NULL and j.CollectionID = @AppCollectionID 
	END
	if @Show = 1
	BEGIN
		insert into #tempPivotTable
		SELECT distinct i.ItemID as AssetID, a.Model, a.UserID, a.Owner, a.Email, a.Heartbeat, asis.ApplicationID, 1 as mark
		from ARM_CORE..A_CollectionItem i
		left join ARM_CORE..AppAstAsIs asis on asis.AssetID = i.ItemID 
		LEFT JOIN ARM_CORE..A_CollectionItem j on j.ItemID = asis.ApplicationID
		LEFT JOIN ARM_CORE..Asset a on a.AssetID = i.itemID
		where i.CollectionID = @AssetCollectionID and j.CollectionID = @AppCollectionID
		UNION
		select distinct ii.ItemID as AssetID, aa.Model, aa.UserID, aa.Owner, aa.Email, aa.Heartbeat, '', 1 as mark
		from ARM_CORE..A_CollectionItem ii
		LEFT JOIN ARM_CORE..Asset aa on aa.AssetID = ii.itemID
		where ii.CollectionID = @AssetCollectionID and ii.itemID NOT in (
			SELECT distinct i.ItemID 
			from ARM_CORE..A_CollectionItem i
			left join ARM_CORE..AppAstAsIs asis on asis.AssetID = i.ItemID 
			LEFT JOIN ARM_CORE..A_CollectionItem j on j.ItemID = asis.ApplicationID
			LEFT JOIN ARM_CORE..Asset a on a.AssetID = i.itemID
			where i.CollectionID = @AssetCollectionID and j.CollectionID = @AppCollectionID
		)
	END
	if @Show = 2
	BEGIN
		insert into #tempPivotTable
		select distinct ii.ItemID as AssetID, aa.Model, aa.UserID, aa.Owner, aa.Email, aa.Heartbeat, '', 1 as mark
		from ARM_CORE..A_CollectionItem ii
		LEFT JOIN ARM_CORE..Asset aa on aa.AssetID = ii.itemID
		where ii.CollectionID = @AssetCollectionID and ii.itemID NOT in (
			SELECT distinct i.ItemID 
			from ARM_CORE..A_CollectionItem i
			left join ARM_CORE..AppAstAsIs asis on asis.AssetID = i.ItemID 
			LEFT JOIN ARM_CORE..A_CollectionItem j on j.ItemID = asis.ApplicationID
			LEFT JOIN ARM_CORE..Asset a on a.AssetID = i.itemID
			where i.CollectionID = @AssetCollectionID and j.CollectionID = @AppCollectionID
		)
	END	

	select * from #tempPivotTable

	DECLARE @Columns NVARCHAR(MAX)

	SELECT @columns = STUFF(( SELECT DISTINCT TOP 20
									'],[' + cast(itemID as nvarchar(500))
							FROM    ARM_CORE..A_CollectionItem AS i where i.CollectionID = @AppCollectionID
							ORDER BY '],[' + cast(itemID as nvarchar(500))
							FOR XML PATH('')
						  ), 1, 2, '') + ']'



	SET @query = '
	SELECT * ' + @into + '
	FROM #tempPivotTable
	PIVOT
	(
	SUM(mark)
	FOR [ApplicationID]
	IN (' + 
		STUFF(( SELECT DISTINCT TOP 50
									'],[' + cast(itemID as nvarchar(500))
							FROM    ARM_CORE..A_CollectionItem AS i where i.CollectionID = @AppCollectionID
							ORDER BY '],[' + cast(itemID as nvarchar(500))
							FOR XML PATH('')
						  ), 1, 2, '') + ']'
	 + 	')
	)
	AS p '


	EXECUTE(@query)

	IF @NewTable <> '' and @List = 1 and object_id(@NewTable,'U') is not null  EXECUTE('select * from ' + @NewTable)

	DROP TABLE #tempPivotTable

END






GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[AssetID-Apps-Collection-PIVOT2]
@AssetCollectionID int=0,
@AppCollectionID int = 0,
@NewTable nvarchar(50) = '',
@List bit = 1
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	DECLARE @into NVARCHAR(100)
	set @into = ''

	IF @NewTable <> '' BEGIN
		set @NewTable = '[ARM_CORE]..[' + @NewTable + ']'
	
		if object_id(@NewTable,'U') is not null EXECUTE('Drop Table ' + @NewTable)
		set @into = ' INTO ' + @NewTable
	END

	SELECT distinct asis.AssetID, a.Model, a.UserID, a.Owner, a.Email, a.heartbeat, asis.ApplicationID, 1 as mark
	INTO #tempPivotTable
	from ARM_CORE..A_CollectionItem i
	left join ARM_CORE..AppAstAsIs asis on asis.AssetID = i.ItemID
	LEFT JOIN ARM_CORE..A_CollectionItem j on j.ItemID = asis.ApplicationID
	LEFT JOIN ARM_CORE..Asset a on a.AssetID = asis.AssetID
	where i.CollectionID = @AssetCollectionID and NOT asis.AssetID IS NULL and j.CollectionID = @AppCollectionID 


	DECLARE @Columns NVARCHAR(MAX)

	SELECT @columns = STUFF(( SELECT DISTINCT TOP 20
									'],[' + cast(itemID as nvarchar(500))
							FROM    ARM_CORE..A_CollectionItem AS i where i.CollectionID = @AppCollectionID
							ORDER BY '],[' + cast(itemID as nvarchar(500))
							FOR XML PATH('')
						  ), 1, 2, '') + ']'

	DECLARE @query NVARCHAR(MAX)


	SET @query = '
	SELECT * ' + @into + '
	FROM #tempPivotTable
	PIVOT
	(
	SUM(mark)
	FOR [ApplicationID]
	IN (' + 
		STUFF(( SELECT DISTINCT TOP 50
									'],[' + cast(itemID as nvarchar(500))
							FROM    ARM_CORE..A_CollectionItem AS i where i.CollectionID = @AppCollectionID
							ORDER BY '],[' + cast(itemID as nvarchar(500))
							FOR XML PATH('')
						  ), 1, 2, '') + ']'
	 + 	')
	)
	AS p '


	EXECUTE(@query)

	IF @NewTable <> '' and @List = 1 and object_id(@NewTable,'U') is not null  EXECUTE('select * from ' + @NewTable)

	DROP TABLE #tempPivotTable

END




GO
CREATE PROCEDURE [dbo].[AssetID-Apps-Collection-PIVOT]
@AssetCollectionID int=0,
@AppCollectionID int = 0,
@NewTable nvarchar(50) = '',
@List bit = 1,
@Show smallint = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	-- Show :  
	--    0  = Only list asset if there is at least one hit with the applications
	--	  1  = Show all Assets regardless of where there is a hit
	--	  2  = Show only assets where there are no hits at all


	SET NOCOUNT ON;

	DECLARE @query NVARCHAR(MAX)
	DECLARE @into NVARCHAR(100)
	set @into = ''

	DECLARE @ShowRule NVARCHAR(100)
	set @ShowRule = ' and NOT asis.AssetID IS NULL '

	IF @NewTable <> '' BEGIN
		set @NewTable = '[ARM_CORE]..[TMP_PIVOT_' + @NewTable + ']'
	
		if object_id(@NewTable,'U') is not null EXECUTE('Drop Table ' + @NewTable)
		set @into = ' INTO ' + @NewTable
	END



	CREATE table #tempPivotTable (
		[AssetID] nvarchar(255), 
		[Model] nvarchar(255), 
		[UserID] nvarchar(255), 
		[Owner] nvarchar(255), 
		[Email] nvarchar(255), 
		[Heartbeat] date, 
		[Live] bit,
		[ApplicationID] nvarchar(255), 
		[Build] nvarchar(255), 
		[mark] int
	)


	if @Show = 0
	BEGIN
		insert into #tempPivotTable
		SELECT distinct asis.AssetID, a.Model, a.UserID, a.Owner, a.Email, a.Heartbeat, a.Live, asis.ApplicationID, 1 as mark
		from ARM_CORE..A_CollectionItem i
		left join ARM_CORE..AppAstAsIs asis on asis.AssetID = i.ItemID
		LEFT JOIN ARM_CORE..A_CollectionItem j on j.ItemID = asis.ApplicationID
		LEFT JOIN ARM_CORE..Asset a on a.AssetID = asis.AssetID
		where i.CollectionID = @AssetCollectionID and NOT asis.AssetID IS NULL and j.CollectionID = @AppCollectionID 
	END
	if @Show = 1
	BEGIN
		insert into #tempPivotTable
		SELECT distinct i.ItemID as AssetID, a.Model, a.UserID, a.Owner, a.Email, a.Heartbeat, a.Live, asis.ApplicationID, 1 as mark
		from ARM_CORE..A_CollectionItem i
		left join ARM_CORE..AppAstAsIs asis on asis.AssetID = i.ItemID 
		LEFT JOIN ARM_CORE..A_CollectionItem j on j.ItemID = asis.ApplicationID
		LEFT JOIN ARM_CORE..Asset a on a.AssetID = i.itemID
		where i.CollectionID = @AssetCollectionID and j.CollectionID = @AppCollectionID
		UNION
		select distinct ii.ItemID as AssetID, aa.Model, aa.UserID, aa.Owner, aa.Email, aa.Heartbeat, aa.Live, '', 1 as mark
		from ARM_CORE..A_CollectionItem ii
		LEFT JOIN ARM_CORE..Asset aa on aa.AssetID = ii.itemID
		where ii.CollectionID = @AssetCollectionID and ii.itemID NOT in (
			SELECT distinct i.ItemID 
			from ARM_CORE..A_CollectionItem i
			left join ARM_CORE..AppAstAsIs asis on asis.AssetID = i.ItemID 
			LEFT JOIN ARM_CORE..A_CollectionItem j on j.ItemID = asis.ApplicationID
			LEFT JOIN ARM_CORE..Asset a on a.AssetID = i.itemID
			where i.CollectionID = @AssetCollectionID and j.CollectionID = @AppCollectionID
		)
	END
	if @Show = 2
	BEGIN
		insert into #tempPivotTable
		select distinct ii.ItemID as AssetID, aa.Model, aa.UserID, aa.Owner, aa.Email, aa.Heartbeat, aa.Live, '', 1 as mark
		from ARM_CORE..A_CollectionItem ii
		LEFT JOIN ARM_CORE..Asset aa on aa.AssetID = ii.itemID
		where ii.CollectionID = @AssetCollectionID and ii.itemID NOT in (
			SELECT distinct i.ItemID 
			from ARM_CORE..A_CollectionItem i
			left join ARM_CORE..AppAstAsIs asis on asis.AssetID = i.ItemID 
			LEFT JOIN ARM_CORE..A_CollectionItem j on j.ItemID = asis.ApplicationID
			LEFT JOIN ARM_CORE..Asset a on a.AssetID = i.itemID
			where i.CollectionID = @AssetCollectionID and j.CollectionID = @AppCollectionID
		)
	END	


	DECLARE @Columns NVARCHAR(MAX)

	SELECT @columns = STUFF(( SELECT DISTINCT TOP 20
									'],[' + cast(itemID as nvarchar(500))
							FROM    ARM_CORE..A_CollectionItem AS i where i.CollectionID = @AppCollectionID
							ORDER BY '],[' + cast(itemID as nvarchar(500))
							FOR XML PATH('')
						  ), 1, 2, '') + ']'



	SET @query = '
	SELECT * ' + @into + '
	FROM #tempPivotTable
	PIVOT
	(
	SUM(mark)
	FOR [ApplicationID]
	IN (' + 
		STUFF(( SELECT DISTINCT TOP 50
									'],[' + cast(itemID as nvarchar(500))
							FROM    ARM_CORE..A_CollectionItem AS i where i.CollectionID = @AppCollectionID
							ORDER BY '],[' + cast(itemID as nvarchar(500))
							FOR XML PATH('')
						  ), 1, 2, '') + ']'
	 + 	')
	)
	AS p '


	EXECUTE(@query)

	IF @NewTable <> '' and @List = 1 and object_id(@NewTable,'U') is not null  EXECUTE('select * from ' + @NewTable)

	DROP TABLE #tempPivotTable

END






GO
CREATE PROCEDURE [dbo].[Asset-ConfirmDetails]
	@AssetID AS nvarchar(255) = '',
	@Who AS nvarchar(255) = 'System',
	@Message as nvarchar(255) = '',
	@WS AS int = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	declare @CollectionID int

    -- Insert statements for procedure here

	set @CollectionID = (select c.CollectionID from A_CollectionClass cc LEFT JOIN A_Collection c on c.CollectionClassID = cc.CollectionClassID where cc.WorkstreamID = @WS and c.[Name] = 'Confirmed')

	if @WS > 0 and NOT @CollectionID IS NULL
		EXEC [ARM_CORE]..[Collection-AddItem] @AssetID, @CollectionID

	insert into [ARM_CORE]..[A_CommentLog] ([Table],[Type],recordID,[Author],[Comment]) values ('Asset', 'System',@AssetID, @Who, 'Details Confirmed '+@Message)

	MERGE [ARM_CORE]..[AssetCache] as Target using (select * from [ARM_CORE]..[Asset] a where a.[AssetID] = @AssetID) as Source
	ON (target.AssetID  = source.AssetID)
	WHEN NOT MATCHED BY TARGET THEN 
		insert (AssetID, [Owner], [Email], Location, BArea, comment, confirmed, LastUpdated, LOGON_USER) 
		Values (Source.AssetID, Source.Owner, Source.Email, Source.Location, Source.BArea, 'Confirmed', getdate(), getdate(), @Who)
	WHEN MATCHED THEN
		UPDATE SET Target.[Owner] = Source.[Owner], Target.[Email] = Source.[Email], Target.Location = Source.Location, Target.BArea = Source.BArea, Target.confirmed = getdate(), Target.LastUpdated = getdate(), Target.LOGON_USER = @Who;

END


GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Apps-ToBeCounters]

AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here

   SELECT distinct z.[ApplicationID], 
	AppCount.Counter AS [Total], UKAppCount.Counter as [UK Count], LEIDENAppCount.Counter as [LEIDEN Count],
	(
		select Top 1 a.BArea
		from [ARM_CORE]..[AppAstToBe] s 
		LEFT JOIN [ARM_CORE]..Asset a on a.AssetID = s.AssetID
		where s.ApplicationID = z.[ApplicationID] and a.BArea <> 'Russia'
		Group By a.BArea
		Order by count(s.AssetID) desc
	) as MAX_Individual_BArea,
	(
		select Top 1 count(s.AssetID) AS Counter
		from [ARM_CORE]..[AppAstToBe] s 
		LEFT JOIN [ARM_CORE]..Asset a on a.AssetID = s.AssetID
		where s.ApplicationID = z.[ApplicationID] and a.BArea <> 'Russia'
		Group By a.BArea
		Order by Counter desc
	) as MAX_Counter
  FROM [ARM_CORE].[dbo].[AppAstToBe] z
  LEFT JOIN [ARM_CORE]..Asset y on y.AssetID = z.AssetID
  LEFT JOIN (
	SELECT distinct ApplicationID, Count(AssetID) as Counter
	FROM [ARM_CORE].[dbo].[AppAstToBe]
	group by ApplicationID
  ) AppCount on AppCount.ApplicationID = z.ApplicationID
  LEFT JOIN (
	SELECT distinct zz.ApplicationID, Count(zz.AssetID) as Counter
	FROM [ARM_CORE].[dbo].[AppAstToBe] zz
	LEFT JOIN [ARM_CORE]..[Asset] tt on tt.AssetID = zz.AssetID
	where tt.BArea like 'APEL%' or tt.BArea like 'APL%' or tt.BArea = 'United Kingdom'
	group by zz.ApplicationID
  ) UKAppCount on UKAppCount.ApplicationID = z.ApplicationID
  LEFT JOIN (
	SELECT distinct zzz.ApplicationID, Count(zzz.AssetID) as Counter
	FROM [ARM_CORE].[dbo].[AppAstToBe] zzz
	LEFT JOIN [ARM_CORE]..[Asset] ttt on ttt.AssetID = zzz.AssetID
	where ttt.BArea like  '%Leiden%'
	group by zzz.ApplicationID
  ) LEIDENAppCount on LEIDENAppCount.ApplicationID = z.ApplicationID
  where y.BArea <> 'Russia'
  order by AppCount.Counter desc , ApplicationID


END




GO
CREATE PROCEDURE [dbo].[Apps-SingleInstalls] 
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;


select b.AssetID, b.ApplicationID, APPIC.IC, APPIC.DeployType, APPIC.LocalID, APPIC2.IC
from [ARM_CORE]..[AppAstToBe] b
LEFT JOIN [ARM_CORE]..[Asset] j on j.AssetID = b.AssetID 
LEFT JOIN [ARM_CORE]..[BArea] k on k.BArea = j.BArea 
LEFT JOIN ( 
	select z.ApplicationID, count(distinct z.AssetID) AS IC, a.DeployType, a.LocalID
	from [ARM_CORE]..[AppAstToBe] z 
	LEFT JOIN [ARM_CORE]..[Asset] y on y.AssetID = z.AssetID 
	LEFT JOIN [ARM_CORE]..[BArea] x on x.BArea = y.BArea 
	LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = z.ApplicationID
	LEFT JOIN [ARM_CORE]..[A_Lookup] lu ON lu.[Table] = 'Internal' 
	where x.Internal = 0 and IsNull(a.DeployType,'-') <> 'B' and IsNull(lu.[Label],'*') <> 'R' and IsNull(lu.[Label],'*') <> 'B' and IsNull(lu.[Label],'*') <> 'X'
	GROUP By z.ApplicationID, a.DeployType, a.LocalID
	) APPIC on APPIC.ApplicationID = b.ApplicationID
LEFT JOIN ( 
	select z.ApplicationID, count(distinct z.AssetID) AS IC, a.DeployType, a.LocalID
	from [ARM_CORE]..[AppAstToBe] z 
	LEFT JOIN [ARM_CORE]..[Asset] y on y.AssetID = z.AssetID 
	LEFT JOIN [ARM_CORE]..[BArea] x on x.BArea = y.BArea 
	LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = z.ApplicationID
	LEFT JOIN [ARM_CORE]..[A_Lookup] lu ON lu.[Table] = 'Internal' 
	where x.Internal = 0 and IsNull(a.DeployType,'-') <> 'B' and IsNull(lu.[Label],'*') <> 'R' and IsNull(lu.[Label],'*') <> 'B' and IsNull(lu.[Label],'*') <> 'X'
	GROUP By z.ApplicationID, a.DeployType, a.LocalID
	) APPIC2 on APPIC2.ApplicationID like b.ApplicationID
where APPIC.IC = 1 and IsNull(APPIC.LocalID,'') = '' and k.Internal = 0
Order By b.ApplicationID
END


GO
CREATE PROCEDURE [dbo].[Apps-SetTestResultsReady]
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

update [ARM_CORE]..[Application] set [ready] = 0

update [ARM_CORE]..[Application] set [ready] = 1 where ApplicationID in (
	select a.ApplicationID from [ARM_CORE]..[testresults] r 
	LEFT JOIN [ARM_CORE]..[Application] a on a.LocalID = r.[Abs no]
	where r.Compatibility = 'YES' and r.Unit = 'Pass' and (r.BAT like '%Not Required%') and NOT a.localID IS Null
)

END


GO
-- =============================================
-- Author:             <Author,,Name>
-- Create date: <Create Date,,>
-- Description:        <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Apps-SetCurApp-BasedOnInstallCount]
        -- Add the parameters for the stored procedure here
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
        SET NOCOUNT ON;
    -- Insert statements for procedure here
        MERGE [ARM_CORE]..[AppGroup] as Target
        USING (
               select ag.AppGroupID, ag.AppgroupName, ac.ApplicationID, ac.IC
               from  [ARM_CORE]..[AppGroup] ag
               LEFT JOIN (
                       select g.AppgroupID, a.ApplicationID , count(s.AssetID) AS IC, Row_Number() OVER(PARTITION BY g.AppgroupID order by count(s.AssetID) desc, a.ApplicationID) as nr
                       from [ARM_CORE]..[AppGroup] g
                       LEFT JOIN [ARM_CORE]..[Application] a on a.AppGroupID = g.AppgroupID
                       LEFT JOIN [ARM_CORE]..[AppAstToBe] s on s.ApplicationID = a.ApplicationID
                       where IsNull(g.CurrentApplication,'') = ''
                       Group By g.AppGroupID, a.ApplicationID 
               ) ac on ac.AppgroupID = ag.AppGroupID
               where ac.nr = 1 and IsNull(ag.CurrentApplication,'') = '' and NOT ac.IC = 0
        ) as Source
        On Target.AppGroupID = Source.AppGroupID
        WHEN MATCHED THEN 
        UPDATE SET Target.[CurrentApplication] = Source.ApplicationID;
END

GO
-- =============================================
-- Author:		John Reed
-- alter date: 26-05-2016
-- Description:	Add an additional application to user list which does not currently appear on machine feed.
-- =============================================
CREATE PROCEDURE [dbo].[Apps-RemoveApplicationFromAssetBatch]
@BatchCID int,
@AppID nvarchar(255),
@Table nvarchar(255) = 'AppAstToBe',
@Who nvarchar(255) = 'Admin'
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	-- Logically there can only be one active transaction for an AssetID / AppID pair.
	-- Turn off ability to UNDO transaction for other records with same AssetID / AppID pair before adding a new record.
	-- This keeps previous transactions as an information log 

	MERGE [ApplicationTransaction] as Target using (
			select distinct @AppID AS [ApplicationID], ItemID AS [AssetID] from [arm_core]..[A_collectionItem] i where collectionId = @BatchCID
	) as Source
	ON ( Target.[AssetID] = Source.[AssetID] and Target.[ApplicationID] = Source.[ApplicationID] )
	WHEN MATCHED  THEN 
		update  set [Rewind] = 0 ;



	-- update [ApplicationTransaction] set [Rewind] = 0 where [ApplicationID] = @AppID and [AssetID] = @AssetID;

	--  Add another transaction to log

	MERGE [ApplicationTransaction] as Target using (
			select distinct @AppID AS [ApplicationID], ItemID AS [AssetID] from [arm_core]..[A_collectionItem] i where collectionId = @BatchCID
	) as Source
	ON ( Target.[AssetID] = Source.[AssetID] and Target.[ApplicationID] = Source.[ApplicationID] )
	WHEN NOT MATCHED BY TARGET THEN 
		insert ([Who],[Action],[ApplicationID],[AssetID],[Approved],[Rewind])
		values (@Who, 'Remove', source.ApplicationID, Source.AssetID, 0, 1);


	--  insert into [ApplicationTransaction] ([Who],[Action],[ApplicationID],[AssetID],[Approved],[Rewind])
	--  values (@Who,'Remove',@AppID,@AssetID,0,1)

	--  Remove any previous Transform transactions to avoid future conflicts before adding new.

	delete from TransformTransaction where [Table] like '%AppAstToBe' 
		and [SourceColumn] = 'AssetID' 
		and [TargetColumn] = 'ApplicationID'
		and [ToBe] = '''' + @AppID + ''''
		and [TransformID] = -1
		and [AsIs] in (
			select distinct ItemID from [arm_core]..[A_collectionItem] i where collectionId = @BatchCID
		)



	MERGE [TransformTransaction] as Target using (select distinct ItemID AS [AssetID] from [arm_core]..[A_collectionItem] i where collectionId = @BatchCID) as Source
	ON (target.[Table]  = @Table and target.AsIs  = source.AssetID and target.ToBe = @AppID and target.[SourceColumn] = 'AssetID' and target.[TargetColumn] = 'ApplicationID' and target.[TransformID] = -1)
	WHEN NOT MATCHED BY TARGET THEN 
		insert ([Table], [Action], SourceColumn, TargetColumn, AsIs, ToBe, TransformID) 
		values (@Table,'Delete','AssetID','ApplicationID','''' + Source.[AssetID] + '''','''' + @AppID + '''', -1); 



	--insert into TransformTransaction ([Table], [Action], SourceColumn, TargetColumn, AsIs, ToBe, TransformID)
	--values ('AppAstToBe','Delete','AssetID','ApplicationID','''' + @AssetID + '''','''' + @AppID + '''', -1)

	--  Remove Application from the ToBe table.

	Delete from [AppAstToBe] where ApplicationID = @AppID
		and AssetID in (
			select distinct ItemID from [arm_core]..[A_collectionItem] i where collectionId = @BatchCID
		)


	-- insert into [ARM_CORE]..[A_CommentLog] ([Table],[type],recordID,[Author],[Comment]) values ('Asset', 'System',@AssetID, @Who, 'Removal of ' + @AppID)

END




GO
-- =============================================
-- Author:		John Reed
-- alter date: 26-05-2016
-- Description:	Add an additional application to user list which does not currently appear on machine feed.
-- =============================================
CREATE PROCEDURE [dbo].[Apps-RemoveApplicationFromAsset]
@AssetID nvarchar(255),
@AppID nvarchar(255),
@Who nvarchar(255) = 'Admin'
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	-- Logically there can only be one active transafction for an AssetID / AppID pair.
	-- Turn off ability to UNDO transaction for other records with same AssetID / AppID pair before adding a new record.
	-- This keeps previous transactions as an information log 

	update [ApplicationTransaction] set [Rewind] = 0 where [ApplicationID] = @AppID and [AssetID] = @AssetID;

	--  Add another transaction to log

	insert into [ApplicationTransaction] ([Who],[Action],[ApplicationID],[AssetID],[Approved],[Rewind])
	values (@Who,'Remove',@AppID,@AssetID,0,1)

	--  Remove any previous Transform transactions to avoid future conflicts before adding new.

	delete from TransformTransaction where [Table] like '%AppAstToBe' 
		and [SourceColumn] = 'AssetID' 
		and [TargetColumn] = 'ApplicationID'
		and [AsIs] = '''' + @AssetID + ''''
		and [ToBe] = '''' + @AppID + ''''
		and [TransformID] = -1

	insert into TransformTransaction ([Table], [Action], SourceColumn, TargetColumn, AsIs, ToBe, TransformID)
	values ('AppAstToBe','Delete','AssetID','ApplicationID','''' + @AssetID + '''','''' + @AppID + '''', -1)

	--  Remove Application from the ToBe table.

	Delete from [AppAstToBe] where AssetID = @AssetID and ApplicationID = @AppID


	insert into [ARM_CORE]..[A_CommentLog] ([Table],[type],recordID,[Author],[Comment]) values ('Asset', 'System',@AssetID, @Who, 'Removal of ' + @AppID)

END




GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Apps-RELEASE-CID]
	@CID int = 0,
	@top int = 7,
	@type nvarchar(5) = ''

AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	DECLARE @sample NVARCHAR(MAX)
	DECLARE @DeployFlag int = 0
	DECLARE @DeployedSQL NVARCHAR(3000) = ''

	DECLARE @OrderBy NVARCHAR(250) 
	DECLARE @Focus NVARCHAR(250) 

	DECLARE @ColJoin  NVARCHAR(250) = ' from [ARM_CORE]..[Asset] t with(nolock) '
	DECLARE @ColJoin2  NVARCHAR(250) = ' from [ARM_CORE]..[Asset] t with(nolock) '

	DECLARE @ColCheck  NVARCHAR(250) = ''
	DECLARE @ColCheck2  NVARCHAR(250) = ''


	set @Focus = ''
	set @OrderBy = ' order by p.[Installs] desc, p.[release] desc '
	set @ColJoin = ' from [ARM_CORE]..[A_CollectionItem] i with(nolock) LEFT JOIN [ARM_CORE]..[Asset] t with(nolock) on t.AssetID = i.ItemID  '


	IF OBJECT_ID('tempdb..#tempReleaseTable') IS NOT NULL
		DROP TABLE #tempReleaseTable;


	CREATE TABLE #tempReleaseTable(
		[App ID] [nvarchar](255) NULL,
		[Status] [nvarchar](255) NULL,
		[Type] [nvarchar](255) NULL,
		[Installs] [int] NULL
	) ON [PRIMARY]

	if NOT @type = '' 
		set @type = ' and [Type] = ''' + @type + ''' '

	select @DeployFlag = BitPosition  FROM [ARM_CORE]..[A_BitCondition] where Attribute = 'Deployed' and GroupName = 'Deployment'

	if NOT @DeployFlag = 0  
		set @DeployedSQL = ' and dbo.[CheckBitStatus](t.BitStatus,''Deployment'',''Deployed'')=0 '


	set @sample = '
	INSERT INTO #tempReleaseTable ([App ID], [Status], [Type], [Installs])
	select distinct  top 100 b.ApplicationID as [App ID]
	, (SELECT top 1 c.Name from [ARM_CORE]..[A_Collection] c LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc on cc.CollectionClassID = c.CollectionClassID LEFT JOIN [ARM_CORE]..[A_CollectionItem] j on j.CollectionID = c.CollectionID where j.ItemID = a.ApplicationID and cc.CLASSREF = ''ApplicationReadiness'' ) as [Status] 
	, a.DeployType
	, CUT_IC.IC as [Installs]  
	from [ARM_CORE]..[A_CollectionItem] i with(nolock)
	LEFT JOIN [ARM_CORE]..[Asset] t with(nolock) on t.AssetID = i.ItemID 
	LEFT JOIN [ARM_CORE]..[AppAstToBe] b with(nolock) on b.AssetID = t.AssetID
	LEFT JOIN [ARM_CORE]..[Application] a with(nolock) on a.ApplicationID = b.ApplicationID 
	LEFT JOIN ( 

		SELECT z.ApplicationID, count(distinct z.AssetID) as IC  
		from [ARM_CORE]..[A_CollectionItem] iz with(nolock) 
		LEFT JOIN [ARM_CORE]..[Asset] tz with(nolock) on tz.AssetID = iz.ItemID
		LEFT JOIN [ARM_CORE]..[AppAstToBe] z with(nolock) on z.AssetID = tz.AssetID
		where iz.CollectionID = ' + cast(@CID as nvarchar(12) ) + ' and tz.Live = 1 ' + @type + '  group by z.ApplicationID 

	) AS CUT_IC on CUT_IC.ApplicationID = b.ApplicationID 
	where NOT b.[ApplicationID] IS NULL  and IsNull(a.DeployType,''-'') <> ''B'' and IsNull(a.DeployType,''-'') <> ''X'' and IsNull(a.Ready,0) = 0 and IsNull(a.Exclude,0) = 0 
		and i.CollectionID = ' + cast(@CID as nvarchar(12) ) + ' and t.Live = 1 ' + @type + @DeployedSQL + ' 
	order by [Installs] Desc, [App ID]
	'

	EXECUTE(@sample)

	set @sample = '
	select top ' + cast(@top as nvarchar(12) ) + ' * from (
	select z.[App ID], z.[Status], z.[Type], g.ApplicationOwner, dbo.[BAreaWithMostInstalls](z.[App ID]) as [Area Most Installs], z.Installs, z.release, 100 * z.Installs / h.[Count] as [Impact (%)] from (
	select r.*,
	(
		select count(*) from (
			select b.AssetID, count(b.ApplicationID) AppsNotReady  
			from [ARM_CORE]..[A_CollectionItem] i with(nolock) 
			LEFT JOIN [ARM_CORE]..[Asset] t with(nolock) on t.AssetID = i.ItemID 
			LEFT JOIN [ARM_CORE]..[AppAstToBe] b with(nolock) on b.AssetID = t.AssetID
			LEFT JOIN [ARM_CORE]..[Application] a with(nolock) on a.ApplicationID = b.ApplicationID
			where IsNull(a.DeployType,''-'') <> ''B'' and IsNull(a.DeployType,''-'') <> ''X'' and IsNull(a.Ready,0) = 0 and IsNull(a.Exclude,0) = 0 
				and i.CollectionID = ' + cast(@CID as nvarchar(12) ) + '  and t.Live = 1 ' + @type + @DeployedSQL + ' 
			group by b.AssetID 
		) q LEFT JOIN (
			select x.AssetID from [ARM_CORE]..[AppAstToBe] x with(nolock) where x.ApplicationID COLLATE DATABASE_DEFAULT = r.[App ID] COLLATE DATABASE_DEFAULT
		) s on s.AssetID = q.AssetID 
		where q.AppsNotReady = 1 and NOT s.AssetID IS NULL 
	) as Release 
	from #tempReleaseTable r )  z 
	LEFT JOIN [ARM_CORE]..[s_ApplicationToBeInstallCount] h with(nolock) on h.ApplicationID COLLATE DATABASE_DEFAULT = z.[App ID] COLLATE DATABASE_DEFAULT
	LEFT JOIN [ARM_CORE]..[Application] a2 with(nolock) on a2.[ApplicationID] COLLATE DATABASE_DEFAULT = z.[App ID] COLLATE DATABASE_DEFAULT
	LEFT JOIN [ARM_CORE]..[AppGroup] g with(nolock) on g.AppGroupID = a2.AppGroupID 
) p ' + @Focus + @OrderBy


	EXECUTE(@sample)

	DROP TABLE #tempReleaseTable
END




GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Apps-RELEASE-BArea]
	@base nvarchar(255) = '%',
	@top int = 7,
	@type nvarchar(255) = '',
	@mode int = 0,
	@CID int = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	DECLARE @sample NVARCHAR(MAX)
	DECLARE @DeployFlag int = 0
	DECLARE @DeployedSQL NVARCHAR(3000) = ''

	DECLARE @OrderBy NVARCHAR(250) 
	DECLARE @Focus NVARCHAR(250) 

	DECLARE @ColJoin  NVARCHAR(250) = ' from [ARM_CORE]..[Asset] t '
	DECLARE @ColJoin2  NVARCHAR(250) = ' from [ARM_CORE]..[Asset] t '

	DECLARE @ColCheck  NVARCHAR(250) = ''
	DECLARE @ColCheck2  NVARCHAR(250) = ''


	if @CID > 0 
	BEGIN
		set @ColJoin = ' from [ARM_CORE]..[A_CollectionItem] with(nolock) i LEFT JOIN [ARM_CORE]..[Asset] t on t.AssetID = i.ItemID  '
		set @ColCheck = ' and i.CollectionID = ' + cast(@CID as nvarchar(12) ) + ' '

--		set @ColJoin2 = ' from [ARM_CORE]..[A_CollectionItem] j with(nolock) LEFT JOIN [ARM_CORE]..[Asset] t on t.AssetID = i.ItemID  '
--		set @ColCheck2 = ' and i.CollectionID = ' + cast(@CID as nvarchar(12) ) + ' '
	END

	set @Focus = ''

	if @mode = 0 or @mode > 3
		set @OrderBy = ' order by p.[Installs] desc, p.[release] desc '

	if @mode = 1 
		set @OrderBy = ' order by p.[release] desc, p.[Installs] desc '

	if @mode = 2
		set @OrderBy = ' order by p.[Impact (%)], p.[release] desc '

	if @mode = 3 
	BEGIN
		set @OrderBy = ' order by p.[Installs] desc, p.[release] desc '
		set @Focus = ' where  p.[Area Most Installs] like ''' + @base + ''' '
	END

	IF OBJECT_ID('tempdb..#tempReleaseTable') IS NOT NULL
		DROP TABLE #tempReleaseTable;


	CREATE TABLE #tempReleaseTable(
		[App ID] [nvarchar](255) NULL,
		[Status] [nvarchar](255) NULL,
		[Type] [nvarchar](255) NULL,
		[Installs] [int] NULL
	) ON [PRIMARY]

	if NOT @type = '' 
		set @type = ' and [Type] = ''' + @type + ''' '

	select @DeployFlag = BitPosition  FROM [ARM_CORE]..[A_BitCondition] with(nolock) where Attribute = 'Deployed' and GroupName = 'Deployment'

	if NOT @DeployFlag = 0  
		set @DeployedSQL = ' and dbo.[CheckBitStatus](t.BitStatus,''Deployment'',''Deployed'')=0 '


	set @sample = '
	INSERT INTO #tempReleaseTable ([App ID], [Status], [Type], [Installs])
	select distinct  top 100 b.ApplicationID as [App ID]
	, (SELECT top 1 c.Name from [ARM_CORE]..[A_Collection] c LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc on cc.CollectionClassID = c.CollectionClassID LEFT JOIN [ARM_CORE]..[A_CollectionItem] j on j.CollectionID = c.CollectionID where j.ItemID = a.ApplicationID and cc.CLASSREF = ''ApplicationReadiness'' ) as [Status] 
	, a.DeployType
	, CUT_IC.IC as [Installs]  ' 
	+ @ColJoin + '  	
	LEFT JOIN [ARM_CORE]..[AppAstToBe] b on b.AssetID = t.AssetID
	LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = b.ApplicationID 
	LEFT JOIN ( 

		SELECT z.ApplicationID, count(distinct z.AssetID) as IC from [ARM_CORE]..[AppAstToBe] z with(nolock) 
		LEFT JOIN [ARM_CORE]..[Asset] y with(nolock) on y.AssetID = z.AssetID 
		where y.[BArea] like  ''' + @base + ''' and y.Live = 1 ' + @type + '  group by z.ApplicationID 

	) AS CUT_IC on CUT_IC.ApplicationID = b.ApplicationID 
	where NOT b.[ApplicationID] IS NULL  and IsNull(a.DeployType,''-'') <> ''B'' and IsNull(a.DeployType,''-'') <> ''X'' and IsNull(a.Ready,0) = 0 and IsNull(a.Exclude,0) = 0 ' + @ColCheck + '
		and t.[BArea] like ''' + @base + ''' and t.Live = 1 ' + @type + @DeployedSQL + ' 
	order by [Installs] Desc, [App ID]
	'

	EXECUTE(@sample)

	set @sample = '
select top ' + cast(@top as nvarchar(12) ) + ' * from (
	select z.[App ID], z.[Status], z.[Type], g.ApplicationOwner, dbo.[BAreaWithMostInstalls](z.[App ID]) as [Area Most Installs], z.Installs, z.release, 100 * z.Installs / h.[Count] as [Impact (%)] from (
	select r.*,
	(
		select count(*) from (
			select b.AssetID, count(b.ApplicationID) AppsNotReady  '
			+ @ColJoin2 + '
			LEFT JOIN [ARM_CORE]..[AppAstToBe] b with(nolock) on b.AssetID = t.AssetID
			LEFT JOIN [ARM_CORE]..[Application] a with(nolock) on a.ApplicationID = b.ApplicationID
			where IsNull(a.DeployType,''-'') <> ''B'' and IsNull(a.DeployType,''-'') <> ''X'' and IsNull(a.Ready,0) = 0 and IsNull(a.Exclude,0) = 0 ' + @ColCheck2 + '
				and t.[BArea] like  ''' + @base + '''  and t.Live = 1 ' + @type + @DeployedSQL + ' 
			group by b.AssetID 
		) q LEFT JOIN (
			select x.AssetID from [ARM_CORE]..[AppAstToBe] x with(nolock) where x.ApplicationID = r.[App ID]
		) s on s.AssetID = q.AssetID 
		where q.AppsNotReady = 1 and NOT s.AssetID IS NULL 
	) as Release 
	from #tempReleaseTable r )  z 
	LEFT JOIN [ARM_CORE]..[s_ApplicationToBeInstallCount] h with(nolock) on h.ApplicationID = z.[App ID] 
	LEFT JOIN [ARM_CORE]..[Application] a2 with(nolock) on a2.[ApplicationID] = z.[App ID]
	LEFT JOIN [ARM_CORE]..[AppGroup] g with(nolock) on g.AppGroupID = a2.AppGroupID 
) p ' + @Focus + @OrderBy


	EXECUTE(@sample)

	DROP TABLE #tempReleaseTable
END




GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Apps-ReleaseApplications]
	@AppID varchar(255) = ''
AS
BEGIN

	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

-- NOTE:  Will remove all Stop list entries that block this application.  This may affect more than one application, but only the specified application 
-- will be added to current AsIs tables.  When full application process rerun other applications will also be let through.
--
-- Could provide an entry condition that will only run if application is the only one affected.
--
	if @AppID <> '' 
	BEGIN

--		EXEC [SYS-SiteDown]

		Delete from [ARM_CORE]..[TransformAppStop] where @AppID = ApplicationID

		MERGE [ARM_CORE]..[AppAsIs] AS Target
			USING (SELECT distinct a.ApplicationID, a.[AppName], a.[AppVersion] from [ARM_CORE]..AppUniqPreStop a WHERE a.ApplicationID like @AppID) AS Source
			ON (Target.ApplicationID = Source.ApplicationID)
			WHEN NOT MATCHED BY TARGET THEN
				INSERT (ApplicationID, [AppName],[AppVersion])
				VALUES (Source.ApplicationID, Source.[AppName], Source.[AppVersion]);
  

		MERGE [ARM_CORE]..[AppAstAsIs] AS Target
			USING (select AssetID, ApplicationID from [ARM_CORE]..[AppAstpreStop] where ApplicationID like @AppID) As Source
			ON (Target.ApplicationID = Source.ApplicationID and Target.AssetID = Source.AssetID)
			WHEN NOT MATCHED BY TARGET THEN
				INSERT (ApplicationID, AssetID)
				VALUES (Source.ApplicationID, Source.AssetID);


		MERGE [ARM_CORE]..[AppAstToBe] AS Target
			USING (SELECT distinct a.AssetID, IsNull(m.[To Be],a.[ApplicationID]) AS ApplicationID from [ARM_CORE]..[AppAstAsIs] a LEFT JOIN [ARM_CORE]..TransformAppMap m on  m.[As Is] = a.ApplicationID
			WHERE a.ApplicationID like @AppID) As Source
			ON (Target.ApplicationID = Source.ApplicationID and Target.AssetID = Source.AssetID)
			WHEN NOT MATCHED BY TARGET THEN
				INSERT (ApplicationID, AssetID)
				VALUES (Source.ApplicationID, Source.AssetID);


--		EXEC [SYS-SiteUp] 

	END


END






GO
-- =============================================
-- Author:             <Author,,Name>
-- alter date: <alter Date,,>
-- Description:        <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Apps-ReleaseApplication]
        @AppID nvarchar(255) = ''
AS
BEGIN
DECLARE @MyCursor CURSOR;
DECLARE @MyApp varchar(255);
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
        SET NOCOUNT ON;
-- NOTE:  Will remove all Stop list entries that block this application.  This may affect more than one application, but only the specified application 
-- will be added to current AsIs tables.  When full application process rerun other applications will also be let through.
--
-- Could provide an entry condition that will only run if application is the only one affected.
--
        if @AppID <> '' 
        BEGIN
               SET @MyCursor = CURSOR FOR 
                       select distinct a.ApplicationID from [ARM_CORE]..TransformAppStop s
                       LEFT JOIN [ARM_CORE]..[AppUniqPreStop] a on a.ApplicationID like s.ApplicationID 
                       where @AppID like s.ApplicationID order by a.ApplicationID
--             INSERT INTO [AppAsIs] 
--                     SELECT distinct a.ApplicationID, a.[AppName], a.[AppVersion] from AppUniqPreStop a WHERE a.ApplicationID = @AppID
               OPEN @MyCursor
               FETCH NEXT FROM @MyCursor
               INTO @MyApp
               WHILE @@FETCH_STATUS = 0
               BEGIN
                       MERGE [ARM_CORE]..[AppAsIs] AS Target
                              USING (SELECT distinct a.ApplicationID, a.[AppName], a.[AppVersion] from [ARM_CORE]..AppUniqPreStop a WHERE a.ApplicationID = @MyApp) AS Source
                              ON (Target.ApplicationID = Source.ApplicationID)
                              WHEN NOT MATCHED BY TARGET THEN
                                      INSERT (ApplicationID, [AppName],[AppVersion])
                                      VALUES (Source.ApplicationID, Source.[AppName], Source.[AppVersion]);
  
                       -- for each As Is app get all associated assets to alter App Asset As Is table
        --             INSERT INTO [AppAstAsIs] (ApplicationID, AssetID)
        --                     SELECT distinct  a.ApplicationID, r.AssetID FROM [AppAsIs] a LEFT JOIN [AppAstPreStop] r  on r.ApplicationID = a.ApplicationID
        --                     WHERE a.ApplicationID = @AppID
                       MERGE [ARM_CORE]..[AppAstAsIs] AS Target
                              USING (SELECT distinct  a.ApplicationID, r.AssetID FROM [AppAsIs] a LEFT JOIN [ARM_CORE]..[AppAstPreStop] r  on r.ApplicationID = a.ApplicationID
                                      WHERE a.ApplicationID = @MyApp) As Source
                              ON (Target.ApplicationID = Source.ApplicationID and Target.AssetID = Source.AssetID)
                              WHEN NOT MATCHED BY TARGET THEN
                                      INSERT (ApplicationID, AssetID)
                                      VALUES (Source.ApplicationID, Source.AssetID);
                       -- Take AS IS table and apply mapping if relevant to alter TO BE table
        --             INSERT INTO [AppAstToBe] (AssetID, ApplicationID )
        --                     SELECT distinct a.AssetID, IsNull(m.[To Be],a.[ApplicationID]) AS ApplicationID from [AppAstAsIs] a LEFT JOIN TransformAppMap m on  m.[As Is] = a.ApplicationID
        --                     WHERE a.ApplicationID = @AppID
 
                       MERGE [ARM_CORE]..[AppAstToBe] AS Target
                              USING (SELECT distinct a.AssetID, IsNull(m.[To Be],a.[ApplicationID]) AS ApplicationID from [ARM_CORE]..[AppAstAsIs] a LEFT JOIN [ARM_CORE]..TransformAppMap m on  m.[As Is] = a.ApplicationID
                              WHERE a.ApplicationID = @MyApp) As Source
                              ON (Target.ApplicationID = Source.ApplicationID and Target.AssetID = Source.AssetID)
                               WHEN NOT MATCHED BY TARGET THEN
                                      INSERT (ApplicationID, AssetID)
                                      VALUES (Source.ApplicationID, Source.AssetID);
                       FETCH NEXT FROM @MyCursor
                       INTO @MyApp
               END
               CLOSE @MyCursor;
               DEALLOCATE @MyCursor;
 
               Delete from [ARM_CORE]..[TransformAppStop] where @AppID like ApplicationID
               
               EXEC [SYS-SiteDown] 
 
 
 
                       MERGE [ARM_CORE]..[AppAstAsIs] AS Target
                              USING (SELECT [AssetID], [ApplicationID] from [ARM_CORE]..[AppAstAsIs] WHERE ApplicationID = @AppID) As Source
                              ON (Target.ApplicationID = Source.ApplicationID and Target.AssetID = Source.AssetID)
                              WHEN NOT MATCHED BY TARGET THEN
                                      INSERT (ApplicationID, AssetID)
                                      VALUES (Source.ApplicationID, Source.AssetID);
 
--                     NEED TO REAPPLY MAPPINGS IF RELEVANT
--
 
               EXEC [SYS-SiteUp]      
        END
END
 
 
 
 

GO
CREATE PROCEDURE [dbo].[Apps-ReApplyAppTransforms]
@AssetID nvarchar(255) = ''
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
        SET NOCOUNT ON;
--
-- PreReqs for this procedure are
--    AppAstPreStop
-- Actions
--  1. Update AppAsIs
--  2. Update AppAstAsIs
--  3. Update AppAstToBe
--  4. Apply User App Overrides TMP
--      5. Apply SAP GUI 
    IF object_id('[ARM_CORE]..[AppAstPreStop]','U') is not null 
    BEGIN
		if @AssetID = ''
			BEGIN
			--  EXEC [SYS-SiteDown] 'Re-Applying Application Tranforms. This should only take a few minutes.'
			--  Update AppAstToBe

				IF object_id('[ARM_CORE]..[AppAstAsIs]','U') is not null Delete from [ARM_CORE]..[AppAstAsIs] 

				INSERT INTO [ARM_CORE]..[AppAstAsIs] (ApplicationID, AssetID)
				SELECT distinct  r.ApplicationID, r.AssetID FROM [ARM_CORE]..[AppAstPreStop] r   
				LEFT JOIN [ARM_CORE]..[TransformAppStop] s  on r.ApplicationID like s.ApplicationID
				where s.ApplicationID IS NULL and NOT r.ApplicationID IS NULL


				IF object_id('[ARM_CORE]..[AppAstToBe]','U') is not null Delete from [ARM_CORE]..[AppAstToBe]


				INSERT INTO [ARM_CORE]..[AppAstToBe] (AssetID, ApplicationID )
				SELECT r.* from (
					SELECT distinct a.AssetID, IsNull(m.[To Be],a.[ApplicationID]) AS ApplicationID from [ARM_CORE]..[AppAstAsIs] a 
					LEFT JOIN [ARM_CORE]..[Asset] t on t.AssetID = a.AssetID
					LEFT JOIN [ARM_CORE]..[TransformAppMap] m on  m.[As Is] = a.ApplicationID 
					where t.Live = 1 
				) r
				LEFT JOIN [ARM_CORE]..[TransformAppStop] s  on r.ApplicationID like s.ApplicationID 
				where s.ApplicationID IS NULL 

				-- Remove Unused Software 90 days
						--Creat a list of Applications that will be removed.


				Exec [ARM_CORE]..[TransformTransactions] 'AppAstToBe'
				-- EXEC [SYS-SiteUp]
               

			END
		else
			BEGIN
		--################## Old code - only used when an asset id is passed - missing some code
				--  1. Update AppAsIs  - Takes existing RAW lists and reapply stop list

		--   IF object_id('CORE..[AppAsIs]','U') is not null Delete from CORE..[AppAsIs]
		--   INSERT INTO CORE..[AppAsIs] 
		-- SELECT distinct a.ApplicationID from [ARM_CORE]..[AppAstPreStop] a  LEFT JOIN CORE..[TransformAppStop] s  on a.ApplicationID like s.ApplicationID
		-- WHERE s.ApplicationID IS NULL

				--  2. Update AppAstAsIs

				IF object_id('[ARM_CORE]..[AppAstAsIs]','U') is not null Delete from [ARM_CORE]..[AppAstAsIs] where AssetID = @AssetID

				INSERT INTO [ARM_CORE]..[AppAstAsIs] (ApplicationID, AssetID)
				SELECT distinct  r.ApplicationID, r.AssetID FROM [ARM_CORE]..[AppAstPreStop] r   
				LEFT JOIN [ARM_CORE]..[TransformAppStop] s  on r.ApplicationID like s.ApplicationID
				where AssetID = @AssetID and s.ApplicationID IS NULL and NOT r.ApplicationID IS NULL

					--  3. Update AppAstToBe

				if 1=2
				BEGIN
					IF object_id('[ARM_CORE]..[AppAstToBe]','U') is not null Delete from [ARM_CORE]..[AppAstToBe] where AssetID = @AssetID

					INSERT INTO [ARM_CORE]..[AppAstToBe] (AssetID, ApplicationID )
					SELECT r.* from (
						SELECT distinct a.AssetID, IsNull(m.[To Be],a.[ApplicationID]) AS ApplicationID from [ARM_CORE]..[AppAstAsIs] a 
						LEFT JOIN [ARM_CORE]..[TransformAppMap] m on  m.[As Is] = a.ApplicationID 
						where AssetID = @AssetID 
					) r
					LEFT JOIN [ARM_CORE]..[TransformAppStop] s  on r.ApplicationID like s.ApplicationID 
					where s.ApplicationID IS NULL

					DELETE from [ARM_CORE]..[AppAstToBe] where ApplicationID in (
						SELECT distinct b.[ApplicationID]
						FROM [ARM_CORE].[dbo].[AppAstToBe] b
						LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = b.ApplicationID
					) and AssetID = @AssetID

					Exec [ARM_CORE]..[TransformAllTransactionsForAsset] 'AppAstToBe', @AssetID
				END
               
			END

		--Run Queries to Count Apps
		IF object_id('[ARM_CORE]..[s_ApplicationPreInstallCount]','U') is not null Delete from [ARM_CORE]..[s_ApplicationPreInstallCount]

		INSERT INTO [ARM_CORE]..s_ApplicationPreInstallCount ([ApplicationID], [Count])
		SELECT   ApplicationID, COUNT(DISTINCT AssetID) AS Count
		FROM     dbo.AppAstPreStop 
		where NOT ApplicationID IS NULL
		GROUP BY ApplicationID


		IF object_id('[ARM_CORE]..[s_ApplicationASISInstallCount]','U') is not null Delete from [ARM_CORE]..[s_ApplicationASISInstallCount]

		INSERT INTO [ARM_CORE]..[s_ApplicationASISInstallCount] ([ApplicationID], [Count])
		SELECT   ApplicationID, COUNT(DISTINCT AssetID) AS Count
		FROM     dbo.AppAstAsIs 
		where NOT ApplicationID IS NULL
		GROUP BY ApplicationID

		IF object_id('[ARM_CORE]..[s_ApplicationToBeInstallCount]','U') is not null Delete from [ARM_CORE]..[s_ApplicationToBeInstallCount]

		INSERT INTO [ARM_CORE]..[s_ApplicationToBeInstallCount] (ApplicationID, [Count])
		SELECT   b.ApplicationID, COUNT(DISTINCT b.AssetID) AS Count
		FROM     dbo.AppAstToBe b
		LEFT JOIN [ARM_CORE]..[Asset] a on a.AssetID = b.AssetID
		where b.applicationID <> '_WIP-101' and a.Live = 1
		GROUP BY b.ApplicationID

		--Add Asset update to Show Readiness
   
		--Asset Bit Readiness
--		exec [ARM_CORE]..[CalculateBitValues] 'Asset', 'BitStatus'
		-- Set Select so that 'Ready' is shown in LIst
--		exec [ARM_CORE]..[CalculateBitValues] 'Application', 'BitStatus'
		-- Set Select so that 'Ready' is shown in LIst
--		exec [ARM_CORE]..[CalculateBitValues] 'User', 'BitStatus'
		-- Set Select so that 'Ready' is shown in LIst



	END

END



GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Apps-ProfileCounters]
@Location varchar(255) = '%',
@TargetCount int = -1
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	if @TargetCount = -1 
	BEGIN
		select a.AssetID as AssetID, (select Count(ApplicationID) from AppAstToBe b where b.AssetID = a.AssetID) as NumApps, a.Location
		into #TMPCOUNTERS
		from Asset a where a.Location like @Location and a.Live = 1 

		select Location, Count(AssetID) AS NumAssets, NumApps from #TMPCOUNTERS Group By Location, NumApps Order By NumApps
	END
	else
	BEGIN
		select a.AssetID as AssetID, (select Count(ApplicationID) from AppAstToBe b where b.AssetID = a.AssetID) as NumApps, a.Location
		into #TMPCOUNTERS2
		from Asset a where a.Location like @Location and a.Live = 1 

		select * from #TMPCOUNTERS2 where  NumApps = @TargetCount
	END
END




GO
-- =============================================
-- Author:		John Reed
-- alter date: 26-05-2016
-- Description:	Add an additional application to user list which does not currently appear on machine feed.
-- =============================================
CREATE PROCEDURE [dbo].[Apps-PrimeNewApps]
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	--  Where new applications are yet to be deployed (e.g. proposed new base build) these need to be primed into the Application table.

	MERGE [ARM_CORE]..[Application] as Target using (select 'Adobe Shockwave Player 12.2-12.2.1.171' AS ApplicationID) as Source
	ON (target.ApplicationID  = source.ApplicationID)
	WHEN NOT MATCHED BY TARGET THEN 
		insert (ApplicationID, Name, [Version], DeployType, Ready) 
		Values (Source.ApplicationID, 'Adobe Shockwave Player 12.2','12.2.1.171','B',1); 

	MERGE [ARM_CORE]..[Application] as Target using (select 'Pulse Secure 5.1-5.1.61491' AS ApplicationID) as Source
	ON (target.ApplicationID  = source.ApplicationID)
	WHEN NOT MATCHED BY TARGET THEN 
		insert (ApplicationID, Name, [Version], DeployType, Ready) 
		Values (Source.ApplicationID, 'Pulse Secure 5.1','5.1.61491','B',1); 
END


GO
CREATE PROCEDURE [dbo].[Apps-PIVOT-Package-DP]
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	SELECT distinct p.LocalID, case when IsNull(p.PackageID,'') = '' then t.ApplicationID else p.PackageID end as PackageID, p.DeployType,
		ISNULL(d.[PriorityOrder],'3000')+' : '+IsNull(d.Reference,a.BArea) as BArea

	, Count(t.AssetID) as Installs
	INTO #tempPivotTable
	FROM [ARM_CORE]..AppAstToBe t 
	LEFT JOIN [ARM_CORE]..Asset a on a.AssetID = t.AssetID 
	LEFT JOIN [ARM_CORE]..[BArea] b on b.BArea = a.BArea 
	LEFT JOIN [ARM_CORE]..[Application] p on p.ApplicationID = t.[ApplicationID]
	LEFT JOIN [C_BAREA-to-DP-Priority] l on l.BArea = b.BArea
	LEFT JOIN [C_DPs] d on d.Reference = l.[DP]
	where b.Internal =0 and NOT a.BArea like '%]' and NOT a.BArea in ('Russia','Ukraine','Japan') 
		and IsNull(p.LocalID,'') <> '' and 	NOT IsNull(p.DeployType,'-') IN ('X','M','B')
	group by p.LocalID, case when IsNull(p.PackageID,'') = '' then t.ApplicationID else p.PackageID end, p.DeployType, ISNULL(d.[PriorityOrder],'3000')+' : '+IsNull(d.Reference,a.BArea)


	DECLARE @Columns VARCHAR(MAX)

	SELECT @columns = STUFF(( SELECT DISTINCT TOP 100 PERCENT
									'],[' + cast([BArea] as varchar)
							FROM    #tempPivotTable AS t2
							ORDER BY '],[' + cast([BArea] as varchar)
							FOR XML PATH('')
						  ), 1, 2, '') + ']'

	DECLARE @query VARCHAR(8000)

	SET @query = '
	SELECT *
	INTO [C_tempPackageList]
	FROM #tempPivotTable
	PIVOT
	(
	SUM( Installs )
	FOR [BArea]
	IN (' + @columns + ')
	)
	AS p '


	EXECUTE(@query)

	select * from [C_tempPackageList]

	DROP TABLE [C_tempPackageList]
	DROP TABLE #tempPivotTable
END
GO
CREATE PROCEDURE [dbo].[Apps-PIVOT-Package]
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	SELECT distinct p.LocalID, case when IsNull(p.PackageID,'') = '' then t.ApplicationID else p.PackageID end as PackageID, p.DeployType,
		ISNULL(d.[Order],'3000')+' : '+a.BArea as BArea

	, Count(t.AssetID) as Installs
	INTO #tempPivotTable
	FROM [ARM_CORE]..AppAstToBe t 
	LEFT JOIN [ARM_CORE]..Asset a on a.AssetID = t.AssetID 
	LEFT JOIN [ARM_CORE]..[BArea] b on b.BArea = a.BArea 
	LEFT JOIN [ARM_CORE]..[Application] p on p.ApplicationID = t.[ApplicationID]
	LEFT JOIN [C_BAREA-to-DP-Priority] l on l.BArea = b.BArea
	LEFT JOIN [C_DPs] d on d.Reference = l.[DP]
	where b.Internal =0 and NOT a.BArea like '%]' and NOT a.BArea in ('Russia','Ukraine') 
		and IsNull(p.LocalID,'') <> '' and 	NOT IsNull(p.DeployType,'-') IN ('X','M','B')
	group by p.LocalID, case when IsNull(p.PackageID,'') = '' then t.ApplicationID else p.PackageID end, p.DeployType, ISNULL(d.[Order],'3000')+' : '+a.BArea


	DECLARE @Columns VARCHAR(MAX)

	SELECT @columns = STUFF(( SELECT DISTINCT TOP 100 PERCENT
									'],[' + cast([BArea] as varchar)
							FROM    #tempPivotTable AS t2
							ORDER BY '],[' + cast([BArea] as varchar)
							FOR XML PATH('')
						  ), 1, 2, '') + ']'

	DECLARE @query VARCHAR(8000)

	SET @query = '
	SELECT *
	INTO [C_tempPackageList]
	FROM #tempPivotTable
	PIVOT
	(
	SUM( Installs )
	FOR [BArea]
	IN (' + @columns + ')
	)
	AS p '


	EXECUTE(@query)

	select * from [C_tempPackageList]

	DROP TABLE [C_tempPackageList]
	DROP TABLE #tempPivotTable
END
GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Apps-PIVOT-BArea]
	@base nvarchar(255) = '%'
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	SELECT distinct t.ApplicationID, a.BArea, Count(t.AssetID) as Installs
	INTO #tempPivotTable
	FROM [ARM_CORE]..AppAstToBe t 
	LEFT JOIN [ARM_CORE]..Asset a on a.AssetID = t.AssetID 
	LEFT JOIN [ARM_CORE]..[BArea] b on b.BArea = a.BArea 
	where b.Internal =0 and NOT a.BArea like '%]'  and a.BArea like @base group by t.ApplicationID, a.BArea


	DECLARE @Columns VARCHAR(MAX)

	SELECT @columns = STUFF(( SELECT DISTINCT TOP 100 PERCENT
									'],[' + cast([BArea] as varchar)
							FROM    #tempPivotTable AS t2
							ORDER BY '],[' + cast([BArea] as varchar)
							FOR XML PATH('')
						  ), 1, 2, '') + ']'

	DECLARE @query VARCHAR(8000)

	SET @query = '
	SELECT *
	FROM #tempPivotTable
	PIVOT
	(
	SUM(Installs)
	FOR [BArea]
	IN (' + @columns + ')
	)
	AS p '


	EXECUTE(@query)


	DROP TABLE #tempPivotTable
END




GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Apps-Packages-PIVOT-BArea]
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	SELECT distinct p.LocalID, p.PackageID, p.DeployType, case when a.BArea like 'APEl%' then 'APEL' else a.BArea end as [BArea], Count(t.AssetID) as Installs
	INTO #tempPivotTable
	FROM [ARM_CORE]..AppAstToBe t 
	LEFT JOIN [ARM_CORE]..Asset a on a.AssetID = t.AssetID 
	LEFT JOIN [ARM_CORE]..[Application] p on p.ApplicationID = t.ApplicationID
	LEFT JOIN [ARM_CORE]..[BArea] b on b.BArea = a.BArea 
	where b.Internal =0 and NOT a.BArea like '%]' and a.Live = 1 and ISNULL(p.PackageID,'') <> ''
	and NOT p.DeployType in ('B','X','M')
	group by p.PackageID, p.LocalID, p.DeployType, a.BArea


	DECLARE @Columns VARCHAR(MAX)

	SELECT @columns = STUFF(( SELECT DISTINCT TOP 100 PERCENT
									'],[' + cast([BArea]  as varchar)
							FROM    #tempPivotTable AS t2
							ORDER BY '],[' + cast([BArea] as varchar)
							FOR XML PATH('')
						  ), 1, 2, '') + ']'

	DECLARE @query VARCHAR(8000)

	SET @query = '
	SELECT *
	FROM #tempPivotTable
	PIVOT
	(
	SUM(Installs)
	FOR [BArea]
	IN (' + @columns + ')
	)
	AS p Order by LocalID, PackageID'


	EXECUTE(@query)


	DROP TABLE #tempPivotTable
END




GO
CREATE PROCEDURE [dbo].[Apps-Package-ByDeployDate-ALL]
	@distinct as int = 999,
	@mode as int = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	declare @TheDate date
 	declare @ThisDate date
 	declare @wk int
 	declare @AppC int
 	declare @TotalApps int

	
	select row_number() OVER ( ORDER BY IsNull(LIST.ReadyByDate,'2020-04-01'),LIST.AIC desc,LIST.IC desc, LIST.ApplicationID) AS [#], LIST.*, 
		Count(ApplicationID) OVER ( PARTITION BY IsNull(LIST.ReadyByDate,'2020-04-01') ) AS cc, 0 as [days], 0 as [TotalApps]
	INTO #tempPackagingTable
	from (
		select APPS.*, row_number() OVER ( PARTITION BY APPS.ApplicationID ORDER BY APPS.ApplicationID, IsNull(APPS.ReadyByDate,'2020-04-01') ) AS dc
		from (
			select distinct  a.LocalID as [ABS], a.ApplicationID as [ApplicationID], IsNull(a.DeployType,'-') as DType, IsNull(a.ready,0) as Ready,  a.[Custom01] as [New ABS],
				a.PackageID, CUT_IC.IC as AIC, TOTAL_IC.IC AS IC, DateAdd(day,-14,IsNull(d.DeploymentStartDate,'2020-04-01')) as ReadyByDate, t.BArea, BArea_IC.IC as BIC
			from [ARM_CORE]..[AppAstToBe] b 
			LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = b.ApplicationID 
			LEFT JOIN [ARM_CORE]..[Asset] t on t.AssetID = b.AssetID 
			LEFT JOIN [ARM_CORE]..[BAREA] d on d.BArea = t.BArea 
			LEFT JOIN [ARM_CORE]..[A_Lookup] lu ON lu.[Table] = 'Internal' and lu.[Column] = 'RAG' 

			LEFT JOIN ( select z.ApplicationID, y.BArea, count(distinct z.AssetID) as IC from [ARM_CORE]..[AppAstToBe] z LEFT JOIN [ARM_CORE]..[Asset] y on y.AssetID = z.AssetID LEFT JOIN [ARM_CORE]..[BArea] x on x.BArea = y.BArea where x.Internal = 0 and y.Live = 1 group by y.BArea, z.ApplicationID ) AS BArea_IC on BArea_IC.BArea = t.BArea and BArea_IC.ApplicationID = b.ApplicationID

			LEFT JOIN ( select z.ApplicationID, count(distinct z.AssetID) as IC, IsNull(x.DeploymentStartDate,'2020-04-01') as DeploymentStartDate from [ARM_CORE]..[AppAstToBe] z LEFT JOIN [ARM_CORE]..[Asset] y on y.AssetID = z.AssetID LEFT JOIN [ARM_CORE]..[BArea] x on x.BArea = y.BArea where x.Internal = 0 and y.Live = 1 group by IsNull(x.DeploymentStartDate,'2020-04-01'), z.ApplicationID ) AS CUT_IC on CUT_IC.ApplicationID = b.ApplicationID and CUT_IC.[DeploymentStartDate] = IsNull(d.DeploymentStartDate,'2020-04-01')
			LEFT JOIN ( select z.ApplicationID, count(distinct z.AssetID) as IC from [ARM_CORE]..[AppAstToBe] z LEFT JOIN [ARM_CORE]..[Asset] y on y.AssetID = z.AssetID LEFT JOIN [ARM_CORE]..[BArea] x on x.BArea = y.BArea where x.Internal = 0 and y.Live = 1 group by z.ApplicationID ) AS TOTAL_IC on TOTAL_IC.ApplicationID = b.ApplicationID 


			where IsNull(a.DeployType,'-') <> 'B'  and IsNull(lu.[Label],'*') <> 'R' and IsNull(lu.[Label],'*') <> 'B'  and IsNull(lu.[Label],'*') <> 'X' 
				and IsNull(a.DeployType,'-') <> 'X' and IsNull(lu.[Lookup],'*') <> 'X'
				and IsNull(d.Internal,0) = 0 and t.Live = 1 and IsNull(a.LocalID,'-') <> '-' and IsNull(a.ready,0) = 1  -- and IsNull(a.DeployType,'-') <> 'M'
				and NOT t.AssetID like '%-%'	and NOT t.BArea like '%}'		 and NOT t.BArea in ('Japan')

		) as APPS

	) as LIST

	where LIST.dc <= @distinct  
	Order by IsNull(LIST.ReadyByDate,'2020-04-01'),LIST.AIC desc,LIST.IC desc, LIST.ApplicationID


	select @ThisDate = getdate()
	set @wk = 0
	set @TotalApps = 0

	DECLARE update_cursor CURSOR FOR SELECT distinct ReadyByDate, cc  FROM #tempPackagingTable order by ReadyByDate 

	OPEN update_cursor
	FETCH FROM update_cursor INTO @TheDate, @AppC
 
	-- check for a new row
	WHILE @@FETCH_STATUS=0
	BEGIN
		-- do update operation
		select @wk = DATEDIFF(day,@ThisDate,@TheDate)
		set @TotalApps = @TotalApps + @AppC
		UPDATE #tempPackagingTable set [days] = @wk, [TotalApps] = @TotalApps where ReadyByDate = @TheDate

		set @ThisDate = @TheDate
--		WHERE CURRENT OF update_cursor 
		-- get next available row into variables
		FETCH FROM update_cursor INTO @TheDate, @AppC
	END
	close update_cursor

	-- list of all applications to package
	if @mode = 0 
		select t.*, Round((Cast([cc] as Float)/[days])*7,1)  as [RunRate], DATEDIFF(day,getdate(),[ReadyByDate]) as [TotalDays], d.[Type] as [DAL Type] from #tempPackagingTable t
		LEFT JOIN [TMP_RAW_AstellasDAL] d on d.[ABS] = t.[ABS]

	-- RunRate for Candlestick chart depicted as Step Chart
	if @mode = 1 
		select distinct 'By ' + cast ([ReadyByDate] as nvarchar(20)), 0 ,0 , Round((Cast([cc] as Float)/[days])*7,1) , Round((Cast([cc] as Float)/[days])*7,1)  from #tempPackagingTable 

		-- summary profile
	if @mode = 2 
		select '2019-09-12', 0, 0
		UNION
		select distinct [ReadyByDate], [TotalApps], [TotalApps] as Apps from #tempPackagingTable

	if @mode = 3 
		select [#], [ABS], [ApplicationID], [DType],[Ready],  [PackageID], [AIC], [IC], [ReadyByDate], [CC]
			, IsNull((select c.[Name] from [ARM_CORE]..[A_Collection] c LEFT JOIN [ARM_CORE]..[A_CollectionItem] i on  c.CollectionID = i.CollectionID where c.CollectionClassID = 18 and i.ItemID = ApplicationID),'-') as [State]
			, [New ABS] from #tempPackagingTable 
--		LEFT JOIN [ARM_CORE]..[A_CollectionItem] i on i.ItemID = [ApplicationID] 
--		LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionID = i.CollectionID and  c.CollectionClassID = 18 
--		where NOT c.[Name] IS NULL
		order by [#]

	if @mode = 4 
		BEGIN
			DECLARE @Columns VARCHAR(MAX)

			select [ABS], ApplicationID, BIC as mark, '=VLOOKUP(INDIRECT(CONCATENATE("$C",ROW())),Checks!B:C,2,FALSE)' as [Check1], '=VLOOKUP(INDIRECT(CONCATENATE("$C",ROW())),Checks!G:H,2,FALSE)' as [Check2], [DType], [NEW ABS], [IC],  (CASE WHEN BArea like 'APEL%' THEN 'APEL' ELSE BArea END) as BArea into #tempShortList from #tempPackagingTable

			SELECT @columns = STUFF(( SELECT DISTINCT TOP 100 PERCENT
											'],[' + cast( BArea as varchar)
									FROM    #tempShortList AS t2
									ORDER BY '],[' + cast( BArea as varchar)
									FOR XML PATH('')
								  ), 1, 2, '') + ']'

			DECLARE @query VARCHAR(8000)

			SET @query = '
			SELECT ''=VLOOKUP(INDIRECT(CONCATENATE("C",ROW())),List!B:J,9,FALSE)'' as [Required by], IsNull((select c.[Name] from [ARM_CORE]..[A_Collection] c LEFT JOIN [ARM_CORE]..[A_CollectionItem] i on  c.CollectionID = i.CollectionID where c.CollectionClassID = 18 and i.ItemID = p.ApplicationID),''-'') as [State] , *
			FROM #tempShortList 
			PIVOT
			(
			Sum(mark)
			FOR [BArea]
			IN (' + @columns + ')
			)
			AS p 	order by IC desc, ApplicationID	
			'
		
			EXECUTE(@query)
			DROP TABLE #tempShortList
		END

	if @mode = 5 
		select [#], [ABS], [ApplicationID], [DType],[Ready],  [PackageID], [AIC], [IC], [ReadyByDate], [CC], 
			IsNull((select c.[Name] from [ARM_CORE]..[A_Collection] c LEFT JOIN [ARM_CORE]..[A_CollectionItem] i on  c.CollectionID = i.CollectionID where c.CollectionClassID = 18 and i.ItemID = ApplicationID),'-') as [State]
			from #tempPackagingTable 

		order by [#]

	DROP TABLE #tempPackagingTable

 END
 
GO
CREATE PROCEDURE [dbo].[Apps-Package-ByDeployDate]
	@distinct as int = 999,
	@mode as int = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	declare @TheDate date
 	declare @ThisDate date
 	declare @wk int
 	declare @AppC int
 	declare @TotalApps int

	
	select row_number() OVER ( ORDER BY IsNull(LIST.ReadyByDate,'2020-04-01'),LIST.AIC desc,LIST.IC desc, LIST.ApplicationID) AS [#], LIST.*, 
		Count(ApplicationID) OVER ( PARTITION BY IsNull(LIST.ReadyByDate,'2020-04-01') ) AS cc, 0 as [days], 0 as [TotalApps]
	INTO #tempPackagingTable
	from (
		select APPS.*, row_number() OVER ( PARTITION BY APPS.ApplicationID ORDER BY APPS.ApplicationID, IsNull(APPS.ReadyByDate,'2020-04-01') ) AS dc, c.[Name] as [Virtualise]
		from (
			select distinct  a.LocalID as [ABS], b.ApplicationID as [ApplicationID], IsNull(a.DeployType,'-') as DType, IsNull(a.ready,0) as Ready,  
				a.PackageID, CUT_IC.IC as AIC, TOTAL_IC.IC AS IC, DateAdd(day,-14,IsNull(d.DeploymentStartDate,'2020-04-01')) as ReadyByDate
			from [ARM_CORE]..[AppAstToBe] b 
			LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = b.ApplicationID 
			LEFT JOIN [ARM_CORE]..[Asset] t on t.AssetID = b.AssetID 
			LEFT JOIN [ARM_CORE]..[BAREA] d on d.BArea = t.BArea 
			LEFT JOIN [ARM_CORE]..[A_Lookup] lu ON lu.[Table] = 'Internal' and lu.[Column] = 'RAG' 
			LEFT JOIN ( select z.ApplicationID, count(distinct z.AssetID) as IC, IsNull(x.DeploymentStartDate,'2020-04-01') as DeploymentStartDate from [ARM_CORE]..[AppAstToBe] z LEFT JOIN [ARM_CORE]..[Asset] y on y.AssetID = z.AssetID LEFT JOIN [ARM_CORE]..[BArea] x on x.BArea = y.BArea where x.Internal = 0 and y.Live = 1 group by IsNull(x.DeploymentStartDate,'2020-04-01'), z.ApplicationID ) AS CUT_IC on CUT_IC.ApplicationID = b.ApplicationID and CUT_IC.[DeploymentStartDate] = IsNull(d.DeploymentStartDate,'2020-04-01')
			LEFT JOIN ( select z.ApplicationID, count(distinct z.AssetID) as IC from [ARM_CORE]..[AppAstToBe] z LEFT JOIN [ARM_CORE]..[Asset] y on y.AssetID = z.AssetID LEFT JOIN [ARM_CORE]..[BArea] x on x.BArea = y.BArea where x.Internal = 0 and y.Live = 1 group by z.ApplicationID ) AS TOTAL_IC on TOTAL_IC.ApplicationID = b.ApplicationID 


			where IsNull(a.DeployType,'-') <> 'B' and IsNull(a.DeployType,'-') <> 'Pw'  and IsNull(a.DeployType,'-') <> 'M' and IsNull(lu.[Label],'*') <> 'R' and IsNull(lu.[Label],'*') <> 'B'  and IsNull(lu.[Label],'*') <> 'X' 
				and IsNull(a.DeployType,'-') <> 'X' and IsNull(lu.[Lookup],'*') <> 'X'
				and IsNull(d.Internal,0) = 0 and t.Live = 1 and IsNull(a.LocalID,'-') <> '-' and IsNull(a.ready,0) = 1
				and NOT t.AssetID like '%-%'			

		) as APPS
		LEFT JOIN [ARM_CORE]..[A_CollectionItem] i on i.ItemID = APPS.[ApplicationID] 
		LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionID = i.CollectionID and  c.CollectionClassID = 18  
		where NOT c.[Name] IS NULL and NOT c.Deployed = 1
	) as LIST

	where LIST.dc <= @distinct  
	Order by IsNull(LIST.ReadyByDate,'2020-04-01'),LIST.AIC desc,LIST.IC desc, LIST.ApplicationID


	select @ThisDate = getdate()
	set @wk = 0
	set @TotalApps = 0

	DECLARE update_cursor CURSOR FOR SELECT distinct ReadyByDate, cc  FROM #tempPackagingTable order by ReadyByDate 

	OPEN update_cursor
	FETCH FROM update_cursor INTO @TheDate, @AppC
 
	-- check for a new row
	WHILE @@FETCH_STATUS=0
	BEGIN
		-- do update operation
		select @wk = DATEDIFF(day,@ThisDate,@TheDate)
		set @TotalApps = @TotalApps + @AppC
		UPDATE #tempPackagingTable set [days] = @wk, [TotalApps] = @TotalApps where ReadyByDate = @TheDate

		set @ThisDate = @TheDate
--		WHERE CURRENT OF update_cursor 
		-- get next available row into variables
		FETCH FROM update_cursor INTO @TheDate, @AppC
	END
	close update_cursor

	-- list of all applications to package
	if @mode = 0 
		select t.*, Round((Cast([cc] as Float)/[days])*7,1)  as [RunRate], DATEDIFF(day,getdate(),[ReadyByDate]) as [TotalDays], d.[Type] as [DAL Type] from #tempPackagingTable t
		LEFT JOIN [TMP_RAW_AstellasDAL] d on d.[ABS] = t.[ABS]

	-- RunRate for Candlestick chart depicted as Step Chart
	if @mode = 1 
		select distinct 'By ' + cast ([ReadyByDate] as nvarchar(20)), 0 ,0 , Round((Cast([cc] as Float)/[days])*7,1) , Round((Cast([cc] as Float)/[days])*7,1)  from #tempPackagingTable where IsNull(ReadyByDate,'2020-04-01') > GETDATE()

		-- summary profile
	if @mode = 2 
		select '2019-09-12', 0, 0
		UNION
		select distinct [ReadyByDate], [TotalApps], [TotalApps] as Apps from #tempPackagingTable

	if @mode = 3 
		select [#], [ABS], [ApplicationID], [DType],[Ready],  [PackageID], [AIC], [IC], [ReadyByDate], [CC], [Virtualise] from #tempPackagingTable 
--		LEFT JOIN [ARM_CORE]..[A_CollectionItem] i on i.ItemID = [ApplicationID] 
--		LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionID = i.CollectionID and  c.CollectionClassID = 18 
--		where NOT c.[Name] IS NULL
		order by [#]


	DROP TABLE #tempPackagingTable

 END
GO
-- =============================================
-- Author:             <Author,,Name>
-- alter date: <alter Date,,>
-- Description:        <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Apps-miniUAM] 
        -- Add the parameters for the stored procedure here
@Slice nvarchar(255) ,
@SliceTerm nvarchar(255) ,
@AppKey1 nvarchar(255) = '',
@AppKey2 nvarchar(255) = '',
@AppKey3 nvarchar(255) = '',
@AppKey4 nvarchar(255) = '',
@AppKey5 nvarchar(255) = '',
@AsIs bit = 1
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
        SET NOCOUNT ON;
        if @AsIS = 1
               if @slice = 'BArea' 
                       select c.AssetID, c.Owner, c.Email,
                       c.BArea, c.Location, c.Live,
                       IsNull((select distinct w.AssetID from [ARM_CORE].dbo.[AppAstAsIs] w where w.AssetID = c.AssetID and RTrim(w.ApplicationID) = @AppKey1 ),'0') As App1, 
                        IsNull((select distinct w.AssetID from [ARM_CORE].dbo.[AppAstAsIs] w where w.AssetID = c.AssetID and RTrim(w.ApplicationID) = @AppKey2 ),'0') As App2, 
                        IsNull((select distinct w.AssetID from [ARM_CORE].dbo.[AppAstAsIs] w where w.AssetID = c.AssetID and RTrim(w.ApplicationID) = @AppKey3 ),'0') As App3, 
                        IsNull((select distinct w.AssetID from [ARM_CORE].dbo.[AppAstAsIs] w where w.AssetID = c.AssetID and RTrim(w.ApplicationID) = @AppKey4 ),'0') As App4, 
                        IsNull((select distinct w.AssetID from [ARM_CORE].dbo.[AppAstAsIs] w where w.AssetID = c.AssetID and RTrim(w.ApplicationID) = @AppKey5 ),'0') As App5 
                        from [ARM_CORE]..[Asset] c 
                        where c.Live = 1 and c.[BArea] like  @SliceTerm  order by Owner, c.AssetID
               else if @slice = 'COLLECTION'
                       select c.AssetID, c.Owner, c.Email,
                       c.BArea, c.Location, c.Live,
                       IsNull((select distinct w.AssetID from [ARM_CORE].dbo.[AppAstAsIs] w where w.AssetID = c.AssetID and RTrim(w.ApplicationID) = @AppKey1 ),'0') As App1, 
                        IsNull((select distinct w.AssetID from [ARM_CORE].dbo.[AppAstAsIs] w where w.AssetID = c.AssetID and RTrim(w.ApplicationID) = @AppKey2 ),'0') As App2, 
                        IsNull((select distinct w.AssetID from [ARM_CORE].dbo.[AppAstAsIs] w where w.AssetID = c.AssetID and RTrim(w.ApplicationID) = @AppKey3 ),'0') As App3, 
                        IsNull((select distinct w.AssetID from [ARM_CORE].dbo.[AppAstAsIs] w where w.AssetID = c.AssetID and RTrim(w.ApplicationID) = @AppKey4 ),'0') As App4, 
                        IsNull((select distinct w.AssetID from [ARM_CORE].dbo.[AppAstAsIs] w where w.AssetID = c.AssetID and RTrim(w.ApplicationID) = @AppKey5 ),'0') As App5 
                        from [ARM_CORE]..[A_CollectionItem] f LEFT JOIN [ARM_CORE]..[Asset] c on c.AssetID = f.ItemID  
                        where c.Live = 1 and f.CollectionID = @SliceTerm order by Owner, c.AssetID
               else
                       select c.AssetID, c.Owner, c.Email,
                       c.BArea, c.Location, c.Live,
                       IsNull((select distinct w.AssetID from [ARM_CORE].dbo.[AppAstAsIs] w where w.AssetID = c.AssetID and RTrim(w.ApplicationID) = @AppKey1 ),'0') As App1, 
                        IsNull((select distinct w.AssetID from [ARM_CORE].dbo.[AppAstAsIs] w where w.AssetID = c.AssetID and RTrim(w.ApplicationID) = @AppKey2 ),'0') As App2, 
                        IsNull((select distinct w.AssetID from [ARM_CORE].dbo.[AppAstAsIs] w where w.AssetID = c.AssetID and RTrim(w.ApplicationID) = @AppKey3 ),'0') As App3, 
                        IsNull((select distinct w.AssetID from [ARM_CORE].dbo.[AppAstAsIs] w where w.AssetID = c.AssetID and RTrim(w.ApplicationID) = @AppKey4 ),'0') As App4, 
                        IsNull((select distinct w.AssetID from [ARM_CORE].dbo.[AppAstAsIs] w where w.AssetID = c.AssetID and RTrim(w.ApplicationID) = @AppKey5 ),'0') As App5
                       from [ARM_CORE]..[Asset] c   
                        where c.Live = 1 and c.Location like  @SliceTerm  order by Owner, AssetID
        else
               if @slice = 'BArea' 
                       select c.AssetID, c.Owner, c.Email,
                       c.BArea, c.Location, c.Live,
                       IsNull((select distinct w.AssetID from [ARM_CORE].dbo.[AppAstToBe] w where w.AssetID = c.AssetID and RTrim(w.ApplicationID) = @AppKey1 ),'0') As App1, 
                        IsNull((select distinct w.AssetID from [ARM_CORE].dbo.[AppAstToBe] w where w.AssetID = c.AssetID and RTrim(w.ApplicationID) = @AppKey2 ),'0') As App2, 
                        IsNull((select distinct w.AssetID from [ARM_CORE].dbo.[AppAstToBe] w where w.AssetID = c.AssetID and RTrim(w.ApplicationID) = @AppKey3 ),'0') As App3, 
                        IsNull((select distinct w.AssetID from [ARM_CORE].dbo.[AppAstToBe] w where w.AssetID = c.AssetID and RTrim(w.ApplicationID) = @AppKey4 ),'0') As App4, 
                        IsNull((select distinct w.AssetID from [ARM_CORE].dbo.[AppAstToBe] w where w.AssetID = c.AssetID and RTrim(w.ApplicationID) = @AppKey5 ),'0') As App5 
                        from [ARM_CORE]..[Asset] c 
                        where c.Live = 1 and c.[BArea] like  @SliceTerm  order by Owner, c.AssetID
               else if @slice = 'COLLECTION'
                       select c.AssetID, c.Owner, c.Email,
                       c.BArea, c.Location, c.Live,
                       IsNull((select distinct w.AssetID from [ARM_CORE].dbo.[AppAstToBe] w where w.AssetID = c.AssetID and RTrim(w.ApplicationID) = @AppKey1 ),'0') As App1, 
                        IsNull((select distinct w.AssetID from [ARM_CORE].dbo.[AppAstToBe] w where w.AssetID = c.AssetID and RTrim(w.ApplicationID) = @AppKey2 ),'0') As App2, 
                        IsNull((select distinct w.AssetID from [ARM_CORE].dbo.[AppAstToBe] w where w.AssetID = c.AssetID and RTrim(w.ApplicationID) = @AppKey3 ),'0') As App3, 
                        IsNull((select distinct w.AssetID from [ARM_CORE].dbo.[AppAstToBe] w where w.AssetID = c.AssetID and RTrim(w.ApplicationID) = @AppKey4 ),'0') As App4, 
                        IsNull((select distinct w.AssetID from [ARM_CORE].dbo.[AppAstToBe] w where w.AssetID = c.AssetID and RTrim(w.ApplicationID) = @AppKey5 ),'0') As App5 
                        from [ARM_CORE]..[A_CollectionItem] f LEFT JOIN [ARM_CORE]..[Asset] c on c.AssetID = f.ItemID  
                        where c.Live = 1 and f.CollectionID = @SliceTerm order by Owner, c.AssetID
               else
                       select c.AssetID, c.Owner, c.Email,
                       c.BArea, c.Location, c.Live,
                       IsNull((select distinct w.AssetID from [ARM_CORE].dbo.[AppAstToBe] w where w.AssetID = c.AssetID and RTrim(w.ApplicationID) = @AppKey1 ),'0') As App1, 
                        IsNull((select distinct w.AssetID from [ARM_CORE].dbo.[AppAstToBe] w where w.AssetID = c.AssetID and RTrim(w.ApplicationID) = @AppKey2 ),'0') As App2, 
                        IsNull((select distinct w.AssetID from [ARM_CORE].dbo.[AppAstToBe] w where w.AssetID = c.AssetID and RTrim(w.ApplicationID) = @AppKey3 ),'0') As App3, 
                        IsNull((select distinct w.AssetID from [ARM_CORE].dbo.[AppAstToBe] w where w.AssetID = c.AssetID and RTrim(w.ApplicationID) = @AppKey4 ),'0') As App4, 
                        IsNull((select distinct w.AssetID from [ARM_CORE].dbo.[AppAstToBe] w where w.AssetID = c.AssetID and RTrim(w.ApplicationID) = @AppKey5 ),'0') As App5
                       from [ARM_CORE]..[Asset] c   
                        where c.Live = 1 and c.Location like  @SliceTerm  order by Owner, AssetID
END
 
 
 
/****** Object:  StoredProcedure [dbo].[NewWorkstream]    Script Date: 17/09/2018 21:38:38 ******/
SET ANSI_NULLS ON

GO
-- =============================================
-- Author:             <Author,,Name>
-- Create date: <Create Date,,>
-- Description:        <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Apps-LocationCounters]
        @AppID as nVarchar(255),
        @Scope as nVarchar(255) = 'AppAstAsIs',
        @Internal as int = 0,
        @Live as int = 1,
        @OS as nVarchar(255) = ''
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
        SET NOCOUNT ON;
        set @OS = '%' + @OS + '%'
    IF @Scope= 'AppAstAsIs'
        BEGIN
               Select IsNull(a.Location,'') as Slice, IsNull(x.Counter,0) As AppInstalls, count(a.AssetID)  AS AssetTotal
               from [ARM_CORE]..[Asset] a 
               LEFT JOIN [ARM_CORE]..[BArea] b on b.BArea = IsNull(a.BArea,'') 
               LEFT JOIN (
                       select IsNull(aa.Location,'') as Location, count(ss.AssetID) AS Counter
                       from [ARM_CORE]..AppAstAsIs ss 
                       LEFT JOIN [ARM_CORE]..Asset aa on aa.AssetID = ss.AssetID
                       LEFT JOIN [ARM_CORE]..[BArea] bb on bb.BArea = IsNull(aa.BArea,'')  
                       where ss.ApplicationID = @AppID and bb.Internal = @Internal
                       Group By IsNull(aa.Location,'') 
               ) x on x.Location = IsNull(a.Location,'') 
               where IsNull(a.[OS],'') like @OS and IsNull(a.Live,0) = @Live
               Group By IsNull(a.Location,'') ,IsNull(x.Counter,0)
               Order by IsNull(a.Location,'') 
 
        END
        ELSE
        BEGIN
               Select IsNull(a.Location,'')  as Slice, IsNull(x.Counter,0) As AppInstalls, count(a.AssetID)  AS AssetTotal
               from [ARM_CORE]..[Asset] a 
               LEFT JOIN [ARM_CORE]..[BArea] b on b.BArea = IsNull(a.BArea,'') 
               LEFT JOIN (
                       select IsNull(aa.Location,'') as Location, count(ss.AssetID) AS Counter
                       from [ARM_CORE]..AppAstToBe ss 
                       LEFT JOIN [ARM_CORE]..Asset aa on aa.AssetID = ss.AssetID
                       LEFT JOIN [ARM_CORE]..[BArea] bb on bb.BArea = IsNull(aa.BArea,'')  
                       where ss.ApplicationID = @AppID and bb.Internal = @Internal
                       Group By IsNull(aa.Location,'') 
               ) x on x.Location = IsNull(a.Location,'') 
               where IsNull(a.[OS],'') like @OS and IsNull(a.Live,0) = @Live
               Group By IsNull(a.Location,'') ,IsNull(x.Counter,0)
               Order by IsNull(a.Location,'') 
        END
END

GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Apps-Lists-BAreas]
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	SELECT distinct t.ApplicationID, a.BArea, Count(t.AssetID) as Installs, n.LocalID
	INTO #tempPivotTable2
	FROM [ARM_CORE]..AppAstToBe t 
	LEFT JOIN [ARM_CORE]..Asset a on a.AssetID = t.AssetID 
	LEFT JOIN [ARM_CORE]..[BArea] b on b.BArea = a.BArea 
	LEFT JOIN [ARM_CORE]..[Application] n on n.ApplicationID = t.ApplicationID
	where b.Internal =0 and NOT a.BArea like '%]' group by t.ApplicationID, a.BArea, n.LocalID


	select distinct t2.LocalID, t2.ApplicationID, CAST(STUFF(( SELECT DISTINCT TOP 100 PERCENT
									', ' + cast([BArea] as varchar) + '(' + cast([Installs] as varchar) + ')'
							FROM    #tempPivotTable2 AS t3
							WHERE t3.ApplicationID = t2.ApplicationID
							ORDER BY ', ' + cast([BArea] as varchar) + '(' + cast([Installs] as varchar) + ')'
							FOR XML PATH('')
						  ), 1, 2, '') AS varchar(3000)) as Installs
	FROM #tempPivotTable2 t2 order by t2.ApplicationID



	DROP TABLE #tempPivotTable2
END




GO
CREATE PROCEDURE [dbo].[Apps-ListForAsset-YES]
	@AssetID as Varchar(255)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Returns list of all Application Candidates for given asset
	-- If Inclusive flag set to 1 then ALL valid applications are listed
	-- If Inclusive flag set to 0 then ONLy valid applications that are currently not associated with Asset are listed


	select distinct b.ApplicationID as AppKey, b.ApplicationID AS Friendly, IsNull(a.DeployType,'-') as DType, a.ready, IsNull(lu.[Label],'*') AS [RAG],
	a.LocalID, a.PackageID, 
	(select count(ua.AssetID) from [ARM_CORE]..[ApplicationTransaction] ua where ua.AssetID = b.AssetID and ua.ApplicationID = b.ApplicationID and ua.[Rewind] = 1 ) AS UserApp, 
	a.LifeCycle, IsNull(g.Description,'') AS [AppDesc]
	from [ARM_CORE]..[AppAstToBe] b  
	LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = b.ApplicationID 
	LEFT JOIN [ARM_CORE]..[AppGroup] g on g.AppGroupID = a.AppGroupID
	LEFT JOIN [ARM_CORE]..[Asset] t on t.AssetID = b.AssetID 
	LEFT JOIN [ARM_CORE]..[BArea] d on d.BArea = t.BArea   
	LEFT JOIN [ARM_CORE]..[A_Lookup] lu ON lu.[Table] = 'Internal' 
	where  b.AssetID = @AssetID and IsNull(a.DeployType,'-') <> 'B' and IsNull(lu.[Label],'*') <> 'R' and IsNull(lu.[Label],'*') <> 'B' and IsNull(lu.[Label],'*') <> 'X' and a.DeployType <> 'X'
	order by b.ApplicationID

END







GO
CREATE PROCEDURE [dbo].[Apps-ListForAsset-X]
	@AssetID as Varchar(255)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Returns list of all Application Candidates for given asset
	-- If Inclusive flag set to 1 then ALL valid applications are listed
	-- If Inclusive flag set to 0 then ONLy valid applications that are currently not associated with Asset are listed


	select distinct b.ApplicationID as AppKey, b.ApplicationID AS Friendly, IsNull(a.DeployType,'-') as DType, a.ready, IsNull(lu.[Label],'*') AS [RAG],
	a.LocalID, a.PackageID, 
	(select count(ua.AssetID) from [ARM_CORE]..[ApplicationTransaction] ua where ua.AssetID = b.AssetID and ua.ApplicationID = b.ApplicationID and ua.[Rewind] = 1 ) AS UserApp, 
	a.LifeCycle, IsNull(g.Description,'') AS [AppDesc]
	from [ARM_CORE]..[AppAstToBe] b  
	LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = b.ApplicationID 
	LEFT JOIN [ARM_CORE]..[AppGroup] g on g.AppGroupID = a.AppGroupID
	LEFT JOIN [ARM_CORE]..[Asset] t on t.AssetID = b.AssetID 
	LEFT JOIN [ARM_CORE]..[BArea] d on d.BArea = t.BArea   
	LEFT JOIN [ARM_CORE]..[A_Lookup] lu ON lu.[Table] = 'Internal' 
	where  b.AssetID = @AssetID and b.ApplicationID <> '_WIP-101' and (IsNull(a.DeployType,'-') = 'X' or IsNull(a.Exclude,0) = 1) 
	order by b.ApplicationID

END


GO
CREATE PROCEDURE [dbo].[Apps-ListForAsset-Packages]
        @AssetID as Varchar(255)
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
        SET NOCOUNT ON;
    -- Returns list of all Application Candidates for given asset
        -- If Inclusive flag set to 1 then ALL valid applications are listed
        -- If Inclusive flag set to 0 then ONLy valid applications that are currently not associated with Asset are listed
        declare @WhenRun as Date;
        set @WhenRun =  getdate()
        select distinct b.AssetID, 
                       CASE  
                       WHEN  IsNull(a.PackageID,'') = '' THEN b.ApplicationID 
                       ELSE a.PackageID 
               END as [Package/Application ID],  
               IsNull(a.DeployType,'-') as [Type],
               t.[UserID] as [UserID], @WhenRun as [Date],
               IsNull(a.[ready],0) as [Ready]
        from [ARM_CORE]..[AppAstToBe] b  
        LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = b.ApplicationID 
        LEFT JOIN [ARM_CORE]..[AppGroup] g on g.AppGroupID = a.AppGroupID
        LEFT JOIN [ARM_CORE]..[Asset] t on t.AssetID = b.AssetID 
        LEFT JOIN [ARM_CORE]..[BArea] d on d.BArea = t.BArea   
        LEFT JOIN [ARM_CORE]..[A_Lookup] lu ON lu.[Table] = 'Internal' 
        where  b.AssetID = @AssetID and IsNull(a.DeployType,'-') IN ( 'P','P+','P3','M','V') 
        and IsNull(lu.[Label],'*') <> 'R' and IsNull(lu.[Label],'*') <> 'B' and IsNull(lu.[Label],'*') <> 'X'
        and IsNull(a.ready,0) = 1
        order by AssetID
END
 
 
 



GO
CREATE PROCEDURE [dbo].[Apps-ListForAsset-NO]
	@AssetID as Varchar(255)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Returns list of all Application Candidates for given asset
	-- If Inclusive flag set to 1 then ALL valid applications are listed
	-- If Inclusive flag set to 0 then ONLy valid applications that are currently not associated with Asset are listed


	select distinct b.ApplicationID as AppKey, col.Name as Reason, b.ApplicationID AS Friendly, IsNull(a.DeployType,'-') as DType, a.ready, IsNull(lu.[Label],'*') AS [RAG],
	a.LocalID, a.PackageID, 
	(select count(ua.AssetID) from [ARM_CORE]..[ApplicationTransaction] ua where ua.AssetID = b.AssetID and ua.ApplicationID = b.ApplicationID and ua.[Rewind] = 1 ) AS UserApp, 
	a.LifeCycle, IsNull(g.Description,'') AS [AppDesc]
	from [ARM_CORE]..[AppAstToBe] b  
	LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = b.ApplicationID 
	LEFT JOIN [ARM_CORE]..[AppGroup] g on g.AppGroupID = a.AppGroupID
	LEFT JOIN [ARM_CORE]..[Asset] t on t.AssetID = b.AssetID 
	LEFT JOIN [ARM_CORE]..[BArea] d on d.BArea = t.BArea   
	LEFT JOIN [ARM_CORE]..[A_Lookup] lu ON lu.[Table] = 'Internal' 
	left join [ARM_CORE]..A_CollectionItem i on i.ItemID = a.ApplicationID
	left join [ARM_CORE]..A_Collection col on col.CollectionID = i.CollectionID
	where  b.AssetID = @AssetID and a.DeployType = 'X'
	order by b.ApplicationID

END







GO
CREATE PROCEDURE [dbo].[Apps-ListForAsset-InstallOnly]
	@AssetID as Varchar(255)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Returns list of all Application Candidates for given asset
	-- If Inclusive flag set to 1 then ALL valid applications are listed
	-- If Inclusive flag set to 0 then ONLy valid applications that are currently not associated with Asset are listed


	select distinct b.ApplicationID as AppKey, b.ApplicationID AS Friendly, IsNull(a.DeployType,'-') as DType, a.ready, IsNull(lu.[Label],'*') AS [RAG],
	a.LocalID, a.PackageID, 
	(select count(ua.AssetID) from [ARM_CORE]..[ApplicationTransaction] ua where ua.AssetID = b.AssetID and ua.ApplicationID = b.ApplicationID and ua.[Rewind] = 1 ) AS UserApp, 
	a.LifeCycle, IsNull(g.Description,'') AS [AppDesc]
	from [ARM_CORE]..[AppAstToBe] b  
	LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = b.ApplicationID 
	LEFT JOIN [ARM_CORE]..[AppGroup] g on g.AppGroupID = a.AppGroupID
	LEFT JOIN [ARM_CORE]..[Asset] t on t.AssetID = b.AssetID 
	LEFT JOIN [ARM_CORE]..[BArea] d on d.BArea = t.BArea   
	LEFT JOIN [ARM_CORE]..[A_Lookup] lu ON lu.[Table] = 'Internal' 
	where  b.AssetID = @AssetID  and IsNull(a.DeployType,'-') IN ( 'P','P+','P3','M','V')  and IsNull(lu.[Label],'*') <> 'R' and IsNull(lu.[Label],'*') <> 'B' and IsNull(lu.[Label],'*') <> 'X' 
		
	order by b.ApplicationID

END







GO
CREATE PROCEDURE [dbo].[Apps-ListForAsset]
	@AssetID as Varchar(255)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Returns list of all Application Candidates for given asset
	-- If Inclusive flag set to 1 then ALL valid applications are listed
	-- If Inclusive flag set to 0 then ONLy valid applications that are currently not associated with Asset are listed


select * from (
	select distinct b.ApplicationID as AppKey, b.ApplicationID AS Friendly, IsNull(a.DeployType,'-') as DType, a.ready, 
	a.LocalID, a.PackageID, 
	(select count(ua.AssetID) from [ARM_CORE]..[ApplicationTransaction] ua where ua.AssetID = b.AssetID and ua.ApplicationID = b.ApplicationID and ua.[Rewind] = 1 ) AS UserApp, 
	a.LifeCycle, IsNull(g.Description,'') AS [AppDesc]
	from [ARM_CORE]..[AppAstToBe] b  
	LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = b.ApplicationID 
	LEFT JOIN [ARM_CORE]..[AppGroup] g on g.AppGroupID = a.AppGroupID
	LEFT JOIN [ARM_CORE].[dbo].[A_AppGroupType] gt on gt.AppGroupType = g.AppGroupType
	LEFT JOIN [ARM_CORE]..[Asset] t on t.AssetID = b.AssetID 
	LEFT JOIN [ARM_CORE]..[BArea] d on d.BArea = t.BArea   
	where  b.AssetID = @AssetID and IsNull(a.DeployType,'-') <> 'X' and IsNull(a.Exclude,0) = 0
		and IsNull(gt.[Stop],0) = 0 and IsNull(gt.[Exclude],0) = 0

) R -- where R.UserApp = 0
	order by R.AppKey

END







GO
CREATE PROCEDURE [dbo].[Apps-ListCandidatesForAsset]
	@AssetID as Varchar(255)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Returns list of all Application Candidates for given asset are NOT currently associated with Asset are listed
	-- Status field provides optional.  If not supplied ALL applications returned. 


select distinct a.[ApplicationID] AS ApplicationID,
	IsNull(a.[DeployType],'N/S') as [DType], isNull(a.[Ready],0) as Ready, 
	RTrim(a.[ApplicationID]) AS Friendly
	from [ARM_CORE]..AppAstToBe b 
	LEFT JOIN [ARM_CORE]..Application a on a.ApplicationID = b.ApplicationID
	where  NOT a.ApplicationID IN (select aa.[ApplicationID] from [ARM_CORE]..AppAstToBe aa where aa.AssetID = @AssetID) 
	and NOT a.ApplicationID IS NULL
	order by a.[ApplicationID] ASC


END



GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Apps-LicencePosition]
	@Status as Varchar(255) = '',
	@AppGrpID as int = 0
--	@AppGrpID as uniqueIdentifier = '{00000000-0000-0000-0000-000000000000}'
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Returns list of all Licences and allocations

	DECLARE @query VARCHAR(8000)
	DECLARE @condition VARCHAR(8000)

	set @condition = ''

	--List Lic Info for any Primary AppGroups that are Managed, True Up or TBC
	select x.ApplicationID, x.[_LicLink] as AppGroupID, x.AppGroupName,x.[_LicLink],x.[_Lics],x.Installs, x.Licences,x.Delta, x.[Licence Cost], x.[Licence Risk], iif(x.Delta> 0, x.Delta * x.[Licence Cost],0)as [Total Cost],  
	iif(x.Delta > 0,x.Delta * x.[Licence Risk],0) as [Total Risk], x.Tracking,
	CASE --Application status
		WHEN x.Tracking in ('TBC','') THEN 'WIP'
		WHEN x.Delta > 0 and x.Tracking not in ('Controlled','Free') THEN 'Issue'
		WHEN x.Delta > 0 and x.Tracking = 'True Up' THEN 'Review'
		WHEN x.Licences > x.Installs THEN 'Reduce'
		ELSE 'OK'
	END as [Status]
	from (
		select c.ApplicationID, isnull(c.[Count],0) as Installs, g.AppGroupName, c.AppGroupID as [_LicLink], isnull(l.[Instances],0) as [_Lics], isnull(y.Licences,0) as Licences,
		isnull(g.LicenceCost,0) as [Licence Cost], isnull(g.LicenceRisk,0) as [Licence Risk], 
		isnull(g.LicenceTracking,'TBC - Not Set') as Tracking, isnull(c.[Count],0) - isnull(y.Licences,0) as Delta  from ARM_CORE..s_ApplicationToBeInstallCount c
		left join arm_core..AppGroup g on g.AppGroupID = c.AppGroupID
		LEFT JOIN (select x.AppGroupID, count(x.LicenceID) as [Instances] from ARM_CORE..Licence x group by x.AppGroupID )  l on l.AppGroupID = c.AppGroupID
		left join (select l.AppGroupID, sum(l.licences) as [Licences] from ARM_CORE..Licence l group by l.AppGroupID) y on y.AppGroupID = c.AppGroupID
		where g.AppGroupID = @AppGrpID
	) x
	





	if @Status = 'Managed' set @condition = ' and y.Tracking = ''Managed'' and y.[Assigned] < y.[Installs] '
	if @Status = 'Other' set @condition = ' and y.Tracking <> ''Managed'' and y.[Assigned] < y.[Installs] '
	if @Status = 'Compliant' set @condition = ' and (y.[Assigned] >= y.[Installs] ) '

--	if @AppGrpID  <> '{00000000-0000-0000-0000-000000000000}' set @condition = @condition + ' and y.UNID = ''' + convert(varchar(250),@AppGrpID) + ''' '
	if @AppGrpID  <> 0 set @condition = @condition + ' and y.AppGroupID = ' + convert(varchar(250),@AppGrpID) + ' '


	SET @query = '
	select y.ApplicationID,y.[Installs], y.LicencesListed, y.Licences, iif(y.Licences - y.Assigned>0, y.Licences - y.Assigned,0 ) as [Available], y.Assigned as Assigned,
		iif(y.Installs - y.Assigned > 0, y.Installs - y.Assigned,0) as [Requirement], y.LicenceCost, y.LicenceRisk, 
		iif(y.Installs - y.Assigned > 0, y.Installs - y.Assigned,0) * y.licencecost as [TotalCost],  
		iif(y.Installs - y.Assigned > 0, y.Installs - y.Assigned,0) * y.LicenceRisk as [TotalRisk], 
		y.Tracking, y.AppGroupID,
		CASE
			WHEN y.Installs > y.Licences and y.Assigned > y.Licences THEN ''Over''
			WHEN y.Installs > y.Licences and y.Assigned < y.Licences THEN ''Under''
			ELSE ''''
		END as [Alert]
	from (
		select x.ApplicationID, isnull(mm.Licences,0) as Licences, x.Installs, isnull(mm.Assigned,0) as Assigned, g.LicenceCost, g.LicenceRisk, g.LicenceTracking as Tracking, a.DeployType, 
			g.AppGroupID,  g.UNID, la.LicencesListed
		from (
			select b.ApplicationID, count(b.assetid) as [Installs] 
			from ARM_CORE..AppAstToBe b group by b.ApplicationID
		)  x
		left join (
			select m.applicationID, Sum(isnull(m.Assigned,0)) as Assigned, Sum(isnull(l.Licences,0)) as Licences from arm_core..LicenceMap m left join ARM_CORE..Licence l on l.LicenceID = m.licenceid group by m.ApplicationID
		)  mm on mm.applicationid = x.ApplicationID
		left join ARM_CORE..Application a on a.ApplicationID = x.ApplicationID
		left join arm_core..AppGroup g on g.AppGroupID = a.AppGroupID
		LEFT JOIN (
			select x.AppGroupID, count(x.LicenceID) as [LicencesListed] 
			from ARM_CORE..Licence x group by x.AppGroupID
		)  la on la.AppGroupID = a.AppGroupID
	)  y
	where y.deploytype <> ''B'' ' + @condition + '	order by y.Installs DESC '
	

--	exec (@query)
END





GO
-- =============================================
-- Author:             John Reed
-- alter date: 26-05-2016
-- Description:        .
-- =============================================
CREATE PROCEDURE [dbo].[Apps-InitialMapping]
@AppID nvarchar(255) = '',
@MappingID nvarchar(255) = '',
@GroupID int = 0,
@GroupName nvarchar(255) = '',
@DeploymentType nvarchar(255) = '',
@Lifecycle nvarchar(255) = ''
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
        SET NOCOUNT ON;
        if @AppID <> '' 
        BEGIN
               --  Add Application 
 
               exec [ARM_CORE]..[Apps-AddApplication] @AppID;

               if @MappingID <> '' 
                       if @MappingID = '_RemoveMapping' 
                              DELETE from [ARM_CORE]..[TransformAppMap] where [As Is] = @AppID
                       else
                              MERGE [ARM_CORE]..[TransformAppMap] as Target using (select @AppID AS ApplicationID, @MappingID as ToBe) as Source
                              ON (target.[As Is]  = source.ApplicationID)
                              WHEN NOT MATCHED BY TARGET THEN 
                                      insert ([As Is],[To Be]) Values (Source.ApplicationID, Source.[ToBe])
                              WHEN MATCHED THEN 
                                      UPDATE set [To Be] = Source.[ToBe];
               
               if @DeploymentType <> ''
                       Update [ARM_CORE]..[Application] set [DeployType] = @DeploymentType where ApplicationID = @AppID;
               if @Lifecycle <> ''
                       Update [ARM_CORE]..[Application] set [Lifecycle] = @Lifecycle where ApplicationID = @AppID;
 
               if @GroupName <> '' 
               BEGIN
                       MERGE [ARM_CORE]..[AppGroup] as Target using (select @GroupName AS AppGroupName) as Source
                       ON (target.AppGroupName  = source.AppGroupName)
                       WHEN NOT MATCHED BY TARGET THEN 
                              insert (AppGroupName) Values (Source.AppGroupName);
                       UPDATE [ARM_CORE]..[Application] set AppGroupID = (select top 1 AppGroupID from [ARM_CORE]..[AppGroup] g where g.[AppGroupName] =  @GroupName) where ApplicationID = @AppID;
               END
               ELSE IF @GroupID > 0
                       UPDATE [ARM_CORE]..[Application] set AppGroupID = @GroupID where ApplicationID = @AppID;
                       
        END
END
 
 



GO
-- =============================================
-- Author:             <Author,,Name>
-- alter date: <alter Date,,>
-- Description:        <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Apps-GroupLocationCounters]
        @AppGroupID as int,
        @Scope as Varchar(255) = 'AppAstAsIs',
        @Internal as int = 0
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
        SET NOCOUNT ON;
 
    IF @Scope= 'AppAstAsIs'
        BEGIN
               select IsNull(IsNull(y.Location,a.Location),'') as Location, count(s.AssetID) AS Counter
               into #JRR
               from [ARM_CORE]..AppAstAsIs s 
               LEFT JOIN [ARM_CORE]..Asset a on a.AssetID = s.AssetID
               LEFT JOIN [ARM_CORE]..[AssetCache] y on y.AssetID = s.AssetID 
               LEFT JOIN [ARM_CORE]..Application p on p.ApplicationID = s.ApplicationID 
               LEFT JOIN [ARM_CORE]..AppGroup g on g.AppGroupID = p.AppGroupID  
               LEFT JOIN [ARM_CORE]..[BArea] b on b.BArea = IsNull(y.BArea,a.BArea)  
               where g.AppGroupID = @AppGroupID and IsNull(b.Internal,0) = 0
               Group By IsNull(IsNull(y.Location,a.Location),'')
               Select IsNull(a.Location,'') as Slice, IsNull(x.Counter,0) As AppInstalls, count(a.AssetID)  AS AssetTotal
               from [ARM_CORE]..[Asset] a 
               LEFT JOIN [ARM_CORE]..[AssetCache] y on y.AssetID = a.AssetID 
               LEFT JOIN #JRR x on x.Location = a.Location
               LEFT JOIN [ARM_CORE]..[BArea] b on b.BArea = IsNull(y.BArea,a.BArea) 
               Group By IsNull(a.Location,''),IsNull(x.Counter,0)
        END
        ELSE
        BEGIN
               select IsNull(IsNull(y.Location,a.Location),'') as Location, count(s.AssetID) AS Counter
               into #JRR2
               from [ARM_CORE]..AppAstToBe s 
               LEFT JOIN [ARM_CORE]..Asset a on a.AssetID = s.AssetID
               LEFT JOIN [ARM_CORE]..[AssetCache] y on y.AssetID = s.AssetID 
               LEFT JOIN [ARM_CORE]..Application p on p.ApplicationID = s.ApplicationID 
               LEFT JOIN [ARM_CORE]..AppGroup g on g.AppGroupID = p.AppGroupID  
               LEFT JOIN [ARM_CORE]..[BArea] b on b.BArea = IsNull(y.BArea,a.BArea)  
               where g.AppGroupID = @AppGroupID and IsNull(b.Internal,0) = 0
               Group By IsNull(IsNull(y.Location,a.Location),'')
               Select IsNull(a.Location,'') as Slice, IsNull(x.Counter,0) As AppInstalls, count(a.AssetID) AS AssetTotal
               from [ARM_CORE]..[Asset] a 
               LEFT JOIN [ARM_CORE]..[AssetCache] y on y.AssetID = a.AssetID 
               LEFT JOIN #JRR2 x on x.Location = a.Location
               LEFT JOIN [ARM_CORE]..[BArea] b on b.BArea = IsNull(y.BArea,a.BArea) 
               Group By IsNull(a.Location,''),IsNull(x.Counter,0)
        END
END
 
 

GO
-- =============================================
-- Author:             <Author,,Name>
-- alter date: <alter Date,,>
-- Description:        <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Apps-GroupBAreaCounters]
        @AppGroupID as int,
        @Scope as nVarchar(255) = 'AppAstAsIs',
        @Internal as int = 0
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
        SET NOCOUNT ON;

     DECLARE @Installs TABLE (
        Area nvarchar(255),
		installs int
    );

    IF @Scope= 'AppAstAsIs'
        BEGIN
			insert into @Installs
               select a.BArea, count(s.AssetID) AS Counter
               from [ARM_CORE]..AppAstAsIs s 
               LEFT JOIN [ARM_CORE]..Asset a on a.AssetID = s.AssetID
               LEFT JOIN [ARM_CORE]..Application p on p.ApplicationID = s.ApplicationID 
               LEFT JOIN [ARM_CORE]..AppGroup g on g.AppGroupID = p.AppGroupID  
               where g.AppGroupID = @AppGroupID
               Group By a.BArea

            Select b.BArea as Slice, IsNull(x.Installs,0) As AppInstalls, (select count(AssetID) from [ARM_CORE]..[Asset] where BArea = b.BArea) AS AssetTotal
               from [ARM_CORE]..[BArea] b LEFT JOIN @Installs x on x.Area = b.BArea
               where b.Internal = @Internal
        END
        ELSE
        BEGIN
 			insert into @Installs
			   select a.BArea, count(s.AssetID) AS Counter
               from [ARM_CORE]..AppAstToBe s 
               LEFT JOIN [ARM_CORE]..Asset a on a.AssetID = s.AssetID
               LEFT JOIN [ARM_CORE]..Application p on p.ApplicationID = s.ApplicationID 
               LEFT JOIN [ARM_CORE]..AppGroup g on g.AppGroupID = p.AppGroupID  
               where g.AppGroupID = @AppGroupID
               Group By a.BArea

            Select b.BArea as Slice, IsNull(x.Installs,0) As AppInstalls, (select count(AssetID) from [ARM_CORE]..[Asset] where BArea = b.BArea) AS AssetTotal
               from [ARM_CORE]..[BArea] b LEFT JOIN @Installs x on x.Area = b.BArea
               where b.Internal = @Internal
        END
END
 
 

GO
CREATE PROCEDURE [dbo].[Apps-DetailedList]
@AssetID nvarchar(500) = ''
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
        SET NOCOUNT ON;
    -- Insert statements for procedure here
        select distinct 
               s.[ApplicationID] as AppID, 
               IsNull(lu.[Label],'*') AS [RAG],  
               IsNull((select Top 1 t.[Reason] from [ARM_CORE]..[TransformAppStop] t LEFT JOIN [ARM_CORE]..[A_lookUp] l on l.[Lookup] = t.reason where s.ApplicationID like t.ApplicationID order by l.[Order] ),'') AS [Stop],

               '' AS Mapped_AppID,

               IsNull(lu2.[Label],'*') AS [Mapped_RAG]
        from [ARM_CORE]..[AppAstPreStop] s 
        LEFT JOIN [ARM_CORE]..[Application] a on a.[ApplicationID] = s.[ApplicationID] 
        LEFT JOIN [ARM_CORE]..[TransformAppMap] m on m.[As Is] = s.[ApplicationID] 
        LEFT JOIN [ARM_CORE]..[A_Lookup] lu ON lu.[Table] = 'Internal' 
        LEFT JOIN [ARM_CORE]..[Application] a2 on a2.[ApplicationID] = IsNull(m.[To Be],'-') 
        LEFT JOIN [ARM_CORE]..[A_Lookup] lu2 ON lu2.[Table] = 'Internal' 
        where s.[AssetID] = @AssetID and NOT s.ApplicationID IS NULL order by s.[ApplicationID]
END


GO
-- =============================================
-- Author:		John Reed
-- alter date: 27-05-2016
-- Description:	Removes a transformm that have been defined as part of user Add / Remove of additional applications
--
-- =============================================
CREATE PROCEDURE [dbo].[Apps-DeactivateTransform]
@AssetID nvarchar(255),
@AppID nvarchar(255),
@TID int = -1
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
	delete from TransformTransaction where [Table] like '%AppAstToBe' 
		and [SourceColumn] = 'AssetID' 
		and [TargetColumn] = 'ApplicationID'
		and [AsIs] = '''' + @AssetID + ''''
		and [ToBe] = '''' + @AppID + ''''
		and [TransformID] = -1

	if NOT @TID = -1
		update ApplicationTransaction set Rewind = 0 where TID = @TID

	EXEC [ARM_CORE]..[Apps-ReApplyAppTransforms] @AssetID
END




GO
CREATE PROCEDURE [dbo].[Apps-Collections-Test]
	@BArea as varchar(200) = '',
	@OS as varchar(200) = '%',
	@CCID as int = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	declare @ClassID int
 
 
 
	If Exists(Select * from tempdb..sysobjects Where id = object_id('tempdb.dbo.#AppConsole')) Drop TABLE #AppConsole
 
	CREATE table #AppConsole(
		[KEY] nvarchar(255) PRIMARY key,
		[DType] nvarchar(50),
		ready bit,
		RAG nvarchar(50),
		LocalID nvarchar(50),
		PackageID nvarchar(255),
		AIC int,
		IC int )
 
if @BArea = '' 
	BEGIN
 
		insert into #AppConsole
		select distinct  b.ApplicationID as [KEY], IsNull(a.DeployType,'-') as DType, IsNull(a.ready,0) as Ready,  IsNull(lu.[Label],'*') AS [RAG], 
a.LocalID, a.PackageID, CUT_IC.IC as AIC, TOTAL_IC.IC AS IC 
		from [ARM_CORE]..[AppAstToBe] b 
		LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = b.ApplicationID 
		LEFT JOIN [ARM_CORE]..[Asset] t on t.AssetID = b.AssetID 
		LEFT JOIN [ARM_CORE]..[BAREA] d on d.BArea = t.BArea 
		LEFT JOIN [ARM_CORE]..[A_Lookup] lu ON lu.[Table] = 'Internal' and lu.[Column] = 'RAG' 
LEFT JOIN ( select z.ApplicationID, count(distinct z.AssetID) as IC from [ARM_CORE]..[AppAstToBe] z LEFT JOIN [ARM_CORE]..[Asset] y on y.AssetID = z.AssetID LEFT JOIN [ARM_CORE]..[BArea] x on x.BArea = y.BArea where x.Internal = 0 and y.Live = 1 group by z.ApplicationID ) AS CUT_IC on CUT_IC.ApplicationID = b.ApplicationID 
LEFT JOIN ( select z.ApplicationID, count(distinct z.AssetID) as IC from [ARM_CORE]..[AppAstToBe] z LEFT JOIN [ARM_CORE]..[Asset] y on y.AssetID = z.AssetID LEFT JOIN [ARM_CORE]..[BArea] x on x.BArea = y.BArea where x.Internal = 0 and y.Live = 1 group by z.ApplicationID ) AS TOTAL_IC on TOTAL_IC.ApplicationID = b.ApplicationID 
 
		where IsNull(a.DeployType,'-') <> 'B' and IsNull(lu.[Label],'*') <> 'R' and IsNull(lu.[Label],'*') <> 'B' 
			and IsNull(lu.[Label],'*') <> 'X'
		 and IsNull(d.Internal,0) = 0 and t.Live = 1
 
	END
else
	BEGIN
		insert into #AppConsole
		select distinct  b.ApplicationID as [KEY], IsNull(a.DeployType,'-') as DType, IsNull(a.ready,0) as Ready, IsNull(lu.[Label],'*') AS [RAG], 
a.LocalID, a.PackageID, CUT_IC.IC as AIC, TOTAL_IC.IC AS IC 
		from [ARM_CORE]..[AppAstToBe] b 
		LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = b.ApplicationID 
		LEFT JOIN [ARM_CORE]..[Asset] t on t.AssetID = b.AssetID 
		LEFT JOIN [ARM_CORE]..[BAREA] d on d.BArea = t.BArea 
		LEFT JOIN [ARM_CORE]..[A_Lookup] lu ON lu.[Table] = 'Internal' and lu.[Column] = 'RAG' 
LEFT JOIN ( select z.ApplicationID, count(distinct z.AssetID) as IC from [ARM_CORE]..[AppAstToBe] z LEFT JOIN [ARM_CORE]..[Asset] y on y.AssetID = z.AssetID LEFT JOIN [ARM_CORE]..[BArea] x on x.BArea = y.BArea where y.[BArea] = @BArea and x.Internal = 0 and y.Live = 1 group by z.ApplicationID ) AS CUT_IC on CUT_IC.ApplicationID = b.ApplicationID 
LEFT JOIN ( select z.ApplicationID, count(distinct z.AssetID) as IC from [ARM_CORE]..[AppAstToBe] z LEFT JOIN [ARM_CORE]..[Asset] y on y.AssetID = z.AssetID LEFT JOIN [ARM_CORE]..[BArea] x on x.BArea = y.BArea where x.Internal = 0 and y.Live = 1 group by z.ApplicationID ) AS TOTAL_IC on TOTAL_IC.ApplicationID = b.ApplicationID 
 
		where IsNull(a.DeployType,'-') <> 'B' and IsNull(lu.[Label],'*') <> 'R' and IsNull(lu.[Label],'*') <> 'B' 
			and IsNull(lu.[Label],'*') <> 'X'
			and t.[BArea] =  @BArea and IsNull(d.Internal,0) = 0 and t.Live = 1
 
	END
 
 
	if @CCID = 0  
		select * from #AppConsole order by [KEY]
	else
		select a.*, s.[Collection], (select top 1 IsNull(cc.name,'Collection')  from A_CollectionClass cc where cc.CollectionClassID = @CCID) as ClassName  from #AppConsole a 
		LEFT JOIN (
			select b.[KEY], IsNull(c.Name,'') as [Collection] from #AppConsole b 
			LEFT JOIN A_Collection c on c.CollectionClassID = @CCID
			LEFT JOIN A_CollectionItem i on i.CollectionID = c.CollectionID and i.ItemID = b.[KEY]
			where NOT i.itemID IS NULL
		) S on S.[KEY] = a.[KEY]
		order by a.AIC Desc, a.[KEY]
 
 
 
	If Exists(Select * from tempdb..sysobjects Where id = object_id('tempdb.dbo.#AppConsole')) Drop TABLE #AppConsole
END


GO
CREATE PROCEDURE [dbo].[Apps-Collections-NotReady]
       @BArea as varchar(200) = '',
       @OS as varchar(200) = '%'
AS
BEGIN
       -- SET NOCOUNT ON added to prevent extra result sets from
       -- interfering with SELECT statements.
       SET NOCOUNT ON;
       declare @ClassID int

if @BArea = '' 
       BEGIN
select distinct  b.ApplicationID as [KEY], IsNull(a.DeployType,'-') as DType, a.ready, IsNull(lu.[Label],'*') AS [RAG],
a.LocalID, a.PackageID, CUT_IC.IC as AIC, RC.Release
             from [ARM_CORE]..[AppAstToBe] b 
             LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = b.ApplicationID 
             LEFT JOIN [ARM_CORE]..[Asset] t on t.AssetID = b.AssetID 
             LEFT JOIN [ARM_CORE]..[BAREA] d on d.BArea = t.BArea 
             LEFT JOIN [ARM_CORE]..[A_Lookup] lu ON lu.[Table] = 'Internal' and lu.[Column] = 'RAG' 
LEFT JOIN ( select z.ApplicationID, count(distinct z.AssetID) as IC from [ARM_CORE]..[AppAstToBe] z LEFT JOIN [ARM_CORE]..[Asset] y on y.AssetID = z.AssetID LEFT JOIN [ARM_CORE]..[BArea] x on x.BArea = y.BArea where IsNull(x.Internal,1) = 0 and y.Live = 1 group by z.ApplicationID ) AS CUT_IC on CUT_IC.ApplicationID = b.ApplicationID 
LEFT JOIN (
       select distinct h.ApplicationID, Count(READY.AssetID) as Release
       from [ARM_CORE]..[AppAstToBe] h
       LEFT JOIN (
             select z.AssetID, count(distinct z.ApplicationID) as Apps, 
                    Sum( CASE a.Ready WHEN 1 THEN 1 ELSE 0 END ) as ReadyApps
             from [ARM_CORE]..[AppAstToBe] z 
             LEFT JOIN [ARM_CORE]..[Asset] y on y.AssetID = z.AssetID 
             LEFT JOIN [ARM_CORE]..[BArea] x on x.BArea = y.BArea 
             LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = z.ApplicationID
             LEFT JOIN [ARM_CORE]..[A_Lookup] lu ON lu.[Table] = 'Internal' and lu.[Column] = 'RAG' 
             where x.Internal = 0 and y.Live = 1 and IsNull(a.DeployType,'-') <> 'B' 
                     and IsNull(lu.[Label],'*') <> 'R' and IsNull(lu.[Label],'*') <> 'B' and IsNull(lu.[Label],'*') <> 'X' and IsNull(a.DeployType,'-') <> 'X'
             group by z.AssetID
       ) as READY on READY.AssetID = h.AssetID and (READY.Apps - READY.ReadyApps = 1)
       group by h.ApplicationID
) as RC on RC.ApplicationID = b.ApplicationID
             where IsNull(a.DeployType,'-') <> 'B' and IsNull(lu.[Label],'*') <> 'R' and IsNull(lu.[Label],'*') <> 'B' and IsNull(a.DeployType,'-') <> 'X'
                    and IsNull(lu.[Label],'*') <> 'X' 
                    and d.Internal = 0 and t.Live = 1 and IsNull(a.ready,0) = 0
Order by RC.Release DESC , b.ApplicationID 
       END
else
       BEGIN

select distinct  b.ApplicationID as [KEY], IsNull(a.DeployType,'-') as DType, a.ready, IsNull(lu.[Label],'*') AS [RAG],
a.LocalID, a.PackageID, CUT_IC.IC as AIC, RC.Release
             from [ARM_CORE]..[AppAstToBe] b 
             LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = b.ApplicationID 
             LEFT JOIN [ARM_CORE]..[Asset] t on t.AssetID = b.AssetID 
             LEFT JOIN [ARM_CORE]..[BAREA] d on d.BArea = t.BArea 
             LEFT JOIN [ARM_CORE]..[A_Lookup] lu ON lu.[Table] = 'Internal' and lu.[Column] = 'RAG' 
LEFT JOIN ( select z.ApplicationID, count(distinct z.AssetID) as IC from [ARM_CORE]..[AppAstToBe] z LEFT JOIN [ARM_CORE]..[Asset] y on y.AssetID = z.AssetID LEFT JOIN [ARM_CORE]..[BArea] x on x.BArea = y.BArea where y.[BArea] = @BArea and IsNull(x.Internal,1) = 0 and y.Live = 1 group by z.ApplicationID ) AS CUT_IC on CUT_IC.ApplicationID = b.ApplicationID 
LEFT JOIN (
       select distinct h.ApplicationID, Count(READY.AssetID) as Release
       from [ARM_CORE]..[AppAstToBe] h
       LEFT JOIN (
             select z.AssetID, count(distinct z.ApplicationID) as Apps, 
                   Sum( CASE a.Ready WHEN 1 THEN 1 ELSE 0 END ) as ReadyApps
             from [ARM_CORE]..[AppAstToBe] z 
             LEFT JOIN [ARM_CORE]..[Asset] y on y.AssetID = z.AssetID 
             LEFT JOIN [ARM_CORE]..[BArea] x on x.BArea = y.BArea 
             LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = z.ApplicationID
             LEFT JOIN [ARM_CORE]..[A_Lookup] lu ON lu.[Table] = 'Internal' and lu.[Column] = 'RAG' 
             where x.Internal = 0 and y.Live = 1 and IsNull(a.DeployType,'-') <> 'B' 
                    and y.[BArea] = @BArea and IsNull(lu.[Label],'*') <> 'R' and IsNull(lu.[Label],'*') <> 'B' and IsNull(lu.[Label],'*') <> 'X' and IsNull(a.DeployType,'-') <> 'X'
             group by z.AssetID
       ) as READY on READY.AssetID = h.AssetID and (READY.Apps - READY.ReadyApps = 1)
       group by h.ApplicationID
) as RC on RC.ApplicationID = b.ApplicationID
             where IsNull(a.DeployType,'-') <> 'B' and IsNull(lu.[Label],'*') <> 'R' and IsNull(lu.[Label],'*') <> 'B' and IsNull(a.DeployType,'-') <> 'X'
                    and IsNull(lu.[Label],'*') <> 'X' 
                    and t.[BArea] = @BArea and d.Internal = 0 and t.Live = 1 and IsNull(a.ready,0) = 0
Order by RC.Release DESC , b.ApplicationID 



       END


END



GO
CREATE PROCEDURE [dbo].[Apps-Collections-By-ID]
	@CollectionID as int = 0,
	@Live as bit = 1
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	declare @ClassID int

if @CollectionID <> 0
	BEGIN
		select distinct  IsNull(b.ApplicationID,'') as [KEY], IsNull(a.DeployType,'-') as DType, a.ready, IsNull(lu.[Label],'*') AS [RAG], 
a.LocalID, a.PackageID, CUT_IC.IC as AIC, TOTAL_IC.IC AS IC 
		from [ARM_CORE]..[A_CollectionItem] i 
		LEFT JOIN [ARM_CORE]..[AppAstToBe] b on b.AssetID = i.ItemID
		LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = b.ApplicationID 
		LEFT JOIN [ARM_CORE]..[A_Lookup] lu ON lu.[Table] = 'Internal' and lu.[Column] = 'RAG' 
LEFT JOIN ( select z.ApplicationID, count(distinct z.AssetID) as IC from [ARM_CORE]..[A_CollectionItem] v LEFT JOIN [ARM_CORE]..[AppAstToBe] z on z.AssetID = v.ItemID where v.CollectionID = @CollectionID group by z.ApplicationID ) AS CUT_IC on CUT_IC.ApplicationID = b.ApplicationID 
LEFT JOIN ( select z.ApplicationID, count(distinct z.AssetID) as IC from [ARM_CORE]..[AppAstToBe] z  group by z.ApplicationID ) AS TOTAL_IC on TOTAL_IC.ApplicationID = b.ApplicationID 

		where i.CollectionID = @CollectionID 
			and IsNull(a.DeployType,'-') <> 'B' and IsNull(lu.[Label],'*') <> 'R' and IsNull(lu.[Label],'*') <> 'B' 
			and IsNull(lu.[Label],'*') <> 'X'
		order by AIC Desc, [KEY]
	END



END


GO
CREATE PROCEDURE [dbo].[Apps-Collections-ByDeployDate]
	@distinct as int = 999
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	declare @ClassID int
 
	select *, Count(ApplicationID) OVER ( PARTITION BY IsNull(LIST.DeploymentStartDate,'2020-04-01') ) AS cc 
	from (
		select *, row_number() OVER ( PARTITION BY APPS.ApplicationID ORDER BY APPS.ApplicationID, IsNull(APPS.DeploymentStartDate,'2020-04-01') ) AS dc
		from (
			select distinct  a.LocalID as [ABS], b.ApplicationID as [ApplicationID], IsNull(a.DeployType,'-') as DType, IsNull(a.ready,0) as Ready,  
				a.PackageID, CUT_IC.IC as AIC, TOTAL_IC.IC AS IC, IsNull(d.DeploymentStartDate,'2020-04-01') as DeploymentStartDate
			from [ARM_CORE]..[AppAstToBe] b 
			LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = b.ApplicationID 
			LEFT JOIN [ARM_CORE]..[Asset] t on t.AssetID = b.AssetID 
			LEFT JOIN [ARM_CORE]..[BAREA] d on d.BArea = t.BArea 
			LEFT JOIN [ARM_CORE]..[A_Lookup] lu ON lu.[Table] = 'Internal' and lu.[Column] = 'RAG' 
			LEFT JOIN ( select z.ApplicationID, count(distinct z.AssetID) as IC, IsNull(x.DeploymentStartDate,'2020-04-01') as DeploymentStartDate from [ARM_CORE]..[AppAstToBe] z LEFT JOIN [ARM_CORE]..[Asset] y on y.AssetID = z.AssetID LEFT JOIN [ARM_CORE]..[BArea] x on x.BArea = y.BArea where x.Internal = 0 and y.Live = 1 group by IsNull(x.DeploymentStartDate,'2020-04-01'), z.ApplicationID ) AS CUT_IC on CUT_IC.ApplicationID = b.ApplicationID and CUT_IC.[DeploymentStartDate] = IsNull(d.DeploymentStartDate,'2020-04-01')
			LEFT JOIN ( select z.ApplicationID, count(distinct z.AssetID) as IC from [ARM_CORE]..[AppAstToBe] z LEFT JOIN [ARM_CORE]..[Asset] y on y.AssetID = z.AssetID LEFT JOIN [ARM_CORE]..[BArea] x on x.BArea = y.BArea where x.Internal = 0 and y.Live = 1 group by z.ApplicationID ) AS TOTAL_IC on TOTAL_IC.ApplicationID = b.ApplicationID 
 
			where IsNull(a.DeployType,'-') <> 'B' and IsNull(lu.[Label],'*') <> 'R' and IsNull(lu.[Label],'*') <> 'B'  and IsNull(lu.[Label],'*') <> 'X' 
				and IsNull(a.DeployType,'-') <> 'X' and IsNull(lu.[Lookup],'*') <> 'X' 
				and IsNull(d.Internal,0) = 0 and t.Live = 1 and IsNull(a.LocalID,'-') <> '-'


		) as APPS
	) as LIST
	where LIST.dc <= @distinct
	Order by IsNull(LIST.DeploymentStartDate,'2020-04-01'),LIST.AIC desc,LIST.IC desc, LIST.ApplicationID
 END
 
 

 



GO
 
 
-- =============================================
-- Author:		<Author,,Name>
-- ALTER date: <ALTER Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Apps-Collections3]
	@BAreaList as varchar(MAX) = '',
	@OS as varchar(200) = '%',
	@CCID as int = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	declare @ClassID int
    declare @mySQL as varchar(MAX)
 
 
	If Exists(Select * from tempdb..sysobjects Where id = object_id('tempdb.dbo.#AppConsole')) Drop TABLE #AppConsole
 
	CREATE table #AppConsole(
		LocalID nvarchar(50),
		[KEY] nvarchar(255) PRIMARY key,
		[Status] nvarchar(50),
		[DType] nvarchar(50),
		ready bit,
		RAG nvarchar(50),
		PackageID nvarchar(255),
		AIC int,
		IC int )
 
if @BAreaList = '' 
	BEGIN
 
		insert into #AppConsole
		select distinct  a.LocalID, b.ApplicationID as [KEY], a.[Status], IsNull(a.DeployType,'-') as DType, IsNull(a.ready,0) as Ready,  IsNull(lu.[Label],'*') AS [RAG],
			a.PackageID, CUT_IC.IC as AIC, TOTAL_IC.IC AS IC 
		from [ARM_CORE]..[AppAstToBe] b 
		LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = b.ApplicationID 
		LEFT JOIN [ARM_CORE]..[Asset] t on t.AssetID = b.AssetID 
		LEFT JOIN [ARM_CORE]..[BAREA] d on d.BArea = t.BArea 
		LEFT JOIN [ARM_CORE]..[A_Lookup] lu ON lu.[Lookup] = IsNull(a.[Status],'') and lu.[Table] = 'Internal' and lu.[Column] = 'RAG' 
LEFT JOIN ( select z.ApplicationID, count(distinct z.AssetID) as IC from [ARM_CORE]..[AppAstToBe] z LEFT JOIN [ARM_CORE]..[Asset] y on y.AssetID = z.AssetID LEFT JOIN [ARM_CORE]..[BArea] x on x.BArea = y.BArea where x.Internal = 0 and y.Live = 1 group by z.ApplicationID ) AS CUT_IC on CUT_IC.ApplicationID = b.ApplicationID 
LEFT JOIN ( select z.ApplicationID, count(distinct z.AssetID) as IC from [ARM_CORE]..[AppAstToBe] z LEFT JOIN [ARM_CORE]..[Asset] y on y.AssetID = z.AssetID LEFT JOIN [ARM_CORE]..[BArea] x on x.BArea = y.BArea where x.Internal = 0 and y.Live = 1 group by z.ApplicationID ) AS TOTAL_IC on TOTAL_IC.ApplicationID = b.ApplicationID 
 
		where IsNull(a.DeployType,'-') <> 'B' and IsNull(lu.[Label],'*') <> 'R' and IsNull(lu.[Label],'*') <> 'B' 
			and IsNull(a.DeployType,'-') <> 'X' and IsNull(lu.[Lookup],'*') <> 'X' and IsNull(a.[Status],'') <> 'Base build' and NOT IsNull(a.[Status],'') like 'REMOVE%' and NOT IsNull(a.[Status],'') = 'Decommed'
		 and IsNull(d.Internal,0) = 0 and t.Live = 1
 
	END
else
	BEGIN
		set @mySQL = 'insert into #AppConsole
			select distinct  a.LocalID, b.ApplicationID,  a.[Status], IsNull(a.DeployType,''-'') as DType, IsNull(a.ready,0) as Ready, IsNull(lu.[Label],''*'') AS [RAG],
				a.PackageID, CUT_IC.IC as AIC, TOTAL_IC.IC AS IC 
			from [ARM_CORE]..[AppAstToBe] b 
			LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = b.ApplicationID 
			LEFT JOIN [ARM_CORE]..[Asset] t on t.AssetID = b.AssetID 
			LEFT JOIN [ARM_CORE]..[BAREA] d on d.BArea = t.BArea 
			LEFT JOIN [ARM_CORE]..[A_Lookup] lu ON lu.[Lookup] = IsNull(a.[Status],'''') and lu.[Table] = ''Internal'' and lu.[Column] = ''RAG'' 
	LEFT JOIN ( select z.ApplicationID, count(distinct z.AssetID) as IC from [ARM_CORE]..[AppAstToBe] z LEFT JOIN [ARM_CORE]..[Asset] y on y.AssetID = z.AssetID LEFT JOIN [ARM_CORE]..[BArea] x on x.BArea = y.BArea where y.[BArea] in ( ' + @BAreaList + ') and x.Internal = 0 and y.Live = 1 group by z.ApplicationID ) AS CUT_IC on CUT_IC.ApplicationID = b.ApplicationID 
	LEFT JOIN ( select z.ApplicationID, count(distinct z.AssetID) as IC from [ARM_CORE]..[AppAstToBe] z LEFT JOIN [ARM_CORE]..[Asset] y on y.AssetID = z.AssetID LEFT JOIN [ARM_CORE]..[BArea] x on x.BArea = y.BArea where x.Internal = 0 and y.Live = 1 group by z.ApplicationID ) AS TOTAL_IC on TOTAL_IC.ApplicationID = b.ApplicationID 
 
			where IsNull(a.DeployType,''-'') <> ''B'' and IsNull(lu.[Label],''*'') <> ''R'' and IsNull(lu.[Label],''*'') <> ''B'' 
				and IsNull(a.DeployType,''-'') <> ''X'' and IsNull(lu.[Lookup],''*'') <> ''X'' and IsNull(a.[Status],'''') <> ''Base build''
				and t.[BArea] in  (' + @BAreaList + ') and IsNull(d.Internal,0) = 0 and t.Live = 1 and NOT IsNull(a.[Status],'''') like ''REMOVE%'' and NOT IsNull(a.[Status],'''') = ''Decommed'' '

		EXECUTE(@mySQL)
 
	END
 
 
	if @CCID = 0  
		select * from #AppConsole order by AIC Desc, [KEY]
	else
		select a.*, s.[Collection] as [Packaging Status] from #AppConsole a 
		LEFT JOIN (
			select b.[KEY], IsNull(c.Name,'') as [Collection] from #AppConsole b 
			LEFT JOIN A_Collection c on c.CollectionClassID = @CCID
			LEFT JOIN A_CollectionItem i on i.CollectionID = c.CollectionID and i.ItemID = b.[KEY]
			where NOT i.itemID IS NULL
		) S on S.[KEY] = a.[KEY]
		order by a.AIC Desc, a.[KEY]
 
 
 
	If Exists(Select * from tempdb..sysobjects Where id = object_id('tempdb.dbo.#AppConsole')) Drop TABLE #AppConsole
END
 
 
 
 
/****** Object:  StoredProcedure [dbo].[Apps-Collections]    Script Date: 08/10/2018 14:56:19 ******/
SET ANSI_NULLS ON
 

GO
CREATE PROCEDURE [dbo].[Apps-Collections2]
	@BArea as varchar(200) = '',
	@OS as varchar(200) = '%',
	@CCID as int = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	declare @ClassID int
 
 
 
	If Exists(Select * from tempdb..sysobjects Where id = object_id('tempdb.dbo.#AppConsole')) Drop TABLE #AppConsole
 
	CREATE table #AppConsole(
		[KEY] nvarchar(255) PRIMARY key,
		[DType] nvarchar(50),
		ready bit,
		RAG nvarchar(50),
		LocalID nvarchar(50),
		PackageID nvarchar(255),
		AIC int,
		IC int )
 
if @BArea = '' 
	BEGIN
 
		insert into #AppConsole
		select distinct  b.ApplicationID as [KEY], IsNull(a.DeployType,'-') as DType, a.ready, IsNull(lu.[Label],'*') AS [RAG], 
a.LocalID, a.PackageID, CUT_IC.IC as AIC, TOTAL_IC.IC AS IC 
		from [ARM_CORE]..[AppAstToBe] b 
		LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = b.ApplicationID 
		LEFT JOIN [ARM_CORE]..[Asset] t on t.AssetID = b.AssetID 
		LEFT JOIN [ARM_CORE]..[BAREA] d on d.BArea = t.BArea 
		LEFT JOIN [ARM_CORE]..[A_Lookup] lu ON lu.[Table] = 'Internal' and lu.[Column] = 'RAG' 
LEFT JOIN ( select z.ApplicationID, count(distinct z.AssetID) as IC from [ARM_CORE]..[AppAstToBe] z LEFT JOIN [ARM_CORE]..[Asset] y on y.AssetID = z.AssetID LEFT JOIN [ARM_CORE]..[BArea] x on x.BArea = y.BArea where x.Internal = 0 and y.Live = 1 group by z.ApplicationID ) AS CUT_IC on CUT_IC.ApplicationID = b.ApplicationID 
LEFT JOIN ( select z.ApplicationID, count(distinct z.AssetID) as IC from [ARM_CORE]..[AppAstToBe] z LEFT JOIN [ARM_CORE]..[Asset] y on y.AssetID = z.AssetID LEFT JOIN [ARM_CORE]..[BArea] x on x.BArea = y.BArea where x.Internal = 0 and y.Live = 1 group by z.ApplicationID ) AS TOTAL_IC on TOTAL_IC.ApplicationID = b.ApplicationID 
 
		where IsNull(a.DeployType,'-') <> 'B' and IsNull(lu.[Label],'*') <> 'R' and IsNull(lu.[Label],'*') <> 'B' 
			and IsNull(lu.[Label],'*') <> 'X'
		 and IsNull(d.Internal,0) = 0 and t.Live = 1
 
	END
else
	BEGIN
		insert into #AppConsole
		select distinct  b.ApplicationID as [KEY], IsNull(a.DeployType,'-') as DType, a.ready, IsNull(lu.[Label],'*') AS [RAG], 
a.LocalID, a.PackageID, CUT_IC.IC as AIC, TOTAL_IC.IC AS IC 
		from [ARM_CORE]..[AppAstToBe] b 
		LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = b.ApplicationID 
		LEFT JOIN [ARM_CORE]..[Asset] t on t.AssetID = b.AssetID 
		LEFT JOIN [ARM_CORE]..[BAREA] d on d.BArea = t.BArea 
		LEFT JOIN [ARM_CORE]..[A_Lookup] lu ON lu.[Table] = 'Internal' and lu.[Column] = 'RAG' 
LEFT JOIN ( select z.ApplicationID, count(distinct z.AssetID) as IC from [ARM_CORE]..[AppAstToBe] z LEFT JOIN [ARM_CORE]..[Asset] y on y.AssetID = z.AssetID LEFT JOIN [ARM_CORE]..[BArea] x on x.BArea = y.BArea where y.[BArea] = @BArea and x.Internal = 0 and y.Live = 1 group by z.ApplicationID ) AS CUT_IC on CUT_IC.ApplicationID = b.ApplicationID 
LEFT JOIN ( select z.ApplicationID, count(distinct z.AssetID) as IC from [ARM_CORE]..[AppAstToBe] z LEFT JOIN [ARM_CORE]..[Asset] y on y.AssetID = z.AssetID LEFT JOIN [ARM_CORE]..[BArea] x on x.BArea = y.BArea where x.Internal = 0 and y.Live = 1 group by z.ApplicationID ) AS TOTAL_IC on TOTAL_IC.ApplicationID = b.ApplicationID 
 
		where IsNull(a.DeployType,'-') <> 'B' and IsNull(lu.[Label],'*') <> 'R' and IsNull(lu.[Label],'*') <> 'B' 
			and IsNull(lu.[Label],'*') <> 'X' 
			and t.[BArea] =  @BArea and IsNull(d.Internal,0) = 0 and t.Live = 1
 
	END
 
 
	if @CCID = 0  
		select * from #AppConsole order by AIC Desc, [KEY]
	else
		select a.*, s.[Collection], s.ClassName from #AppConsole a 
		LEFT JOIN (
			select b.[KEY], IsNull(c.Name,'') as [Collection], IsNull(cc.name,'Collection') as ClassName from #AppConsole b 
			LEFT JOIN A_CollectionClass cc on cc.CollectionClassID = @CCID
			LEFT JOIN A_Collection c on c.CollectionClassID = @CCID
			LEFT JOIN A_CollectionItem i on i.CollectionID = c.CollectionID and i.ItemID = b.[KEY]
			where NOT i.itemID IS NULL
		) S on S.[KEY] = a.[KEY]
		order by a.AIC Desc, a.[KEY]
 
 
 
	If Exists(Select * from tempdb..sysobjects Where id = object_id('tempdb.dbo.#AppConsole')) Drop TABLE #AppConsole
END


GO
CREATE PROCEDURE [dbo].[Apps-Collections]
	@BArea as nvarchar(500) = '',
	@OS as varchar(200) = '%',
	@CCID as int = 0,
	@Xclude as varchar(200) = ''
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	declare @ClassID int
 
 
 
	If Exists(Select * from tempdb..sysobjects Where id = object_id('tempdb.dbo.#AppConsole')) Drop TABLE #AppConsole
 
	CREATE table #AppConsole(
		LocalID nvarchar(50),
		[KEY] nvarchar(255) PRIMARY key,
		[DType] nvarchar(50),
		ready bit,
		RAG nvarchar(50),
		PackageID nvarchar(255),
		AIC int,
		IC int )
 
if @BArea = '' 
	BEGIN
 
		insert into #AppConsole
		select distinct  IsNull(a.LocalID,'') as LocalID, IsNull(b.ApplicationID,'') as [KEY], IsNull(a.DeployType,'-') as DType, IsNull(a.ready,0) as Ready,  IsNull(lu.[Label],'*') AS [RAG],
			a.PackageID, CUT_IC.IC as AIC, TOTAL_IC.IC AS IC 
		from [ARM_CORE]..[AppAstToBe] b 
		LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = b.ApplicationID 
		LEFT JOIN [ARM_CORE]..[Asset] t on t.AssetID = b.AssetID 
		LEFT JOIN [ARM_CORE]..[A_Lookup] lu ON lu.[Table] = 'Internal' and lu.[Column] = 'RAG' 
LEFT JOIN ( select z.ApplicationID, count(distinct z.AssetID) as IC from [ARM_CORE]..[AppAstToBe] z LEFT JOIN [ARM_CORE]..[Asset] y on y.AssetID = z.AssetID LEFT JOIN [ARM_CORE]..[BArea] x on x.BArea = y.BArea where isnull(x.Internal,0) = 0 and y.Live = 1 group by z.ApplicationID ) AS CUT_IC on CUT_IC.ApplicationID = b.ApplicationID 
LEFT JOIN ( select z.ApplicationID, count(distinct z.AssetID) as IC from [ARM_CORE]..[AppAstToBe] z LEFT JOIN [ARM_CORE]..[Asset] y on y.AssetID = z.AssetID LEFT JOIN [ARM_CORE]..[BArea] x on x.BArea = y.BArea where isnull(x.Internal,0) = 0 and y.Live = 1 group by z.ApplicationID ) AS TOTAL_IC on TOTAL_IC.ApplicationID = b.ApplicationID 
 
		where IsNull(a.DeployType,'-') <> 'B' and IsNull(a.DeployType,'-') <> 'X' and IsNull(a.Ready,0) = 0 and IsNull(a.Exclude,0) = 0 
				and t.[BArea] like  @BArea  and t.Live = 1 
 
	END
else
	BEGIN
		insert into #AppConsole
		select distinct  IsNull(a.LocalID,'') as LocalID, IsNull(b.ApplicationID,'') as [KEY], IsNull(a.DeployType,'-') as DType, IsNull(a.ready,0) as Ready, IsNull(lu.[Label],'*') AS [RAG],
			a.PackageID, CUT_IC.IC as AIC, TOTAL_IC.IC AS IC 
		from [ARM_CORE]..[AppAstToBe] b 
		LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = b.ApplicationID 
		LEFT JOIN [ARM_CORE]..[Asset] t on t.AssetID = b.AssetID 
		LEFT JOIN [ARM_CORE]..[A_Lookup] lu ON lu.[Table] = 'Internal' and lu.[Column] = 'RAG' 
LEFT JOIN ( select z.ApplicationID, count(distinct z.AssetID) as IC from [ARM_CORE]..[AppAstToBe] z LEFT JOIN [ARM_CORE]..[Asset] y on y.AssetID = z.AssetID LEFT JOIN [ARM_CORE]..[BArea] x on x.BArea = y.BArea where y.[BArea] like @BArea and x.Internal = 0 and y.Live = 1 group by z.ApplicationID ) AS CUT_IC on CUT_IC.ApplicationID = b.ApplicationID 
LEFT JOIN ( select z.ApplicationID, count(distinct z.AssetID) as IC from [ARM_CORE]..[AppAstToBe] z LEFT JOIN [ARM_CORE]..[Asset] y on y.AssetID = z.AssetID LEFT JOIN [ARM_CORE]..[BArea] x on x.BArea = y.BArea where x.Internal = 0 and y.Live = 1 group by z.ApplicationID ) AS TOTAL_IC on TOTAL_IC.ApplicationID = b.ApplicationID 
 
		where IsNull(a.DeployType,'-') <> 'B' and IsNull(a.DeployType,'-') <> 'X' and IsNull(a.Ready,0) = 0 and IsNull(a.Exclude,0) = 0 
				and t.[BArea] like  @BArea  and t.Live = 1 

	END
 
 
	if @CCID = 0  
		select * from #AppConsole order by AIC Desc, [KEY]
	else
		select a.*, s.[Collection], (select top 1 IsNull(cc.name,'Collection')  from A_CollectionClass cc where cc.CollectionClassID = @CCID) as ClassName  from #AppConsole a 
		LEFT JOIN (
			select b.[KEY], IsNull(c.Name,'') as [Collection] from #AppConsole b 
			LEFT JOIN A_Collection c on c.CollectionClassID = @CCID
			LEFT JOIN A_CollectionItem i on i.CollectionID = c.CollectionID and i.ItemID = b.[KEY]
			where NOT i.itemID IS NULL
		) S on S.[KEY] = a.[KEY]
		where NOT DType IN (@Xclude)
		order by a.AIC Desc, a.[KEY]
 
 
 
	If Exists(Select * from tempdb..sysobjects Where id = object_id('tempdb.dbo.#AppConsole')) Drop TABLE #AppConsole
END
 
 
 
 
/****** Object:  StoredProcedure [dbo].[Apps-Collections]    Script Date: 08/10/2018 14:56:19 ******/
SET ANSI_NULLS ON
 



GO
-- =============================================
-- Author:		John Reed
-- alter date: 26-05-2016
-- Description:	Add an additional application to user list which does not currently appear on machine feed.
-- =============================================
CREATE PROCEDURE [dbo].[Apps-ClearAppTransactionFromAssetBatch]
@BatchCID int,
@AppID nvarchar(255),
@Table nvarchar(255) = 'AppAstToBe',
@Who nvarchar(255) = 'Admin'
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;


	Delete from [AppAstToBe] where ApplicationID = @AppID
		and AssetID in (
			select distinct ItemID from [arm_core]..[A_collectionItem] i 
			LEFT JOIN [ApplicationTransaction] t on t.AssetID = i.ItemID
			where collectionId = @BatchCID and t.ApplicationID = @AppID and NOT t.AssetID IS NULL
		)

	delete from [ApplicationTransaction] where [ApplicationID] = @AppID 
		and [AssetID] in (
			select distinct ItemID from [arm_core]..[A_collectionItem] i where collectionId = @BatchCID
		)

	delete from TransformTransaction where [Table] like '%AppAstToBe' 
		and [SourceColumn] = 'AssetID' 
		and [TargetColumn] = 'ApplicationID'
		and [ToBe] = '''' + @AppID + ''''
		and [AsIs] in (
			select distinct ItemID from [arm_core]..[A_collectionItem] i where collectionId = @BatchCID
		)





	-- insert into [ARM_CORE]..[A_CommentLog] ([Table],[type],recordID,[Author],[Comment]) values ('Asset', 'System',@AssetID, @Who, 'Removal of ' + @AppID)

END




GO
CREATE PROCEDURE [dbo].[Apps-ClassSearch]
	-- Add the parameters for the stored procedure here
	@SearchStatus as Varchar(255) = 'Unclassified',
	@SearchTerm as Varchar(255),
	@PageSize as int = 1000,
	@IC as bit = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	if @IC = 1 
		select distinct top (@PageSize)  s.[ApplicationID], IsNull(g.AppGroupName,'') AS AppGroupName, a.AppGroupID, IsNull(m.[To Be],'') AS Mapping, a.LocalID, a2.LocalID as LocalID2,
		 0 AS Stop, (select count(distinct x.AssetID) from AppAstAsIs x where x.ApplicationID = s.ApplicationID) AS InstallCount 
		 from [ARM_CORE]..[AppAstAsIs] s  
		 LEFT JOIN [ARM_CORE]..Application a on a.ApplicationID = s.[ApplicationID] 		
		 LEFT JOIN [ARM_CORE]..AppGroup g on g.AppGroupID = a.AppGroupID 
		 LEFT JOIN [ARM_CORE]..[TransformAppMap] m on m.[As Is] = s.[ApplicationID]  
		 LEFT JOIN [ARM_CORE]..Application a2 on a2.ApplicationID = m.[To Be] 
		 where s.[ApplicationID] like @SearchTerm 
		   order by [ApplicationID]
	else
		select distinct top (@PageSize)  s.[ApplicationID], IsNull(g.AppGroupName,'') AS AppGroupName, a.AppGroupID, IsNull(m.[To Be],'') AS Mapping,  a.LocalID, a2.LocalID as LocalID2,
		 0 AS Stop, '' AS InstallCount 
		 from [ARM_CORE]..[AppAstAsIs] s  
		 LEFT JOIN [ARM_CORE]..Application a on a.ApplicationID = s.[ApplicationID] 		
		 LEFT JOIN [ARM_CORE]..AppGroup g on g.AppGroupID = a.AppGroupID 
		 LEFT JOIN [ARM_CORE]..[TransformAppMap] m on m.[As Is] = s.[ApplicationID]  
		 LEFT JOIN [ARM_CORE]..Application a2 on a2.ApplicationID = m.[To Be] 
		 where s.[ApplicationID] like @SearchTerm 
		   order by [ApplicationID]
END





GO
CREATE PROCEDURE [dbo].[Apps-By-BArea]
	@BArea as varchar(200) = ''
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	declare @ClassID int

	select distinct  b.ApplicationID as [App ID], CUT_IC.IC as [Installs] , Cast(IsNull(a.[ready],0) as varchar(30)) as [Ready]
	from [ARM_CORE]..[AppAstToBe] b 
	LEFT JOIN [ARM_CORE]..[Application] a on a.ApplicationID = b.ApplicationID 
	LEFT JOIN [ARM_CORE]..[Asset] t on t.AssetID = b.AssetID 
	LEFT JOIN [ARM_CORE]..[BAREA] d on d.BArea = t.BArea 
	LEFT JOIN [ARM_CORE]..[A_Lookup] lu ON lu.[Table] = 'Internal' and lu.[Column] = 'RAG' 
	LEFT JOIN ( 
		select z.ApplicationID, count(distinct z.AssetID) as IC from [ARM_CORE]..[AppAstToBe] z 
		LEFT JOIN [ARM_CORE]..[Asset] y on y.AssetID = z.AssetID 
		LEFT JOIN [ARM_CORE]..[BArea] x on x.BArea = y.BArea 
		where y.[BArea] = @BArea and x.Internal = 0 and y.Live = 1 group by z.ApplicationID 
	) AS CUT_IC on CUT_IC.ApplicationID = b.ApplicationID 
	where IsNull(a.DeployType,'-') <> 'B' and IsNull(lu.[Label],'*') <> 'R' and IsNull(lu.[Label],'*') <> 'B' 
		and IsNull(lu.[Label],'*') <> 'X'
		and t.[BArea] =  @BArea and d.Internal = 0 and t.Live = 1
	order by [Installs] Desc, [App ID]
END


GO
-- =============================================
-- Author:             <Author,,Name>
-- ALTER date: <ALTER Date,,>
-- Description:        <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Apps-BAreaCounters-old]
        @AppID as nVarchar(255),
        @Scope as nVarchar(255) = 'AppAstAsIs',
        @Internal as int = 0,
        @Live as int = 1,
        @OS as nVarchar(255) = ''
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
        SET NOCOUNT ON;
        set @OS = '%' + @OS + '%'
    IF @Scope= 'AppAstAsIs'
        BEGIN
 
               Select b.BArea as Slice, IsNull(x.Counter,0) As AppInstalls, (select count(AssetID) from [ARM_CORE]..[Asset] x where x.BArea = b.BArea and x.Live = 1) AS AssetTotal
               from [ARM_CORE]..[BArea] b LEFT JOIN (
                       select a.BArea, count(s.AssetID) AS Counter
                       from [ARM_CORE]..AppAstAsIs s 
                       LEFT JOIN [ARM_CORE]..Asset a on a.AssetID = s.AssetID
                       where s.ApplicationID = @AppID and IsNull(a.[OS],'') like @OS and IsNull(a.Live,0) = @Live
                       Group By a.BArea              
               ) x on x.BArea = b.BArea
               where IsNull(b.Internal,0) = @Internal order by b.BArea
        END
        ELSE
        BEGIN
 
               Select b.BArea as Slice, IsNull(x.Counter,0) As AppInstalls, (select count(AssetID) from [ARM_CORE]..[Asset] x where x.BArea = b.BArea and x.Live = 1) AS AssetTotal
               from [ARM_CORE]..[BArea] b LEFT JOIN (
                       select a.BArea, count(s.AssetID) AS Counter
                       from [ARM_CORE]..AppAstToBe s 
                       LEFT JOIN [ARM_CORE]..Asset a on a.AssetID = s.AssetID
                       where s.ApplicationID = @AppID and IsNull(a.[OS],'') like @OS and IsNull(a.Live,0) = @Live
                       Group By a.BArea
               ) x on x.BArea = b.BArea
               where IsNull(b.Internal,0) = @Internal order by b.BArea
        END
END
/****** Object:  StoredProcedure [dbo].[Apps-miniUAM]    Script Date: 17/09/2018 21:39:10 ******/
SET ANSI_NULLS ON

GO
-- =============================================
-- Author:             <Author,,Name>
-- ALTER date: <ALTER Date,,>
-- Description:        <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Apps-BAreaCounters-2]
        @AppID as nVarchar(255),
        @Scope as nVarchar(255) = 'AppAstAsIs',
        @Internal as int = 0,
        @Live as int = 1,
        @OS as nVarchar(255) = ''
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
        SET NOCOUNT ON;
        set @OS = '%' + @OS + '%'
    IF @Scope= 'AppAstAsIs'
        BEGIN
 
               Select x.BArea as Slice, IsNull(x.Counter,0) As AppInstalls, (select count(AssetID) from [ARM_CORE]..[Asset] y where IsNull(y.BArea,'') = IsNull(x.BArea,'') and y.Live = 1) AS AssetTotal
               from (
                       select IsNull(a.BArea,'') as BArea, count(s.AssetID) AS Counter, ISNULL(b.Internal,1) as Internal
                       from [ARM_CORE]..AppAstAsIs s 
                       LEFT JOIN [ARM_CORE]..Asset a on a.AssetID = s.AssetID
                       LEFT JOIN [ARM_CORE]..[BArea] b on b.BArea = IsNull(a.BArea,'')
                       where s.ApplicationID = @AppID and IsNull(a.[OS],'') like @OS and IsNull(a.Live,0) = @Live
                       Group By a.BArea, ISNULL(b.Internal,1)              
               ) x 
               where x.Internal = @Internal order by x.BArea
        END
        ELSE
        BEGIN
 
                Select x.BArea as Slice, IsNull(x.Counter,0) As AppInstalls, (select count(AssetID) from [ARM_CORE]..[Asset] y where IsNull(y.BArea,'') = IsNull(x.BArea,'') and y.Live = 1) AS AssetTotal
               from (
                       select IsNull(a.BArea,'') as BArea, count(s.AssetID) AS Counter, ISNULL(b.Internal,1) as Internal
                       from [ARM_CORE]..AppAstToBe s 
                       LEFT JOIN [ARM_CORE]..Asset a on a.AssetID = s.AssetID
                       LEFT JOIN [ARM_CORE]..[BArea] b on b.BArea = IsNull(a.BArea,'')
                       where s.ApplicationID = @AppID and IsNull(a.[OS],'') like @OS and IsNull(a.Live,0) = @Live
                       Group By a.BArea, ISNULL(b.Internal,1)              
               ) x 
               where x.Internal = @Internal order by x.BArea
               
        END
END
/****** Object:  StoredProcedure [dbo].[Apps-miniUAM]    Script Date: 17/09/2018 21:39:10 ******/
SET ANSI_NULLS ON

GO
-- =============================================
-- Author:             <Author,,Name>
-- ALTER date: <ALTER Date,,>
-- Description:        <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Apps-BAreaCounters]
        @AppID as nVarchar(255),
        @Scope as nVarchar(255) = 'AppAstAsIs',
        @Internal as int = 0,
        @Live as int = 1,
        @OS as nVarchar(255) = ''
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
        SET NOCOUNT ON;
        set @OS = '%' + @OS + '%'


    IF @Scope= 'AppAstAsIs'
        BEGIN
 
               Select x.BArea as Slice, IsNull(x.Counter,0) As AppInstalls, (select count(AssetID) from [ARM_CORE]..[Asset] y where IsNull(y.BArea,'') = IsNull(x.BArea,'') and y.Live = 1) AS AssetTotal
               from (
                       select IsNull(a.BArea,'') as BArea, count(s.AssetID) AS Counter, ISNULL(b.Internal,0) as Internal
                       from [ARM_CORE]..AppAstAsIs s 
                       LEFT JOIN [ARM_CORE]..Asset a on a.AssetID = s.AssetID
                       LEFT JOIN [ARM_CORE]..[BArea] b on b.BArea = IsNull(a.BArea,'')
                       where s.ApplicationID = @AppID and IsNull(a.[OS],'') like @OS and IsNull(a.Live,0) = @Live
                       Group By IsNull(a.BArea,''), ISNULL(b.Internal,0)              
               ) x 
               --where x.Internal = @Internal 
			   order by x.BArea
        END
        ELSE
        BEGIN
 
               Select x.BArea as Slice, IsNull(x.Counter,0) As AppInstalls, (select count(AssetID) from [ARM_CORE]..[Asset] y where IsNull(y.BArea,'') = IsNull(x.BArea,'') and y.Live = 1) AS AssetTotal
               from (
                       select IsNull(a.BArea,'') as BArea, count(s.AssetID) AS Counter, ISNULL(b.Internal,0) as Internal
                       from [ARM_CORE]..AppAstToBe s 
                       LEFT JOIN [ARM_CORE]..Asset a on a.AssetID = s.AssetID
                       LEFT JOIN [ARM_CORE]..[BArea] b on b.BArea = IsNull(a.BArea,'')
                       where s.ApplicationID = @AppID and IsNull(a.[OS],'') like @OS and IsNull(a.Live,0) = @Live
                       Group By IsNull(a.BArea,''), ISNULL(b.Internal,0)              
               ) x 
			   --where x.Internal = @Internal 
               order by x.BArea
               
        END
END
/****** Object:  StoredProcedure [dbo].[Apps-miniUAM]    Script Date: 17/09/2018 21:39:10 ******/
SET ANSI_NULLS ON

GO
CREATE PROCEDURE [dbo].[Apps-AutoAppsGroupMapping-JRR]
        -- Add the parameters for the stored procedure here
AS
BEGIN
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
        SET NOCOUNT ON;
    -- Insert statements for procedure here
        select * INTO #tempHitListTable 
        FROM (
               select distinct i.ApplicationID, PATTERN.[AppGroupID], PATTERN.[CurrentApplication], Row_Number() OVER(PARTITION BY i.ApplicationID order by Len(PATTERN.AutoMappingPattern) desc, PATTERN.AutoMappingPattern) as pc
               from ARM_CORE..AppAsIs i
               left join ARM_CORE..Application A on a.ApplicationID=i.ApplicationID 
               left join ARM_CORE..AppGroup g on g.AppGroupID = a.AppGroupID
               LEFT JOIN (
                       select [AutoMappingPattern], AppgroupID, CurrentApplication from [ARM_CORE]..[AppGroup] 
                       where NOT IsNull([AutoMappingPattern] ,'') = '' and IsNull([CurrentApplication] ,'') <> ''
               ) PATTERN on i.ApplicationID like PATTERN.[AutoMappingPattern]
               where IsNull(g.AppGroupID,0) = 0 and NOT PATTERN.AppGroupID IS NULL and IsNull(PATTERN.[CurrentApplication],'') <> ''
        ) MAP where MAP.pc = 1
 
        MERGE [ARM_CORE]..[Application] as Target
        USING ( select t.*, u.[AppName], u.[AppVersion] from #tempHitListTable t LEFT JOIN [ARM_CORE].[dbo].[AppUniqPreStop] u on u.ApplicationID = t.ApplicationID) as Source
        On Target.[ApplicationID] = Source.ApplicationID
        WHEN NOT MATCHED BY TARGET THEN  
               INSERT (ApplicationID, Name, [Version], AppGroupID) VALUES (Source.ApplicationID, Source.[AppName], Source.[AppVersion], Source.AppGroupID) 
        WHEN MATCHED THEN
               UPDATE SET target.AppGroupID = Source.AppGroupID;
 
        MERGE [ARM_CORE]..[TransformAppMap] as Target
        USING ( select t.* from #tempHitListTable t ) as Source
        On Target.[As Is] = Source.[ApplicationID]
        WHEN NOT MATCHED BY TARGET THEN  
               INSERT ([As Is], [To Be]) VALUES (Source.ApplicationID, source.[CurrentApplication]) 
        WHEN MATCHED THEN
               UPDATE SET target.[To Be] = Source.[CurrentApplication];
        
        DROP TABLE #tempHitListTable
 
END

GO
CREATE PROCEDURE [dbo].[Apps-AllAssets-MostRecent-all]
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
	select distinct AP.LocalID, AP.ApplicationID, IsNull(ASIS.ASIS,0) as ASIS, IsNull(TOBE.TOBE,0) as TOBE, 
	CASE 
        WHEN IsNull(TOBE.TOBE,0) > IsNull(ASIS.ASIS,0)  
            THEN 'Mapped'
        WHEN IsNull(TOBE.TOBE,0) = 0 and IsNull(ASIS.ASIS,0) = 0
            THEN 'Removed'
        WHEN IsNull(TOBE.TOBE,0) = 0 and IsNull(ASIS.ASIS,0) > 0
            THEN 'Retired'
		WHEN IsNull(TOBE.TOBE,0) = IsNull(ASIS.ASIS,0)
            THEN 'Current'
		ELSE ''
    END as Status,
	CASE 
		WHEN IsNull(DAL.[ABS],'') <> ''
			THEN 1
			ELSE 0
	END as OnDAL

	from [ARM_CORE]..[Application] ap
	LEFT JOIN ( 
		select app.ApplicationID, COUNT(Listing.AssetID) as ASIS
		from [ARM_CORE]..[AppAstAsIs] app
		LEFT JOIN (
			select a.[SerialNumber] as [SN], a.BArea, a.AssetID, a.[SerialNumber], b.Internal, a.Live, a.heartbeat,
			row_number() OVER ( PARTITION BY a.[SerialNumber] ORDER BY a.[SerialNumber], a.heartbeat DESC) AS dc, CASE WHEN a.heartbeat > GETDATE()-21 THEN 1 ELSE 0 END  as [Recent] 
			from [ARM_CORE]..[Asset] a 
			LEFT JOIN [ARM_CORE]..[User] u on u.UserID = a.UserID
			LEFT JOIN [ARM_CORE]..[BArea] b on b.BArea = a.BArea
			where  NOT a.[SerialNumber] IS NULL and NOT a.[SerialNumber] = '' and IsnUll(b.Internal,0) = 0
		) as LISTING on LISTING.AssetID = APP.AssetID and  IsNull(LISTING.Live,0) = 1
		where LISTING.dc = 1
		Group by app.ApplicationID 
	) as ASIS on ASIS.ApplicationID = AP.ApplicationID
	LEFT JOIN ( 
		select app.ApplicationID, COUNT(Listing2.AssetID) as TOBE
		from [ARM_CORE]..[AppAstToBe] app
		LEFT JOIN (
			select a.[SerialNumber] as [SN], a.BArea, a.AssetID, a.[SerialNumber], b.Internal, a.Live, a.heartbeat,
			row_number() OVER ( PARTITION BY a.[SerialNumber] ORDER BY a.[SerialNumber], a.heartbeat DESC) AS dc, CASE WHEN a.heartbeat > GETDATE()-21 THEN 1 ELSE 0 END  as [Recent] 
			from [ARM_CORE]..[Asset] a 
			LEFT JOIN [ARM_CORE]..[User] u on u.UserID = a.UserID
			LEFT JOIN [ARM_CORE]..[BArea] b on b.BArea = a.BArea
			where  NOT a.[SerialNumber] IS NULL and NOT a.[SerialNumber] = '' and IsnUll(b.Internal,0) = 0
		) as LISTING2 on LISTING2.AssetID = APP.AssetID  and  IsNull(LISTING2.Live,0) = 1
		where LISTING2.dc = 1
		Group by app.ApplicationID 
	) as TOBE on TOBE.ApplicationID = AP.ApplicationID
	LEFT JOIN [TMP_RAW_AstellasDAL] DAL on DAL.[ABS] = ISNULL(AP.LocalID,'')
	where ISNULL(AP.LocalID,'') <> ''
	Order by IsNull(TOBE.TOBE,0) Desc, ap.LocalID

END
GO

-- =============================================
-- Author:		John Reed
-- alter date: 26-05-2016
-- Description:	Add an additional application to user list which does not currently appear on machine feed.
-- =============================================
CREATE PROCEDURE [dbo].[Apps-AddToStopList]
@AppID nvarchar(255),
@Reason nvarchar(255) = 'Noise',
@Who nvarchar(255) = 'Admin',
@NotLike nvarchar(2000) = ''
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	--  Add Application to the Stop List table & remove from current ApAstAsIs and AppAstToBe for immediate affect.

	MERGE [ARM_CORE]..[TransformAppStop] as Target using (select @AppID AS ApplicationID) as Source
	ON (target.ApplicationID  = source.ApplicationID)
	WHEN NOT MATCHED BY TARGET THEN 
		insert (ApplicationID, Author, Reason, [timestamp], [NotLike]) Values (Source.ApplicationID, @Who, @Reason, getdate(), @NotLike); 

	Delete from [ARM_CORE]..[AppAstAsIs] where [ApplicationID] like @AppID and NOT [ApplicationID] like @NotLike 
	Delete from [ARM_CORE]..[AppAstToBe] where [ApplicationID] like @AppID and NOT [ApplicationID] like @NotLike
	Delete from [ARM_CORE]..[AppAsIs] where [ApplicationID] like @AppID and NOT [ApplicationID] like @NotLike
END



GO
-- =============================================
-- Author:		John Reed
-- alter date: 04-02-2022
-- Description:	Add an additional application to user list which does not currently appear on machine feed.
-- =============================================
CREATE PROCEDURE [dbo].[Apps-AddApplicationToAssetBatch]
@BatchCID int,
@AppID nvarchar(255),
@Table nvarchar(255) = 'AppAstToBe',
@Who nvarchar(255) = 'Admin'
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	-- Logically there can only be one active transaction for an AssetID / AppID pair.
	-- Turn off ability to UNDO transaction for other records with same AssetID / AppID pair before adding a new record.
	-- This keeps previous transactions as an information log 

--	update [ApplicationTransaction] set [Rewind] = 0 where [ApplicationID] = @AppID and [AssetID] = @AssetID;

	--  Add another transaction to log

--	insert into [ApplicationTransaction] ([Who],[Action],[ApplicationID],[AssetID],[Approved],[Rewind])
--	values (@Who,'Add',@AppID,@AssetID,0,1)

	--  Remove any previous Transform transactions to avoid future conflicts before adding new.



	

	MERGE [ApplicationTransaction] as Target using (
			select distinct @AppID AS [ApplicationID], ItemID AS [AssetID] from [arm_core]..[A_collectionItem] i where collectionId = @BatchCID
		) as Source
		ON ( Target.[AssetID] = Source.[AssetID] and Target.[ApplicationID] = Source.[ApplicationID] )
		WHEN NOT MATCHED BY TARGET THEN 
			insert ([Who],[Action],[ApplicationID],[AssetID],[Approved],[Rewind])
			values (@Who, 'Add', source.ApplicationID, Source.AssetID, 0, 1);


--	delete from TransformTransaction where [Table] like '%' + @Table
--		and [SourceColumn] = 'AssetID' 
--		and [TargetColumn] = 'ApplicationID'
--		and [AsIs] = '''' + @AssetID + ''''
--		and [ToBe] = '''' + @AppID + ''''
--		and [TransformID] = -1
--
--	insert into TransformTransaction ([Table], [Action], SourceColumn, TargetColumn, AsIs, ToBe, TransformID)
--	values (@Table,'Insert','AssetID','ApplicationID','''' + @AssetID + '''','''' + @AppID + '''', -1)


	MERGE [TransformTransaction] as Target using (select distinct ItemID AS [AssetID] from [arm_core]..[A_collectionItem] i where collectionId = @BatchCID) as Source
		ON (target.[Table]  = @Table and target.AsIs  = source.AssetID and target.ToBe = @AppID and target.[SourceColumn] = 'AssetID' and target.[TargetColumn] = 'ApplicationID' and target.[TransformID] = -1)
		WHEN NOT MATCHED BY TARGET THEN 
			insert ([Table], [Action], SourceColumn, TargetColumn, AsIs, ToBe, TransformID) 
			values (@Table,'Insert','AssetID','ApplicationID','''' + Source.[AssetID] + '''','''' + @AppID + '''', -1); 


	--  Add Application to the ToBe table.

	if @Table  = 'AppAstToBe'
	BEGIN
		MERGE [AppAstToBe] as Target using (select distinct ItemID AS AssetID from [arm_core]..[A_collectionItem] i where collectionId = @BatchCID) as Source
		ON (target.AssetID  = source.AssetID and target.ApplicationID = @AppID)
		WHEN NOT MATCHED BY TARGET THEN 
			insert (AssetID,ApplicationID) Values (Source.AssetID, @AppID); 
	END
		else
	BEGIN
		MERGE [AppAstAsIs] as Target using (select distinct ItemID AS AssetID from [arm_core]..[A_collectionItem] i where collectionId = @BatchCID) as Source
		ON (target.AssetID  = source.AssetID and target.ApplicationID = @AppID)
		WHEN NOT MATCHED BY TARGET THEN 
			insert (AssetID,ApplicationID) Values (Source.AssetID, @AppID);
	END

	--EXEC [ARM_CORE]..[Apps-ReApplyAppTransforms]

END




GO
-- =============================================
-- Author:		John Reed
-- alter date: 26-05-2016
-- Description:	Add an additional application to user list which does not currently appear on machine feed.
-- =============================================
CREATE PROCEDURE [dbo].[Apps-AddApplicationToAsset]
@AssetID nvarchar(255),
@AppID nvarchar(255),
@Table nvarchar(255) = 'AppAstToBe',
@Who nvarchar(255) = 'Admin'
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	-- Logically there can only be one active transaction for an AssetID / AppID pair.
	-- Turn off ability to UNDO transaction for other records with same AssetID / AppID pair before adding a new record.
	-- This keeps previous transactions as an information log 

	update [ApplicationTransaction] set [Rewind] = 0 where [ApplicationID] = @AppID and [AssetID] = @AssetID;

	--  Add another transaction to log

	insert into [ApplicationTransaction] ([Who],[Action],[ApplicationID],[AssetID],[Approved],[Rewind])
	values (@Who,'Add',@AppID,@AssetID,0,1)

	--  Remove any previous Transform transactions to avoid future conflicts before adding new.

--	delete from TransformTransaction where [Table] like '%' + @Table
--		and [SourceColumn] = 'AssetID' 
--		and [TargetColumn] = 'ApplicationID'
--		and [AsIs] = '''' + @AssetID + ''''
--		and [ToBe] = '''' + @AppID + ''''
--		and [TransformID] = -1
--
--	insert into TransformTransaction ([Table], [Action], SourceColumn, TargetColumn, AsIs, ToBe, TransformID)
--	values (@Table,'Insert','AssetID','ApplicationID','''' + @AssetID + '''','''' + @AppID + '''', -1)


	MERGE [TransformTransaction] as Target using (select @Table as [Table], @AssetID AS [AssetID], @AppID AS [ApplicationID]) as Source
		ON (target.[Table]  = source.[Table] and target.AsIs  = source.AssetID and target.ToBe = source.ApplicationID and target.[SourceColumn] = 'AssetID' and target.[TargetColumn] = 'ApplicationID' and target.[TransformID] = -1)
		WHEN NOT MATCHED BY TARGET THEN 
			insert ([Table], [Action], SourceColumn, TargetColumn, AsIs, ToBe, TransformID) 
			values (@Table,'Insert','AssetID','ApplicationID','''' + @AssetID + '''','''' + @AppID + '''', -1); 


	--  Add Application to the ToBe table.

	if @Table  = 'AppAstToBe'
	BEGIN
		MERGE [AppAstToBe] as Target using (select @AssetID AS AssetID, @AppID AS ApplicationID) as Source
		ON (target.AssetID  = source.AssetID and target.ApplicationID = source.ApplicationID)
		WHEN NOT MATCHED BY TARGET THEN 
			insert (AssetID,ApplicationID) Values (Source.AssetID, Source.ApplicationID); 
	END
		else
	BEGIN
		MERGE [AppAstAsIs] as Target using (select @AssetID AS AssetID, @AppID AS ApplicationID) as Source
		ON (target.AssetID  = source.AssetID and target.ApplicationID = source.ApplicationID)
		WHEN NOT MATCHED BY TARGET THEN 
			insert (AssetID,ApplicationID) Values (Source.AssetID, Source.ApplicationID); 
	END

END




GO

-- =============================================
-- Author:		John Reed
-- alter date: 26-05-2016
-- Description:	Add an additional application to user list which does not currently appear on machine feed.
-- =============================================
CREATE PROCEDURE [dbo].[Apps-AddApplication]
@AppID nvarchar(255)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	--  Add Application to the Stop List table.

	MERGE [ARM_CORE]..[Application] as Target using (select distinct ApplicationID, ApplicationID as AppName from [ARM_CORE]..[AppAstPreStop] u where u.[ApplicationID] = @AppID) as Source
	ON (target.ApplicationID  = source.ApplicationID)
	WHEN NOT MATCHED BY TARGET THEN 
		insert (ApplicationID, [Name], [Version], [AppGroupID]) Values (Source.ApplicationID, Source.AppName, NULL, 0); 


END





GO
-- =============================================
-- Author:		John Reed
-- alter date: 26-05-2016
-- Description:	Add an additional application to user list which does not currently appear on machine feed.
-- =============================================
CREATE PROCEDURE [dbo].[Apps-AddAppDependency]
@AppKey nvarchar(255),
@AppID nvarchar(255),
@Relationship nvarchar(255) = 'DependsOn',
@Who nvarchar(255) = 'Admin'
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	-- Used for tracking dependencies between applications


If @Relationship = 'DependsOn'

	MERGE [ARM_CORE]..[AppDependency] as Target using (select @AppKey AS ParentID, @AppID AS ChildID) as Source
	ON (target.ParentAppID  = source.ParentID and target.ChildAppID = source.ChildID)
	WHEN NOT MATCHED BY TARGET THEN 
		insert (ParentAppID,ChildAppID) Values (Source.ParentID, Source.ChildID); 


If @Relationship = 'DependencyFor'

	MERGE [ARM_CORE]..[AppDependency] as Target using (select @AppID AS ParentID, @AppKey AS ChildID) as Source
	ON (target.ParentAppID  = source.ParentID and target.ChildAppID = source.ChildID)
	WHEN NOT MATCHED BY TARGET THEN 
		insert (ParentAppID,ChildAppID) Values (Source.ParentID, Source.ChildID); 


END




GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[ApplicationTransform]
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

--
-- PreReqs for this procedure are
--    TMP_RAW_AssetApps

-- Actions
--	1. Update AppAstPreStop
--	2. Update AppUniqPreStop
--  3. Update AppAsIs
--  4. Update AppAstAsIs
--  5. Update AppAstToBe

	IF object_id('TMP_RAW_AssetApps','U') is not null 
	BEGIN
--	1. Update AppAstPreStop
		IF object_id('AppAstPreStop','U') is not null DELETE FROM AppAstPreStop
		INSERT INTO AppAstPreStop
			SELECT distinct s.AssetID, ''+s.[AppName]+'-'+s.[AppVersion] AS ApplicationID FROM TMP_RAW_AssetApps s
--	2. Update AppUniqPreStop
		IF object_id('AppUniqPreStop','U') is not null DELETE FROM AppUniqPreStop
		INSERT INTO AppUniqPreStop
			SELECT distinct ''+s.[AppName]+'-'+s.[AppVersion] AS ApplicationID,s.[AppName],s.[AppVersion] FROM TMP_RAW_AssetApps s
--  3. Update AppAsIs
		IF object_id('[AppAsIs]','U') is not null Delete from [AppAsIs]
		INSERT INTO [AppAsIs] 
			SELECT distinct a.ApplicationID, a.[AppName], a.[AppVersion] from AppUniqPreStop a  LEFT JOIN TransformAppStop s  on a.ApplicationID like s.ApplicationID
			WHERE IsNull(s.ApplicationID,'') = '' 
--  4. Update AppAstAsIs
		IF object_id('AppAstAsIs','U') is not null Delete from [AppAstAsIs]
		INSERT INTO [AppAstAsIs] (ApplicationID, AssetID)
			SELECT distinct  a.ApplicationID, r.AssetID FROM [AppAsIs] a LEFT JOIN [AppAstPreStop] r  on r.ApplicationID = a.ApplicationID
--  5. Update AppAstToBe
		IF object_id('[AppAstToBe]','U') is not null Delete from [AppAstToBe]
		INSERT INTO [AppAstToBe] (AssetID, ApplicationID )
			SELECT distinct a.AssetID, IsNull(m.[To Be],a.[ApplicationID]) AS ApplicationID from [AppAstAsIs] a LEFT JOIN TransformAppMap m on  m.[As Is] = a.ApplicationID


--	6.  Apply Any User App Transactions
		Exec [ARM_CORE]..[TransformTransactions] 'AppAstToBe'


		
				
	--	-Is this doing the same as FixedRecords add, should we also have an update and a override

	--	IF object_id('[ARMS].[dbo].[AdditionaluserApps]','U') is not null 
	--BEGIN
	--	MERGE [AppAstToBe] AS Target
	--		USING (select distinct u.[AssetID], u.[Appkey] As ApplicationID from [ARMS].[dbo].[AdditionaluserApps] u) AS Source
	--		ON (Target.AssetID = Source.[AssetID] and Target.[ApplicationID] = Source.[ApplicationID])
	--		WHEN NOT MATCHED BY TARGET THEN
	--			INSERT (AssetID, [ApplicationID])
	--			VALUES (Source.[AssetID], Source.[ApplicationID]);
	--END
	end
END










GO
-- =============================================
-- Author:             <Author,,Name>
-- Create date: <Create Date,,>
-- Description:        <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[App-DYN-group-members]
        -- Add the parameters for the stored procedure here
        @TableGrpID as int = -1
AS
BEGIN
		if @TableGrpID = '' set @TableGrpID = -1 
        -- SET NOCOUNT ON added to prevent extra result sets from
        -- interfering with SELECT statements.
        SET NOCOUNT ON;
    -- Insert statements for procedure here
--		select '_WIP-101' AS DynamicValue, '_WIP-101' AS DynamicLabel, 10000 as [IC]
--		UNION 
--		(
        select a.ApplicationID AS DynamicValue, a.ApplicationID AS DynamicLabel, count(s.AssetID) AS IC
        from [ARM_CORE]..[Application] a
        LEFT JOIN [ARM_CORE]..[AppAstToBe] s on s.ApplicationID = a.ApplicationID
        where a.AppGroupID =  @TableGrpID
        Group By a.ApplicationID 
--		) 

END

GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[AdvanceItem]
	@ItemID nvarchar(255) = '',
	@CID int = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
--	BEGIN TRAN;

	DECLARE @NextCollectionID INT = 0;
	DECLARE @CurrentStep INT = 0;
	DECLARE @ClassID INT;

	SELECT @CurrentStep = c.[Order], @ClassID = c.CollectionClassID from [ARM_CORE]..[A_Collection] c where c.CollectionID = @CID

	SELECT top 1 @NextCollectionID = IsNull(c.CollectionID,0) from [ARM_CORE]..[A_Collection] c where c.CollectionClassID = @ClassID  and c.[Order] > @CurrentStep Order by c.[Order], CollectionID


	if @NextCollectionID <> 0 and @ItemID <> ''
	BEGIN
		EXEC [ARM_CORE]..[AddToCollection] '', @ItemID, @NextCollectionID
	END		


--	ROLLBACK TRAN;

END



GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[AddToGroup] 
	@GroupName nvarchar(255),
	@AssetID nvarchar(255),
	@GrpID int = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
--	BEGIN TRAN;

	if @GrpID > 0 
		MERGE [ARMS]..[AssetFlags] AS Target
		USING (SELECT @AssetID as AssetID, @GrpID as FlagID) As Source
		ON (Target.AssetID = Source.AssetID and Target.FlagID = Source.FlagID )
		WHEN NOT MATCHED BY TARGET THEN
			INSERT ([AssetID],[FlagID]) 
			VALUES (Source.AssetID, Source.FlagID);
	Else
		MERGE [ARMS]..[AssetFlags] AS Target
		USING (SELECT @AssetID as AssetID, (Select top 1 f.FlagID from [ARMS]..[AssetFlag] f where f.Name = @GroupName) AS FlagID) As Source
		ON (Target.AssetID = Source.AssetID and Target.FlagID = Source.FlagID )
		WHEN NOT MATCHED BY TARGET THEN
			INSERT ([AssetID],[FlagID]) 
			VALUES (Source.AssetID, Source.FlagID);
						
--	OUTPUT $action, inserted.*, deleted.*;

--	ROLLBACK TRAN;

END







GO

-- =============================================
-- Author:           <Author,,Name>
-- alter date: <alter Date,,>
-- Description:      <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[AddToCollection-xxx]
       @GroupName nvarchar(255),
       @ItemID nvarchar(255),
       @CollectionID int = 0,
       @PostComment bit = 0,
       @Author nvarchar(255) = 'System',
       @CommentType nvarchar(25) = 'asset',
	   @Option int = 0
AS
BEGIN
       -- SET NOCOUNT ON added to prevent extra result sets from
       -- interfering with SELECT statements.

	   -- Options :  
	   --   0 = Update Collection if new or if set when collection is different
	   --   1 = Update / redo collection regardless
	   --   2 = Update Only if either not currently set or if current collection not marked as "Deployed" state and collection different
	   --   3 = Update Only if either not currently set or if current collection not marked as "Deployed" state


       SET NOCOUNT ON;
--     BEGIN TRAN;

       DECLARE @Distinct bit
       DECLARE @Class int
       DECLARE @ColName nvarchar(500)
       DECLARE @ExistingValue int
       DECLARE @ExistingName  nvarchar(500)
	   DECLARE @EndPoint bit


       select @Distinct = IsNull(cc.[Distinct],0), @Class = IsNull(cc.CollectionClassID,0),  @ColName = '['+IsNull(cc.[Name],'') + ' ' + c.[Name] + ']' from [ARM_CORE]..[A_Collection] c LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc on cc.CollectionClassID = c.CollectionClassID where c.CollectionID = @CollectionID


       if @Distinct = 1 and @Class <> 0
          BEGIN
                    select @ExistingValue = i.CollectionID, @ExistingName = c.[Name], @EndPoint = IsNull(c.[Deployed],0) from [ARM_CORE]..[A_CollectionItem] i LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionID = i.CollectionID where i.ItemID =  @ItemID and i.CollectionID in (select CollectionID from [ARM_CORE]..[A_Collection] sc where sc.CollectionClassID = @Class)
            
				
					if (NOT @ExistingValue IS NULL)
					-- to delete one must first exist !!

						if ((@CollectionID <> @ExistingValue) or @Option = 1 or @Option = 3) and NOT ((@Option = 2 or @Option = 3) and @EndPoint = 1)
                           delete from [ARM_CORE]..[A_CollectionItem]  where ItemID =  @ItemID and CollectionID in (select CollectionID from [ARM_CORE]..[A_Collection] c where c.CollectionClassID = @Class)
          END 




       if @CollectionID > 0 
              

			if ( @EndPoint = 1 and (@option = 3 or @option = 2) ) 
				set @Endpoint = 1
			else 
				if (@option = 0 or @Option=2)

					  MERGE [ARM_CORE]..[A_CollectionItem] AS Target
					  USING (SELECT @ItemID as ItemID, @CollectionID as CollectionID) As Source
					  ON (Target.ItemID = Source.ItemID and Target.CollectionID = Source.CollectionID )
					  WHEN NOT MATCHED BY TARGET THEN
							 INSERT ([ItemID],[CollectionID]) 
							 VALUES (Source.ItemID, Source.CollectionID);
				Else

					  MERGE [ARM_CORE]..[A_CollectionItem] AS Target
					  USING (SELECT @ItemID as ItemID, @CollectionID as CollectionID) As Source
					  ON (Target.ItemID = Source.ItemID and Target.CollectionID = Source.CollectionID )
					  WHEN NOT MATCHED BY TARGET THEN
							 INSERT ([ItemID],[CollectionID]) 
							 VALUES (Source.ItemID, Source.CollectionID)
					  WHEN MATCHED THEN
							UPDATE SET Target.TaggedOn = GETDATE();






       Else
              MERGE [ARM_CORE]..[A_CollectionItem] AS Target
              USING (SELECT @ItemID as ItemID, (Select top 1 f.CollectionID from [ARM_CORE]..[A_Collection] f where f.[Name] = @GroupName) AS CollectionID) As Source
              ON (Target.ItemID = Source.ItemID and Target.CollectionID = Source.CollectionID )
              WHEN NOT MATCHED BY TARGET THEN
                     INSERT ([ItemID],[CollectionID]) 
                     VALUES (Source.ItemID, Source.CollectionID);
       
       if @PostComment = 1 
			if  @CollectionID <> @ExistingValue
				INSERT INTO [ARM_CORE]..[A_CommentLog]   ([Table], [Type], [RecordID] , [Comment], [Author]) values (@CommentType, 'System', @ItemID, 'Was ' + @ExistingName + '. Added to Collection ' + @ColName, @Author)
			else
				INSERT INTO [ARM_CORE]..[A_CommentLog]   ([Table], [Type], [RecordID] , [Comment], [Author]) values (@CommentType, 'System', @ItemID, 'Retagged to Collection ' + @ColName, @Author)

--     OUTPUT $action, inserted.*, deleted.*;

--     ROLLBACK TRAN;

END

GO

-- =============================================
-- Author:           <Author,,Name>
-- alter date: <alter Date,,>
-- Description:      <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[AddToCollection-old]
       @GroupName nvarchar(255),
       @ItemID nvarchar(255),
       @CollectionID int = 0,
       @PostComment bit = 0,
       @Author nvarchar(255) = 'System',
       @CommentType nvarchar(25) = 'asset',
	   @forceUpdate bit = 0
AS
BEGIN
       -- SET NOCOUNT ON added to prevent extra result sets from
       -- interfering with SELECT statements.
       SET NOCOUNT ON;
--     BEGIN TRAN;

       DECLARE @Distinct bit
       DECLARE @Class int
       DECLARE @ColName nvarchar(500)
       DECLARE @ExistingValue int
	   DECLARE @Deployed bit


       select @Distinct = IsNull(cc.[Distinct],0), @Class = IsNull(cc.CollectionClassID,0), @Deployed = IsNull(c.[Deployed],0), @ColName = '['+IsNull(cc.[Name],'') + ' ' + c.[Name] + ']' from [ARM_CORE]..[A_Collection] c LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc on cc.CollectionClassID = c.CollectionClassID where c.CollectionID = @CollectionID

       if @Distinct = 1 and @Class <> 0
          BEGIN
                    select @ExistingValue = CollectionID from [ARM_CORE]..[A_CollectionItem]  where ItemID =  @ItemID and CollectionID in (select CollectionID from [ARM_CORE]..[A_Collection] c where c.CollectionClassID = @Class)
            
                    if (@CollectionID <> @ExistingValue) or @forceUpdate = 1 
                           delete from [ARM_CORE]..[A_CollectionItem]  where ItemID =  @ItemID
                     and CollectionID in (select CollectionID from [ARM_CORE]..[A_Collection] c where c.CollectionClassID = @Class)
          END 


       if @CollectionID > 0 
              
			if @forceUpdate = 0 
				  MERGE [ARM_CORE]..[A_CollectionItem] AS Target
				  USING (SELECT @ItemID as ItemID, @CollectionID as CollectionID) As Source
				  ON (Target.ItemID = Source.ItemID and Target.CollectionID = Source.CollectionID )
				  WHEN NOT MATCHED BY TARGET THEN
						 INSERT ([ItemID],[CollectionID]) 
						 VALUES (Source.ItemID, Source.CollectionID);
			Else
				  MERGE [ARM_CORE]..[A_CollectionItem] AS Target
				  USING (SELECT @ItemID as ItemID, @CollectionID as CollectionID) As Source
				  ON (Target.ItemID = Source.ItemID and Target.CollectionID = Source.CollectionID )
				  WHEN NOT MATCHED BY TARGET THEN
						 INSERT ([ItemID],[CollectionID]) 
						 VALUES (Source.ItemID, Source.CollectionID)
				  WHEN MATCHED THEN
						UPDATE SET Target.TaggedOn = GETDATE();

       Else
              MERGE [ARM_CORE]..[A_CollectionItem] AS Target
              USING (SELECT @ItemID as ItemID, (Select top 1 f.CollectionID from [ARM_CORE]..[A_Collection] f where f.[Name] = @GroupName) AS CollectionID) As Source
              ON (Target.ItemID = Source.ItemID and Target.CollectionID = Source.CollectionID )
              WHEN NOT MATCHED BY TARGET THEN
                     INSERT ([ItemID],[CollectionID]) 
                     VALUES (Source.ItemID, Source.CollectionID);
       
       if @PostComment      = 1
              INSERT INTO [ARM_CORE]..[A_CommentLog]   ([Table], [Type], [RecordID] , [Comment], [Author]) values (@CommentType, 'System', @ItemID, 'Added to Collection ' + @ColName, @Author)


--     OUTPUT $action, inserted.*, deleted.*;

--     ROLLBACK TRAN;

END

GO

-- =============================================
-- Author:           <Author,,Name>
-- alter date: <alter Date,,>
-- Description:      <Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[AddToCollection]
       @GroupName nvarchar(255) = '',
       @ItemID nvarchar(255),
       @CollectionID int = 0,
       @PostComment bit = 0,
       @Author nvarchar(255) = 'System',
       @CommentType nvarchar(25) = 'asset',
	   @Option int = 0
AS
BEGIN
       -- SET NOCOUNT ON added to prevent extra result sets from
       -- interfering with SELECT statements.

	   -- Options :  
	   --   0 = Update Collection if new or if set when collection is different
	   --   1 = Update / redo collection regardless
	   --   2 = Update Only if either not currently set or if current collection not marked as "Deployed" state and collection different
	   --   3 = Update Only if either not currently set or if current collection not marked as "Deployed" state


       SET NOCOUNT ON;
--     BEGIN TRAN;

       DECLARE @Distinct bit
       DECLARE @Class int
       DECLARE @ColName nvarchar(500)
       DECLARE @ExistingValue int
       DECLARE @ExistingName  nvarchar(500)
	   DECLARE @EndPoint bit


       select @Distinct = IsNull(cc.[Distinct],0), @Class = IsNull(cc.CollectionClassID,0),  @ColName = '['+IsNull(cc.[Name],'') + ' ' + c.[Name] + ']' from [ARM_CORE]..[A_Collection] c LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc on cc.CollectionClassID = c.CollectionClassID where c.CollectionID = @CollectionID


       if @Distinct = 1 and @Class <> 0
          BEGIN
                    select @ExistingValue = i.CollectionID, @ExistingName = c.[Name], @EndPoint = IsNull(c.[Deployed],0) from [ARM_CORE]..[A_CollectionItem] i LEFT JOIN [ARM_CORE]..[A_Collection] c on c.CollectionID = i.CollectionID where i.ItemID =  @ItemID and i.CollectionID in (select CollectionID from [ARM_CORE]..[A_Collection] sc where sc.CollectionClassID = @Class)
            
				
					if (NOT @ExistingValue IS NULL)
					-- to delete one must first exist !!

						if ((@CollectionID <> @ExistingValue) or @Option = 1 or @Option = 3) and NOT ((@Option = 2 or @Option = 3) and @EndPoint = 1)
                           delete from [ARM_CORE]..[A_CollectionItem]  where ItemID =  @ItemID and CollectionID in (select CollectionID from [ARM_CORE]..[A_Collection] c where c.CollectionClassID = @Class)
          END 




       if @CollectionID > 0 
              

			if ( @EndPoint = 1 and (@option = 3 or @option = 2) ) 
				set @Endpoint = 1
			else 
				if (@option = 0 or @Option=2)

					  MERGE [ARM_CORE]..[A_CollectionItem] AS Target
					  USING (SELECT @ItemID as ItemID, @CollectionID as CollectionID) As Source
					  ON (Target.ItemID = Source.ItemID and Target.CollectionID = Source.CollectionID )
					  WHEN NOT MATCHED BY TARGET THEN
							 INSERT ([ItemID],[CollectionID]) 
							 VALUES (Source.ItemID, Source.CollectionID);
				Else

					  MERGE [ARM_CORE]..[A_CollectionItem] AS Target
					  USING (SELECT @ItemID as ItemID, @CollectionID as CollectionID) As Source
					  ON (Target.ItemID = Source.ItemID and Target.CollectionID = Source.CollectionID )
					  WHEN NOT MATCHED BY TARGET THEN
							 INSERT ([ItemID],[CollectionID]) 
							 VALUES (Source.ItemID, Source.CollectionID)
--					  WHEN MATCHED THEN
--							UPDATE SET Target.TaggedOn = GETDATE();
						;





       Else
              MERGE [ARM_CORE]..[A_CollectionItem] AS Target
              USING (SELECT @ItemID as ItemID, (Select top 1 f.CollectionID from [ARM_CORE]..[A_Collection] f where f.[Name] = @GroupName) AS CollectionID) As Source
              ON (Target.ItemID = Source.ItemID and Target.CollectionID = Source.CollectionID )
              WHEN NOT MATCHED BY TARGET THEN
                     INSERT ([ItemID],[CollectionID]) 
                     VALUES (Source.ItemID, Source.CollectionID);
  
       if  (@Endpoint = 1 and (@Option = 2 or @Option = 3)) or (@CollectionID = @ExistingValue and (@option = 0 or @Option = 2))
			set @Class = 0 -- simply to have something
	   else  
			if @PostComment = 1 
				if  @CollectionID <> @ExistingValue
					INSERT INTO [ARM_CORE]..[A_CommentLog]   ([Table], [Type], [RecordID] , [Comment], [Author]) values (@CommentType, 'System', @ItemID, 'Was [' + @ExistingName + ']. Added to Collection ' + @ColName, @Author)
				else
					if NOT (@option = 0 or @Option=2)
						INSERT INTO [ARM_CORE]..[A_CommentLog]   ([Table], [Type], [RecordID] , [Comment], [Author]) values (@CommentType, 'System', @ItemID, 'Added to Collection ' + @ColName, @Author)

--     OUTPUT $action, inserted.*, deleted.*;

--     ROLLBACK TRAN;

END

GO
-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[AddToAssetCollection]
	@GroupName nvarchar(255),
	@AssetID nvarchar(255),
	@GrpID int = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
--	BEGIN TRAN;

	if @GrpID > 0 
		MERGE [ARM_CORE]..[A_CollectionItem] AS Target
		USING (SELECT @AssetID as AssetID, @GrpID as CollectionID) As Source
		ON (Target.ItemID = Source.AssetID and Target.CollectionID = Source.CollectionID )
		WHEN NOT MATCHED BY TARGET THEN
			INSERT ([ItemID],[CollectionID]) 
			VALUES (Source.AssetID, Source.CollectionID);
	Else
		MERGE [ARM_CORE]..[A_CollectionItem] AS Target
		USING (SELECT @AssetID as AssetID, (Select top 1 f.CollectionID from [ARM_CORE]..[A_Collection] f where f.[Name] = @GroupName) AS CollectionID) As Source
		ON (Target.ItemID = Source.AssetID and Target.CollectionID = Source.CollectionID )
		WHEN NOT MATCHED BY TARGET THEN
			INSERT ([ItemID],[CollectionID]) 
			VALUES (Source.AssetID, Source.CollectionID);
						
--	OUTPUT $action, inserted.*, deleted.*;

--	ROLLBACK TRAN;

END




GO

-- =============================================
-- Author:		<Author,,Name>
-- alter date: <alter Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[AddToApplicationCollection]
	@GroupName nvarchar(255),
	@AppID nvarchar(255),
	@GrpID int = 0
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
--	BEGIN TRAN;

	if @GrpID > 0 
		MERGE [ARMS]..[ApplicationFlags] AS Target
		USING (SELECT @AppID as AppID, @GrpID as FlagID) As Source
		ON (Target.AppID = Source.AppID and Target.FlagID = Source.FlagID )
		WHEN NOT MATCHED BY TARGET THEN
			INSERT ([AppID],[FlagID]) 
			VALUES (Source.AppID, Source.FlagID);
	Else
		MERGE [ARMS]..[ApplicationFlags] AS Target
		USING (SELECT @AppID as AppID, (Select top 1 f.FlagID from [AssetFlag] f where f.Name = @GroupName) AS FlagID) As Source
		ON (Target.AppID = Source.AppID and Target.FlagID = Source.FlagID )
		WHEN NOT MATCHED BY TARGET THEN
			INSERT ([AppID],[FlagID]) 
			VALUES (Source.AppID, Source.FlagID);
						
--	OUTPUT $action, inserted.*, deleted.*;

--	ROLLBACK TRAN;

END




GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[AddCollectionBitConditions] 
	-- Add the parameters for the stored procedure here

AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.

	--- work in progress
	--- could be used to managed BitStatus values for some choice collectionClass collections

	SET NOCOUNT ON;

MERGE [ARM_CORE]..[A_BitCondition] as target
using (
	SELECT c.[Order], c.CollectionID as ConditionCID, c.Name as Attribute, cc.Name as [GroupName], 39+row_number() OVER (PARTITION BY c.CollectionClassID ORDER BY c.[Order]) AS BitPosition
	from [ARM_CORE]..[A_Collection] c LEFT JOIN [ARM_CORE]..[A_CollectionClass] cc on cc.CollectionClassID = c.CollectionClassID
	where cc.CLASSREF = 'ApplicationReadiness'  
) as Source
on target.ConditionCID = source.ConditionCID
when NOt MATCHED by Target then
insert (Attribute, GroupName, [Order], BitPosition, [Table], Field, IdentityID, [Distinct], Active, ConditionClassID, ConditionCID)
values (Source.[Attribute], Source.[GroupName], Source.[Order], Source.BitPosition, 'Application','BitStatus','ApplicationID',1,1,NULL,source.[ConditionCID]);


END

GO
